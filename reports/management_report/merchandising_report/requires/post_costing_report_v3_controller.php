<?
session_start();
//ini_set('memory_limit','3072M');
if( $_SESSION['logic_erp']['user_id'] == "" ) header("location:login.php");
require_once('../../../../includes/common.php');
require_once('../../../../includes/class4/class.conditions.php');
require_once('../../../../includes/class4/class.reports.php');
require_once('../../../../includes/class4/class.yarns.php');
require_once('../../../../includes/class4/class.conversions.php');
require_once('../../../../includes/class4/class.trims.php');
require_once('../../../../includes/class4/class.emblishments.php');
require_once('../../../../includes/class4/class.commisions.php');
require_once('../../../../includes/class4/class.commercials.php');
require_once('../../../../includes/class4/class.others.php');
require_once('../../../../includes/class4/class.washes.php');
require_once('../../../../includes/class4/class.fabrics.php');

/*require_once('../../../../includes/class.reports.php');
require_once('../../../../includes/class.yarns.php');*/

$_SESSION['page_permission']=$permission;
if( $_SESSION['logic_erp']['user_id'] == "" ) { header("location:login.php"); die; }
//--------------------------------------------------------------------------------------------------------------------

$user_name = $_SESSION['logic_erp']["user_id"];

$data=$_REQUEST['data'];
$action=$_REQUEST['action'];

if ($action=="load_drop_down_buyer")
{
	echo create_drop_down( "cbo_buyer_name", 150, "select buy.id, buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data' $buyer_cond and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90))  group by buy.id, buy.buyer_name order by buy.buyer_name","id,buyer_name", 1, "-- All Buyer --", $selected, "" );     	 
	exit();
}

if($action=="order_no_search_popup")
{
	echo load_html_head_contents("Order No Info", "../../../../", 1, 1,'','','');
	extract($_REQUEST);
	?>
     
	<script>
		
		var selected_id = new Array; var selected_name = new Array;
		
		function check_all_data()
		{
			var tbl_row_count = document.getElementById( 'tbl_list_search' ).rows.length;
			tbl_row_count = tbl_row_count - 1;

			for( var i = 1; i <= tbl_row_count; i++ )
			{
				$('#tr_'+i).trigger('click'); 
			}
		}
		
		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}
		
		function js_set_value( str ) {
			
			if (str!="") str=str.split("_");
			 
			toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFCC' );
			 
			if( jQuery.inArray( str[1], selected_id ) == -1 ) {
				selected_id.push( str[1] );
				selected_name.push( str[2] );
				
			}
			else {
				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == str[1] ) break;
				}
				selected_id.splice( i, 1 );
				selected_name.splice( i, 1 );
			}
			var id = ''; var name = '';
			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				name += selected_name[i] + '*';
			}
			
			id = id.substr( 0, id.length - 1 );
			name = name.substr( 0, name.length - 1 );
			
			$('#hide_order_id').val( id );
			$('#hide_order_no').val( name );
		}
	
    </script>

</head>

<body>
<div align="center">
	<form name="styleRef_form" id="styleRef_form">
		<fieldset style="width:780px;">
            <table width="770" cellspacing="0" cellpadding="0" border="1" rules="all" align="center" class="rpt_table" id="tbl_list">
            	<thead>
                    <th>Buyer</th>
                    <th>Search By</th>
                    <th id="search_by_td_up" width="170">Please Enter Order No</th>
                    <th>Shipment Date</th>
                    <th><input type="reset" name="button" class="formbutton" value="Reset"  style="width:100px;"></th> 
                    <input type="hidden" name="hide_order_no" id="hide_order_no" value="" />
                    <input type="hidden" name="hide_order_id" id="hide_order_id" value="" />
                </thead>
                <tbody>
                	<tr>
                        <td align="center">
                        	 <? 
								echo create_drop_down( "cbo_buyer_name", 140, "select buy.id, buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company=$companyID $buyer_cond and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90)) order by buy.buyer_name","id,buyer_name",1, "-- All Buyer--",0,"",0 );
							?>
                        </td>                 
                        <td align="center">	
                    	<?
                       		$search_by_arr=array(1=>"Order No",2=>"Style Ref",3=>"Job No");
							$dd="change_search_event(this.value, '0*0*0', '0*0*0', '../../') ";							
							echo create_drop_down( "cbo_search_by", 110, $search_by_arr,"",0, "--Select--", "",$dd,0 );
						?>
                        </td>     
                        <td align="center" id="search_by_td">				
                            <input type="text" style="width:130px" class="text_boxes" name="txt_search_common" id="txt_search_common" />	
                        </td> 
                        <td align="center">
                            <input type="text" name="txt_date_from" id="txt_date_from" class="datepicker" style="width:70px" readonly>To
                            <input type="text" name="txt_date_to" id="txt_date_to" class="datepicker" style="width:70px" readonly>
                        </td>	
                        <td align="center">
                        	<input type="button" name="button" class="formbutton" value="Show" onClick="show_list_view ('<? echo $companyID; ?>'+'**'+document.getElementById('cbo_buyer_name').value+'**'+document.getElementById('cbo_search_by').value+'**'+document.getElementById('txt_search_common').value+'**'+document.getElementById('txt_date_from').value+'**'+document.getElementById('txt_date_to').value, 'create_order_no_search_list_view', 'search_div', 'post_costing_report_v3_controller', 'setFilterGrid(\'tbl_list_search\',-1)');" style="width:100px;" />
                    	</td>
                    </tr>
                    <tr>
                        <td colspan="5" valign="middle"><? echo load_month_buttons(1); ?></td>
                    </tr>
            	</tbody>
           	</table>
            <div style="margin-top:5px" id="search_div"></div>
		</fieldset>
	</form>
</div>
</body>           
<script src="../../../../includes/functions_bottom.js" type="text/javascript"></script>
</html>
<?
	exit(); 
}

if($action=="create_order_no_search_list_view")
{
	$data=explode('**',$data);
	$company_id=$data[0];

	if($data[1]==0)
	{
		if ($_SESSION['logic_erp']["data_level_secured"]==1)
		{
			if($_SESSION['logic_erp']["buyer_id"]!="") $buyer_id_cond=" and a.buyer_name in (".$_SESSION['logic_erp']["buyer_id"].")"; else $buyer_id_cond="";
		}
		else
		{
			$buyer_id_cond="";
		}
	}
	else
	{
		$buyer_id_cond=" and a.buyer_name=$data[1]";
	}
	
	$search_by=$data[2];
	$search_string="%".trim($data[3])."%";

	if($search_by==1) 
		$search_field="b.po_number"; 
	else if($search_by==2) 
		$search_field="a.style_ref_no"; 	
	else 
		$search_field="a.job_no";
		
	$start_date =$data[4];
	$end_date =$data[5];	
	
	if($start_date!="" && $end_date!="")
	{
		if($db_type==0)
		{
			$date_cond="and b.pub_shipment_date between '".change_date_format(trim($start_date),"yyyy-mm-dd")."' and '".change_date_format(trim($end_date),"yyyy-mm-dd")."'";
		}
		else
		{
			$date_cond="and b.pub_shipment_date between '".change_date_format(trim($start_date),'','',1)."' and '".change_date_format(trim($end_date),'','',1)."'";	
		}
	}
	else
	{
		$date_cond="";
	}
	
	$company_short_arr=return_library_array( "select id, company_short_name from lib_company",'id','company_short_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$arr=array (0=>$company_short_arr,1=>$buyer_arr);
	
	if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
	else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
	else $year_field="";//defined Later
	
	$sql= "select b.id, a.job_no, $year_field, a.job_no_prefix_num, a.company_name, a.buyer_name, a.style_ref_no, b.po_number, b.pub_shipment_date from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.company_name=$company_id and $search_field like '$search_string' $buyer_id_cond $date_cond order by b.id, b.pub_shipment_date";
		
	echo create_list_view("tbl_list_search", "Company,Buyer Name,Year,Job No,Style Ref. No, Po No, Shipment Date", "70,70,50,70,150,180","760","210",0, $sql , "js_set_value", "id,po_number","",1,"company_name,buyer_name,0,0,0,0,0",$arr,"company_name,buyer_name,year,job_no_prefix_num,style_ref_no,po_number,pub_shipment_date","",'','0,0,0,0,0,0,3','',1) ;
   exit(); 
}

if($action=="report_generate")
{ 
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process )); 
	
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );

	$company_name=str_replace("'","",$cbo_company_name);
	$txt_order_no=str_replace("'","",$txt_order_no);
	$txt_file_no=str_replace("'","",$txt_file_no);
	$txt_ref_no=str_replace("'","",$txt_ref_no);
	$cbo_based_on=str_replace("'","",$cbo_based_on);
	$report_type=str_replace("'","",$report);
	
	if($txt_ref_no!='') $ref_cond="and b.grouping='$txt_ref_no'";else $ref_cond="";
	if($txt_file_no!='') $file_cond="and b.file_no=$txt_file_no";else $file_cond="";
	
	if(str_replace("'","",$cbo_buyer_name)==0)
	{
		if ($_SESSION['logic_erp']["data_level_secured"]==1)
		{
			if($_SESSION['logic_erp']["buyer_id"]!="") $buyer_id_cond=" and a.buyer_name in (".$_SESSION['logic_erp']["buyer_id"].")"; else $buyer_id_cond="";
		}
		else $buyer_id_cond="";
	}
	else $buyer_id_cond=" and a.buyer_name=$cbo_buyer_name";//.str_replace("'","",$cbo_buyer_name)
	
	$txt_job_no=str_replace("'","",$txt_job_no);
	if(trim($txt_job_no)!="") $job_no=trim($txt_job_no); else $job_no="%%";
	
	$cbo_year=str_replace("'","",$cbo_year);
	if(trim($cbo_year)!=0) 
	{
		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year"; else if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year"; else $year_cond="";
	}
	else $year_cond="";
	
	$date_cond='';
	if(str_replace("'","",$txt_date_from)!="" && str_replace("'","",$txt_date_to)!="")
	{
		$date_cond=" and b.pub_shipment_date between $txt_date_from and $txt_date_to";
	}
	
	
	$po_id_cond="";
	if(trim(str_replace("'","",$txt_order_no))!="")
	{
		if(str_replace("'","",$hide_order_id)!="") $po_id_cond=" and b.id in(".str_replace("'","",$hide_order_id).")";
		else $po_id_cond=" and LOWER(b.po_number) like LOWER('%".trim(str_replace("'","",$txt_order_no))."%')";
	}
	
	$shipping_status_cond='';
	if(str_replace("'","",$shipping_status)!=0) $shipping_status_cond=" and b.shiping_status=$shipping_status";
	
	$po_ids_array=array();
		
	if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
	else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
	else $year_field="";//defined Later
		
	$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, $year_field,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c where a.job_no=b.job_no_mst and a.job_no=c.job_no and b.job_no_mst=c.job_no and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no'   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $date_cond $buyer_id_cond $po_id_cond $ref_cond $file_cond $shipping_status_cond $year_cond order by b.pub_shipment_date, a.job_no_prefix_num, b.id";
	//echo $sql; //die;
	$result=sql_select($sql);
	$all_po_id="";	$all_job_id="";
	foreach($result as $row)
	{
		if($all_po_id=="") $all_po_id=$row[csf("id")]; else $all_po_id.=",".$row[csf("id")];
		//if($all_job_id=="") $all_job_id="'".$row[csf("job_no")]."'"; else $all_job_id.=","."'".$row[csf("job_no")]."'";
		if($all_job_id=="") $all_job_id=$row[csf("job_id")]; else $all_job_id.=",".$row[csf("job_id")];
		$job_arr[$row[csf("id")]]['job']=$row[csf("job_no")];
		$job_arr2[$row[csf("job_no")]]['po_quantity']=$row[csf("po_quantity")];
		$job_arr2[$row[csf("job_no")]]['job_quantity']=$row[csf("job_quantity")];
		$po_exchange_rateArr[$row[csf("id")]]['exchange_rate']=$row[csf("exchange_rate")];
	}
	if($all_po_id=="") 
	{ 
		echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
	}
	//	echo $all_job_id;die;
	$jobIds=chop($all_job_id,',');
	//echo $jobIds;die;
	$job_cond_for_in=""; $jobIdCond="";
	$job_ids=count(array_unique(explode(",",$all_job_id)));
	if($db_type==2 && $job_ids>1000)
	{
		$job_cond_for_in=" and (";
		$jobIdCond=" and (";
		$jobIdsArr=array_chunk(explode(",",$jobIds),999);
		foreach($jobIdsArr as $ids)
		{
			$ids=implode(",",$ids);
			$job_cond_for_in.=" a.job_id in($ids) or"; 
			$jobIdCond.=" a.job_no_id in($ids) or"; 
		}
		$job_cond_for_in=chop($job_cond_for_in,'or ');
		$job_cond_for_in.=")";
		$jobIdCond=chop($jobIdCond,'or ');
		$jobIdCond.=")";
	}
	else
	{
		$jobIds=implode(",",array_unique(explode(",",$all_job_id)));
		$job_cond_for_in=" and a.job_id in($jobIds)";
		$jobIdCond=" and a.job_no_id in($jobIds)";
	}
	//echo $job_cond_for_in;die;
	
	$poIds=chop($all_po_id,','); $po_cond_for_in=""; $po_cond_for_in2="";$po_cond_for_in3=""; 
	$po_ids=count(array_unique(explode(",",$all_po_id)));
	if($db_type==2 && $po_ids>1000)
	{
		$po_cond_for_in=" and (";
		$po_cond_for_in2=" and (";
		$po_cond_for_in3=" and (";
		$po_cond_for_in4=" and (";
		$po_cond_for_in5=" and (";
		$poIdsArr=array_chunk(explode(",",$poIds),999);
		foreach($poIdsArr as $ids)
		{
			$ids=implode(",",$ids);
			$po_cond_for_in.=" b.po_break_down_id in($ids) or"; 
			$po_cond_for_in2.=" po_id in($ids) or"; 
			$po_cond_for_in3.=" b.order_id in($ids) or";
			$po_cond_for_in4.=" b.po_breakdown_id in($ids) or"; 
			$po_cond_for_in5.=" b.po_id in($ids) or"; 
		}
		$po_cond_for_in=chop($po_cond_for_in,'or ');
		$po_cond_for_in.=")";
		
		$po_cond_for_in2=chop($po_cond_for_in2,'or ');
		$po_cond_for_in2.=")";
		$po_cond_for_in3=chop($po_cond_for_in3,'or ');
		$po_cond_for_in3.=")";
		$po_cond_for_in4=chop($po_cond_for_in4,'or ');
		$po_cond_for_in4.=")";
		$po_cond_for_in5=chop($po_cond_for_in5,'or ');
		$po_cond_for_in5.=")";
	}
	else
	{
		$poIds=implode(",",array_unique(explode(",",$all_po_id)));
		$po_cond_for_in=" and b.po_break_down_id in($poIds)";
		$po_cond_for_in2=" and po_id in($poIds)";
		$po_cond_for_in3=" and b.order_id in($poIds)";
		$po_cond_for_in4=" and b.po_breakdown_id in($poIds)";
		$po_cond_for_in5=" and b.po_id in($poIds)";
	}
		
	if($poIds!='' || $poIds!=0) $po_cond_for_in=$po_cond_for_in; 
	else $po_cond_for_in="and b.po_break_down_id in(0)";
	
	$po_idArr=array_unique(explode(",",$all_po_id));
	$po_id_cond_for_in=where_con_using_array($po_idArr,0,"e.po_id"); 
	
	$ActualArray_sql=sql_select("select a.id,b.pr_date, b.man_power, b.target_per_hour, e.working_hour,e.operator,e.helper,c.from_date,c.to_date,c.capacity,e.po_id from prod_resource_mst a, prod_resource_dtls b,prod_resource_dtls_mast c,prod_resource_color_size e where a.id=c.mst_id and c.id=b.mast_dtl_id and e.mst_id=a.id and e.dtls_id=c.id and a.company_id=$company_name  and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 $po_id_cond_for_in");
	//echo "select a.id,b.pr_date, b.man_power, b.target_per_hour, e.working_hour,e.operator,e.helper,c.from_date,c.to_date,c.capacity,e.po_id from prod_resource_mst a, prod_resource_dtls b,prod_resource_dtls_mast c,prod_resource_color_size e where a.id=c.mst_id and c.id=b.mast_dtl_id and e.mst_id=a.id and e.dtls_id=c.id and a.company_id=$company_name  and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 $po_id_cond_for_in";
	 
	  
	
		foreach($ActualArray_sql as $val)
		{
			//$pr_date=date('m-Y',$val[csf('pr_date')]);
			$pr_date=date("Y-m",strtotime(($val[csf('pr_date')])));
			//echo $pr_date;
			$po_exchange_rate=$po_exchange_rateArr[$val[csf("po_id")]]['exchange_rate'];
			$prod_resource_array[$val[csf('po_id')]]['man_power']=$val[csf('man_power')];
			$prod_resource_array[$val[csf('po_id')]]['operator']=$val[csf('operator')];
			$prod_resource_array[$val[csf('po_id')]]['helper']=$val[csf('helper')];
			$prod_resource_array[$val[csf('po_id')]]['terget_hour']=$val[csf('target_per_hour')];
			$prod_resource_array[$val[csf('po_id')]]['operator_helper']=$val[csf('operator')]+$val[csf('helper')];
			$prod_resource_array[$val[csf('po_id')]]['working_hour']+=$val[csf('working_hour')];
			$prod_resource_array[$val[csf('po_id')]]['pr_date']=$val[csf('pr_date')];
			$prod_resource_array[$val[csf('po_id')]]['ex_rate']=$po_exchange_rate;
			//$prod_resource_array[$val[csf('po_id')]]['day_start']=$val[csf('from_date')];
			$actual_prod_id_arr[$val[csf('id')]]=$val[csf('id')];
			 
		}
		$act_id_cond_for_in=where_con_using_array($actual_prod_id_arr,0,"a.id"); 
		$ActualExtraArray_sql=sql_select("select a.id,b.pr_date, b.man_power, e.style_ref_no,e.number_of_emp, e.adjust_hour as working_hour,c.from_date,c.to_date,c.capacity,e.style_ref_no from prod_resource_mst a, prod_resource_dtls b,prod_resource_dtls_mast c,prod_resource_smv_adj e where a.id=c.mst_id and c.id=b.mast_dtl_id and e.mst_id=a.id and e.dtl_id=b.id and a.company_id=$company_name  and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 $act_id_cond_for_in");
		//echo "select a.id,b.pr_date, b.man_power, e.style_ref_no,e.number_of_emp, e.adjust_hour as working_hour,c.from_date,c.to_date,c.capacity,e.style_ref_no from prod_resource_mst a, prod_resource_dtls b,prod_resource_dtls_mast c,prod_resource_smv_adj e where a.id=c.mst_id and c.id=b.mast_dtl_id and e.mst_id=a.id and e.dtl_id=b.id and a.company_id=$company_name  and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 $act_id_cond_for_in";
	
		foreach($ActualExtraArray_sql as $val)
		{
			$pr_date=date("Y-m",strtotime(($val[csf('pr_date')])));
			$adj_resource_array[$val[csf('style_ref_no')]]['working_hour']+=$val[csf('working_hour')];
			$adj_resource_array[$val[csf('style_ref_no')]]['pr_date']=$val[csf('pr_date')];
			$adj_resource_array[$val[csf('style_ref_no')]]['number_of_emp']+=$val[csf('number_of_emp')];
		}
		unset($ActualExtraArray_sql);
		//print_r($prod_resource_array);
		$sql_cpm="select monthly_cm_expense,applying_period_date,applying_period_to_date, no_factory_machine, working_hour, cost_per_minute, depreciation_amorti, operating_expn, interest_expense, income_tax from lib_standard_cm_entry where company_id=$company_name   and status_active=1 and is_deleted=0";
	 
	$lib_data_array=sql_select($sql_cpm);
	foreach ($lib_data_array as $row)
	{
	  $applying_period_date=$row[csf("applying_period_date")];
	  $from_cmp_date=date("Y-m",strtotime(($applying_period_date)));
	 $lib_cpm_array[$from_cmp_date]['cpm']=$row[csf('cost_per_minute')];
	}
	unset($lib_data_array);
	
	
	$ex_factory_arr=return_library_array( "select b.po_break_down_id, 
	sum(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as qnty 
	from pro_ex_factory_mst b where b.status_active=1 and b.is_deleted=0 $po_cond_for_in group by b.po_break_down_id", "po_break_down_id", "qnty");	
	
	ob_start();
	?>
    <fieldset>
    	<table width="5430">
            <tr class="form_caption">
                <td colspan="35" align="center"><strong>Post Costing Report V3</strong></td>
            </tr>
            <tr class="form_caption">
                <td colspan="35" align="center"><strong><? echo $company_arr[$company_name];?></strong>
                    <br>
                    <strong><? echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to)); ?></strong>
                </td>
            </tr>
        </table>
        <table style="margin-top:10px" id="table_header_1" class="rpt_table" width="5430" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="70">Buyer</th>
                <th width="60">Job Year</th>
                <th width="70">Job No</th>
                <th width="100">PO No</th>
                <th width="70">File No</th>
                <th width="80">Ref. No</th>
                <th width="110">Style Name</th>
                <th width="120">Garments Item</th>
                <th width="90">PO Quantity</th>
                <th width="50">UOM</th>
                <th width="70">Unit Price</th>
                <th width="110">PO Value</th>
                <th width="100">SMV</th>
                <th width="80">Shipment Date</th>
                <th width="100">Shipping Status</th>
                <th width="100">Cost Source</th>
                <th width="100">PO/Ex-Factory Qnty</th>
                <th width="110">PO/Ex-Factory Value</th>
                <th width="110">Grey Yarn Cost</th>
                <th width="100">Yarn Value Addition Cost</th>
                <th width="110">Knitting Cost</th>
                <th width="100">Grey Fabric Transfer Cost</th>
              
                <th width="100">Grey Fabric Cost</th>
                
                <th width="110">Dye & Fin Cost</th>
                <th width="110">AOP Cost</th>
                <th width="100">Fin. Fab. Transfer Cost</th>
                <th width="100">Fin.Fabric Purchase Cost</th>
                <th width="110">Grey Fabric Purchease Cost</th>
                <th width="100">Finished Fabric Cost</th>
                <th width="100" title="Fin.Fabric Purchase Cost+Finished Fabric Cost">Total Fabric Cost</th>
                <th width="110">Trims Cost</th>
                <th width="100">Printing Cost</th>
                <th width="100">Embroidery Cost</th>
                <th width="100">Gmt Dyeing Cost</th>
                <th width="100">Washing Cost</th>
               
                <th width="100">Commission Cost</th>
                <th width="100">Commercial Cost</th>
                <th width="100">Freight Cost</th>
                <th width="100">Testing Cost</th>
                <th width="100">Inspection Cost</th>
                <th width="100">Courier Cost</th>
                
                <th width="100">Certificate Cost</th>
                <th width="100">Deffd. LC Cost</th>
                <th width="100">Design Cost</th>
                <th width="100">Studio Cost</th>
                 <th width="100">Opert. Exp.</th>
               
                  
                
                <th width="100">CM Cost</th>
                
                 <th width="100">Interest</th>
                <th width="100">Income Tax</th>
                 <th width="100">Depc. & Amort.</th>
               
                  
                  
                
                <th width="100">Total Cost</th>
                <th width="100">Margin/Loss</th>
                <th  width="100">% to Ex-Factory Value</th>
                <th width="100">CPA/Short Fab. Cost</th>
                <th width="">Net Margin/Loss</th>
            </thead>
        </table>
    	<div style="width:5450px; max-height:400px; overflow-y:scroll" id="scroll_body">
            <table class="rpt_table" width="5430" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body">
            <?
			$process_costing=return_field_value("process_costing_maintain", "variable_settings_production", "company_name=$company_name and variable_list=34 and is_deleted=0 and status_active=1");
		//	echo $process_costing.'ddd';die;
			
			$usd_id=2;
			$fabriccostArray=array(); $yarncostArray=array(); $trimsCostArray=array(); $prodcostArray=array(); $actualCostArray=array(); $actualTrimsCostArray=array(); 
			$subconCostArray=array(); $embellCostArray=array(); $washCostArray=array(); $aopCostArray=array(); $yarnTrimsCostArray=array(); 
			$yarncostDataArray=sql_select("select a.job_no, sum(a.amount) as amnt, sum(a.rate*a.avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in group by a.job_no");
			//echo "select a.job_no, sum(a.amount) as amnt, sum(a.rate*a.avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in group by a.job_no";die;
			foreach($yarncostDataArray as $yarnRow)
			{
			   $yarncostArray[$yarnRow[csf('job_no')]]=$yarnRow[csf('amount')];
			}
			unset($yarncostDataArray);
			$fabriccostDataArray=sql_select("select a.job_no, a.costing_per_id, a.embel_cost, a.wash_cost, a.cm_cost, a.commission, a.currier_pre_cost, a.lab_test, a.inspection, a.freight, a.comm_cost from wo_pre_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in");
			foreach($fabriccostDataArray as $fabRow)
			{
				 $fabriccostArray[$fabRow[csf('job_no')]]['costing_per_id']=$fabRow[csf('costing_per_id')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['embel_cost']=$fabRow[csf('embel_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['wash_cost']=$fabRow[csf('wash_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['cm_cost']=$fabRow[csf('cm_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['commission']=$fabRow[csf('commission')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['currier_pre_cost']=$fabRow[csf('currier_pre_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['lab_test']=$fabRow[csf('lab_test')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['inspection']=$fabRow[csf('inspection')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['freight']=$fabRow[csf('freight')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['comm_cost']=$fabRow[csf('comm_cost')];
			}
			unset($fabriccostDataArray);
			$prodcostDataArray="select a.body_part_id,a.lib_yarn_count_deter_id as deter_id,b.po_break_down_id as po_id,
								  avg(CASE WHEN c.cons_process=1 THEN c.charge_unit END) AS knit_charge,
								  avg(CASE WHEN c.cons_process=30 THEN c.charge_unit END) AS yarn_dye_charge,
								  avg(CASE WHEN c.cons_process=35 THEN c.charge_unit END) AS aop_charge,
								  avg(CASE WHEN c.cons_process not in(1,2,30,35,134) THEN c.charge_unit END) AS dye_finish_charge
								  from wo_pre_cost_fabric_cost_dtls a,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cos_fab_co_avg_con_dtls b where a.id=c.fabric_description and a.job_no=c.job_no and b.pre_cost_fabric_cost_dtls_id=a.id and b.job_no=c.job_no and c.status_active=1 and c.is_deleted=0  $po_cond_for_in group by  a.lib_yarn_count_deter_id,b.po_break_down_id,a.body_part_id";
			$resultfab_arr = sql_select($prodcostDataArray);
			foreach($resultfab_arr as $prodRow)
			{
				//echo $prodRow[csf('knit_charge')].',';
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['knit_charge']=$prodRow[csf('knit_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['yarn_dye_charge']=$prodRow[csf('yarn_dye_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['aop_charge']=$prodRow[csf('aop_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['dye_finish_charge']=$prodRow[csf('dye_finish_charge')];
			}	
			unset($resultfab_arr);
			//order_wise_pro_details
			//$finProd_grey_usedArr=return_library_array( "select b.po_breakdown_id, sum(b.grey_used_qty) as grey_used_qty from order_wise_pro_details b where  b.entry_form=7 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 group by b.po_breakdown_id", "po_breakdown_id", "grey_used_qty");
			if($poIds!='' || $poIds!=0)
			{
				$po_cond_for_in4=$po_cond_for_in4; 
			}
			else
			{
				$po_cond_for_in4="and b.po_breakdown_id in(0)";
			}
			$finProd_grey_used_sql = "select c.body_part_id,c.fabric_description_id as deter_id,b.po_breakdown_id as po_id, b.quantity as grey_used_qty from order_wise_pro_details b,pro_finish_fabric_rcv_dtls c where  b.dtls_id=c.id and b.entry_form=7 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 ";
			$fingrey_used_data =sql_select($finProd_grey_used_sql );
			foreach($fingrey_used_data as $row)
			{
				//echo $prodRow[csf('knit_charge')].',';
				//$finProd_grey_used=$finProd_grey_usedArr[$row[csf('po_id')]];
				$fin_dye_finish_charge=$prodcostArray[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$fin_grey_used_arr[$row[csf('po_id')]]['grey_used_amt']+=$row[csf('grey_used_qty')]*$fin_dye_finish_charge;
				//echo $row[csf('qnty')].'='.$dye_finish_charge.',';
			}
			unset($fingrey_used_data);
			
		
			$grey_used_sql = "select a.body_part_id,a.fabric_description_id as deter_id,b.qnty,b.po_breakdown_id as po_id from pro_finish_fabric_rcv_dtls a, pro_roll_details b where a.id=b.dtls_id and b.entry_form=66 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4";
			$grey_used_data =sql_select($grey_used_sql );
			foreach($grey_used_data as $row)
			{
				//echo $prodRow[csf('knit_charge')].',';
				$finProd_grey_used=$finProd_grey_usedArr[$row[csf('po_id')]];
				$dye_finish_charge=$prodcostArray[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$grey_used_arr[$row[csf('po_id')]]['grey_used_amt']+=$row[csf('qnty')]*$dye_finish_charge;
				//echo $row[csf('qnty')].'='.$dye_finish_charge.',';
			}
			unset($grey_used_data);
			if($jobIds!='' || $jobIds!=0)
			{
				$job_cond_for_in=$job_cond_for_in; 
				$jobIdCond=$jobIdCond;
			}
			else
			{
				$job_cond_for_in="and a.job_no in('0')";
				$jobIdCond="and a.job_no in('0')";
			}
			$all_job_IdArr=array_unique(explode(",",$all_job_id));
			$jobId_cond_for_in=where_con_using_array($all_job_IdArr,0,"a.job_no_id"); 
			
			$yarn_dyeing_costArray=array(); //product_id
			 $yarndyeing_sql="select b.booking_date,b.id,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 $jobId_cond_for_in group by b.id,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";
			$yarndyeing_result = sql_select($yarndyeing_sql);
			foreach($yarndyeing_result as $yarnRow)
			{
				$yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['job']=$yarnRow[csf('job_no')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['ydw_no']=$yarnRow[csf('ydw_no')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['booking_date']=$yarnRow[csf('booking_date')];
				$yarn_dyeing_curr_arr[$yarnRow[csf('ydw_no')]]['currency']=$yarnRow[csf('currency')];
				$yarn_dyeing_rate_arr[$yarnRow[csf('job_no')]][$yarnRow[csf('yarn_color')]]['rate']=$yarnRow[csf('dyeing_charge')];
				
				$yarn_dyeing_mst_idArr[$yarnRow[csf('id')]]=$yarnRow[csf('id')];
			}
			//print_r($yarn_dyeing_curr_arr);
			unset($resultyarnIssueData);	
				
			$yarnIssueData="select b.prod_id,sum(a.cons_amount) as cons_amount,sum(a.cons_quantity) as cons_quantity
				from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and b.entry_form ='3' and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)  $po_cond_for_in4  group by  b.prod_id";
			$resultyarnIssueData = sql_select($yarnIssueData);
			$all_prod_ids="";
			foreach($resultyarnIssueData as $row)
			{
				if($all_prod_ids=="") $all_prod_ids=$row[csf('prod_id')];else $all_prod_ids.=",".$row[csf('prod_id')];
				
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt']+=$row[csf('cons_amount')];
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty']+=$row[csf('cons_quantity')];
			}
			unset($resultyarnIssueData);
			//echo $all_prod_ids;
			//print_r($yarn_issue_amt_arr);
			$prodIds=chop($all_prod_ids,',');
			$prod_cond_for_in="";
			$prod_ids=count(array_unique(explode(",",$all_prod_ids)));
			if($db_type==2 && $prod_ids>1000)
			{
				$prod_cond_for_in=" and (";
				$prodIdsArr=array_chunk(explode(",",$prodIds),999);
				foreach($prodIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					$prod_cond_for_in.=" a.prod_id in($ids) or"; 
				}
				$prod_cond_for_in=chop($prod_cond_for_in,'or ');
				$prod_cond_for_in.=")";
			}
			else
			{
				$prodIds=implode(",",array_unique(explode(",",$all_prod_ids)));
				$prod_cond_for_in=" and a.prod_id in($prodIds)";
			}
			
			if($prodIds!='' || $prodIds!=0)
			{
				$prod_cond_for_in=$prod_cond_for_in;
			}
			else
			{
				$prod_cond_for_in="and a.prod_id in(0)";
			}
					
			 $sql_receive_for_issue="select c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.exchange_rate,c.currency_id,c.receive_purpose,b.lot,b.color, 
			 sum(a.order_qnty) as qty, sum(a.order_amount) as amnt,
			 sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv
			  from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $prod_cond_for_in  group by c.booking_id,a.job_no,a.prod_id,c.currency_id,c.exchange_rate,c.receive_purpose,b.lot,b.color";
			$resultReceive_chek = sql_select($sql_receive_for_issue);
			
			foreach($resultReceive_chek as $row)
			{
				$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose']=$row[csf('receive_purpose')];
				$receive_date_array[$row[csf('prod_id')]]['last_exchange_rate']=$row[csf('exchange_rate')];
				$avg_rate=$row[csf('amnt')]/$row[csf('qty')];
				$receive_array[$row[csf('prod_id')]]=$avg_rate;
				if($row[csf('prod_id')]!="")
				{
					$prod_id_arr[$row[csf('prod_id')]]=$row[csf('prod_id')];
				}
			}
			//print_r($prod_id_arr);die;
			unset($resultReceive_chek);
			
			//$jobIdArr=array_unique(explode(",",$all_job_id));
			$YdId_cond_for_in=where_con_using_array($yarn_dyeing_mst_idArr,0,"c.booking_id"); 
			
			
			$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit");
			//$receive_array=array();//$job_cond_for_in  $prod_cond_for_in
			 $sql_receive="select c.recv_number,c.booking_id,c.exchange_rate,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.receive_purpose,b.lot,b.color,c.currency_id,
			 sum(a.order_qnty) as qty, sum(a.order_amount) as amnt,
			 sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv,
			  sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.cons_quantity ELSE 0 END) AS cons_quantity
			  from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id  and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1  $YdId_cond_for_in  and a.is_deleted=0    group by c.recv_number,c.booking_id,c.exchange_rate,a.job_no,a.prod_id,c.currency_id,c.receive_purpose,b.lot,b.color";
			$resultReceive = sql_select($sql_receive);$all_recv_prod_ids="";
			foreach($resultReceive as $invRow)
			{
				if($all_recv_prod_ids=="") $all_recv_prod_ids=$invRow[csf('prod_id')];else $all_recv_prod_ids.=",".$invRow[csf('prod_id')];
				$receive_curr_array[$invRow[csf('prod_id')]]=$invRow[csf('currency_id')];
				$jobNo=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['job'];
				$ydw_no=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['ydw_no'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				//echo $jobNo.'=='.$invRow[csf('booking_id')].'b';
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['job']=$jobNo;
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['ydw_no']=$ydw_no;
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$dye_rate=$yarn_dyeing_rate_arr[$jobNo][$invRow[csf('color')]]['rate'];
					//echo $ydw_no.'d'.$dye_rate;
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				//$po_quantity=$job_arr2[$jobNo]['po_quantity'];
				$order_amount_recv=$invRow[csf('order_amount_recv')];
				$cons_quantity=$invRow[csf('cons_quantity')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				$exchange_rateArr[$invRow[csf('prod_id')]]=$invRow[csf('exchange_rate')];
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
			//	$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rate;
			
				if($currency==1) $avg_rate=$dye_rate/$currency_rate;//Taka
				else $avg_rate=$dye_rate;	
				//echo $is_short.'='.$avg_rate.'='.$cons_quantity.', ';
				if($is_short==2) $yarn_receive_amount_arr[$jobNo]['order_amount_recv']+=$avg_rate*$cons_quantity;//Main Booking..
				else $yarn_receive_amount_arr[$jobNo]['cpa_order_amount_recv']+=$avg_rate*$cons_quantity;	
			}
		//	print_r($yarn_receive_amount_arr);
			//echo $all_recv_prod_ids;
			unset($resultReceive);
			 
			if($all_recv_prod_ids!="")
			{
				$recvprodIds=chop($all_recv_prod_ids,',');
				$recv_prod_cond_for_in="";
				$recv_prod_ids=count(array_unique(explode(",",$all_recv_prod_ids)));
				if($db_type==2 && $recv_prod_ids>1000)
				{
					$recv_prod_cond_for_in=" and (";
					$recvprodIdsArr=array_chunk(explode(",",$recvprodIds),999);
					foreach($recvprodIdsArr as $ids)
					{
						$ids=implode(",",$ids);
						$recv_prod_cond_for_in.=" a.prod_id in($ids) or"; 
					}
					$recv_prod_cond_for_in=chop($recv_prod_cond_for_in,'or ');
					$recv_prod_cond_for_in.=")";
				}
				else
				{
					$recprodIds=implode(",",array_unique(explode(",",$all_recv_prod_ids)));
					$recv_prod_cond_for_in=" and a.prod_id in($recprodIds)";
				}
			}
			//echo $recv_prod_cond_for_in;
			$sql_receive_ret="select a.prod_id,b.lot,b.color,c.received_mrr_no,
			 sum(a.cons_quantity) as cons_quantity
			  from inv_transaction a,product_details_master b,inv_issue_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=8 and c.item_category=1 and a.transaction_type=3 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $recv_prod_cond_for_in  group by a.prod_id,b.lot,b.color,c.received_mrr_no";
			$resultReceive_ret = sql_select($sql_receive_ret);
			
			foreach($resultReceive_ret as $row)
			{
				$ydw_no=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['ydw_no'];
				$recv_job=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['job'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$ydye_rate=$yarn_dyeing_rate_arr[$jobNo][$row[csf('color')]]['rate'];
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				//echo $recv_job.'d'.$currency;
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rateArr[$row[csf('prod_id')]];;
				if($currency==1) $avg_rate=$ydye_rate/$currency_rate;//Taka
				else $avg_rate=$ydye_rate;	
				
				$ret_amt=$row[csf('cons_quantity')]*$avg_rate;
				//$receive_ret_arr[$row[csf('prod_id')]]['last_trans_date']=$row[csf('cons_quantity')];
				if($is_short==2) $receive_ret_arr[$recv_job]['recv_ret_amt']+=$ret_amt; //Main Booking
				else $receive_ret_arr[$recv_job]['cpa_recv_ret_amt']+=$ret_amt;
			}
			unset($resultReceive_ret);
			//print_r($receive_ret_arr);
			//booking_type,is_short
			if($poIds!='' || $poIds!=0) $po_cond_for_in=$po_cond_for_in; 
			else $po_cond_for_in="and b.po_break_down_id in(0)";
			
			$sql_wo_aop="select a.id,a.booking_date,a.currency_id,a.item_category,a.booking_no,a.booking_type,a.is_short,b.po_break_down_id as po_id,
			(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.wo_qnty ELSE 0 END) AS wo_qnty,
			(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.amount ELSE 0 END) AS amount
			 from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no  and a.item_category in(2,3,12) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in";
			$result_aop_rate=sql_select( $sql_wo_aop );
			foreach ($result_aop_rate as $row)
			{
				if($row[csf('item_category')]==12)
				{
					$wo_qnty=$row[csf('wo_qnty')];
					$amount=$row[csf('amount')];
					$avg_wo_aop_rate=$amount/$wo_qnty;
					$aop_prod_array[$row[csf('po_id')]]['aop_rate']=$avg_wo_aop_rate;
					$aop_prod_array[$row[csf('po_id')]]['currency_id']=$row[csf('currency_id')];
					$aop_prod_array[$row[csf('po_id')]]['booking_date']=$row[csf('booking_date')];
				}
				else
				{
					$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
					$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
					$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
					$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
				}
			}
			unset($result_aop_rate);
			if($poIds!='' || $poIds!=0) $po_cond_for_in3=$po_cond_for_in3; else $po_cond_for_in3="and b.order_id in(0)";
			
			$sql_aop="select a.company_id, b.batch_issue_qty as issue_qty,b.prod_id,b.order_id as po_id from pro_grey_batch_dtls b,inv_receive_mas_batchroll a where a.id=b.mst_id  and a.entry_form=92  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and b.process_id=35 $po_cond_for_in3";
			$result_aop=sql_select( $sql_aop );
			foreach ($result_aop as $row)
			{
				$aop_rate=$aop_prod_array[$row[csf('po_id')]]['aop_rate'];
				$booking_date=$aop_prod_array[$row[csf('po_id')]]['booking_date'];
				$currency_id=$aop_prod_array[$row[csf('po_id')]]['currency_id'];
				$booking_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($booking_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($booking_date, "d-M-y", "-",1);
				
				$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
				if($currency_id==1) $avg_rate=$aop_rate/$exchange_rate;//TK
				else $avg_rate=$aop_rate;
					
				$aop_amt=$row[csf('issue_qty')]*$avg_rate;
				$aop_prod_array[$row[csf('po_id')]]['aop_amt']+=$aop_amt;
			}
			//print_r($aop_prod_array);
			unset($result_aop);
			$sql_yarn="select c.id,a.requisition_no,a.receive_basis,a.prod_id,(a.cons_amount) as cons_amount,c.issue_basis,c.issue_number,c.booking_no from inv_transaction a, order_wise_pro_details b, inv_issue_master c where  a.id=b.trans_id and  c.id=a.mst_id and c.entry_form in(3) and b.entry_form in(3)  and  a.transaction_type=2 $po_cond_for_in4";
			$result_yarn=sql_select($sql_yarn);
			foreach($result_yarn as $invRow)
			{
				if($invRow[csf('issue_basis')]==1)// Booking
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('booking_no')];
				}
				else if($invRow[csf('issue_basis')]==3)// Requesition
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('requisition_no')];
				}
			}
			
			unset($result_yarn);
				//die;
			if($poIds!='' || $poIds!=0) $po_cond_for_in2=$po_cond_for_in2; 
			else $po_cond_for_in2="and po_id in(0)";
			
			$plan_details_array = return_library_array("select dtls_id, booking_no as booking_no from ppl_planning_entry_plan_dtls where company_id=$company_name $po_cond_for_in2 group by dtls_id,booking_no", "dtls_id", "booking_no");
			//print_r($plan_details_array);
			$reqs_array = array();
			
			$reqs_sql = sql_select("select a.knit_id, a.requisition_no as reqs_no, sum(a.yarn_qnty) as yarn_req_qnty from ppl_planning_entry_plan_dtls b,ppl_yarn_requisition_entry a where b.dtls_id=a.knit_id and b.status_active=1 and b.is_deleted=0 $po_cond_for_in5 group by a.knit_id, a.requisition_no");
			foreach ($reqs_sql as $row)
			{
				$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
			}
			unset($reqs_sql);
			//and b.issue_purpose in(2,4,15,38)
		    $yarnissue_retData="select d.booking_no,a.item_category,b.po_breakdown_id, b.prod_id, a.mst_id,a.receive_basis, b.issue_purpose,c.lot,c.color,d.exchange_rate,
			(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.transaction_date ELSE null END) AS transaction_date,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN b.quantity ELSE 0 END) AS yarn_iss_return_qty,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_amount ELSE 0 END) AS order_amount_ret,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_qnty ELSE 0 END) AS order_qnty_ret
			from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_receive_master d where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id  and d.id=a.mst_id and a.item_category in(1) and a.transaction_type in(4) and b.entry_form in(9) and d.entry_form in(9) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1  $po_cond_for_in4  group by d.booking_no,b.po_breakdown_id, b.prod_id, a.item_category,a.transaction_date,a.receive_basis,a.mst_id,d.exchange_rate,a.transaction_type,b.entry_form,b.trans_type,b.issue_purpose,c.lot,c.color";
			$yarnissueretDataArray=sql_select($yarnissue_retData); $yarnissueRetCostArray=array();
			foreach($yarnissueretDataArray as $invRow)
			{
				$issue_purpose=$invRow[csf('issue_purpose')];
				$receive_basis=$invRow[csf('receive_basis')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				//echo $receive_basis.'ff';
				if($receive_basis==1) //Booking Basis
				{
					$booking_no=$invRow[csf('booking_no')];
				}
				
				else if($receive_basis==3) //Requisition Basis
				{
					$booking_req_no=$invRow[csf('booking_no')];
					$prog_no=$reqs_array[$booking_req_no]['knit_id'];
					$booking_no=$plan_details_array[$prog_no];
					//echo $booking_req_no.'req';
				}
				$booking_type=$booking_array[$booking_no]['btype'];
				$is_short=$booking_array[$booking_no]['is_short'];
				//echo $booking_type.'='.$is_short.'='.$booking_no.'<br>';
				$returnable_ret_qnty=$invRow[csf('returnable_qnty')];
				//echo $invRow[csf('yarn_iss_return_qty')].'<br>';
				 $issue_ret_qty=$invRow[csf('yarn_iss_return_qty')];
				  $order_qnty_ret=$invRow[csf('order_qnty_ret')];
				  $order_amount_ret=$invRow[csf('order_amount_ret')];
				 $avg_rate=$order_amount_ret/$order_qnty_ret;
				//echo $avg_rate.'<br>';
				//$rate='';
				$transaction_date=$invRow[csf('transaction_date')];
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rate;
				//echo $ret_avg_rate= $avg_rate/$conversion_date;
				$currency_id=$receive_curr_array[$invRow[csf('prod_id')]];
				//echo $currency_id.'dddddd';
				if($receive_array[$invRow[csf('prod_id')]]>0)
				{
					//echo $currency_id.'D';
					if($currency_id==1) $rate=$receive_array[$invRow[csf('prod_id')]]/$currency_rate;//Taka
					else $rate=$receive_array[$invRow[csf('prod_id')]];	
				}
				else $rate=$avg_rate_array[$invRow[csf('prod_id')]]/$currency_rate;
				
				$iss_ret_amnt=$issue_ret_qty*$rate;
				$retble_iss_ret_amnt=$returnable_ret_qnty*$rate;
				if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
				{
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) //Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else if($issue_purpose==2) //Yarn Dyeing
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
				}
				else //Short Fabric Booking
				{
					//echo $booking_type.'d';
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) // Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							//echo $iss_amnt.'cpa';
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else  if($issue_purpose==2)
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}	
				}
			}
			unset($yarnissueretDataArray);
				
			$yarnTrimsData="select a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color
					from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)  $po_cond_for_in4 ";
				
			$yarnTrimsDataArray=sql_select($yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
			foreach($yarnTrimsDataArray as $invRow)
			{
				if($invRow[csf('item_category')]==1)
				{
					$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
					$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
					$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['last_exchange_rate'];
					
					if($invRow[csf('receive_basis')]==1)//Booking Basis
					{
						$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
						{
							$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
							$booking_type=1;
							//echo $is_short.'= '.$booking_type.', ';
						}
						else
						{
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
					}
					else if($invRow[csf('receive_basis')]==3) //Requisition Basis
					{
						$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						
						$prog_no=$reqs_array[$booking_req_no]['knit_id'];
						$booking_no=$plan_details_array[$prog_no];
						//echo $booking_no.'='.$prog_no.',';
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
					}
					//$transaction_date='';
				//	$transaction_date=$last_trans_date;
					//if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					//else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					
					//$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
					$exchange_rate=$last_exchange_rate;
					$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
					$avgrate=$issue_rate/$exchange_rate;
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($invRow[csf('entry_form')]==3 && $recv_purpose==16)//recv_purpose==16=Grey Yarn
					{
						if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
							{
								//echo $invRow[csf('mst_id')].'='.$recv_purpose.'='.$is_short.'='.$invRow[csf('quantity')].'-k<br>';
								$iss_amnt=$invRow[csf('quantity')]*$avgrate;
								//echo $iss_amnt.'m';
								$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['yq']+=$invRow[csf('quantity')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_qty_retble']+=$invRow[csf('returnable_qnty')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt_retble']+=$retble_iss_amnt;
							}
						}
						else //Short Fabric Booking
						{
							$iss_amnt=$invRow[csf('quantity')]*$avgrate;
							//echo $is_short.'='.$iss_amnt.'='.$invRow[csf('mst_id')].'<br>';
							$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
							
							if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
							{
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_qty_retble']+=$returnable_qnty;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt_retble']+=$retble_iss_amnt;
							}
						}
					}
				}
				else
				{
					$trimsAmt=0;
					$trimsAmt=$invRow[csf('quantity')]*$invRow[csf('cons_rate')];
					$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]][4]+=$trimsAmt;
				}
			}
			unset($yarnTrimsDataArray);
					
			$sql_garments="select b.po_break_down_id as po_id,b.embel_name,b.production_date,b.production_type,
				(CASE WHEN b.embel_name=1 THEN b.production_quantity ELSE 0 END) AS printing_qty,
				(CASE WHEN b.embel_name=2 THEN b.production_quantity ELSE 0 END) AS embro_qty,
				(CASE WHEN b.embel_name=3 THEN b.production_quantity ELSE 0 END) AS wash_qty,
				(CASE WHEN b.embel_name=5 THEN b.production_quantity ELSE 0 END) AS dyeing_qty
				 from pro_garments_production_mst b where  b.production_type=2    and b.is_deleted=0 and b.status_active=1 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in";
				$result_gar=sql_select( $sql_garments );
				foreach ($result_gar as $row)
				{
					$embl_issue_prod_array[$row[csf('po_id')]]['printing_qty']+=$row[csf('printing_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['embro_qty']+=$row[csf('embro_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['wash_qty']+=$row[csf('wash_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['dyeing_qty']+=$row[csf('dyeing_qty')];
				}
				unset($result_gar);
			
				//print_r($yarnTrimsCostArray);
				$recvIssue_array=array(); 
				$sql_trans="select b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(80,82,81,83,84,13,94) and a.item_category=13 and a.transaction_type in(5,6) and b.trans_type in(5,6) $po_cond_for_in4 group by b.trans_type, b.po_breakdown_id";
				$result_trans=sql_select( $sql_trans );
				foreach ($result_trans as $row)
				{
					$recvIssue_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_trans);
				
				
				$trims_trans_array=array(); 
				
				$sql_trims_inv="select a.transaction_date, a.cons_amount as cons_amount, a.prod_id,b.po_breakdown_id as po_id, b.quantity as qnty,c.exchange_rate, c.currency_id
				  from inv_transaction a, order_wise_pro_details b, inv_receive_master c  where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.entry_form in(24) and a.item_category=4 and a.transaction_type in(1) and b.trans_type in(1) $po_cond_for_in4";
				$result_trims=sql_select( $sql_trims_inv );
				foreach ($result_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					$currency_id=$row[csf('currency_id')];
					$currency_rate=$row[csf('exchange_rate')];
					if($currency_id==2){
						$usd_rate=$currency_rate;
					}
					
					if($currency_id==1){
						$currency_rate=$usd_rate*$currency_rate;
					}elseif($currency_id==2){
						$currency_rate=$usd_rate;
					}else {
						$currency_rate=$currency_rate;
					}
					//if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					//else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					//$currency_rate=set_conversion_rate($currency_id,$conversion_date );
					$amt=0;
					
					$amt=$row[csf('cons_amount')]/$currency_rate;
						//echo $currency_rate.'d';
					$trims_trans_array[$row[csf('po_id')]]['amt']+=$amt;
					
					$last_exchnage_rateArr[$row[csf('prod_id')]]=$row[csf('exchange_rate')];
				}
				unset($result_trims);
				
				$gen_trims_issue_array=array(); 
				 $sql_gen_trims_inv="select b.transaction_date,(b.cons_amount) as cons_amount,b.order_id as po_id,b.prod_id
				  from inv_issue_master  a, inv_transaction b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(21)   and b.transaction_type in(2)   $po_cond_for_in3 ";
				$result_gen_trims=sql_select( $sql_gen_trims_inv );
				foreach ($result_gen_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					//$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['last_exchange_rate'];
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$currency_rate=$last_exchnage_rateArr[$row[csf('prod_id')]];
					$gen_trims_issue_array[$row[csf('po_id')]]['amt']+=$row[csf('cons_amount')]/$currency_rate;
				}
				unset($result_gen_trims);
				//die;
				
				$fin_fab_trans_array=array(); 
				 $sql_fin_trans="select b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty
				  from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15,14) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) $po_cond_for_in4 group by b.trans_type, b.po_breakdown_id";
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
					$fin_fab_trans_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_fin_trans);
				
				if($poIds!='' || $poIds!=0)
				{
					$po_cond_for_in5=$po_cond_for_in5; 
				}
				else
				{
					$po_cond_for_in5="and b.po_id in(0)";
				}
				$batch_trans_array=array(); 
				$sql_batch="select a.id,a.booking_no,batch_weight as batch_weight
				  from  pro_batch_create_mst a,pro_batch_create_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in5 group by a.id,batch_weight,a.booking_no";
				$result_batch=sql_select( $sql_batch );
				foreach ($result_batch as $row)
				{
					$batch_trans_array[$row[csf('id')]]['book']=$row[csf('booking_no')];
					$batch_weight_array[$row[csf('id')]]['batch_weight']=$row[csf('batch_weight')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_batch);
				
				$dye_fin_fab_array=array(); 
				 $sql_fin_trans="select a.receive_date,a.exchange_rate, b.po_breakdown_id,c.mst_id,c.batch_id,c.body_part_id, sum(b.quantity) as finish_qnty
				  from inv_receive_master a,pro_finish_fabric_rcv_dtls c, order_wise_pro_details b where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(7) and a.item_category=2   and b.trans_type in(1) $po_cond_for_in4 group by a.exchange_rate,a.receive_date, b.po_breakdown_id,c.batch_id,c.mst_id,c.body_part_id";
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
						$receive_date=$row[csf('receive_date')];
						$booking_no=$batch_trans_array[$row[csf('batch_id')]]['book'];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
						$batch_weight=$batch_weight_array[$row[csf('batch_id')]]['batch_weight'];
						$dye_finish_charge=$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
						//echo $batch_weight.'kk';
						if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							
							$finish_qnty=$row[csf('finish_qnty')]*$dye_finish_charge;
						}
						else //short Fab. booking 
						{
							$cpa_batch_weight=$batch_weight*$dye_finish_charge;
						}
						//echo $finish_qnty.'='.$cpa_finish_qnty;
						if($db_type==0)
						{
							$conversion_date=change_date_format($receive_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($receive_date, "d-M-y", "-",1);
						}
						//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['fin_amt']=$finish_qnty;
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['cpa_batch_weight']+=$cpa_batch_weight;
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['ex_rate']=$currency_rate;
				}
				unset($result_fin_trans);
				
				$grey_fab_array=array();  //Knitting Cost actual 
				  $sql_grey_trans="select  a.id,a.exchange_rate,a.receive_basis,a.booking_no,a.receive_date,b.po_breakdown_id,c.febric_description_id as deter_id,c.body_part_id, c.kniting_charge,
				 (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
				
				  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(2,13)  and b.trans_type in(1) $po_cond_for_in4";
				$result_grey=sql_select( $sql_grey_trans );
				$currency_id=1;
				foreach ($result_grey as $row)
				{
						$transaction_date=$row[csf('transaction_date')];
						$receive_basis=$row[csf('receive_basis')];
						$exchange_rate=$row[csf('exchange_rate')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($row[csf('receive_date')], "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($row[csf('receive_date')], "d-M-y", "-",1);
						}
						//$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
						$exchange_rate=$exchange_rate;
						if($currency_id==1) //TK
						{
							$knit_charge=$row[csf('kniting_charge')]/$exchange_rate;
							
						}
						else
						{
							$knit_charge=$row[csf('kniting_charge')];
						}
						
						//$knit_charge=$row[csf('kniting_charge')];//$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['knit_charge'];
						//echo $knit_charge.'='.$row[csf('deter_id')].'ff'.$row[csf('po_breakdown_id')];
						if($receive_basis==1) //Booking Basis
						{
							 $booking_no=$row[csf('booking_no')];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							//echo $booking_type.'='.$is_short;
						}
						else if($receive_basis==2) //Knit plan Basis
						{
							 $prog_no=$grey_knit_array[$row[csf('mst_id')]];
							$booking_no=$plan_details_array[$row[csf('booking_no')]];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						else if($receive_basis==4) //Salse Basis
						{
							 $prog_no=$row[csf('booking_no')];
							$booking_no=$plan_details_array[$prog_no];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							
						}
						
						if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							$grey_amt=$row[csf('grey_qnty')]*$knit_charge;
							//$finish_qnty=$row[csf('finish_qnty')];
							//echo $row[csf('grey_qnty')].'*'.$knit_charge.'<br>';
						}

						else //short Fab. booking 
						{
							$cpa_grey_amt=$row[csf('grey_qnty')]*$knit_charge;
							//$cpa_finish_qnty=$row[csf('finish_qnty')];
						}
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
						$currency_rate=$exchange_rate;
					$grey_fab_array[$row[csf('po_breakdown_id')]]['qnty']+=$row[csf('grey_qnty')];
					$grey_fab_array[$row[csf('po_breakdown_id')]]['grey_amt']+=$grey_amt;
					$grey_fab_array[$row[csf('po_breakdown_id')]]['cpa_grey_amt']+=$cpa_grey_amt;
					
				}
				unset($result_grey);
				//print_r($grey_fab_array); 
				$sql_fin_purchase="select c.exchange_rate, b.po_breakdown_id,a.transaction_date, sum(a.cons_rate*b.quantity) as finish_purchase_amnt from inv_transaction a, order_wise_pro_details b,inv_receive_master c where a.id=b.trans_id and c.id=a.mst_id  and a.receive_basis<>9 and a.item_category=2 and a.transaction_type=1 and b.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 group by c.exchange_rate,b.po_breakdown_id,a.transaction_date";
				$dataArrayFinPurchase=sql_select($sql_fin_purchase);
				foreach($dataArrayFinPurchase as $finRow)
				{
					$transaction_date=$finRow[csf('transaction_date')];
					$exchange_rate=$finRow[csf('exchange_rate')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$currency_rate=$exchange_rate;
					$finish_purchase_amnt_arr[$finRow[csf('po_breakdown_id')]]=$finRow[csf('finish_purchase_amnt')]/$currency_rate;
				}
				unset($dataArrayFinPurchase);
				
				$sql_fin_purchase_wv="select b.po_breakdown_id, sum(a.cons_rate*b.quantity) as woven_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.item_category=3 and a.transaction_type=1 and b.entry_form=17 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in4 group by b.po_breakdown_id";
				$dataArrayFinPurchaseW=sql_select($sql_fin_purchase_wv);
				foreach($dataArrayFinPurchaseW as $finRow)
				{
					$po_exchange_rate=$po_exchange_rateArr[$finRow[csf("po_breakdown_id")]]['exchange_rate'];
					$finish_purchase_amnt_arr[$finRow[csf('po_breakdown_id')]]+=$finRow[csf('woven_purchase_amnt')]/$po_exchange_rate;
				}
				unset($dataArrayFinPurchaseW);
				$sql_grey_purchase="select b.po_breakdown_id,a.transaction_date, sum(a.cons_rate*b.quantity) as finish_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.receive_basis<>9 and a.item_category in(13,14) and a.transaction_type=1 and b.entry_form in(22,23) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 group by b.po_breakdown_id,a.transaction_date";
				$dataArraygreyPurchase=sql_select($sql_grey_purchase);
				foreach($dataArraygreyPurchase as $gRow)
				{
					$transaction_date=$gRow[csf('transaction_date')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						$currency_rate=$po_exchange_rateArr[$gRow[csf("po_breakdown_id")]]['exchange_rate'];
						//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$grey_purchase_amnt_arr[$gRow[csf('po_breakdown_id')]]=$gRow[csf('finish_purchase_amnt')]/$currency_rate;
				}
					unset($dataArraygreyPurchase);
					//die;
				 $actualCostArray=array();
				$actualCostDataArray="select cost_head,po_id,sum(amount_usd) as amount_usd from wo_actual_cost_entry where company_id=$company_name and status_active=1 and is_deleted=0 $po_cond_for_in2 group by cost_head,po_id";
				$actual_results=sql_select($actualCostDataArray);
				foreach($actual_results as $actualRow)
				{
				   $actualCostArray[$actualRow[csf('cost_head')]][$actualRow[csf('po_id')]]=$actualRow[csf('amount_usd')];
				}
				unset($actual_results);
				
				$i=1; $tot_po_qnty=0; $tot_po_value=0; $tot_ex_factory_qnty=0; $tot_ex_factory_val=0; $tot_yarn_cost_mkt=0; $tot_knit_cost_mkt=0; $tot_dye_finish_cost_mkt=0; $tot_yarn_dye_cost_mkt=0; $tot_aop_cost_mkt=0; $tot_trims_cost_mkt=0; $tot_embell_cost_mkt=0; $tot_wash_cost_mkt=0; $tot_commission_cost_mkt=0; $tot_comm_cost_mkt=0; $tot_freight_cost_mkt=0; $tot_test_cost_mkt=0; $tot_inspection_cost_mkt=0; $tot_currier_cost_mkt=0; $tot_cm_cost_mkt=0; $tot_mkt_all_cost=0; $tot_mkt_margin=0; $tot_yarn_cost_actual=0; $tot_knit_cost_actual=0; $tot_dye_finish_cost_actual=0; $tot_yarn_dye_cost_actual=0; $tot_aop_cost_actual=0; $tot_trims_cost_actual=0; $tot_embell_cost_actual=0; $tot_wash_cost_actual=0; $tot_commission_cost_actual=0; $tot_comm_cost_actual=0; $tot_freight_cost_actual=0; $tot_test_cost_actual=0; $tot_inspection_cost_actual=0; $tot_currier_cost_actual=0; $tot_cm_cost_actual=0; $tot_actual_all_cost=0; $tot_actual_margin=0; $tot_fabric_purchase_cost_mkt=$total_fabric_cost_mkt=0; $tot_fabric_purchase_cost_actual=$tot_grey_fab_cost_actual=$tot_actual_net_margin=0;
				$tot_print_amount_mkt=$tot_embro_amount_mkt=$tot_dyeing_amount_mkt=$tot_wash_amount_mkt=$tot_print_amount_actual=$tot_embro_amount_actual=$tot_dyeing_amount_actual=$tot_wash_amount_actual=$tot_finished_fab_cost_actual=$tot_fin_fab_transfer_amt_actual=$tot_yarn_dyeing_twist_actual=$tot_grey_fab_transfer_amt_actual=$tot_yarn_qty_actual=$tot_yarn_amt_actual=$tot_grey_fab_cost_mkt=$tot_yarn_value_addition_cost_mkt=$total_fabric_cost=$tot_fabric_cost_actaul=$tot_yarn_qty_cpa_actual=$total_finish_fabric_cost_mkt=$tot_yarn_qty_cpa_actual=0;
				$buyer_name_array=array();
				$mkt_po_val_array = array(); $mkt_yarn_array = array(); $mkt_knit_array = array(); $mkt_dy_fin_array = array(); $mkt_yarn_dy_array = array();
				$mkt_aop_array = array(); $mkt_trims_array = array(); $mkt_emb_array = array(); $mkt_wash_array=array(); $mkt_commn_array=array(); $mkt_commercial_array=array();
				$mkt_freight_array = array(); $mkt_test_array = array(); $mkt_ins_array = array(); $mkt_courier_array = array(); $mkt_cm_array = array();
				$mkt_total_array = array(); $mkt_margin_array = array(); $mkt_fabric_purchase_array = array();
				
				$ex_factory_val_array= array(); $yarn_cost_array= array(); $knit_cost_array= array(); $dye_cost_array= array(); $yarn_dyeing_cost_array= array();
				$aop_n_others_cost_array= array(); $trims_cost_array= array(); $enbellishment_cost_array= array(); $wash_cost_array= array(); $commission_cost_array= array(); 
				$commercial_cost_array= array(); $freight_cost_array= array(); $testing_cost_array= array(); $inspection_cost_array= array(); $courier_cost_array= array();
				$cm_cost_array= array(); $total_cost_array= array(); $margin_array= array(); $ex_factory_array=array(); $actual_cm_amnt=array(); $actual_fabric_purchase_array = array();
								
				 $condition= new condition();
				 $condition->company_name("=$company_name");
				 if(str_replace("'","",$cbo_buyer_name)>0){
					  $condition->buyer_name("=$cbo_buyer_name");
				 }
				 if(str_replace("'","",$txt_file_no) !=''){
					  $condition->file_no("='$txt_file_no'");
				 }
				 if(str_replace("'","",$txt_ref_no) !=''){
					  $condition->grouping("='$txt_ref_no'");
				 }
				 
				 if(str_replace("'","",$txt_job_no) !=''){
					  $condition->job_no_prefix_num("=$txt_job_no");
				 }
				if(trim(str_replace("'","",$txt_order_no))!='')
				 {
					//$condition->po_number(" like '%".trim(str_replace("'","",$txt_order_no))."%'"); 
					$condition->po_number("='".trim(str_replace("'","",$txt_order_no))."'"); 
				 }
				 if(str_replace("'","",$txt_date_from)!='' && str_replace("'","",$txt_date_to)!='')
				 {
					 $start_date=str_replace("'","",$txt_date_from);
					 $end_date=str_replace("'","",$txt_date_to);
					 $condition->pub_shipment_date(" between '$start_date' and '$end_date'");
					 //and b.po_received_date between '$start_date' and '$end_date' 
					// echo 'FFGG';
				 }
				 
				 $condition->init();
				
				 $yarn= new yarn($condition);
				//echo $yarn->getQuery();die;
				 $yarn_costing_arr=$yarn->getOrderWiseYarnAmountArray();
				 $yarn= new yarn($condition);
				 $yarn_costing_qty_arr=$yarn->getOrderWiseYarnQtyArray();
				 $conversion= new conversion($condition);
				 $conversion_costing_arr_process=$conversion->getAmountArray_by_orderAndProcess(); 
				  $conversion= new conversion($condition);
				 $conversion_costing_arr_process_qty=$conversion->getQtyArray_by_orderAndProcess();
				 $trims= new trims($condition);
				 $trims_costing_arr=$trims->getAmountArray_by_order();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name=$emblishment->getAmountArray_by_orderAndEmbname();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name_qty=$emblishment->getQtyArray_by_orderAndEmbname();
				$commission= new commision($condition);
				$commission_costing_arr=$commission->getAmountArray_by_orderAndItemid();
				$commercial= new commercial($condition);
				$commercial_costing_arr=$commercial->getAmountArray_by_order();
				$other= new other($condition);
				$other_costing_arr=$other->getAmountArray_by_order();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash=$wash->getAmountArray_by_orderAndEmbname();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash_qty=$wash->getQtyArray_by_orderAndEmbname();
				$fabric= new fabric($condition);
				 //echo $fabric->getQuery();
				$fabric_costing_arr=$fabric->getAmountArray_by_order_knitAndwoven_greyAndfinish();
				$usd_id=2;//===============Dollar========
				//print_r($fabric_costing_arr);die;
				$not_yarn_dyed_cost_arr=array(1,2,30,134,35);$job_ids='';
				$tot_certificate_cost_mkt=$tot_deffdlc_cost_mkt=$tot_design_cost_mkt=$tot_studio_cost_mkt=$tot_operating_exp_mkt=$tot_interest_cost_mkt=$tot_incometax_cost_mkt=$tot_depr_amor_pre_cost_mkt=0;
				foreach($result as $row)
				{
					if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					
					$po_ids_array[]=$row[csf('id')];
					 $job_ids.=$row[csf('job_no')].',';
					$gmts_item='';
					$gmts_item_id=explode(",",$row[csf('gmts_item_id')]);
					foreach($gmts_item_id as $item_id)
					{
						if($gmts_item=="") $gmts_item=$garments_item[$item_id]; else $gmts_item.=",".$garments_item[$item_id];
					}
					
					$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
					$plan_cut_qnty=$row[csf('plan_cut')]*$row[csf('ratio')];
					$unit_price=$row[csf('unit_price')]/$row[csf('ratio')];
					$po_value=$order_qnty_in_pcs*$unit_price;
					
					$tot_po_qnty+=$order_qnty_in_pcs; 
					$tot_po_value+=$po_value;
					//echo "DDD";die;
					$ex_factory_qty=$ex_factory_arr[$row[csf('id')]];
					$ex_factory_value=$ex_factory_qty*$unit_price;
					
					$tot_ex_factory_qnty+=$ex_factory_qty; 
					$tot_ex_factory_val+=$ex_factory_value; 
					
					$dzn_qnty=0;
					$costing_per_id=$fabriccostArray[$row[csf('job_no')]]['costing_per_id'];
					if($costing_per_id==1) $dzn_qnty=12;
					else if($costing_per_id==3) $dzn_qnty=12*2;
					else if($costing_per_id==4) $dzn_qnty=12*3;
					else if($costing_per_id==5) $dzn_qnty=12*4;
					else $dzn_qnty=1;

					$dzn_qnty=$dzn_qnty*$row[csf('ratio')];
					$yarn_cost_mkt=$yarn_costing_arr[$row[csf('id')]];
					 $yarn_cost_mkt_qty=$yarn_costing_qty_arr[$row[csf('id')]];
					$knit_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][1]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['knit_charge'];
					$knit_qty_mkt=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][1]);
					$yarn_dyeing_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][30]);
					//if($yarn_dyeing_cost_mkt) $yarn_dyeing_cost_mkt=$yarn_dyeing_cost_mkt;else $yarn_dyeing_cost_mkt=0;
					$twisting_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][134]);
					//if($twisting_cost_mkt) $twisting_cost_mkt=$twisting_cost_mkt;else $twisting_cost_mkt=0;
					$yarn_value_addition_cost_mkt=$yarn_dyeing_cost_mkt+$twisting_cost_mkt;
					//echo $yarn_dyeing_cost_mkt.'=='.$twisting_cost_mkt.', ';
					
					if($knit_cost_mkt>0)
					{
					$knit_charge_mkt=$knit_cost_mkt/$knit_qty_mkt;//$dye_finish_cost_mkt_qty
					}
					
					$dye_finish_cost_mkt=0;$dye_finish_cost_mkt_qty=0;
					foreach($conversion_cost_head_array as $process_id=>$val)
					{
						if(!in_array($process_id,$not_yarn_dyed_cost_arr))
						{
							$dye_finish_cost_mkt+=array_sum($conversion_costing_arr_process[$row[csf('id')]][$process_id]);
							
							$dye_finish_cost_mkt_qty+=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][$process_id]);
						}
					}	
					if($dye_finish_cost_mkt>0)
					{			
					$knit_charge_mkt_fin=$dye_finish_cost_mkt/$dye_finish_cost_mkt_qty;
					}
					//echo $dye_finish_cost_mkt.'='.$dye_finish_cost_mkt_qty;
					//$yarn_dye_cost_mkt=$conversion_costing_arr_process[$row[csf('id')]][30];
					$aop_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][35]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['aop_charge'];
					$trims_cost_mkt=$trims_costing_arr[$row[csf('id')]];//($order_qnty_in_pcs/$dzn_qnty)*$trimsCostArray[$row[csf('id')]];
				
					
					$print_amount=$emblishment_costing_arr_name[$row[csf('id')]][1];
					$print_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][1];
					if($print_amount) $print_amount=$print_amount;else $print_amount=0;
					if($print_qty) $print_qty=$print_qty;else $print_qty=0;
					if($print_amount==0 || $print_qty==0) $print_avg_rate=0;
					else $print_avg_rate=$print_amount/$print_qty;
						
					$embroidery_amount=$emblishment_costing_arr_name[$row[csf('id')]][2];
					$embroidery_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][2];
					if($embroidery_amount) $embroidery_amount=$embroidery_amount;else $embroidery_amount=0;
					if($embroidery_qty) $embroidery_qty=$embroidery_qty;else $embroidery_qty=0;
					if($embroidery_amount==0 || $embroidery_qty==0) $embro_avg_rate=0;
					else $embro_avg_rate=$embroidery_amount/$embroidery_qty;
					//$special_amount=$emblishment_costing_arr_name[$row[csf('id')]][4];
					$wash_cost=$emblishment_costing_arr_name_wash[$row[csf('id')]][3];
					$wash_qty=$emblishment_costing_arr_name_wash_qty[$row[csf('id')]][3];
					if($wash_cost) $wash_cost=$wash_cost;else $wash_cost=0;
					if($wash_qty) $wash_qty=$wash_qty;else $wash_qty=0;
					if($wash_cost==0 || $wash_qty==0) $wash_avg_rate=0;
					else $wash_avg_rate=$wash_cost/$wash_qty;
					
					$other_amount=$emblishment_costing_arr_name[$row[csf('id')]][5];
					$dyeing_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][5];
					if($other_amount) $other_amount=$other_amount;else $other_amount=0;
					if($dyeing_qty) $dyeing_qty=$dyeing_qty;else $dyeing_qty=0;
					if($other_amount==0 || $dyeing_qty==0) $dyeing_avg_rate=0;
					else $dyeing_avg_rate=$other_amount/$dyeing_qty;
					
					$foreign_cost=$commission_costing_arr[$row[csf('id')]][1];
					$local_cost=$commission_costing_arr[$row[csf('id')]][2];
					
					$test_cost=$other_costing_arr[$row[csf('id')]]['lab_test'];
					$freight_cost=$other_costing_arr[$row[csf('id')]]['freight'];
					$inspection_cost=$other_costing_arr[$row[csf('id')]]['inspection'];
				
					$certificate_cost_mkt=$other_costing_arr[$row[csf('id')]]['certificate_pre_cost'];
					$deffdlc_cost_mkt=$other_costing_arr[$row[csf('id')]]['deffdlc_cost'];
					$design_cost_mkt=$other_costing_arr[$row[csf('id')]]['design_cost'];
					$studio_cost_mkt=$other_costing_arr[$row[csf('id')]]['studio_cost'];
					$operating_exp_mkt=$other_costing_arr[$row[csf('id')]]['common_oh'];
					$interest_cost_mkt=$other_costing_arr[$row[csf('id')]]['interest_cost'];
					$incometax_cost_mkt=$other_costing_arr[$row[csf('id')]]['incometax_cost'];
					$depr_amor_pre_cost_mkt=$other_costing_arr[$row[csf('id')]]['depr_amor_pre_cost'];
					
					
					//$common_oh_cost=$other_costing_arr[$row[csf('id')]]['common_oh'];
					$currier_cost=$other_costing_arr[$row[csf('id')]]['currier_pre_cost'];
					$cm_cost=$other_costing_arr[$row[csf('id')]]['cm_cost'];
					$embell_cost_mkt=$print_amount+$embroidery_amount+$wash_cost+$other_amount;
					
					$wash_cost_mkt=$wash_cost;
					$commission_cost_mkt=$foreign_cost+$local_cost;
					$comm_cost_mkt=$commercial_costing_arr[$row[csf('id')]];
					$freight_cost_mkt=$freight_cost;
					$test_cost_mkt=$test_cost;
					$inspection_cost_mkt=$inspection_cost;
					$currier_cost_mkt=$currier_cost;
					$cm_cost_mkt=$cm_cost;
						//echo "MM";die;
					
					$fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['grey'][$row[csf('id')]]);
					//+array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
					$fabric_purchase_cost2=array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
					$fabric_purchase_cost_mkt=$fabric_purchase_cost+$fabric_purchase_cost2;
					$finish_fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
					$finish_fabric_purchase_cost_mkt=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
					$grey_fab_cost_mkt=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt;
					$mkt_all_cost=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt+$trims_cost_mkt+$embell_cost_mkt+$wash_cost_mkt+$commission_cost_mkt+$comm_cost_mkt+$freight_cost_mkt+$test_cost_mkt+$inspection_cost_mkt+$currier_cost_mkt+$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt+$cm_cost_mkt+$fabric_purchase_cost_mkt;
					
					$mkt_margin=$po_value-$mkt_all_cost;
					$mkt_margin_perc=($mkt_margin/$po_value)*100;
					$tot_finish_fabric_cost_mkt=$grey_fab_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt;
					
					//$yarn_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$yarncostArray[$row[csf('job_no')]];
					//$knit_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['knit_charge'];
					//$dye_finish_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['dye_finish_charge'];
					//$yarn_dye_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['yarn_dye_charge'];
					//$aop_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['aop_charge'];
					//$trims_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$trimsCostArray[$row[csf('id')]];
					$grey_prod_ex_rate=$grey_fab_array[$row[csf('id')]]['ex_rate'];
					$dye_fin_ex_rate=$dye_fin_fab_array[$row[csf('id')]]['ex_rate'];
					
					//$fin_fab_prod_qnty=$grey_fab_array[$row[csf('id')]]['fin_qnty'];
					//echo $grey_fab_array[$row[csf('id')]]['qnty'].'*'.$knit_charge_mkt.'/'.$grey_prod_ex_rate;
					if($process_costing==1)
					{
						$grey_prod_cost=$grey_fab_array[$row[csf('id')]]['qnty']*$knit_charge_mkt;
					}
					else
					{
						$grey_prod_cost=$grey_fab_array[$row[csf('id')]]['grey_amt'];
					}
					$knit_cost_actual=$grey_prod_cost;
					
					$cpa_grey_prod_cost=$grey_fab_array[$row[csf('id')]]['cpa_grey_amt'];
					$cpa_knit_cost_actual=$cpa_grey_prod_cost;
					// echo $dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'].'/'.$knit_charge_mkt_fin.'=='.$dye_fin_ex_rate.', ';
					$cpa_dye_fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'];
					 $cpa_dye_finish_cost_actual=$cpa_dye_fin_fab_prod_cost;
					
					$fin_fab_prod_cost=$grey_used_arr[$row[csf('id')]]['grey_used_amt']+$fin_grey_used_arr[$row[csf('id')]]['grey_used_amt'];//$dye_fin_fab_array[$row[csf('id')]]['fin_amt'];
					$dye_finish_cost_actual=$fin_fab_prod_cost;
					
					$cpa_recv_ret_amt=$receive_ret_arr[$row[csf('job_no')]]['cpa_recv_ret_amt'];
					$cpa_yarn_recv_amt_bal=$yarn_receive_amount_arr[$row[csf('job_no')]]['cpa_order_amount_recv']-$cpa_recv_ret_amt;
					if($cpa_yarn_recv_amt_bal==0) $cpa_yarn_recv_amt_bal_actual=0;
					else $cpa_yarn_recv_amt_bal_actual=($cpa_yarn_recv_amt_bal/$job_quantity)*$order_qnty_in_pcs;
					
					
					//$cpa_yarn_recv_amt_bal_actual=($cpa_yarn_recv_amt_bal/$job_quantity)*$order_qnty_in_pcs;
					
					//echo  $yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt'].'='.$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt'].'='.$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt'].'='.$cpa_knit_cost_actual.'='.$cpa_dye_finish_cost_actual.',';
					$yarn_cost_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt']+$cpa_yarn_recv_amt_bal_actual+$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt']+$cpa_knit_cost_actual+$cpa_dye_finish_cost_actual-($yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_yarn_ret_amt']+$yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_ret_amt']);
					//$yarn_dyeing_twist_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt'];
					$yarn_ret_qty_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_qty_retble'];
					$yarn_ret_amt_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt_retble'];
					$tot_yarn_qty_cpa_actual+=$yarn_cost_cpa_actual;
					//$tot_yarn_amt_cpa_actual+=$yarn_ret_qty_cpa_actual;
					//echo $yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt'].'-'.$yarnissueRetCostArray[$row[csf('id')]]['grey_yarn_ret_amt'].'n';
					$yarn_cost_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt']-$yarnissueRetCostArray[$row[csf('id')]]['grey_yarn_ret_amt'];
					//echo $yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt'].'D';
					$yarn_ret_qty_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_qty_retble'];
					$yarn_ret_amt_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt_retble'];
					$tot_yarn_qty_actual+=$yarn_ret_qty_actual;
					$tot_yarn_amt_actual+=$yarn_ret_amt_actual;
					$job_quantity=$job_arr2[$row[csf("job_no")]]['job_quantity'];
					
					
					//echo $order_amount_recv_ret.', ';
					//$yarn_receive_amount_arr[$jobNo]['cpa_order_amount_recv']; 
					$order_amount_recv=$yarn_receive_amount_arr[$row[csf('job_no')]]['order_amount_recv'];
					$order_amount_recv_ret=$receive_ret_arr[$row[csf('job_no')]]['recv_ret_amt'];
					
					
					
					//echo $cpa_yarn_recv_amt_bal_actual.'/'.$job_quantity.'*'.$order_qnty_in_pcs.', ';
					$order_amount_recv_bal=$order_amount_recv-$order_amount_recv_ret;
					$avg_recv_amount_actual=($order_amount_recv_bal/$job_quantity)*$order_qnty_in_pcs;

					$yarn_dyeing_twist_actual=$avg_recv_amount_actual;//-$yarnissueRetCostArray[$row[csf('id')]]['grey_dyeing_twist_ret_amt'];
					
					
					$trans_in_amt=$recvIssue_array[$row[csf('id')]][5];
				    $trans_out_amt=$recvIssue_array[$row[csf('id')]][6];
					
					$fin_trans_in_amt=$fin_fab_trans_array[$row[csf('id')]][5];
				    $fin_trans_out_amt=$fin_fab_trans_array[$row[csf('id')]][6];
					
					$grey_fab_transfer=$trans_in_amt-$trans_out_amt;
					//echo $grey_fab_transfer.'D';
					$grey_fab_transfer_amt_actual=$grey_fab_transfer*$knit_charge_mkt;
					
					$fin_fab_transfer=$fin_trans_in_amt-$fin_trans_out_amt;
					//echo $fin_fab_transfer.'='.$knit_charge_mkt_fin;
					$fin_fab_transfer_amt_actual=$fin_fab_transfer*$knit_charge_mkt_fin;
					
					//echo $yarn_cost_actual.'<br>';
					//$trims_cost_actual=$yarnTrimsCostArray[$row[csf('id')]][4]/$exchange_rate;
					$trims_amount=$trims_trans_array[$row[csf('id')]]['amt'];
					$gen_trims_issue_amt=$gen_trims_issue_array[$row[csf('id')]]['amt'];
					$trims_cost_actual=$trims_amount+$gen_trims_issue_amt;
					//echo $trims_amount.'='.$gen_trims_issue_amt;
					$yarn_dye_cost_actual=0;
					$aop_prod_amt=$aop_prod_array[$row[csf('id')]]['aop_amt'];
					//$aop_avg_rate=$aop_prod_array[$row[csf('id')]]['aop_rate'];
					//echo $aop_prod_qty.'='.$aop_avg_rate;
					$aop_cost_actual=$aop_prod_amt;
					$embell_cost_actual=$embellCostArray[$row[csf('id')]];
					$wash_cost_actual=$washCostArray[$row[csf('id')]];
					
					//Finished Fabric Cost
					
					
					$printing_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['printing_qty']/$dzn_qnty)*$print_avg_rate;
					//echo $embl_issue_prod_array[$row[csf('id')]]['printing_qty'].'*'.$print_avg_rate;
					$embro_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['embro_qty']/$dzn_qnty)*$embro_avg_rate;
					$dyeing_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['dyeing_qty']/$dzn_qnty)*$dyeing_avg_rate;
					$wash_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['wash_qty']/$dzn_qnty)*$wash_avg_rate;
					
					$commission_cost_actual=($ex_factory_qty/$dzn_qnty)*$fabriccostArray[$row[csf('job_no')]]['commission'];
					$comm_cost_actual=$actualCostArray[6][$row[csf('id')]];
					$freight_cost_actual=$actualCostArray[2][$row[csf('id')]];
					$test_cost_actual=$actualCostArray[1][$row[csf('id')]];
					$inspection_cost_actual=$actualCostArray[3][$row[csf('id')]];
					$currier_cost_actual=$actualCostArray[4][$row[csf('id')]];
					
				//	$cm_cost_actual=$actualCostArray[5][$row[csf('id')]];
					$working_hour=$prod_resource_array[$row[csf('id')]]['working_hour'];
					$operator_helper=$prod_resource_array[$row[csf('id')]]['operator_helper'];
					$extra_working_hour=$adj_resource_array[$row[csf('style_ref_no')]]['working_hour'];
					$extra_number_of_emp=$adj_resource_array[$row[csf('style_ref_no')]]['number_of_emp'];
					$tot_number_of_employee=$operator_helper+$extra_number_of_emp;
					$tot_working_hr=$working_hour+$extra_working_hour;
					$prod_date=$prod_resource_array[$row[csf('id')]]['pr_date']; 
					$from_cpm_date=date("Y-m",strtotime(($prod_date)));
					$cpm=$lib_cpm_array[$from_cpm_date]['cpm'];
					//$exchange_rate=set_conversion_rate($usd_id,$prod_date );
					$exchange_rate=$prod_resource_array[$row[csf('id')]]['ex_rate'];
				
					//$cm_cost_actual=$tot_working_hr*60*$cpm;
					//echo $working_hour.'='.$extra_number_of_emp.'ds';
					$cm_cost_actual=($tot_working_hr*60*$tot_number_of_employee*$cpm)/$exchange_rate;
					
					$fabric_purchase_cost_actual=$finish_purchase_amnt_arr[$row[csf('id')]];
					$grey_fabric_purchase_cost_actual=$grey_purchase_amnt_arr[$row[csf('id')]];
					$grey_fab_cost_actual=$yarn_cost_actual+$yarn_dyeing_twist_actual+$knit_cost_actual+$grey_fab_transfer_amt_actual;
					$finished_fab_cost_actual=$grey_fab_cost_actual+$dye_finish_cost_actual+$aop_cost_actual+$fin_fab_transfer_amt_actual+$fabric_purchase_cost_actual;
					$tot_fabric_cost_act=$fabric_purchase_cost_actual+$finished_fab_cost_actual;
					$tot_fabric_cost_actaul+=$tot_fabric_cost_act;
					//$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt
					$actual_all_cost=$yarn_cost_actual+$knit_cost_actual+$yarn_dyeing_twist_actual+$grey_fab_transfer_amt_actual+$dye_finish_cost_actual+$yarn_dye_cost_actual+$aop_cost_actual+$trims_cost_actual+$printing_cost_actual+$embro_cost_actual+$dyeing_cost_actual+$wash_cost_actual+$commission_cost_actual+$comm_cost_actual+$freight_cost_actual+$test_cost_actual+$inspection_cost_actual+$currier_cost_actual+$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt+$cm_cost_actual+$fabric_purchase_cost_actual+$grey_fabric_purchase_cost_actual;
					
					$actual_margin=$ex_factory_value-$actual_all_cost;
					$actual_margin_perc=($actual_margin/$ex_factory_value)*100;
					$tot_fabric_cost_mkt=$tot_finish_fabric_cost_mkt+$fabric_purchase_cost_mkt;
					$tot_yarn_cost_mkt+=$yarn_cost_mkt;
					$tot_yarn_value_addition_cost_mkt+=$yarn_value_addition_cost_mkt;
					$tot_grey_fab_cost_mkt+=$grey_fab_cost_mkt; 
					$tot_knit_cost_mkt+=$knit_cost_mkt; 
					$tot_dye_finish_cost_mkt+=$dye_finish_cost_mkt; 
					//$tot_yarn_dye_cost_mkt+=$yarn_dye_cost_mkt; 
					$tot_aop_cost_mkt+=$aop_cost_mkt; 
					$total_fabric_cost_mkt+=$tot_fabric_cost_mkt;
					$tot_trims_cost_mkt+=$trims_cost_mkt;
					 $total_finish_fabric_cost_mkt+=$tot_finish_fabric_cost_mkt;
					$tot_print_amount_mkt+=$print_amount; 
					$tot_embro_amount_mkt+=$embroidery_amount; 
					$tot_dyeing_amount_mkt+=$other_amount; 
					$tot_wash_amount_mkt+=$wash_cost; 
					
					$tot_embell_cost_mkt+=$embell_cost_mkt; 
					$tot_wash_cost_mkt+=$wash_cost_mkt; 
					$tot_commission_cost_mkt+=$commission_cost_mkt; 
					$tot_comm_cost_mkt+=$comm_cost_mkt; 
					$tot_freight_cost_mkt+=$freight_cost_mkt; 
					$tot_test_cost_mkt+=$test_cost_mkt; 
					$tot_inspection_cost_mkt+=$inspection_cost_mkt; 
					$tot_currier_cost_mkt+=$currier_cost_mkt; 
					//$tot_certificate_cost_mkt=$tot_deffdlc_cost_mkt=$tot_design_cost_mkt=$tot_studio_cost_mkt=$tot_operating_exp_mkt=$tot_interest_cost_mkt=$tot_incometax_cost_mkt=$tot_depr_amor_pre_cost_mkt=0;
					$tot_certificate_cost_mkt+=$certificate_cost_mkt; 
					$tot_deffdlc_cost_mkt+=$deffdlc_cost_mkt; 
					$tot_design_cost_mkt+=$design_cost_mkt; 
					$tot_studio_cost_mkt+=$studio_cost_mkt; 
					$tot_operating_exp_mkt+=$operating_exp_mkt; 
					$tot_interest_cost_mkt+=$interest_cost_mkt; 
					$tot_incometax_cost_mkt+=$incometax_cost_mkt; 
					$tot_depr_amor_pre_cost_mkt+=$depr_amor_pre_cost_mkt; 
					
					
					//$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt
					
					$tot_cm_cost_mkt+=$cm_cost_mkt; 
					$tot_mkt_all_cost+=$mkt_all_cost; 
					$tot_mkt_margin+=$mkt_margin; 
					$tot_yarn_cost_actual+=$yarn_cost_actual; 
					$tot_yarn_dyeing_twist_actual+=$yarn_dyeing_twist_actual; 
					$tot_knit_cost_actual+=$knit_cost_actual; 
					$tot_dye_finish_cost_actual+=$dye_finish_cost_actual;
					$tot_yarn_dye_cost_actual+=$yarn_dye_cost_actual; 
					$tot_aop_cost_actual+=$aop_cost_actual; 
					$tot_trims_cost_actual+=$trims_cost_actual; 
					$tot_grey_fab_cost_actual+=$grey_fab_cost_actual; 
					$tot_grey_fab_transfer_amt_actual+=$grey_fab_transfer_amt_actual; 
					$tot_print_amount_actual+=$printing_cost_actual; 
					$tot_embro_amount_actual+=$embro_cost_actual; 
					$tot_dyeing_amount_actual+=$dyeing_cost_actual; 
					$tot_wash_amount_actual+=$wash_cost_actual; 
					$tot_finished_fab_cost_actual+=$finished_fab_cost_actual;
					$tot_fin_fab_transfer_amt_actual+=$fin_fab_transfer_amt_actual;
					$tot_embell_cost_actual+=$embell_cost_actual;
					$tot_wash_cost_actual+=$wash_cost_actual; 
					$tot_commission_cost_actual+=$commission_cost_actual; 
					$tot_comm_cost_actual+=$comm_cost_actual; 
					$tot_freight_cost_actual+=$freight_cost_actual; 
					$tot_test_cost_actual+=$test_cost_actual; 
					$tot_inspection_cost_actual+=$inspection_cost_actual; 
					$tot_currier_cost_actual+=$currier_cost_actual; 
					
				    $tot_certificate_cost_actual+=$certificate_cost_mkt; 
					$tot_deffdlc_cost_actual+=$deffdlc_cost_mkt; 
					$tot_design_cost_actual+=$design_cost_mkt; 
					$tot_studio_cost_actual+=$studio_cost_mkt; 
					$tot_operating_exp_actual+=$operating_exp_mkt; 
					$tot_interest_cost_actual+=$interest_cost_mkt; 
					$tot_incometax_cost_actual+=$incometax_cost_mkt; 
					$tot_depr_amor_pre_cost_actual+=$depr_amor_pre_cost_mkt; 
					
					$tot_cm_cost_actual+=$cm_cost_actual; 
					$tot_actual_all_cost+=$actual_all_cost; 
					$tot_actual_margin+=$actual_margin;
					$tot_actual_net_margin+=$actual_margin-$yarn_cost_cpa_actual; 
					
					$tot_fabric_purchase_cost_mkt+=$fabric_purchase_cost_mkt;
					$tot_fabric_purchase_cost_actual+=$fabric_purchase_cost_actual;
					$tot_grey_fabric_purchase_cost_actual+=$grey_fabric_purchase_cost_actual;
					
					$buyer_name_array[$row[csf('buyer_name')]]=$buyer_arr[$row[csf('buyer_name')]];
					$mkt_po_val_array[$row[csf('buyer_name')]]+=$po_value;
					$mkt_yarn_array[$row[csf('buyer_name')]]+=$yarn_cost_mkt;
					
					$mkt_knit_array[$row[csf('buyer_name')]]+=$knit_cost_mkt;
					$mkt_yarn_value_addition_array[$row[csf('buyer_name')]]+=$yarn_value_addition_cost_mkt;
					$mkt_dy_fin_array[$row[csf('buyer_name')]]+=$dye_finish_cost_mkt;
					$mkt_grey_fab_cost_array[$row[csf('buyer_name')]]+=$grey_fab_cost_mkt;
					$mkt_aop_array[$row[csf('buyer_name')]]+=$aop_cost_mkt;
					$mkt_trims_array[$row[csf('buyer_name')]]+=$trims_cost_mkt;
					$mkt_print_array[$row[csf('buyer_name')]]+=$print_amount;
					$mkt_embro_array[$row[csf('buyer_name')]]+=$embroidery_amount;
					$mkt_dyeing_array[$row[csf('buyer_name')]]+=$other_amount;
					//$mkt_wash_array[$row[csf('buyer_name')]]+=$wash_cost;
					
					$mkt_emb_array[$row[csf('buyer_name')]]+=$embell_cost_mkt;
					$mkt_wash_array[$row[csf('buyer_name')]]+=$wash_cost_mkt;
					$mkt_commn_array[$row[csf('buyer_name')]]+=$commission_cost_mkt;
					$mkt_commercial_array[$row[csf('buyer_name')]]+=$comm_cost_mkt;
					$mkt_freight_array[$row[csf('buyer_name')]]+=$freight_cost_mkt;
					$mkt_test_array[$row[csf('buyer_name')]]+=$test_cost_mkt;
					$mkt_ins_array[$row[csf('buyer_name')]]+=$inspection_cost_mkt;
					$mkt_courier_array[$row[csf('buyer_name')]]+=$currier_cost_mkt;
					
					$mkt_certificate_array[$row[csf('buyer_name')]]+=$certificate_cost_mkt;
					$mkt_deffdlc_array[$row[csf('buyer_name')]]+=$deffdlc_cost_mkt;
					$mkt_design_array[$row[csf('buyer_name')]]+=$design_cost_mkt;
					$mkt_studio_array[$row[csf('buyer_name')]]+=$studio_cost_mkt;
					$mkt_operating_array[$row[csf('buyer_name')]]+=$operating_exp_mkt;
					$mkt_interest_array[$row[csf('buyer_name')]]+=$interest_cost_mkt;
					$mkt_incometax_array[$row[csf('buyer_name')]]+=$incometax_cost_mkt;
					$mkt_depr_amor_array[$row[csf('buyer_name')]]+=$depr_amor_pre_cost_mkt;
						
					
					$mkt_cm_array[$row[csf('buyer_name')]]+=$cm_cost_mkt;
					$mkt_total_array[$row[csf('buyer_name')]]+=$mkt_all_cost;
					$mkt_margin_array[$row[csf('buyer_name')]]+=$mkt_margin;
					$mkt_fabric_purchase_array[$row[csf('buyer_name')]]+=$fabric_purchase_cost_mkt;
					$mkt_fin_fabric_purchase_array[$row[csf('buyer_name')]]+=$finish_fabric_purchase_cost_mkt;
						
					$ex_factory_val_array[$row[csf('buyer_name')]]+=$ex_factory_value;
					$yarn_cost_array[$row[csf('buyer_name')]]+=$yarn_cost_actual;
					$yarn_dyeing_twist_array[$row[csf('buyer_name')]]+=$yarn_dyeing_twist_actual;
					$knit_cost_array[$row[csf('buyer_name')]]+=$knit_cost_actual;
					$dye_cost_array[$row[csf('buyer_name')]]+=$dye_finish_cost_actual;
					$grey_fab_cost_array[$row[csf('buyer_name')]]+=$grey_fab_cost_actual;
					$fin_fab_transfer_amt_actual_array[$row[csf('buyer_name')]]+=$fin_fab_transfer_amt_actual;
					$finished_fab_cost_actual_array[$row[csf('buyer_name')]]+=$finished_fab_cost_actual;
				
					$aop_n_others_cost_array[$row[csf('buyer_name')]]+=$aop_cost_actual;
					$trims_cost_array[$row[csf('buyer_name')]]+=$trims_cost_actual;
					
					$print_act_cost_array[$row[csf('buyer_name')]]+=$printing_cost_actual;
					$embro_act_cost_array[$row[csf('buyer_name')]]+=$embro_cost_actual;
					$dyeing_act_cost_array[$row[csf('buyer_name')]]+=$dyeing_cost_actual;
					$wash_act_cost_array[$row[csf('buyer_name')]]+=$wash_cost_actual;
					
					$enbellishment_cost_array[$row[csf('buyer_name')]]+=$embell_cost_actual;
					$wash_cost_array[$row[csf('buyer_name')]]+=$wash_cost_actual;
					$commission_cost_array[$row[csf('buyer_name')]]+=$commission_cost_actual;
					$commercial_cost_array[$row[csf('buyer_name')]]+=$comm_cost_actual;
					$freight_cost_array[$row[csf('buyer_name')]]+=$freight_cost_actual;
					$testing_cost_array[$row[csf('buyer_name')]]+=$test_cost_actual;
					$inspection_cost_array[$row[csf('buyer_name')]]+=$inspection_cost_actual;
					$courier_cost_array[$row[csf('buyer_name')]]+=$currier_cost_actual;
					
					$acl_certificate_array[$row[csf('buyer_name')]]+=$certificate_cost_mkt;
					$acl_deffdlc_array[$row[csf('buyer_name')]]+=$deffdlc_cost_mkt;
					$acl_design_array[$row[csf('buyer_name')]]+=$design_cost_mkt;
					$acl_studio_array[$row[csf('buyer_name')]]+=$studio_cost_mkt;
					$acl_operating_array[$row[csf('buyer_name')]]+=$operating_exp_mkt;
					$acl_interest_array[$row[csf('buyer_name')]]+=$interest_cost_mkt;
					$acl_incometax_array[$row[csf('buyer_name')]]+=$incometax_cost_mkt;
					$acl_depr_amor_array[$row[csf('buyer_name')]]+=$depr_amor_pre_cost_mkt;
					
					
					
					$cm_cost_array[$row[csf('buyer_name')]]+=$cm_cost_actual;
					$total_cost_array[$row[csf('buyer_name')]]+=$actual_all_cost;
					$margin_array[$row[csf('buyer_name')]]+=$actual_margin;
					$actual_fabric_purchase_array[$row[csf('buyer_name')]]+=$fabric_purchase_cost_actual;
					
					
					 
					 
				//$prod_resource_array[$val[csf('po_id')]]['pr_date']=$val[csf('pr_date')]
				 $button_po="<a href='#' onClick=\"generate_po_report('".$company_name."','".$row[csf('id')]."','".$row[csf('job_no')]."','show_po_detail_report','1')\" '> ".$row[csf('po_number')]."<a/>";
					
				?>
                	<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">
                        <td width="40" rowspan="4"><? echo $i; ?></td>
                        <td width="70" rowspan="4"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
                        <td width="60" align="center" rowspan="4"><? echo $row[csf('year')]; ?></td>
                        <td width="70" align="center" rowspan="4"><? echo $row[csf('job_no_prefix_num')]; ?></td>
                        <td width="100" rowspan="4" style="word-break:break-all;"><? echo  $row[csf('po_number')];//$button_po; ?></td>
                        <td width="70" rowspan="4" style="word-break:break-all;"><? echo $row[csf('file_no')]; ?></td>
                        <td width="80" rowspan="4" style="word-break:break-all;"><? echo $row[csf('grouping')]; ?></td>
                        <td width="110" rowspan="4" style="word-break:break-all;"><? echo $row[csf('style_ref_no')]; ?></td>
                        <td width="120" rowspan="4" style="word-break:break-all;"><? echo $gmts_item; ?></td>
                        <td width="90" align="right"  rowspan="4"><? echo $order_qnty_in_pcs; ?></td>
                        <td width="50" align="center" rowspan="4"><? echo $unit_of_measurement[$row[csf('order_uom')]]; ?></td>
                        <td width="70" align="right"  rowspan="4"><? echo fn_number_format($unit_price,2,'.',''); ?></td>
                        <td width="110" align="right"  rowspan="4"><? echo fn_number_format($po_value,2,'.',''); ?></td>
                        <td width="100" align="right"  rowspan="4"><? echo fn_number_format($row[csf('set_smv')],2,'.',''); ?></td>
                        <td width="80" align="center" rowspan="4"><? echo change_date_format($row[csf('pub_shipment_date')]); ?></td>
                        <td width="100" rowspan="4" style="word-break:break-all;"><? echo $shipment_status[$row[csf('shiping_status')]]; ?></td>
                        <td width="100" align="left"><b>Pre Costing</b></td>
                        <td width="100" align="right" ><? echo fn_number_format($order_qnty_in_pcs,0,'.',''); ?></td>
                        <td width="110" align="right" ><? echo fn_number_format($po_value,2,'.',''); ?></td>
                        <td width="110"  align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $row[csf('id')]."**".$row[csf('job_no')]; ?>','mkt_yarn_cost','Grey Yarn Mkt. Cost Details')"><? echo fn_number_format($yarn_cost_mkt,2); //$tot_yarn_qty_actual?></a><? //echo  fn_number_format($yarn_cost_mkt,2,'.',''); ?></td>
                        <td width="100" title="Yarn Value Addition Cost=Yarn Dyeing & Twisting"  align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $row[csf('id')]."**".$row[csf('job_no')]; ?>','mkt_yarn_dyeing_twisting_cost','Yarn Dyeing & Twisting Cost Details')"><? echo fn_number_format($yarn_value_addition_cost_mkt,2); ?></a><? //echo fn_number_format($yarn_value_addition_cost_mkt,2,'.',''); ?></td>
                        <td width="110"  align="right"><? echo fn_number_format($knit_cost_mkt,2,'.',''); ?></td>
                        <td width="100" title="Grey Fabric Transfer Cost"  align="right"><? //echo fn_number_format($knit_cost_mkt,2,'.',''); ?></td>
                       
                        <td width="100" title="Tot Grey Fabric Cost"  align="right"><? echo fn_number_format($grey_fab_cost_mkt,2,'.',''); ?></td>
                        <td width="110" title="Without Conv. Process Name: -Knitting,Twisting,All Over Printing,Yarn Dyeing,Weaving"  align="right"><? echo fn_number_format($dye_finish_cost_mkt,2,'.',''); ?></td>
                       
                        <td width="110"  align="right"><? echo fn_number_format($aop_cost_mkt,2,'.',''); ?></td>
                        <td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($aop_cost_mkt,2,'.',''); ?></td>
                        <td width="100" title="Fabric Purchase Cost"  align="right"><? echo fn_number_format($finish_fabric_purchase_cost_mkt,2,'.',''); ?></td>
                         <td width="110"  align="right"><? echo fn_number_format($fabric_purchase_cost_mkt,2,'.',''); ?></td>
                        <td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($tot_finish_fabric_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><?
						
						 echo fn_number_format($tot_fabric_cost_mkt,2,'.',''); ?></td>
                        <td width="110"  align="right"><? echo fn_number_format($trims_cost_mkt,2,'.',''); ?></td>
                         <td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($print_amount,2,'.',''); ?></td>
                         <td width="100"  align="right"><? echo fn_number_format($embroidery_amount,2,'.',''); ?></td>
                         <td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($other_amount,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($wash_cost,2,'.',''); ?></td>
                       
                        <td width="100"  align="right"><? echo fn_number_format($commission_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($comm_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($freight_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($test_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($inspection_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($currier_cost_mkt,2,'.',''); ?></td>
                        
                        <td width="100"  align="right"><? echo fn_number_format($certificate_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($deffdlc_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($design_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($studio_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($operating_exp_mkt,2,'.',''); ?></td>
                        
                        
                        
                        
                        <td width="100"  align="right"><? echo fn_number_format($cm_cost_mkt,2,'.',''); ?></td>
                        
                         <td width="100"  align="right"><? echo fn_number_format($interest_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($incometax_cost_mkt,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($depr_amor_pre_cost_mkt,2,'.',''); ?></td>
                     
                        
                        
                        <td width="100"  align="right"><? echo fn_number_format($mkt_all_cost,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($mkt_margin,2,'.',''); ?></td>
                        <td  width="100"  align="right"><? echo fn_number_format($mkt_margin_perc,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($mkt_margin,2,'.',''); ?></td>
                        <td  align="right"><? //echo fn_number_format($mkt_margin,2,'.',''); ?></td>
                    </tr>
                    <tr bgcolor="#F5F5F5" onClick="change_color('tr_a<? echo $i; ?>','#F5F5F5')" id="tr_a<? echo $i; ?>">
                    	<td width="100" align="left"><b>Actual</b></td>
                        <td width="100" align="right" >
						<a href="##" onClick="generate_ex_factory_popup('ex_factory_popup','<? echo $row[csf('job_no_prefix_num')];?>','<? echo $row[csf('id')]; ?>','650px')"><? echo  fn_number_format($ex_factory_qty,0,'.',''); ?></a>
						<? //echo fn_number_format($ex_factory_qty,0,'.',''); ?></td>
                        <td width="110" align="right" ><? echo fn_number_format($ex_factory_value,2,'.',''); ?></td>
                        <td width="110"  align="right"><a href="#report_details" onClick="openmypage_actual2('<? echo $row[csf('id')]; ?>','yarn_cost_actual','Actual Yarn Cost Details','1','1020px')"><? echo fn_number_format($yarn_cost_actual,2,'.',''); ?></a></td>
                          <td width="100" title="Yarn Dying With Order, Yarn Service Work Order(Rate): Yarn Recv: Yarn Dyeing/Twisting/Re-Waxing Cost :<? echo $order_amount_recv.' - Recv Ret: '.$order_amount_recv_ret.'/ Job Qty :'.$job_quantity.'* Po Qty :'.$order_qnty_in_pcs;?>"  align="right">
						  <a href="#report_details"  onClick="openmypage_actual2('<? echo $row[csf('id')]; ?>','yarn_dye_twist_cost_actual','Actual Yarn Dyeing Twsit Cost Details','2','930px')"><? echo fn_number_format($yarn_dyeing_twist_actual,2,'.',''); ?></a>
						  <? //echo fn_number_format($yarn_dyeing_twist_actual,2,'.',''); ?></td>
                        <td width="110" title="Knitting Prod."  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','knit_cost_actual','Actual Knitting Cost Details','900px')"><? echo fn_number_format($knit_cost_actual,2,'.',''); ?></a><? //echo fn_number_format($knit_cost_actual,2,'.',''); ?></td>
                         <td width="100" title="Grey Fabric Transfer Cost<? echo $knit_charge_mkt;?>"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','knit_cost_actual','Actual Knitting Cost Details','900px')"><? //echo fn_number_format($grey_fab_transfer_amt_actual,2,'.',''); ?></a><? echo fn_number_format($grey_fab_transfer_amt_actual,2,'.',''); ?></td>
                          
                        
                        <td width="100" title="Grey Yarn Cost+Yarn Dyeing/Twisting/Re-Waxing Cost+Knitting Cost+Grey Fabric Transfer Cost
  "  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','knit_cost_actual','Actual Knitting Cost Details','900px')"><? //echo fn_number_format($grey_fab_cost_actual,2,'.',''); ?></a><? echo fn_number_format($grey_fab_cost_actual,2,'.',''); ?></td>
                        <td width="110"  title="From Finish Fabric Production Entry,Finish Fabric Production and QC By Roll" align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','dye_finish_cost_actual','Actual Dyeing & Finish Cost Details','900px')"><? echo fn_number_format($dye_finish_cost_actual,2,'.',''); ?></a><? //echo fn_number_format($dye_finish_cost_actual,2,'.',''); ?></td>
                       
                        <td width="110"  align="right" title="<? echo 'Fabric Service Receive'; ?>"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($aop_cost_actual,2,'.',''); ?></a><? echo fn_number_format($aop_cost_actual,2,'.',''); ?></td>
                          <td width="100" title="<? echo 'Avg Dye Fin Charge from Budget='.$knit_charge_mkt_fin;?>"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','Fin Feb Transfer Cost Details','800px')"><? //echo fn_number_format($fin_fab_transfer_amt_actual,2,'.',''); ?></a><? echo fn_number_format($fin_fab_transfer_amt_actual,2,'.',''); ?></td>
                           <td width="100" title="From- Finish Fabric Receive Entry"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($fabric_purchase_cost_actual,2,'.',''); ?></a><? echo fn_number_format($fabric_purchase_cost_actual,2,'.',''); ?></td>
                           <td width="110" title="From: Knit Grey Fabric Receive and Woven Grey Fabric Receive"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','fabric_purchase_cost_actual','Fabric Purchase Cost Details','900px')"><? //echo fn_number_format($grey_fabric_purchase_cost_actual,2,'.',''); ?></a><? echo fn_number_format($grey_fabric_purchase_cost_actual,2,'.',''); ?></td>
                            <td width="100" title=""  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($finished_fab_cost_actual,2,'.',''); ?></a><? echo fn_number_format($finished_fab_cost_actual,2,'.',''); ?></td>
                             <td width="100" title="Tot Fab. Cost"  align="right"><? echo fn_number_format($tot_fabric_cost_act,2,'.',''); ?></td>
                             
                        <td width="110"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','trims_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($trims_cost_actual,2,'.',''); ?></a></td>
                        <td width="100"  title="Garment Printing Cost" align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','1','gmt_print_wash_dye_embell_cost_actual','Print Cost Details','800px')"><? echo fn_number_format($printing_cost_actual,2,'.',''); ?></a></td>
                        <td width="100" title="Garment Embro Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','2','gmt_print_wash_dye_embell_cost_actual','Embro Cost Details','800px')"><? echo fn_number_format($embro_cost_actual,2,'.',''); ?></a></td>
                         <td width="100" title="Garment Dyeing Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','5','gmt_print_wash_dye_embell_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($dyeing_cost_actual,2,'.',''); ?></a></td>
                          <td width="100" title="Garment Wash Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','3','gmt_print_wash_dye_embell_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($wash_cost_actual,2,'.',''); ?></a></td>
                         
                        <td width="100"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]."_".$row[csf('job_no')]."_".$ex_factory_qty."_".$dzn_qnty; ?>','commission_cost_actual','Commission Cost Details','600px')"><? echo fn_number_format($commission_cost_actual,2,'.',''); ?></a></td>
                        <td width="100"  align="right"><? echo fn_number_format($comm_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($freight_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($test_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($inspection_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($currier_cost_actual,2,'.',''); ?></td>
                        
                         <td width="100"  align="right"><? $certificate_cost_actual=$certificate_cost_mkt;echo fn_number_format($certificate_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><?  $deffdlc_cost_mkt_actual=$deffdlc_cost_mkt; echo fn_number_format($deffdlc_cost_mkt_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><? $design_cost_actual=$design_cost_mkt; echo fn_number_format($design_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><? $studio_cost_actual=$studio_cost_mkt;echo fn_number_format($studio_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><?  $operating_exp_actual=$operating_exp_mkt;echo fn_number_format($operating_exp_actual,2,'.',''); ?></td>
                        
                        
                        <?
                        //	$cm_cost_actual=($tot_working_hr*60*$tot_number_of_employee*$cpm)/$exchange_rate;
						?>
                        <td width="100"  title="Working Hr(<? echo $tot_working_hr;?>)*60*Number Of Employee(<? echo $tot_number_of_employee;?>)*CPM(<? echo $cpm;?>)/ExchangeRate(<? echo $exchange_rate;?>)" align="right"><? echo fn_number_format($cm_cost_actual,2,'.',''); ?></td>
                        
                        <td width="100"  align="right"><? $interest_cost_actual=$interest_cost_mkt;echo fn_number_format($interest_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><? $incometax_cost_actual=$incometax_cost_mkt;echo fn_number_format($incometax_cost_actual,2,'.',''); ?></td>
                        <td width="100"  align="right"><? $depr_amor_pre_cost_actual=$depr_amor_pre_cost_mkt;echo fn_number_format($depr_amor_pre_cost_actual,2,'.',''); ?></td>
                       
                        
                        <td width="100"  align="right"><? echo fn_number_format($actual_all_cost,2,'.',''); ?></td>
                        <td width="100"  align="right" title="Ex factory value-Actual all cost;"><? echo fn_number_format($actual_margin,2,'.',''); ?></td>
                        <td  width="100" align="right"  title="Margin /Ex Fact Value*100"><? echo fn_number_format($actual_margin_perc,2,'.',''); ?></td>
                        
                        <td width="100" title="Short Booking,yarn issue for Grey Yarn Amount"  align="right"><? echo fn_number_format($yarn_cost_cpa_actual,2,'.',''); ?></td>
                        <td   align="right"><? echo fn_number_format($actual_margin-$yarn_cost_cpa_actual,2,'.',''); ?></td>
                    </tr>
                    <tr bgcolor="#E9E9E9" onClick="change_color('tr_v<? echo $i; ?>','#E9E9E9')" id="tr_v<? echo $i; ?>">
                    	<td width="100" align="left"><b>Variance</b></td>
                    	<td width="100" align="right" >
							<? 
								//$variance_qnty=$order_qnty_in_pcs-$ex_factory_qty;
								//$variance_qnty_per=($variance_qnty/$order_qnty_in_pcs)*100; 
								//echo fn_number_format($variance_qnty,0,'.',''); 
							?>
                        </td>
                    	<td width="110" align="right" >
                        	<? 
								$variance_po_value=$po_value-$ex_factory_value;
								$variance_po_value_per=($variance_po_value/$po_value)*100; 
								echo fn_number_format($variance_po_value,2,'.',''); 
							?>
                        </td>
                        <td width="110"  align="right">
                        	<? 
								$variance_yarn_cost=($yarn_cost_mkt+$yarn_dye_cost_mkt)-$yarn_cost_actual;
								if($variance_yarn_cost==0)
								{
									$variance_yarn_cost_per=0;
								}
								else
								{
									$variance_yarn_cost_per=($variance_yarn_cost/($yarn_cost_mkt+$yarn_dye_cost_mkt))*100; 
								}
								echo fn_number_format($variance_yarn_cost,2,'.',''); 
							?>
                        </td>
                        <td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right">
                        	<? 
								$variance_yarn_value_addition_cost=$yarn_value_addition_cost_mkt-$yarn_dyeing_twist_actual;
								//$variance_yarn_value_addition_cost_per=($variance_yarn_value_addition_cost/$yarn_value_addition_cost_mkt)*100;
								if($variance_yarn_value_addition_cost==0 && $yarn_value_addition_cost_mkt==0)
								{
									$variance_yarn_value_addition_cost_per=0;
								}
								else
								{
									$variance_yarn_value_addition_cost_per=($variance_yarn_value_addition_cost/$yarn_value_addition_cost_mkt)*100;
								} 
								echo fn_number_format($variance_yarn_value_addition_cost,2,'.',''); 
							?>
                        </td>
                        <td width="110"  align="right">
                        	<? 
								$variance_kint_cost=$knit_cost_mkt-$knit_cost_actual;
								if($variance_kint_cost==0)
								{
									$variance_knit_cost_per=0;
								}
								else
								{
									$variance_knit_cost_per=($variance_kint_cost/$knit_cost_mkt)*100; 
								}
								echo fn_number_format($variance_kint_cost,2,'.',''); 
							?>
                        </td>
                         <td width="100" title="Grey Fabric Transfer Cost"  align="right">
                        	<? 
								//$variance_kint_cost=$knit_cost_mkt-$knit_cost_actual;
								//$variance_knit_cost_per=($variance_kint_cost/$knit_cost_mkt)*100; 
								//echo fn_number_format($variance_kint_cost,2,'.',''); 
							?>
                        </td>
                        
                         <td width="100" title="Tot Grey Fabric Cost"  align="right">
                        	<? 
								$variance_grey_fab_cost=$grey_fab_cost_mkt-$grey_fab_cost_actual;
								if($variance_grey_fab_cost==0 )
								{
									$variance_grey_fab_cost_per=0;
								}
								else
								{
									$variance_grey_fab_cost_per=($variance_grey_fab_cost/$grey_fab_cost_mkt)*100; 
								}
								echo fn_number_format($variance_grey_fab_cost,2,'.',''); 
							?>
                        </td>
                        <td width="110"  align="right">
                        	<? 
								$variance_dye_finish_cost=$dye_finish_cost_mkt-$dye_finish_cost_actual;
								if($variance_dye_finish_cost==0 && $dye_finish_cost_mkt==0)
								{
									$variance_dye_finish_cost_per=0;
								}
								else
								{
									$variance_dye_finish_cost_per=($variance_dye_finish_cost/$dye_finish_cost_mkt)*100; 
								}
								echo fn_number_format($variance_dye_finish_cost,2,'.','');
							?>
                        </td>
                        <td width="110"  align="right">
                        	<? 
								$variance_aop_cost=$aop_cost_mkt-$aop_cost_actual;
								if($variance_aop_cost==0)
								{
									$variance_aop_cost_per=0;
								}
								else
								{
									$variance_aop_cost_per=($variance_aop_cost/$aop_cost_mkt)*100; 
								}
								echo fn_number_format($variance_aop_cost,2,'.',''); 
							?>
                        </td>
                          <td width="100" title="Finished Fabric Transfer Cost"  align="right">
                        	<? 
								//$variance_aop_cost=$aop_cost_mkt-$aop_cost_actual;
								//$variance_aop_cost_per=($variance_aop_cost/$aop_cost_mkt)*100; 
								//echo fn_number_format($variance_aop_cost,2,'.',''); 
							?>
                        </td>
                         <td width="100" title="Finished Fabric Purchase Cost"  align="right">
                        	<? 
								$variance_fin_fabric_purchase_cost=$finish_fabric_purchase_cost_mkt-$fabric_purchase_cost_actual;
								//$variance_fin_fabric_cost_per=($variance_fin_fabric_purchase_cost/$finish_fabric_purchase_cost_mkt)*100;
								if($variance_fin_fabric_purchase_cost==0)
								{
									$variance_fin_fabric_cost_per=0;
								}
								else
								{
									$variance_fin_fabric_cost_per=($variance_fin_fabric_purchase_cost/$finish_fabric_purchase_cost_mkt)*100; 
								} 
								echo fn_number_format($variance_fin_fabric_purchase_cost,2,'.',''); 
							?>
                        </td>
                         <td width="110"  align="right">
                        	<? 
								$variance_finish_purchase_cost=$fabric_purchase_cost_mkt-$fabric_purchase_cost_actual;
								//$variance_finish_purchase_cost_per=($variance_finish_purchase_cost/$fabric_purchase_cost_mkt)*100; 
								if($variance_finish_purchase_cost==0 && $fabric_purchase_cost_mkt==0)
								{
									$variance_finish_purchase_cost_per=0;
								}
								else
								{
									$variance_finish_purchase_cost_per=($variance_finish_purchase_cost/$fabric_purchase_cost_mkt)*100; 
								}
								echo fn_number_format($variance_finish_purchase_cost,2,'.','');
							?>
                        </td>
                         <td width="100" title="Finished Fabric Cost"  align="right">
                        	<? 
								//$variance_finished_fab_cost=$tot_finish_fabric_cost_mkt-$finished_fab_cost_actual;
								//$variance_finished_fab_cost_per=($variance_finished_fab_cost/$finished_fab_cost_mkt)*100;
								$variance_finished_fab_cost=$tot_finish_fabric_cost_mkt-$finished_fab_cost_actual;
							//	echo $variance_finished_fab_cost.'='.$finished_fab_cost_mkt;
								if($variance_finished_fab_cost==0)
								{
									$variance_finished_fab_cost_per=0;
								}
								else
								{
									$variance_finished_fab_cost_per=($variance_finished_fab_cost/$tot_finish_fabric_cost_mkt)*100; 
								} 
								echo fn_number_format($variance_finished_fab_cost,2,'.',''); 
							?>
                        </td>
                        <td width="100" title="Total Fabric Cost"  align="right">
                        	<? 
								$variance_tot_fabric_cost=$tot_fabric_cost_mkt-$tot_fabric_cost_act;
								//$variance_tot_fabric_cost_per=($variance_tot_fabric_cost/$tot_fabric_cost_mkt)*100; 
								if($variance_tot_fabric_cost==0 && $tot_fabric_cost_mkt==0)
								{
									$variance_tot_fabric_cost_per=0;
								}
								else
								{
									$variance_tot_fabric_cost_per=($variance_tot_fabric_cost/$tot_fabric_cost_mkt)*100; 
								}
								echo fn_number_format($variance_tot_fabric_cost,2,'.',''); 
							?>
                        </td>
                        <td width="100"  align="right">
                        	<? 
								$variance_trims_cost=$trims_cost_mkt-$trims_cost_actual;
								if($variance_trims_cost==0)
								{
									$variance_trims_cost_per=0;
								}
								else
								{
									$variance_trims_cost_per=($variance_trims_cost/$trims_cost_mkt)*100; 
								}
								echo fn_number_format($variance_trims_cost,2,'.','');
							?>
                        </td>
                         <td width="100" title="Garment Printing Cost"  align="right">
                        	<? 
								$variance_print_cost=$print_amount-$printing_cost_actual;
								if($variance_print_cost==0)
								{
									$variance_print_cost_per=0;
								}
								else
								{
									$variance_print_cost_per=($variance_print_cost/$print_amount)*100; 
								}
								echo fn_number_format($variance_print_cost,2,'.','');
							?>
                        </td>
                         <td width="100" title="Garment Embro Cost"  align="right">
                        	<? 
								$variance_embro_cost=$embroidery_amount-$embro_cost_actual;
								if($variance_embro_cost==0 && $embroidery_amount==0)
								{
									$variance_embro_cost_per=0;
								}
								else
								{
									$variance_embro_cost_per=($variance_embro_cost/$embroidery_amount)*100; 
								}
								echo fn_number_format($variance_embro_cost,2,'.','');
							?>
                        </td>
                         <td width="100" title="Garment Dyeing Cost"  align="right">
                        	<? 
								$variance_dyeing_cost=$other_amount-$dyeing_cost_actual;
								if($variance_dyeing_cost==0 && $other_amount==0)
								{
									$variance_dyeing_cost_per=0;
								}
								else
								{
									$variance_dyeing_cost_per=($variance_dyeing_cost/$other_amount)*100; 
								}
								echo fn_number_format($variance_dyeing_cost,2,'.','');
							?>
                        </td>
                         <td width="100" title="Garment Wasing Cost"  align="right">
                        	<? 
								$variance_wash_cost=$wash_cost-$wash_cost_actual;
							if($variance_wash_cost==0 )
								{
									$variance_wash_cost_per=0;
								}
								else
								{
									$variance_wash_cost_per=($variance_wash_cost/$wash_cost)*100; 
								}
								echo fn_number_format($variance_wash_cost_per,2,'.','');
							?>
                        </td>
                     
                        <td width="100"  align="right">
                        	<? 
								$variance_commission_cost=$commission_cost_mkt-$commission_cost_actual;
								if($variance_commission_cost==0 && $commission_cost_mkt==0)
								{
									$variance_commission_cost_per=0;
								}
								else
								{
									$variance_commission_cost_per=($variance_commission_cost/$commission_cost_mkt)*100; 
								}
								echo fn_number_format($variance_commission_cost,2,'.',''); 
							?>
                        </td>
                        <td width="100"  align="right">
                        	<? 
								$variance_comm_cost=$comm_cost_mkt-$comm_cost_actual;
								if($variance_comm_cost==0 )
								{
									$variance_commission_cost_per=0;
								}
								else
								{
									$variance_comm_cost_per=($variance_comm_cost/$comm_cost_mkt)*100; 
								}
								echo fn_number_format($variance_comm_cost,2,'.',''); 
							?>
                        </td>
                        <td width="100"  align="right">
                        	<? 
								$variance_freight_cost=$freight_cost_mkt-$freight_cost_actual;
								if($variance_freight_cost==0 && $freight_cost_mkt==0)
								{
									$variance_freight_cost_per=0;
								}
								else
								{
									$variance_freight_cost_per=($variance_freight_cost/$freight_cost_mkt)*100; 
								}
								echo fn_number_format($variance_freight_cost,2,'.',''); 
							?>
                        </td>
                        <td width="100"  align="right">
                        	<? 
								$variance_test_cost=$test_cost_mkt-$test_cost_actual;
								if($variance_test_cost==0 && $test_cost_mkt==0)
								{
									$variance_test_cost_per=0;
								}
								else
								{
									$variance_test_cost_per=($variance_test_cost/$test_cost_mkt)*100; 
								}
								echo fn_number_format($variance_test_cost,2,'.','');
							?>
                        </td>
                        <td width="100"  align="right">
                        	<? 
								$variance_inspection_cost=$inspection_cost_mkt-$inspection_cost_actual;
								if($variance_inspection_cost==0 && $inspection_cost_mkt==0)
								{
									$variance_inspection_cost_per=0;
								}
								else
								{
									$variance_inspection_cost_per=($variance_inspection_cost/$inspection_cost_mkt)*100; 
								}
								echo fn_number_format($variance_inspection_cost,2,'.','');
							?>
                        </td>
                        <td width="100"  align="right">
                        	<? 
								$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');
							?>
                        </td>
                        
                          <td width="100"  align="right">
                        	<? 
								/*$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');*/
							?>
                        </td>
                         <td width="100"  align="right">
                        	<? 
								/*$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');*/
							?>
                        </td>
                         <td width="100"  align="right">
                        	<? 
								/*$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');*/
							?>
                        </td>
                         <td width="100"  align="right">
                        	<? 
								/*$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');*/
							?>
                        </td>
                         <td width="100"  align="right">
                        	<? 
								/*$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');*/
							?>
                        </td>
                          
                        
                        
                        <td width="100"  align="right">
                        	<? 
								$variance_cm_cost=$cm_cost_mkt-$cm_cost_actual;
								if($variance_cm_cost_per==0)
								{
									$variance_cm_cost_per=0;
								}
								else
								{
									$variance_cm_cost_per=($variance_cm_cost/$cm_cost_mkt)*100; 
								}
								echo fn_number_format($variance_cm_cost,2,'.',''); 
							?>
                        </td>
                        
                          <td width="100"  align="right">
                        	<? 
								/*$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');*/
							?>
                        </td>
                          <td width="100"  align="right">
                        	<? 
								/*$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');*/
							?>
                        </td>
                          <td width="100"  align="right">
                        	<? 
								/*$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
								if($variance_currier_cost==0 )
								{
									$variance_currier_cost_per=0;
								}
								else
								{
									$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
								}
								echo fn_number_format($variance_currier_cost,2,'.','');*/
							?>
                        </td>
                          
                        
                        <td width="100"  align="right">
                        	<? 
								$variance_all_cost=$mkt_all_cost-$actual_all_cost;
								if($variance_all_cost==0)
								{
									$variance_all_cost_per=0;
								}
								else
								{
									$variance_all_cost_per=($variance_all_cost/$mkt_all_cost)*100; 
								}
								
								echo fn_number_format($variance_all_cost,2,'.','');
							?>
                        </td>
                        <td width="100"  align="right">
                        	<? 
								$variance_margin_cost=$mkt_margin-$actual_margin;
								if($variance_margin_cost==0)
								{
									$variance_margin_cost_per=0;
								}
								else
								{
									$variance_margin_cost_per=($variance_margin_cost/$mkt_margin)*100; 
								}
								echo fn_number_format($variance_margin_cost,2,'.','');
							?>
                        </td>
                        <td  width="100" align="right">
                        	<? 
								$variance_per_cost=$mkt_margin_perc-$actual_margin_perc;
								if($variance_per_cost==0)
								{
									$variance_per_cost_per=0;
								}
								else
								{
									$variance_per_cost_per=($variance_per_cost/$mkt_margin_perc)*100; 
								}
								echo fn_number_format($variance_per_cost,2,'.','');
							?>
                        </td>
                         <td width="100"  align="right">
                        	<? 
								/*$variance_margin_cost=$mkt_margin-$actual_margin;
								$variance_margin_cost_per=($variance_margin_cost/$mkt_margin)*100; 
								echo fn_number_format($variance_margin_cost,2,'.','');*/
							?>
                        </td>
                         <td   align="right">
                        	<? 
								/*$variance_margin_cost=$mkt_margin-$actual_margin;
								$variance_margin_cost_per=($variance_margin_cost/$mkt_margin)*100; 
								echo fn_number_format($variance_margin_cost,2,'.','');*/
							?>
                        </td>
                        
                    </tr>
                    <tr bgcolor="#DFDFDF" onClick="change_color('tr_vp<? echo $i; ?>','#DFDFDF')" id="tr_vp<? echo $i; ?>">
                    	<td width="100" align="left"><b>Variance (%)</b></td>
                    	<td width="100" align="right" ><? echo fn_number_format($variance_qnty_per,2,'.',''); ?></td>
                    	<td width="110" align="right" ><? echo fn_number_format($variance_po_value_per,2,'.',''); ?></td>
                        <td width="110"  align="right"><? echo fn_number_format($variance_yarn_cost_per,2,'.',''); ?></td>
                          <td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($variance_yarn_value_addition_cost_per,2,'.',''); ?></td>
                        <td width="110"  align="right"><? echo fn_number_format($variance_knit_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($variance_knit_cost_per,2,'.',''); ?></td>
                       
                        <td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($variance_grey_fab_cost_per,2,'.',''); ?></td>
                        <td width="110"  align="right"><? echo fn_number_format($variance_dye_finish_cost_per,2,'.',''); ?></td>
                       
                        <td width="110"  align="right"><? echo fn_number_format($variance_aop_cost_per,2,'.',''); ?></td>
                        <td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($variance_aop_cost_per,2,'.',''); ?></td>
                         <td width="100" title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($variance_fin_fabric_cost_per,2,'.',''); ?></td>
                        
                         <td width="110"  align="right"><? echo fn_number_format($variance_finish_purchase_cost_per,2,'.',''); ?></td>
                         <td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($variance_finished_fab_cost_per,2,'.',''); ?></td>
                         <td width="100"  align="right"><?  echo fn_number_format($variance_tot_fabric_cost_per,2,'.',''); ?></td>
                        <td width="110"  align="right"><? echo fn_number_format($variance_trims_cost_per,2,'.',''); ?></td>
                        <td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($variance_print_cost_per,2,'.',''); ?></td>
                        <td width="100" title="Garment Embro Cost"  align="right"><? echo fn_number_format($variance_embro_cost_per,2,'.',''); ?></td>
                        <td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($variance_dyeing_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($variance_wash_cost_per,2,'.',''); ?></td>
                        
                      
                        <td width="100"  align="right"><? echo fn_number_format($variance_commission_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($variance_comm_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($variance_freight_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($variance_test_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($variance_inspection_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                        
                        <td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                        
                        
                          
                        
                        <td width="100"  align="right"><? echo fn_number_format($variance_cm_cost_per,2,'.',''); ?></td>
                        
                        <td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
                      
                        
                        <td width="100"  align="right"><? echo fn_number_format($variance_all_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
                        <td   width="100" align="right"><? echo fn_number_format($variance_per_cost_per,2,'.',''); ?></td>
                        <td width="100"  align="right"><? //echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
                        <td   align="right"><? //echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
                    </tr>
				<?
					$i++;
				}
				
				$tot_mkt_margin_perc=($tot_mkt_margin/$tot_po_value)*100;
				if($tot_ex_factory_val==0)
				{
					$tot_actual_margin_perc=0;
				}
				else
				{
					$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
				}
				
				//$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
				
				?>
            </table>
		</div>
        <table class="rpt_table" width="5430" cellpadding="0" cellspacing="0" border="1" rules="all">
            <tr bgcolor="#CCDDEE" onClick="change_color('tr_pt','#CCDDEE')" id="tr_pt" style="font-weight:bold;">
              <td width="40">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="60">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="100">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="80">&nbsp;</td>
                <td width="110">&nbsp;</td>
                <td width="120" align="">Total</td>
               
                <td width="90"  align="right"><? echo fn_number_format($tot_po_qnty,0,'.',''); ?></td>
                <td width="50">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="110"  align="right"><? echo fn_number_format($tot_po_value,2,'.',''); ?></td>
                <td width="100"  align="right">&nbsp;</td>
                <td width="80">&nbsp;</td>
                <td width="100">&nbsp;</td>
                <td width="100">Pre Costing Total</td>
                <td width="100"  align="right"><? echo fn_number_format($tot_po_qnty,0,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_po_value,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_yarn_cost_mkt,2,'.',''); ?></td>
                 <td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_knit_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? //echo fn_number_format($tot_knit_cost_mkt,2,'.',''); ?></td>
               
                <td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($tot_grey_fab_cost_mkt,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2,'.',''); ?></td>
              
                
                <td width="110"  align="right"><? echo fn_number_format($tot_aop_cost_mkt,2,'.',''); ?></td>
                <td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($tot_yarn_dye_cost_mkt,2,'.',''); ?></td> 
                 <td width="100" title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2,'.',''); ?></td> 
                   <td width="110"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2,'.',''); ?></td>
                 <td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($total_finish_fabric_cost_mkt,2,'.',''); ?></td> 
                 <td width="100"  align="right"><? echo fn_number_format($total_fabric_cost_mkt,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_trims_cost_mkt,2,'.',''); ?></td>
                <td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($tot_print_amount_mkt,2,'.',''); ?></td> 
                <td width="100" title="Garment Embroidery Cost"  align="right"><? echo fn_number_format($tot_embro_amount_mkt,2,'.',''); ?></td> 
                <td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_dyeing_amount_mkt,2,'.',''); ?></td> 
                <td width="100" title="Garment Wash Cost"  align="right"><? echo fn_number_format($tot_wash_amount_mkt,2,'.',''); ?></td> 
                
               
                <td width="100"  align="right"><? echo fn_number_format($tot_commission_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_comm_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_freight_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_test_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_currier_cost_mkt,2,'.',''); ?></td>
                
                <td width="100"  align="right"><? echo fn_number_format($tot_certificate_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_design_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_studio_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_operating_exp_mkt,2,'.',''); ?></td>
                
                
                <td width="100"  align="right"><? echo fn_number_format($tot_cm_cost_mkt,2,'.',''); ?></td>
                
                <td width="100"  align="right"><? echo fn_number_format($tot_interest_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_incometax_cost_mkt,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt,2,'.',''); ?></td>
               
                
                <td width="100"  align="right"><? echo fn_number_format($tot_mkt_all_cost,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_mkt_margin_perc,2,'.',''); ?></td>
                <td width="100"  align="right"><? //echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
                <td width=""  align="right"><? //echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
            </tr>
            <? //echo die;?>
            <tr bgcolor="#CCCCFF" onClick="change_color('tr_at','#CCCCFF')" id="tr_at" style="font-weight:bold;">
                <td width="40">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="60">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="100">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="80">&nbsp;</td>
                <td width="110">&nbsp;</td>
                <td width="120" align="">&nbsp;</td>
                <td width="90"  align="right">&nbsp;</td>
                <td width="50">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="110"  align="right">&nbsp;</td>
                <td width="100"  align="right">&nbsp;</td>
                <td width="80">&nbsp;</td>
                <td width="100">&nbsp;</td>
                <td width="100">Actual Total</td>
                <td width="100" align="right" ><? echo fn_number_format($tot_ex_factory_qnty,0,'.',''); ?></td>
                <td width="110" align="right" ><? echo fn_number_format($tot_ex_factory_val,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_yarn_cost_actual,2,'.',''); ?></td>
                <td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_knit_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_grey_fab_transfer_amt_actual,2,'.',''); ?></td>
               
                <td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($tot_grey_fab_cost_actual,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_dye_finish_cost_actual,2,'.',''); ?></td>
               
               
                <td width="110"  align="right"><? echo fn_number_format($tot_aop_cost_actual,2,'.',''); ?></td>
                <td width="100" title="Finished Fabric Transfer Cost act"  align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2,'.',''); ?></td>
                <td width="100" title="Finished Fabric Purchase Cost act"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2,'.',''); ?></td>
                 <td width="110"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2,'.',''); ?></td>
                <td width="100" title="Tot Finished Fabric Cost act"  align="right"><? echo fn_number_format($tot_finished_fab_cost_actual,2,'.',''); ?></td>
                 <td width="100" title="Total Fab. Cost" align="right" ><? echo fn_number_format($tot_fabric_cost_actaul,2,'.',''); ?></td>
                <td width="110" align="right" ><? echo fn_number_format($tot_trims_cost_actual,2,'.',''); ?></td>
                <td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($tot_print_amount_actual,2,'.',''); ?></td>
                <td width="100" title="Garment Embro Cost"  align="right"><? echo fn_number_format($tot_embro_amount_actual,2,'.',''); ?></td>
                <td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_dyeing_amount_actual,2,'.',''); ?></td>
                <td width="100" title="Garment Wash Cost"  align="right"><? echo fn_number_format($tot_wash_amount_actual,2,'.',''); ?></td>
                 
                 
               
                <td width="100"  align="right"><? echo fn_number_format($tot_commission_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_comm_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_freight_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_test_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_inspection_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_currier_cost_actual,2,'.',''); ?></td>
                
                <td width="100"  align="right"><? echo fn_number_format($tot_certificate_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_deffdlc_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_design_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_studio_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_operating_exp_actual,2,'.',''); ?></td>
                
                      
                       
                 
                
                <td width="100"  align="right"><? echo fn_number_format($tot_cm_cost_actual,2,'.',''); ?></td>
                
                 <td width="100"  align="right"><? echo fn_number_format($tot_interest_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_incometax_cost_actual,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_actual,2,'.',''); ?></td>
               
                
                <td width="100"  align="right"><? echo fn_number_format($tot_actual_all_cost,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_actual_margin,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_actual_margin_perc,2,'.',''); ?></td>
               <td width="100"  align="right"><? echo fn_number_format($tot_yarn_qty_cpa_actual,2,'.',''); ?></td>
               <td width=""  align="right"><? echo fn_number_format($tot_actual_net_margin,2,'.',''); ?></td>
            </tr>
            <tr bgcolor="#FFEEFF" onClick="change_color('tr_vt','#FFEEFF')" id="tr_vt" style="font-weight:bold;">
                <td width="40">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="60">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="100">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="80">&nbsp;</td>
                <td width="110">&nbsp;</td>
                <td width="120" align="">&nbsp;</td>
                <td width="90"  align="right">&nbsp;</td>
                <td width="50">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="110"  align="right">&nbsp;</td>
                <td width="100"  align="right">&nbsp;</td>
                <td width="80">&nbsp;</td>
                <td width="100">&nbsp;</td>
                <td width="100">Variance Total</td>
                <td width="100" align="right" >
					<? 
                        $tot_variance_qnty=$tot_po_qnty-$tot_ex_factory_qnty;
                        $tot_variance_qnty_per=($tot_variance_qnty/$tot_po_qnty)*100; 
                        echo fn_number_format($tot_variance_qnty,0,'.',''); 
                    ?>
                </td>
                <td width="110" align="right" >
                    <? 
                        $tot_variance_po_value=$tot_po_value-$tot_ex_factory_val;
                        $tot_variance_po_value_per=($tot_variance_po_value/$tot_po_value)*100; 
                        echo fn_number_format($tot_variance_po_value,2,'.',''); 
                    ?>
                </td>
                <td width="110"  align="right">
                    <? 
                        $tot_variance_yarn_cost=$tot_yarn_cost_mkt-$tot_yarn_cost_actual;
                        $tot_variance_yarn_cost_per=($tot_variance_yarn_cost/$tot_yarn_cost_mkt)*100; 
                        echo fn_number_format($tot_variance_yarn_cost,2,'.',''); 
                    ?>
                </td>
                 <td width="100"  align="right">
                    <? 
                        $tot_variance_yarn_value_addition_cost=$tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual;
						if($tot_variance_yarn_value_addition_cost==0)
						{
						$tot_variance_yarn_value_addition_cost_per=0;
						}
						else
						{
						$tot_variance_yarn_value_addition_cost_per=($tot_variance_yarn_value_addition_cost/$tot_yarn_value_addition_cost_mkt)*100; 
						}
                       // $tot_variance_yarn_value_addition_cost_per=($tot_variance_yarn_value_addition_cost/$tot_yarn_value_addition_cost_mkt)*100; 
                        echo fn_number_format($tot_variance_yarn_value_addition_cost,2,'.',''); 
                    ?>
                </td>
                <td width="100"  align="right">
                    <? 
                        $tot_variance_kint_cost=$tot_knit_cost_mkt-$tot_knit_cost_actual;
                        $tot_variance_knit_cost_per=($tot_variance_kint_cost/$tot_knit_cost_mkt)*100; 
                        echo fn_number_format($tot_variance_kint_cost,2,'.',''); 
                    ?>
                </td>
                 <td width="100"  align="right">
                    <? 
                        //$tot_variance_kint_cost=$tot_knit_cost_mkt-$tot_knit_cost_actual;
                       // $tot_variance_knit_cost_per=($tot_variance_kint_cost/$tot_knit_cost_mkt)*100; 
                       // echo fn_number_format($tot_variance_kint_cost,2,'.',''); 
                    ?>
                </td>
               
                 <td width="100"  title="Grey Fabric Cost" align="right">
                    <? 
                        $tot_variance_grey_fab_cost=$tot_grey_fab_cost_mkt-$tot_grey_fab_cost_actual;
                      if($tot_variance_grey_fab_cost==0)
						{
							$tot_variance_grey_fab_cost_per=0;
						}
						else
						{
							 $tot_variance_grey_fab_cost_per=($tot_variance_grey_fab_cost/$tot_grey_fab_cost_mkt)*100; 
						}    
                        echo fn_number_format($tot_variance_grey_fab_cost,2,'.',''); 
                    ?>
                </td>
                <td width="110"  align="right">
                    <? 
                        $tot_variance_dye_finish_cost=$tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual;
                      if($tot_variance_dye_finish_cost==0)
						{
							$tot_variance_dye_finish_cost_per=0;
						}
						else
						{
							 $tot_variance_dye_finish_cost_per=($tot_variance_dye_finish_cost/$tot_dye_finish_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_dye_finish_cost,2,'.','');
                    ?>
                </td>
              
                <td width="110"  align="right">
                    <? 
                        $tot_variance_aop_cost=$tot_aop_cost_mkt-$tot_aop_cost_actual;
                      if($tot_variance_aop_cost==0)
						{
							$tot_variance_aop_cost_per=0;
						}
						else
						{
							  $tot_variance_aop_cost_per=($tot_variance_aop_cost/$tot_aop_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_aop_cost,2,'.',''); 
                    ?>
                </td>
                <td width="100"  title="Fabric Purchase Trans Cost"  align="right">
                    <? 
                        /*$tot_variance_aop_cost=$tot_aop_cost_mkt-$tot_aop_cost_actual;
                        $tot_variance_aop_cost_per=($tot_variance_aop_cost/$tot_aop_cost_mkt)*100; 
                        echo fn_number_format($tot_variance_aop_cost,2,'.','');*/ 
                    ?>
                </td>
                <td width="100" title="Fabric Purchase Cost" align="right">
                    <? 
                       $tot_variance_fin_fabric_purchase_cost=$tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual;
                       if($tot_variance_fin_fabric_purchase_cost==0)
						{
							$tot_variance_fin_fabric_purchase_cost_per=0;
						}
						else
						{
							 $tot_variance_fin_fabric_purchase_cost_per=($tot_variance_fin_fabric_purchase_cost/$tot_fabric_purchase_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_fin_fabric_purchase_cost,2,'.','');
                    ?>
                </td>
                  <td width="110"  align="right">
                    <? 
                        $tot_variance_fabric_purchase_cost=$tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual;
                        if($tot_variance_fabric_purchase_cost==0)
						{
							$tot_variance_fabric_purchase_cost_per=0;
						}
						else
						{
							  $tot_variance_fabric_purchase_cost_per=($tot_variance_fabric_purchase_cost/$tot_fabric_purchase_cost_mkt)*100; 
						}
                        echo fn_number_format($tot_variance_fabric_purchase_cost,2,'.','');
                    ?>
                </td>
                <td width="100" title="Tot Fin Fabric  Cost"  align="right">
                    <? 
                       $tot_variance_fin_fab_cost=$total_finish_fabric_cost_mkt-$tot_finished_fab_cost_actual;
                       if($tot_variance_fin_fab_cost==0)
						{
							$tot_variance_fin_fab_cost_per=0;
						}
						else
						{
							   $tot_variance_fin_fab_cost_per=($tot_variance_fin_fab_cost/$total_finish_fabric_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_fin_fab_cost,2,'.',''); 
                    ?>
                </td>
                <td width="100" title="Tot Fabric  Cost"  align="right">
                    <? 
                        $tot_variance_fabric_cost_mkt=$total_fabric_cost_mkt-$tot_fabric_cost_actaul;
                      if($tot_variance_fabric_cost_mkt==0)
						{
							$tot_variance_fabric_cost_mkt_per=0;
						}
						else
						{
							 $tot_variance_fabric_cost_mkt_per=($tot_variance_fabric_cost_mkt/$tot_fabric_cost_mkt)*100;  
						} 
						
                        echo fn_number_format($tot_variance_fabric_cost_mkt,2,'.','');
                    ?>
                </td>
                <td width="110"  align="right">
                    <? 
                        $tot_variance_trims_cost=$tot_trims_cost_mkt-$tot_trims_cost_actual;
                       if($tot_variance_trims_cost==0)
						{
							$tot_variance_trims_cost_per=0;
						}
						else
						{
							   $tot_variance_trims_cost_per=($tot_variance_trims_cost/$tot_trims_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_trims_cost,2,'.','');
                    ?>
                </td>
                  <td width="100" title="Garment Printing Cost" align="right">
                    <? 
                        $tot_variance_print_amount=$tot_print_amount_mkt-$tot_print_amount_actual;
                       if($tot_variance_print_amount==0)
						{
							$tot_variance_print_per=0;
						}
						else
						{
							   $tot_variance_print_per=($tot_variance_print_amount/$tot_print_amount_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_print_amount,2,'.','');
                    ?>
                </td>
                 <td width="100" title="Garment Embro  Cost"  align="right">
                    <? 
                       $tot_variance_embro_cost=$tot_embro_amount_mkt-$tot_embro_amount_actual;//tot_wash_amount_mkt-tot_wash_amount_actual
                        if($tot_variance_embro_cost==0)
						{
							$tot_variance_embro_cost_per=0;
						}
						else
						{
							$tot_variance_embro_cost_per=($tot_variance_embro_cost/$tot_embro_amount_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_embro_cost,2,'.','');
                    ?>
                </td>
                 <td width="100" title="Garment Dyeing Cost"  align="right">
                    <? 
					
                        $tot_variance_dyeing_cost=$tot_dyeing_amount_mkt-$tot_dyeing_amount_actual;
                       if($tot_variance_dyeing_cost==0)
						{
							$tot_variance_dyeing_cost_per=0;
						}
						else
						{
							 $tot_variance_dyeing_cost_per=($tot_variance_dyeing_cost/$tot_dyeing_amount_mkt)*100; 
						} 
						//echo $tot_variance_dyeing_cost.'='.$tot_dyeing_amount_mkt.', ';
                        echo fn_number_format($tot_variance_dyeing_cost,2,'.',''); 
                    ?>
                </td>
                 <td width="100" title="Garment Wash Cost"  align="right">
                    <? 
                       $tot_variance_wash_cost=$tot_wash_amount_mkt-$tot_wash_amount_actual;
                      if($tot_variance_wash_cost==0)
						{
							$tot_variance_wash_cost_per=0;
						}
						else
						{
							 $tot_variance_wash_cost_per=($tot_variance_wash_cost/$tot_wash_amount_mkt)*100; 
						}   
                        echo fn_number_format($tot_variance_wash_cost,2,'.','');
                    ?>
                </td>
               
                <td width="100" align="right">
                    <? 
                        $tot_variance_commission_cost=$tot_commission_cost_mkt-$tot_commission_cost_actual;
                        if($tot_variance_commission_cost==0)
						{
							$tot_variance_commission_cost_per=0;
						}
						else
						{
							 $tot_variance_commission_cost_per=($tot_variance_commission_cost/$tot_commission_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_commission_cost,2,'.',''); 
                    ?>
                </td>
                <td width="100"  align="right">
                    <? 
                        $tot_variance_comm_cost=$tot_comm_cost_mkt-$tot_comm_cost_actual;
                       if($tot_variance_comm_cost==0)
						{
							$tot_variance_comm_cost_per=0;
						}
						else
						{
							  $tot_variance_comm_cost_per=($tot_variance_comm_cost/$tot_comm_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_comm_cost,2,'.',''); 
                    ?>
                </td>
                <td width="100"  align="right">
                    <? 
                        $tot_variance_freight_cost=$tot_freight_cost_mkt-$tot_freight_cost_actual;
                      if($tot_variance_freight_cost==0)
						{
							$tot_variance_freight_cost_per=0;
						}
						else
						{
							$tot_variance_freight_cost_per=($tot_variance_freight_cost/$tot_freight_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_freight_cost,2,'.',''); 
                    ?>
                </td>
                <td width="100"  align="right">
                    <? 
                        $tot_variance_test_cost=$tot_test_cost_mkt-$tot_test_cost_actual;
                        if($tot_variance_test_cost==0)
						{
							$tot_variance_test_cost_per=0;
						}
						else
						{
							 $tot_variance_test_cost_per=($tot_variance_test_cost/$tot_test_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_test_cost,2,'.','');
                    ?>
                </td>
                <td width="100" align="right">
                    <? 
                        $tot_variance_inspection_cost=$tot_inspection_cost_mkt-$tot_inspection_cost_actual;
                       if($tot_variance_inspection_cost==0)
						{
							$tot_variance_inspection_cost_per=0;
						}
						else
						{
							  $tot_variance_inspection_cost_per=($tot_variance_inspection_cost/$tot_inspection_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_inspection_cost,2,'.','');
                    ?>
                </td>
                <td width="100" align="right">
                    <? 
                        $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');
                    ?>
                </td>
                
                 <td width="100" align="right">
                    <? 
                      /*  $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');*/
                    ?>
                </td>
                 <td width="100" align="right">
                    <? 
                      /*  $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');*/
                    ?>
                </td>
                 <td width="100" align="right">
                    <? 
                      /*  $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');*/
                    ?>
                </td>
                 <td width="100" align="right">
                    <? 
                      /*  $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');*/
                    ?>
                </td>
                 <td width="100" align="right">
                    <? 
                      /*  $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');*/
                    ?>
                </td>
                  
                
                
                <td width="100"  align="right">
                    <? 
                        $tot_variance_cm_cost=$tot_cm_cost_mkt-$tot_cm_cost_actual;
                        if($tot_variance_cm_cost==0)
						{
							$tot_variance_cm_cost_per=0;
						}
						else
						{
							$tot_variance_cm_cost_per=($tot_variance_cm_cost/$tot_cm_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_cm_cost,2,'.',''); 
                    ?>
                </td>
                 <td width="100" align="right">
                    <? 
                      /*  $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');*/
                    ?>
                </td>
                 <td width="100" align="right">
                    <? 
                      /*  $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');*/
                    ?>
                </td>
                 <td width="100" align="right">
                    <? 
                      /*  $tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
                       if($tot_variance_currier_cost==0)
						{
							$tot_variance_currier_cost_per=0;
						}
						else
						{
							 $tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
						} 
                        echo fn_number_format($tot_variance_currier_cost,2,'.','');*/
                    ?>
                </td>
                
                
                <td width="100" align="right">
                    <? 
                        $tot_variance_all_cost=$tot_mkt_all_cost-$tot_actual_all_cost;
                      if($tot_variance_all_cost==0)
						{
							$tot_variance_all_cost_per=0;
						}
						else
						{
							$tot_variance_all_cost_per=($tot_variance_all_cost/$tot_mkt_all_cost)*100; 
						} 
                        echo fn_number_format($variance_all_cost,2,'.','');
                    ?>
                </td>
                <td width="100"  align="right">
                    <? 
                        $tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
                        $tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
                        echo fn_number_format($tot_variance_margin_cost,2,'.','');
                    ?>
                </td>
                <td width="100" align="right">
                    <? 
                        $tot_variance_per_cost=$tot_mkt_margin_perc-$tot_actual_margin_perc;
                        $tot_variance_per_cost_per=($tot_variance_per_cost/$tot_mkt_margin_perc)*100; 
                        echo fn_number_format($tot_variance_per_cost,2,'.','');
                    ?>
                </td>
                 <td width="100"  align="right">
                    <? 
                       /* $tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
                        $tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
                        echo fn_number_format($tot_variance_margin_cost,2,'.','');*/
                    ?>
                </td>
                 <td width=""  align="right">
                    <? 
                       /* $tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
                        $tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
                        echo fn_number_format($tot_variance_margin_cost,2,'.','');*/
                    ?>
                </td>
            </tr>
            <tr bgcolor="#CCCCEE" onClick="change_color('tr_vpt','#CCCCEE')" id="tr_vpt" style="font-weight:bold;">
                <td width="40">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="60">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="100">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="80">&nbsp;</td>
                <td width="110">&nbsp;</td>
                <td width="120" align=""></td>
                <td width="90"  align="right">&nbsp;</td>
                <td width="50">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="110" align="right">&nbsp;</td>
                <td width="100"  align="right">&nbsp;</td>
                <td width="80">&nbsp;</td>
                <td width="100">&nbsp;</td>
                <td width="100">Variance (%) Total</td>
                <td width="100" align="right" ><? echo fn_number_format($tot_variance_qnty_per,0,'.',''); ?></td>
                <td width="110" align="right" ><? echo fn_number_format($tot_variance_po_value_per,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_variance_yarn_cost_per,2,'.',''); ?></td>
                <td width="100" align="right"><? echo fn_number_format($tot_variance_yarn_value_addition_cost_per,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_variance_knit_cost_per,2,'.',''); ?></td>
                <td width="100" title="Grey Fabric Transfer Cost" align="right"><? //echo fn_number_format($tot_variance_knit_cost_per,2,'.',''); ?></td>
                
               <td width="100" title="Grey Fabric Cost" align="right"><? echo fn_number_format($tot_variance_grey_fab_cost_per,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_variance_dye_finish_cost_per ,2,'.',''); ?></td>
               
                <td width="110"  align="right"><? echo fn_number_format($tot_variance_aop_cost_per,2,'.',''); ?></td>
                 <td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($tot_variance_aop_cost_per,2,'.',''); ?></td>
                 <td width="100"  title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($tot_variance_fin_fabric_purchase_cost_per,2,'.',''); ?></td>
                 <td width="110" align="right"><? echo fn_number_format($tot_variance_fabric_purchase_cost_per ,2,'.',''); ?></td>
                 <td width="100"  title="Finished Fabric Cost"  align="right"><? echo fn_number_format($tot_variance_fin_fab_cost_per,2,'.',''); ?></td>
                  <td width="100"  title="Total Fabric Cost"  align="right"><? echo fn_number_format($tot_variance_fabric_cost_mkt_per,2,'.',''); ?></td>
                <td width="110"  align="right"><? echo fn_number_format($tot_variance_trims_cost_per,2,'.',''); ?></td>
                 <td width="100"  title="Garment Printing Cost" align="right"><? echo fn_number_format($tot_variance_print_per,2,'.',''); ?></td>
                 <td width="100"  title="Garment Embro Cost" align="right"><? echo fn_number_format($tot_variance_embro_cost_per,2,'.',''); ?></td>
                 <td width="100"  title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_variance_dyeing_cost_per,2,'.',''); ?></td>
                 <td width="100"  title="Garment Wash Cost" align="right"><? echo fn_number_format($tot_variance_wash_cost_per,2,'.',''); ?></td>
                  
               
                <td width="100"  align="right"><? echo fn_number_format($tot_variance_commission_cost_per,2,'.',''); ?></td>
                <td width="100" align="right"><? echo fn_number_format($tot_variance_comm_cost_per,2,'.',''); ?></td>
                <td width="100" align="right"><? echo fn_number_format($tot_variance_freight_cost_per,2,'.',''); ?></td>
                <td width="100" align="right"><? echo fn_number_format($tot_variance_test_cost_per,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_variance_inspection_cost_per,2,'.',''); ?></td>
                <td width="100" align="right"><? echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
                
                 <td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
                 <td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
                 <td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
                 <td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
                 <td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
              
                 
                 
                <td width="100"  align="right"><? echo fn_number_format($tot_variance_cm_cost_per,2,'.',''); ?></td>
                
                 <td width="100" align="right" title="Interest"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
                 <td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
                 <td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
                
                
                <td width="100"  align="right"><? echo fn_number_format($tot_variance_all_cost_per,2,'.',''); ?></td>
                <td width="100" align="right"><? echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_variance_per_cost_per,2,'.',''); ?></td>
                 <td width="100" align="right"><? //echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
                  <td width="" align="right"><? //echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
            </tr>
        </table>
        <br />
        <table width="4330">
            <tr>
                <td width="850" valign="top">
                    <div align="center" style="width:450px" id="div_summary"><input type="button" value="Print Preview" class="formbutton" onClick="new_window2('company_div','summary_full')" /></div>
                    <br /><? $po_ids=implode(',',$po_ids_array);$job_ids=rtrim($job_ids,','); $job_nos=implode(',',array_unique(explode(",",$job_ids))); ?>
                    <div id="summary_full"> <font color="#FF0000" style="display:none">*Yarn Dyeing Charge included with actual Yarn Cost</font>
                        <div align="center" id="company_div" style="visibility:hidden; font-size:24px;width:700px"><b><? echo $company_arr[$company_name].'<br>'; 
						echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to));
						?></b></div>
                        <table width="850" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
                            <thead>
                            <tr>
                                <th colspan="9">Summary</th>
                            </tr>
                            <tr>
                                <th width="30">SL</th>
                                <th width="180">Particulars</th>
                                <th width="130">Pre Costing</th>
                                <th width="80">%</th>
                                <th width="130">At Actual</th>
                                <th width="80">%</th>
                                <th width="80">Variance</th>
                                <th width="80">%</th>
                                <th>Disclosure</th>
                            </tr> 
							<?
								$bgcolor1='#E9F3FF';
								$bgcolor2='#FFFFFF';
							?>
                            </thead>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_1','<? echo $bgcolor1; ?>')" id="trtd_1">
                                <td align="center">1</td>
                                <td>PO/Shipment Value</td>
                                <td align="right"><? echo fn_number_format($tot_po_value,2); ?></td>
                                <td align="right">&nbsp;</td>
                                <td align="right"><? echo fn_number_format($tot_ex_factory_val,2); ?></td>
                                <td align="right">&nbsp;</td>
                                <td align="right"><? echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                                <td align="right"  title="Variance/PO-Shipment Value Mkt*100"><? echo fn_number_format((($tot_ex_factory_val-$tot_po_value)/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_2','<? echo $bgcolor2; ?>')" id="trtd_2">
                                <td colspan="9"><b>Cost</b></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_3','<? echo $bgcolor1; ?>')" id="trtd_3">
                                <td align="center">2</td>
                                <td>Grey Yarn Cost</td>
                                <td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_cost','Grey Yarn Mkt. Cost Details')"><? echo fn_number_format($tot_yarn_cost_mkt,2); //$tot_yarn_qty_actual?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_cost_actual','Yarn Cost Details')"><? echo fn_number_format($tot_yarn_cost_actual,2); //$tot_yarn_qty_actual;?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_yarn_cost_mkt-$tot_yarn_cost_actual,2);//$tot_yarn_amt_actual ?></td>
                                <td align="right"  title="Variance/Grey Yarn Cost Mkt*100"><? echo fn_number_format((($tot_yarn_cost_mkt-$tot_yarn_cost_actual)/$tot_yarn_cost_mkt)*100,2); ?></td>
                                 <td align="right"><?  if($tot_yarn_qty_actual>$tot_yarn_cost_mkt) echo "Returnable Yarn Qty..".$tot_yarn_qty_actual."And Cost..".$tot_yarn_amt_actual; else echo " ";?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_4','<? echo $bgcolor2; ?>')" id="trtd_4">
                                <td align="center">3</td>
                                <td>Yarn  Value Addition Cost</td>
                                <td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_dyeing_twisting_cost','Yarn Dyeing Cost Details')"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></a><? //echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_dye_twist_cost_actual','Yarn Dyeing & Twist Cost Details','2','900px')"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual,2); ?></td>
                                 <td align="right" title="Variance/Yarn Value  Addition Cost Mkt*100"><? echo fn_number_format((($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual)/$tot_yarn_value_addition_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_5','<? echo $bgcolor2; ?>')" id="trtd_5">
                                <td align="center">4</td>
                                <td>Knitting Cost</td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knit_cost_actual','Knitting Cost Details')"><? echo fn_number_format($tot_knit_cost_actual,2); ?></a><? //echo fn_number_format($tot_knit_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Knitting Cost Mkt*100"><? echo fn_number_format((($tot_knit_cost_mkt-$tot_knit_cost_actual)/$tot_knit_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_6','<? echo $bgcolor2; ?>')" id="trtd_6">
                                <td align="center">5</td>
                                <td>Grey Fabric Transfer Cost</td>
                                <td align="right"><? //echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></a><? echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
                                 <td align="right"><? echo ""; ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_7','<? echo $bgcolor2; ?>')" id="trtd_7">
                                <td align="center">6</td>
                                <td>Grey Fabric Cost =2+3+4+5</td>
                                <td align="right"><? 
								$grey_fab_cost_mkt_sum=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt;
								$grey_fab_cost_act_sum=$tot_yarn_cost_actual+$tot_yarn_dyeing_twist_actual+$tot_knit_cost_actual+$tot_grey_fab_transfer_amt_actual;
								
								echo fn_number_format($grey_fab_cost_mkt_sum,2); ?></td>
                                <td align="right"><? echo fn_number_format(($grey_fab_cost_mkt_sum/$tot_po_value)*100,2); ?></td>
                                <td align="right" title=""><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_cost_actual,2); ?></a><? echo fn_number_format($grey_fab_cost_act_sum,2); ?></td>
                                <td align="right"><? echo fn_number_format(($grey_fab_cost_act_sum/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum,2); ?></td>
                                 <td align="right" title="Variance/Grey Fab Cost Mkt*100"><? echo fn_number_format((($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum)/$grey_fab_cost_mkt_sum)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_8','<? echo $bgcolor2; ?>')" id="trtd_8">
                                <td align="center">7</td>
                                <td>Dye & Fin Cost</td>
                                <td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dye_finish_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $po_ids; ?>','dye_finish_cost_actual','Actual Dyeing & Finish Cost Details','900px')"><? echo fn_number_format($tot_dye_finish_cost_actual,2,'.',''); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_dye_finish_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Dye & Fin Cost Mkt*100"><?  echo fn_number_format((($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual)/$tot_dye_finish_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_9','<? echo $bgcolor1; ?>')" id="trtd_9">
                                <td align="center">8</td>
                                <td>AOP  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/AOP Cost Mkt*100"><? echo fn_number_format((($tot_aop_cost_mkt-$tot_aop_cost_actual)/$tot_aop_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_10','<? echo $bgcolor2; ?>')" id="trtd_10">
                                <td align="center">9</td>
                                <td>Finished Fabric Transfer Cost</td>
                                <td align="right"><? //echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
                                <td align="right"><? // echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
                                 <td align="right"><? echo " "; ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_11','<? echo $bgcolor1; ?>')" id="trtd_11">
                                <td align="center">10</td>
                                <td>Finished Fabric Cost =6+7+8+9</td>
                                <td align="right"><? $tot_fin_fab_cost_sum_mkt=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
								//$tot_fin_fabCost=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
								echo fn_number_format($tot_fin_fab_cost_sum_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? $tot_fin_fab_cost_sum_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual;
								echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual,2); ?></td>
                                 <td align="right" title="Variance/Finished Fabric Cost Mkt*100"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual)/$tot_fin_fab_cost_sum_mkt)*100,2);  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_12','<? echo $bgcolor2; ?>')" id="trtd_12">
                                <td align="center">11</td>
                                <td>Fabric Purchase Cost</td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','fabric_purchase_cost','Fabric Purchase Cost Details')"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Fabric Purchase Cost Mkt*100"><? echo fn_number_format((($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual)/$tot_fabric_purchase_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_27','<? echo $bgcolor2; ?>')" id="trtd_27">
                                <td align="center">12</td>
                                <td>Total Fabric Cost(=10+11)</td>
                                <td align="right"><? $tot_fab_cost_mkt=$tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt;
								echo fn_number_format($tot_fab_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? 
								$tot_fabric_cost_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual;
								echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? $tot_fab_cost_vairance=($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual;
								echo fn_number_format(($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual,2); ?></td>
                                 <td align="right"><?  echo fn_number_format(($tot_fab_cost_vairance/$tot_fab_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? echo ' '; ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_13','<? echo $bgcolor1; ?>')" id="trtd_13">
                                <td align="center">13</td>
                                <td>Trims Cost</td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_mkt-$tot_trims_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Trim Cost Mkt*100"><? echo fn_number_format((($tot_trims_cost_mkt-$tot_trims_cost_actual)/$tot_trims_cost_mkt)*100,2);  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_14','<? echo $bgcolor2; ?>')" id="trtd_14">
                                <td align="center">14</td>
                                <td>Printing Cost</td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_mkt,2); ?></td>
                                <td align="right"><?  echo fn_number_format(($tot_print_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_mkt-$tot_print_amount_actual,2); ?></td>
                                <td align="right" title="Variance/Printing Cost Mkt*100"><?  echo fn_number_format((($tot_print_amount_mkt-$tot_print_amount_actual)/$tot_print_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_15','<? echo $bgcolor1; ?>')" id="trtd_15">
                                <td align="center">15</td>
                                <td> Embroidery Cost</td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_embro_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_embro_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_mkt-$tot_embro_amount_actual,2); ?></td>
                                 <td align="right" title="Variance/Embroidery Cost Mkt*100"><?  echo fn_number_format((($tot_embro_amount_mkt-$tot_embro_amount_actual)/$tot_embro_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_16','<? echo $bgcolor2; ?>')" id="trtd_16">
                                <td align="center">16</td>
                                <td>Gmt Dyeing  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dyeing_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dyeing_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual,2); ?></td>
                                 <td align="right" title="Variance/Gmt Dyeing Cost Mkt*100"><?  echo fn_number_format((($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual)/$tot_dyeing_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_17','<? echo $bgcolor1; ?>')" id="trtd_17">
                                <td align="center">17</td>
                                <td>Washing  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_wash_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_wash_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_mkt-$tot_wash_amount_actual,2); ?></td>
                                <td align="right" title="Variance/Washing Cost Mkt*100"><?  echo fn_number_format((($tot_wash_amount_mkt-$tot_wash_amount_actual)/$tot_wash_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_18','<? echo $bgcolor2; ?>')" id="trtd_18">
                                <td align="center">18</td>
                                <td>Commission Cost</td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_commission_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_commission_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_mkt-$tot_commission_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Commission Cost Mkt*100"><?  echo fn_number_format((($tot_commission_cost_mkt-$tot_commission_cost_actual)/$tot_commission_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_19','<? echo $bgcolor1; ?>')" id="trtd_19">
                                <td align="center">19</td>
                                <td>Commercial Cost</td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_comm_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_comm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_mkt-$tot_comm_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Commercial Cost Mkt*100"><?  echo fn_number_format((($tot_comm_cost_mkt-$tot_comm_cost_actual)/$tot_comm_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_20','<? echo $bgcolor2; ?>')" id="trtd_20">
                                <td align="center">20</td>
                                <td>Freight Cost</td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_freight_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_freight_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_mkt-$tot_freight_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Freight Cost Mkt*100"><?  echo fn_number_format((($tot_freight_cost_mkt-$tot_freight_cost_actual)/$tot_freight_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_21','<? echo $bgcolor1; ?>')" id="trtd_21">
                                <td align="center">21</td>
                                <td>Testing Cost</td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_test_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_test_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_mkt-$tot_test_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Testing Cost Mkt*100"><?  echo fn_number_format((($tot_test_cost_mkt-$tot_test_cost_actual)/$tot_test_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_22','<? echo $bgcolor2; ?>')" id="trtd_22">
                                <td align="center">22</td>
                                <td>Inspection Cost</td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_inspection_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_inspection_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_mkt-$tot_inspection_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Inspection Cost Mkt*100"><?  echo fn_number_format((($tot_inspection_cost_mkt-$tot_inspection_cost_actual)/$tot_inspection_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_23','<? echo $bgcolor1; ?>')" id="trtd_23">
                                <td align="center">23</td>
                                <td>Courier Cost</td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_currier_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_currier_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_mkt-$tot_currier_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Courier Cost Mkt*100"><?  echo fn_number_format((($tot_currier_cost_mkt-$tot_currier_cost_actual)/$tot_currier_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_24','<? echo $bgcolor1; ?>')" id="trtd_23">
                                <td align="center">24</td>
                                <td>Certificate Cost</td>
                                <td align="right"><? echo fn_number_format($tot_certificate_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_certificate_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_certificate_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_certificate_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_certificate_cost_mkt-$tot_certificate_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_certificate_cost_mkt-$tot_certificate_cost_actual)/$tot_certificate_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                             <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_25','<? echo $bgcolor1; ?>')" id="trtd_25">
                                <td align="center">25</td>
                                <td>Deffd. LC Cost</td>
                                <td align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_deffdlc_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_deffdlc_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_deffdlc_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt-$tot_deffdlc_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_deffdlc_cost_mkt-$tot_deffdlc_cost_actual)/$tot_deffdlc_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_26','<? echo $bgcolor1; ?>')" id="trtd_26">
                                <td align="center">26</td>
                                <td>Design Cost</td>
                                <td align="right"><? echo fn_number_format($tot_design_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_design_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_design_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_design_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_design_cost_mkt-$tot_design_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_design_cost_mkt-$tot_design_cost_actual)/$tot_design_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                              <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_27','<? echo $bgcolor1; ?>')" id="trtd_27">
                                <td align="center">27</td>
                                <td>Studio  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_studio_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_studio_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_studio_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_studio_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_studio_cost_mkt-$tot_studio_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_studio_cost_mkt-$tot_studio_cost_actual)/$tot_studio_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_28','<? echo $bgcolor1; ?>')" id="trtd_28">
                                <td align="center">28</td>
                                <td>Opert. Exp.</td>
                                <td align="right"><? echo fn_number_format($tot_operating_exp_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_operating_exp_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_operating_exp_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_operating_exp_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_operating_exp_mkt-$tot_operating_exp_actual,2); ?></td>
                                 <td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_operating_exp_mkt-$tot_operating_exp_actual)/$tot_operating_exp_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                            
                            
                            
                            
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_24','<? echo $bgcolor2; ?>')" id="trtd_24">
                                <td align="center">29</td>
                                <td>CM</td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_cm_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_cm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_mkt-$tot_cm_cost_actual,2); ?></td>
                                <td align="right" title="Variance/CM Cost Mkt*100"><?  echo fn_number_format((($tot_cm_cost_mkt-$tot_cm_cost_actual)/$tot_cm_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_30','<? echo $bgcolor1; ?>')" id="trtd_30">
                                <td align="center">30</td>
                                <td>Interest</td>
                                <td align="right"><? echo fn_number_format($tot_interest_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_interest_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_interest_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_interest_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_interest_cost_mkt-$tot_interest_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_interest_cost_mkt-$tot_interest_cost_actual)/$tot_interest_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_31','<? echo $bgcolor1; ?>')" id="trtd_31">
                                <td align="center">31</td>
                                <td>Income Tax</td>
                                <td align="right"><? echo fn_number_format($tot_incometax_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_incometax_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_incometax_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_incometax_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_incometax_cost_mkt-$tot_incometax_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_incometax_cost_mkt-$tot_incometax_cost_actual)/$tot_incometax_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_31','<? echo $bgcolor1; ?>')" id="trtd_31">
                                <td align="center">32</td>
                                <td>Depc. & Amort.</td>
                                <td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_depr_amor_pre_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_depr_amor_pre_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt-$tot_depr_amor_pre_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_depr_amor_pre_cost_mkt-$tot_depr_amor_pre_cost_actual)/$tot_depr_amor_pre_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_33','<? echo $bgcolor1; ?>')" id="trtd_33">
                                <td align="center">33</td>
                                <td>Total Cost</td>
                                <td align="right"><? echo fn_number_format($tot_mkt_all_cost,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_mkt_all_cost/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_all_cost,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_actual_all_cost/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_mkt_all_cost-$tot_actual_all_cost,2); ?></td>
                                <td align="right" title="Variance/Total Cost Mkt*100"><?  echo fn_number_format((($tot_mkt_all_cost-$tot_actual_all_cost)/$tot_mkt_all_cost)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_34,'<? echo $bgcolor2; ?>')" id="trtd_34">
                                <td align="center">34</td>
                                <td>Margin/Loss</td>
                                <td align="right"><? echo fn_number_format($tot_mkt_margin,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_margin,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
                                <td align="right" title="Variance/Margin/Loss Mkt*100"><?  echo fn_number_format((($tot_mkt_margin-$tot_actual_margin)/$tot_mkt_margin)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_35','<? echo $bgcolor2; ?>')" id="trtd_35">
                                <td align="center">35</td>
                                <td>CPA/Short Fabric Cost</td>
                                <td align="right"><? //echo fn_number_format($tot_mkt_margin,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_yarn_qty_cpa_actual,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
                                <td align="right"><?  echo ' '; ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_36','<? echo $bgcolor2; ?>')" id="trtd_36">
                                <td align="center">36</td>
                                <td>Net Margin/Loss(=34-35)</td>
                                <td align="right"><? //echo fn_number_format($tot_mkt_margin,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_margin-$tot_yarn_qty_cpa_actual,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
                                 <td align="right"><?  echo ' ';  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                        </table>
                    </div>
                </td>
                <td width="525" align="center" valign="top" style="display:none">
                    <div align="center" style="width:500px; height:53px" id="graph">&nbsp;</div>
                    <fieldset style="text-align:center; width:450px" > 
                    	<legend>Chart</legend>
                    </fieldset>
                </td>   
                <td width="" valign="top">
                    <div align="center" style="width:600px" id="div_buyer"><input type="button" value="Print Preview" class="formbutton" onClick="new_window2('company_div_b','summary_buyer')" /></div>
                    <br />
                    <div id="summary_buyer">
                        <div align="center" id="company_div_b" style="visibility:hidden; font-size:24px;width:2305px"><b><? echo $company_arr[$company_name].'<br>';echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to)); ?></b></div>
                        <table width="100%" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
                            <thead>
                                 <tr>
                                    <th colspan="38">Buyer Level Summary</th>
                                </tr>
                                <tr>
                                    <th width="35">SL</th>
                                    <th width="70">Buyer name</th>
                                    <th width="110">Cost Source</th>
                                    <th width="110">Ex-Factory Value</th>
                                   
                                    <th width="100">Yarn Value Addition Cost</th>
                                    <th width="110">Grey Yarn cost</th>
                                    <th width="110">Knitting Cost</th>
                                    <th width="100">Grey Fabric Transfer Cost</th>
                                   
                                    <th width="110">Grey Fabric Purchase Cost</th>
                                    <th width="100">Grey Fabric Cost</th>
                                    <th width="110">Dye & Fin Cost</th>
                                    <th width="110">AOP</th>
                                    <th width="100">Fin. Fab. Transfer Cost</th>
                                    <th width="100">Fin. Fabric Purchase Cost</th>
                                    <th width="100">Fin. Fabric Cost</th>
                                    <th width="110">Trims Cost</th>
                                    <th width="100">Printing Cost</th>
                                    <th width="100">Embroidery Cost</th>
                                    <th width="100">Dyeing  Cost</th>
                                   
                                    <th width="100">Washing  Cost</th>
                                        
                                   
                                    <th width="110">Commission Cost</th>
                                    <th width="100">Commercial Cost</th>
                                    <th width="110">Freight Cost</th>
                                    <th width="100">Testing Cost</th>
                                    <th width="100">Inspection Cost</th>
                                    <th width="100">Courier Cost</th>
                                   
                                    <th width="100">Certificate Cost</th>
                                    <th width="100">Deffd. LC Cost</th>
                                    <th width="100">Design Cost</th>
                                    <th width="100">Studio Cost</th>
                                    <th width="100">Opert. Exp.</th>
                                     
                                    <th width="110">CM Cost</th>
                                    
                                     <th width="100">Interest</th>
                                     <th width="100">Income Tax</th>
                                     <th width="100">Depc. & Amort.</th>
                                     
                                       
                                    
                                    <th width="110">Total Cost</th>
                                    <th width="110">Margin</th>
                                    <th width="90">Margin %</th>
                                </tr>
                            </thead>
                            <?
                                $j=1;$tot_fin_fab_transfer_amt_actual=$tot_mkt_print_cost=$tot_mkt_embro_cost=$tot_mkt_dyeing_cost=$tot_mkt_wash_cost=$tot_mkt_value_addition_cost=0;
                                foreach($buyer_name_array as $key=>$value)
                                {
                                    if ($j%2==0)  
                                        $bgcolor="#E9F3FF";
                                    else
                                        $bgcolor="#FFFFFF";	
                                ?>
                                    <tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD_<? echo $j; ?>">
                                        <td rowspan="4"><? echo $j ;?></td>
                                        <td rowspan="4"><? echo $value ;?></td>
                                        <td><b>Pre Costing</b></td>
                                        <td align="right"><? echo fn_number_format($mkt_po_val_array[$key],2); $tot_mkt_po_val+=$mkt_po_val_array[$key];  ?></td>
                                      
                                        <td align="right"><? echo fn_number_format($mkt_yarn_value_addition_array[$key],2); $tot_mkt_value_addition_cost+=$mkt_yarn_value_addition_array[$key]; ?></td>
                                        
                                        <td align="right"><? echo fn_number_format($mkt_yarn_array[$key],2); $tot_mkt_yarn_cost+=$mkt_yarn_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_knit_array[$key],2); $tot_mkt_knit_cost+=$mkt_knit_array[$key]; ?></td>
                                         <td align="right"><? //echo fn_number_format($mkt_yarn_array[$key],2); $tot_mkt_yarn_cost+=$mkt_yarn_array[$key]; ?></td>
                                       
                                        <td align="right"><? echo fn_number_format($mkt_fabric_purchase_array[$key],2); $tot_mkt_fin_pur_cost+=$mkt_fabric_purchase_array[$key];?></td>
                                         <td align="right"><? echo fn_number_format($mkt_grey_fab_cost_array[$key],2); $tot_mkt_grey_fab_cost+=$mkt_grey_fab_cost_array[$key];?></td>
                                          <td align="right"><? echo fn_number_format($mkt_dy_fin_array[$key],2); $tot_mkt_dy_fin_cost+=$mkt_dy_fin_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_aop_array[$key],2); $tot_mkt_aop_cost+=$mkt_aop_array[$key]; ?></td>
                                        <td align="right"><? //echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2);$tot_mkt_fin_fabric_purchase+=$mkt_fin_fabric_purchase_array[$key]; ?></td>
                                        <td align="right"><?  echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2);$tot_mkt_fin_fabric_purchase+=$mkt_fin_fabric_purchase_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2); ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_trims_array[$key],2); $tot_mkt_trims_cost+=$mkt_trims_array[$key]; ?></td>
                                         
                                         <td align="right"><? echo fn_number_format($mkt_print_array[$key],2); $tot_mkt_print_cost+=$mkt_print_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_embro_array[$key],2); $tot_mkt_embro_cost+=$mkt_embro_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_dyeing_array[$key],2); $tot_mkt_dyeing_cost+=$mkt_dyeing_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_wash_array[$key],2); $tot_mkt_wash_cost+=$mkt_wash_array[$key]; ?></td>
                                                
                                       
                                        <td align="right"><? echo fn_number_format($mkt_commn_array[$key],2); $tot_mkt_commn_cost+=$mkt_commn_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_commercial_array[$key],2); $tot_mkt_commercial_cost+=$mkt_commercial_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_freight_array[$key],2); $tot_mkt_freight_cost+=$mkt_freight_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_test_array[$key],2); $tot_mkt_test_cost+=$mkt_test_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_ins_array[$key],2); $tot_mkt_ins_cost+=$mkt_ins_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_courier_array[$key],2); $tot_mkt_courier_cost+=$mkt_courier_array[$key]; ?></td>
                                        
                                         <td align="right"><? echo fn_number_format($mkt_certificate_array[$key],2); $tot_mkt_certificate_cost+=$mkt_certificate_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_deffdlc_array[$key],2); $tot_mkt_deffdlc_cost+=$mkt_deffdlc_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_design_array[$key],2); $tot_mkt_design_cost+=$mkt_design_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_studio_array[$key],2); $tot_mkt_studio_cost+=$mkt_studio_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_operating_array[$key],2); $tot_mkt_operating_cost+=$mkt_operating_array[$key]; ?></td>
                                          
                                       
                                        <td align="right"><? echo fn_number_format($mkt_cm_array[$key],2); $tot_mkt_cm_cost+=$mkt_cm_array[$key]; ?></td>
                                        
                                         <td align="right"><? echo fn_number_format($mkt_interest_array[$key],2); $tot_mkt_interest_cost+=$mkt_interest_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_incometax_array[$key],2); $tot_mkt_incometax_cost+=$mkt_incometax_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($mkt_depr_amor_array[$key],2); $tot_mkt_depr_amor_cost+=$mkt_depr_amor_array[$key]; ?></td>
                                        
                                        <td align="right"><? echo fn_number_format($mkt_total_array[$key],2); $tot_mkt_total_cost+=$mkt_total_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($mkt_margin_array[$key],2); $tot_mkt_margin_cost+=$mkt_margin_array[$key]; ?></td>
                                        <td align="right"><? $mkt_margin_perc=($mkt_margin_array[$key]/$mkt_po_val_array[$key])*100; echo fn_number_format($mkt_margin_perc,2); $tot_mkt_margin_perc_cost+=$mkt_margin_perc; ?></td> 
                                    </tr>
                                    <tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD2_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD2_<? echo $j; ?>">
                                        <td><b>Actual</b></td>
                                        <td align="right"><? echo fn_number_format($ex_factory_val_array[$key],2); $tot_buyer_ex_factory_val+=$ex_factory_val_array[$key];  ?></td>
                                        
                                        <td align="right"><? echo fn_number_format($yarn_dyeing_twist_array[$key],2); $tot_yarn_dyeing_twist_cost+=$yarn_dyeing_twist_array[$key]; ?></td>
                                        
                                        <td align="right"><? echo fn_number_format($yarn_cost_array[$key],2); $tot_buyer_yarn_cost+=$yarn_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($knit_cost_array[$key],2); $tot_buyer_knit_cost+=$knit_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($grey_fab_cost_array[$key],2); $tot_grey_fab_cost+=$grey_fab_cost_array[$key]; ?></td>
                                        
                                         <td align="right"><? echo fn_number_format($actual_fabric_purchase_array[$key],2); $tot_buyer_fin_pur_act_cost+=$actual_fabric_purchase_array[$key]; ?></td>
                                       <td align="right" title="Grey Feb Cost"><? echo fn_number_format($grey_fab_cost_array[$key],2); $tot_grey_fab_cost_act+=$grey_fab_cost_array[$key];?></td>
                                       <td align="right"><? echo fn_number_format($dye_cost_array[$key],2); $tot_buyer_dye_cost+=$dye_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($aop_n_others_cost_array[$key],2); $tot_buyer_aop_n_others_cost+=$aop_n_others_cost_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($fin_fab_transfer_amt_actual_array[$key],2); $tot_fin_fab_transfer_amt_actual+=$fin_fab_transfer_amt_actual_array[$key]; ?></td>
                                          <td align="right"><? echo fn_number_format($actual_fabric_purchase_array[$key],2); $tot_act_fin_fabric_purchase_cost+=$actual_fabric_purchase_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($finished_fab_cost_actual_array[$key],2); $tot_finished_fab_cost_actual_buy+=$finished_fab_cost_actual_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($trims_cost_array[$key],2); $tot_buyer_trims_cost+=$trims_cost_array[$key]; ?></td>
                                          <td align="right"><? echo fn_number_format($print_act_cost_array[$key],2); $tot_act_print_cost+=$print_act_cost_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($embro_act_cost_array[$key],2); $tot_act_embro_cost+=$embro_act_cost_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($dyeing_act_cost_array[$key],2); $tot_act_dyeing_cost+=$dyeing_act_cost_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($wash_act_cost_array[$key],2); $tot_act_wash_cost+=$wash_act_cost_array[$key]; ?></td>
                                         
                                      
                                        <td align="right"><? echo fn_number_format($commission_cost_array[$key],2); $tot_buyer_commi_cost+=$commission_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($commercial_cost_array[$key],2); $tot_buyer_commercial_cost+=$commercial_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($freight_cost_array[$key],2); $tot_buyer_freight_cost+=$freight_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($testing_cost_array[$key],2); $tot_buyer_testing_cost+=$testing_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($inspection_cost_array[$key],2); $tot_buyer_inspection_cost+=$inspection_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($courier_cost_array[$key],2); $tot_buyer_courier_cost+=$courier_cost_array[$key]; ?></td>
                                       
                                      	 <td align="right"><? echo fn_number_format($acl_certificate_array[$key],2); $tot_acl_certificate_cost+=$acl_certificate_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($acl_deffdlc_array[$key],2); $tot_acl_deffdlc_cost+=$acl_deffdlc_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($acl_design_array[$key],2); $tot_acl_design_cost+=$acl_design_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($acl_studio_array[$key],2); $tot_acl_studio_cost+=$acl_studio_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($acl_operating_array[$key],2); $tot_acl_operating_cost+=$acl_operating_array[$key]; ?></td>
                                        
                                        <td align="right"><? echo fn_number_format($cm_cost_array[$key],2); $tot_buyer_cm_cost+=$cm_cost_array[$key]; ?></td>
                                        
                                        <td align="right"><? echo fn_number_format($acl_interest_array[$key],2); $tot_acl_interest_cost+=$acl_interest_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($acl_incometax_array[$key],2); $tot_acl_incometax_cost+=$acl_incometax_array[$key]; ?></td>
                                         <td align="right"><? echo fn_number_format($acl_depr_amor_array[$key],2); $tot_acl_depr_amor_cost+=$acl_depr_amor_array[$key]; ?></td>
                                           
                                        <td align="right"><? echo fn_number_format($total_cost_array[$key],2); $tot_buyer_total_cost+=$total_cost_array[$key]; ?></td>
                                        <td align="right"><? echo fn_number_format($margin_array[$key],2); $tot_buyer_margin_cost+=$margin_array[$key]; ?></td>
                                        <td align="right"><? $margin_perc=($margin_array[$key]/$ex_factory_val_array[$key])*100; echo fn_number_format($margin_perc,2); $tot_buyer_margin_perc_cost+=$margin_perc; ?></td> 
                                    </tr>
                                    <tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD3_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD3_<? echo $j; ?>">
                                        <td><b>Variance</b></td>
                                        <td align="right">
                                        <?
                                            $ex_var= $mkt_po_val_array[$key]-$ex_factory_val_array[$key];
                                            echo fn_number_format($ex_var,2); 
                                        ?>
                                        </td>
                                         
                                         <td align="right">
                                        <?
                                           $yarn_value_addition_var= $mkt_yarn_value_addition_array[$key]-$yarn_dyeing_twist_array[$key];
                                            echo fn_number_format($yarn_value_addition_var,2);
                                        ?>
                                        </td>
                                        
                                        <td align="right">
                                        <?
                                            $yarn_var= $mkt_yarn_array[$key]-$yarn_cost_array[$key];
                                            echo fn_number_format($yarn_var,2);
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $knit_var= $mkt_knit_array[$key]-$knit_cost_array[$key];
                                            echo fn_number_format($knit_var,2); 
                                        ?>
                                        </td>
                                         <td align="right">
                                        <?
                                           // $yarn_var= $mkt_yarn_array[$key]-$yarn_cost_array[$key];
                                           // echo fn_number_format($yarn_var,2);
                                        ?>
                                        </td>
                                       
                                        <td align="right">
                                        <?
                                            $fin_pur_var= $mkt_fabric_purchase_array[$key]-$actual_fabric_purchase_array[$key];
                                            echo fn_number_format($fin_pur_var,2); 
                                        ?>
                                        </td>
                                       <td align="right" title="grey Feb Cost"><? 
									   $grey_feb_var=$mkt_grey_fab_cost_array[$key]-$grey_fab_cost_array[$key];echo fn_number_format($grey_feb_var,2);?></td>
                                        <td align="right">
                                        <?
                                            $dy_var= $mkt_dy_fin_array[$key]-$dye_cost_array[$key];
                                            echo fn_number_format($dy_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $aop_var= $mkt_aop_array[$key]-$aop_n_others_cost_array[$key];
                                            echo fn_number_format($aop_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                           // $fin_fab_pur_var=$mkt_fin_fabric_purchase_array[$key]-$fin_fab_transfer_amt_actual_array[$key];
                                            //echo fn_number_format($fin_fab_pur_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $fin_feb_pur_var=$mkt_fin_fabric_purchase_array[$key]-$tot_act_fin_fabric_purchase_cost[$key];
                                           echo fn_number_format($fin_feb_pur_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                       
                                        <?
                                            $totfin_fab_var= $mkt_fin_fabric_purchase_array[$key]-$finished_fab_cost_actual_array[$key];
                                            echo fn_number_format($totfin_fab_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $trims_var= $mkt_trims_array[$key]-$trims_cost_array[$key];
                                            echo fn_number_format($trims_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $print_var= $mkt_print_array[$key]-$print_act_cost_array[$key];
                                            echo fn_number_format($print_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                           $embro_var= $mkt_embro_array[$key]-$embro_act_cost_array[$key];
										  
                                           echo fn_number_format($embro_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                           $dyeing_var= $mkt_dyeing_array[$key]-$dyeing_act_cost_array[$key];
                                            echo fn_number_format($dyeing_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $wash_var= $mkt_wash_array[$key]-$wash_act_cost_array[$key];
                                            echo fn_number_format($wash_var,2); 
                                        ?>
                                        </td>
                                        
                                       
                                        <td align="right">
                                        <?
                                            $com_var= $mkt_commn_array[$key]-$commission_cost_array[$key];
                                            echo fn_number_format($com_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $commer_var= $mkt_commercial_array[$key]-$commercial_cost_array[$key];
                                            echo fn_number_format($commer_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $fr_var= $mkt_freight_array[$key]-$freight_cost_array[$key];
                                            echo fn_number_format($fr_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $test_var= $mkt_test_array[$key]-$testing_cost_array[$key];
                                            echo fn_number_format($test_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $ins_var= $mkt_ins_array[$key]-$inspection_cost_array[$key];
                                            echo fn_number_format($ins_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                            echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                        
                                        <td align="right">
                                        <?
                                          //  $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                           // echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                          <td align="right">
                                        <?
                                          //  $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                           // echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                          <td align="right">
                                        <?
                                          //  $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                           // echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                          <td align="right">
                                        <?
                                          //  $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                           // echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                          <td align="right">
                                        <?
                                          //  $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                           // echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                        
                                        
                                        <td align="right">
                                        <?
                                            $cm_var= $mkt_cm_array[$key]-$cm_cost_array[$key];
                                            echo fn_number_format($cm_var,2); 
                                        ?>
                                        </td>
                                         <td align="right" title="Interest">
                                        <?
                                          //  $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                           // echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                         <td align="right">
                                        <?
                                          //  $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                           // echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                         <td align="right">
                                        <?
                                          //  $cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
                                           // echo fn_number_format($cour_var,2); 
                                        ?>
                                        </td>
                                        
                                        <td align="right">
                                        <?
                                            $tot_var= $mkt_total_array[$key]-$total_cost_array[$key];
                                            echo fn_number_format($tot_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $mar_var= $mkt_margin_array[$key]-$margin_array[$key];
                                            echo fn_number_format($mar_var,2); 
                                        ?>
                                        </td>
                                        <td align="right">
                                        <?
                                            $margin_perc_to= $mkt_margin_perc-$margin_perc;
                                            echo fn_number_format($margin_perc_to,2); 
                                        ?>
                                        </td>
                                    </tr>
                                    <tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD4_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD4_<? echo $j; ?>">
                                        <td><b>Variance (%)</b></td>
                                        <td align="right"><? echo fn_number_format(($ex_var/$mkt_po_val_array[$key]*100),2); ?></td>
                                      
                                         <td align="right"><? echo fn_number_format(($yarn_value_addition_var/$mkt_yarn_value_addition_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($yarn_var/$mkt_yarn_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($knit_var/$mkt_knit_array[$key]*100),2); ?></td>
                                        <td align="right"><? //echo fn_number_format(($ex_var/$mkt_po_val_array[$key]*100),2); ?></td>
                                      
                                        <td align="right"><? echo fn_number_format(($fin_pur_var/$mkt_fabric_purchase_array[$key]*100),2); ?></td>
                                         <td align="right"><? echo fn_number_format(($grey_feb_var/$mkt_grey_fab_cost_array[$key]*100),2); ?></td>
                                         <td align="right"><? echo fn_number_format(($dy_var/$mkt_dy_fin_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($aop_var/$mkt_aop_array[$key]*100),2); ?></td>
                                         <td align="right"><? //echo fn_number_format(($fin_fab_pur_var/$mkt_fin_fabric_purchase_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($fin_feb_pur_var/$mkt_fin_fabric_purchase_array[$key][$key]*100),2); ?></td>
                                         <td align="right"><? echo fn_number_format(($totfin_fab_var/$mkt_fin_fabric_purchase_array[$key]*100),2); ?></td> 
                                        <td align="right"><? echo fn_number_format(($trims_var/$mkt_trims_array[$key]*100),2); ?></td>
                                         <td align="right"><? echo fn_number_format(($print_var/$mkt_print_array[$key]*100),2); ?></td>
                                         <td align="right"><? echo fn_number_format(($embro_var/$mkt_embro_array[$key]*100),2); ?></td>
                                         <td align="right"><? echo fn_number_format(($dyeing_var/$mkt_dyeing_array[$key]*100),2); ?></td>
                                         <td align="right"><? echo fn_number_format(($wash_var/$mkt_wash_array[$key]*100),2); ?></td>
                                      
                                        <td align="right"><? echo fn_number_format(($com_var/$mkt_commn_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($commer_var/$mkt_commercial_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($fr_var/$mkt_freight_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($test_var/$mkt_test_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($ins_var/$mkt_ins_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                        
                                        <td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                         <td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                          <td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                          <td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                          <td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                        
                                        
                                        <td align="right"><? echo fn_number_format(($cm_var/$mkt_cm_array[$key]*100),2); ?></td>
                                         <td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                          <td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                           <td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
                                           
                                        <td align="right"><? echo fn_number_format(($tot_var/$mkt_total_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($mar_var/$mkt_margin_array[$key]*100),2); ?></td>
                                        <td align="right"><? echo fn_number_format(($margin_perc_to/$mkt_margin_perc*100),2); ?></td> 
                                    </tr>
                           	<?
                                $j++;
                                }
								
								$bgcolor5='#CCDDEE';
								$bgcolor6='#CCCCFF';
								$bgcolor7='#FFEEFF';
                            ?>
                            <tr bgcolor="<? echo $bgcolor5; ?>" onClick="change_color('trTD5_<? echo $j; ?>','<? echo $bgcolor5; ?>')" id="trTD5_<? echo $j; ?>">
                                <th colspan="3">Pre Costing</th>
                                <th align="right"><? echo fn_number_format($tot_mkt_po_val,2); ?></th>
                               
                                <th align="right"><? echo fn_number_format($tot_mkt_value_addition_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_yarn_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_knit_cost,2); ?></th>
                                 <th align="right"><? //echo fn_number_format($tot_mkt_po_val,2); ?></th>
                                
                                <th align="right"><? echo fn_number_format($tot_mkt_fin_pur_cost,2); ?></th>
                               <th align="right"><? echo fn_number_format($tot_mkt_grey_fab_cost,2); ?></th>
                               <th align="right"><? echo fn_number_format($tot_mkt_dy_fin_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_aop_cost,2); ?></th>
                                <th align="right"><? //echo fn_number_format($tot_mkt_aop_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_fin_fabric_purchase,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_mkt_fin_fabric_purchase,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_trims_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_mkt_print_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_mkt_embro_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_mkt_dyeing_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_mkt_wash_cost,2); ?></th>
                               
                                <th align="right"><? echo fn_number_format($tot_mkt_commn_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_commercial_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_freight_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_test_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_ins_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_courier_cost,2); ?></th>
                                
                                 <th align="right"><? echo fn_number_format($tot_mkt_certificate_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_deffdlc_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_design_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_studio_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_mkt_operating_cost,2); ?></th>
                                 
                                 
                                <th align="right"><? echo fn_number_format($tot_mkt_cm_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_mkt_interest_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_incometax_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_mkt_depr_amor_cost,2); ?></th>
                                 
                                <th align="right"><? echo fn_number_format($tot_mkt_total_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_mkt_margin_cost,2); ?></th>
                                <th align="right"><? $mm=$tot_mkt_margin_cost/$tot_mkt_po_val*100; echo fn_number_format($mm,2); ?></th>   
                            </tr>
                            <tr bgcolor="<? echo $bgcolor6; ?>" onClick="change_color('trTD6_<? echo $j; ?>','<? echo $bgcolor6; ?>')" id="trTD6_<? echo $j; ?>">
                                <th colspan="3">Actual</th>
                                <th align="right"><? echo fn_number_format($tot_buyer_ex_factory_val,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_yarn_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_knit_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_grey_fab_cost,2); ?></th>
                               
                                <th align="right"><? echo fn_number_format($tot_buyer_fin_pur_act_cost,2); ?></th>
                               <th align="right"><? echo fn_number_format($tot_grey_fab_cost_act,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_dye_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_aop_n_others_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_act_fin_fabric_purchase_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_finished_fab_cost_actual_buy,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_trims_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_act_print_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_act_embro_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_act_dyeing_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_act_wash_cost,2); ?></th>
                                
                                <th align="right"><? echo fn_number_format($tot_buyer_commi_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_commercial_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_freight_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_testing_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_inspection_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_courier_cost,2); ?></th>
                                
                                 <th align="right"><? echo fn_number_format($tot_acl_certificate_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_acl_deffdlc_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_acl_design_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_acl_studio_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_acl_operating_cost,2); ?></th>
                                 
                                 
                                <th align="right"><? echo fn_number_format($tot_buyer_cm_cost,2); ?></th>
                                  <th align="right"><? echo fn_number_format($tot_acl_interest_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_acl_incometax_cost,2); ?></th>
                                 <th align="right"><? echo fn_number_format($tot_acl_depr_amor_cost,2); ?></th>
                                
                                <th align="right"><? echo fn_number_format($tot_buyer_total_cost,2); ?></th>
                                <th align="right"><? echo fn_number_format($tot_buyer_margin_cost,2); ?></th>
                                <th align="right"><? $pp=$tot_buyer_margin_cost/$tot_buyer_ex_factory_val*100; echo fn_number_format($pp,2); ?></th>   
                            </tr>
                            <tr bgcolor="<? echo $bgcolor7; ?>" onClick="change_color('trTD7_<? echo $j; ?>','<? echo $bgcolor7; ?>')" id="trTD7_<? echo $j; ?>">
                                <th colspan="3">Variance</th>
                                <th align="right"><? $evar=$tot_mkt_po_val-$tot_buyer_ex_factory_val;  echo fn_number_format($evar,2); ?></th>
                                 <th align="right"><? $yarn_value_var=$tot_mkt_value_addition_cost-$tot_yarn_dyeing_twist_actual;  echo fn_number_format($yarn_value_var,2); ?></th>
                                 <th align="right"><? $grey_yvar=$tot_mkt_yarn_cost-$tot_buyer_yarn_cost;  echo fn_number_format($grey_yvar,2); ?></th>
                                <th align="right"><? $knit_var=$tot_mkt_knit_cost-$tot_buyer_knit_cost;  echo fn_number_format($knit_var,2); ?></th>
                                <th align="right"><? echo " ";//$kvar=$tot_mkt_knit_cost-$tot_buyer_knit_cost;  echo fn_number_format($kvar,2); ?></th>
                                
                                <th align="right"><? $fpfvar=$tot_mkt_fin_pur_cost-$tot_buyer_fin_pur_act_cost;  echo fn_number_format($fpfvar,2); ?></th>
                                 <th align="right"><? $greypfvar=$tot_mkt_grey_fab_cost-$tot_grey_fab_cost_act;  echo fn_number_format($greypfvar,2); ?></th>
                                 <th align="right"><? $dfvar=$tot_mkt_dy_fin_cost-$tot_buyer_dye_cost;  echo fn_number_format($dfvar,2); ?></th>
                                <th align="right"><? $aopvar=$tot_mkt_aop_cost-$tot_buyer_aop_n_others_cost;  echo fn_number_format($aopvar,2); ?></th>
                                <th align="right"><? echo " ";//$aopvar=$tot_mkt_aop_cost-$tot_buyer_aop_n_others_cost;  echo fn_number_format($aopvar,2); ?></th>
                                <th align="right"><? //$fin_fab_var=$tot_mkt_fin_fabric_purchase-$tot_finished_fab_cost_actual_buy;  echo fn_number_format($fin_fab_var,2); ?></th>
                                  <th align="right"><? $fin_fab_var=$tot_mkt_fin_fabric_purchase-$tot_finished_fab_cost_actual_buy;  echo fn_number_format($fin_fab_var,2);; ?></th>
                                <th align="right"><? $trimvar=$tot_mkt_trims_cost-$tot_buyer_trims_cost;  echo fn_number_format($trimvar,2); ?></th>
                                 <th align="right"><? $printvar=$tot_mkt_print_cost-$tot_act_print_cost;  echo fn_number_format($printvar,2); ?></th>
                                 <th align="right"><? $embrovar=$tot_mkt_embro_cost-$tot_act_embro_cost;  echo fn_number_format($embrovar,2); ?></th>
                                <th align="right"><? $dyeingvar=$tot_mkt_dyeing_cost-$tot_act_dyeing_cost;  echo fn_number_format($dyeingvar,2); ?></th>
                                <th align="right"><? $washingvar=$tot_mkt_wash_cost-$tot_act_wash_cost;  echo fn_number_format($washingvar,2); ?></th>
                                
                                <th align="right"><? $comvar=$tot_mkt_commn_cost-$tot_buyer_commi_cost;  echo fn_number_format($comvar,2); ?></th>
                                <th align="right"><? $commercialvar=$tot_mkt_commercial_cost-$tot_buyer_commercial_cost;  echo fn_number_format($commercialvar,2); ?></th>
                                <th align="right"><? $fvar=$tot_mkt_freight_cost-$tot_buyer_freight_cost;  echo fn_number_format($fvar,2); ?></th>
                                <th align="right"><? $tvar=$tot_mkt_test_cost-$tot_buyer_testing_cost;  echo fn_number_format($tvar,2); ?></th>
                                <th align="right"><? $ivar=$tot_mkt_ins_cost-$tot_buyer_inspection_cost;  echo fn_number_format($ivar,2); ?></th>
                                <th align="right"><? $courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                                <th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                               <th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                               <th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                               <th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                                <th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                                
                                 
                                
                                <th align="right"><? $cmvar=$tot_mkt_cm_cost-$tot_buyer_cm_cost;  echo fn_number_format($cmvar,2); ?></th>
                                 <th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                               <th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                                <th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
                                
                                <th align="right"><? $totvar=$tot_mkt_total_cost-$tot_buyer_total_cost;  echo fn_number_format($totvar,2); ?></th>
                                <th align="right"><? $mvar=$tot_mkt_margin_cost-$tot_buyer_margin_cost;  echo fn_number_format($mvar,2); ?></th>
                                <th align="right"><? $mpvar=$mm-$pp;  echo fn_number_format($mpvar,2); ?></th>   
                            </tr>
                            <tr bgcolor="<? echo $bgcolor6; ?>" onClick="change_color('trTD8_<? echo $j; ?>','<? echo $bgcolor6; ?>')" id="trTD8_<? echo $j; ?>">
                                <th colspan="3">Variance (%)</th>
                                <th align="right"><? echo fn_number_format(($evar/$tot_mkt_po_val*100),2); ?></th>
                                 <th align="right"><? echo fn_number_format(($yarn_value_var/$tot_mkt_value_addition_cost*100),2); ?></th>
                                  <th align="right"><? echo fn_number_format(($grey_yvar/$tot_mkt_yarn_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($knit_var/$tot_mkt_yarn_cost*100),2); ?></th>
                                <th align="right"><? echo " ";//echo fn_number_format(($kvar/$tot_mkt_knit_cost*100),2); ?></th>
                                
                                <th align="right"><? echo fn_number_format(($fpfvar/$tot_mkt_fin_pur_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($greypfvar/$tot_mkt_grey_fab_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($dfvar/$tot_mkt_dy_fin_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($aopvar/$tot_mkt_aop_cost*100),2); ?></th>
                                <th align="right"><? echo " ";//echo fn_number_format(($aopvar/$tot_mkt_aop_cost*100),2); ?></th>
                                <th align="right"><?  echo fn_number_format(($fin_fab_var/$tot_mkt_fin_fabric_purchase*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($trimvar/$tot_mkt_trims_cost*100),2); ?></th>
                                 <th align="right"><? echo fn_number_format(($printvar/$tot_mkt_trims_cost*100),2); ?></th>
                                  <th align="right"><? echo fn_number_format(($embrovar/$tot_mkt_embro_cost*100),2); ?></th>
                                   <th align="right"><? echo fn_number_format(($dyeingvar/$tot_mkt_dyeing_cost*100),2); ?></th>
                                    <th align="right"><? echo fn_number_format(($washingvar/$tot_mkt_wash_cost*100),2); ?></th> 
                                    <th align="right"><? echo fn_number_format(($washingvar/$tot_mkt_wash_cost*100),2); ?></th> 
                              
                                <th align="right"><? echo fn_number_format(($comvar/$tot_mkt_commn_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($commercialvar/$tot_mkt_commercial_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($fvar/$tot_mkt_freight_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($tvar/$tot_mkt_test_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($ivar/$tot_mkt_ins_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                <th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                <th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                <th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                <th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                <th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                 
                                <th align="right"><? echo fn_number_format(($cmvar/$tot_mkt_cm_cost*100),2); ?></th>
                                 <th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                <th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                <th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($totvar/$tot_mkt_total_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($mvar/$tot_mkt_margin_cost*100),2); ?></th>
                                <th align="right"><? echo fn_number_format(($mpvar/$mm*100),2); ?></th>   
                            </tr>
                        </table>
                    </div>
                </td>
            </tr>
        </table>
	</fieldset>
 <?
	foreach (glob("../../../../ext_resource/tmp_report/$user_name*.xls") as $filename) 
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$html=ob_get_contents();
	$name=time();
	$filename="../../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,$html);
	$filename="../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	echo "$total_data****$filename****$report_type";
	exit();
}
if($action=="report_generate2")
{ 
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process )); 
	
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );

	$company_name=str_replace("'","",$cbo_company_name);
	$txt_order_no=str_replace("'","",$txt_order_no);
	$txt_file_no=str_replace("'","",$txt_file_no);
	$txt_ref_no=str_replace("'","",$txt_ref_no);
	$cbo_based_on=str_replace("'","",$cbo_based_on);
	$report_type=str_replace("'","",$report);
	if($txt_ref_no!='') $ref_cond="and b.grouping='$txt_ref_no'";else $ref_cond="";
	if($txt_file_no!='') $file_cond="and b.file_no=$txt_file_no";else $file_cond="";
	
	if(str_replace("'","",$cbo_buyer_name)==0)
	{
		if ($_SESSION['logic_erp']["data_level_secured"]==1)
		{
			if($_SESSION['logic_erp']["buyer_id"]!="") $buyer_id_cond=" and a.buyer_name in (".$_SESSION['logic_erp']["buyer_id"].")"; else $buyer_id_cond="";
		}
		else $buyer_id_cond="";
	}
	else $buyer_id_cond=" and a.buyer_name=$cbo_buyer_name";//.str_replace("'","",$cbo_buyer_name)
	
	$txt_job_no=str_replace("'","",$txt_job_no);
	if(trim($txt_job_no)!="") $job_no=trim($txt_job_no); else $job_no="%%";
	
	$cbo_year=str_replace("'","",$cbo_year);
	if(trim($cbo_year)!=0) 
	{
		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year"; else if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year"; else $year_cond="";
	}
	else $year_cond="";
	
	$date_cond='';
	if(str_replace("'","",$txt_date_from)!="" && str_replace("'","",$txt_date_to)!="")
	{
		$date_cond=" and b.pub_shipment_date between $txt_date_from and $txt_date_to";
	}
	
	$po_id_cond="";
	if(trim(str_replace("'","",$txt_order_no))!="")
	{
		if(str_replace("'","",$hide_order_id)!="") $po_id_cond=" and b.id in(".str_replace("'","",$hide_order_id).")";
		else $po_id_cond=" and LOWER(b.po_number) like LOWER('%".trim(str_replace("'","",$txt_order_no))."%')";
	}
	
	$shipping_status_cond='';
	if(str_replace("'","",$shipping_status)!=0) $shipping_status_cond=" and b.shiping_status=$shipping_status";
	
	$po_ids_array=array();
		
	if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
	else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
	else $year_field="";//defined Later
		
	  $sql="select a.id as job_id,a.job_no_prefix_num, a.job_no,a.team_leader,a.dealing_marchant, $year_field,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c where a.job_no=b.job_no_mst and a.job_no=c.job_no and b.job_no_mst=c.job_no and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no'   and a.status_active=1 and a.is_deleted=0 and b.status_active!=0 and b.is_deleted=0 $date_cond $buyer_id_cond $po_id_cond $ref_cond $file_cond $shipping_status_cond $year_cond order by b.pub_shipment_date, a.job_no_prefix_num, b.id";
	//echo $sql; //die;
	$result=sql_select($sql);
	$all_po_id="";	$all_job_id="";
	foreach($result as $row)
	{
		if($all_po_id=="") $all_po_id=$row[csf("id")]; else $all_po_id.=",".$row[csf("id")];
		//if($all_job_id=="") $all_job_id="'".$row[csf("job_no")]."'"; else $all_job_id.=","."'".$row[csf("job_no")]."'";
		if($all_job_id=="") $all_job_id=$row[csf("job_id")]; else $all_job_id.=",".$row[csf("job_id")];
		$job_arr[$row[csf("id")]]['job']=$row[csf("job_no")];
		$job_arr2[$row[csf("job_no")]]['po_quantity']=$row[csf("po_quantity")];
		$job_arr2[$row[csf("job_no")]]['job_quantity']=$row[csf("job_quantity")];
		$po_ex_rate_arr[$row[csf("id")]]['exchange_rate']=$row[csf("exchange_rate")];
	}
	if($all_po_id=="") 
	{ 
		echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
	}
	//	echo $all_job_id;die;
	$jobIds=chop($all_job_id,',');
	//echo $jobIds;die;
	$job_cond_for_in=""; $jobIdCond="";
	$job_ids=count(array_unique(explode(",",$all_job_id)));
	if($db_type==2 && $job_ids>1000)
	{
		$job_cond_for_in=" and (";
		$jobIdCond=" and (";
		$jobIdsArr=array_chunk(explode(",",$jobIds),999);
		foreach($jobIdsArr as $ids)
		{
			$ids=implode(",",$ids);
			$job_cond_for_in.=" a.job_id in($ids) or"; 
			$jobIdCond.=" a.job_no_id in($ids) or"; 
		}
		$job_cond_for_in=chop($job_cond_for_in,'or ');
		$job_cond_for_in.=")";
		$jobIdCond=chop($jobIdCond,'or ');
		$jobIdCond.=")";
	}
	else
	{
		$jobIds=implode(",",array_unique(explode(",",$all_job_id)));
		$job_cond_for_in=" and a.job_id in($jobIds)";
		$jobIdCond=" and a.job_no_id in($jobIds)";
	}
	//echo $job_cond_for_in;die;
	
	$poIds=chop($all_po_id,','); $po_cond_for_in=""; $po_cond_for_in2="";$po_cond_for_in3=""; 
	$po_ids=count(array_unique(explode(",",$all_po_id)));
	if($db_type==2 && $po_ids>1000)
	{
		$po_cond_for_in=" and (";
		$po_cond_for_in2=" and (";
		$po_cond_for_in3=" and (";
		$po_cond_for_in4=" and (";
		$po_cond_for_in5=" and (";
		$poIdsArr=array_chunk(explode(",",$poIds),999);
		foreach($poIdsArr as $ids)
		{
			$ids=implode(",",$ids);
			$po_cond_for_in.=" b.po_break_down_id in($ids) or"; 
			$po_cond_for_in2.=" po_id in($ids) or"; 
			$po_cond_for_in3.=" b.order_id in($ids) or";
			$po_cond_for_in4.=" b.po_breakdown_id in($ids) or"; 
			$po_cond_for_in5.=" b.po_id in($ids) or"; 
		}
		$po_cond_for_in=chop($po_cond_for_in,'or ');
		$po_cond_for_in.=")";
		
		$po_cond_for_in2=chop($po_cond_for_in2,'or ');
		$po_cond_for_in2.=")";
		$po_cond_for_in3=chop($po_cond_for_in3,'or ');
		$po_cond_for_in3.=")";
		$po_cond_for_in4=chop($po_cond_for_in4,'or ');
		$po_cond_for_in4.=")";
		$po_cond_for_in5=chop($po_cond_for_in5,'or ');
		$po_cond_for_in5.=")";
	}
	else
	{
		$poIds=implode(",",array_unique(explode(",",$all_po_id)));
		$po_cond_for_in=" and b.po_break_down_id in($poIds)";
		$po_cond_for_in2=" and po_id in($poIds)";
		$po_cond_for_in3=" and b.order_id in($poIds)";
		$po_cond_for_in4=" and b.po_breakdown_id in($poIds)";
		$po_cond_for_in5=" and b.po_id in($poIds)";
	}
		
	if($poIds!='' || $poIds!=0) $po_cond_for_in=$po_cond_for_in; 
	else $po_cond_for_in="and b.po_break_down_id in(0)";
	
	$ex_factory_arr=return_library_array( "select b.po_break_down_id, 
	sum(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as qnty 
	from pro_ex_factory_mst b where b.status_active=1 and b.is_deleted=0 $po_cond_for_in group by b.po_break_down_id", "po_break_down_id", "qnty");	
	$dealing_library=return_library_array( "select id, team_member_name from lib_mkt_team_member_info", "id", "team_member_name");
	$leader_library=return_library_array( "select id, team_leader_name from lib_marketing_team", "id", "team_leader_name");
 
	ob_start();
	$width=1710;
	?>
    <fieldset style="width:<? echo $width;?>px">
    	<table width="<? echo $width;?>">
            <tr class="form_caption">
                <td colspan="18" align="center"><strong>Post Costing Report V3</strong></td>
            </tr>
            <tr class="form_caption">
                <td colspan="18" align="center"><strong><? echo $company_arr[$company_name];?></strong>
                    <br>
                    <strong><? echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to)); ?></strong>
                </td>
            </tr>
        </table>
        <table style="margin-top:10px" id="table_header_1" class="rpt_table" width="<? echo $width;?>" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="70">Buyer</th>
               
                <th width="70">Job No</th>
                <th width="110">Style Ref. No</th>
                <th width="100">PO No</th>
               
                <th width="80">Ref. No</th>
              
                <th width="70">Job Qty</th>
                <th width="120">Garments Item</th>
                <th width="90">PO Quantity</th>
                <th width="90">Ship Qty</th>
                <th width="100">Team Leader</th>
                <th width="100">Dealing Marchants</th>
                <th width="70">Unit Price</th>
                <th width="110">PO Value</th>
                <th width="100">Ship Value</th>
                <th width="80">Shipment Date</th>
                <th width="100">Shipping Status</th>
                
                <th width="100">Short/Excess Qty</th>
                <th width="">Short/Excess Value</th>
              
            </thead>
        </table>
    	<div style="width:<? echo $width+20;?>px; max-height:400px; overflow-y:scroll" id="scroll_body">
            <table class="rpt_table" width="<? echo $width;?>" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body">
            <?
			$process_costing=return_field_value("process_costing_maintain", "variable_settings_production", "company_name=$company_name and variable_list=34 and is_deleted=0 and status_active=1");
		//	echo $process_costing.'ddd';die;
			
			$usd_id=2;
			$fabriccostArray=array(); $yarncostArray=array(); $trimsCostArray=array(); $prodcostArray=array(); $actualCostArray=array(); $actualTrimsCostArray=array(); 
			$subconCostArray=array(); $embellCostArray=array(); $washCostArray=array(); $aopCostArray=array(); $yarnTrimsCostArray=array(); 
			$yarncostDataArray=sql_select("select a.job_no, sum(a.amount) as amnt, sum(a.rate*a.avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in group by a.job_no");
			//echo "select a.job_no, sum(a.amount) as amnt, sum(a.rate*a.avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in group by a.job_no";die;
			foreach($yarncostDataArray as $yarnRow)
			{
			   $yarncostArray[$yarnRow[csf('job_no')]]=$yarnRow[csf('amount')];
			}
			unset($yarncostDataArray);
			$fabriccostDataArray=sql_select("select a.job_no, a.costing_per_id, a.embel_cost, a.wash_cost, a.cm_cost, a.commission, a.currier_pre_cost, a.lab_test, a.inspection, a.freight, a.comm_cost from wo_pre_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in");
			foreach($fabriccostDataArray as $fabRow)
			{
				 $fabriccostArray[$fabRow[csf('job_no')]]['costing_per_id']=$fabRow[csf('costing_per_id')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['embel_cost']=$fabRow[csf('embel_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['wash_cost']=$fabRow[csf('wash_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['cm_cost']=$fabRow[csf('cm_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['commission']=$fabRow[csf('commission')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['currier_pre_cost']=$fabRow[csf('currier_pre_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['lab_test']=$fabRow[csf('lab_test')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['inspection']=$fabRow[csf('inspection')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['freight']=$fabRow[csf('freight')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['comm_cost']=$fabRow[csf('comm_cost')];
			}
			unset($fabriccostDataArray);
			$prodcostDataArray="select a.body_part_id,a.lib_yarn_count_deter_id as deter_id,b.po_break_down_id as po_id,
								  avg(CASE WHEN c.cons_process=1 THEN c.charge_unit END) AS knit_charge,
								  avg(CASE WHEN c.cons_process=30 THEN c.charge_unit END) AS yarn_dye_charge,
								  avg(CASE WHEN c.cons_process=35 THEN c.charge_unit END) AS aop_charge,
								  avg(CASE WHEN c.cons_process not in(1,2,30,35,134) THEN c.charge_unit END) AS dye_finish_charge
								  from wo_pre_cost_fabric_cost_dtls a,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cos_fab_co_avg_con_dtls b where a.id=c.fabric_description and a.job_no=c.job_no and b.pre_cost_fabric_cost_dtls_id=a.id and b.job_no=c.job_no and c.status_active=1 and c.is_deleted=0  $po_cond_for_in group by  a.lib_yarn_count_deter_id,b.po_break_down_id,a.body_part_id";
			$resultfab_arr = sql_select($prodcostDataArray);
			foreach($resultfab_arr as $prodRow)
			{
				//echo $prodRow[csf('knit_charge')].',';
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['knit_charge']=$prodRow[csf('knit_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['yarn_dye_charge']=$prodRow[csf('yarn_dye_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['aop_charge']=$prodRow[csf('aop_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['dye_finish_charge']=$prodRow[csf('dye_finish_charge')];
			}	
			unset($resultfab_arr);
			//order_wise_pro_details
			//$finProd_grey_usedArr=return_library_array( "select b.po_breakdown_id, sum(b.grey_used_qty) as grey_used_qty from order_wise_pro_details b where  b.entry_form=7 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 group by b.po_breakdown_id", "po_breakdown_id", "grey_used_qty");
			if($poIds!='' || $poIds!=0)
			{
				$po_cond_for_in4=$po_cond_for_in4; 
			}
			else
			{
				$po_cond_for_in4="and b.po_breakdown_id in(0)";
			}
			$finProd_grey_used_sql = "select c.body_part_id,c.fabric_description_id as deter_id,b.po_breakdown_id as po_id, b.quantity as grey_used_qty from order_wise_pro_details b,pro_finish_fabric_rcv_dtls c where  b.dtls_id=c.id and b.entry_form=7 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 ";
			$fingrey_used_data =sql_select($finProd_grey_used_sql );
			foreach($fingrey_used_data as $row)
			{
				//echo $prodRow[csf('knit_charge')].',';
				//$finProd_grey_used=$finProd_grey_usedArr[$row[csf('po_id')]];
				$fin_dye_finish_charge=$prodcostArray[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$fin_grey_used_arr[$row[csf('po_id')]]['grey_used_amt']+=$row[csf('grey_used_qty')]*$fin_dye_finish_charge;
				//echo $row[csf('qnty')].'='.$dye_finish_charge.',';
			}
			unset($fingrey_used_data);
			
		
			$grey_used_sql = "select a.body_part_id,a.fabric_description_id as deter_id,b.qnty,b.po_breakdown_id as po_id from pro_finish_fabric_rcv_dtls a, pro_roll_details b where a.id=b.dtls_id and b.entry_form=66 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4";
			$grey_used_data =sql_select($grey_used_sql );
			foreach($grey_used_data as $row)
			{
				//echo $prodRow[csf('knit_charge')].',';
				$finProd_grey_used=$finProd_grey_usedArr[$row[csf('po_id')]];
				$dye_finish_charge=$prodcostArray[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$grey_used_arr[$row[csf('po_id')]]['grey_used_amt']+=$row[csf('qnty')]*$dye_finish_charge;
				//echo $row[csf('qnty')].'='.$dye_finish_charge.',';
			}
			unset($grey_used_data);
			if($jobIds!='' || $jobIds!=0)
			{
				$job_cond_for_in=$job_cond_for_in; 
				$jobIdCond=$jobIdCond;
			}
			else
			{
				$job_cond_for_in="and a.job_no in('0')";
				$jobIdCond="and a.job_no in('0')";
			}
			$all_job_IdArr=array_unique(explode(",",$all_job_id));
			$jobId_cond_for_in=where_con_using_array($all_job_IdArr,0,"a.job_no_id"); 
			
			$yarn_dyeing_costArray=array(); //product_id
			  $yarndyeing_sql="select b.booking_date,b.id,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 $jobId_cond_for_in group by b.id,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";
			$yarndyeing_result = sql_select($yarndyeing_sql);
			foreach($yarndyeing_result as $yarnRow)
			{
				$yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['job']=$yarnRow[csf('job_no')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['ydw_no']=$yarnRow[csf('ydw_no')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['booking_date']=$yarnRow[csf('booking_date')];
				$yarn_dyeing_curr_arr[$yarnRow[csf('ydw_no')]]['currency']=$yarnRow[csf('currency')];
				$yarn_dyeing_rate_arr[$yarnRow[csf('job_no')]][$yarnRow[csf('yarn_color')]]['rate']=$yarnRow[csf('dyeing_charge')];
				
				$yarn_dyeing_mst_idArr[$yarnRow[csf('id')]]=$yarnRow[csf('id')];
			}
			//print_r($yarn_dyeing_curr_arr);
			unset($resultyarnIssueData);	
				
			$yarnIssueData="select b.prod_id,sum(a.cons_amount) as cons_amount,sum(a.cons_quantity) as cons_quantity
				from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and b.entry_form ='3' and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)  $po_cond_for_in4  group by  b.prod_id";
			$resultyarnIssueData = sql_select($yarnIssueData);
			$all_prod_ids="";
			foreach($resultyarnIssueData as $row)
			{
				if($all_prod_ids=="") $all_prod_ids=$row[csf('prod_id')];else $all_prod_ids.=",".$row[csf('prod_id')];
				
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt']+=$row[csf('cons_amount')];
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty']+=$row[csf('cons_quantity')];
			}
			unset($resultyarnIssueData);
			//echo $all_prod_ids;
			//print_r($yarn_issue_amt_arr);
			$prodIds=chop($all_prod_ids,',');
			$prod_cond_for_in="";
			$prod_ids=count(array_unique(explode(",",$all_prod_ids)));
			if($db_type==2 && $prod_ids>1000)
			{
				$prod_cond_for_in=" and (";
				$prodIdsArr=array_chunk(explode(",",$prodIds),999);
				foreach($prodIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					$prod_cond_for_in.=" a.prod_id in($ids) or"; 
				}
				$prod_cond_for_in=chop($prod_cond_for_in,'or ');
				$prod_cond_for_in.=")";
			}
			else
			{
				$prodIds=implode(",",array_unique(explode(",",$all_prod_ids)));
				$prod_cond_for_in=" and a.prod_id in($prodIds)";
			}
			
			if($prodIds!='' || $prodIds!=0)
			{
				$prod_cond_for_in=$prod_cond_for_in;
			}
			else
			{
				$prod_cond_for_in="and a.prod_id in(0)";
			}
					
			 $sql_receive_for_issue="select c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.exchange_rate,c.currency_id,c.receive_purpose,b.lot,b.color, 
			 sum(a.order_qnty) as qty, sum(a.order_amount) as amnt,
			 sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv
			  from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $prod_cond_for_in  group by c.booking_id,a.job_no,a.prod_id,c.currency_id,c.exchange_rate,c.receive_purpose,b.lot,b.color"; 
			$resultReceive_chek = sql_select($sql_receive_for_issue);
			
			foreach($resultReceive_chek as $row)
			{
				$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose']=$row[csf('receive_purpose')];
				$receive_date_array[$row[csf('prod_id')]]['last_exchange_rate']=$row[csf('exchange_rate')];
				$avg_rate=$row[csf('amnt')]/$row[csf('qty')];
				$receive_array[$row[csf('prod_id')]]=$avg_rate;
				if($row[csf('prod_id')]!="")
				{
					$prod_id_arr[$row[csf('prod_id')]]=$row[csf('prod_id')];
				}
			}
			//print_r($prod_id_arr);die;
			unset($resultReceive_chek);
			
			//$jobIdArr=array_unique(explode(",",$all_job_id));
			//print_r($yarn_dyeing_mst_idArr);die;
			if($yarn_dyeing_mst_idArr)
			{
				$YdId_cond_for_in=where_con_using_array($yarn_dyeing_mst_idArr,0,"c.booking_id"); 
			}
			else $YdId_cond_for_in="and c.booking_id=0";
			
			
			$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit");
			 
			//$receive_array=array();//$job_cond_for_in  $prod_cond_for_in
			 $sql_receive="select c.recv_number,c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.exchange_rate,c.receive_purpose,b.lot,b.color,c.currency_id,
			 sum(a.order_qnty) as qty, sum(a.order_amount) as amnt,
			 sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv,
			  sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.cons_quantity ELSE 0 END) AS cons_quantity
			  from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id  and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1  $YdId_cond_for_in  and a.is_deleted=0    group by c.recv_number,c.booking_id,a.job_no,a.prod_id,c.currency_id,c.exchange_rate,c.receive_purpose,b.lot,b.color";
			$resultReceive = sql_select($sql_receive);$all_recv_prod_ids="";
			foreach($resultReceive as $invRow)
			{
				if($all_recv_prod_ids=="") $all_recv_prod_ids=$invRow[csf('prod_id')];else $all_recv_prod_ids.=",".$invRow[csf('prod_id')];
				$receive_curr_array[$invRow[csf('prod_id')]]=$invRow[csf('currency_id')];
				$jobNo=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['job'];
				$ydw_no=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['ydw_no'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				//echo $jobNo.'=='.$invRow[csf('booking_id')].'b';
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['job']=$jobNo;
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['ydw_no']=$ydw_no;
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$dye_rate=$yarn_dyeing_rate_arr[$jobNo][$invRow[csf('color')]]['rate'];
					//echo $ydw_no.'d'.$dye_rate;
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				//$po_quantity=$job_arr2[$jobNo]['po_quantity'];
				$order_amount_recv=$invRow[csf('order_amount_recv')];
				$cons_quantity=$invRow[csf('cons_quantity')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rate;
				$currency_rateArr[$invRow[csf('prod_id')]]=$exchange_rate;
			
				if($currency==1) $avg_rate=$dye_rate/$currency_rate;//Taka
				else $avg_rate=$dye_rate;	
				//echo $is_short.'='.$avg_rate.'='.$cons_quantity.', ';
				if($is_short==2) $yarn_receive_amount_arr[$jobNo]['order_amount_recv']+=$avg_rate*$cons_quantity;//Main Booking..
				else $yarn_receive_amount_arr[$jobNo]['cpa_order_amount_recv']+=$avg_rate*$cons_quantity;	
			}
		//	print_r($yarn_receive_amount_arr);
			//echo $all_recv_prod_ids;
			unset($resultReceive);
			 
			if($all_recv_prod_ids!="")
			{
				$recvprodIds=chop($all_recv_prod_ids,',');
				$recv_prod_cond_for_in="";
				$recv_prod_ids=count(array_unique(explode(",",$all_recv_prod_ids)));
				if($db_type==2 && $recv_prod_ids>1000)
				{
					$recv_prod_cond_for_in=" and (";
					$recvprodIdsArr=array_chunk(explode(",",$recvprodIds),999);
					foreach($recvprodIdsArr as $ids)
					{
						$ids=implode(",",$ids);
						$recv_prod_cond_for_in.=" a.prod_id in($ids) or"; 
					}
					$recv_prod_cond_for_in=chop($recv_prod_cond_for_in,'or ');
					$recv_prod_cond_for_in.=")";
				}
				else
				{
					$recprodIds=implode(",",array_unique(explode(",",$all_recv_prod_ids)));
					$recv_prod_cond_for_in=" and a.prod_id in($recprodIds)";
				}
			}
			//echo $recv_prod_cond_for_in;
			 $sql_receive_ret="select a.prod_id,b.lot,b.color,c.received_mrr_no,
			 sum(a.cons_quantity) as cons_quantity
			  from inv_transaction a,product_details_master b,inv_issue_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=8 and c.item_category=1 and a.transaction_type=3 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $recv_prod_cond_for_in  group by a.prod_id,b.lot,b.color,c.received_mrr_no";
			$resultReceive_ret = sql_select($sql_receive_ret);
			
			foreach($resultReceive_ret as $row)
			{
				$ydw_no=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['ydw_no'];
				$recv_job=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['job'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$ydye_rate=$yarn_dyeing_rate_arr[$jobNo][$row[csf('color')]]['rate'];
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				//echo $recv_job.'d'.$currency;
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$currency_rateArr[$row[csf('prod_id')]];
				if($currency==1) $avg_rate=$ydye_rate/$currency_rate;//Taka
				else $avg_rate=$ydye_rate;	
				
				$ret_amt=$row[csf('cons_quantity')]*$avg_rate;
				//$receive_ret_arr[$row[csf('prod_id')]]['last_trans_date']=$row[csf('cons_quantity')];
				if($is_short==2) $receive_ret_arr[$recv_job]['recv_ret_amt']+=$ret_amt; //Main Booking
				else $receive_ret_arr[$recv_job]['cpa_recv_ret_amt']+=$ret_amt;
			}
			unset($resultReceive_ret);
			//print_r($receive_ret_arr);
			//booking_type,is_short
			if($poIds!='' || $poIds!=0) $po_cond_for_in=$po_cond_for_in; 
			else $po_cond_for_in="and b.po_break_down_id in(0)";
			
			$sql_wo_aop="select a.id,a.booking_date,a.currency_id,a.exchange_rate,a.item_category,a.booking_no,a.booking_type,a.is_short,b.po_break_down_id as po_id,
			(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.wo_qnty ELSE 0 END) AS wo_qnty,
			(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.amount ELSE 0 END) AS amount
			 from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no  and a.item_category in(2,3,12) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in";
			$result_aop_rate=sql_select( $sql_wo_aop );
			foreach ($result_aop_rate as $row)
			{
				if($row[csf('item_category')]==12)
				{
					$wo_qnty=$row[csf('wo_qnty')];
					$amount=$row[csf('amount')];
					$avg_wo_aop_rate=$amount/$wo_qnty;
					$aop_prod_array[$row[csf('po_id')]]['aop_rate']=$avg_wo_aop_rate;
					$aop_prod_array[$row[csf('po_id')]]['currency_id']=$row[csf('currency_id')];
					$aop_prod_array[$row[csf('po_id')]]['booking_date']=$row[csf('booking_date')];
					$aop_prod_array[$row[csf('po_id')]]['exchange_rate']=$row[csf('exchange_rate')];
				}
				else
				{
					$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
					$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
					$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
					$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
				}
			}
			unset($result_aop_rate);
			if($poIds!='' || $poIds!=0) $po_cond_for_in3=$po_cond_for_in3; else $po_cond_for_in3="and b.order_id in(0)";
			
			$sql_aop="select a.company_id, b.batch_issue_qty as issue_qty,b.prod_id,b.order_id as po_id from pro_grey_batch_dtls b,inv_receive_mas_batchroll a where a.id=b.mst_id  and a.entry_form=92  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and b.process_id=35 $po_cond_for_in3";
			$result_aop=sql_select( $sql_aop );
			foreach ($result_aop as $row)
			{
				$aop_rate=$aop_prod_array[$row[csf('po_id')]]['aop_rate'];
				$booking_date=$aop_prod_array[$row[csf('po_id')]]['booking_date'];
				$exchange_rate=$aop_prod_array[$row[csf('po_id')]]['exchange_rate'];
				$currency_id=$aop_prod_array[$row[csf('po_id')]]['currency_id'];
				$booking_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($booking_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($booking_date, "d-M-y", "-",1);
				
				//$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
				$exchange_rate=$exchange_rate;
				if($currency_id==1) $avg_rate=$aop_rate/$exchange_rate;//TK
				else $avg_rate=$aop_rate;
					
				$aop_amt=$row[csf('issue_qty')]*$avg_rate;
				$aop_prod_array[$row[csf('po_id')]]['aop_amt']+=$aop_amt;
			}
			//print_r($aop_prod_array);
			unset($result_aop);
			$sql_yarn="select c.id,a.requisition_no,a.receive_basis,a.prod_id,(a.cons_amount) as cons_amount,c.issue_basis,c.issue_number,c.booking_no from inv_transaction a, order_wise_pro_details b, inv_issue_master c where  a.id=b.trans_id and  c.id=a.mst_id and c.entry_form in(3) and b.entry_form in(3)  and  a.transaction_type=2 $po_cond_for_in4";
			$result_yarn=sql_select($sql_yarn);
			foreach($result_yarn as $invRow)
			{
				if($invRow[csf('issue_basis')]==1)// Booking
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('booking_no')];
				}
				else if($invRow[csf('issue_basis')]==3)// Requesition
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('requisition_no')];
				}
			}
			
			unset($result_yarn);
				//die;
			if($poIds!='' || $poIds!=0) $po_cond_for_in2=$po_cond_for_in2; 
			else $po_cond_for_in2="and po_id in(0)";
			
			$plan_details_array = return_library_array("select dtls_id, booking_no as booking_no from ppl_planning_entry_plan_dtls where company_id=$company_name $po_cond_for_in2 group by dtls_id,booking_no", "dtls_id", "booking_no");
			//print_r($plan_details_array);
			$reqs_array = array();
			
			$reqs_sql = sql_select("select a.knit_id, a.requisition_no as reqs_no, sum(a.yarn_qnty) as yarn_req_qnty from ppl_planning_entry_plan_dtls b,ppl_yarn_requisition_entry a where b.dtls_id=a.knit_id and b.status_active=1 and b.is_deleted=0 $po_cond_for_in5 group by a.knit_id, a.requisition_no");
			foreach ($reqs_sql as $row)
			{
				$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
			}
			unset($reqs_sql);
			//and b.issue_purpose in(2,4,15,38)
		    $yarnissue_retData="select d.booking_no,a.item_category,b.po_breakdown_id, b.prod_id, a.mst_id,a.receive_basis, b.issue_purpose,c.lot,c.color,d.exchange_rate,
			(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.transaction_date ELSE null END) AS transaction_date,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN b.quantity ELSE 0 END) AS yarn_iss_return_qty,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_amount ELSE 0 END) AS order_amount_ret,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_qnty ELSE 0 END) AS order_qnty_ret
			from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_receive_master d where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id  and d.id=a.mst_id and a.item_category in(1) and a.transaction_type in(4) and b.entry_form in(9) and d.entry_form in(9) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1  $po_cond_for_in4  group by d.booking_no,b.po_breakdown_id, b.prod_id, a.item_category,a.transaction_date,a.receive_basis,a.mst_id,a.transaction_type,b.entry_form,d.exchange_rate,b.trans_type,b.issue_purpose,c.lot,c.color";
			$yarnissueretDataArray=sql_select($yarnissue_retData); $yarnissueRetCostArray=array();
			foreach($yarnissueretDataArray as $invRow)
			{
				$issue_purpose=$invRow[csf('issue_purpose')];
				$receive_basis=$invRow[csf('receive_basis')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				//echo $receive_basis.'ff';
				if($receive_basis==1) //Booking Basis
				{
					$booking_no=$invRow[csf('booking_no')];
				}
				
				else if($receive_basis==3) //Requisition Basis
				{
					$booking_req_no=$invRow[csf('booking_no')];
					$prog_no=$reqs_array[$booking_req_no]['knit_id'];
					$booking_no=$plan_details_array[$prog_no];
					//echo $booking_req_no.'req';
				}
				$booking_type=$booking_array[$booking_no]['btype'];
				$is_short=$booking_array[$booking_no]['is_short'];
				//echo $booking_type.'='.$is_short.'='.$booking_no.'<br>';
				$returnable_ret_qnty=$invRow[csf('returnable_qnty')];
				//echo $invRow[csf('yarn_iss_return_qty')].'<br>';
				 $issue_ret_qty=$invRow[csf('yarn_iss_return_qty')];
				  $order_qnty_ret=$invRow[csf('order_qnty_ret')];
				  $order_amount_ret=$invRow[csf('order_amount_ret')];
				 $avg_rate=$order_amount_ret/$order_qnty_ret;
				//echo $avg_rate.'<br>';
				//$rate='';
				$transaction_date=$invRow[csf('transaction_date')];
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rate;
				//echo $ret_avg_rate= $avg_rate/$conversion_date;
				$currency_id=$receive_curr_array[$invRow[csf('prod_id')]];
				//echo $currency_id.'dddddd';
				if($receive_array[$invRow[csf('prod_id')]]>0)
				{
					//echo $currency_id.'D';
					if($currency_id==1) $rate=$receive_array[$invRow[csf('prod_id')]]/$currency_rate;//Taka
					else $rate=$receive_array[$invRow[csf('prod_id')]];	
				}
				else $rate=$avg_rate_array[$invRow[csf('prod_id')]]/$currency_rate;
				
				$iss_ret_amnt=$issue_ret_qty*$rate;
				$retble_iss_ret_amnt=$returnable_ret_qnty*$rate;
				if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
				{
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) //Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else if($issue_purpose==2) //Yarn Dyeing
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
				}
				else //Short Fabric Booking
				{
					//echo $booking_type.'d';
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) // Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							//echo $iss_amnt.'cpa';
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else  if($issue_purpose==2)
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}	
				}
			}
			unset($yarnissueretDataArray);
				 
			$yarnTrimsData="select a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color
					from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)  $po_cond_for_in4 ";
				
			$yarnTrimsDataArray=sql_select($yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
			$tot_yQty=0;
			foreach($yarnTrimsDataArray as $invRow)
			{
				if($invRow[csf('item_category')]==1)
				{
					$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
					$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
					$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['last_exchange_rate'];
					
					if($invRow[csf('receive_basis')]==1)//Booking Basis
					{
						$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
						{
							$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
							$booking_type=1;
							//echo $is_short.'= '.$booking_type.', ';
						}
						else
						{
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
					}
					else if($invRow[csf('receive_basis')]==3) //Requisition Basis
					{
						$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						
						$prog_no=$reqs_array[$booking_req_no]['knit_id'];
						$booking_no=$plan_details_array[$prog_no];
						//echo $booking_no.'='.$prog_no.',';
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
					}
					$transaction_date='';
					$transaction_date=$last_trans_date;
					if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					
					//$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
					$exchange_rate=$last_exchange_rate;
					$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
					$avgrate=$issue_rate/$exchange_rate;
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($invRow[csf('entry_form')]==3 && $recv_purpose==16)//recv_purpose==16=Grey Yarn
					{
						if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
							{
								//echo $invRow[csf('mst_id')].'='.$recv_purpose.'='.$is_short.'='.$invRow[csf('quantity')].'-k<br>';
								$iss_amnt=$invRow[csf('quantity')]*$avgrate;
								//echo $iss_amnt.'m';
								$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['yq']+=$invRow[csf('quantity')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_qty_retble']+=$invRow[csf('returnable_qnty')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt_retble']+=$retble_iss_amnt;
								$tot_yQty+=$invRow[csf('quantity')];
							}
						}
						else //Short Fabric Booking
						{
							$iss_amnt=$invRow[csf('quantity')]*$avgrate;
							//echo $is_short.'='.$iss_amnt.'='.$invRow[csf('mst_id')].'<br>';
							$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
							
							if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
							{
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_qty_retble']+=$returnable_qnty;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt_retble']+=$retble_iss_amnt;
								$tot_yQty+=$invRow[csf('quantity')];
							}
						}
					}
				}
				else
				{
					$trimsAmt=0;
					$trimsAmt=$invRow[csf('quantity')]*$invRow[csf('cons_rate')];
					$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]][4]+=$trimsAmt;
				}
			}
			//echo $tot_yQty;die;
			unset($yarnTrimsDataArray);
					
			$sql_garments="select b.po_break_down_id as po_id,b.embel_name,b.production_date,b.production_type,
				(CASE WHEN b.embel_name=1 THEN b.production_quantity ELSE 0 END) AS printing_qty,
				(CASE WHEN b.embel_name=2 THEN b.production_quantity ELSE 0 END) AS embro_qty,
				(CASE WHEN b.embel_name=3 THEN b.production_quantity ELSE 0 END) AS wash_qty,
				(CASE WHEN b.embel_name=5 THEN b.production_quantity ELSE 0 END) AS dyeing_qty
				 from pro_garments_production_mst b where  b.production_type=2    and b.is_deleted=0 and b.status_active=1 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in";
				$result_gar=sql_select( $sql_garments );
				foreach ($result_gar as $row)
				{
					$embl_issue_prod_array[$row[csf('po_id')]]['printing_qty']+=$row[csf('printing_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['embro_qty']+=$row[csf('embro_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['wash_qty']+=$row[csf('wash_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['dyeing_qty']+=$row[csf('dyeing_qty')];
				}
				unset($result_gar);
			
				//print_r($yarnTrimsCostArray);
				$recvIssue_array=array(); 
				$sql_trans="select b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(80,82,81,83,84,13,94) and a.item_category=13 and a.transaction_type in(5,6) and b.trans_type in(5,6) $po_cond_for_in4 group by b.trans_type, b.po_breakdown_id";
				$result_trans=sql_select( $sql_trans );
				foreach ($result_trans as $row)
				{
					$recvIssue_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_trans);
				
				
				$trims_trans_array=array(); 
				
				$sql_trims_inv="select a.transaction_date,a.prod_id, a.cons_amount as cons_amount, b.po_breakdown_id as po_id, b.quantity as qnty, c.currency_id,c.exchange_rate
				  from inv_transaction a, order_wise_pro_details b, inv_receive_master c  where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.entry_form in(24) and a.item_category=4 and a.transaction_type in(1) and b.trans_type in(1) $po_cond_for_in4";
				$result_trims=sql_select( $sql_trims_inv );
				foreach ($result_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					$currency_id=$row[csf('currency_id')];
					$exchange_rateArr[$row[csf('prod_id')]]=$row[csf('exchange_rate')];
					if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					//$currency_rate=set_conversion_rate($currency_id,$conversion_date );
					$currency_rate=$row[csf('exchange_rate')];
					$amt=0;
					
					$amt=$row[csf('cons_amount')]/$currency_rate;
						//echo $currency_rate.'d';
					$trims_trans_array[$row[csf('po_id')]]['amt']+=$amt;
				}
				$gen_trims_issue_array=array(); 
				 $sql_gen_trims_inv="select b.transaction_date,b.prod_id,(b.cons_amount) as cons_amount,b.order_id as po_id
				  from inv_issue_master  a, inv_transaction b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(21)   and b.transaction_type in(2)   $po_cond_for_in3 ";
				$result_gen_trims=sql_select( $sql_gen_trims_inv );
				foreach ($result_gen_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$currency_rate=$exchange_rateArr[$row[csf('prod_id')]];
					$gen_trims_issue_array[$row[csf('po_id')]]['amt']+=$row[csf('cons_amount')]/$currency_rate;//
				}
				unset($result_gen_trims);
				 //-----ss
				//die;
				unset($result_trims);
				$fin_fab_trans_array=array(); 
				 $sql_fin_trans="select b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty
				  from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15,14) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) $po_cond_for_in4 group by b.trans_type, b.po_breakdown_id";
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
					$fin_fab_trans_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_fin_trans);
				
				if($poIds!='' || $poIds!=0)
				{
					$po_cond_for_in5=$po_cond_for_in5; 
				}
				else
				{
					$po_cond_for_in5="and b.po_id in(0)";
				}
				$batch_trans_array=array(); 
				$sql_batch="select a.id,a.booking_no,batch_weight as batch_weight
				  from  pro_batch_create_mst a,pro_batch_create_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in5 group by a.id,batch_weight,a.booking_no";
				$result_batch=sql_select( $sql_batch );
				foreach ($result_batch as $row)
				{
					$batch_trans_array[$row[csf('id')]]['book']=$row[csf('booking_no')];
					$batch_weight_array[$row[csf('id')]]['batch_weight']=$row[csf('batch_weight')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_batch);
				
				$dye_fin_fab_array=array(); 
				 $sql_fin_trans="select a.receive_date,a.exchange_rate, b.po_breakdown_id,c.mst_id,c.batch_id,c.body_part_id, sum(b.quantity) as finish_qnty
				  from inv_receive_master a,pro_finish_fabric_rcv_dtls c, order_wise_pro_details b where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(7) and a.item_category=2   and b.trans_type in(1) $po_cond_for_in4 group by a.receive_date, b.po_breakdown_id,c.batch_id,c.mst_id,c.body_part_id";
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
						$receive_date=$row[csf('receive_date')];
						$booking_no=$batch_trans_array[$row[csf('batch_id')]]['book'];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
						$batch_weight=$batch_weight_array[$row[csf('batch_id')]]['batch_weight'];
						$dye_finish_charge=$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
						//echo $batch_weight.'kk';
						if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							
							$finish_qnty=$row[csf('finish_qnty')]*$dye_finish_charge;
						}
						else //short Fab. booking 
						{
							$cpa_batch_weight=$batch_weight*$dye_finish_charge;
						}
						//echo $finish_qnty.'='.$cpa_finish_qnty;
						if($db_type==0)
						{
							$conversion_date=change_date_format($receive_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($receive_date, "d-M-y", "-",1);
						}
						//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
						$currency_rate=$row[csf('exchange_rate')];
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['fin_amt']=$finish_qnty;
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['cpa_batch_weight']+=$cpa_batch_weight;
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['ex_rate']=$currency_rate;
				}
				unset($result_fin_trans);
				
				$grey_fab_array=array();  //Knitting Cost actual 
				  $sql_grey_trans="select  a.id,a.receive_basis,a.exchange_rate,a.booking_no,a.receive_date,b.po_breakdown_id,c.febric_description_id as deter_id,c.body_part_id, c.kniting_charge,
				 (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
				
				  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(2,13)  and b.trans_type in(1) $po_cond_for_in4";
				$result_grey=sql_select( $sql_grey_trans );
				$currency_id=1;
				foreach ($result_grey as $row)
				{
						$transaction_date=$row[csf('transaction_date')];
						$receive_basis=$row[csf('receive_basis')];
						$exchange_rate=$row[csf('exchange_rate')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($row[csf('receive_date')], "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($row[csf('receive_date')], "d-M-y", "-",1);
						}
					//	$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
						$exchange_rate=$row[csf('exchange_rate')];
						if($currency_id==1) //TK
						{
							$knit_charge=$row[csf('kniting_charge')]/$exchange_rate;
							
						}
						else
						{
							$knit_charge=$row[csf('kniting_charge')];
						}
						
						//$knit_charge=$row[csf('kniting_charge')];//$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['knit_charge'];
						//echo $knit_charge.'='.$row[csf('deter_id')].'ff'.$row[csf('po_breakdown_id')];
						if($receive_basis==1) //Booking Basis
						{
							 $booking_no=$row[csf('booking_no')];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							//echo $booking_type.'='.$is_short;
						}
						else if($receive_basis==2) //Knit plan Basis
						{
							 $prog_no=$grey_knit_array[$row[csf('mst_id')]];
							$booking_no=$plan_details_array[$row[csf('booking_no')]];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						else if($receive_basis==4) //Salse Basis
						{
							 $prog_no=$row[csf('booking_no')];
							$booking_no=$plan_details_array[$prog_no];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							
						}
						
						if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							$grey_amt=$row[csf('grey_qnty')]*$knit_charge;
							//$finish_qnty=$row[csf('finish_qnty')];
							//echo $row[csf('grey_qnty')].'*'.$knit_charge.'<br>';
						}

						else //short Fab. booking 
						{
							$cpa_grey_amt=$row[csf('grey_qnty')]*$knit_charge;
							//$cpa_finish_qnty=$row[csf('finish_qnty')];
						}
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						$currency_rate=$exchange_rate;//set_conversion_rate($usd_id,$conversion_date );
					$grey_fab_array[$row[csf('po_breakdown_id')]]['qnty']+=$row[csf('grey_qnty')];
					$grey_fab_array[$row[csf('po_breakdown_id')]]['grey_amt']+=$grey_amt;
					$grey_fab_array[$row[csf('po_breakdown_id')]]['cpa_grey_amt']+=$cpa_grey_amt;
					
				}
				unset($result_grey);
				//print_r($grey_fab_array);
				$sql_fin_purchase="select b.po_breakdown_id,a.transaction_date, sum(a.cons_rate*b.quantity) as finish_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.receive_basis<>9 and a.item_category=2 and a.transaction_type=1 and b.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 group by b.po_breakdown_id,a.transaction_date";
				$dataArrayFinPurchase=sql_select($sql_fin_purchase);
				foreach($dataArrayFinPurchase as $finRow)
				{
					$transaction_date=$finRow[csf('transaction_date')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						$po_ex_rate=$po_ex_rate_arr[$finRow[csf("po_breakdown_id")]]['exchange_rate'];
						$currency_rate=$po_ex_rate;//set_conversion_rate($usd_id,$conversion_date );
					$finish_purchase_amnt_arr[$finRow[csf('po_breakdown_id')]]=$finRow[csf('finish_purchase_amnt')]/$currency_rate;
				}
				unset($dataArrayFinPurchase);
				
				$sql_fin_purchase_wv="select b.po_breakdown_id, sum(a.cons_rate*b.quantity) as woven_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.item_category=3 and a.transaction_type=1 and b.entry_form=17 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in4 group by b.po_breakdown_id";
				$dataArrayFinPurchaseW=sql_select($sql_fin_purchase_wv);
				foreach($dataArrayFinPurchaseW as $finRow)
				{
						$po_ex_rate=$po_ex_rate_arr[$finRow[csf("po_breakdown_id")]]['exchange_rate'];
					$finish_purchase_amnt_arr[$finRow[csf('po_breakdown_id')]]+=$finRow[csf('woven_purchase_amnt')]/$po_ex_rate;
				}
				unset($dataArrayFinPurchaseW);
				$sql_grey_purchase="select b.po_breakdown_id,a.transaction_date, sum(a.cons_rate*b.quantity) as finish_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.receive_basis<>9 and a.item_category in(13,14) and a.transaction_type=1 and b.entry_form in(22,23) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 group by b.po_breakdown_id,a.transaction_date";
				$dataArraygreyPurchase=sql_select($sql_grey_purchase);
				foreach($dataArraygreyPurchase as $gRow)
				{
					$transaction_date=$gRow[csf('transaction_date')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						$po_ex_rate=$po_ex_rate_arr[$gRow[csf("po_breakdown_id")]]['exchange_rate'];
						$currency_rate=$po_ex_rate;//set_conversion_rate($usd_id,$conversion_date );
					$grey_purchase_amnt_arr[$gRow[csf('po_breakdown_id')]]=$gRow[csf('finish_purchase_amnt')]/$currency_rate;
				}
					unset($dataArraygreyPurchase);
				 $actualCostArray=array();
				$actualCostDataArray="select cost_head,po_id,sum(amount_usd) as amount_usd from wo_actual_cost_entry where company_id=$company_name and status_active=1 and is_deleted=0 $po_cond_for_in2 group by cost_head,po_id";
				$actual_results=sql_select($actualCostDataArray);
				foreach($actual_results as $actualRow)
				{
				   $actualCostArray[$actualRow[csf('cost_head')]][$actualRow[csf('po_id')]]=$actualRow[csf('amount_usd')];
				}
				unset($actual_results);
				
				$i=1; $tot_po_qnty=0; $tot_po_value=0; $tot_ex_factory_qnty=0; $tot_ex_factory_val=0; $tot_yarn_cost_mkt=0; $tot_knit_cost_mkt=0; $tot_dye_finish_cost_mkt=0; $tot_yarn_dye_cost_mkt=0; $tot_aop_cost_mkt=0; $tot_trims_cost_mkt=0; $tot_embell_cost_mkt=0; $tot_wash_cost_mkt=0; $tot_commission_cost_mkt=0; $tot_comm_cost_mkt=0; $tot_freight_cost_mkt=0; $tot_test_cost_mkt=0; $tot_inspection_cost_mkt=0; $tot_currier_cost_mkt=0; $tot_cm_cost_mkt=0; $tot_mkt_all_cost=0; $tot_mkt_margin=0; $tot_yarn_cost_actual=0; $tot_knit_cost_actual=0; $tot_dye_finish_cost_actual=0; $tot_yarn_dye_cost_actual=0; $tot_aop_cost_actual=0; $tot_trims_cost_actual=0; $tot_embell_cost_actual=0; $tot_wash_cost_actual=0; $tot_commission_cost_actual=0; $tot_comm_cost_actual=0; $tot_freight_cost_actual=0; $tot_test_cost_actual=0; $tot_inspection_cost_actual=0; $tot_currier_cost_actual=0; $tot_cm_cost_actual=0; $tot_actual_all_cost=0; $tot_actual_margin=0; $tot_fabric_purchase_cost_mkt=$total_fabric_cost_mkt=0; $tot_fabric_purchase_cost_actual=$tot_grey_fab_cost_actual=$tot_actual_net_margin=0;
				$tot_print_amount_mkt=$tot_embro_amount_mkt=$tot_dyeing_amount_mkt=$tot_wash_amount_mkt=$tot_print_amount_actual=$tot_embro_amount_actual=$tot_dyeing_amount_actual=$tot_wash_amount_actual=$tot_finished_fab_cost_actual=$tot_fin_fab_transfer_amt_actual=$tot_yarn_dyeing_twist_actual=$tot_grey_fab_transfer_amt_actual=$tot_yarn_qty_actual=$tot_yarn_amt_actual=$tot_grey_fab_cost_mkt=$tot_yarn_value_addition_cost_mkt=$total_fabric_cost=$tot_fabric_cost_actaul=$tot_yarn_qty_cpa_actual=$total_finish_fabric_cost_mkt=$tot_yarn_qty_cpa_actual=0;
				$buyer_name_array=array();
				$mkt_po_val_array = array(); $mkt_yarn_array = array(); $mkt_knit_array = array(); $mkt_dy_fin_array = array(); $mkt_yarn_dy_array = array();
				$mkt_aop_array = array(); $mkt_trims_array = array(); $mkt_emb_array = array(); $mkt_wash_array=array(); $mkt_commn_array=array(); $mkt_commercial_array=array();
				$mkt_freight_array = array(); $mkt_test_array = array(); $mkt_ins_array = array(); $mkt_courier_array = array(); $mkt_cm_array = array();
				$mkt_total_array = array(); $mkt_margin_array = array(); $mkt_fabric_purchase_array = array();
				
				$ex_factory_val_array= array(); $yarn_cost_array= array(); $knit_cost_array= array(); $dye_cost_array= array(); $yarn_dyeing_cost_array= array();
				$aop_n_others_cost_array= array(); $trims_cost_array= array(); $enbellishment_cost_array= array(); $wash_cost_array= array(); $commission_cost_array= array(); 
				$commercial_cost_array= array(); $freight_cost_array= array(); $testing_cost_array= array(); $inspection_cost_array= array(); $courier_cost_array= array();
				$cm_cost_array= array(); $total_cost_array= array(); $margin_array= array(); $ex_factory_array=array(); $actual_cm_amnt=array(); $actual_fabric_purchase_array = array();
								
				 $condition= new condition();
				 $condition->company_name("=$company_name");
				 if(str_replace("'","",$cbo_buyer_name)>0){
					  $condition->buyer_name("=$cbo_buyer_name");
				 }
				 if(str_replace("'","",$txt_file_no) !=''){
					  $condition->file_no("='$txt_file_no'");
				 }
				 if(str_replace("'","",$txt_ref_no) !=''){
					  $condition->grouping("='$txt_ref_no'");
				 }
				  if(str_replace("'","",$txt_job_no) !=''){
					  $condition->job_no_prefix_num("=$txt_job_no");
				 }
				if(trim(str_replace("'","",$txt_order_no))!='')
				 {
					//$condition->po_number(" like '%".trim(str_replace("'","",$txt_order_no))."%'"); 
					$condition->po_number("='".trim(str_replace("'","",$txt_order_no))."'"); 
				 }
				 if(str_replace("'","",$txt_date_from)!='' && str_replace("'","",$txt_date_to)!='')
				 {
					 $start_date=str_replace("'","",$txt_date_from);
					 $end_date=str_replace("'","",$txt_date_to);
					 $condition->pub_shipment_date(" between '$start_date' and '$end_date'");
					 //and b.po_received_date between '$start_date' and '$end_date' 
					// echo 'FFGG';
				 }
				 //$txt_file_no=str_replace("'","",$txt_file_no);
	//$txt_ref_no=str_replace("'","",$txt_ref_no);
				 
				 $condition->init();
				
				 $yarn= new yarn($condition);
				//echo $yarn->getQuery();die;
				 $yarn_costing_arr=$yarn->getOrderWiseYarnAmountArray();
				 $yarn= new yarn($condition);
				 $yarn_costing_qty_arr=$yarn->getOrderWiseYarnQtyArray();
				 $conversion= new conversion($condition);
				 $conversion_costing_arr_process=$conversion->getAmountArray_by_orderAndProcess(); 
				  $conversion= new conversion($condition);
				 $conversion_costing_arr_process_qty=$conversion->getQtyArray_by_orderAndProcess();
				 $trims= new trims($condition);
				 $trims_costing_arr=$trims->getAmountArray_by_order();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name=$emblishment->getAmountArray_by_orderAndEmbname();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name_qty=$emblishment->getQtyArray_by_orderAndEmbname();
				$commission= new commision($condition);
				$commission_costing_arr=$commission->getAmountArray_by_orderAndItemid();
				$commercial= new commercial($condition);
				$commercial_costing_arr=$commercial->getAmountArray_by_order();
				$other= new other($condition);
				$other_costing_arr=$other->getAmountArray_by_order();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash=$wash->getAmountArray_by_orderAndEmbname();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash_qty=$wash->getQtyArray_by_orderAndEmbname();
				$fabric= new fabric($condition);
				 //echo $fabric->getQuery();
				$fabric_costing_arr=$fabric->getAmountArray_by_order_knitAndwoven_greyAndfinish();
				
				//print_r($fabric_costing_arr);die;
				$not_yarn_dyed_cost_arr=array(1,2,30,134,35);$job_ids='';
				$tot_short_excess_Qty=0;
				$tot_short_excess_val=0;
				foreach($result as $row)
				{
					if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					
					$po_ids_array[]=$row[csf('id')];
					 $job_ids.=$row[csf('job_no')].',';
					$gmts_item='';
					$gmts_item_id=explode(",",$row[csf('gmts_item_id')]);
					foreach($gmts_item_id as $item_id)
					{
						if($gmts_item=="") $gmts_item=$garments_item[$item_id]; else $gmts_item.=",".$garments_item[$item_id];
					}
					//$job_arr2[$row[csf("job_no")]]['job_quantity'];
					$job_quantity=$row[csf('job_quantity')];
					//echo $job_quantity.'D';
					$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
					$plan_cut_qnty=$row[csf('plan_cut')]*$row[csf('ratio')];
					$unit_price=$row[csf('unit_price')]/$row[csf('ratio')];
					$po_value=$order_qnty_in_pcs*$unit_price;
					
					$tot_po_qnty+=$order_qnty_in_pcs; 
					$tot_po_value+=$po_value;
					//echo "DDD";die;
					$ex_factory_qty=$ex_factory_arr[$row[csf('id')]];
					$ex_factory_value=$ex_factory_qty*$unit_price;
					
					$tot_ex_factory_qnty+=$ex_factory_qty; 
					$tot_ex_factory_val+=$ex_factory_value; 
					
					$dzn_qnty=0;
					$costing_per_id=$fabriccostArray[$row[csf('job_no')]]['costing_per_id'];
					if($costing_per_id==1) $dzn_qnty=12;
					else if($costing_per_id==3) $dzn_qnty=12*2;
					else if($costing_per_id==4) $dzn_qnty=12*3;
					else if($costing_per_id==5) $dzn_qnty=12*4;
					else $dzn_qnty=1;

					$dzn_qnty=$dzn_qnty*$row[csf('ratio')];
					$yarn_cost_mkt=$yarn_costing_arr[$row[csf('id')]];
					 $yarn_cost_mkt_qty=$yarn_costing_qty_arr[$row[csf('id')]];
					$knit_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][1]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['knit_charge'];
					$knit_qty_mkt=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][1]);
					$yarn_dyeing_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][30]);
					//if($yarn_dyeing_cost_mkt) $yarn_dyeing_cost_mkt=$yarn_dyeing_cost_mkt;else $yarn_dyeing_cost_mkt=0;
					$twisting_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][134]);
					//if($twisting_cost_mkt) $twisting_cost_mkt=$twisting_cost_mkt;else $twisting_cost_mkt=0;
					$yarn_value_addition_cost_mkt=$yarn_dyeing_cost_mkt+$twisting_cost_mkt;
					//echo $yarn_dyeing_cost_mkt.'=='.$twisting_cost_mkt.', ';
					
					if($knit_cost_mkt>0)
					{
					$knit_charge_mkt=$knit_cost_mkt/$knit_qty_mkt;//$dye_finish_cost_mkt_qty
					}
					
					$dye_finish_cost_mkt=0;$dye_finish_cost_mkt_qty=0;
					foreach($conversion_cost_head_array as $process_id=>$val)
					{
						if(!in_array($process_id,$not_yarn_dyed_cost_arr))
						{
							$dye_finish_cost_mkt+=array_sum($conversion_costing_arr_process[$row[csf('id')]][$process_id]);
							
							$dye_finish_cost_mkt_qty+=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][$process_id]);
						}
					}	
					if($dye_finish_cost_mkt>0)
					{			
					$knit_charge_mkt_fin=$dye_finish_cost_mkt/$dye_finish_cost_mkt_qty;
					}
					//echo $dye_finish_cost_mkt.'='.$dye_finish_cost_mkt_qty;
					//$yarn_dye_cost_mkt=$conversion_costing_arr_process[$row[csf('id')]][30];
					$aop_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][35]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['aop_charge'];
					$trims_cost_mkt=$trims_costing_arr[$row[csf('id')]];//($order_qnty_in_pcs/$dzn_qnty)*$trimsCostArray[$row[csf('id')]];
				
					
					$print_amount=$emblishment_costing_arr_name[$row[csf('id')]][1];
					$print_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][1];
					if($print_amount) $print_amount=$print_amount;else $print_amount=0;
					if($print_qty) $print_qty=$print_qty;else $print_qty=0;
					if($print_amount==0 || $print_qty==0) $print_avg_rate=0;
					else $print_avg_rate=$print_amount/$print_qty;
						
					$embroidery_amount=$emblishment_costing_arr_name[$row[csf('id')]][2];
					$embroidery_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][2];
					if($embroidery_amount) $embroidery_amount=$embroidery_amount;else $embroidery_amount=0;
					if($embroidery_qty) $embroidery_qty=$embroidery_qty;else $embroidery_qty=0;
					if($embroidery_amount==0 || $embroidery_qty==0) $embro_avg_rate=0;
					else $embro_avg_rate=$embroidery_amount/$embroidery_qty;
					//$special_amount=$emblishment_costing_arr_name[$row[csf('id')]][4];
					$wash_cost=$emblishment_costing_arr_name_wash[$row[csf('id')]][3];
					$wash_qty=$emblishment_costing_arr_name_wash_qty[$row[csf('id')]][3];
					if($wash_cost) $wash_cost=$wash_cost;else $wash_cost=0;
					if($wash_qty) $wash_qty=$wash_qty;else $wash_qty=0;
					if($wash_cost==0 || $wash_qty==0) $wash_avg_rate=0;
					else $wash_avg_rate=$wash_cost/$wash_qty;
					
					$other_amount=$emblishment_costing_arr_name[$row[csf('id')]][5];
					$dyeing_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][5];
					if($other_amount) $other_amount=$other_amount;else $other_amount=0;
					if($dyeing_qty) $dyeing_qty=$dyeing_qty;else $dyeing_qty=0;
					if($other_amount==0 || $dyeing_qty==0) $dyeing_avg_rate=0;
					else $dyeing_avg_rate=$other_amount/$dyeing_qty;
					
					$foreign_cost=$commission_costing_arr[$row[csf('id')]][1];
					$local_cost=$commission_costing_arr[$row[csf('id')]][2];
					
					$test_cost=$other_costing_arr[$row[csf('id')]]['lab_test'];
					$freight_cost=$other_costing_arr[$row[csf('id')]]['freight'];
					$inspection_cost=$other_costing_arr[$row[csf('id')]]['inspection'];
					$certificate_cost=$other_costing_arr[$row[csf('id')]]['certificate_pre_cost'];
					//$common_oh_cost=$other_costing_arr[$row[csf('id')]]['common_oh'];
					$currier_cost=$other_costing_arr[$row[csf('id')]]['currier_pre_cost'];
					$cm_cost=$other_costing_arr[$row[csf('id')]]['cm_cost'];
					$embell_cost_mkt=$print_amount+$embroidery_amount+$wash_cost+$other_amount;
					
					$wash_cost_mkt=$wash_cost;
					$commission_cost_mkt=$foreign_cost+$local_cost;
					$comm_cost_mkt=$commercial_costing_arr[$row[csf('id')]];
					$freight_cost_mkt=$freight_cost;
					$test_cost_mkt=$test_cost;
					$inspection_cost_mkt=$inspection_cost;
					$currier_cost_mkt=$currier_cost;
					$cm_cost_mkt=$cm_cost;
						//echo "MM";die;
					
					$fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['grey'][$row[csf('id')]]);
					//+array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
					$fabric_purchase_cost2=array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
					$fabric_purchase_cost_mkt=$fabric_purchase_cost+$fabric_purchase_cost2;
					$finish_fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
					$finish_fabric_purchase_cost_mkt=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
					$grey_fab_cost_mkt=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt;
					$mkt_all_cost=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt+$trims_cost_mkt+$embell_cost_mkt+$wash_cost_mkt+$commission_cost_mkt+$comm_cost_mkt+$freight_cost_mkt+$test_cost_mkt+$inspection_cost_mkt+$currier_cost_mkt+$cm_cost_mkt+$fabric_purchase_cost_mkt;
					
					$mkt_margin=$po_value-$mkt_all_cost;
					$mkt_margin_perc=($mkt_margin/$po_value)*100;
					$tot_finish_fabric_cost_mkt=$grey_fab_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt;
					
					//$yarn_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$yarncostArray[$row[csf('job_no')]];
					//$knit_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['knit_charge'];
					//$dye_finish_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['dye_finish_charge'];
					//$yarn_dye_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['yarn_dye_charge'];
					//$aop_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['aop_charge'];
					//$trims_cost_actual=($order_qnty_in_pcs/$dzn_qnty)*$trimsCostArray[$row[csf('id')]];
					$grey_prod_ex_rate=$grey_fab_array[$row[csf('id')]]['ex_rate'];
					$dye_fin_ex_rate=$dye_fin_fab_array[$row[csf('id')]]['ex_rate'];
					
					//$fin_fab_prod_qnty=$grey_fab_array[$row[csf('id')]]['fin_qnty'];
					//echo $grey_fab_array[$row[csf('id')]]['qnty'].'*'.$knit_charge_mkt.'/'.$grey_prod_ex_rate;
					if($process_costing==1)
					{
						$grey_prod_cost=$grey_fab_array[$row[csf('id')]]['qnty']*$knit_charge_mkt;
					}
					else
					{
						$grey_prod_cost=$grey_fab_array[$row[csf('id')]]['grey_amt'];
					}
					$knit_cost_actual=$grey_prod_cost;
					
					$cpa_grey_prod_cost=$grey_fab_array[$row[csf('id')]]['cpa_grey_amt'];
					$cpa_knit_cost_actual=$cpa_grey_prod_cost;
					// echo $dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'].'/'.$knit_charge_mkt_fin.'=='.$dye_fin_ex_rate.', ';
					$cpa_dye_fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'];
					 $cpa_dye_finish_cost_actual=$cpa_dye_fin_fab_prod_cost;
					
					$fin_fab_prod_cost=$grey_used_arr[$row[csf('id')]]['grey_used_amt']+$fin_grey_used_arr[$row[csf('id')]]['grey_used_amt'];//$dye_fin_fab_array[$row[csf('id')]]['fin_amt'];
					$dye_finish_cost_actual=$fin_fab_prod_cost;
					
					$cpa_recv_ret_amt=$receive_ret_arr[$row[csf('job_no')]]['cpa_recv_ret_amt'];
					$cpa_yarn_recv_amt_bal=$yarn_receive_amount_arr[$row[csf('job_no')]]['cpa_order_amount_recv']-$cpa_recv_ret_amt;
					if($cpa_yarn_recv_amt_bal==0) $cpa_yarn_recv_amt_bal_actual=0;
					else $cpa_yarn_recv_amt_bal_actual=($cpa_yarn_recv_amt_bal/$job_quantity)*$order_qnty_in_pcs;
					
					
					//$cpa_yarn_recv_amt_bal_actual=($cpa_yarn_recv_amt_bal/$job_quantity)*$order_qnty_in_pcs;
					
					//echo  $yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt'].'='.$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt'].'='.$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt'].'='.$cpa_knit_cost_actual.'='.$cpa_dye_finish_cost_actual.',';
					$yarn_cost_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt']+$cpa_yarn_recv_amt_bal_actual+$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt']+$cpa_knit_cost_actual+$cpa_dye_finish_cost_actual-($yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_yarn_ret_amt']+$yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_ret_amt']);
					//$yarn_dyeing_twist_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt'];
					$yarn_ret_qty_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_qty_retble'];
					$yarn_ret_amt_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt_retble'];
					$tot_yarn_qty_cpa_actual+=$yarn_cost_cpa_actual;
					//$tot_yarn_amt_cpa_actual+=$yarn_ret_qty_cpa_actual;
					//echo $yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt'].'-'.$yarnissueRetCostArray[$row[csf('id')]]['grey_yarn_ret_amt'].'-'.$yarn_cost_cpa_actual.'<br>';
					//$cpa_grey_yarn_amt=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt'];
					//echo $yarnissueRetCostArray[$row[csf('id')]]['grey_yarn_ret_amt'].'X';
					$yarn_cost_actual=($yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt']+$yarn_cost_cpa_actual)-$yarnissueRetCostArray[$row[csf('id')]]['grey_yarn_ret_amt'];
					//echo $yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt'].'D';
					$yarn_ret_qty_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_qty_retble'];
					$yarn_ret_amt_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt_retble'];
					$tot_yarn_qty_actual+=$yarn_ret_qty_actual;
					$tot_yarn_amt_actual+=$yarn_ret_amt_actual;
					$job_quantity=$job_arr2[$row[csf("job_no")]]['job_quantity'];
					
					
					//echo $order_amount_recv_ret.', ';
					//$yarn_receive_amount_arr[$jobNo]['cpa_order_amount_recv']; 
					$order_amount_recv=$yarn_receive_amount_arr[$row[csf('job_no')]]['order_amount_recv'];
					$order_amount_recv_ret=$receive_ret_arr[$row[csf('job_no')]]['recv_ret_amt'];
					
					
					
					//echo $cpa_yarn_recv_amt_bal_actual.'/'.$job_quantity.'*'.$order_qnty_in_pcs.', ';
					$order_amount_recv_bal=$order_amount_recv-$order_amount_recv_ret;
					$avg_recv_amount_actual=($order_amount_recv_bal/$job_quantity)*$order_qnty_in_pcs;

					$yarn_dyeing_twist_actual=$avg_recv_amount_actual;//-$yarnissueRetCostArray[$row[csf('id')]]['grey_dyeing_twist_ret_amt'];
					
					
					$trans_in_amt=$recvIssue_array[$row[csf('id')]][5];
				    $trans_out_amt=$recvIssue_array[$row[csf('id')]][6];
					
					$fin_trans_in_amt=$fin_fab_trans_array[$row[csf('id')]][5];
				    $fin_trans_out_amt=$fin_fab_trans_array[$row[csf('id')]][6];
					
					$grey_fab_transfer=$trans_in_amt-$trans_out_amt;
					//echo $grey_fab_transfer.'D';
					$grey_fab_transfer_amt_actual=$grey_fab_transfer*$knit_charge_mkt;
					
					$fin_fab_transfer=$fin_trans_in_amt-$fin_trans_out_amt;
					//echo $fin_fab_transfer.'='.$knit_charge_mkt_fin;
					$fin_fab_transfer_amt_actual=$fin_fab_transfer*$knit_charge_mkt_fin;
					
					//echo $yarn_cost_actual.'<br>';
					//$trims_cost_actual=$yarnTrimsCostArray[$row[csf('id')]][4]/$exchange_rate;
					$trims_amount=$trims_trans_array[$row[csf('id')]]['amt'];
					$gen_trims_issue_amt=$gen_trims_issue_array[$row[csf('id')]]['amt'];
					$trims_cost_actual=$trims_amount+$gen_trims_issue_amt;
					//echo $trims_amount.'='.$gen_trims_issue_amt;
					$yarn_dye_cost_actual=0;
					$aop_prod_amt=$aop_prod_array[$row[csf('id')]]['aop_amt'];
					//$aop_avg_rate=$aop_prod_array[$row[csf('id')]]['aop_rate'];
					//echo $aop_prod_qty.'='.$aop_avg_rate;
					$aop_cost_actual=$aop_prod_amt;
					$embell_cost_actual=$embellCostArray[$row[csf('id')]];
					$wash_cost_actual=$washCostArray[$row[csf('id')]];
					
					//Finished Fabric Cost
					
					
					$printing_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['printing_qty']/$dzn_qnty)*$print_avg_rate;
					//echo $embl_issue_prod_array[$row[csf('id')]]['printing_qty'].'*'.$print_avg_rate;
					$embro_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['embro_qty']/$dzn_qnty)*$embro_avg_rate;
					$dyeing_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['dyeing_qty']/$dzn_qnty)*$dyeing_avg_rate;
					$wash_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['wash_qty']/$dzn_qnty)*$wash_avg_rate;
					
					$commission_cost_actual=($ex_factory_qty/$dzn_qnty)*$fabriccostArray[$row[csf('job_no')]]['commission'];
					$comm_cost_actual=$actualCostArray[6][$row[csf('id')]];
					$freight_cost_actual=$actualCostArray[2][$row[csf('id')]];
					$test_cost_actual=$actualCostArray[1][$row[csf('id')]];
					$inspection_cost_actual=$actualCostArray[3][$row[csf('id')]];
					$currier_cost_actual=$actualCostArray[4][$row[csf('id')]];
					$cm_cost_actual=$actualCostArray[5][$row[csf('id')]];
					
					$fabric_purchase_cost_actual=$finish_purchase_amnt_arr[$row[csf('id')]];
					$grey_fabric_purchase_cost_actual=$grey_purchase_amnt_arr[$row[csf('id')]];
					$grey_fab_cost_actual=$yarn_cost_actual+$yarn_dyeing_twist_actual+$knit_cost_actual+$grey_fab_transfer_amt_actual;
					$finished_fab_cost_actual=$grey_fab_cost_actual+$dye_finish_cost_actual+$aop_cost_actual+$fin_fab_transfer_amt_actual+$fabric_purchase_cost_actual;
					$tot_fabric_cost_act=$fabric_purchase_cost_actual+$finished_fab_cost_actual;
					$tot_fabric_cost_actaul+=$tot_fabric_cost_act;
					
					$actual_all_cost=$yarn_cost_actual+$knit_cost_actual+$yarn_dyeing_twist_actual+$grey_fab_transfer_amt_actual+$dye_finish_cost_actual+$yarn_dye_cost_actual+$aop_cost_actual+$trims_cost_actual+$printing_cost_actual+$embro_cost_actual+$dyeing_cost_actual+$wash_cost_actual+$commission_cost_actual+$comm_cost_actual+$freight_cost_actual+$test_cost_actual+$inspection_cost_actual+$currier_cost_actual+$cm_cost_actual+$fabric_purchase_cost_actual+$grey_fabric_purchase_cost_actual;
					
					$actual_margin=$ex_factory_value-$actual_all_cost;
					$actual_margin_perc=($actual_margin/$ex_factory_value)*100;
					$tot_fabric_cost_mkt=$tot_finish_fabric_cost_mkt+$fabric_purchase_cost_mkt;
					$tot_yarn_cost_mkt+=$yarn_cost_mkt;
					$tot_yarn_value_addition_cost_mkt+=$yarn_value_addition_cost_mkt;
					$tot_grey_fab_cost_mkt+=$grey_fab_cost_mkt; 
					$tot_knit_cost_mkt+=$knit_cost_mkt; 
					$tot_dye_finish_cost_mkt+=$dye_finish_cost_mkt; 
					//$tot_yarn_dye_cost_mkt+=$yarn_dye_cost_mkt; 
					$tot_aop_cost_mkt+=$aop_cost_mkt; 
					$total_fabric_cost_mkt+=$tot_fabric_cost_mkt;
					$tot_trims_cost_mkt+=$trims_cost_mkt;
					 $total_finish_fabric_cost_mkt+=$tot_finish_fabric_cost_mkt;
					$tot_print_amount_mkt+=$print_amount; 
					$tot_embro_amount_mkt+=$embroidery_amount; 
					$tot_dyeing_amount_mkt+=$other_amount; 
					$tot_wash_amount_mkt+=$wash_cost; 
					
					$tot_embell_cost_mkt+=$embell_cost_mkt; 
					$tot_wash_cost_mkt+=$wash_cost_mkt; 
					$tot_commission_cost_mkt+=$commission_cost_mkt; 
					$tot_comm_cost_mkt+=$comm_cost_mkt; 
					$tot_freight_cost_mkt+=$freight_cost_mkt; 
					$tot_test_cost_mkt+=$test_cost_mkt; 
					$tot_inspection_cost_mkt+=$inspection_cost_mkt; 
					$tot_currier_cost_mkt+=$currier_cost_mkt; 
					$tot_cm_cost_mkt+=$cm_cost_mkt; 
					$tot_mkt_all_cost+=$mkt_all_cost; 
					$tot_mkt_margin+=$mkt_margin; 
					$tot_yarn_cost_actual+=$yarn_cost_actual; 
					$tot_yarn_dyeing_twist_actual+=$yarn_dyeing_twist_actual; 
					$tot_knit_cost_actual+=$knit_cost_actual; 
					$tot_dye_finish_cost_actual+=$dye_finish_cost_actual;
					$tot_yarn_dye_cost_actual+=$yarn_dye_cost_actual; 
					$tot_aop_cost_actual+=$aop_cost_actual; 
					$tot_trims_cost_actual+=$trims_cost_actual; 
					$tot_grey_fab_cost_actual+=$grey_fab_cost_actual; 
					$tot_grey_fab_transfer_amt_actual+=$grey_fab_transfer_amt_actual; 
					$tot_print_amount_actual+=$printing_cost_actual; 
					$tot_embro_amount_actual+=$embro_cost_actual; 
					$tot_dyeing_amount_actual+=$dyeing_cost_actual; 
					$tot_wash_amount_actual+=$wash_cost_actual; 
					$tot_finished_fab_cost_actual+=$finished_fab_cost_actual;
					$tot_fin_fab_transfer_amt_actual+=$fin_fab_transfer_amt_actual;
					$tot_embell_cost_actual+=$embell_cost_actual;
					$tot_wash_cost_actual+=$wash_cost_actual; 
					$tot_commission_cost_actual+=$commission_cost_actual; 
					$tot_comm_cost_actual+=$comm_cost_actual; 
					$tot_freight_cost_actual+=$freight_cost_actual; 
					$tot_test_cost_actual+=$test_cost_actual; 
					$tot_inspection_cost_actual+=$inspection_cost_actual; 
					$tot_currier_cost_actual+=$currier_cost_actual; 
					$tot_cm_cost_actual+=$cm_cost_actual; 
					$tot_actual_all_cost+=$actual_all_cost; 
					$tot_actual_margin+=$actual_margin;
					$tot_actual_net_margin+=$actual_margin-$yarn_cost_cpa_actual; 
					
					$tot_fabric_purchase_cost_mkt+=$fabric_purchase_cost_mkt;
					$tot_fabric_purchase_cost_actual+=$fabric_purchase_cost_actual;
					$tot_grey_fabric_purchase_cost_actual+=$grey_fabric_purchase_cost_actual;
					
					/*$buyer_name_array[$row[csf('buyer_name')]]=$buyer_arr[$row[csf('buyer_name')]];
					$mkt_po_val_array[$row[csf('buyer_name')]]+=$po_value;
					$mkt_yarn_array[$row[csf('buyer_name')]]+=$yarn_cost_mkt;
					
					$mkt_knit_array[$row[csf('buyer_name')]]+=$knit_cost_mkt;
					$mkt_yarn_value_addition_array[$row[csf('buyer_name')]]+=$yarn_value_addition_cost_mkt;
					$mkt_dy_fin_array[$row[csf('buyer_name')]]+=$dye_finish_cost_mkt;
					$mkt_grey_fab_cost_array[$row[csf('buyer_name')]]+=$grey_fab_cost_mkt;
					$mkt_aop_array[$row[csf('buyer_name')]]+=$aop_cost_mkt;
					$mkt_trims_array[$row[csf('buyer_name')]]+=$trims_cost_mkt;
					$mkt_print_array[$row[csf('buyer_name')]]+=$print_amount;
					$mkt_embro_array[$row[csf('buyer_name')]]+=$embroidery_amount;
					$mkt_dyeing_array[$row[csf('buyer_name')]]+=$other_amount;
					//$mkt_wash_array[$row[csf('buyer_name')]]+=$wash_cost;
					
					$mkt_emb_array[$row[csf('buyer_name')]]+=$embell_cost_mkt;
					$mkt_wash_array[$row[csf('buyer_name')]]+=$wash_cost_mkt;
					$mkt_commn_array[$row[csf('buyer_name')]]+=$commission_cost_mkt;
					$mkt_commercial_array[$row[csf('buyer_name')]]+=$comm_cost_mkt;
					$mkt_freight_array[$row[csf('buyer_name')]]+=$freight_cost_mkt;
					$mkt_test_array[$row[csf('buyer_name')]]+=$test_cost_mkt;
					$mkt_ins_array[$row[csf('buyer_name')]]+=$inspection_cost_mkt;
					$mkt_courier_array[$row[csf('buyer_name')]]+=$currier_cost_mkt;
					$mkt_cm_array[$row[csf('buyer_name')]]+=$cm_cost_mkt;
					$mkt_total_array[$row[csf('buyer_name')]]+=$mkt_all_cost;
					$mkt_margin_array[$row[csf('buyer_name')]]+=$mkt_margin;
					$mkt_fabric_purchase_array[$row[csf('buyer_name')]]+=$fabric_purchase_cost_mkt;
					$mkt_fin_fabric_purchase_array[$row[csf('buyer_name')]]+=$finish_fabric_purchase_cost_mkt;
						
					$ex_factory_val_array[$row[csf('buyer_name')]]+=$ex_factory_value;
					$yarn_cost_array[$row[csf('buyer_name')]]+=$yarn_cost_actual;
					$yarn_dyeing_twist_array[$row[csf('buyer_name')]]+=$yarn_dyeing_twist_actual;
					$knit_cost_array[$row[csf('buyer_name')]]+=$knit_cost_actual;
					$dye_cost_array[$row[csf('buyer_name')]]+=$dye_finish_cost_actual;
					$grey_fab_cost_array[$row[csf('buyer_name')]]+=$grey_fab_cost_actual;
					$fin_fab_transfer_amt_actual_array[$row[csf('buyer_name')]]+=$fin_fab_transfer_amt_actual;
					$finished_fab_cost_actual_array[$row[csf('buyer_name')]]+=$finished_fab_cost_actual;
				
					$aop_n_others_cost_array[$row[csf('buyer_name')]]+=$aop_cost_actual;
					$trims_cost_array[$row[csf('buyer_name')]]+=$trims_cost_actual;
					
					$print_act_cost_array[$row[csf('buyer_name')]]+=$printing_cost_actual;
					$embro_act_cost_array[$row[csf('buyer_name')]]+=$embro_cost_actual;
					$dyeing_act_cost_array[$row[csf('buyer_name')]]+=$dyeing_cost_actual;
					$wash_act_cost_array[$row[csf('buyer_name')]]+=$wash_cost_actual;
					
					$enbellishment_cost_array[$row[csf('buyer_name')]]+=$embell_cost_actual;
					$wash_cost_array[$row[csf('buyer_name')]]+=$wash_cost_actual;
					$commission_cost_array[$row[csf('buyer_name')]]+=$commission_cost_actual;
					$commercial_cost_array[$row[csf('buyer_name')]]+=$comm_cost_actual;
					$freight_cost_array[$row[csf('buyer_name')]]+=$freight_cost_actual;
					$testing_cost_array[$row[csf('buyer_name')]]+=$test_cost_actual;
					$inspection_cost_array[$row[csf('buyer_name')]]+=$inspection_cost_actual;
					$courier_cost_array[$row[csf('buyer_name')]]+=$currier_cost_actual;
					$cm_cost_array[$row[csf('buyer_name')]]+=$cm_cost_actual;
					$total_cost_array[$row[csf('buyer_name')]]+=$actual_all_cost;
					$margin_array[$row[csf('buyer_name')]]+=$actual_margin;
					$actual_fabric_purchase_array[$row[csf('buyer_name')]]+=$fabric_purchase_cost_actual;*/
					//$dealing_library=return_library_array( "select id, team_member_name from lib_mkt_team_member_info", "id", "team_member_name");
	//$leader_library
					
				// $button_po="<a href='#' onClick=\"generate_po_report('".$company_name."','".$row[csf('id')]."','".$row[csf('job_no')]."','show_po_detail_report','1')\" '> ".$row[csf('po_number')]."<a/>";
					
				?>
                	<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="70"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
                       
                        <td width="70" align="center"><? echo $row[csf('job_no_prefix_num')]; ?></td>
                        <td width="110"  style="word-break:break-all;"><? echo $row[csf('style_ref_no')]; ?></td>
                        <td width="100"  style="word-break:break-all;"><? echo  $row[csf('po_number')];//$button_po; ?></td>
                        
                        <td width="80"  style="word-break:break-all;"><? echo $row[csf('grouping')]; ?></td>
                        
                        <td width="70" align="center"><? echo $job_quantity; ?></td>
                        <td width="120"  style="word-break:break-all;"><? echo $gmts_item; ?></td>
                        <td width="90" align="right"  ><? echo $order_qnty_in_pcs; ?></td>
                        <td width="90" align="right"  ><? echo $ex_factory_qty; ?></td>
                        <td width="100"  style="word-break:break-all;"><? echo $leader_library[$row[csf('team_leader')]]; ?></td>
                        <td width="100" align="center" ><? echo $dealing_library[$row[csf('dealing_marchant')]]; ?></td>
                        <td width="70" align="right"><? echo fn_number_format($unit_price,2,'.',''); ?></td>
                        <td width="110" align="right"><? echo fn_number_format($po_value,2,'.',''); ?></td>
                        <td width="100" align="right"><? echo fn_number_format($ex_factory_value,2,'.',''); ?></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('pub_shipment_date')]); ?></td>
                        <td width="100"  style="word-break:break-all;"><? echo $shipment_status[$row[csf('shiping_status')]]; ?></td>
                       
                        <td width="100" align="right" title="PoQty-Ship Qty" ><? echo fn_number_format($order_qnty_in_pcs-$ex_factory_qty,0,'.',''); ?></td>
                        <td width="" align="right" title="PoValue-Ship Value"><? echo fn_number_format($po_value-$ex_factory_value,2,'.',''); ?></td>
                       
                         
                    </tr>
                    
                    
				<?
					$i++;
					$tot_short_excess_Qty+=$order_qnty_in_pcs-$ex_factory_qty;
					$tot_short_excess_val+=$po_value-$ex_factory_value;
				}
				
				//$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
				
				?>
            </table>
		</div>
        <table class="rpt_table" width="<? echo $width;?>" cellpadding="0" cellspacing="0" border="1" rules="all">
            <tr bgcolor="#CCDDEE" onClick="change_color('tr_pt','#CCDDEE')" id="tr_pt" style="font-weight:bold;">
              <td width="40">&nbsp;</td>
                <td width="70">&nbsp;</td>
               
                <td width="70">&nbsp;</td>
                <td width="110">&nbsp;</td>
                <td width="100">&nbsp;</td>
               
                <td width="80">&nbsp;</td>
              
                 <td width="70">&nbsp;</td>
                <td width="120" align="">Total</td>
                <td width="90"  align="right"><? echo fn_number_format($tot_po_qnty,0,'.',''); ?></td>
                <td width="90"  align="right"><? echo fn_number_format($tot_ex_factory_qnty,0,'.',''); ?></td>
                <td width="100">&nbsp;</td>
              
                <td width="100">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="110"  align="right"><? echo fn_number_format($tot_po_value,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_ex_factory_val,2,'.',''); ?></td>
                <td width="80">&nbsp;</td>
                <td width="100">&nbsp;</td>
              
                <td width="100"  align="right"><? echo fn_number_format($tot_short_excess_Qty,0,'.',''); ?></td>
                <td width=""  align="right"><? echo fn_number_format($tot_short_excess_val,2,'.',''); ?></td>
                
                
            </tr>
            <? //echo die;?>
            
            
        </table>
        <br />
        <table width="4330">
            <tr>
                <td width="850" valign="top">
                    <div align="center" style="width:450px" id="div_summary"><input type="button" value="Print Preview" class="formbutton" onClick="new_window2('company_div','summary_full')" /></div>
                    <br /><? $po_ids=implode(',',$po_ids_array);$job_ids=rtrim($job_ids,','); $job_nos=implode(',',array_unique(explode(",",$job_ids))); ?>
                    <div id="summary_full"> <font color="#FF0000" style="display:none">*Yarn Dyeing Charge included with actual Yarn Cost</font>
                        <div align="center" id="company_div" style="visibility:hidden; font-size:24px;width:700px"><b><? echo $company_arr[$company_name].'<br>'; 
						echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to));
						?></b></div>
                        <table width="850" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
                            <thead>
                            <tr>
                                <th colspan="9">Summary</th>
                            </tr>
                            <tr>
                                <th width="30">SL</th>
                                <th width="180">Particulars</th>
                                <th width="130">Pre Costing</th>
                                <th width="80">%</th>
                                <th width="130">At Actual</th>
                                <th width="80">%</th>
                                <th width="80">Variance</th>
                                <th width="80">%</th>
                                <th>Disclosure</th>
                            </tr> 
							<?
								$bgcolor1='#E9F3FF';
								$bgcolor2='#FFFFFF';
							?>
                            </thead>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_1','<? echo $bgcolor1; ?>')" id="trtd_1">
                                <td align="center">1</td>
                                <td>PO/Shipment Value</td>
                                <td align="right"><? echo fn_number_format($tot_po_value,2); ?></td>
                                <td align="right">&nbsp;</td>
                                <td align="right"><? echo fn_number_format($tot_ex_factory_val,2); ?></td>
                                <td align="right">&nbsp;</td>
                                <td align="right"><? echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                                <td align="right"  title="Variance/PO-Shipment Value Mkt*100"><? echo fn_number_format((($tot_ex_factory_val-$tot_po_value)/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_2','<? echo $bgcolor2; ?>')" id="trtd_2">
                                <td colspan="9"><b>Cost</b></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_3','<? echo $bgcolor1; ?>')" id="trtd_3">
                                <td align="center">2</td>
                                <td>Grey Yarn Cost</td>
                                <td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_cost','Grey Yarn Mkt. Cost Details')"><? echo fn_number_format($tot_yarn_cost_mkt,2); //$tot_yarn_qty_actual?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_cost_actual2','Yarn Cost Details')"><? echo fn_number_format($tot_yarn_cost_actual,2); //$tot_yarn_qty_actual;?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_yarn_cost_mkt-$tot_yarn_cost_actual,2);//$tot_yarn_amt_actual ?></td>
                                <td align="right"  title="Variance/Grey Yarn Cost Mkt*100"><? echo fn_number_format((($tot_yarn_cost_mkt-$tot_yarn_cost_actual)/$tot_yarn_cost_mkt)*100,2); ?></td>
                                 <td align="right"><?  if($tot_yarn_qty_actual>$tot_yarn_cost_mkt) echo "Returnable Yarn Qty..".$tot_yarn_qty_actual."And Cost..".$tot_yarn_amt_actual; else echo " ";?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_4','<? echo $bgcolor2; ?>')" id="trtd_4">
                                <td align="center">3</td>
                                <td>Yarn  Value Addition Cost</td>
                                <td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_dyeing_twisting_cost','Yarn Dyeing Cost Details')"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></a><? //echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_dye_twist_cost_actual','Yarn Dyeing & Twist Cost Details','2','900px')"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual,2); ?></td>
                                 <td align="right" title="Variance/Yarn Value  Addition Cost Mkt*100"><? echo fn_number_format((($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual)/$tot_yarn_value_addition_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_5','<? echo $bgcolor2; ?>')" id="trtd_5">
                                <td align="center">4</td>
                                <td>Knitting Cost</td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knit_cost_actual','Knitting Cost Details')"><? echo fn_number_format($tot_knit_cost_actual,2); ?></a><? //echo fn_number_format($tot_knit_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Knitting Cost Mkt*100"><? echo fn_number_format((($tot_knit_cost_mkt-$tot_knit_cost_actual)/$tot_knit_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_6','<? echo $bgcolor2; ?>')" id="trtd_6">
                                <td align="center">5</td>
                                <td>Grey Fabric Transfer Cost</td>
                                <td align="right"><? //echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></a><? echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
                                 <td align="right"><? echo " "; ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_7','<? echo $bgcolor2; ?>')" id="trtd_7">
                                <td align="center">6</td>
                                <td>Grey Fabric Cost =2+3+4+5</td>
                                <td align="right"><? 
								$grey_fab_cost_mkt_sum=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt;
								$grey_fab_cost_act_sum=$tot_yarn_cost_actual+$tot_yarn_dyeing_twist_actual+$tot_knit_cost_actual+$tot_grey_fab_transfer_amt_actual;
								
								echo fn_number_format($grey_fab_cost_mkt_sum,2); ?></td>
                                <td align="right"><? echo fn_number_format(($grey_fab_cost_mkt_sum/$tot_po_value)*100,2); ?></td>
                                <td align="right" title=""><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_cost_actual,2); ?></a><? echo fn_number_format($grey_fab_cost_act_sum,2); ?></td>
                                <td align="right"><? echo fn_number_format(($grey_fab_cost_act_sum/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum,2); ?></td>
                                 <td align="right" title="Variance/Grey Fab Cost Mkt*100"><? echo fn_number_format((($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum)/$grey_fab_cost_mkt_sum)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_8','<? echo $bgcolor2; ?>')" id="trtd_8">
                                <td align="center">7</td>
                                <td>Dye & Fin Cost</td>
                                <td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dye_finish_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $po_ids; ?>','dye_finish_cost_actual','Actual Dyeing & Finish Cost Details','900px')"><? echo fn_number_format($tot_dye_finish_cost_actual,2,'.',''); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_dye_finish_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Dye & Fin Cost Mkt*100"><?  echo fn_number_format((($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual)/$tot_dye_finish_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_9','<? echo $bgcolor1; ?>')" id="trtd_9">
                                <td align="center">8</td>
                                <td>AOP  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/AOP Cost Mkt*100"><? echo fn_number_format((($tot_aop_cost_mkt-$tot_aop_cost_actual)/$tot_aop_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_10','<? echo $bgcolor2; ?>')" id="trtd_10">
                                <td align="center">9</td>
                                <td>Finished Fabric Transfer Cost</td>
                                <td align="right"><? //echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
                                <td align="right"><? // echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
                                 <td align="right"><? echo " "; ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_11','<? echo $bgcolor1; ?>')" id="trtd_11">
                                <td align="center">10</td>
                                <td>Finished Fabric Cost =6+7+8+9</td>
                                <td align="right"><? $tot_fin_fab_cost_sum_mkt=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
								//$tot_fin_fabCost=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
								echo fn_number_format($tot_fin_fab_cost_sum_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? $tot_fin_fab_cost_sum_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual;
								echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual,2); ?></td>
                                 <td align="right" title="Variance/Finished Fabric Cost Mkt*100"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual)/$tot_fin_fab_cost_sum_mkt)*100,2);  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_12','<? echo $bgcolor2; ?>')" id="trtd_12">
                                <td align="center">11</td>
                                <td>Fabric Purchase Cost</td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','fabric_purchase_cost','Fabric Purchase Cost Details')"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Fabric Purchase Cost Mkt*100"><? echo fn_number_format((($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual)/$tot_fabric_purchase_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_27','<? echo $bgcolor2; ?>')" id="trtd_27">
                                <td align="center">12</td>
                                <td>Total Fabric Cost(=10+11)</td>
                                <td align="right"><? $tot_fab_cost_mkt=$tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt;
								echo fn_number_format($tot_fab_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? 
								$tot_fabric_cost_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual;
								echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? $tot_fab_cost_vairance=($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual;
								echo fn_number_format(($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual,2); ?></td>
                                 <td align="right"><?  echo fn_number_format(($tot_fab_cost_vairance/$tot_fab_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? echo ' '; ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_13','<? echo $bgcolor1; ?>')" id="trtd_13">
                                <td align="center">13</td>
                                <td>Trims Cost</td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_mkt-$tot_trims_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Trim Cost Mkt*100"><? echo fn_number_format((($tot_trims_cost_mkt-$tot_trims_cost_actual)/$tot_trims_cost_mkt)*100,2);  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_14','<? echo $bgcolor2; ?>')" id="trtd_14">
                                <td align="center">14</td>
                                <td>Printing Cost</td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_mkt,2); ?></td>
                                <td align="right"><?  echo fn_number_format(($tot_print_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_mkt-$tot_print_amount_actual,2); ?></td>
                                <td align="right" title="Variance/Printing Cost Mkt*100"><?  echo fn_number_format((($tot_print_amount_mkt-$tot_print_amount_actual)/$tot_print_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_15','<? echo $bgcolor1; ?>')" id="trtd_15">
                                <td align="center">15</td>
                                <td> Embroidery Cost</td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_embro_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_embro_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_mkt-$tot_embro_amount_actual,2); ?></td>
                                 <td align="right" title="Variance/Embroidery Cost Mkt*100"><?  echo fn_number_format((($tot_embro_amount_mkt-$tot_embro_amount_actual)/$tot_embro_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_16','<? echo $bgcolor2; ?>')" id="trtd_16">
                                <td align="center">16</td>
                                <td>Gmt Dyeing  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dyeing_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dyeing_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual,2); ?></td>
                                 <td align="right" title="Variance/Gmt Dyeing Cost Mkt*100"><?  echo fn_number_format((($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual)/$tot_dyeing_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_17','<? echo $bgcolor1; ?>')" id="trtd_17">
                                <td align="center">17</td>
                                <td>Washing  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_wash_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_wash_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_mkt-$tot_wash_amount_actual,2); ?></td>
                                <td align="right" title="Variance/Washing Cost Mkt*100"><?  echo fn_number_format((($tot_wash_amount_mkt-$tot_wash_amount_actual)/$tot_wash_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_18','<? echo $bgcolor2; ?>')" id="trtd_18">
                                <td align="center">18</td>
                                <td>Commission Cost</td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_commission_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_commission_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_mkt-$tot_commission_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Commission Cost Mkt*100"><?  echo fn_number_format((($tot_commission_cost_mkt-$tot_commission_cost_actual)/$tot_commission_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_19','<? echo $bgcolor1; ?>')" id="trtd_19">
                                <td align="center">19</td>
                                <td>Commercial Cost</td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_comm_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_comm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_mkt-$tot_comm_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Commercial Cost Mkt*100"><?  echo fn_number_format((($tot_comm_cost_mkt-$tot_comm_cost_actual)/$tot_comm_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_20','<? echo $bgcolor2; ?>')" id="trtd_20">
                                <td align="center">20</td>
                                <td>Freight Cost</td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_freight_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_freight_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_mkt-$tot_freight_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Freight Cost Mkt*100"><?  echo fn_number_format((($tot_freight_cost_mkt-$tot_freight_cost_actual)/$tot_freight_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_21','<? echo $bgcolor1; ?>')" id="trtd_21">
                                <td align="center">21</td>
                                <td>Testing Cost</td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_test_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_test_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_mkt-$tot_test_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Testing Cost Mkt*100"><?  echo fn_number_format((($tot_test_cost_mkt-$tot_test_cost_actual)/$tot_test_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_22','<? echo $bgcolor2; ?>')" id="trtd_22">
                                <td align="center">22</td>
                                <td>Inspection Cost</td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_inspection_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_inspection_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_mkt-$tot_inspection_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Inspection Cost Mkt*100"><?  echo fn_number_format((($tot_inspection_cost_mkt-$tot_inspection_cost_actual)/$tot_inspection_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_23','<? echo $bgcolor1; ?>')" id="trtd_23">
                                <td align="center">23</td>
                                <td>Courier Cost</td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_currier_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_currier_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_mkt-$tot_currier_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Courier Cost Mkt*100"><?  echo fn_number_format((($tot_currier_cost_mkt-$tot_currier_cost_actual)/$tot_currier_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_24','<? echo $bgcolor2; ?>')" id="trtd_24">
                                <td align="center">24</td>
                                <td>CM</td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_cm_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_cm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_mkt-$tot_cm_cost_actual,2); ?></td>
                                <td align="right" title="Variance/CM Cost Mkt*100"><?  echo fn_number_format((($tot_cm_cost_mkt-$tot_cm_cost_actual)/$tot_cm_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_25','<? echo $bgcolor1; ?>')" id="trtd_25">
                                <td align="center">25</td>
                                <td>Total Cost</td>
                                <td align="right"><? echo fn_number_format($tot_mkt_all_cost,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_mkt_all_cost/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_all_cost,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_actual_all_cost/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_mkt_all_cost-$tot_actual_all_cost,2); ?></td>
                                <td align="right" title="Variance/Total Cost Mkt*100"><?  echo fn_number_format((($tot_mkt_all_cost-$tot_actual_all_cost)/$tot_mkt_all_cost)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_26','<? echo $bgcolor2; ?>')" id="trtd_26">
                                <td align="center">26</td>
                                <td>Margin/Loss</td>
                                <td align="right"><? echo fn_number_format($tot_mkt_margin,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_margin,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
                                <td align="right" title="Variance/Margin/Loss Mkt*100"><?  echo fn_number_format((($tot_mkt_margin-$tot_actual_margin)/$tot_mkt_margin)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                             
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_29','<? echo $bgcolor2; ?>')" id="trtd_29">
                                <td align="center">27</td>
                                <td>Net Margin/Loss</td>
                                <td align="right"><? //echo fn_number_format($tot_mkt_margin,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_margin,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
                                 <td align="right"><?  echo ' ';  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                        </table>
                    </div>
                </td>
                
            </tr>
        </table>
	</fieldset>
 <?
	foreach (glob("../../../../ext_resource/tmp_report/$user_name*.xls") as $filename) 
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$html=ob_get_contents();
	$name=time();
	$filename="../../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,$html);
	$filename="../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	echo "$total_data****$filename****$report_type";
	exit();
}

if($action=="report_generate5")
{ 
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process )); 
	
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );

	$company_name=str_replace("'","",$cbo_company_name);
	$txt_order_no=str_replace("'","",$txt_order_no);
	$txt_file_no=str_replace("'","",$txt_file_no);
	$txt_ref_no=str_replace("'","",$txt_ref_no);
	$cbo_based_on=str_replace("'","",$cbo_based_on);
	$report_type=str_replace("'","",$report);
	if($txt_ref_no!='') $ref_cond="and b.grouping='$txt_ref_no'";else $ref_cond="";
	if($txt_file_no!='') $file_cond="and b.file_no=$txt_file_no";else $file_cond="";
	
	if(str_replace("'","",$cbo_buyer_name)==0)
	{
		if ($_SESSION['logic_erp']["data_level_secured"]==1)
		{
			if($_SESSION['logic_erp']["buyer_id"]!="") $buyer_id_cond=" and a.buyer_name in (".$_SESSION['logic_erp']["buyer_id"].")"; else $buyer_id_cond="";
		}
		else $buyer_id_cond="";
	}
	else $buyer_id_cond=" and a.buyer_name=$cbo_buyer_name";//.str_replace("'","",$cbo_buyer_name)
	
	$txt_job_no=str_replace("'","",$txt_job_no);
	if(trim($txt_job_no)!="") $job_no=trim($txt_job_no); else $job_no="%%";
	
	$cbo_year=str_replace("'","",$cbo_year);
	if(trim($cbo_year)!=0) 
	{
		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year"; else if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year"; else $year_cond="";
	}
	else $year_cond="";
	
	$date_cond='';
	if(str_replace("'","",$txt_date_from)!="" && str_replace("'","",$txt_date_to)!="")
	{
		$date_cond=" and b.pub_shipment_date between $txt_date_from and $txt_date_to";
	}
	
	$po_id_cond="";
	if(trim(str_replace("'","",$txt_order_no))!="")
	{
		if(str_replace("'","",$hide_order_id)!="") $po_id_cond=" and b.id in(".str_replace("'","",$hide_order_id).")";
		else $po_id_cond=" and LOWER(b.po_number) like LOWER('%".trim(str_replace("'","",$txt_order_no))."%')";
	}
	
	$shipping_status_cond='';
	if(str_replace("'","",$shipping_status)!=0) $shipping_status_cond=" and b.shiping_status=$shipping_status";
	
	$po_ids_array=array();
		
	if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
	else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
	else $year_field="";//defined Later
		
	  $sql="select a.id as job_id,a.job_no_prefix_num, a.job_no,a.team_leader,a.dealing_marchant, $year_field,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c where a.job_no=b.job_no_mst and a.job_no=c.job_no and b.job_no_mst=c.job_no and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no'   and a.status_active=1 and a.is_deleted=0 and b.status_active!=0 and b.is_deleted=0 $date_cond $buyer_id_cond $po_id_cond $ref_cond $file_cond $shipping_status_cond $year_cond order by b.pub_shipment_date, a.job_no_prefix_num, b.id";
	//echo $sql; //die;
	$result=sql_select($sql);
	$all_po_id="";	$all_job_id="";
	foreach($result as $row)
	{
		if($all_po_id=="") $all_po_id=$row[csf("id")]; else $all_po_id.=",".$row[csf("id")];
		//if($all_job_id=="") $all_job_id="'".$row[csf("job_no")]."'"; else $all_job_id.=","."'".$row[csf("job_no")]."'";
		if($all_job_id=="") $all_job_id=$row[csf("job_id")]; else $all_job_id.=",".$row[csf("job_id")];
		$job_arr[$row[csf("id")]]['job']=$row[csf("job_no")];
		$job_arr2[$row[csf("job_no")]]['po_quantity']=$row[csf("po_quantity")];
		$job_arr2[$row[csf("job_no")]]['job_quantity']=$row[csf("job_quantity")];
		$po_ex_rate_arr[$row[csf("id")]]['exchange_rate']=$row[csf("exchange_rate")];
	}
	if($all_po_id=="") 
	{ 
		echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
	}
	//	echo $all_job_id;die;
	$jobIds=chop($all_job_id,',');
	//echo $jobIds;die;
	$job_cond_for_in=""; $jobIdCond="";
	$job_ids=count(array_unique(explode(",",$all_job_id)));
	if($db_type==2 && $job_ids>1000)
	{
		$job_cond_for_in=" and (";
		$jobIdCond=" and (";
		$jobIdsArr=array_chunk(explode(",",$jobIds),999);
		foreach($jobIdsArr as $ids)
		{
			$ids=implode(",",$ids);
			$job_cond_for_in.=" a.job_id in($ids) or"; 
			$jobIdCond.=" a.job_no_id in($ids) or"; 
		}
		$job_cond_for_in=chop($job_cond_for_in,'or ');
		$job_cond_for_in.=")";
		$jobIdCond=chop($jobIdCond,'or ');
		$jobIdCond.=")";
	}
	else
	{
		$jobIds=implode(",",array_unique(explode(",",$all_job_id)));
		$job_cond_for_in=" and a.job_id in($jobIds)";
		$jobIdCond=" and a.job_no_id in($jobIds)";
	}
	//echo $job_cond_for_in;die;
	
	$poIds=chop($all_po_id,','); $po_cond_for_in=""; $po_cond_for_in2="";$po_cond_for_in3=""; $po_cond_for_in4=""; $po_cond_for_in5="";$po_cond_for_in6=""; 
	$po_ids=count(array_unique(explode(",",$all_po_id)));
	if($db_type==2 && $po_ids>1000)
	{
		$po_cond_for_in=" and (";
		$po_cond_for_in2=" and (";
		$po_cond_for_in3=" and (";
		$po_cond_for_in4=" and (";
		$po_cond_for_in5=" and (";
		$po_cond_for_in6=" and (";
		$poIdsArr=array_chunk(explode(",",$poIds),999);
		foreach($poIdsArr as $ids)
		{
			$ids=implode(",",$ids);
			$po_cond_for_in.=" b.po_break_down_id in($ids) or"; 
			$po_cond_for_in2.=" po_id in($ids) or"; 
			$po_cond_for_in3.=" b.order_id in($ids) or";
			$po_cond_for_in4.=" b.po_breakdown_id in($ids) or"; 
			$po_cond_for_in5.=" b.po_id in($ids) or"; 
			$po_cond_for_in6.=" b.order_id in($ids) or"; 
		}
		$po_cond_for_in=chop($po_cond_for_in,'or ');
		$po_cond_for_in.=")";
		
		$po_cond_for_in2=chop($po_cond_for_in2,'or ');
		$po_cond_for_in2.=")";
		$po_cond_for_in3=chop($po_cond_for_in3,'or ');
		$po_cond_for_in3.=")";
		$po_cond_for_in4=chop($po_cond_for_in4,'or ');
		$po_cond_for_in4.=")";
		$po_cond_for_in5=chop($po_cond_for_in5,'or ');
		$po_cond_for_in5.=")";
		$po_cond_for_in6=chop($po_cond_for_in6,'or ');
		$po_cond_for_in6.=")";
	}
	else
	{
		$poIds=implode(",",array_unique(explode(",",$all_po_id)));
		$po_cond_for_in=" and b.po_break_down_id in($poIds)";
		$po_cond_for_in2=" and po_id in($poIds)";
		$po_cond_for_in3=" and b.order_id in($poIds)";
		$po_cond_for_in4=" and b.po_breakdown_id in($poIds)";
		$po_cond_for_in5=" and b.po_id in($poIds)";
		$po_cond_for_in6=" and b.order_id in($poIds)";
	}
		
	if($poIds!='' || $poIds!=0) $po_cond_for_in=$po_cond_for_in; 
	else $po_cond_for_in="and b.po_break_down_id in(0)";
	
	$ex_factory_arr=return_library_array( "select b.po_break_down_id, 
	sum(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as qnty 
	from pro_ex_factory_mst b where b.status_active=1 and b.is_deleted=0 $po_cond_for_in group by b.po_break_down_id", "po_break_down_id", "qnty");	
	$dealing_library=return_library_array( "select id, team_member_name from lib_mkt_team_member_info", "id", "team_member_name");
	$leader_library=return_library_array( "select id, team_leader_name from lib_marketing_team", "id", "team_leader_name");
 
	ob_start();
	$width=1710;
	?>
    <fieldset style="width:<? echo $width;?>px">
    	<table width="<? echo $width;?>">
            <tr class="form_caption">
                <td colspan="18" align="center"><strong>Post Costing Report V3</strong></td>
            </tr>
            <tr class="form_caption">
                <td colspan="18" align="center"><strong><? echo $company_arr[$company_name];?></strong>
                    <br>
                    <strong><? echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to)); ?></strong>
                </td>
            </tr>
        </table>
        <table style="margin-top:10px" id="table_header_1" class="rpt_table" width="<? echo $width;?>" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="70">Buyer</th>
               
                <th width="70">Job No</th>
                <th width="110">Style Ref. No</th>
                <th width="100">PO No</th>
               
                <th width="80">Ref. No</th>
              
                <th width="70">Job Qty</th>
                <th width="120">Garments Item</th>
                <th width="90">PO Quantity</th>
                <th width="90">Ship Qty</th>
                <th width="100">Team Leader</th>
                <th width="100">Dealing Marchants</th>
                <th width="70">Unit Price</th>
                <th width="110">PO Value</th>
                <th width="100">Ship Value</th>
                <th width="80">Shipment Date</th>
                <th width="100">Shipping Status</th>
                
                <th width="100">Short/Excess Qty</th>
                <th width="">Short/Excess Value</th>
              
            </thead>
        </table>
    	<div style="width:<? echo $width+20;?>px; max-height:400px; overflow-y:scroll" id="scroll_body">
            <table class="rpt_table" width="<? echo $width;?>" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body">
            <?
			$process_costing=return_field_value("process_costing_maintain", "variable_settings_production", "company_name=$company_name and variable_list=34 and is_deleted=0 and status_active=1");
		//	echo $process_costing.'ddd';die;
			
			$usd_id=2;
			$fabriccostArray=array(); $yarncostArray=array(); $trimsCostArray=array(); $prodcostArray=array(); $actualCostArray=array(); $actualTrimsCostArray=array(); 
			$subconCostArray=array(); $embellCostArray=array(); $washCostArray=array(); $aopCostArray=array(); $yarnTrimsCostArray=array(); 
			$yarncostDataArray=sql_select("select a.job_no, sum(a.amount) as amnt, sum(a.rate*a.avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in group by a.job_no");
			//echo "select a.job_no, sum(a.amount) as amnt, sum(a.rate*a.avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in group by a.job_no";die;
			foreach($yarncostDataArray as $yarnRow)
			{
			   $yarncostArray[$yarnRow[csf('job_no')]]=$yarnRow[csf('amount')];
			}
			unset($yarncostDataArray);
			$fabriccostDataArray=sql_select("select a.job_no, a.costing_per_id, a.embel_cost, a.wash_cost, a.cm_cost, a.commission, a.currier_pre_cost, a.lab_test, a.inspection, a.freight, a.comm_cost from wo_pre_cost_dtls a where a.status_active=1 and a.is_deleted=0 $job_cond_for_in");
			foreach($fabriccostDataArray as $fabRow)
			{
				 $fabriccostArray[$fabRow[csf('job_no')]]['costing_per_id']=$fabRow[csf('costing_per_id')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['embel_cost']=$fabRow[csf('embel_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['wash_cost']=$fabRow[csf('wash_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['cm_cost']=$fabRow[csf('cm_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['commission']=$fabRow[csf('commission')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['currier_pre_cost']=$fabRow[csf('currier_pre_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['lab_test']=$fabRow[csf('lab_test')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['inspection']=$fabRow[csf('inspection')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['freight']=$fabRow[csf('freight')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['comm_cost']=$fabRow[csf('comm_cost')];
			}
			unset($fabriccostDataArray);
			$prodcostDataArray="select a.body_part_id,a.lib_yarn_count_deter_id as deter_id,b.po_break_down_id as po_id,
								  avg(CASE WHEN c.cons_process=1 THEN c.charge_unit END) AS knit_charge,
								  avg(CASE WHEN c.cons_process=30 THEN c.charge_unit END) AS yarn_dye_charge,
								  avg(CASE WHEN c.cons_process=35 THEN c.charge_unit END) AS aop_charge,
								  avg(CASE WHEN c.cons_process not in(1,2,30,35,134) THEN c.charge_unit END) AS dye_finish_charge
								  from wo_pre_cost_fabric_cost_dtls a,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cos_fab_co_avg_con_dtls b where a.id=c.fabric_description and a.job_no=c.job_no and b.pre_cost_fabric_cost_dtls_id=a.id and b.job_no=c.job_no and c.status_active=1 and c.is_deleted=0  $po_cond_for_in group by  a.lib_yarn_count_deter_id,b.po_break_down_id,a.body_part_id";
			$resultfab_arr = sql_select($prodcostDataArray);
			foreach($resultfab_arr as $prodRow)
			{
				//echo $prodRow[csf('knit_charge')].',';
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['knit_charge']=$prodRow[csf('knit_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['yarn_dye_charge']=$prodRow[csf('yarn_dye_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['aop_charge']=$prodRow[csf('aop_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['dye_finish_charge']=$prodRow[csf('dye_finish_charge')];
			}	
			unset($resultfab_arr);
			//order_wise_pro_details
			//$finProd_grey_usedArr=return_library_array( "select b.po_breakdown_id, sum(b.grey_used_qty) as grey_used_qty from order_wise_pro_details b where  b.entry_form=7 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 group by b.po_breakdown_id", "po_breakdown_id", "grey_used_qty");
			if($poIds!='' || $poIds!=0)
			{
				$po_cond_for_in4=$po_cond_for_in4; 
			}
			else
			{
				$po_cond_for_in4="and b.po_breakdown_id in(0)";
			}

			$dye_fin_sql="select a.bill_date,b.delivery_qty,b.rate,b.amount,b.currency_id,b.order_id,a.discount from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls    b where  a.id=b.mst_id $po_cond_for_in6 and a.process_id=4 group by a.bill_date,b.delivery_qty,b.rate,b.amount,b.currency_id,b.order_id,a.discount";
			$dye_fin_data =sql_select($dye_fin_sql );
			foreach($dye_fin_data as $row)
			{
				$currency_id=$row[csf('currency_id')];
				$bill_date=$row[csf('bill_date')];
				$conversion_date=change_date_format($bill_date, "d-M-y", "-",1);
				$currency_rate=set_conversion_rate($usd_id,$conversion_date,$company_id );
				if($currency_id==2) //Usd
				{
					if($row[csf('discount')]>0){
						$usd_amount=$row[csf('delivery_qty')]*$row[csf('rate')]-$row[csf('discount')];
					}else{
						$usd_amount=$row[csf('delivery_qty')]*$row[csf('rate')];
					}
				}
				else{
					if($row[csf('discount')]>0){
						$usd_amount=($row[csf('delivery_qty')]*$row[csf('rate')]-$row[csf('discount')])/$currency_rate;
					}else{
						$usd_amount=($row[csf('delivery_qty')]*$row[csf('rate')])/$currency_rate;
					}
				}
				$grey_used_arr[$row[csf('order_id')]]['grey_used_amt']+=$usd_amount;
			}
			unset($dye_fin_data);
			if($jobIds!='' || $jobIds!=0)
			{
				$job_cond_for_in=$job_cond_for_in; 
				$jobIdCond=$jobIdCond;
			}
			else
			{
				$job_cond_for_in="and a.job_no in('0')";
				$jobIdCond="and a.job_no in('0')";
			}
			$all_job_IdArr=array_unique(explode(",",$all_job_id));
			$jobId_cond_for_in=where_con_using_array($all_job_IdArr,0,"a.job_no_id"); 
			
			$yarn_dyeing_costArray=array(); //product_id
			  $yarndyeing_sql="select b.booking_date,b.id,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 $jobId_cond_for_in group by b.id,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";
			$yarndyeing_result = sql_select($yarndyeing_sql);
			foreach($yarndyeing_result as $yarnRow)
			{
				$yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['job']=$yarnRow[csf('job_no')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['ydw_no']=$yarnRow[csf('ydw_no')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['booking_date']=$yarnRow[csf('booking_date')];
				$yarn_dyeing_curr_arr[$yarnRow[csf('ydw_no')]]['currency']=$yarnRow[csf('currency')];
				$yarn_dyeing_rate_arr[$yarnRow[csf('job_no')]][$yarnRow[csf('yarn_color')]]['rate']=$yarnRow[csf('dyeing_charge')];
				
				$yarn_dyeing_mst_idArr[$yarnRow[csf('id')]]=$yarnRow[csf('id')];
			}
			//print_r($yarn_dyeing_curr_arr);
			unset($resultyarnIssueData);	
				
			$yarnIssueData="select b.prod_id,sum(a.cons_amount) as cons_amount,sum(a.cons_quantity) as cons_quantity
				from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and b.entry_form ='3' and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)  $po_cond_for_in4  group by  b.prod_id";
			$resultyarnIssueData = sql_select($yarnIssueData);
			$all_prod_ids="";
			foreach($resultyarnIssueData as $row)
			{
				if($all_prod_ids=="") $all_prod_ids=$row[csf('prod_id')];else $all_prod_ids.=",".$row[csf('prod_id')];
				
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt']+=$row[csf('cons_amount')];
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty']+=$row[csf('cons_quantity')];
			}
			unset($resultyarnIssueData);
			//echo $all_prod_ids;
			//print_r($yarn_issue_amt_arr);
			$prodIds=chop($all_prod_ids,',');
			$prod_cond_for_in="";
			$prod_ids=count(array_unique(explode(",",$all_prod_ids)));
			if($db_type==2 && $prod_ids>1000)
			{
				$prod_cond_for_in=" and (";
				$prodIdsArr=array_chunk(explode(",",$prodIds),999);
				foreach($prodIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					$prod_cond_for_in.=" a.prod_id in($ids) or"; 
				}
				$prod_cond_for_in=chop($prod_cond_for_in,'or ');
				$prod_cond_for_in.=")";
			}
			else
			{
				$prodIds=implode(",",array_unique(explode(",",$all_prod_ids)));
				$prod_cond_for_in=" and a.prod_id in($prodIds)";
			}
			
			if($prodIds!='' || $prodIds!=0)
			{
				$prod_cond_for_in=$prod_cond_for_in;
			}
			else
			{
				$prod_cond_for_in="and a.prod_id in(0)";
			}
					
			 $sql_receive_for_issue="select c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.exchange_rate,c.currency_id,c.receive_purpose,b.lot,b.color, 
			 sum(a.order_qnty) as qty, sum(a.order_amount) as amnt,
			 sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv
			  from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $prod_cond_for_in  group by c.booking_id,a.job_no,a.prod_id,c.currency_id,c.exchange_rate,c.receive_purpose,b.lot,b.color"; 
			$resultReceive_chek = sql_select($sql_receive_for_issue);
			
			foreach($resultReceive_chek as $row)
			{
				$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose']=$row[csf('receive_purpose')];
				$receive_date_array[$row[csf('prod_id')]]['last_exchange_rate']=$row[csf('exchange_rate')];
				$avg_rate=$row[csf('amnt')]/$row[csf('qty')];
				$receive_array[$row[csf('prod_id')]]=$avg_rate;
				if($row[csf('prod_id')]!="")
				{
					$prod_id_arr[$row[csf('prod_id')]]=$row[csf('prod_id')];
				}
			}
			//print_r($prod_id_arr);die;
			unset($resultReceive_chek);
			
			//$jobIdArr=array_unique(explode(",",$all_job_id));
			//print_r($yarn_dyeing_mst_idArr);die;
			if($yarn_dyeing_mst_idArr)
			{
				$YdId_cond_for_in=where_con_using_array($yarn_dyeing_mst_idArr,0,"c.booking_id"); 
			}
			else $YdId_cond_for_in="and c.booking_id=0";
			
			
			//$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit");
			 
			//$receive_array=array();//$job_cond_for_in  $prod_cond_for_in
			 $sql_receive="select c.recv_number,c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.exchange_rate,c.receive_purpose,b.lot,b.color,c.currency_id,
			 sum(a.order_qnty) as qty, sum(a.order_amount) as amnt,
			 sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv,
			  sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.cons_quantity ELSE 0 END) AS cons_quantity
			  from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id  and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1  $YdId_cond_for_in  and a.is_deleted=0    group by c.recv_number,c.booking_id,a.job_no,a.prod_id,c.currency_id,c.exchange_rate,c.receive_purpose,b.lot,b.color";
			$resultReceive = sql_select($sql_receive);$all_recv_prod_ids="";
			foreach($resultReceive as $invRow)
			{
				if($all_recv_prod_ids=="") $all_recv_prod_ids=$invRow[csf('prod_id')];else $all_recv_prod_ids.=",".$invRow[csf('prod_id')];
				$receive_curr_array[$invRow[csf('prod_id')]]=$invRow[csf('currency_id')];
				$jobNo=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['job'];
				$ydw_no=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['ydw_no'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				//echo $jobNo.'=='.$invRow[csf('booking_id')].'b';
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['job']=$jobNo;
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['ydw_no']=$ydw_no;
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$dye_rate=$yarn_dyeing_rate_arr[$jobNo][$invRow[csf('color')]]['rate'];
					//echo $ydw_no.'d'.$dye_rate;
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				//$po_quantity=$job_arr2[$jobNo]['po_quantity'];
				$order_amount_recv=$invRow[csf('order_amount_recv')];
				$cons_quantity=$invRow[csf('cons_quantity')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rate;
				$currency_rateArr[$invRow[csf('prod_id')]]=$exchange_rate;
			
				if($currency==1) $avg_rate=$dye_rate/$currency_rate;//Taka
				else $avg_rate=$dye_rate;	
				//echo $is_short.'='.$avg_rate.'='.$cons_quantity.', ';
				if($is_short==2) $yarn_receive_amount_arr[$jobNo]['order_amount_recv']+=$avg_rate*$cons_quantity;//Main Booking..
				else $yarn_receive_amount_arr[$jobNo]['cpa_order_amount_recv']+=$avg_rate*$cons_quantity;	
			}
		//	print_r($yarn_receive_amount_arr);
			//echo $all_recv_prod_ids;
			unset($resultReceive);
			 
			if($all_recv_prod_ids!="")
			{
				$recvprodIds=chop($all_recv_prod_ids,',');
				$recv_prod_cond_for_in="";
				$recv_prod_ids=count(array_unique(explode(",",$all_recv_prod_ids)));
				if($db_type==2 && $recv_prod_ids>1000)
				{
					$recv_prod_cond_for_in=" and (";
					$recvprodIdsArr=array_chunk(explode(",",$recvprodIds),999);
					foreach($recvprodIdsArr as $ids)
					{
						$ids=implode(",",$ids);
						$recv_prod_cond_for_in.=" a.prod_id in($ids) or"; 
					}
					$recv_prod_cond_for_in=chop($recv_prod_cond_for_in,'or ');
					$recv_prod_cond_for_in.=")";
				}
				else
				{
					$recprodIds=implode(",",array_unique(explode(",",$all_recv_prod_ids)));
					$recv_prod_cond_for_in=" and a.prod_id in($recprodIds)";
				}
			}
			//echo $recv_prod_cond_for_in;
			 $sql_receive_ret="select a.prod_id,b.lot,b.color,c.received_mrr_no,
			 sum(a.cons_quantity) as cons_quantity
			  from inv_transaction a,product_details_master b,inv_issue_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=8 and c.item_category=1 and a.transaction_type=3 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $recv_prod_cond_for_in  group by a.prod_id,b.lot,b.color,c.received_mrr_no";
			$resultReceive_ret = sql_select($sql_receive_ret);
			
			foreach($resultReceive_ret as $row)
			{
				$ydw_no=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['ydw_no'];
				$recv_job=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['job'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$ydye_rate=$yarn_dyeing_rate_arr[$jobNo][$row[csf('color')]]['rate'];
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				//echo $recv_job.'d'.$currency;
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$currency_rateArr[$row[csf('prod_id')]];
				if($currency==1) $avg_rate=$ydye_rate/$currency_rate;//Taka
				else $avg_rate=$ydye_rate;	
				
				$ret_amt=$row[csf('cons_quantity')]*$avg_rate;
				//$receive_ret_arr[$row[csf('prod_id')]]['last_trans_date']=$row[csf('cons_quantity')];
				if($is_short==2) $receive_ret_arr[$recv_job]['recv_ret_amt']+=$ret_amt; //Main Booking
				else $receive_ret_arr[$recv_job]['cpa_recv_ret_amt']+=$ret_amt;
			}
			unset($resultReceive_ret);
			//print_r($receive_ret_arr);
			//booking_type,is_short
			if($poIds!='' || $poIds!=0) $po_cond_for_in=$po_cond_for_in; 
			else $po_cond_for_in="and b.po_break_down_id in(0)";
			
			$sql_wo_aop="select a.id,a.booking_date,a.currency_id,a.exchange_rate,a.item_category,a.booking_no,a.booking_type,a.is_short,b.po_break_down_id as po_id,
			(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.wo_qnty ELSE 0 END) AS wo_qnty,
			(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.amount ELSE 0 END) AS amount
			 from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no  and a.item_category in(2,3,12) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in";
			$result_aop_rate=sql_select( $sql_wo_aop );
			foreach ($result_aop_rate as $row)
			{
				if($row[csf('item_category')]==12)
				{
					$wo_qnty=$row[csf('wo_qnty')];
					$amount=$row[csf('amount')];
					$avg_wo_aop_rate=$amount/$wo_qnty;
					$aop_prod_array[$row[csf('po_id')]]['aop_rate']=$avg_wo_aop_rate;
					$aop_prod_array[$row[csf('po_id')]]['currency_id']=$row[csf('currency_id')];
					$aop_prod_array[$row[csf('po_id')]]['booking_date']=$row[csf('booking_date')];
					$aop_prod_array[$row[csf('po_id')]]['exchange_rate']=$row[csf('exchange_rate')];

				}
				else
				{
					$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
					$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
					$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
					$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
				}
				
				$aop_rate=$aop_prod_array[$row[csf('po_id')]]['aop_rate'];
				$booking_date=$aop_prod_array[$row[csf('po_id')]]['booking_date'];
				$exchange_rate=$aop_prod_array[$row[csf('po_id')]]['exchange_rate'];
				$currency_id=$aop_prod_array[$row[csf('po_id')]]['currency_id'];
				$booking_date=$booking_date;
				$conversion_date=change_date_format($booking_date, "d-M-y", "-",1);
				$exchange_rate=$exchange_rate;
				if($currency_id==1) $avg_rate=$aop_rate/$exchange_rate;//TK
				else $avg_rate=$aop_rate;
					
				$aop_amt=$row[csf('wo_qnty')]*$avg_rate;
				$aop_prod_array[$row[csf('po_id')]]['aop_amt']+=$aop_amt;

			}
			/* echo '<pre>';print_r($aop_prod_array); */
			unset($result_aop_rate);
			if($poIds!='' || $poIds!=0) $po_cond_for_in3=$po_cond_for_in3; else $po_cond_for_in3="and b.order_id in(0)";
			
			$sql_aop="select a.company_id, b.batch_issue_qty as issue_qty,b.prod_id,b.order_id as po_id from pro_grey_batch_dtls b,inv_receive_mas_batchroll a where a.id=b.mst_id  and a.entry_form=92  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and b.process_id=35 $po_cond_for_in3";
			
			$result_aop=sql_select( $sql_aop );
			foreach ($result_aop as $row)
			{
				$aop_rate=$aop_prod_array[$row[csf('po_id')]]['aop_rate'];
				$booking_date=$aop_prod_array[$row[csf('po_id')]]['booking_date'];
				$exchange_rate=$aop_prod_array[$row[csf('po_id')]]['exchange_rate'];
				$currency_id=$aop_prod_array[$row[csf('po_id')]]['currency_id'];
				$booking_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($booking_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($booking_date, "d-M-y", "-",1);
				
				//$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
				$exchange_rate=$exchange_rate;
				if($currency_id==1) $avg_rate=$aop_rate/$exchange_rate;//TK
				else $avg_rate=$aop_rate;
					
				//$aop_amt=$row[csf('issue_qty')]*$avg_rate;
				//$aop_prod_array[$row[csf('po_id')]]['aop_amt']+=$aop_amt;
			}
			//print_r($aop_prod_array);
			unset($result_aop);
			$sql_yarn="select c.id,a.requisition_no,a.receive_basis,a.prod_id,(a.cons_amount) as cons_amount,c.issue_basis,c.issue_number,c.booking_no from inv_transaction a, order_wise_pro_details b, inv_issue_master c where  a.id=b.trans_id and  c.id=a.mst_id and c.entry_form in(3) and b.entry_form in(3)  and  a.transaction_type=2 $po_cond_for_in4";
			$result_yarn=sql_select($sql_yarn);
			foreach($result_yarn as $invRow)
			{
				if($invRow[csf('issue_basis')]==1)// Booking
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('booking_no')];
				}
				else if($invRow[csf('issue_basis')]==3)// Requesition
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('requisition_no')];
				}
			}
			
			unset($result_yarn);
				//die;
			if($poIds!='' || $poIds!=0) $po_cond_for_in2=$po_cond_for_in2; 
			else $po_cond_for_in2="and po_id in(0)";
			
			$plan_details_array = return_library_array("select dtls_id, booking_no as booking_no from ppl_planning_entry_plan_dtls where company_id=$company_name $po_cond_for_in2 group by dtls_id,booking_no", "dtls_id", "booking_no");
			//print_r($plan_details_array);
			$reqs_array = array();
			
			$reqs_sql = sql_select("select a.knit_id, a.requisition_no as reqs_no, sum(a.yarn_qnty) as yarn_req_qnty from ppl_planning_entry_plan_dtls b,ppl_yarn_requisition_entry a where b.dtls_id=a.knit_id and b.status_active=1 and b.is_deleted=0 $po_cond_for_in5 group by a.knit_id, a.requisition_no");
			foreach ($reqs_sql as $row)
			{
				$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
			}
			unset($reqs_sql);
			//and b.issue_purpose in(2,4,15,38)
		    $yarnissue_retData="select d.booking_no,a.item_category,b.po_breakdown_id, b.prod_id, a.mst_id,a.receive_basis, b.issue_purpose,c.lot,c.color,d.exchange_rate,
			(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.transaction_date ELSE null END) AS transaction_date,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN b.quantity ELSE 0 END) AS yarn_iss_return_qty,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_amount ELSE 0 END) AS order_amount_ret,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_qnty ELSE 0 END) AS order_qnty_ret
			from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_receive_master d where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id  and d.id=a.mst_id and a.item_category in(1) and a.transaction_type in(4) and b.entry_form in(9) and d.entry_form in(9) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1  $po_cond_for_in4  group by d.booking_no,b.po_breakdown_id, b.prod_id, a.item_category,a.transaction_date,a.receive_basis,a.mst_id,a.transaction_type,b.entry_form,d.exchange_rate,b.trans_type,b.issue_purpose,c.lot,c.color";
			$yarnissueretDataArray=sql_select($yarnissue_retData); $yarnissueRetCostArray=array();
			foreach($yarnissueretDataArray as $invRow)
			{
				$prod_idArr[$invRow[csf('prod_id')]]=$invRow[csf('prod_id')];
			}
			$Prod_cond_for_in=where_con_using_array($prod_idArr,0,"id"); 
			$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1 $Prod_cond_for_in", "id", "avg_rate_per_unit");
			
			foreach($yarnissueretDataArray as $invRow)
			{
				$issue_purpose=$invRow[csf('issue_purpose')];
				$receive_basis=$invRow[csf('receive_basis')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				//echo $receive_basis.'ff';
				if($receive_basis==1) //Booking Basis
				{
					$booking_no=$invRow[csf('booking_no')];
				}
				
				else if($receive_basis==3) //Requisition Basis
				{
					$booking_req_no=$invRow[csf('booking_no')];
					$prog_no=$reqs_array[$booking_req_no]['knit_id'];
					$booking_no=$plan_details_array[$prog_no];
					//echo $booking_req_no.'req';
				}
				$booking_type=$booking_array[$booking_no]['btype'];
				$is_short=$booking_array[$booking_no]['is_short'];
				//echo $booking_type.'='.$is_short.'='.$booking_no.'<br>';
				$returnable_ret_qnty=$invRow[csf('returnable_qnty')];
				//echo $invRow[csf('yarn_iss_return_qty')].'<br>';
				 $issue_ret_qty=$invRow[csf('yarn_iss_return_qty')];
				  $order_qnty_ret=$invRow[csf('order_qnty_ret')];
				  $order_amount_ret=$invRow[csf('order_amount_ret')];
				 $avg_rate=$order_amount_ret/$order_qnty_ret;
				//echo $avg_rate.'<br>';
				//$rate='';
				$transaction_date=$invRow[csf('transaction_date')];
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rate;
				//echo $ret_avg_rate= $avg_rate/$conversion_date;
				$currency_id=$receive_curr_array[$invRow[csf('prod_id')]];
				//echo $currency_id.'dddddd';
				if($receive_array[$invRow[csf('prod_id')]]>0)
				{
					//echo $currency_id.'D';
					if($currency_id==1) $rate=$receive_array[$invRow[csf('prod_id')]]/$currency_rate;//Taka
					else $rate=$receive_array[$invRow[csf('prod_id')]];	
				}
				else $rate=$avg_rate_array[$invRow[csf('prod_id')]]/$currency_rate;
				
				$iss_ret_amnt=$issue_ret_qty*$rate;
				$retble_iss_ret_amnt=$returnable_ret_qnty*$rate;
				if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
				{
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) //Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else if($issue_purpose==2) //Yarn Dyeing
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
				}
				else //Short Fabric Booking
				{
					//echo $booking_type.'d';
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) // Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							//echo $iss_amnt.'cpa';
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else  if($issue_purpose==2)
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}	
				}
			}
			unset($yarnissueretDataArray);
				 
			$yarnTrimsData="select a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color
					from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)  $po_cond_for_in4 ";
				
			$yarnTrimsDataArray=sql_select($yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
			$tot_yQty=0;
			foreach($yarnTrimsDataArray as $invRow)
			{
				if($invRow[csf('item_category')]==1)
				{
					$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
					$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
					$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['last_exchange_rate'];
					
					if($invRow[csf('receive_basis')]==1)//Booking Basis
					{
						$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
						{
							$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
							$booking_type=1;
							//echo $is_short.'= '.$booking_type.', ';
						}
						else
						{
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
					}
					else if($invRow[csf('receive_basis')]==3) //Requisition Basis
					{
						$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						
						$prog_no=$reqs_array[$booking_req_no]['knit_id'];
						$booking_no=$plan_details_array[$prog_no];
						//echo $booking_no.'='.$prog_no.',';
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
					}
					$transaction_date='';
					$transaction_date=$last_trans_date;
					if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					
					//$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
					$exchange_rate=$last_exchange_rate;
					$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
					$avgrate=$issue_rate/$exchange_rate;
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($invRow[csf('entry_form')]==3 && ($recv_purpose==16 || $recv_purpose==5))//recv_purpose==16=Grey Yarn && 5==Loan 
					{
						if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
							{
								//echo $invRow[csf('mst_id')].'='.$recv_purpose.'='.$is_short.'='.$invRow[csf('quantity')].'-k<br>';
								$iss_amnt=$invRow[csf('quantity')]*$avgrate;
								//echo $iss_amnt.'m';
								$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['yq']+=$invRow[csf('quantity')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_qty_retble']+=$invRow[csf('returnable_qnty')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt_retble']+=$retble_iss_amnt;
								$tot_yQty+=$invRow[csf('quantity')];
							}
						}
						else //Short Fabric Booking
						{
							$iss_amnt=$invRow[csf('quantity')]*$avgrate;
							//echo $is_short.'='.$iss_amnt.'='.$invRow[csf('mst_id')].'<br>';
							$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
							
							if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
							{
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_qty_retble']+=$returnable_qnty;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt_retble']+=$retble_iss_amnt;
								$tot_yQty+=$invRow[csf('quantity')];
							}
						}
					}
				}
				else
				{
					$trimsAmt=0;
					$trimsAmt=$invRow[csf('quantity')]*$invRow[csf('cons_rate')];
					$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]][4]+=$trimsAmt;
				}
			}
			//echo $tot_yQty;die;
			unset($yarnTrimsDataArray);
					
			$sql_garments="select b.po_break_down_id as po_id,b.embel_name,b.production_date,b.production_type,
				(CASE WHEN b.embel_name=1 THEN b.production_quantity ELSE 0 END) AS printing_qty,
				(CASE WHEN b.embel_name=2 THEN b.production_quantity ELSE 0 END) AS embro_qty,
				(CASE WHEN b.embel_name=3 THEN b.production_quantity ELSE 0 END) AS wash_qty,
				(CASE WHEN b.embel_name=5 THEN b.production_quantity ELSE 0 END) AS dyeing_qty
				 from pro_garments_production_mst b where  b.production_type=2    and b.is_deleted=0 and b.status_active=1 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in";
				$result_gar=sql_select( $sql_garments );
				foreach ($result_gar as $row)
				{
					$embl_issue_prod_array[$row[csf('po_id')]]['printing_qty']+=$row[csf('printing_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['embro_qty']+=$row[csf('embro_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['wash_qty']+=$row[csf('wash_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['dyeing_qty']+=$row[csf('dyeing_qty')];
				}
				unset($result_gar);
			
				//print_r($yarnTrimsCostArray);
				$recvIssue_array=array(); 
				$sql_trans="select b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(80,82,81,83,84,13,94) and a.item_category=13 and a.transaction_type in(5,6) and b.trans_type in(5,6) $po_cond_for_in4 group by b.trans_type, b.po_breakdown_id";
				$result_trans=sql_select( $sql_trans );
				foreach ($result_trans as $row)
				{
					$recvIssue_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_trans);
				
				
				$trims_trans_array=array(); 
				
				$sql_trims_inv="select a.transaction_date,a.prod_id, a.cons_amount as cons_amount, b.po_breakdown_id as po_id, b.quantity as qnty, c.currency_id,c.exchange_rate from inv_transaction a, order_wise_pro_details b, inv_receive_master c  where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.entry_form in(24) and a.item_category=4 and a.transaction_type in(1) and b.trans_type in(1) $po_cond_for_in4";
				$result_trims=sql_select( $sql_trims_inv );
				foreach ($result_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					$currency_id=$row[csf('currency_id')];
					$exchange_rateArr[$row[csf('prod_id')]]=$row[csf('exchange_rate')];
					$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					$currency_rate=$row[csf('exchange_rate')];
					$amt=0;
					
					$amt=$row[csf('cons_amount')]/$currency_rate;
					$trims_trans_array[$row[csf('po_id')]]['amt']+=$amt;
				}
				unset($result_trims);
				$gen_trims_issue_array=array(); 
				$sql_gen_trims_inv="select a.prod_id, (b.quantity) as cons_quantity,(b.amount) as cons_amount, a.cons_uom, a.cons_rate,a.transaction_date,b.po_breakdown_id from inv_transaction a,order_wise_general_details b where a.id=b.trans_id  $po_cond_for_in4 and a.status_active = 1 and a.is_deleted = 0 and b.status_active = 1 and b.is_deleted = 0 ";
				$result_gen_trims=sql_select( $sql_gen_trims_inv );
				foreach ($result_gen_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
					$currency_rate=$exchange_rateArr[$row[csf('prod_id')]];

					$gen_trims_issue_array[$row[csf('po_breakdown_id')]]['amt']+=$row[csf('cons_amount')];
				}
				//echo $exchange_rate;
				unset($result_gen_trims);
				 //-----ss
				//die;
				unset($result_trims);
				$fin_fab_trans_array=array(); 
				 $sql_fin_trans="select b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty
				  from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15,14) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) $po_cond_for_in4 group by b.trans_type, b.po_breakdown_id";
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
					$fin_fab_trans_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_fin_trans);
				
				if($poIds!='' || $poIds!=0)
				{
					$po_cond_for_in5=$po_cond_for_in5; 
				}
				else
				{
					$po_cond_for_in5="and b.po_id in(0)";
				}
				$batch_trans_array=array(); 
				$sql_batch="select a.id,a.booking_no,batch_weight as batch_weight
				  from  pro_batch_create_mst a,pro_batch_create_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in5 group by a.id,batch_weight,a.booking_no";
				$result_batch=sql_select( $sql_batch );
				foreach ($result_batch as $row)
				{
					$batch_trans_array[$row[csf('id')]]['book']=$row[csf('booking_no')];
					$batch_weight_array[$row[csf('id')]]['batch_weight']=$row[csf('batch_weight')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_batch);
				
				$dye_fin_fab_array=array(); 
				 $sql_fin_trans="select a.receive_date,a.exchange_rate, b.po_breakdown_id,c.mst_id,c.batch_id,c.body_part_id, sum(b.quantity) as finish_qnty
				  from inv_receive_master a,pro_finish_fabric_rcv_dtls c, order_wise_pro_details b where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(7) and a.item_category=2   and b.trans_type in(1) $po_cond_for_in4 group by a.receive_date, b.po_breakdown_id,c.batch_id,c.mst_id,c.body_part_id";
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
						$receive_date=$row[csf('receive_date')];
						$booking_no=$batch_trans_array[$row[csf('batch_id')]]['book'];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
						$batch_weight=$batch_weight_array[$row[csf('batch_id')]]['batch_weight'];
						$dye_finish_charge=$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
						//echo $batch_weight.'kk';
						if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							
							$finish_qnty=$row[csf('finish_qnty')]*$dye_finish_charge;
						}
						else //short Fab. booking 
						{
							$cpa_batch_weight=$batch_weight*$dye_finish_charge;
						}
						//echo $finish_qnty.'='.$cpa_finish_qnty;
						if($db_type==0)
						{
							$conversion_date=change_date_format($receive_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($receive_date, "d-M-y", "-",1);
						}
						//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
						$currency_rate=$row[csf('exchange_rate')];
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['fin_amt']=$finish_qnty;
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['cpa_batch_weight']+=$cpa_batch_weight;
						$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['ex_rate']=$currency_rate;
				}
				unset($result_fin_trans);

				$knitting_cost_array=array();
				$knit_in_bill_sql="select a.bill_no,b.id as upd_id,b.challan_no,  b.process_id,b.rate, b.amount, b.order_id, b.currency_id ,b.add_rate,SUM(b.delivery_qty) as delivery_qty,a.bill_date,b.item_id from subcon_inbound_bill_mst a,subcon_inbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.status_active=1 and b.is_deleted=0 and a.process_id=2 $po_cond_for_in6 group by a.bill_no,b.id,  b.process_id,b.rate, b.amount, b.order_id, b.currency_id ,b.add_rate,a.bill_date,b.item_id,b.challan_no ";
				$knit_in_bill_data=sql_select( $knit_in_bill_sql );
				foreach ($knit_in_bill_data as $row)
				{
					$usd_id=2;
					$currency_id=$row[csf('currency_id')];
					$conversion_date=change_date_format($row[csf('bill_date')], "Y-m-d", "-",1);
					$currency_rate=set_conversion_rate($usd_id,$conversion_date,1 );
					if($currency_id==1) //TK
					{
						$kniting_charge=$row[csf('rate')]/$currency_rate;
						
					}
					else
					{
						$kniting_charge=$row[csf('rate')];
					}
					$knitting_cost_array[$row[csf('order_id')]]['qnty']+=$row[csf('delivery_qty')];
					$knitting_cost_array[$row[csf('order_id')]]['knit_amt']+=$row[csf('delivery_qty')]*$kniting_charge;
				}
				//echo '<pre>';print_r($kniting_charge);die;
				unset($knit_in_bill_data);
				
				$grey_fab_array=array();  //Knitting Cost actual 
				  $sql_grey_trans="select  a.id,a.receive_basis,a.exchange_rate,a.booking_no,a.receive_date,b.po_breakdown_id,c.febric_description_id as deter_id,c.body_part_id, c.kniting_charge,
				 (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
				
				  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(2,13)  and b.trans_type in(1) $po_cond_for_in4";
				$result_grey=sql_select( $sql_grey_trans );
				$currency_id=1;
				foreach ($result_grey as $row)
				{
						$transaction_date=$row[csf('transaction_date')];
						$receive_basis=$row[csf('receive_basis')];
						$exchange_rate=$row[csf('exchange_rate')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($row[csf('receive_date')], "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($row[csf('receive_date')], "d-M-y", "-",1);
						}
					//	$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
						$exchange_rate=$row[csf('exchange_rate')];
						if($currency_id==1) //TK
						{
							$knit_charge=$row[csf('kniting_charge')]/$exchange_rate;
							
						}
						else
						{
							$knit_charge=$row[csf('kniting_charge')];
						}
						
						//$knit_charge=$row[csf('kniting_charge')];//$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['knit_charge'];
						//echo $knit_charge.'='.$row[csf('deter_id')].'ff'.$row[csf('po_breakdown_id')];
						if($receive_basis==1) //Booking Basis
						{
							 $booking_no=$row[csf('booking_no')];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							//echo $booking_type.'='.$is_short;
						}
						else if($receive_basis==2) //Knit plan Basis
						{
							 $prog_no=$grey_knit_array[$row[csf('mst_id')]];
							$booking_no=$plan_details_array[$row[csf('booking_no')]];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						else if($receive_basis==4) //Salse Basis
						{
							 $prog_no=$row[csf('booking_no')];
							$booking_no=$plan_details_array[$prog_no];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							
						}
						
						if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							$grey_amt=$row[csf('grey_qnty')]*$knit_charge;
							//$finish_qnty=$row[csf('finish_qnty')];
							//echo $row[csf('grey_qnty')].'*'.$knit_charge.'<br>';
						}

						else //short Fab. booking 
						{
							$cpa_grey_amt=$row[csf('grey_qnty')]*$knit_charge;
							//$cpa_finish_qnty=$row[csf('finish_qnty')];
						}
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						$currency_rate=$exchange_rate;//set_conversion_rate($usd_id,$conversion_date );
					$grey_fab_array[$row[csf('po_breakdown_id')]]['qnty']+=$row[csf('grey_qnty')];
					$grey_fab_array[$row[csf('po_breakdown_id')]]['grey_amt']+=$grey_amt;
					$grey_fab_array[$row[csf('po_breakdown_id')]]['cpa_grey_amt']+=$cpa_grey_amt;
					
				}
				unset($result_grey);
				//print_r($grey_fab_array);
				$sql_fin_purchase="select a.currency_id,b.po_break_down_id, sum (b.fin_fab_qnty) as qty, sum (b.amount) as finish_purchase_amnt from wo_booking_dtls b,wo_booking_mst a where a.id=b.booking_mst_id and b.booking_type=1 and b.is_short=2 and b.status_active = 1 and b.is_deleted = 0 and a.status_active = 1 and b.is_deleted = 0 $po_cond_for_in group by a.currency_id,b.po_break_down_id";
				$dataArrayFinPurchase=sql_select($sql_fin_purchase);
				foreach($dataArrayFinPurchase as $finRow)
				{
					$po_ex_rate=$po_ex_rate_arr[$finRow[csf("po_break_down_id")]]['exchange_rate'];
					$currency_rate=$po_ex_rate;

					if($finRow[csf('currency_id')]==1){
						$finish_purchase_amnt_arr[$finRow[csf('po_break_down_id')]]=$finRow[csf('finish_purchase_amnt')]/$currency_rate;
					}else{
						$finish_purchase_amnt_arr[$finRow[csf('po_break_down_id')]]=$finRow[csf('finish_purchase_amnt')];
					}
					
				}
				unset($dataArrayFinPurchase);
				
				$sql_fin_purchase_wv="select b.po_breakdown_id, sum(a.cons_rate*b.quantity) as woven_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.item_category=3 and a.transaction_type=1 and b.entry_form=17 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $po_cond_for_in4 group by b.po_breakdown_id";
				$dataArrayFinPurchaseW=sql_select($sql_fin_purchase_wv);
				foreach($dataArrayFinPurchaseW as $finRow)
				{
						$po_ex_rate=$po_ex_rate_arr[$finRow[csf("po_breakdown_id")]]['exchange_rate'];
					$finish_purchase_amnt_arr[$finRow[csf('po_breakdown_id')]]+=$finRow[csf('woven_purchase_amnt')]/$po_ex_rate;
				}
				unset($dataArrayFinPurchaseW);
				$sql_grey_purchase="select b.po_breakdown_id,a.transaction_date, sum(a.cons_rate*b.quantity) as finish_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.receive_basis<>9 and a.item_category in(13,14) and a.transaction_type=1 and b.entry_form in(22,23) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $po_cond_for_in4 group by b.po_breakdown_id,a.transaction_date";
				$dataArraygreyPurchase=sql_select($sql_grey_purchase);
				foreach($dataArraygreyPurchase as $gRow)
				{
					$transaction_date=$gRow[csf('transaction_date')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						$po_ex_rate=$po_ex_rate_arr[$gRow[csf("po_breakdown_id")]]['exchange_rate'];
						$currency_rate=$po_ex_rate;//set_conversion_rate($usd_id,$conversion_date );
					$grey_purchase_amnt_arr[$gRow[csf('po_breakdown_id')]]=$gRow[csf('finish_purchase_amnt')]/$currency_rate;
				}
					unset($dataArraygreyPurchase);
				 $actualCostArray=array();
				$actualCostDataArray="select cost_head,po_id,sum(amount_usd) as amount_usd from wo_actual_cost_entry where company_id=$company_name and status_active=1 and is_deleted=0 $po_cond_for_in2 group by cost_head,po_id";
				$actual_results=sql_select($actualCostDataArray);
				foreach($actual_results as $actualRow)
				{
				   $actualCostArray[$actualRow[csf('cost_head')]][$actualRow[csf('po_id')]]=$actualRow[csf('amount_usd')];
				}
				unset($actual_results);
				
				$i=1; $tot_po_qnty=0; $tot_po_value=0; $tot_ex_factory_qnty=0; $tot_ex_factory_val=0; $tot_yarn_cost_mkt=0; $tot_knit_cost_mkt=0; $tot_dye_finish_cost_mkt=0; $tot_yarn_dye_cost_mkt=0; $tot_aop_cost_mkt=0; $tot_trims_cost_mkt=0; $tot_embell_cost_mkt=0; $tot_wash_cost_mkt=0; $tot_commission_cost_mkt=0; $tot_comm_cost_mkt=0; $tot_freight_cost_mkt=0; $tot_test_cost_mkt=0; $tot_inspection_cost_mkt=0; $tot_currier_cost_mkt=0; $tot_cm_cost_mkt=0; $tot_mkt_all_cost=0; $tot_mkt_margin=0; $tot_yarn_cost_actual=0; $tot_knit_cost_actual=0; $tot_dye_finish_cost_actual=0; $tot_yarn_dye_cost_actual=0; $tot_aop_cost_actual=0; $tot_trims_cost_actual=0; $tot_embell_cost_actual=0; $tot_wash_cost_actual=0; $tot_commission_cost_actual=0; $tot_comm_cost_actual=0; $tot_freight_cost_actual=0; $tot_test_cost_actual=0; $tot_inspection_cost_actual=0; $tot_currier_cost_actual=0; $tot_cm_cost_actual=0; $tot_actual_all_cost=0; $tot_actual_margin=0; $tot_fabric_purchase_cost_mkt=$total_fabric_cost_mkt=0; $tot_fabric_purchase_cost_actual=$tot_grey_fab_cost_actual=$tot_actual_net_margin=0;
				$tot_print_amount_mkt=$tot_embro_amount_mkt=$tot_dyeing_amount_mkt=$tot_wash_amount_mkt=$tot_print_amount_actual=$tot_embro_amount_actual=$tot_dyeing_amount_actual=$tot_wash_amount_actual=$tot_finished_fab_cost_actual=$tot_fin_fab_transfer_amt_actual=$tot_yarn_dyeing_twist_actual=$tot_grey_fab_transfer_amt_actual=$tot_yarn_qty_actual=$tot_yarn_amt_actual=$tot_grey_fab_cost_mkt=$tot_yarn_value_addition_cost_mkt=$total_fabric_cost=$tot_fabric_cost_actaul=$tot_yarn_qty_cpa_actual=$total_finish_fabric_cost_mkt=$tot_yarn_qty_cpa_actual=0;
				$buyer_name_array=array();
				$mkt_po_val_array = array(); $mkt_yarn_array = array(); $mkt_knit_array = array(); $mkt_dy_fin_array = array(); $mkt_yarn_dy_array = array();
				$mkt_aop_array = array(); $mkt_trims_array = array(); $mkt_emb_array = array(); $mkt_wash_array=array(); $mkt_commn_array=array(); $mkt_commercial_array=array();
				$mkt_freight_array = array(); $mkt_test_array = array(); $mkt_ins_array = array(); $mkt_courier_array = array(); $mkt_cm_array = array();
				$mkt_total_array = array(); $mkt_margin_array = array(); $mkt_fabric_purchase_array = array();
				
				$ex_factory_val_array= array(); $yarn_cost_array= array(); $knit_cost_array= array(); $dye_cost_array= array(); $yarn_dyeing_cost_array= array();
				$aop_n_others_cost_array= array(); $trims_cost_array= array(); $enbellishment_cost_array= array(); $wash_cost_array= array(); $commission_cost_array= array(); 
				$commercial_cost_array= array(); $freight_cost_array= array(); $testing_cost_array= array(); $inspection_cost_array= array(); $courier_cost_array= array();
				$cm_cost_array= array(); $total_cost_array= array(); $margin_array= array(); $ex_factory_array=array(); $actual_cm_amnt=array(); $actual_fabric_purchase_array = array();
								
				 $condition= new condition();
				 $condition->company_name("=$company_name");
				 if(str_replace("'","",$cbo_buyer_name)>0){
					  $condition->buyer_name("=$cbo_buyer_name");
				 }
				 if(str_replace("'","",$txt_file_no) !=''){
					  $condition->file_no("='$txt_file_no'");
				 }
				 if(str_replace("'","",$txt_ref_no) !=''){
					  $condition->grouping("='$txt_ref_no'");
				 }
				  if(str_replace("'","",$txt_job_no) !=''){
					  $condition->job_no_prefix_num("=$txt_job_no");
				 }
				if(trim(str_replace("'","",$txt_order_no))!='')
				 {
					$condition->po_number("='".trim(str_replace("'","",$txt_order_no))."'"); 
				 }
				 if(str_replace("'","",$txt_date_from)!='' && str_replace("'","",$txt_date_to)!='')
				 {
					 $start_date=str_replace("'","",$txt_date_from);
					 $end_date=str_replace("'","",$txt_date_to);
					 $condition->pub_shipment_date(" between '$start_date' and '$end_date'");

				 }
				 
				 $condition->init();
				
				$yarn= new yarn($condition);
				//echo $yarn->getQuery();die;
				$yarn_costing_arr=$yarn->getOrderWiseYarnAmountArray();
				$yarn= new yarn($condition);
				$yarn_costing_qty_arr=$yarn->getOrderWiseYarnQtyArray();
				$conversion= new conversion($condition);
				$conversion_costing_arr_process=$conversion->getAmountArray_by_orderAndProcess(); 
				$conversion= new conversion($condition);
				$conversion_costing_arr_process_qty=$conversion->getQtyArray_by_orderAndProcess();
				$trims= new trims($condition);
				$trims_costing_arr=$trims->getAmountArray_by_order();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name=$emblishment->getAmountArray_by_orderAndEmbname();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name_qty=$emblishment->getQtyArray_by_orderAndEmbname();
				$commission= new commision($condition);
				$commission_costing_arr=$commission->getAmountArray_by_orderAndItemid();
				$commercial= new commercial($condition);
				$commercial_costing_arr=$commercial->getAmountArray_by_order();
				$other= new other($condition);
				$other_costing_arr=$other->getAmountArray_by_order();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash=$wash->getAmountArray_by_orderAndEmbname();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash_qty=$wash->getQtyArray_by_orderAndEmbname();
				$fabric= new fabric($condition);
				 //echo $fabric->getQuery();
				$fabric_costing_arr=$fabric->getAmountArray_by_order_knitAndwoven_greyAndfinish();
				
				//print_r($fabric_costing_arr);die;
				$not_yarn_dyed_cost_arr=array(1,2,30,134,35);$job_ids='';
				$tot_short_excess_Qty=0;
				$tot_short_excess_val=0;
				foreach($result as $row)
				{
					if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					
					$po_ids_array[]=$row[csf('id')];
					 $job_ids.=$row[csf('job_no')].',';
					$gmts_item='';
					$gmts_item_id=explode(",",$row[csf('gmts_item_id')]);
					foreach($gmts_item_id as $item_id)
					{
						if($gmts_item=="") $gmts_item=$garments_item[$item_id]; else $gmts_item.=",".$garments_item[$item_id];
					}
					//$job_arr2[$row[csf("job_no")]]['job_quantity'];
					$job_quantity=$row[csf('job_quantity')];
					//echo $job_quantity.'D';
					$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
					$plan_cut_qnty=$row[csf('plan_cut')]*$row[csf('ratio')];
					$unit_price=$row[csf('unit_price')]/$row[csf('ratio')];
					$po_value=$order_qnty_in_pcs*$unit_price;
					
					$tot_po_qnty+=$order_qnty_in_pcs; 
					$tot_po_value+=$po_value;
					//echo "DDD";die;
					$ex_factory_qty=$ex_factory_arr[$row[csf('id')]];
					$ex_factory_value=$ex_factory_qty*$unit_price;
					
					$tot_ex_factory_qnty+=$ex_factory_qty; 
					$tot_ex_factory_val+=$ex_factory_value; 
					
					$dzn_qnty=0;
					$costing_per_id=$fabriccostArray[$row[csf('job_no')]]['costing_per_id'];
					if($costing_per_id==1) $dzn_qnty=12;
					else if($costing_per_id==3) $dzn_qnty=12*2;
					else if($costing_per_id==4) $dzn_qnty=12*3;
					else if($costing_per_id==5) $dzn_qnty=12*4;
					else $dzn_qnty=1;

					$dzn_qnty=$dzn_qnty*$row[csf('ratio')];
					$yarn_cost_mkt=$yarn_costing_arr[$row[csf('id')]];
					 $yarn_cost_mkt_qty=$yarn_costing_qty_arr[$row[csf('id')]];
					$knit_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][1]);
					$knit_qty_mkt=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][1]);
					$yarn_dyeing_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][30]);
					$twisting_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][134]);
					$yarn_value_addition_cost_mkt=$yarn_dyeing_cost_mkt+$twisting_cost_mkt;
					
					if($knit_cost_mkt>0)
					{
					$knit_charge_mkt=$knit_cost_mkt/$knit_qty_mkt;//$dye_finish_cost_mkt_qty
					}
					
					$dye_finish_cost_mkt=0;$dye_finish_cost_mkt_qty=0;
					foreach($conversion_cost_head_array as $process_id=>$val)
					{
						if(!in_array($process_id,$not_yarn_dyed_cost_arr))
						{
							$dye_finish_cost_mkt+=array_sum($conversion_costing_arr_process[$row[csf('id')]][$process_id]);
							
							$dye_finish_cost_mkt_qty+=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][$process_id]);
						}
					}	
					if($dye_finish_cost_mkt>0)
					{			
					$knit_charge_mkt_fin=$dye_finish_cost_mkt/$dye_finish_cost_mkt_qty;
					}
					$aop_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][35]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['aop_charge'];
					$trims_cost_mkt=$trims_costing_arr[$row[csf('id')]];//($order_qnty_in_pcs/$dzn_qnty)*$trimsCostArray[$row[csf('id')]];
				
					
					$print_amount=$emblishment_costing_arr_name[$row[csf('id')]][1];
					$print_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][1];
					if($print_amount) $print_amount=$print_amount;else $print_amount=0;
					if($print_qty) $print_qty=$print_qty;else $print_qty=0;
					if($print_amount==0 || $print_qty==0) $print_avg_rate=0;
					else $print_avg_rate=$print_amount/$print_qty;
						
					$embroidery_amount=$emblishment_costing_arr_name[$row[csf('id')]][2];
					$embroidery_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][2];
					if($embroidery_amount) $embroidery_amount=$embroidery_amount;else $embroidery_amount=0;
					if($embroidery_qty) $embroidery_qty=$embroidery_qty;else $embroidery_qty=0;
					if($embroidery_amount==0 || $embroidery_qty==0) $embro_avg_rate=0;
					else $embro_avg_rate=$embroidery_amount/$embroidery_qty;
					$wash_cost=$emblishment_costing_arr_name_wash[$row[csf('id')]][3];
					$wash_qty=$emblishment_costing_arr_name_wash_qty[$row[csf('id')]][3];
					if($wash_cost) $wash_cost=$wash_cost;else $wash_cost=0;
					if($wash_qty) $wash_qty=$wash_qty;else $wash_qty=0;
					if($wash_cost==0 || $wash_qty==0) $wash_avg_rate=0;
					else $wash_avg_rate=$wash_cost/$wash_qty;
					
					$other_amount=$emblishment_costing_arr_name[$row[csf('id')]][5];
					$dyeing_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][5];
					if($other_amount) $other_amount=$other_amount;else $other_amount=0;
					if($dyeing_qty) $dyeing_qty=$dyeing_qty;else $dyeing_qty=0;
					if($other_amount==0 || $dyeing_qty==0) $dyeing_avg_rate=0;
					else $dyeing_avg_rate=$other_amount/$dyeing_qty;
					
					$foreign_cost=$commission_costing_arr[$row[csf('id')]][1];
					$local_cost=$commission_costing_arr[$row[csf('id')]][2];
					
					$test_cost=$other_costing_arr[$row[csf('id')]]['lab_test'];
					$freight_cost=$other_costing_arr[$row[csf('id')]]['freight'];
					$inspection_cost=$other_costing_arr[$row[csf('id')]]['inspection'];
					$certificate_cost=$other_costing_arr[$row[csf('id')]]['certificate_pre_cost'];
					$currier_cost=$other_costing_arr[$row[csf('id')]]['currier_pre_cost'];
					$cm_cost=$other_costing_arr[$row[csf('id')]]['cm_cost'];
					$embell_cost_mkt=$print_amount+$embroidery_amount+$wash_cost+$other_amount;
					
					$wash_cost_mkt=$wash_cost;
					$commission_cost_mkt=$foreign_cost+$local_cost;
					$comm_cost_mkt=$commercial_costing_arr[$row[csf('id')]];
					$freight_cost_mkt=$freight_cost;
					$test_cost_mkt=$test_cost;
					$inspection_cost_mkt=$inspection_cost;
					$currier_cost_mkt=$currier_cost;
					$cm_cost_mkt=$cm_cost;
						//echo "MM";die;
					
					$fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['grey'][$row[csf('id')]]);
					//+array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
					$fabric_purchase_cost2=array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
					$fabric_purchase_cost_mkt=$fabric_purchase_cost+$fabric_purchase_cost2;
					$finish_fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
					$finish_fabric_purchase_cost_mkt=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
					$grey_fab_cost_mkt=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt;
					$mkt_all_cost=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt+$trims_cost_mkt+$embell_cost_mkt+$wash_cost_mkt+$commission_cost_mkt+$comm_cost_mkt+$freight_cost_mkt+$test_cost_mkt+$inspection_cost_mkt+$currier_cost_mkt+$cm_cost_mkt+$fabric_purchase_cost_mkt;
					
					$mkt_margin=$po_value-$mkt_all_cost;
					$mkt_margin_perc=($mkt_margin/$po_value)*100;
					$tot_finish_fabric_cost_mkt=$grey_fab_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt;
			
					$grey_prod_ex_rate=$grey_fab_array[$row[csf('id')]]['ex_rate'];
					$dye_fin_ex_rate=$dye_fin_fab_array[$row[csf('id')]]['ex_rate'];

					if($process_costing==1)
					{
						$grey_prod_cost=$grey_fab_array[$row[csf('id')]]['qnty']*$knit_charge_mkt;
					}
					else
					{
						$grey_prod_cost=$grey_fab_array[$row[csf('id')]]['grey_amt'];
					}
					$knit_cost=$knitting_cost_array[$row[csf('id')]]['knit_amt'];
					$knit_cost_actual=$knit_cost;
					//$knit_cost_actual=$grey_prod_cost;
					
					$cpa_grey_prod_cost=$grey_fab_array[$row[csf('id')]]['cpa_grey_amt'];
					$cpa_knit_cost_actual=$cpa_grey_prod_cost;
					// echo $dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'].'/'.$knit_charge_mkt_fin.'=='.$dye_fin_ex_rate.', ';
					$cpa_dye_fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'];
					 $cpa_dye_finish_cost_actual=$cpa_dye_fin_fab_prod_cost;
					
					$fin_fab_prod_cost=$grey_used_arr[$row[csf('id')]]['grey_used_amt'];
					$dye_finish_cost_actual=$fin_fab_prod_cost;
					
					$cpa_recv_ret_amt=$receive_ret_arr[$row[csf('job_no')]]['cpa_recv_ret_amt'];
					$cpa_yarn_recv_amt_bal=$yarn_receive_amount_arr[$row[csf('job_no')]]['cpa_order_amount_recv']-$cpa_recv_ret_amt;
					if($cpa_yarn_recv_amt_bal==0) $cpa_yarn_recv_amt_bal_actual=0;
					else $cpa_yarn_recv_amt_bal_actual=($cpa_yarn_recv_amt_bal/$job_quantity)*$order_qnty_in_pcs;
					$yarn_cost_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt']+$cpa_yarn_recv_amt_bal_actual+$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt']+$cpa_knit_cost_actual+$cpa_dye_finish_cost_actual-($yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_yarn_ret_amt']+$yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_ret_amt']);
					
					$yarn_ret_qty_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_qty_retble'];
					$yarn_ret_amt_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt_retble'];
					$tot_yarn_qty_cpa_actual+=$yarn_cost_cpa_actual;
					$yarn_cost_actual=($yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt']+$yarn_cost_cpa_actual)-$yarnissueRetCostArray[$row[csf('id')]]['grey_yarn_ret_amt'];
					$yarn_ret_qty_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_qty_retble'];
					$yarn_ret_amt_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt_retble'];
					$tot_yarn_qty_actual+=$yarn_ret_qty_actual;
					$tot_yarn_amt_actual+=$yarn_ret_amt_actual;
					$job_quantity=$job_arr2[$row[csf("job_no")]]['job_quantity'];

					$order_amount_recv=$yarn_receive_amount_arr[$row[csf('job_no')]]['order_amount_recv'];
					$order_amount_recv_ret=$receive_ret_arr[$row[csf('job_no')]]['recv_ret_amt'];
					
					$order_amount_recv_bal=$order_amount_recv-$order_amount_recv_ret;
					$avg_recv_amount_actual=($order_amount_recv_bal/$job_quantity)*$order_qnty_in_pcs;

					$yarn_dyeing_twist_actual=$avg_recv_amount_actual;//-$yarnissueRetCostArray[$row[csf('id')]]['grey_dyeing_twist_ret_amt'];
					
					
					$trans_in_amt=$recvIssue_array[$row[csf('id')]][5];
				    $trans_out_amt=$recvIssue_array[$row[csf('id')]][6];
					
					$fin_trans_in_amt=$fin_fab_trans_array[$row[csf('id')]][5];
				    $fin_trans_out_amt=$fin_fab_trans_array[$row[csf('id')]][6];
					
					$grey_fab_transfer=$trans_in_amt-$trans_out_amt;
					$grey_fab_transfer_amt_actual=$grey_fab_transfer*$knit_charge_mkt;				
					$fin_fab_transfer=$fin_trans_in_amt-$fin_trans_out_amt;
					$fin_fab_transfer_amt_actual=$fin_fab_transfer*$knit_charge_mkt_fin;
					$trims_amount=$trims_trans_array[$row[csf('id')]]['amt'];
					$gen_trims_issue_amt=$gen_trims_issue_array[$row[csf('id')]]['amt'];
					$trims_cost_actual=$trims_amount+$gen_trims_issue_amt;
					$yarn_dye_cost_actual=0;
					$aop_prod_amt=$aop_prod_array[$row[csf('id')]]['aop_amt'];
					$aop_cost_actual=$aop_prod_amt;
					$embell_cost_actual=$embellCostArray[$row[csf('id')]];
					$wash_cost_actual=$washCostArray[$row[csf('id')]];
					
					//Finished Fabric Cost
					
					
					$printing_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['printing_qty']/$dzn_qnty)*$print_avg_rate;
					$embro_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['embro_qty']/$dzn_qnty)*$embro_avg_rate;
					$dyeing_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['dyeing_qty']/$dzn_qnty)*$dyeing_avg_rate;
					$wash_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['wash_qty']/$dzn_qnty)*$wash_avg_rate;
					
					$commission_cost_actual=($ex_factory_qty/$dzn_qnty)*$fabriccostArray[$row[csf('job_no')]]['commission'];
					$comm_cost_actual=$actualCostArray[6][$row[csf('id')]];
					$freight_cost_actual=$actualCostArray[2][$row[csf('id')]];
					$test_cost_actual=$actualCostArray[1][$row[csf('id')]];
					$inspection_cost_actual=$actualCostArray[3][$row[csf('id')]];
					$currier_cost_actual=$actualCostArray[4][$row[csf('id')]];
					$cm_cost_actual=$actualCostArray[5][$row[csf('id')]];
					
					$fabric_purchase_cost_actual=$finish_purchase_amnt_arr[$row[csf('id')]];
					$grey_fabric_purchase_cost_actual=$grey_purchase_amnt_arr[$row[csf('id')]];
					$grey_fab_cost_actual=$yarn_cost_actual+$yarn_dyeing_twist_actual+$knit_cost_actual+$grey_fab_transfer_amt_actual;
					$finished_fab_cost_actual=$grey_fab_cost_actual+$dye_finish_cost_actual+$aop_cost_actual+$fin_fab_transfer_amt_actual+$fabric_purchase_cost_actual;
					$tot_fabric_cost_act=$fabric_purchase_cost_actual+$finished_fab_cost_actual;
					$tot_fabric_cost_actaul+=$tot_fabric_cost_act;
					
					$actual_all_cost=$yarn_cost_actual+$knit_cost_actual+$yarn_dyeing_twist_actual+$grey_fab_transfer_amt_actual+$dye_finish_cost_actual+$yarn_dye_cost_actual+$aop_cost_actual+$trims_cost_actual+$printing_cost_actual+$embro_cost_actual+$dyeing_cost_actual+$wash_cost_actual+$commission_cost_actual+$comm_cost_actual+$freight_cost_actual+$test_cost_actual+$inspection_cost_actual+$currier_cost_actual+$cm_cost_actual+$fabric_purchase_cost_actual+$grey_fabric_purchase_cost_actual;
					
					$actual_margin=$ex_factory_value-$actual_all_cost;
					$actual_margin_perc=($actual_margin/$ex_factory_value)*100;
					$tot_fabric_cost_mkt=$tot_finish_fabric_cost_mkt+$fabric_purchase_cost_mkt;
					$tot_yarn_cost_mkt+=$yarn_cost_mkt;
					$tot_yarn_value_addition_cost_mkt+=$yarn_value_addition_cost_mkt;
					$tot_grey_fab_cost_mkt+=$grey_fab_cost_mkt; 
					$tot_knit_cost_mkt+=$knit_cost_mkt; 
					$tot_dye_finish_cost_mkt+=$dye_finish_cost_mkt; 
					//$tot_yarn_dye_cost_mkt+=$yarn_dye_cost_mkt; 
					$tot_aop_cost_mkt+=$aop_cost_mkt; 
					$total_fabric_cost_mkt+=$tot_fabric_cost_mkt;
					$tot_trims_cost_mkt+=$trims_cost_mkt;
					 $total_finish_fabric_cost_mkt+=$tot_finish_fabric_cost_mkt;
					$tot_print_amount_mkt+=$print_amount; 
					$tot_embro_amount_mkt+=$embroidery_amount; 
					$tot_dyeing_amount_mkt+=$other_amount; 
					$tot_wash_amount_mkt+=$wash_cost; 
					
					$tot_embell_cost_mkt+=$embell_cost_mkt; 
					$tot_wash_cost_mkt+=$wash_cost_mkt; 
					$tot_commission_cost_mkt+=$commission_cost_mkt; 
					$tot_comm_cost_mkt+=$comm_cost_mkt; 
					$tot_freight_cost_mkt+=$freight_cost_mkt; 
					$tot_test_cost_mkt+=$test_cost_mkt; 
					$tot_inspection_cost_mkt+=$inspection_cost_mkt; 
					$tot_currier_cost_mkt+=$currier_cost_mkt; 
					$tot_cm_cost_mkt+=$cm_cost_mkt; 
					$tot_mkt_all_cost+=$mkt_all_cost; 
					$tot_mkt_margin+=$mkt_margin; 
					$tot_yarn_cost_actual+=$yarn_cost_actual; 
					$tot_yarn_dyeing_twist_actual+=$yarn_dyeing_twist_actual; 
					$tot_knit_cost_actual+=$knit_cost_actual; 
					$tot_dye_finish_cost_actual+=$dye_finish_cost_actual;
					$tot_yarn_dye_cost_actual+=$yarn_dye_cost_actual; 
					$tot_aop_cost_actual+=$aop_cost_actual; 
					$tot_trims_cost_actual+=$trims_cost_actual; 
					$tot_grey_fab_cost_actual+=$grey_fab_cost_actual; 
					$tot_grey_fab_transfer_amt_actual+=$grey_fab_transfer_amt_actual; 
					$tot_print_amount_actual+=$printing_cost_actual; 
					$tot_embro_amount_actual+=$embro_cost_actual; 
					$tot_dyeing_amount_actual+=$dyeing_cost_actual; 
					$tot_wash_amount_actual+=$wash_cost_actual; 
					$tot_finished_fab_cost_actual+=$finished_fab_cost_actual;
					$tot_fin_fab_transfer_amt_actual+=$fin_fab_transfer_amt_actual;
					$tot_embell_cost_actual+=$embell_cost_actual;
					$tot_wash_cost_actual+=$wash_cost_actual; 
					$tot_commission_cost_actual+=$commission_cost_actual; 
					$tot_comm_cost_actual+=$comm_cost_actual; 
					$tot_freight_cost_actual+=$freight_cost_actual; 
					$tot_test_cost_actual+=$test_cost_actual; 
					$tot_inspection_cost_actual+=$inspection_cost_actual; 
					$tot_currier_cost_actual+=$currier_cost_actual; 
					$tot_cm_cost_actual+=$cm_cost_actual; 
					$tot_actual_all_cost+=$actual_all_cost; 
					$tot_actual_margin+=$actual_margin;
					$tot_actual_net_margin+=$actual_margin-$yarn_cost_cpa_actual; 
					
					$tot_fabric_purchase_cost_mkt+=$fabric_purchase_cost_mkt;
					$tot_fabric_purchase_cost_actual+=$fabric_purchase_cost_actual;
					$tot_grey_fabric_purchase_cost_actual+=$grey_fabric_purchase_cost_actual;
					
				?>
                	<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="70"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
                       
                        <td width="70" align="center"><? echo $row[csf('job_no_prefix_num')]; ?></td>
                        <td width="110"  style="word-break:break-all;"><? echo $row[csf('style_ref_no')]; ?></td>
                        <td width="100"  style="word-break:break-all;"><? echo  $row[csf('po_number')];//$button_po; ?></td>
                        
                        <td width="80"  style="word-break:break-all;"><? echo $row[csf('grouping')]; ?></td>
                        
                        <td width="70" align="center"><? echo $job_quantity; ?></td>
                        <td width="120"  style="word-break:break-all;"><? echo $gmts_item; ?></td>
                        <td width="90" align="right"  ><? echo $order_qnty_in_pcs; ?></td>
                        <td width="90" align="right"  ><? echo $ex_factory_qty; ?></td>
                        <td width="100"  style="word-break:break-all;"><? echo $leader_library[$row[csf('team_leader')]]; ?></td>
                        <td width="100" align="center" ><? echo $dealing_library[$row[csf('dealing_marchant')]]; ?></td>
                        <td width="70" align="right"><? echo fn_number_format($unit_price,2,'.',''); ?></td>
                        <td width="110" align="right"><? echo fn_number_format($po_value,2,'.',''); ?></td>
                        <td width="100" align="right"><? echo fn_number_format($ex_factory_value,2,'.',''); ?></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('pub_shipment_date')]); ?></td>
                        <td width="100"  style="word-break:break-all;"><? echo $shipment_status[$row[csf('shiping_status')]]; ?></td>
                       
                        <td width="100" align="right" title="PoQty-Ship Qty" ><? echo fn_number_format($order_qnty_in_pcs-$ex_factory_qty,0,'.',''); ?></td>
                        <td width="" align="right" title="PoValue-Ship Value"><? echo fn_number_format($po_value-$ex_factory_value,2,'.',''); ?></td>
                       
                         
                    </tr>
                    
                    
				<?
					$i++;
					$tot_short_excess_Qty+=$order_qnty_in_pcs-$ex_factory_qty;
					$tot_short_excess_val+=$po_value-$ex_factory_value;
				}
				
				//$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
				
				?>
            </table>
		</div>
        <table class="rpt_table" width="<? echo $width;?>" cellpadding="0" cellspacing="0" border="1" rules="all">
            <tr bgcolor="#CCDDEE" onClick="change_color('tr_pt','#CCDDEE')" id="tr_pt" style="font-weight:bold;">
              <td width="40">&nbsp;</td>
                <td width="70">&nbsp;</td>
               
                <td width="70">&nbsp;</td>
                <td width="110">&nbsp;</td>
                <td width="100">&nbsp;</td>
               
                <td width="80">&nbsp;</td>
              
                 <td width="70">&nbsp;</td>
                <td width="120" align="">Total</td>
                <td width="90"  align="right"><? echo fn_number_format($tot_po_qnty,0,'.',''); ?></td>
                <td width="90"  align="right"><? echo fn_number_format($tot_ex_factory_qnty,0,'.',''); ?></td>
                <td width="100">&nbsp;</td>
              
                <td width="100">&nbsp;</td>
                <td width="70">&nbsp;</td>
                <td width="110"  align="right"><? echo fn_number_format($tot_po_value,2,'.',''); ?></td>
                <td width="100"  align="right"><? echo fn_number_format($tot_ex_factory_val,2,'.',''); ?></td>
                <td width="80">&nbsp;</td>
                <td width="100">&nbsp;</td>
              
                <td width="100"  align="right"><? echo fn_number_format($tot_short_excess_Qty,0,'.',''); ?></td>
                <td width=""  align="right"><? echo fn_number_format($tot_short_excess_val,2,'.',''); ?></td>
                
                
            </tr>
            <? //echo die;?>
            
            
        </table>
        <br />
        <table width="4330">
            <tr>
                <td width="850" valign="top">
                    <div align="center" style="width:450px" id="div_summary"><input type="button" value="Print Preview" class="formbutton" onClick="new_window2('company_div','summary_full')" /></div>
                    <br /><? $po_ids=implode(',',$po_ids_array);$job_ids=rtrim($job_ids,','); $job_nos=implode(',',array_unique(explode(",",$job_ids))); ?>
                    <div id="summary_full"> <font color="#FF0000" style="display:none">*Yarn Dyeing Charge included with actual Yarn Cost</font>
                        <div align="center" id="company_div" style="visibility:hidden; font-size:24px;width:700px"><b><? echo $company_arr[$company_name].'<br>'; 
						echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to));
						?></b></div>
                        <table width="850" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
                            <thead>
                            <tr>
                                <th colspan="9">Summary</th>
                            </tr>
                            <tr>
                                <th width="30">SL</th>
                                <th width="180">Particulars</th>
                                <th width="130">Pre Costing</th>
                                <th width="80">%</th>
                                <th width="130">At Actual</th>
                                <th width="80">%</th>
                                <th width="80">Variance</th>
                                <th width="80">%</th>
                                <th>Disclosure</th>
                            </tr> 
							<?
								$bgcolor1='#E9F3FF';
								$bgcolor2='#FFFFFF';
							?>
                            </thead>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_1','<? echo $bgcolor1; ?>')" id="trtd_1">
                                <td align="center">1</td>
                                <td>PO/Shipment Value</td>
                                <td align="right"><? echo fn_number_format($tot_po_value,2); ?></td>
                                <td align="right">&nbsp;</td>
                                <td align="right"><? echo fn_number_format($tot_ex_factory_val,2); ?></td>
                                <td align="right">&nbsp;</td>
                                <td align="right"><? echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                                <td align="right"  title="Variance/PO-Shipment Value Mkt*100"><? echo fn_number_format((($tot_ex_factory_val-$tot_po_value)/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_2','<? echo $bgcolor2; ?>')" id="trtd_2">
                                <td colspan="9"><b>Cost</b></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_3','<? echo $bgcolor1; ?>')" id="trtd_3">
                                <td align="center">2</td>
                                <td>Grey Yarn Cost</td>
                                <td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_cost','Grey Yarn Mkt. Cost Details')"><? echo fn_number_format($tot_yarn_cost_mkt,2); //$tot_yarn_qty_actual?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_cost_actual2','Yarn Cost Details')"><? echo fn_number_format($tot_yarn_cost_actual,2); //$tot_yarn_qty_actual;?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_yarn_cost_mkt-$tot_yarn_cost_actual,2);//$tot_yarn_amt_actual ?></td>
                                <td align="right"  title="Variance/Grey Yarn Cost Mkt*100"><? echo fn_number_format((($tot_yarn_cost_mkt-$tot_yarn_cost_actual)/$tot_yarn_cost_mkt)*100,2); ?></td>
                                 <td align="right"><?  if($tot_yarn_qty_actual>$tot_yarn_cost_mkt) echo "Returnable Yarn Qty..".$tot_yarn_qty_actual."And Cost..".$tot_yarn_amt_actual; else echo " ";?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_4','<? echo $bgcolor2; ?>')" id="trtd_4">
                                <td align="center">3</td>
                                <td>Yarn  Value Addition Cost</td>
                                <td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_dyeing_twisting_cost','Yarn Dyeing Cost Details')"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></a><? //echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_dye_twist_cost_actual','Yarn Dyeing & Twist Cost Details','2','900px')"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual,2); ?></td>
                                 <td align="right" title="Variance/Yarn Value  Addition Cost Mkt*100"><? echo fn_number_format((($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual)/$tot_yarn_value_addition_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_5','<? echo $bgcolor2; ?>')" id="trtd_5">
                                <td align="center">4</td>
                                <td>Knitting Cost</td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knit_cost_actual5','Knitting Cost Details')"><? echo fn_number_format($tot_knit_cost_actual,2); ?></a><? //echo fn_number_format($tot_knit_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Knitting Cost Mkt*100"><? echo fn_number_format((($tot_knit_cost_mkt-$tot_knit_cost_actual)/$tot_knit_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_6','<? echo $bgcolor2; ?>')" id="trtd_6">
                                <td align="center">5</td>
                                <td>Grey Fabric Transfer Cost</td>
                                <td align="right"><? //echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></a><? echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
                                 <td align="right"><? echo " "; ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_7','<? echo $bgcolor2; ?>')" id="trtd_7">
                                <td align="center">6</td>
                                <td>Grey Fabric Cost =2+3+4+5</td>
                                <td align="right"><? 
								$grey_fab_cost_mkt_sum=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt;
								$grey_fab_cost_act_sum=$tot_yarn_cost_actual+$tot_yarn_dyeing_twist_actual+$tot_knit_cost_actual+$tot_grey_fab_transfer_amt_actual;
								
								echo fn_number_format($grey_fab_cost_mkt_sum,2); ?></td>
                                <td align="right"><? echo fn_number_format(($grey_fab_cost_mkt_sum/$tot_po_value)*100,2); ?></td>
                                <td align="right" title=""><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_cost_actual,2); ?></a><? echo fn_number_format($grey_fab_cost_act_sum,2); ?></td>
                                <td align="right"><? echo fn_number_format(($grey_fab_cost_act_sum/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum,2); ?></td>
                                 <td align="right" title="Variance/Grey Fab Cost Mkt*100"><? echo fn_number_format((($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum)/$grey_fab_cost_mkt_sum)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_8','<? echo $bgcolor2; ?>')" id="trtd_8">
                                <td align="center">7</td>
                                <td>Dye & Fin Cost</td>
                                <td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dye_finish_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $po_ids; ?>','dye_finish_cost_actual5','Actual Dyeing & Finish Cost Details','900px')"><? echo fn_number_format($tot_dye_finish_cost_actual,2,'.',''); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_dye_finish_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Dye & Fin Cost Mkt*100"><?  echo fn_number_format((($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual)/$tot_dye_finish_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_9','<? echo $bgcolor1; ?>')" id="trtd_9">
                                <td align="center">8</td>
                                <td>AOP  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/AOP Cost Mkt*100"><? echo fn_number_format((($tot_aop_cost_mkt-$tot_aop_cost_actual)/$tot_aop_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_10','<? echo $bgcolor2; ?>')" id="trtd_10">
                                <td align="center">9</td>
                                <td>Finished Fabric Transfer Cost</td>
                                <td align="right"><? //echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
                                <td align="right"><? // echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
                                 <td align="right"><? echo " "; ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_11','<? echo $bgcolor1; ?>')" id="trtd_11">
                                <td align="center">10</td>
                                <td>Finished Fabric Cost =6+7+8+9</td>
                                <td align="right"><? $tot_fin_fab_cost_sum_mkt=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
								//$tot_fin_fabCost=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
								echo fn_number_format($tot_fin_fab_cost_sum_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? $tot_fin_fab_cost_sum_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual;
								echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual,2); ?></td>
                                 <td align="right" title="Variance/Finished Fabric Cost Mkt*100"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual)/$tot_fin_fab_cost_sum_mkt)*100,2);  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_12','<? echo $bgcolor2; ?>')" id="trtd_12">
                                <td align="center">11</td>
                                <td>Fabric Purchase Cost</td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','fabric_purchase_cost5','Fabric Purchase Cost Details')"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2); ?></a></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Fabric Purchase Cost Mkt*100"><? echo fn_number_format((($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual)/$tot_fabric_purchase_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                             <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_27','<? echo $bgcolor2; ?>')" id="trtd_27">
                                <td align="center">12</td>
                                <td>Total Fabric Cost(=10+11)</td>
                                <td align="right"><? $tot_fab_cost_mkt=$tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt;
								echo fn_number_format($tot_fab_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? 
								$tot_fabric_cost_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual;
								echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? $tot_fab_cost_vairance=($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual;
								echo fn_number_format(($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual,2); ?></td>
                                 <td align="right"><?  echo fn_number_format(($tot_fab_cost_vairance/$tot_fab_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? echo ' '; ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_13','<? echo $bgcolor1; ?>')" id="trtd_13">
                                <td align="center">13</td>
                                <td>Trims Cost</td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_mkt-$tot_trims_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Trim Cost Mkt*100"><? echo fn_number_format((($tot_trims_cost_mkt-$tot_trims_cost_actual)/$tot_trims_cost_mkt)*100,2);  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_14','<? echo $bgcolor2; ?>')" id="trtd_14">
                                <td align="center">14</td>
                                <td>Printing Cost</td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_mkt,2); ?></td>
                                <td align="right"><?  echo fn_number_format(($tot_print_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_print_amount_mkt-$tot_print_amount_actual,2); ?></td>
                                <td align="right" title="Variance/Printing Cost Mkt*100"><?  echo fn_number_format((($tot_print_amount_mkt-$tot_print_amount_actual)/$tot_print_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_15','<? echo $bgcolor1; ?>')" id="trtd_15">
                                <td align="center">15</td>
                                <td> Embroidery Cost</td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_embro_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_embro_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_embro_amount_mkt-$tot_embro_amount_actual,2); ?></td>
                                 <td align="right" title="Variance/Embroidery Cost Mkt*100"><?  echo fn_number_format((($tot_embro_amount_mkt-$tot_embro_amount_actual)/$tot_embro_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_16','<? echo $bgcolor2; ?>')" id="trtd_16">
                                <td align="center">16</td>
                                <td>Gmt Dyeing  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dyeing_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dyeing_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual,2); ?></td>
                                 <td align="right" title="Variance/Gmt Dyeing Cost Mkt*100"><?  echo fn_number_format((($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual)/$tot_dyeing_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_17','<? echo $bgcolor1; ?>')" id="trtd_17">
                                <td align="center">17</td>
                                <td>Washing  Cost</td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_wash_amount_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_wash_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_wash_amount_mkt-$tot_wash_amount_actual,2); ?></td>
                                <td align="right" title="Variance/Washing Cost Mkt*100"><?  echo fn_number_format((($tot_wash_amount_mkt-$tot_wash_amount_actual)/$tot_wash_amount_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr> 
                            
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_18','<? echo $bgcolor2; ?>')" id="trtd_18">
                                <td align="center">18</td>
                                <td>Commission Cost</td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_commission_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_commission_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_mkt-$tot_commission_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Commission Cost Mkt*100"><?  echo fn_number_format((($tot_commission_cost_mkt-$tot_commission_cost_actual)/$tot_commission_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_19','<? echo $bgcolor1; ?>')" id="trtd_19">
                                <td align="center">19</td>
                                <td>Commercial Cost</td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_comm_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_comm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_mkt-$tot_comm_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Commercial Cost Mkt*100"><?  echo fn_number_format((($tot_comm_cost_mkt-$tot_comm_cost_actual)/$tot_comm_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_20','<? echo $bgcolor2; ?>')" id="trtd_20">
                                <td align="center">20</td>
                                <td>Freight Cost</td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_freight_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_freight_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_mkt-$tot_freight_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Freight Cost Mkt*100"><?  echo fn_number_format((($tot_freight_cost_mkt-$tot_freight_cost_actual)/$tot_freight_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_21','<? echo $bgcolor1; ?>')" id="trtd_21">
                                <td align="center">21</td>
                                <td>Testing Cost</td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_test_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_test_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_mkt-$tot_test_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Testing Cost Mkt*100"><?  echo fn_number_format((($tot_test_cost_mkt-$tot_test_cost_actual)/$tot_test_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_22','<? echo $bgcolor2; ?>')" id="trtd_22">
                                <td align="center">22</td>
                                <td>Inspection Cost</td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_inspection_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_inspection_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_mkt-$tot_inspection_cost_actual,2); ?></td>
                                <td align="right" title="Variance/Inspection Cost Mkt*100"><?  echo fn_number_format((($tot_inspection_cost_mkt-$tot_inspection_cost_actual)/$tot_inspection_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_23','<? echo $bgcolor1; ?>')" id="trtd_23">
                                <td align="center">23</td>
                                <td>Courier Cost</td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_currier_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_currier_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_mkt-$tot_currier_cost_actual,2); ?></td>
                                 <td align="right" title="Variance/Courier Cost Mkt*100"><?  echo fn_number_format((($tot_currier_cost_mkt-$tot_currier_cost_actual)/$tot_currier_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_24','<? echo $bgcolor2; ?>')" id="trtd_24">
                                <td align="center">24</td>
                                <td>CM</td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_cm_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_cm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_mkt-$tot_cm_cost_actual,2); ?></td>
                                <td align="right" title="Variance/CM Cost Mkt*100"><?  echo fn_number_format((($tot_cm_cost_mkt-$tot_cm_cost_actual)/$tot_cm_cost_mkt)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_25','<? echo $bgcolor1; ?>')" id="trtd_25">
                                <td align="center">25</td>
                                <td>Total Cost</td>
                                <td align="right"><? echo fn_number_format($tot_mkt_all_cost,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_mkt_all_cost/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_all_cost,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_actual_all_cost/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_mkt_all_cost-$tot_actual_all_cost,2); ?></td>
                                <td align="right" title="Variance/Total Cost Mkt*100"><?  echo fn_number_format((($tot_mkt_all_cost-$tot_actual_all_cost)/$tot_mkt_all_cost)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_26','<? echo $bgcolor2; ?>')" id="trtd_26">
                                <td align="center">26</td>
                                <td>Margin/Loss</td>
                                <td align="right"><? echo fn_number_format($tot_mkt_margin,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_margin,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
                                <td align="right" title="Variance/Margin/Loss Mkt*100"><?  echo fn_number_format((($tot_mkt_margin-$tot_actual_margin)/$tot_mkt_margin)*100,2); ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            
                             
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_29','<? echo $bgcolor2; ?>')" id="trtd_29">
                                <td align="center">27</td>
                                <td>Net Margin/Loss</td>
                                <td align="right"><? //echo fn_number_format($tot_mkt_margin,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_margin,2); ?></td>
                                <td align="right"><? //echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? //echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
                                 <td align="right"><?  echo ' ';  ?></td>
                                 <td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                        </table>
                    </div>
                </td>
                
            </tr>
        </table>
	</fieldset>
 <?
	foreach (glob("../../../../ext_resource/tmp_report/$user_name*.xls") as $filename) 
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$html=ob_get_contents();
	$name=time();
	$filename="../../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,$html);
	$filename="../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	echo "$total_data****$filename****$report_type";
	exit();
}
if($action=="report_generate3")
{ 
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process )); 
	
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );

	$company_name=str_replace("'","",$cbo_company_name);
	$txt_order_no=str_replace("'","",$txt_order_no);
	$txt_file_no=str_replace("'","",$txt_file_no);
	$txt_ref_no=str_replace("'","",$txt_ref_no);
	$cbo_based_on=str_replace("'","",$cbo_based_on);
	$report_type=str_replace("'","",$report);
	
	if($txt_ref_no!='') $ref_cond="and b.grouping='$txt_ref_no'";else $ref_cond="";
	if($txt_file_no!='') $file_cond="and b.file_no=$txt_file_no";else $file_cond="";
	
	if(str_replace("'","",$cbo_buyer_name)==0)
	{
		if ($_SESSION['logic_erp']["data_level_secured"]==1)
		{
			if($_SESSION['logic_erp']["buyer_id"]!="") $buyer_id_cond=" and a.buyer_name in (".$_SESSION['logic_erp']["buyer_id"].")"; else $buyer_id_cond="";
		}
		else $buyer_id_cond="";
	}
	else $buyer_id_cond=" and a.buyer_name=$cbo_buyer_name";//.str_replace("'","",$cbo_buyer_name)
	
	$txt_job_no=str_replace("'","",$txt_job_no);
	if(trim($txt_job_no)!="") $job_no=trim($txt_job_no); else $job_no="%%";
	
	$cbo_year=str_replace("'","",$cbo_year);
	if(trim($cbo_year)!=0) 
	{
		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year"; else if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year"; else $year_cond="";
	}
	else $year_cond="";
	
	$date_cond='';
	if(str_replace("'","",$txt_date_from)!="" && str_replace("'","",$txt_date_to)!="")
	{
		$date_cond=" and b.pub_shipment_date between $txt_date_from and $txt_date_to";
	}
	$ex_date_cond='';
	if(str_replace("'","",$txt_ex_date_from)!="" && str_replace("'","",$txt_ex_date_to)!="")
	{
		$ex_date_cond=" and d.ex_factory_date between $txt_ex_date_from and $txt_ex_date_to";
	}
	$po_id_cond="";
	if(trim(str_replace("'","",$txt_order_no))!="")
	{
		if(str_replace("'","",$hide_order_id)!="") $po_id_cond=" and b.id in(".str_replace("'","",$hide_order_id).")";
		else $po_id_cond=" and LOWER(b.po_number) like LOWER('%".trim(str_replace("'","",$txt_order_no))."%')";
	}
	
	$shipping_status_cond='';
	if(str_replace("'","",$shipping_status)!=0) $shipping_status_cond=" and b.shiping_status=$shipping_status";
	
	$po_ids_array=array();
		
	if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
	else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
	else $year_field="";//defined Later
	//echo $ex_date_cond;
	if($ex_date_cond=="" ){
		$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, $year_field,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c where a.job_no=b.job_no_mst and a.job_no=c.job_no and b.job_no_mst=c.job_no and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no'   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $date_cond $buyer_id_cond $po_id_cond $ref_cond $file_cond $shipping_status_cond $year_cond order by b.pub_shipment_date, a.job_no_prefix_num, b.id";
	}else {
		$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, $year_field,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c,pro_ex_factory_mst d where a.job_no=b.job_no_mst and a.job_no=c.job_no and b.job_no_mst=c.job_no and b.id=d.po_break_down_id and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no'   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $ex_date_cond $date_cond $buyer_id_cond $po_id_cond $ref_cond $file_cond $shipping_status_cond $year_cond group by  a.id,a.job_no_prefix_num, a.job_no, a.insert_date,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate order by b.pub_shipment_date, a.job_no_prefix_num, b.id";

	}
	$result=sql_select($sql);
	$all_po_id="";	$all_job_id="";
	$po_id_arr=array(); $job_id_arr=array();
	foreach($result as $row)
	{
		$po_id_arr[$row[csf("id")]]=$row[csf("id")];
		$job_id_arr[$row[csf("job_id")]]=$row[csf("job_id")];

		$job_arr[$row[csf("id")]]['job']=$row[csf("job_no")];
		$job_arr2[$row[csf("job_no")]]['po_quantity']=$row[csf("po_quantity")];
		$job_arr2[$row[csf("job_no")]]['job_quantity']=$row[csf("job_quantity")];
		$po_exchange_rateArr[$row[csf("id")]]['exchange_rate']=$row[csf("exchange_rate")];
	}
	if(count($po_id_arr)==0) 
	{ 
		echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
	}
	$con = connect();
	execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_name." and ref_from in (1,2,3,4,5,6,7) and ENTRY_FORM=123");
	fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 1, $job_id_arr, $empty_arr);
	fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 2, $po_id_arr, $empty_arr);
	
	$ActualArray_sql=sql_select("select a.id,b.pr_date, b.man_power, b.target_per_hour, e.working_hour,e.operator,e.helper,c.from_date,c.to_date,c.capacity,e.po_id from prod_resource_mst a, prod_resource_dtls b,prod_resource_dtls_mast c,prod_resource_color_size e, gbl_temp_engine f where a.id=c.mst_id and c.id=b.mast_dtl_id and e.mst_id=a.id and e.dtls_id=c.id and a.company_id=$company_name  and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and e.po_id=f.ref_val and f.ref_from=2 and f.entry_form=123 and f.user_id=$user_name");
		foreach($ActualArray_sql as $val)
		{
			$pr_date=date("Y-m",strtotime(($val[csf('pr_date')])));
			$po_exchange_rate=$po_exchange_rateArr[$val[csf("po_id")]]['exchange_rate'];
			$prod_resource_array[$val[csf('po_id')]]['man_power']=$val[csf('man_power')];
			$prod_resource_array[$val[csf('po_id')]]['operator']=$val[csf('operator')];
			$prod_resource_array[$val[csf('po_id')]]['helper']=$val[csf('helper')];
			$prod_resource_array[$val[csf('po_id')]]['terget_hour']=$val[csf('target_per_hour')];
			$prod_resource_array[$val[csf('po_id')]]['operator_helper']=$val[csf('operator')]+$val[csf('helper')];
			$prod_resource_array[$val[csf('po_id')]]['working_hour']+=$val[csf('working_hour')];
			$prod_resource_array[$val[csf('po_id')]]['pr_date']=$val[csf('pr_date')];
			$prod_resource_array[$val[csf('po_id')]]['ex_rate']=$po_exchange_rate;
			$actual_prod_id_arr[$val[csf('id')]]=$val[csf('id')];			 
		}
		$adj_resource_array=array();
		if(count($actual_prod_id_arr)>0){
			fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 3, $actual_prod_id_arr, $empty_arr);
			$ActualExtraArray_sql=sql_select("select a.id,b.pr_date, b.man_power, e.style_ref_no,e.number_of_emp, e.adjust_hour as working_hour,c.from_date,c.to_date,c.capacity,e.style_ref_no from prod_resource_mst a, prod_resource_dtls b,prod_resource_dtls_mast c,prod_resource_smv_adj e, gbl_temp_engine f where a.id=c.mst_id and c.id=b.mast_dtl_id and e.mst_id=a.id and e.dtl_id=b.id and a.company_id=$company_name  and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and a.id=f.ref_val and f.ref_from=3 and f.entry_form=123 and f.user_id=$user_name");
			foreach($ActualExtraArray_sql as $val)
			{
				$pr_date=date("Y-m",strtotime(($val[csf('pr_date')])));
				$adj_resource_array[$val[csf('style_ref_no')]]['working_hour']+=$val[csf('working_hour')];
				$adj_resource_array[$val[csf('style_ref_no')]]['pr_date']=$val[csf('pr_date')];
				$adj_resource_array[$val[csf('style_ref_no')]]['number_of_emp']+=$val[csf('number_of_emp')];
			}
		}
		$sql_cpm="select monthly_cm_expense,applying_period_date,applying_period_to_date, no_factory_machine, working_hour, cost_per_minute, depreciation_amorti, operating_expn, interest_expense, income_tax from lib_standard_cm_entry where company_id=$company_name   and status_active=1 and is_deleted=0";
	 
		$lib_data_array=sql_select($sql_cpm);
		foreach ($lib_data_array as $row)
		{
			$applying_period_date=$row[csf("applying_period_date")];
			$from_cmp_date=date("Y-m",strtotime(($applying_period_date)));
			$lib_cpm_array[$from_cmp_date]['cpm']=$row[csf('cost_per_minute')];
		}
		unset($lib_data_array);	
		$ex_factory_arr=return_library_array( "select b.po_break_down_id, 
		sum(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as qnty 
		from pro_ex_factory_mst b, gbl_temp_engine c where b.status_active=1 and b.is_deleted=0 and b.po_break_down_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by b.po_break_down_id", "po_break_down_id", "qnty");
		ob_start();
	?>
    <fieldset>
    	<table width="5530">
            <tr class="form_caption">
                <td colspan="36" align="center"><strong>Post Costing Report V3</strong></td>
            </tr>
            <tr class="form_caption">
                <td colspan="36" align="center"><strong><? echo $company_arr[$company_name];?></strong>
                    <br>
                    <strong><? echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to)); ?></strong>
                </td>
            </tr>
        </table>
        <table style="margin-top:10px" id="table_header_1" class="rpt_table" width="5530" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="70">Buyer</th>
                <th width="60">Job Year</th>
                <th width="70">Job No</th>
                <th width="100">PO No</th>
				<th width="100">FB No</th>
                <th width="70">File No</th>
                <th width="80">Ref. No</th>
                <th width="110">Style Name</th>
                <th width="120">Garments Item</th>
                <th width="90">PO Quantity</th>
                <th width="50">UOM</th>
                <th width="70">Unit Price</th>
                <th width="110">PO Value</th>
                <th width="100">SMV</th>
                <th width="80">Shipment Date</th>
                <th width="100">Shipping Status</th>
                <th width="100">Cost Source</th>
                <th width="100">PO/Ex-Factory Qnty</th>
                <th width="110">PO/Ex-Factory Value</th>
                <th width="110">Grey Yarn Cost</th>
                <th width="100">Yarn Value Addition Cost</th>
                <th width="110">Knitting Cost</th>
                <th width="100">Grey Fabric Transfer Cost</th>
              
                <th width="100">Grey Fabric Cost</th>
                
                <th width="110">Dye & Fin Cost</th>
                <th width="110">AOP Cost</th>
                <th width="100">Fin. Fab. Transfer Cost</th>
                <th width="100">Fin.Fabric Purchase Cost</th>
                <th width="110">Grey Fabric Purchease Cost</th>
                <th width="100">Finished Fabric Cost[Production]</th>
                <th width="100" title="Fin.Fabric Purchase Cost+Finished Fabric Cost">Total Fabric Cost</th>
                <th width="110">Trims Cost</th>
                <th width="100">Printing Cost</th>
                <th width="100">Embroidery Cost</th>
                <th width="100">Gmt Dyeing Cost</th>
                <th width="100">Washing Cost</th>
               
                <th width="100">Commission Cost</th>
                <th width="100">Commercial Cost</th>
                <th width="100">Freight Cost</th>
                <th width="100">Testing Cost</th>
                <th width="100">Inspection Cost</th>
                <th width="100">Courier Cost</th>
                
                <th width="100">Certificate Cost</th>
                <th width="100">Deffd. LC Cost</th>
                <th width="100">Design Cost</th>
                <th width="100">Studio Cost</th>
                <th width="100">Opert. Exp.</th>               
                <th width="100">CM Cost</th>                
                <th width="100">Interest</th>
                <th width="100">Income Tax</th>
                <th width="100">Depc. & Amort.</th>
				<th width="100">Total Cost</th>
                <th width="100">Margin/Loss</th>
                <th  width="100">% to Ex-Factory Value</th>
                <th width="100">CPA/Short Fab. Cost</th>
                <th width="">Net Margin/Loss</th>
            </thead>
        </table>
    	<div style="width:5550px; max-height:400px; overflow-y:scroll" id="scroll_body">
            <table class="rpt_table" width="5530" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body">
            <?
			$process_costing=return_field_value("process_costing_maintain", "variable_settings_production", "company_name=$company_name and variable_list=34 and is_deleted=0 and status_active=1");
			
			$usd_id=2;
			$fabriccostArray=array(); $yarncostArray=array(); $trimsCostArray=array(); $prodcostArray=array(); $actualCostArray=array(); $actualTrimsCostArray=array(); 
			$subconCostArray=array(); $embellCostArray=array(); $washCostArray=array(); $aopCostArray=array(); $yarnTrimsCostArray=array(); 
			$yarncostDataArray=sql_select("select a.job_no, sum(a.amount) as amnt, sum(a.rate*a.avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls a, gbl_temp_engine b where a.status_active=1 and a.is_deleted=0 and a.job_id=b.ref_val and b.ref_from=1 and b.entry_form=123 and b.user_id=$user_name group by a.job_no");			
			foreach($yarncostDataArray as $yarnRow)
			{
			   $yarncostArray[$yarnRow[csf('job_no')]]=$yarnRow[csf('amount')];
			}
			unset($yarncostDataArray);
			$fabriccostDataArray=sql_select("select a.job_no, a.costing_per_id, a.embel_cost, a.wash_cost, a.cm_cost, a.commission, a.currier_pre_cost, a.lab_test, a.inspection, a.freight, a.comm_cost from wo_pre_cost_dtls a, gbl_temp_engine b where a.status_active=1 and a.is_deleted=0 and a.job_id=b.ref_val and b.ref_from=1 and b.entry_form=123 and b.user_id=$user_name");
			foreach($fabriccostDataArray as $fabRow)
			{
				 $fabriccostArray[$fabRow[csf('job_no')]]['costing_per_id']=$fabRow[csf('costing_per_id')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['embel_cost']=$fabRow[csf('embel_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['wash_cost']=$fabRow[csf('wash_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['cm_cost']=$fabRow[csf('cm_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['commission']=$fabRow[csf('commission')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['currier_pre_cost']=$fabRow[csf('currier_pre_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['lab_test']=$fabRow[csf('lab_test')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['inspection']=$fabRow[csf('inspection')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['freight']=$fabRow[csf('freight')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['comm_cost']=$fabRow[csf('comm_cost')];
			}
			unset($fabriccostDataArray);
			$prodcostDataArray="SELECT a.body_part_id,a.lib_yarn_count_deter_id as deter_id,b.po_break_down_id as po_id, avg(case when c.cons_process=1 then c.charge_unit end) as knit_charge, avg(case when c.cons_process=30 then c.charge_unit end) as yarn_dye_charge, avg(case when c.cons_process=35 then c.charge_unit end) as aop_charge, avg(case when c.cons_process not in(1,2,30,35,134) then c.charge_unit end) as dye_finish_charge from wo_pre_cost_fabric_cost_dtls a,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cos_fab_co_avg_con_dtls b, gbl_temp_engine d where a.id=c.fabric_description and a.job_no=c.job_no and b.pre_cost_fabric_cost_dtls_id=a.id and b.job_no=c.job_no and c.status_active=1 and c.is_deleted=0 and b.po_break_down_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name group by  a.lib_yarn_count_deter_id,b.po_break_down_id,a.body_part_id"; $resultfab_arr = sql_select($prodcostDataArray);
			foreach($resultfab_arr as $prodRow)
			{
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['knit_charge']=$prodRow[csf('knit_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['yarn_dye_charge']=$prodRow[csf('yarn_dye_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['aop_charge']=$prodRow[csf('aop_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['dye_finish_charge']=$prodRow[csf('dye_finish_charge')];
			}
			$finProd_grey_used_sql = "SELECT c.body_part_id,c.fabric_description_id as deter_id,b.po_breakdown_id as po_id, b.quantity as grey_used_qty from order_wise_pro_details b,pro_finish_fabric_rcv_dtls c, gbl_temp_engine d where  b.dtls_id=c.id and b.entry_form=7 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name";
			$fingrey_used_data =sql_select($finProd_grey_used_sql );
			foreach($fingrey_used_data as $row)
			{
				$fin_dye_finish_charge=$prodcostArray[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$fin_grey_used_arr[$row[csf('po_id')]]['grey_used_amt']+=$row[csf('grey_used_qty')]*$fin_dye_finish_charge;
			}
			unset($fingrey_used_data);
			
		
			$grey_used_sql = "SELECT a.body_part_id,a.fabric_description_id as deter_id,b.qnty,b.po_breakdown_id as po_id from pro_finish_fabric_rcv_dtls a, pro_roll_details b, gbl_temp_engine c where a.id=b.dtls_id and b.entry_form=66 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";

			$grey_used_data =sql_select($grey_used_sql );
			foreach($grey_used_data as $row)
			{
				$finProd_grey_used=$finProd_grey_usedArr[$row[csf('po_id')]];
				$dye_finish_charge=$prodcostArray[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$grey_used_arr[$row[csf('po_id')]]['grey_used_amt']+=$row[csf('qnty')]*$dye_finish_charge;
			}
			
			$yarn_dyeing_costArray=array(); //product_id
			 $yarndyeing_sql="SELECT b.booking_date,b.id,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a, gbl_temp_engine c where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 and a.job_no_id=c.ref_val and c.ref_from=1 and c.entry_form=123 and c.user_id=$user_name group by b.id,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";

			$yarndyeing_result = sql_select($yarndyeing_sql);
			foreach($yarndyeing_result as $yarnRow)
			{
				$yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['job']=$yarnRow[csf('job_no')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['ydw_no']=$yarnRow[csf('ydw_no')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['booking_date']=$yarnRow[csf('booking_date')];
				$yarn_dyeing_curr_arr[$yarnRow[csf('ydw_no')]]['currency']=$yarnRow[csf('currency')];
				$yarn_dyeing_rate_arr[$yarnRow[csf('job_no')]][$yarnRow[csf('yarn_color')]]['rate']=$yarnRow[csf('dyeing_charge')];
				
				$yarn_dyeing_mst_idArr[$yarnRow[csf('id')]]=$yarnRow[csf('id')];
			}
			//print_r($yarn_dyeing_curr_arr);
			unset($resultyarnIssueData);	
				
			$yarnIssueData="SELECT b.prod_id,sum(a.cons_amount) as cons_amount,sum(a.cons_quantity) as cons_quantity from inv_transaction a, order_wise_pro_details b,product_details_master c, gbl_temp_engine d where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and b.entry_form ='3' and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)  and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name group by  b.prod_id";
			//echo $yarnIssueData; die;

			$resultyarnIssueData = sql_select($yarnIssueData);
			$all_prod_ids=array();
			foreach($resultyarnIssueData as $row)
			{
				$all_prod_ids[$row[csf('prod_id')]]=$row[csf('prod_id')];
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt']+=$row[csf('cons_amount')];
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty']+=$row[csf('cons_quantity')];
			}
			if(count($all_prod_ids)>0){
				fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 4, $all_prod_ids, $empty_arr);
				$sql_receive_for_issue="SELECT c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.exchange_rate,c.currency_id,c.receive_purpose,b.lot,b.color, sum(a.order_qnty) as qty, sum(a.order_amount) as amnt, sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv from inv_transaction a,product_details_master b,inv_receive_master c, gbl_temp_engine d where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 and a.prod_id=d.ref_val and d.ref_from=4 and d.entry_form=123 and d.user_id=$user_name  group by c.booking_id,a.job_no,a.prod_id,c.currency_id,c.exchange_rate,c.receive_purpose,b.lot,b.color";
				$resultReceive_chek = sql_select($sql_receive_for_issue);				
				foreach($resultReceive_chek as $row)
				{
					$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose']=$row[csf('receive_purpose')];
					$receive_date_array[$row[csf('prod_id')]]['last_exchange_rate']=$row[csf('exchange_rate')];
					$avg_rate=$row[csf('amnt')]/$row[csf('qty')];
					$receive_array[$row[csf('prod_id')]]=$avg_rate;
					if($row[csf('prod_id')]!="")
					{
						$prod_id_arr[$row[csf('prod_id')]]=$row[csf('prod_id')];
					}
				}
			}
			fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 5, $yarn_dyeing_mst_idArr, $empty_arr);	
			
			$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit");

			 $sql_receive="SELECT c.recv_number,c.booking_id,c.exchange_rate,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.receive_purpose,b.lot,b.color,c.currency_id, sum(a.order_qnty) as qty, sum(a.order_amount) as amnt, sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv, sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.cons_quantity ELSE 0 END) AS cons_quantity from inv_transaction a,product_details_master b,inv_receive_master c, gbl_temp_engine d where a.prod_id=b.id and c.id=a.mst_id  and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1  and c.booking_id=d.ref_val and d.ref_from=5 and d.entry_form=123 and d.user_id=$user_name  and a.is_deleted=0 group by c.recv_number,c.booking_id,c.exchange_rate,a.job_no,a.prod_id,c.currency_id,c.receive_purpose,b.lot,b.color";

			$resultReceive = sql_select($sql_receive);$all_recv_prod_ids=array();
			foreach($resultReceive as $invRow)
			{
				//if($all_recv_prod_ids=="") $all_recv_prod_ids=$invRow[csf('prod_id')];else $all_recv_prod_ids.=",".$invRow[csf('prod_id')];
				$all_recv_prod_ids[$invRow[csf('prod_id')]]=$invRow[csf('prod_id')];
				$receive_curr_array[$invRow[csf('prod_id')]]=$invRow[csf('currency_id')];
				$jobNo=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['job'];
				$ydw_no=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['ydw_no'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['job']=$jobNo;
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['ydw_no']=$ydw_no;
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$dye_rate=$yarn_dyeing_rate_arr[$jobNo][$invRow[csf('color')]]['rate'];
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				$order_amount_recv=$invRow[csf('order_amount_recv')];
				$cons_quantity=$invRow[csf('cons_quantity')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				$exchange_rateArr[$invRow[csf('prod_id')]]=$invRow[csf('exchange_rate')];
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				$currency_rate=$exchange_rate;
			
				if($currency==1) $avg_rate=$dye_rate/$currency_rate;//Taka
				else $avg_rate=$dye_rate;	
				if($is_short==2) $yarn_receive_amount_arr[$jobNo]['order_amount_recv']+=$avg_rate*$cons_quantity;//Main Booking..
				else $yarn_receive_amount_arr[$jobNo]['cpa_order_amount_recv']+=$avg_rate*$cons_quantity;	
			}
			unset($resultReceive); 
			
			fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 6, $all_recv_prod_ids, $empty_arr);	

			$sql_receive_ret="SELECT a.prod_id,b.lot,b.color,c.received_mrr_no, sum(a.cons_quantity) as cons_quantity from inv_transaction a,product_details_master b,inv_issue_master c, gbl_temp_engine d where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=8 and c.item_category=1 and a.transaction_type=3 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 and a.prod_id=d.ref_val and d.ref_from=6 and d.entry_form=123 and d.user_id=$user_name  group by a.prod_id,b.lot,b.color,c.received_mrr_no";
			$resultReceive_ret = sql_select($sql_receive_ret);
			
			foreach($resultReceive_ret as $row)
			{
				$ydw_no=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['ydw_no'];
				$recv_job=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['job'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$ydye_rate=$yarn_dyeing_rate_arr[$jobNo][$row[csf('color')]]['rate'];
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rateArr[$row[csf('prod_id')]];;
				if($currency==1) $avg_rate=$ydye_rate/$currency_rate;//Taka
				else $avg_rate=$ydye_rate;	
				
				$ret_amt=$row[csf('cons_quantity')]*$avg_rate;
				if($is_short==2) $receive_ret_arr[$recv_job]['recv_ret_amt']+=$ret_amt; //Main Booking
				else $receive_ret_arr[$recv_job]['cpa_recv_ret_amt']+=$ret_amt;
			}
			unset($resultReceive_ret);

			$aop_amt_array=array();
			$sql_wo_aop="SELECT a.id,a.booking_date,a.currency_id,a.item_category,a.booking_no,a.booking_type,a.is_short,b.po_break_down_id as po_id, (CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.wo_qnty ELSE 0 END) AS wo_qnty, (CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.amount ELSE 0 END) AS amount from wo_booking_mst a,wo_booking_dtls b, gbl_temp_engine c where a.booking_no=b.booking_no  and a.item_category in(2,3,12) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and b.po_break_down_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";

			$result_aop_rate=sql_select( $sql_wo_aop );
			foreach ($result_aop_rate as $row)
			{				
				if($row[csf('item_category')]==12)
				{
					$wo_qnty=$row[csf('wo_qnty')];
					$amount=$row[csf('amount')];
					$avg_wo_aop_rate=$amount/$wo_qnty;
					$aop_prod_array[$row[csf('po_id')]]['aop_rate']=$avg_wo_aop_rate;
					$aop_prod_array[$row[csf('po_id')]]['currency_id']=$row[csf('currency_id')];
					$aop_prod_array[$row[csf('po_id')]]['booking_date']=$row[csf('booking_date')];
					$aop_prod_array[$row[csf('po_id')]]['amount']=$row[csf('amount')];
				}
				else
				{
					$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
					$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
					$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
					$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
					$aop_amt_array[$row[csf('po_id')]]['amount']+=$aop_amt;
				}
			}
			$sql_yarn="SELECT c.id,a.requisition_no,a.receive_basis,a.prod_id,(a.cons_amount) as cons_amount,c.issue_basis,c.issue_number,c.booking_no from inv_transaction a, order_wise_pro_details b, inv_issue_master c, gbl_temp_engine d where  a.id=b.trans_id and  c.id=a.mst_id and c.entry_form in(3) and b.entry_form in(3) and a.transaction_type=2 and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name";
			$result_yarn=sql_select($sql_yarn);
			foreach($result_yarn as $invRow)
			{
				if($invRow[csf('issue_basis')]==1)// Booking
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('booking_no')];
				}
				else if($invRow[csf('issue_basis')]==3)// Requesition
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('requisition_no')];
				}
			}			
			$plan_details_array = return_library_array("select a.dtls_id, a.booking_no as booking_no from ppl_planning_entry_plan_dtls a join GBL_TEMP_ENGINE b on a.po_id=b.ref_val where a.company_id=$company_name and b.ref_from=2 and b.entry_form=123 and b.user_id=$user_name group by a.dtls_id,a.booking_no", "dtls_id", "booking_no");
			$reqs_array = array();
			
			$reqs_sql = sql_select("SELECT a.knit_id, a.requisition_no as reqs_no, sum(a.yarn_qnty) as yarn_req_qnty from ppl_planning_entry_plan_dtls b,ppl_yarn_requisition_entry a, gbl_temp_engine c where b.dtls_id=a.knit_id and b.status_active=1 and b.is_deleted=0 and b.po_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by a.knit_id, a.requisition_no");

			foreach ($reqs_sql as $row)
			{
				$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
			}
			unset($reqs_sql);
		    $yarnissue_retData="SELECT d.booking_no,a.item_category,b.po_breakdown_id, b.prod_id, a.mst_id,a.receive_basis, b.issue_purpose,c.lot,c.color,d.exchange_rate,
			(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.transaction_date ELSE null END) AS transaction_date,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN b.quantity ELSE 0 END) AS yarn_iss_return_qty,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_amount ELSE 0 END) AS order_amount_ret,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_qnty ELSE 0 END) AS order_qnty_ret
			from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_receive_master d, gbl_temp_engine e where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id  and d.id=a.mst_id and a.item_category in(1) and a.transaction_type in(4) and b.entry_form in(9) and d.entry_form in(9) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1  and b.po_breakdown_id=e.ref_val and e.ref_from=2 and e.entry_form=123 and e.user_id=$user_name  group by d.booking_no,b.po_breakdown_id, b.prod_id, a.item_category,a.transaction_date,a.receive_basis,a.mst_id,d.exchange_rate,a.transaction_type,b.entry_form,b.trans_type,b.issue_purpose,c.lot,c.color";
			//echo $yarnissue_retData; die;
			$yarnissueretDataArray=sql_select($yarnissue_retData); $yarnissueRetCostArray=array();
			foreach($yarnissueretDataArray as $invRow)
			{
				$issue_purpose=$invRow[csf('issue_purpose')];
				$receive_basis=$invRow[csf('receive_basis')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				if($receive_basis==1) //Booking Basis
				{
					$booking_no=$invRow[csf('booking_no')];
				}
				
				else if($receive_basis==3) //Requisition Basis
				{
					$booking_req_no=$invRow[csf('booking_no')];
					$prog_no=$reqs_array[$booking_req_no]['knit_id'];
					$booking_no=$plan_details_array[$prog_no];
				}
				$booking_type=$booking_array[$booking_no]['btype'];
				$is_short=$booking_array[$booking_no]['is_short'];
				$returnable_ret_qnty=$invRow[csf('returnable_qnty')];
				$issue_ret_qty=$invRow[csf('yarn_iss_return_qty')];
				$order_qnty_ret=$invRow[csf('order_qnty_ret')];
				$order_amount_ret=$invRow[csf('order_amount_ret')];
				$avg_rate=$order_amount_ret/$order_qnty_ret;
				$transaction_date=$invRow[csf('transaction_date')];
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				$currency_rate=$exchange_rate;
				$currency_id=$receive_curr_array[$invRow[csf('prod_id')]];
				if($receive_array[$invRow[csf('prod_id')]]>0)
				{
					if($currency_id==1) $rate=$receive_array[$invRow[csf('prod_id')]]/$currency_rate;//Taka
					else $rate=$receive_array[$invRow[csf('prod_id')]];	
				}
				else $rate=$avg_rate_array[$invRow[csf('prod_id')]]/$currency_rate;
				
				$iss_ret_amnt=$issue_ret_qty*$rate;
				$retble_iss_ret_amnt=$returnable_ret_qnty*$rate;
				if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
				{
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) //Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else if($issue_purpose==2) //Yarn Dyeing
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
				}
				else //Short Fabric Booking
				{
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) // Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else  if($issue_purpose==2)
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}	
				}
			}
			unset($yarnissueretDataArray);	
			
			$yarnTrimsData="SELECT a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color from inv_transaction a, order_wise_pro_details b,product_details_master c , gbl_temp_engine d where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name";
			//echo $yarnTrimsData; die;
				
			$yarnTrimsDataArray=sql_select($yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
			foreach($yarnTrimsDataArray as $invRow)
			{
				if($invRow[csf('item_category')]==1)
				{
					$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
					$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
					$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['last_exchange_rate'];
					
					if($invRow[csf('receive_basis')]==1)//Booking Basis
					{
						$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
						{
							$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
							$booking_type=1;
						}
						else
						{
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
					}
					else if($invRow[csf('receive_basis')]==3) //Requisition Basis
					{
						$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						
						$prog_no=$reqs_array[$booking_req_no]['knit_id'];
						$booking_no=$plan_details_array[$prog_no];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
					}
					$exchange_rate=$last_exchange_rate;
					$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
					$avgrate=$issue_rate/$exchange_rate;
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($invRow[csf('entry_form')]==3 && $recv_purpose==16)//recv_purpose==16=Grey Yarn
					{
						if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
							{
								$iss_amnt=$invRow[csf('quantity')]*$avgrate;
								$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['yq']+=$invRow[csf('quantity')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_qty_retble']+=$invRow[csf('returnable_qnty')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt_retble']+=$retble_iss_amnt;
							}
						}
						else //Short Fabric Booking
						{
							$iss_amnt=$invRow[csf('quantity')]*$avgrate;
							$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
							
							if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
							{
								/* $yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_qty_retble']+=$returnable_qnty;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt_retble']+=$retble_iss_amnt; */
							}
						}
					}
				}
				else
				{
					$trimsAmt=0;
					$trimsAmt=$invRow[csf('quantity')]*$invRow[csf('cons_rate')];
					$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]][4]+=$trimsAmt;
				}
			}
			unset($yarnTrimsDataArray);

			$usd_arr = array();
			$sqlSelectData = sql_select("select con_date,conversion_rate from currency_conversion_rate where currency=2 and is_deleted=0 order by con_date desc");
			foreach ($sqlSelectData as $row) 
			{
				$usd_arr[date('d-m-Y',strtotime($row[csf('con_date')]))] = $row[csf('conversion_rate')];
			}

			$cpa_yarnTrimsData="SELECT f.issue_number, e.booking_no, a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color, f.issue_date from inv_transaction a, order_wise_pro_details b, product_details_master c, gbl_temp_engine d, wo_booking_dtls e, inv_issue_master f  where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name and e.po_break_down_id=b.po_breakdown_id and e.booking_type=1 and e.is_short=1 and f.id=a.mst_id and f.is_deleted=0 and f.is_deleted=0 and  a.item_category=1 and f.booking_id=e.booking_mst_id group by f.issue_number, e.booking_no, a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color, f.issue_date";

			//echo $cpa_yarnTrimsData; die;
				
			$cpa_yarnTrimsDataArray=sql_select($cpa_yarnTrimsData);  $i=0; //$yarnTrimsCostArray=array();
			foreach($cpa_yarnTrimsDataArray as $invRow)
			{
				$exchangeRate=$usd_arr[date('d-m-Y',strtotime($invRow[csf('issue_date')]))];
				if($exchangeRate =="")
				{
					foreach ($usd_arr as $rate_date => $rat) 
					{
						if(strtotime($rate_date) <= strtotime($invRow[csf('issue_date')]))
						{
							$rate_date = date('d-m-Y',strtotime($rate_date));
							$exchangeRate=$rat;
							break;
						}
					}
				}
				$avgrate=$invRow[csf('cons_rate')]/$exchangeRate;
				$issue_rate_arr[$invRow[csf('mst_id')]]=$avgrate;
				$iss_amnt=$invRow[csf('quantity')]*$avgrate;
				$cpashortfabriccost_arr[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
				$issue_id_arr[$invRow[csf('mst_id')]]=$invRow[csf('mst_id')];
			}
			$DyedYarnData=sql_select("SELECT f.issue_number, e.booking_no, a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color, f.issue_date from inv_transaction a, order_wise_pro_details b, product_details_master c, gbl_temp_engine d, wo_booking_dtls e, inv_issue_master f, wo_yarn_dyeing_mst g  where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name and e.po_break_down_id=b.po_breakdown_id and e.booking_type=1 and e.is_short=1 and f.id=a.mst_id and f.is_deleted=0 and f.is_deleted=0 and  a.item_category=1 and f.booking_id=g.id group by f.issue_number, e.booking_no, a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color, f.issue_date");
			foreach($DyedYarnData as $invRow)
			{

				$exchangeRate=$usd_arr[date('d-m-Y',strtotime($invRow[csf('issue_date')]))];
				if($exchangeRate =="")
				{
					foreach ($usd_arr as $rate_date => $rat) 
					{
						if(strtotime($rate_date) <= strtotime($invRow[csf('issue_date')]))
						{
							$rate_date = date('d-m-Y',strtotime($rate_date));
							$exchangeRate=$rat;
							break;
						}
					}
				}
				$avgrate=$invRow[csf('cons_rate')]/$exchangeRate;
				$issue_rate_arr[$invRow[csf('mst_id')]]=$avgrate;
				$iss_amnt=$invRow[csf('quantity')]*$avgrate;
				$cpashortfabriccost_arr[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
				$issue_id_arr[$invRow[csf('mst_id')]]=$invRow[csf('mst_id')];
			}
			fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 7, $issue_id_arr, $empty_arr);

			$yarn_knitting_rtn=sql_select("SELECT b.cons_quantity, b.issue_id, f.po_breakdown_id from inv_receive_master a, inv_transaction b, inv_issue_master c,product_details_master d, gbl_temp_engine e, order_wise_pro_details f where a.id = b.mst_id and a.issue_id = c.id and b.transaction_type = 4 and b.item_category = 1 and b.prod_id=d.id and a.entry_form = 9 and b.status_active = 1 and b.is_deleted = 0 and a.status_active = 1 and c.id=e.ref_val and e.ref_from=7 and e.entry_form=123 and e.user_id=$user_name and d.id=f.prod_id and f.is_deleted=0 and f.status_active=1 and f.ENTRY_FORM=9  and f.TRANS_TYPE=4 group by b.cons_quantity, b.issue_id, f.po_breakdown_id");
			

			foreach($yarn_knitting_rtn as $invRow)
			{

				$avgrate=$issue_rate_arr[$invRow[csf('issue_id')]];
				$iss_amnt=$invRow[csf('cons_quantity')]*$avgrate;
				$cpashortfabriccost_arr[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_rtn_amt']+=$iss_amnt;
			}
			/* echo '<pre>';
			print_r($cpashortfabriccost_arr); die; */


					
			$sql_garments="SELECT b.po_break_down_id as po_id,b.embel_name,b.production_date,b.production_type,
				(CASE WHEN b.embel_name=1 THEN b.production_quantity ELSE 0 END) AS printing_qty,
				(CASE WHEN b.embel_name=2 THEN b.production_quantity ELSE 0 END) AS embro_qty,
				(CASE WHEN b.embel_name=3 THEN b.production_quantity ELSE 0 END) AS wash_qty,
				(CASE WHEN b.embel_name=5 THEN b.production_quantity ELSE 0 END) AS dyeing_qty
				 from pro_garments_production_mst b, gbl_temp_engine c where  b.production_type=2 and b.is_deleted=0 and b.status_active=1 and b.status_active=1 and b.is_deleted=0  and b.po_break_down_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";
				$result_gar=sql_select( $sql_garments );
				foreach ($result_gar as $row)
				{
					$embl_issue_prod_array[$row[csf('po_id')]]['printing_qty']+=$row[csf('printing_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['embro_qty']+=$row[csf('embro_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['wash_qty']+=$row[csf('wash_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['dyeing_qty']+=$row[csf('dyeing_qty')];
				}
				unset($result_gar);
			
				//print_r($yarnTrimsCostArray);
				$recvIssue_array=array(); 
				$sql_trans="SELECT b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty from inv_transaction a, order_wise_pro_details b, gbl_temp_engine c where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(80,82,81,83,84,13,94) and a.item_category=13 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by b.trans_type, b.po_breakdown_id";
				$result_trans=sql_select( $sql_trans );
				foreach ($result_trans as $row)
				{
					$recvIssue_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_trans);
				
				
				$trims_trans_array=array(); 
				
				$sql_trims_inv="SELECT a.transaction_date, b.order_amount as cons_amount, a.prod_id,b.po_breakdown_id as po_id, b.quantity as qnty,c.exchange_rate, c.currency_id from inv_transaction a, order_wise_pro_details b, inv_receive_master c, gbl_temp_engine d  where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.entry_form in(24) and a.item_category=4 and a.transaction_type in(1) and b.trans_type in(1) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name " ;
				//echo $sql_trims_inv;die;
				$result_trims=sql_select( $sql_trims_inv );
				foreach ($result_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					$currency_id=$row[csf('currency_id')];
					$currency_rate=$row[csf('exchange_rate')];
					if($currency_id==2){
						$usd_rate=$currency_rate;
					}
					
					if($currency_id==1){
						$currency_rate=$usd_rate*$currency_rate;
					}elseif($currency_id==2){
						$currency_rate=$usd_rate;
					}else {
						$currency_rate=$currency_rate;
					}
					$amt=0;
					$amt=$row[csf('cons_amount')];
					$trims_trans_array[$row[csf('po_id')]]['amt']+=$amt;
					
					$last_exchnage_rateArr[$row[csf('prod_id')]]=$row[csf('exchange_rate')];
				}
				unset($result_trims);
				
				$gen_trims_issue_array=array(); 
				 $sql_gen_trims_inv="SELECT b.transaction_date,(b.cons_amount) as cons_amount,b.order_id as po_id,b.prod_id from inv_issue_master  a, inv_transaction b, gbl_temp_engine c where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(21) and b.transaction_type in(2) and b.order_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";
				$result_gen_trims=sql_select( $sql_gen_trims_inv );
				foreach ($result_gen_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					$currency_rate=$last_exchnage_rateArr[$row[csf('prod_id')]];
					$gen_trims_issue_array[$row[csf('po_id')]]['amt']+=$row[csf('cons_amount')]/$currency_rate;
				}
				unset($result_gen_trims);
				//die;
				
				$fin_fab_trans_array=array(); 
				 $sql_fin_trans="SELECT b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty
				  from inv_transaction a, order_wise_pro_details b, gbl_temp_engine c where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15,14) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by b.trans_type, b.po_breakdown_id";
				  //echo $sql_fin_trans; die;
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
					$fin_fab_trans_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				
				$batch_trans_array=array(); 
				$sql_batch="SELECT a.id,a.booking_no,batch_weight as batch_weight from  pro_batch_create_mst a,pro_batch_create_dtls b, gbl_temp_engine c where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and b.po_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by a.id,batch_weight,a.booking_no";
				$result_batch=sql_select( $sql_batch );
				foreach ($result_batch as $row)
				{
					$batch_trans_array[$row[csf('id')]]['book']=$row[csf('booking_no')];
					$batch_weight_array[$row[csf('id')]]['batch_weight']=$row[csf('batch_weight')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_batch);
				
				$dye_fin_fab_array=array(); 
				 $sql_fin_trans="SELECT a.receive_date,a.exchange_rate, b.po_breakdown_id,c.mst_id,c.batch_id,c.body_part_id, sum(b.quantity) as finish_qnty from inv_receive_master a,pro_finish_fabric_rcv_dtls c, order_wise_pro_details b, gbl_temp_engine d where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(7) and a.item_category=2   and b.trans_type in(1) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name group by a.exchange_rate,a.receive_date, b.po_breakdown_id,c.batch_id,c.mst_id,c.body_part_id";
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
					$receive_date=$row[csf('receive_date')];
					$booking_no=$batch_trans_array[$row[csf('batch_id')]]['book'];
					$booking_type=$booking_array[$booking_no]['btype'];
					$is_short=$booking_array[$booking_no]['is_short'];
					$batch_weight=$batch_weight_array[$row[csf('batch_id')]]['batch_weight'];
					$dye_finish_charge=$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
					if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
					{
						
						$finish_qnty=$row[csf('finish_qnty')]*$dye_finish_charge;
					}
					else //short Fab. booking 
					{
						$cpa_batch_weight=$batch_weight*$dye_finish_charge;
					}
					//echo $finish_qnty.'='.$cpa_finish_qnty;
					if($db_type==0)
					{
						$conversion_date=change_date_format($receive_date, "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($receive_date, "d-M-y", "-",1);
					}
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['fin_amt']=$finish_qnty;
					$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['cpa_batch_weight']+=$cpa_batch_weight;
					$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['ex_rate']=$currency_rate;
				}
				unset($result_fin_trans);

				//================================================knitting cost=============================================
	$knit_fin_fab_array=array(); 
      $converson_fab_cost_sql="select b.currency_id,a.bill_no,b.order_id, a.bill_date, b.item_id, b.rate, b.receive_qty, b.amount as amount  from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, gbl_temp_engine c where a.id=b.mst_id and b.order_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name and a.process_id=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  order by b.item_id";
	  //echo $converson_fab_cost_sql; die;


   $con_fab_data=sql_select($converson_fab_cost_sql);
   $usd_id=2;
   foreach($con_fab_data as $row )
   {
		$currency_id=$row[csf('currency_id')];
		$conversion_date=change_date_format($row[csf('bill_date')], "d-M-y", "-",1);
		$currency_rate=set_conversion_rate($usd_id,$conversion_date,$company_name );
		if($currency_id==2) //Usd
		{
		$knit_fin_fab_array[$row[csf('order_id')]]['knit_gross_amt']+=$row[csf('amount')];
		}
		else{
			$knit_fin_fab_array[$row[csf('order_id')]]['knit_gross_amt']+=$row[csf('amount')]/$currency_rate;
		}
   }

   unset($con_fab_data);
   $dye_fin_fab_array=array(); 
    $converson_fab_dye_cost_in_sql="SELECT b.currency_id as currency,a.bill_date,a.discount,b.order_id,b.amount  from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, gbl_temp_engine c where a.id=b.mst_id and b.order_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name and a.process_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  ";
   $con_fab_dye_in_data=sql_select($converson_fab_dye_cost_in_sql);
   foreach($con_fab_dye_in_data as $row )
   {
	$currency_id=$row[csf('currency')];
	$conversion_date=change_date_format($row[csf('bill_date')], "d-M-y", "-",1);
	$currency_rate=set_conversion_rate($usd_id,$conversion_date,$company_name );
	if($currency_id==2) //Usd
	{
		$dye_fin_fab_array[$row[csf('order_id')]]['dye_gross_amt']+=$row[csf('amount')];
		$dye_fin_fab_array[$row[csf('order_id')]]['discount_amt']=$row[csf('discount')];
	}
	else
	{
		$dye_fin_fab_array[$row[csf('order_id')]]['dye_gross_amt']+=$row[csf('amount')]/$currency_rate;
		$dye_fin_fab_array[$row[csf('order_id')]]['discount_amt']=$row[csf('discount')]/$currency_rate;
	}

	
   }
   unset($con_fab_dye_in_data);
    $converson_fab_dye_cost_out_sql="select a.discount,a.bill_no,b.order_id,a.currency_id, a.bill_date, b.item_id, b.rate, b.receive_qty, b.amount as amount  from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, gbl_temp_engine c where a.id=b.mst_id and b.order_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name and a.process_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   order by b.item_id";
   $con_fab_dye_out_data=sql_select($converson_fab_dye_cost_out_sql);
   foreach($con_fab_dye_out_data as $row )
   {
	$currency_id=$row[csf('currency_id')];
	$conversion_date=change_date_format($row[csf('bill_date')], "d-M-y", "-",1);
	$currency_rate=set_conversion_rate($usd_id,$conversion_date,$company_name );
	if($currency_id==2) //Usd
	{
		$dye_fin_fab_array[$row[csf('order_id')]]['dye_gros_amt']+=$row[csf('amount')];
		$dye_fin_fab_array[$row[csf('order_id')]]['discoun_amt']+=$row[csf('discount')];
	}
	else{
		$dye_fin_fab_array[$row[csf('order_id')]]['dye_gros_amt']+=$row[csf('amount')]/$currency_rate;
		$dye_fin_fab_array[$row[csf('order_id')]]['discoun_amt']+=$row[csf('discount')]/$currency_rate;

	}

	
   }
   unset($con_fab_dye_out_data);
   $cm_cost_arr=array(); 
     $cm_cost_sql="select a.amount, a.po_id from wo_actual_cost_entry a join gbl_temp_engine b on a.po_id=b.ref_val where a.cost_head=5 $po_cond_for_in2 and a.status_active=1 and a.is_deleted=0 and b.ref_from=2 and b.entry_form=123 and b.user_id=$user_name ";
   $cm_cost_data=sql_select($cm_cost_sql);
	foreach($cm_cost_data as $row )
	{
		$exchange_rate=$po_exchange_rateArr[$row[csf("po_id")]]['exchange_rate'];

	 $cm_cost_arr[$row[csf('po_id')]]['cm_amt']+=$row[csf('amount')]/$exchange_rate;
	}
	unset($cm_cost_data); 
  
   //======================================================conversion cost end ===================
				
			$grey_fab_array=array();  //Knitting Cost actual 
			$sql_grey_trans="SELECT  a.id,a.exchange_rate,a.currency_id,a.receive_basis,a.booking_no,a.receive_date,b.po_breakdown_id,c.febric_description_id as deter_id,c.body_part_id, c.kniting_charge, (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c, gbl_temp_engine d where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(2,13) and b.trans_type in(1) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name";
			$result_grey=sql_select( $sql_grey_trans );
			$currency_id=1;
			foreach ($result_grey as $row)
			{
					$transaction_date=$row[csf('transaction_date')];
					$receive_basis=$row[csf('receive_basis')];
					$exchange_rate=$row[csf('exchange_rate')];
					$currency_id=$row[csf('currency_id')];
					if($db_type==0)
					{
						$conversion_date=change_date_format($row[csf('receive_date')], "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($row[csf('receive_date')], "d-M-y", "-",1);
					}
					//$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
					$exchange_rate=$exchange_rate;
					if($currency_id==1) //TK
					{
						$knit_charge=$row[csf('kniting_charge')]/$exchange_rate;
						
					}
					else
					{
						$knit_charge=$row[csf('kniting_charge')];
					}
					if($receive_basis==1) //Booking Basis
					{
							$booking_no=$row[csf('booking_no')];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
						//echo $booking_type.'='.$is_short;
					}
					else if($receive_basis==2) //Knit plan Basis
					{
							$prog_no=$grey_knit_array[$row[csf('mst_id')]];
						$booking_no=$plan_details_array[$row[csf('booking_no')]];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
					}
					else if($receive_basis==4) //Salse Basis
					{
							$prog_no=$row[csf('booking_no')];
						$booking_no=$plan_details_array[$prog_no];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
						
					}
					
					if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
					{
						$grey_amt=$row[csf('grey_qnty')]*$knit_charge;
					}

					else //short Fab. booking 
					{
						$cpa_grey_amt=$row[csf('grey_qnty')]*$knit_charge;
					}
					if($db_type==0)
					{
						$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					}
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$currency_rate=$exchange_rate;
				$grey_fab_array[$row[csf('po_breakdown_id')]]['qnty']+=$row[csf('grey_qnty')];
				$grey_fab_array[$row[csf('po_breakdown_id')]]['grey_amt']+=$grey_amt;
				$grey_fab_array[$row[csf('po_breakdown_id')]]['cpa_grey_amt']+=$cpa_grey_amt;
				
			}
			unset($result_grey);
			$sql_gray_fin_purchase="SELECT a.isgreyfab_purchase, b.po_break_down_id, b.amount from wo_booking_mst a join wo_booking_dtls b on a.id=b.booking_mst_id join gbl_temp_engine c on b.po_break_down_id=c.ref_val where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.is_short=2 and a.booking_type=1 and a.fabric_source=2 and a.entry_form=108 and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";
			//echo $sql_gray_fin_purchase; die;
			$dataArrayFinPurchase=sql_select($sql_gray_fin_purchase);
			$grey_purchase_amnt_arr=array();  $finish_purchase_amnt_arr=array();
			foreach($dataArrayFinPurchase as $row)
			{
				if($row[csf('isgreyfab_purchase')]==2){
					$finish_purchase_amnt_arr[$row[csf('po_break_down_id')]]+=$row[csf('amount')];
				}
				else{
					$grey_purchase_amnt_arr[$row[csf('po_break_down_id')]]+=$row[csf('amount')];
				}
				
			}
			
			$actualCostArray=array();
			$actualCostDataArray="select a.cost_head,a.po_id,sum(a.amount_usd) as amount_usd from wo_actual_cost_entry a join gbl_temp_engine b on a.po_id=b.ref_val where a.company_id=$company_name and a.status_active=1 and a.is_deleted=0 and b.ref_from=2 and b.entry_form=123 and b.user_id=$user_name group by a.cost_head,a.po_id";
			$actual_results=sql_select($actualCostDataArray);
			foreach($actual_results as $actualRow)
			{
				$actualCostArray[$actualRow[csf('cost_head')]][$actualRow[csf('po_id')]]=$actualRow[csf('amount_usd')];
			}
			unset($actual_results);

			//////////////=======================booking no==============================

			$booking_sql="select a.booking_no,a.po_break_down_id from wo_booking_dtls a join gbl_temp_engine b on a.po_break_down_id=b.ref_val where b.ref_from=2 and b.entry_form=123 and b.user_id=$user_name and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 group by a.booking_no,a.po_break_down_id";
			//echo $booking_sql; die;
			$booking_data=sql_select($booking_sql);
			foreach( $booking_data as $row ){		
				$booking_number[$row[csf("po_break_down_id")]]['booking']=$row[csf("booking_no")];	
			}
			unset($booking_data); 
			

			///////=========================end  booking no================================
			
			$i=1; $tot_po_qnty=0; $tot_po_value=0; $tot_ex_factory_qnty=0; $tot_ex_factory_val=0; $tot_yarn_cost_mkt=0; $tot_knit_cost_mkt=0; $tot_dye_finish_cost_mkt=0; $tot_yarn_dye_cost_mkt=0; $tot_aop_cost_mkt=0; $tot_trims_cost_mkt=0; $tot_embell_cost_mkt=0; $tot_wash_cost_mkt=0; $tot_commission_cost_mkt=0; $tot_comm_cost_mkt=0; $tot_freight_cost_mkt=0; $tot_test_cost_mkt=0; $tot_inspection_cost_mkt=0; $tot_currier_cost_mkt=0; $tot_cm_cost_mkt=0; $tot_mkt_all_cost=0; $tot_mkt_margin=0; $tot_yarn_cost_actual=0; $tot_knit_cost_actual=0; $tot_dye_finish_cost_actual=0; $tot_yarn_dye_cost_actual=0; $tot_aop_cost_actual=0; $tot_trims_cost_actual=0; $tot_embell_cost_actual=0; $tot_wash_cost_actual=0; $tot_commission_cost_actual=0; $tot_comm_cost_actual=0; $tot_freight_cost_actual=0; $tot_test_cost_actual=0; $tot_inspection_cost_actual=0; $tot_currier_cost_actual=0; $tot_cm_cost_actual=0; $tot_actual_all_cost=0; $tot_actual_margin=0; $tot_fabric_purchase_cost_mkt=$total_fabric_cost_mkt=0; $tot_fabric_purchase_cost_actual=$tot_grey_fab_cost_actual=$tot_actual_net_margin=0;
			$tot_print_amount_mkt=$tot_embro_amount_mkt=$tot_dyeing_amount_mkt=$tot_wash_amount_mkt=$tot_print_amount_actual=$tot_embro_amount_actual=$tot_dyeing_amount_actual=$tot_wash_amount_actual=$tot_finished_fab_cost_actual=$tot_fin_fab_transfer_amt_actual=$tot_yarn_dyeing_twist_actual=$tot_grey_fab_transfer_amt_actual=$tot_yarn_qty_actual=$tot_yarn_amt_actual=$tot_grey_fab_cost_mkt=$tot_yarn_value_addition_cost_mkt=$total_fabric_cost=$tot_fabric_cost_actaul=$tot_yarn_qty_cpa_actual=$total_finish_fabric_cost_mkt=$tot_yarn_qty_cpa_actual=0;
			$buyer_name_array=array();
			$mkt_po_val_array = array(); $mkt_yarn_array = array(); $mkt_knit_array = array(); $mkt_dy_fin_array = array(); $mkt_yarn_dy_array = array();
			$mkt_aop_array = array(); $mkt_trims_array = array(); $mkt_emb_array = array(); $mkt_wash_array=array(); $mkt_commn_array=array(); $mkt_commercial_array=array();
			$mkt_freight_array = array(); $mkt_test_array = array(); $mkt_ins_array = array(); $mkt_courier_array = array(); $mkt_cm_array = array();
			$mkt_total_array = array(); $mkt_margin_array = array(); $mkt_fabric_purchase_array = array();
			
			$ex_factory_val_array= array(); $yarn_cost_array= array(); $knit_cost_array= array(); $dye_cost_array= array(); $yarn_dyeing_cost_array= array();
			$aop_n_others_cost_array= array(); $trims_cost_array= array(); $enbellishment_cost_array= array(); $wash_cost_array= array(); $commission_cost_array= array(); 
			$commercial_cost_array= array(); $freight_cost_array= array(); $testing_cost_array= array(); $inspection_cost_array= array(); $courier_cost_array= array();
			$cm_cost_array= array(); $total_cost_array= array(); $margin_array= array(); $ex_factory_array=array(); $actual_cm_amnt=array(); $actual_fabric_purchase_array = array();
							
				$condition= new condition();
				$condition->company_name("=$company_name");
				if(str_replace("'","",$cbo_buyer_name)>0){
					$condition->buyer_name("=$cbo_buyer_name");
				}
				if(str_replace("'","",$txt_file_no) !=''){
					$condition->file_no("='$txt_file_no'");
				}
				if(str_replace("'","",$txt_ref_no) !=''){
					$condition->grouping("='$txt_ref_no'");
				}
				
				if(str_replace("'","",$txt_job_no) !=''){
					$condition->job_no_prefix_num("=$txt_job_no");
				}
			if(trim(str_replace("'","",$txt_order_no))!='')
				{
				//$condition->po_number(" like '%".trim(str_replace("'","",$txt_order_no))."%'"); 
				$condition->po_number("='".trim(str_replace("'","",$txt_order_no))."'"); 
				}
				if(str_replace("'","",$txt_date_from)!='' && str_replace("'","",$txt_date_to)!='')
				{
					$start_date=str_replace("'","",$txt_date_from);
					$end_date=str_replace("'","",$txt_date_to);
					$condition->pub_shipment_date(" between '$start_date' and '$end_date'");
				}
				if(count($po_id_arr)>0){
					$po_id_str=implode(",",$po_id_arr);
					$condition->po_id_in($po_id_str); 
				}
				
				
				$condition->init();
			
				$yarn= new yarn($condition);
				//echo $yarn->getQuery();die;
				$yarn_costing_arr=$yarn->getOrderWiseYarnAmountArray();
				//$yarn= new yarn($condition);
				$yarn_costing_qty_arr=$yarn->getOrderWiseYarnQtyArray();
				$conversion= new conversion($condition);
				$conversion_costing_arr_process=$conversion->getAmountArray_by_orderAndProcess(); 
				//$conversion= new conversion($condition);
				$conversion_costing_arr_process_qty=$conversion->getQtyArray_by_orderAndProcess();
				$trims= new trims($condition);
				$trims_costing_arr=$trims->getAmountArray_by_order();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name=$emblishment->getAmountArray_by_orderAndEmbname();
				//$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name_qty=$emblishment->getQtyArray_by_orderAndEmbname();
				$commission= new commision($condition);
				$commission_costing_arr=$commission->getAmountArray_by_orderAndItemid();
				$commercial= new commercial($condition);
				$commercial_costing_arr=$commercial->getAmountArray_by_order();
				$other= new other($condition);
				$other_costing_arr=$other->getAmountArray_by_order();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash=$wash->getAmountArray_by_orderAndEmbname();
				$emblishment_costing_arr_name_wash_qty=$wash->getQtyArray_by_orderAndEmbname();
				$fabric= new fabric($condition);
			//echo $fabric->getQuery(); die;
			$fabric_costing_arr=$fabric->getAmountArray_by_order_knitAndwoven_greyAndfinish();
			$usd_id=2;//===============Dollar========
			//print_r($fabric_costing_arr);die;
			$not_yarn_dyed_cost_arr=array(1,2,30,134,35); $job_ids='';
			$tot_certificate_cost_mkt=$tot_deffdlc_cost_mkt=$tot_design_cost_mkt=$tot_studio_cost_mkt=$tot_operating_exp_mkt=$tot_interest_cost_mkt=$tot_incometax_cost_mkt=$tot_depr_amor_pre_cost_mkt=0;
			foreach($result as $row)
			{
				if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				
				$po_ids_array[]=$row[csf('id')];
					$job_ids.=$row[csf('job_no')].',';
				$gmts_item='';
				$gmts_item_id=explode(",",$row[csf('gmts_item_id')]);
				foreach($gmts_item_id as $item_id)
				{
					if($gmts_item=="") $gmts_item=$garments_item[$item_id]; else $gmts_item.=",".$garments_item[$item_id];
				}
				
				$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
				$plan_cut_qnty=$row[csf('plan_cut')]*$row[csf('ratio')];
				$unit_price=$row[csf('unit_price')]/$row[csf('ratio')];
				$po_value=$order_qnty_in_pcs*$unit_price;
				
				$tot_po_qnty+=$order_qnty_in_pcs; 
				$tot_po_value+=$po_value;
				//echo "DDD";die;
				$ex_factory_qty=$ex_factory_arr[$row[csf('id')]];
				$ex_factory_value=$ex_factory_qty*$unit_price;
				
				$tot_ex_factory_qnty+=$ex_factory_qty; 
				$tot_ex_factory_val+=$ex_factory_value; 
				
				$dzn_qnty=0;
				$costing_per_id=$fabriccostArray[$row[csf('job_no')]]['costing_per_id'];
				if($costing_per_id==1) $dzn_qnty=12;
				else if($costing_per_id==3) $dzn_qnty=12*2;
				else if($costing_per_id==4) $dzn_qnty=12*3;
				else if($costing_per_id==5) $dzn_qnty=12*4;
				else $dzn_qnty=1;

				$dzn_qnty=$dzn_qnty*$row[csf('ratio')];
				$yarn_cost_mkt=$yarn_costing_arr[$row[csf('id')]];
					$yarn_cost_mkt_qty=$yarn_costing_qty_arr[$row[csf('id')]];
				$knit_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][1]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['knit_charge'];
				$knit_qty_mkt=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][1]);
				$yarn_dyeing_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][30]);
				//if($yarn_dyeing_cost_mkt) $yarn_dyeing_cost_mkt=$yarn_dyeing_cost_mkt;else $yarn_dyeing_cost_mkt=0;
				$twisting_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][134]);
				//if($twisting_cost_mkt) $twisting_cost_mkt=$twisting_cost_mkt;else $twisting_cost_mkt=0;
				$yarn_value_addition_cost_mkt=$yarn_dyeing_cost_mkt+$twisting_cost_mkt;
				//echo $yarn_dyeing_cost_mkt.'=='.$twisting_cost_mkt.', ';
				
				if($knit_cost_mkt>0)
				{
				$knit_charge_mkt=$knit_cost_mkt/$knit_qty_mkt;//$dye_finish_cost_mkt_qty
				}
				
				$dye_finish_cost_mkt=0;$dye_finish_cost_mkt_qty=0;
				foreach($conversion_cost_head_array as $process_id=>$val)
				{
					if(!in_array($process_id,$not_yarn_dyed_cost_arr))
					{
						$dye_finish_cost_mkt+=array_sum($conversion_costing_arr_process[$row[csf('id')]][$process_id]);
						
						$dye_finish_cost_mkt_qty+=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][$process_id]);
					}
				}	
				if($dye_finish_cost_mkt>0)
				{			
				$knit_charge_mkt_fin=$dye_finish_cost_mkt/$dye_finish_cost_mkt_qty;
				}
				$aop_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][35]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['aop_charge'];
				$trims_cost_mkt=$trims_costing_arr[$row[csf('id')]];//($order_qnty_in_pcs/$dzn_qnty)*$trimsCostArray[$row[csf('id')]];
			
				
				$print_amount=$emblishment_costing_arr_name[$row[csf('id')]][1];
				$print_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][1];
				if($print_amount) $print_amount=$print_amount;else $print_amount=0;
				if($print_qty) $print_qty=$print_qty;else $print_qty=0;
				if($print_amount==0 || $print_qty==0) $print_avg_rate=0;
				else $print_avg_rate=$print_amount/$print_qty;
					
				$embroidery_amount=$emblishment_costing_arr_name[$row[csf('id')]][2];
				$embroidery_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][2];
				if($embroidery_amount) $embroidery_amount=$embroidery_amount;else $embroidery_amount=0;
				if($embroidery_qty) $embroidery_qty=$embroidery_qty;else $embroidery_qty=0;
				if($embroidery_amount==0 || $embroidery_qty==0) $embro_avg_rate=0;
				else $embro_avg_rate=$embroidery_amount/$embroidery_qty;
				//$special_amount=$emblishment_costing_arr_name[$row[csf('id')]][4];
				$wash_cost=$emblishment_costing_arr_name_wash[$row[csf('id')]][3];
				$wash_qty=$emblishment_costing_arr_name_wash_qty[$row[csf('id')]][3];
				if($wash_cost) $wash_cost=$wash_cost;else $wash_cost=0;
				if($wash_qty) $wash_qty=$wash_qty;else $wash_qty=0;
				if($wash_cost==0 || $wash_qty==0) $wash_avg_rate=0;
				else $wash_avg_rate=$wash_cost/$wash_qty;
				
				$other_amount=$emblishment_costing_arr_name[$row[csf('id')]][5];
				$dyeing_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][5];
				if($other_amount) $other_amount=$other_amount;else $other_amount=0;
				if($dyeing_qty) $dyeing_qty=$dyeing_qty;else $dyeing_qty=0;
				if($other_amount==0 || $dyeing_qty==0) $dyeing_avg_rate=0;
				else $dyeing_avg_rate=$other_amount/$dyeing_qty;
				
				$foreign_cost=$commission_costing_arr[$row[csf('id')]][1];
				$local_cost=$commission_costing_arr[$row[csf('id')]][2];
				
				$test_cost=$other_costing_arr[$row[csf('id')]]['lab_test'];
				$freight_cost=$other_costing_arr[$row[csf('id')]]['freight'];
				$inspection_cost=$other_costing_arr[$row[csf('id')]]['inspection'];
			
				$certificate_cost_mkt=$other_costing_arr[$row[csf('id')]]['certificate_pre_cost'];
				$deffdlc_cost_mkt=$other_costing_arr[$row[csf('id')]]['deffdlc_cost'];
				$design_cost_mkt=$other_costing_arr[$row[csf('id')]]['design_cost'];
				$studio_cost_mkt=$other_costing_arr[$row[csf('id')]]['studio_cost'];
				$operating_exp_mkt=$other_costing_arr[$row[csf('id')]]['common_oh'];
				$interest_cost_mkt=$other_costing_arr[$row[csf('id')]]['interest_cost'];
				$incometax_cost_mkt=$other_costing_arr[$row[csf('id')]]['incometax_cost'];
				$depr_amor_pre_cost_mkt=$other_costing_arr[$row[csf('id')]]['depr_amor_pre_cost'];
				
				
				//$common_oh_cost=$other_costing_arr[$row[csf('id')]]['common_oh'];
				$currier_cost=$other_costing_arr[$row[csf('id')]]['currier_pre_cost'];
				$cm_cost=$other_costing_arr[$row[csf('id')]]['cm_cost'];
				$embell_cost_mkt=$print_amount+$embroidery_amount+$wash_cost+$other_amount;
				
				$wash_cost_mkt=$wash_cost;
				$commission_cost_mkt=$foreign_cost+$local_cost;
				$comm_cost_mkt=$commercial_costing_arr[$row[csf('id')]];
				$freight_cost_mkt=$freight_cost;
				$test_cost_mkt=$test_cost;
				$inspection_cost_mkt=$inspection_cost;
				$currier_cost_mkt=$currier_cost;
				$cm_cost_mkt=$cm_cost;
					//echo "MM";die;
				
				$fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['grey'][$row[csf('id')]]);
				//+array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
				$fabric_purchase_cost2=array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
				$fabric_purchase_cost_mkt=$fabric_purchase_cost+$fabric_purchase_cost2;
				$finish_fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
				$finish_fabric_purchase_cost_mkt=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
				$grey_fab_cost_mkt=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt;
				$mkt_all_cost=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt+$trims_cost_mkt+$embell_cost_mkt+$wash_cost_mkt+$commission_cost_mkt+$comm_cost_mkt+$freight_cost_mkt+$test_cost_mkt+$inspection_cost_mkt+$currier_cost_mkt+$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt+$cm_cost_mkt+$fabric_purchase_cost_mkt;
				
				$mkt_margin=$po_value-$mkt_all_cost;
				$mkt_margin_perc=($mkt_margin/$po_value)*100;
				$tot_finish_fabric_cost_mkt=$grey_fab_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt;
				$grey_prod_ex_rate=$grey_fab_array[$row[csf('id')]]['ex_rate'];
				$dye_fin_ex_rate=$dye_fin_fab_array[$row[csf('id')]]['ex_rate'];
				if($process_costing==1)
				{
					$grey_prod_cost=$knit_fin_fab_array[$row[csf('id')]]['knit_gross_amt'];
				}
				else
				{
					$grey_prod_cost=$knit_fin_fab_array[$row[csf('id')]]['knit_gross_amt'];
				}
				// echo $row[csf('id')].'d';
				$knit_cost_actual=$grey_prod_cost;
				
				$cpa_grey_prod_cost=$grey_fab_array[$row[csf('id')]]['cpa_grey_amt'];
				$cpa_knit_cost_actual=$cpa_grey_prod_cost;
				// echo $dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'].'/'.$knit_charge_mkt_fin.'=='.$dye_fin_ex_rate.', ';
				$cpa_dye_fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'];
					$cpa_dye_finish_cost_actual=$cpa_dye_fin_fab_prod_cost;
				
				//$fin_fab_prod_cost=$grey_used_arr[$row[csf('id')]]['grey_used_amt']+$fin_grey_used_arr[$row[csf('id')]]['grey_used_amt'];//$dye_fin_fab_array[$row[csf('id')]]['fin_amt'];
				if($dye_fin_fab_array[$row[csf('id')]]['discount_amt']>0){
					$fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['dye_gross_amt']-$dye_fin_fab_array[$row[csf('id')]]['discount_amt'];
				}else{
					$fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['dye_gross_amt'];
				}
				
				
				$cm_amt_cost= $cm_cost_arr[$row[csf('id')]]['cm_amt'];
				$booking=$booking_number[$row[csf("id")]]['booking'];
				$dye_finish_cost_actual=$fin_fab_prod_cost;
				
				$cpa_recv_ret_amt=$receive_ret_arr[$row[csf('job_no')]]['cpa_recv_ret_amt'];
				$cpa_yarn_recv_amt_bal=$yarn_receive_amount_arr[$row[csf('job_no')]]['cpa_order_amount_recv']-$cpa_recv_ret_amt;
				if($cpa_yarn_recv_amt_bal==0) $cpa_yarn_recv_amt_bal_actual=0;
				else $cpa_yarn_recv_amt_bal_actual=($cpa_yarn_recv_amt_bal/$job_quantity)*$order_qnty_in_pcs;
				
				//$yarn_cost_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt']+$cpa_yarn_recv_amt_bal_actual+$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt']+$cpa_knit_cost_actual+$cpa_dye_finish_cost_actual-($yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_yarn_ret_amt']+$yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_ret_amt']);
				$yarn_cost_cpa_actual=$cpashortfabriccost_arr[$row[csf('id')]]['cpa_grey_yarn_amt']-$cpashortfabriccost_arr[$row[csf('id')]]['cpa_grey_yarn_rtn_amt'];

				$yarn_ret_qty_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_qty_retble'];
				$yarn_ret_amt_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt_retble'];
				$tot_yarn_qty_cpa_actual+=$yarn_cost_cpa_actual;
				$yarn_cost_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt']-$yarnissueRetCostArray[$row[csf('id')]]['grey_yarn_ret_amt'];
				$yarn_ret_qty_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_qty_retble'];
				$yarn_ret_amt_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt_retble'];
				$tot_yarn_qty_actual+=$yarn_ret_qty_actual;
				$tot_yarn_amt_actual+=$yarn_ret_amt_actual;
				$job_quantity=$job_arr2[$row[csf("job_no")]]['job_quantity'];
				
				$order_amount_recv=$yarn_receive_amount_arr[$row[csf('job_no')]]['order_amount_recv'];
				$order_amount_recv_ret=$receive_ret_arr[$row[csf('job_no')]]['recv_ret_amt'];
				
				$order_amount_recv_bal=$order_amount_recv-$order_amount_recv_ret;
				$avg_recv_amount_actual=($order_amount_recv_bal/$job_quantity)*$order_qnty_in_pcs;

				$yarn_dyeing_twist_actual=$avg_recv_amount_actual;//-$yarnissueRetCostArray[$row[csf('id')]]['grey_dyeing_twist_ret_amt'];
				
				
				$trans_in_amt=$recvIssue_array[$row[csf('id')]][5];
				$trans_out_amt=$recvIssue_array[$row[csf('id')]][6];
				
				$fin_trans_in_amt=$fin_fab_trans_array[$row[csf('id')]][5];
				$fin_trans_out_amt=$fin_fab_trans_array[$row[csf('id')]][6];
				
				$grey_fab_transfer=$trans_in_amt-$trans_out_amt;
				$grey_fab_transfer_amt_actual=$grey_fab_transfer*$knit_charge_mkt;
				
				$fin_fab_transfer=$fin_trans_in_amt-$fin_trans_out_amt;
				$fin_fab_transfer_amt_actual=$fin_fab_transfer*$knit_charge_mkt_fin;
				
				$trims_amount=$trims_trans_array[$row[csf('id')]]['amt'];
				$gen_trims_issue_amt=$gen_trims_issue_array[$row[csf('id')]]['amt'];
				$trims_cost_actual=$trims_amount+$gen_trims_issue_amt;
				$yarn_dye_cost_actual=0;
				$aop_prod_amt=$aop_prod_array[$row[csf('id')]]['amount'];
				$aop_cost_actual=$aop_prod_amt;
				$embell_cost_actual=$embellCostArray[$row[csf('id')]];
				$wash_cost_actual=$washCostArray[$row[csf('id')]];
				
				//Finished Fabric Cost
				
				
				$printing_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['printing_qty']/$dzn_qnty)*$print_avg_rate;
				//echo $embl_issue_prod_array[$row[csf('id')]]['printing_qty'].'*'.$print_avg_rate;
				$embro_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['embro_qty']/$dzn_qnty)*$embro_avg_rate;
				$dyeing_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['dyeing_qty']/$dzn_qnty)*$dyeing_avg_rate;
				$wash_cost_actual=($embl_issue_prod_array[$row[csf('id')]]['wash_qty']/$dzn_qnty)*$wash_avg_rate;
				
				$commission_cost_actual=($ex_factory_qty/$dzn_qnty)*$fabriccostArray[$row[csf('job_no')]]['commission'];
				$comm_cost_actual=$actualCostArray[6][$row[csf('id')]];
				$freight_cost_actual=$actualCostArray[2][$row[csf('id')]];
				$test_cost_actual=$actualCostArray[1][$row[csf('id')]];
				$inspection_cost_actual=$actualCostArray[3][$row[csf('id')]];
				$currier_cost_actual=$actualCostArray[4][$row[csf('id')]];
				
				$working_hour=$prod_resource_array[$row[csf('id')]]['working_hour'];
				$operator_helper=$prod_resource_array[$row[csf('id')]]['operator_helper'];
				$extra_working_hour=$adj_resource_array[$row[csf('style_ref_no')]]['working_hour'];
				$extra_number_of_emp=$adj_resource_array[$row[csf('style_ref_no')]]['number_of_emp'];
				$tot_number_of_employee=$operator_helper+$extra_number_of_emp;
				$tot_working_hr=$working_hour+$extra_working_hour;
				$prod_date=$prod_resource_array[$row[csf('id')]]['pr_date']; 
				$from_cpm_date=date("Y-m",strtotime(($prod_date)));
				$cpm=$lib_cpm_array[$from_cpm_date]['cpm'];
				//$exchange_rate=set_conversion_rate($usd_id,$prod_date );
				$exchange_rate=$prod_resource_array[$row[csf('id')]]['ex_rate'];
			
				$cm_cost_actual=$cm_amt_cost;
				//echo $working_hour.'='.$extra_number_of_emp.'ds';
				//$cm_cost_actual=($tot_working_hr*60*$tot_number_of_employee*$cpm)/$exchange_rate;
				
				$fabric_purchase_cost_actual=$finish_purchase_amnt_arr[$row[csf('id')]];
				$grey_fabric_purchase_cost_actual=$grey_purchase_amnt_arr[$row[csf('id')]];
				$grey_fab_cost_actual=$grey_fab_transfer_amt_actual;
				$finished_fab_cost_actual=$grey_fab_cost_actual+$dye_finish_cost_actual+$aop_cost_actual+$fin_fab_transfer_amt_actual;
				$tot_fabric_cost_act=$fabric_purchase_cost_actual+$finished_fab_cost_actual;
				$tot_fabric_cost_actaul+=$tot_fabric_cost_act;
				$actual_all_cost=$yarn_cost_actual+$knit_cost_actual+$yarn_dyeing_twist_actual+$grey_fab_transfer_amt_actual+$dye_finish_cost_actual+$yarn_dye_cost_actual+$aop_cost_actual+$trims_cost_actual+$printing_cost_actual+$embro_cost_actual+$dyeing_cost_actual+$wash_cost_actual+$commission_cost_actual+$comm_cost_actual+$freight_cost_actual+$test_cost_actual+$inspection_cost_actual+$currier_cost_actual+$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt+$cm_cost_actual+$fabric_purchase_cost_actual+$grey_fabric_purchase_cost_actual;
				
				$actual_margin=$ex_factory_value-$actual_all_cost;
				$actual_margin_perc=($actual_margin/$ex_factory_value)*100;
				$tot_fabric_cost_mkt=$tot_finish_fabric_cost_mkt+$fabric_purchase_cost_mkt;
				$tot_yarn_cost_mkt+=$yarn_cost_mkt;
				$tot_yarn_value_addition_cost_mkt+=$yarn_value_addition_cost_mkt;
				$tot_grey_fab_cost_mkt+=$grey_fab_cost_mkt; 
				$tot_knit_cost_mkt+=$knit_cost_mkt; 
				$tot_dye_finish_cost_mkt+=$dye_finish_cost_mkt; 
				//$tot_yarn_dye_cost_mkt+=$yarn_dye_cost_mkt; 
				$tot_aop_cost_mkt+=$aop_cost_mkt; 
				$total_fabric_cost_mkt+=$tot_fabric_cost_mkt;
				$tot_trims_cost_mkt+=$trims_cost_mkt;
					$total_finish_fabric_cost_mkt+=$tot_finish_fabric_cost_mkt;
				$tot_print_amount_mkt+=$print_amount; 
				$tot_embro_amount_mkt+=$embroidery_amount; 
				$tot_dyeing_amount_mkt+=$other_amount; 
				$tot_wash_amount_mkt+=$wash_cost; 
				
				$tot_embell_cost_mkt+=$embell_cost_mkt; 
				$tot_wash_cost_mkt+=$wash_cost_mkt; 
				$tot_commission_cost_mkt+=$commission_cost_mkt; 
				$tot_comm_cost_mkt+=$comm_cost_mkt; 
				$tot_freight_cost_mkt+=$freight_cost_mkt; 
				$tot_test_cost_mkt+=$test_cost_mkt; 
				$tot_inspection_cost_mkt+=$inspection_cost_mkt; 
				$tot_currier_cost_mkt+=$currier_cost_mkt; 
				//$tot_certificate_cost_mkt=$tot_deffdlc_cost_mkt=$tot_design_cost_mkt=$tot_studio_cost_mkt=$tot_operating_exp_mkt=$tot_interest_cost_mkt=$tot_incometax_cost_mkt=$tot_depr_amor_pre_cost_mkt=0;
				$tot_certificate_cost_mkt+=$certificate_cost_mkt; 
				$tot_deffdlc_cost_mkt+=$deffdlc_cost_mkt; 
				$tot_design_cost_mkt+=$design_cost_mkt; 
				$tot_studio_cost_mkt+=$studio_cost_mkt; 
				$tot_operating_exp_mkt+=$operating_exp_mkt; 
				$tot_interest_cost_mkt+=$interest_cost_mkt; 
				$tot_incometax_cost_mkt+=$incometax_cost_mkt; 
				$tot_depr_amor_pre_cost_mkt+=$depr_amor_pre_cost_mkt; 
				
				
				//$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt
				
				$tot_cm_cost_mkt+=$cm_cost_mkt; 
				$tot_mkt_all_cost+=$mkt_all_cost; 
				$tot_mkt_margin+=$mkt_margin; 
				$tot_yarn_cost_actual+=$yarn_cost_actual; 
				$tot_yarn_dyeing_twist_actual+=$yarn_dyeing_twist_actual; 
				$tot_knit_cost_actual+=$knit_cost_actual; 
				$tot_dye_finish_cost_actual+=$dye_finish_cost_actual;
				$tot_yarn_dye_cost_actual+=$yarn_dye_cost_actual; 
				$tot_aop_cost_actual+=$aop_cost_actual; 
				$tot_trims_cost_actual+=$trims_cost_actual; 
				$tot_grey_fab_cost_actual+=$grey_fab_cost_actual; 
				$tot_grey_fab_transfer_amt_actual+=$grey_fab_transfer_amt_actual; 
				$tot_print_amount_actual+=$printing_cost_actual; 
				$tot_embro_amount_actual+=$embro_cost_actual; 
				$tot_dyeing_amount_actual+=$dyeing_cost_actual; 
				$tot_wash_amount_actual+=$wash_cost_actual; 
				$tot_finished_fab_cost_actual+=$finished_fab_cost_actual;
				$tot_fin_fab_transfer_amt_actual+=$fin_fab_transfer_amt_actual;
				$tot_embell_cost_actual+=$embell_cost_actual;
				$tot_wash_cost_actual+=$wash_cost_actual; 
				$tot_commission_cost_actual+=$commission_cost_actual; 
				$tot_comm_cost_actual+=$comm_cost_actual; 
				$tot_freight_cost_actual+=$freight_cost_actual; 
				$tot_test_cost_actual+=$test_cost_actual; 
				$tot_inspection_cost_actual+=$inspection_cost_actual; 
				$tot_currier_cost_actual+=$currier_cost_actual; 
				
				$tot_certificate_cost_actual+=$certificate_cost_mkt; 
				$tot_deffdlc_cost_actual+=$deffdlc_cost_mkt; 
				$tot_design_cost_actual+=$design_cost_mkt; 
				$tot_studio_cost_actual+=$studio_cost_mkt; 
				$tot_operating_exp_actual+=$operating_exp_mkt; 
				$tot_interest_cost_actual+=$interest_cost_mkt; 
				$tot_incometax_cost_actual+=$incometax_cost_mkt; 
				$tot_depr_amor_pre_cost_actual+=$depr_amor_pre_cost_mkt; 
				
				$tot_cm_cost_actual+=$cm_cost_actual; 
				$tot_actual_all_cost+=$actual_all_cost; 
				$tot_actual_margin+=$actual_margin;
				$tot_actual_net_margin+=$actual_margin-$yarn_cost_cpa_actual; 
				
				$tot_fabric_purchase_cost_mkt+=$fabric_purchase_cost_mkt;
				$tot_fabric_purchase_cost_actual+=$fabric_purchase_cost_actual;
				$tot_grey_fabric_purchase_cost_actual+=$grey_fabric_purchase_cost_actual;
				
				$buyer_name_array[$row[csf('buyer_name')]]=$buyer_arr[$row[csf('buyer_name')]];
				$mkt_po_val_array[$row[csf('buyer_name')]]+=$po_value;
				$mkt_yarn_array[$row[csf('buyer_name')]]+=$yarn_cost_mkt;
				
				$mkt_knit_array[$row[csf('buyer_name')]]+=$knit_cost_mkt;
				$mkt_yarn_value_addition_array[$row[csf('buyer_name')]]+=$yarn_value_addition_cost_mkt;
				$mkt_dy_fin_array[$row[csf('buyer_name')]]+=$dye_finish_cost_mkt;
				$mkt_grey_fab_cost_array[$row[csf('buyer_name')]]+=$grey_fab_cost_mkt;
				$mkt_aop_array[$row[csf('buyer_name')]]+=$aop_cost_mkt;
				$mkt_trims_array[$row[csf('buyer_name')]]+=$trims_cost_mkt;
				$mkt_print_array[$row[csf('buyer_name')]]+=$print_amount;
				$mkt_embro_array[$row[csf('buyer_name')]]+=$embroidery_amount;
				$mkt_dyeing_array[$row[csf('buyer_name')]]+=$other_amount;
				//$mkt_wash_array[$row[csf('buyer_name')]]+=$wash_cost;
				
				$mkt_emb_array[$row[csf('buyer_name')]]+=$embell_cost_mkt;
				$mkt_wash_array[$row[csf('buyer_name')]]+=$wash_cost_mkt;
				$mkt_commn_array[$row[csf('buyer_name')]]+=$commission_cost_mkt;
				$mkt_commercial_array[$row[csf('buyer_name')]]+=$comm_cost_mkt;
				$mkt_freight_array[$row[csf('buyer_name')]]+=$freight_cost_mkt;
				$mkt_test_array[$row[csf('buyer_name')]]+=$test_cost_mkt;
				$mkt_ins_array[$row[csf('buyer_name')]]+=$inspection_cost_mkt;
				$mkt_courier_array[$row[csf('buyer_name')]]+=$currier_cost_mkt;
				
				$mkt_certificate_array[$row[csf('buyer_name')]]+=$certificate_cost_mkt;
				$mkt_deffdlc_array[$row[csf('buyer_name')]]+=$deffdlc_cost_mkt;
				$mkt_design_array[$row[csf('buyer_name')]]+=$design_cost_mkt;
				$mkt_studio_array[$row[csf('buyer_name')]]+=$studio_cost_mkt;
				$mkt_operating_array[$row[csf('buyer_name')]]+=$operating_exp_mkt;
				$mkt_interest_array[$row[csf('buyer_name')]]+=$interest_cost_mkt;
				$mkt_incometax_array[$row[csf('buyer_name')]]+=$incometax_cost_mkt;
				$mkt_depr_amor_array[$row[csf('buyer_name')]]+=$depr_amor_pre_cost_mkt;
					
				
				$mkt_cm_array[$row[csf('buyer_name')]]+=$cm_cost_mkt;
				$mkt_total_array[$row[csf('buyer_name')]]+=$mkt_all_cost;
				$mkt_margin_array[$row[csf('buyer_name')]]+=$mkt_margin;
				$mkt_fabric_purchase_array[$row[csf('buyer_name')]]+=$fabric_purchase_cost_mkt;
				$mkt_fin_fabric_purchase_array[$row[csf('buyer_name')]]+=$finish_fabric_purchase_cost_mkt;
					
				$ex_factory_val_array[$row[csf('buyer_name')]]+=$ex_factory_value;
				$yarn_cost_array[$row[csf('buyer_name')]]+=$yarn_cost_actual;
				$yarn_dyeing_twist_array[$row[csf('buyer_name')]]+=$yarn_dyeing_twist_actual;
				$knit_cost_array[$row[csf('buyer_name')]]+=$knit_cost_actual;
				$dye_cost_array[$row[csf('buyer_name')]]+=$dye_finish_cost_actual;
				$grey_fab_cost_array[$row[csf('buyer_name')]]+=$grey_fab_cost_actual;
				$fin_fab_transfer_amt_actual_array[$row[csf('buyer_name')]]+=$fin_fab_transfer_amt_actual;
				$finished_fab_cost_actual_array[$row[csf('buyer_name')]]+=$finished_fab_cost_actual;
			
				$aop_n_others_cost_array[$row[csf('buyer_name')]]+=$aop_cost_actual;
				$trims_cost_array[$row[csf('buyer_name')]]+=$trims_cost_actual;
				
				$print_act_cost_array[$row[csf('buyer_name')]]+=$printing_cost_actual;
				$embro_act_cost_array[$row[csf('buyer_name')]]+=$embro_cost_actual;
				$dyeing_act_cost_array[$row[csf('buyer_name')]]+=$dyeing_cost_actual;
				$wash_act_cost_array[$row[csf('buyer_name')]]+=$wash_cost_actual;
				
				$enbellishment_cost_array[$row[csf('buyer_name')]]+=$embell_cost_actual;
				$wash_cost_array[$row[csf('buyer_name')]]+=$wash_cost_actual;
				$commission_cost_array[$row[csf('buyer_name')]]+=$commission_cost_actual;
				$commercial_cost_array[$row[csf('buyer_name')]]+=$comm_cost_actual;
				$freight_cost_array[$row[csf('buyer_name')]]+=$freight_cost_actual;
				$testing_cost_array[$row[csf('buyer_name')]]+=$test_cost_actual;
				$inspection_cost_array[$row[csf('buyer_name')]]+=$inspection_cost_actual;
				$courier_cost_array[$row[csf('buyer_name')]]+=$currier_cost_actual;
				
				$acl_certificate_array[$row[csf('buyer_name')]]+=$certificate_cost_mkt;
				$acl_deffdlc_array[$row[csf('buyer_name')]]+=$deffdlc_cost_mkt;
				$acl_design_array[$row[csf('buyer_name')]]+=$design_cost_mkt;
				$acl_studio_array[$row[csf('buyer_name')]]+=$studio_cost_mkt;
				$acl_operating_array[$row[csf('buyer_name')]]+=$operating_exp_mkt;
				$acl_interest_array[$row[csf('buyer_name')]]+=$interest_cost_mkt;
				$acl_incometax_array[$row[csf('buyer_name')]]+=$incometax_cost_mkt;
				$acl_depr_amor_array[$row[csf('buyer_name')]]+=$depr_amor_pre_cost_mkt;
				
				
				
				$cm_cost_array[$row[csf('buyer_name')]]+=$cm_cost_actual;
				$total_cost_array[$row[csf('buyer_name')]]+=$actual_all_cost;
				$margin_array[$row[csf('buyer_name')]]+=$actual_margin;
				$actual_fabric_purchase_array[$row[csf('buyer_name')]]+=$fabric_purchase_cost_actual;
				$actual_grey_fabric_purchase_array[$row[csf('buyer_name')]]+=$grey_fabric_purchase_cost_actual;
				
				
					
					
				//$prod_resource_array[$val[csf('po_id')]]['pr_date']=$val[csf('pr_date')]
				$button_po="<a href='#' onClick=\"generate_po_report('".$company_name."','".$row[csf('id')]."','".$row[csf('job_no')]."','show_po_detail_report','1')\" '> ".$row[csf('po_number')]."<a/>";
				
				?>
				<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">
					<td width="40" rowspan="4"><? echo $i; ?></td>
					<td width="70" rowspan="4"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
					<td width="60" align="center" rowspan="4"><? echo $row[csf('year')]; ?></td>
					<td width="70" align="center" rowspan="4"><? echo $row[csf('job_no_prefix_num')]; ?></td>
					<td width="100"  align="center" rowspan="4" style="word-break:break-all;"><? echo  $row[csf('po_number')];//$button_po; ?></td>
					<td width="100"  align="center" rowspan="4" style="word-break:break-all;"><? echo  $booking;//$button_po; ?></td>
					<td width="70"  align="center" rowspan="4" style="word-break:break-all;"><? echo $row[csf('file_no')]; ?></td>
					<td width="80"  align="center" rowspan="4" style="word-break:break-all;"><? echo $row[csf('grouping')]; ?></td>
					<td width="110"  align="center" rowspan="4" style="word-break:break-all;"><? echo $row[csf('style_ref_no')]; ?></td>
					<td width="120"  align="center" rowspan="4" style="word-break:break-all;"><? echo $gmts_item; ?></td>
					<td width="90" align="right"  rowspan="4"><? echo $order_qnty_in_pcs; ?></td>
					<td width="50" align="center" rowspan="4"><? echo $unit_of_measurement[$row[csf('order_uom')]]; ?></td>
					<td width="70" align="right"  rowspan="4"><? echo fn_number_format($unit_price,2,'.',''); ?></td>
					<td width="110" align="right"  rowspan="4"><? echo fn_number_format($po_value,2,'.',''); ?></td>
					<td width="100" align="right"  rowspan="4"><? echo fn_number_format($row[csf('set_smv')],2,'.',''); ?></td>
					<td width="80" align="center" rowspan="4"><? echo change_date_format($row[csf('pub_shipment_date')]); ?></td>
					<td width="100" rowspan="4" style="word-break:break-all;"><? echo $shipment_status[$row[csf('shiping_status')]]; ?></td>
					<td width="100" align="left"><b>Pre Costing</b></td>
					<td width="100" align="right" ><? echo fn_number_format($order_qnty_in_pcs,0,'.',''); ?></td>
					<td width="110" align="right" ><? echo fn_number_format($po_value,2,'.',''); ?></td>
					<td width="110"  align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $row[csf('id')]."**".$row[csf('job_no')]; ?>','mkt_yarn_cost','Grey Yarn Mkt. Cost Details')"><? echo fn_number_format($yarn_cost_mkt,2); //$tot_yarn_qty_actual?></a><? //echo  fn_number_format($yarn_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Yarn Value Addition Cost=Yarn Dyeing & Twisting"  align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $row[csf('id')]."**".$row[csf('job_no')]; ?>','mkt_yarn_dyeing_twisting_cost','Yarn Dyeing & Twisting Cost Details')"><? echo fn_number_format($yarn_value_addition_cost_mkt,2); ?></a><? //echo fn_number_format($yarn_value_addition_cost_mkt,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($knit_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Grey Fabric Transfer Cost"  align="right"><? //echo fn_number_format($knit_cost_mkt,2,'.',''); ?></td>
					
					<td width="100" title="Tot Grey Fabric Cost"  align="right"><? echo fn_number_format($grey_fab_cost_mkt,2,'.',''); ?></td>
					<td width="110" title="Without Conv. Process Name: -Knitting,Twisting,All Over Printing,Yarn Dyeing,Weaving"  align="right"><? echo fn_number_format($dye_finish_cost_mkt,2,'.',''); ?></td>
					
					<td width="110"  align="right"><? echo fn_number_format($aop_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($aop_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Fabric Purchase Cost"  align="right"><? echo fn_number_format($finish_fabric_purchase_cost_mkt,2,'.',''); ?></td>
						<td width="110"  align="right"><? echo fn_number_format($fabric_purchase_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($tot_finish_fabric_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><?
					
						echo fn_number_format($tot_fabric_cost_mkt,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($trims_cost_mkt,2,'.',''); ?></td>
						<td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($print_amount,2,'.',''); ?></td>
						<td width="100"  align="right"><? echo fn_number_format($embroidery_amount,2,'.',''); ?></td>
						<td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($other_amount,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($wash_cost,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? echo fn_number_format($commission_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($comm_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($freight_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($test_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($inspection_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($currier_cost_mkt,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? echo fn_number_format($certificate_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($deffdlc_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($design_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($studio_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($operating_exp_mkt,2,'.',''); ?></td>
					
					
					
					
					<td width="100"  align="right"><? echo fn_number_format($cm_cost_mkt,2,'.',''); ?></td>
					
						<td width="100"  align="right"><? echo fn_number_format($interest_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($incometax_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($depr_amor_pre_cost_mkt,2,'.',''); ?></td>
					
					
					
					<td width="100"  align="right"><? echo fn_number_format($mkt_all_cost,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($mkt_margin,2,'.',''); ?></td>
					<td  width="100"  align="right"><? echo fn_number_format($mkt_margin_perc,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($mkt_margin,2,'.',''); ?></td>
					<td  align="right"><? //echo fn_number_format($mkt_margin,2,'.',''); ?></td>
				</tr>
				<tr bgcolor="#F5F5F5" onClick="change_color('tr_a<? echo $i; ?>','#F5F5F5')" id="tr_a<? echo $i; ?>">
					<td width="100" align="left"><b>Actual</b></td>
					<td width="100" align="right" >
					<a href="##" onClick="generate_ex_factory_popup('ex_factory_popup','<? echo $row[csf('job_no_prefix_num')];?>','<? echo $row[csf('id')]; ?>','650px')"><? echo  fn_number_format($ex_factory_qty,0,'.',''); ?></a>
					<? //echo fn_number_format($ex_factory_qty,0,'.',''); ?></td>
					<td width="110" align="right" ><? echo fn_number_format($ex_factory_value,2,'.',''); ?></td>
					<td width="110"  align="right"><a href="#report_details" onClick="openmypage_actual2('<? echo $row[csf('id')]; ?>','yarn_cost_actual','Actual Yarn Cost Details','1','1020px')"><? echo fn_number_format($yarn_cost_actual,2,'.',''); ?></a></td>
					<td width="100" title="Yarn Dying With Order, Yarn Service Work Order(Rate): Yarn Recv: Yarn Dyeing/Twisting/Re-Waxing Cost :<? echo $order_amount_recv.' - Recv Ret: '.$order_amount_recv_ret.'/ Job Qty :'.$job_quantity.'* Po Qty :'.$order_qnty_in_pcs;?>"  align="right"><a href="#report_details"  onClick="openmypage_actual2('<? echo $row[csf('id')]; ?>','yarn_dye_twist_cost_actual','Actual Yarn Dyeing Twsit Cost Details','2','930px')"><? echo fn_number_format($yarn_dyeing_twist_actual,2,'.',''); ?></a></td>
					<td width="110" title="Knitting Bill Entry for Gross."  align="right"><a href="#report_details" onClick="openmypage_actual3('<? echo $row[csf('id')]; ?>','knit_cost_actual_popup','Actual Knitting Cost Details','900px')"><? echo fn_number_format($knit_cost_actual,2,'.',''); ?></a><? //echo fn_number_format($knit_cost_actual,2,'.',''); ?></td>
					<td width="100" title="Grey Fabric Transfer Cost<? echo $knit_charge_mkt;?>"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','knit_cost_actual','Actual Knitting Cost Details','900px')"><? //echo fn_number_format($grey_fab_transfer_amt_actual,2,'.',''); ?></a><? echo fn_number_format($grey_fab_transfer_amt_actual,2,'.',''); ?></td>					
					<td width="100" title="Grey Yarn Cost+Yarn Dyeing/Twisting/Re-Waxing Cost+Knitting Cost+Grey Fabric Transfer Cost"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','knit_cost_actual','Actual Knitting Cost Details','900px')"><? //echo fn_number_format($grey_fab_cost_actual,2,'.',''); ?></a><? echo fn_number_format($grey_fab_cost_actual,2,'.',''); ?></td>
					<td width="110"  title="From Dyeing And Finishing Bill Issue or Dyeing And Finishing Bill Entry" align="right"><a href="#report_details" onClick="openmypage_actual3('<? echo $row[csf('id')]; ?>','dye_finish_cost_actual_popup','Actual Dyeing & Finish Cost Details','800px')"><? echo fn_number_format($dye_finish_cost_actual,2,'.',''); ?></a><? //echo fn_number_format($dye_finish_cost_actual,2,'.',''); ?></td>
					
					<td width="110"  align="right" title="From Service Booking For AOP V2"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($aop_cost_actual,2,'.',''); ?></a><? echo fn_number_format($aop_cost_actual,2,'.',''); ?></td>
						<td width="100" title="<? echo 'Avg Dye Fin Charge from Budget='.$knit_charge_mkt_fin;?>"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','Fin Feb Transfer Cost Details','800px')"><? //echo fn_number_format($fin_fab_transfer_amt_actual,2,'.',''); ?></a><? echo fn_number_format($fin_fab_transfer_amt_actual,2,'.',''); ?></td>
						<td width="100" title="From- Partial Fabric Booking"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($fabric_purchase_cost_actual,2,'.',''); ?></a><? echo fn_number_format($fabric_purchase_cost_actual,2,'.',''); ?></td>
						<td width="110" title="From: Partial Fabric Booking"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','fabric_purchase_cost_actual','Fabric Purchase Cost Details','900px')"><? //echo fn_number_format($grey_fabric_purchase_cost_actual,2,'.',''); ?></a><? echo fn_number_format($grey_fabric_purchase_cost_actual,2,'.',''); ?></td>
						<td width="100" title="Without Purchase Fabric"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($finished_fab_cost_actual,2,'.',''); ?></a><? echo fn_number_format($finished_fab_cost_actual,2,'.',''); ?></td>
							<td width="100" title="Tot Fab. Cost"  align="right"><? echo fn_number_format($tot_fabric_cost_act,2,'.',''); ?></td>
							
					<td width="110"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','trims_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($trims_cost_actual,2,'.',''); ?></a></td>
					<td width="100"  title="Garment Printing Cost" align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','1','gmt_print_wash_dye_embell_cost_actual','Print Cost Details','800px')"><? echo fn_number_format($printing_cost_actual,2,'.',''); ?></a></td>
					<td width="100" title="Garment Embro Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','2','gmt_print_wash_dye_embell_cost_actual','Embro Cost Details','800px')"><? echo fn_number_format($embro_cost_actual,2,'.',''); ?></a></td>
						<td width="100" title="Garment Dyeing Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','5','gmt_print_wash_dye_embell_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($dyeing_cost_actual,2,'.',''); ?></a></td>
						<td width="100" title="Garment Wash Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','3','gmt_print_wash_dye_embell_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($wash_cost_actual,2,'.',''); ?></a></td>
						
					<td width="100"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]."_".$row[csf('job_no')]."_".$ex_factory_qty."_".$dzn_qnty; ?>','commission_cost_actual','Commission Cost Details','600px')"><? echo fn_number_format($commission_cost_actual,2,'.',''); ?></a></td>
					<td width="100"  align="right"><? echo fn_number_format($comm_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($freight_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($test_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($inspection_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($currier_cost_actual,2,'.',''); ?></td>
					
						<td width="100"  align="right"><? $certificate_cost_actual=$certificate_cost_mkt;echo fn_number_format($certificate_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><?  $deffdlc_cost_mkt_actual=$deffdlc_cost_mkt; echo fn_number_format($deffdlc_cost_mkt_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? $design_cost_actual=$design_cost_mkt; echo fn_number_format($design_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? $studio_cost_actual=$studio_cost_mkt;echo fn_number_format($studio_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><?  $operating_exp_actual=$operating_exp_mkt;echo fn_number_format($operating_exp_actual,2,'.',''); ?></td>
					
					
					<?
					//	$cm_cost_actual=($tot_working_hr*60*$tot_number_of_employee*$cpm)/$exchange_rate;
					?>
					<td width="100"  title="From Actual Cost Entry Quantity" align="right"><? echo fn_number_format($cm_cost_actual,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? $interest_cost_actual=$interest_cost_mkt;echo fn_number_format($interest_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? $incometax_cost_actual=$incometax_cost_mkt;echo fn_number_format($incometax_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? $depr_amor_pre_cost_actual=$depr_amor_pre_cost_mkt;echo fn_number_format($depr_amor_pre_cost_actual,2,'.',''); ?></td>
					
					
					<td width="100"  align="right"><? echo fn_number_format($actual_all_cost,2,'.',''); ?></td>
					<td width="100"  align="right" title="Ex factory value-Actual all cost;"><? echo fn_number_format($actual_margin,2,'.',''); ?></td>
					<td  width="100" align="right"  title="Margin /Ex Fact Value*100"><? echo fn_number_format($actual_margin_perc,2,'.',''); ?></td>
					
					<td width="100" title="Short Booking,yarn issue for Grey +Dyed Yarn Amount"  align="right"><? echo fn_number_format($yarn_cost_cpa_actual,2,'.',''); ?></td>
					<td   align="right"><? echo fn_number_format($actual_margin-$yarn_cost_cpa_actual,2,'.',''); ?></td>
				</tr>
				<tr bgcolor="#E9E9E9" onClick="change_color('tr_v<? echo $i; ?>','#E9E9E9')" id="tr_v<? echo $i; ?>">
					<td width="100" align="left"><b>Variance</b></td>
					<td width="100" align="right" ></td>
					<td width="110" align="right" >
						<? 
							$variance_po_value=$po_value-$ex_factory_value;
							$variance_po_value_per=($variance_po_value/$po_value)*100; 
							echo fn_number_format($variance_po_value,2,'.',''); 
						?>
					</td>
					<td width="110"  align="right">
						<? 
							$variance_yarn_cost=($yarn_cost_mkt+$yarn_dye_cost_mkt)-$yarn_cost_actual;
							if($variance_yarn_cost==0)
							{
								$variance_yarn_cost_per=0;
							}
							else
							{
								$variance_yarn_cost_per=($variance_yarn_cost/($yarn_cost_mkt+$yarn_dye_cost_mkt))*100; 
							}
							echo fn_number_format($variance_yarn_cost,2,'.',''); 
						?>
					</td>
					<td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right">
						<? 
							$variance_yarn_value_addition_cost=$yarn_value_addition_cost_mkt-$yarn_dyeing_twist_actual;
							//$variance_yarn_value_addition_cost_per=($variance_yarn_value_addition_cost/$yarn_value_addition_cost_mkt)*100;
							if($variance_yarn_value_addition_cost==0 && $yarn_value_addition_cost_mkt==0)
							{
								$variance_yarn_value_addition_cost_per=0;
							}
							else
							{
								$variance_yarn_value_addition_cost_per=($variance_yarn_value_addition_cost/$yarn_value_addition_cost_mkt)*100;
							} 
							echo fn_number_format($variance_yarn_value_addition_cost,2,'.',''); 
						?>
					</td>
					<td width="110"  align="right">
						<? 
							$variance_kint_cost=$knit_cost_mkt-$knit_cost_actual;
							if($variance_kint_cost==0)
							{
								$variance_knit_cost_per=0;
							}
							else
							{
								$variance_knit_cost_per=($variance_kint_cost/$knit_cost_mkt)*100; 
							}
							echo fn_number_format($variance_kint_cost,2,'.',''); 
						?>
					</td>
						<td width="100" title="Grey Fabric Transfer Cost"  align="right">
					</td>
					
						<td width="100" title="Tot Grey Fabric Cost"  align="right">
						<? 
							$variance_grey_fab_cost=$grey_fab_cost_mkt-$grey_fab_cost_actual;
							if($variance_grey_fab_cost==0 )
							{
								$variance_grey_fab_cost_per=0;
							}
							else
							{
								$variance_grey_fab_cost_per=($variance_grey_fab_cost/$grey_fab_cost_mkt)*100; 
							}
							echo fn_number_format($variance_grey_fab_cost,2,'.',''); 
						?>
					</td>
					<td width="110"  align="right">
						<? 
							$variance_dye_finish_cost=$dye_finish_cost_mkt-$dye_finish_cost_actual;
							if($variance_dye_finish_cost==0 && $dye_finish_cost_mkt==0)
							{
								$variance_dye_finish_cost_per=0;
							}
							else
							{
								$variance_dye_finish_cost_per=($variance_dye_finish_cost/$dye_finish_cost_mkt)*100; 
							}
							echo fn_number_format($variance_dye_finish_cost,2,'.','');
						?>
					</td>
					<td width="110"  align="right">
						<? 
							$variance_aop_cost=$aop_cost_mkt-$aop_cost_actual;
							if($variance_aop_cost==0)
							{
								$variance_aop_cost_per=0;
							}
							else
							{
								$variance_aop_cost_per=($variance_aop_cost/$aop_cost_mkt)*100; 
							}
							echo fn_number_format($variance_aop_cost,2,'.',''); 
						?>
					</td>
						<td width="100" title="Finished Fabric Transfer Cost"  align="right">
						</td>
						<td width="100" title="Finished Fabric Purchase Cost"  align="right">
						<? 
							$variance_fin_fabric_purchase_cost=$finish_fabric_purchase_cost_mkt-$fabric_purchase_cost_actual;
							//$variance_fin_fabric_cost_per=($variance_fin_fabric_purchase_cost/$finish_fabric_purchase_cost_mkt)*100;
							if($variance_fin_fabric_purchase_cost==0)
							{
								$variance_fin_fabric_cost_per=0;
							}
							else
							{
								$variance_fin_fabric_cost_per=($variance_fin_fabric_purchase_cost/$finish_fabric_purchase_cost_mkt)*100; 
							} 
							echo fn_number_format($variance_fin_fabric_purchase_cost,2,'.',''); 
						?>
					</td>
						<td width="110"  align="right">
						<? 
							$variance_finish_purchase_cost=$fabric_purchase_cost_mkt-$grey_fabric_purchase_cost_actual;
							if($variance_finish_purchase_cost==0 && $fabric_purchase_cost_mkt==0)
							{
								$variance_finish_purchase_cost_per=0;
							}
							else
							{
								$variance_finish_purchase_cost_per=($variance_finish_purchase_cost/$fabric_purchase_cost_mkt)*100; 
							}
							echo fn_number_format($variance_finish_purchase_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Finished Fabric Cost"  align="right">
						<? 
							$variance_finished_fab_cost=$tot_finish_fabric_cost_mkt-$finished_fab_cost_actual;
							if($variance_finished_fab_cost==0)
							{
								$variance_finished_fab_cost_per=0;
							}
							else
							{
								$variance_finished_fab_cost_per=($variance_finished_fab_cost/$tot_finish_fabric_cost_mkt)*100; 
							} 
							echo fn_number_format($variance_finished_fab_cost,2,'.',''); 
						?>
					</td>
					<td width="100" title="Total Fabric Cost"  align="right">
						<? 
							$variance_tot_fabric_cost=$tot_fabric_cost_mkt-$tot_fabric_cost_act;
							//$variance_tot_fabric_cost_per=($variance_tot_fabric_cost/$tot_fabric_cost_mkt)*100; 
							if($variance_tot_fabric_cost==0 && $tot_fabric_cost_mkt==0)
							{
								$variance_tot_fabric_cost_per=0;
							}
							else
							{
								$variance_tot_fabric_cost_per=($variance_tot_fabric_cost/$tot_fabric_cost_mkt)*100; 
							}
							echo fn_number_format($variance_tot_fabric_cost,2,'.',''); 
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_trims_cost=$trims_cost_mkt-$trims_cost_actual;
							if($variance_trims_cost==0)
							{
								$variance_trims_cost_per=0;
							}
							else
							{
								$variance_trims_cost_per=($variance_trims_cost/$trims_cost_mkt)*100; 
							}
							echo fn_number_format($variance_trims_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Garment Printing Cost"  align="right">
						<? 
							$variance_print_cost=$print_amount-$printing_cost_actual;
							if($variance_print_cost==0)
							{
								$variance_print_cost_per=0;
							}
							else
							{
								$variance_print_cost_per=($variance_print_cost/$print_amount)*100; 
							}
							echo fn_number_format($variance_print_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Garment Embro Cost"  align="right">
						<? 
							$variance_embro_cost=$embroidery_amount-$embro_cost_actual;
							if($variance_embro_cost==0 && $embroidery_amount==0)
							{
								$variance_embro_cost_per=0;
							}
							else
							{
								$variance_embro_cost_per=($variance_embro_cost/$embroidery_amount)*100; 
							}
							echo fn_number_format($variance_embro_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Garment Dyeing Cost"  align="right">
						<? 
							$variance_dyeing_cost=$other_amount-$dyeing_cost_actual;
							if($variance_dyeing_cost==0 && $other_amount==0)
							{
								$variance_dyeing_cost_per=0;
							}
							else
							{
								$variance_dyeing_cost_per=($variance_dyeing_cost/$other_amount)*100; 
							}
							echo fn_number_format($variance_dyeing_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Garment Wasing Cost"  align="right">
						<? 
							$variance_wash_cost=$wash_cost-$wash_cost_actual;
						if($variance_wash_cost==0 )
							{
								$variance_wash_cost_per=0;
							}
							else
							{
								$variance_wash_cost_per=($variance_wash_cost/$wash_cost)*100; 
							}
							echo fn_number_format($variance_wash_cost_per,2,'.','');
						?>
					</td>
					
					<td width="100"  align="right">
						<? 
							$variance_commission_cost=$commission_cost_mkt-$commission_cost_actual;
							if($variance_commission_cost==0 && $commission_cost_mkt==0)
							{
								$variance_commission_cost_per=0;
							}
							else
							{
								$variance_commission_cost_per=($variance_commission_cost/$commission_cost_mkt)*100; 
							}
							echo fn_number_format($variance_commission_cost,2,'.',''); 
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_comm_cost=$comm_cost_mkt-$comm_cost_actual;
							if($variance_comm_cost==0 )
							{
								$variance_commission_cost_per=0;
							}
							else
							{
								$variance_comm_cost_per=($variance_comm_cost/$comm_cost_mkt)*100; 
							}
							echo fn_number_format($variance_comm_cost,2,'.',''); 
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_freight_cost=$freight_cost_mkt-$freight_cost_actual;
							if($variance_freight_cost==0 && $freight_cost_mkt==0)
							{
								$variance_freight_cost_per=0;
							}
							else
							{
								$variance_freight_cost_per=($variance_freight_cost/$freight_cost_mkt)*100; 
							}
							echo fn_number_format($variance_freight_cost,2,'.',''); 
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_test_cost=$test_cost_mkt-$test_cost_actual;
							if($variance_test_cost==0 && $test_cost_mkt==0)
							{
								$variance_test_cost_per=0;
							}
							else
							{
								$variance_test_cost_per=($variance_test_cost/$test_cost_mkt)*100; 
							}
							echo fn_number_format($variance_test_cost,2,'.','');
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_inspection_cost=$inspection_cost_mkt-$inspection_cost_actual;
							if($variance_inspection_cost==0 && $inspection_cost_mkt==0)
							{
								$variance_inspection_cost_per=0;
							}
							else
							{
								$variance_inspection_cost_per=($variance_inspection_cost/$inspection_cost_mkt)*100; 
							}
							echo fn_number_format($variance_inspection_cost,2,'.','');
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
							if($variance_currier_cost==0 )
							{
								$variance_currier_cost_per=0;
							}
							else
							{
								$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
							}
							echo fn_number_format($variance_currier_cost,2,'.','');
						?>
					</td>
					
						<td width="100"  align="right"></td>
						<td width="100"  align="right">
					</td>
						<td width="100"  align="right">
					</td>
						<td width="100"  align="right">
					</td>
						<td width="100"  align="right">
					</td>
						
					
					
					<td width="100"  align="right">
						<? 
							$variance_cm_cost=$cm_cost_mkt-$cm_cost_actual;
							if($variance_cm_cost_per==0)
							{
								$variance_cm_cost_per=0;
							}
							else
							{
								$variance_cm_cost_per=($variance_cm_cost/$cm_cost_mkt)*100; 
							}
							echo fn_number_format($variance_cm_cost,2,'.',''); 
						?>
					</td>
					
						<td width="100"  align="right"></td>
						<td width="100"  align="right"></td>
						<td width="100"  align="right"></td>
						
					
					<td width="100"  align="right">
						<? 
							$variance_all_cost=$mkt_all_cost-$actual_all_cost;
							if($variance_all_cost==0)
							{
								$variance_all_cost_per=0;
							}
							else
							{
								$variance_all_cost_per=($variance_all_cost/$mkt_all_cost)*100; 
							}
							
							echo fn_number_format($variance_all_cost,2,'.','');
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_margin_cost=$mkt_margin-$actual_margin;
							if($variance_margin_cost==0)
							{
								$variance_margin_cost_per=0;
							}
							else
							{
								$variance_margin_cost_per=($variance_margin_cost/$mkt_margin)*100; 
							}
							echo fn_number_format($variance_margin_cost,2,'.','');
						?>
					</td>
					<td  width="100" align="right">
						<? 
							$variance_per_cost=$mkt_margin_perc-$actual_margin_perc;
							if($variance_per_cost==0)
							{
								$variance_per_cost_per=0;
							}
							else
							{
								$variance_per_cost_per=($variance_per_cost/$mkt_margin_perc)*100; 
							}
							echo fn_number_format($variance_per_cost,2,'.','');
						?>
					</td>
						<td width="100"  align="right"></td>
						<td   align="right"></td>
					
				</tr>
				<tr bgcolor="#DFDFDF" onClick="change_color('tr_vp<? echo $i; ?>','#DFDFDF')" id="tr_vp<? echo $i; ?>">
					<td width="100" align="left"><b>Variance (%)</b></td>
					<td width="100" align="right" ><? echo fn_number_format($variance_qnty_per,2,'.',''); ?></td>
					<td width="110" align="right" ><? echo fn_number_format($variance_po_value_per,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($variance_yarn_cost_per,2,'.',''); ?></td>
					<td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($variance_yarn_value_addition_cost_per,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($variance_knit_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_knit_cost_per,2,'.',''); ?></td>
					
					<td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($variance_grey_fab_cost_per,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($variance_dye_finish_cost_per,2,'.',''); ?></td>
					
					<td width="110"  align="right"><? echo fn_number_format($variance_aop_cost_per,2,'.',''); ?></td>
					<td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($variance_aop_cost_per,2,'.',''); ?></td>
					<td width="100" title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($variance_fin_fabric_cost_per,2,'.',''); ?></td>
					
					<td width="110"  align="right"><? echo fn_number_format($variance_finish_purchase_cost_per,2,'.',''); ?></td>
					<td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($variance_finished_fab_cost_per,2,'.',''); ?></td>
						<td width="100"  align="right"><?  echo fn_number_format($variance_tot_fabric_cost_per,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($variance_trims_cost_per,2,'.',''); ?></td>
					<td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($variance_print_cost_per,2,'.',''); ?></td>
					<td width="100" title="Garment Embro Cost"  align="right"><? echo fn_number_format($variance_embro_cost_per,2,'.',''); ?></td>
					<td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($variance_dyeing_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_wash_cost_per,2,'.',''); ?></td>
					
					
					<td width="100"  align="right"><? echo fn_number_format($variance_commission_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_comm_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_freight_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_test_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_inspection_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					
					
						
					
					<td width="100"  align="right"><? echo fn_number_format($variance_cm_cost_per,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					
					
					<td width="100"  align="right"><? echo fn_number_format($variance_all_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
					<td   width="100" align="right"><? echo fn_number_format($variance_per_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
					<td   align="right"><? //echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
				</tr>
				<?
				$i++;
			}
			
			$tot_mkt_margin_perc=($tot_mkt_margin/$tot_po_value)*100;
			if($tot_ex_factory_val==0)
			{
				$tot_actual_margin_perc=0;
			}
			else
			{
				$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
			}
			
			//$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
			
			?>
		</table>
	</div>
	<table class="rpt_table" width="5530" cellpadding="0" cellspacing="0" border="1" rules="all">
		<tr bgcolor="#CCDDEE" onClick="change_color('tr_pt','#CCDDEE')" id="tr_pt" style="font-weight:bold;">
			<td width="40">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="60">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="110">&nbsp;</td>
			<td width="120" align="">Total</td>
			
			<td width="90"  align="right"><? echo fn_number_format($tot_po_qnty,0,'.',''); ?></td>
			<td width="50">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="110"  align="right"><? echo fn_number_format($tot_po_value,2,'.',''); ?></td>
			<td width="100"  align="right">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">Pre Costing Total</td>
			<td width="100"  align="right"><? echo fn_number_format($tot_po_qnty,0,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_po_value,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_yarn_cost_mkt,2,'.',''); ?></td>
				<td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_knit_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? //echo fn_number_format($tot_knit_cost_mkt,2,'.',''); ?></td>
			
			<td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($tot_grey_fab_cost_mkt,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2,'.',''); ?></td>
			
			
			<td width="110"  align="right"><? echo fn_number_format($tot_aop_cost_mkt,2,'.',''); ?></td>
			<td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($tot_yarn_dye_cost_mkt,2,'.',''); ?></td> 
				<td width="100" title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2,'.',''); ?></td> 
				<td width="110"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2,'.',''); ?></td>
				<td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($total_finish_fabric_cost_mkt,2,'.',''); ?></td> 
				<td width="100"  align="right"><? echo fn_number_format($total_fabric_cost_mkt,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_trims_cost_mkt,2,'.',''); ?></td>
			<td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($tot_print_amount_mkt,2,'.',''); ?></td> 
			<td width="100" title="Garment Embroidery Cost"  align="right"><? echo fn_number_format($tot_embro_amount_mkt,2,'.',''); ?></td> 
			<td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_dyeing_amount_mkt,2,'.',''); ?></td> 
			<td width="100" title="Garment Wash Cost"  align="right"><? echo fn_number_format($tot_wash_amount_mkt,2,'.',''); ?></td> 
			
			
			<td width="100"  align="right"><? echo fn_number_format($tot_commission_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_comm_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_freight_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_test_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_currier_cost_mkt,2,'.',''); ?></td>
			
			<td width="100"  align="right"><? echo fn_number_format($tot_certificate_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_design_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_studio_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_operating_exp_mkt,2,'.',''); ?></td>
			
			
			<td width="100"  align="right"><? echo fn_number_format($tot_cm_cost_mkt,2,'.',''); ?></td>
			
			<td width="100"  align="right"><? echo fn_number_format($tot_interest_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_incometax_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt,2,'.',''); ?></td>
			
			
			<td width="100"  align="right"><? echo fn_number_format($tot_mkt_all_cost,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_mkt_margin_perc,2,'.',''); ?></td>
			<td width="100"  align="right"><? //echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
			<td width=""  align="right"><? //echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
		</tr>
		<? //echo die;?>
		<tr bgcolor="#CCCCFF" onClick="change_color('tr_at','#CCCCFF')" id="tr_at" style="font-weight:bold;">
			<td width="40">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="60">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="110">&nbsp;</td>
			<td width="120" align="">&nbsp;</td>
			<td width="90"  align="right">&nbsp;</td>
			<td width="50">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="110"  align="right">&nbsp;</td>
			<td width="100"  align="right">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">Actual Total</td>
			<td width="100" align="right" ><? echo fn_number_format($tot_ex_factory_qnty,0,'.',''); ?></td>
			<td width="110" align="right" ><? echo fn_number_format($tot_ex_factory_val,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_yarn_cost_actual,2,'.',''); ?></td>
			<td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_knit_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_grey_fab_transfer_amt_actual,2,'.',''); ?></td>
			
			<td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($tot_grey_fab_cost_actual,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_dye_finish_cost_actual,2,'.',''); ?></td>
			
			
			<td width="110"  align="right"><? echo fn_number_format($tot_aop_cost_actual,2,'.',''); ?></td>
			<td width="100" title="Finished Fabric Transfer Cost act"  align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2,'.',''); ?></td>
			<td width="100" title="Finished Fabric Purchase Cost act"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2,'.',''); ?></td>
				<td width="110"  align="right"><? echo fn_number_format($tot_grey_fabric_purchase_cost_actual,2,'.',''); ?></td>
			<td width="100" title="Tot Finished Fabric Cost act"  align="right"><? echo fn_number_format($tot_finished_fab_cost_actual,2,'.',''); ?></td>
				<td width="100" title="Total Fab. Cost" align="right" ><? echo fn_number_format($tot_fabric_cost_actaul,2,'.',''); ?></td>
			<td width="110" align="right" ><? echo fn_number_format($tot_trims_cost_actual,2,'.',''); ?></td>
			<td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($tot_print_amount_actual,2,'.',''); ?></td>
			<td width="100" title="Garment Embro Cost"  align="right"><? echo fn_number_format($tot_embro_amount_actual,2,'.',''); ?></td>
			<td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_dyeing_amount_actual,2,'.',''); ?></td>
			<td width="100" title="Garment Wash Cost"  align="right"><? echo fn_number_format($tot_wash_amount_actual,2,'.',''); ?></td>
				
				
			
			<td width="100"  align="right"><? echo fn_number_format($tot_commission_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_comm_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_freight_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_test_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_inspection_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_currier_cost_actual,2,'.',''); ?></td>
			
			<td width="100"  align="right"><? echo fn_number_format($tot_certificate_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_deffdlc_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_design_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_studio_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_operating_exp_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_cm_cost_actual,2,'.',''); ?></td>                
			<td width="100"  align="right"><? echo fn_number_format($tot_interest_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_incometax_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_actual,2,'.',''); ?></td>               
			<td width="100"  align="right"><? echo fn_number_format($tot_actual_all_cost,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_actual_margin,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_actual_margin_perc,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_yarn_qty_cpa_actual,2,'.',''); ?></td>
			<td width=""  align="right"><? echo fn_number_format($tot_actual_net_margin,2,'.',''); ?></td>
		</tr>
		<tr bgcolor="#FFEEFF" onClick="change_color('tr_vt','#FFEEFF')" id="tr_vt" style="font-weight:bold;">
			<td width="40">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="60">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="110">&nbsp;</td>
			<td width="120" align="">&nbsp;</td>
			<td width="90"  align="right">&nbsp;</td>
			<td width="50">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="110"  align="right">&nbsp;</td>
			<td width="100"  align="right">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">Variance Total</td>
			<td width="100" align="right" >
				<? 
					$tot_variance_qnty=$tot_po_qnty-$tot_ex_factory_qnty;
					$tot_variance_qnty_per=($tot_variance_qnty/$tot_po_qnty)*100; 
					echo fn_number_format($tot_variance_qnty,0,'.',''); 
				?>
			</td>
			<td width="110" align="right" >
				<? 
					$tot_variance_po_value=$tot_po_value-$tot_ex_factory_val;
					$tot_variance_po_value_per=($tot_variance_po_value/$tot_po_value)*100; 
					echo fn_number_format($tot_variance_po_value,2,'.',''); 
				?>
			</td>
			<td width="110"  align="right">
				<? 
					$tot_variance_yarn_cost=$tot_yarn_cost_mkt-$tot_yarn_cost_actual;
					$tot_variance_yarn_cost_per=($tot_variance_yarn_cost/$tot_yarn_cost_mkt)*100; 
					echo fn_number_format($tot_variance_yarn_cost,2,'.',''); 
				?>
			</td>
				<td width="100"  align="right">
				<? 
					$tot_variance_yarn_value_addition_cost=$tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual;
					if($tot_variance_yarn_value_addition_cost==0)
					{
					$tot_variance_yarn_value_addition_cost_per=0;
					}
					else
					{
					$tot_variance_yarn_value_addition_cost_per=($tot_variance_yarn_value_addition_cost/$tot_yarn_value_addition_cost_mkt)*100; 
					}
					// $tot_variance_yarn_value_addition_cost_per=($tot_variance_yarn_value_addition_cost/$tot_yarn_value_addition_cost_mkt)*100; 
					echo fn_number_format($tot_variance_yarn_value_addition_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_kint_cost=$tot_knit_cost_mkt-$tot_knit_cost_actual;
					$tot_variance_knit_cost_per=($tot_variance_kint_cost/$tot_knit_cost_mkt)*100; 
					echo fn_number_format($tot_variance_kint_cost,2,'.',''); 
				?>
			</td>
				<td width="100"  align="right">
				<? 
					//$tot_variance_kint_cost=$tot_knit_cost_mkt-$tot_knit_cost_actual;
					// $tot_variance_knit_cost_per=($tot_variance_kint_cost/$tot_knit_cost_mkt)*100; 
					// echo fn_number_format($tot_variance_kint_cost,2,'.',''); 
				?>
			</td>
			
				<td width="100"  title="Grey Fabric Cost" align="right">
				<? 
					$tot_variance_grey_fab_cost=$tot_grey_fab_cost_mkt-$tot_grey_fab_cost_actual;
					if($tot_variance_grey_fab_cost==0)
					{
						$tot_variance_grey_fab_cost_per=0;
					}
					else
					{
							$tot_variance_grey_fab_cost_per=($tot_variance_grey_fab_cost/$tot_grey_fab_cost_mkt)*100; 
					}    
					echo fn_number_format($tot_variance_grey_fab_cost,2,'.',''); 
				?>
			</td>
			<td width="110"  align="right">
				<? 
					$tot_variance_dye_finish_cost=$tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual;
					if($tot_variance_dye_finish_cost==0)
					{
						$tot_variance_dye_finish_cost_per=0;
					}
					else
					{
							$tot_variance_dye_finish_cost_per=($tot_variance_dye_finish_cost/$tot_dye_finish_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_dye_finish_cost,2,'.','');
				?>
			</td>
			
			<td width="110"  align="right">
				<? 
					$tot_variance_aop_cost=$tot_aop_cost_mkt-$tot_aop_cost_actual;
					if($tot_variance_aop_cost==0)
					{
						$tot_variance_aop_cost_per=0;
					}
					else
					{
							$tot_variance_aop_cost_per=($tot_variance_aop_cost/$tot_aop_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_aop_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  title="Fabric Purchase Trans Cost"  align="right">
				<? 
					/*$tot_variance_aop_cost=$tot_aop_cost_mkt-$tot_aop_cost_actual;
					$tot_variance_aop_cost_per=($tot_variance_aop_cost/$tot_aop_cost_mkt)*100; 
					echo fn_number_format($tot_variance_aop_cost,2,'.','');*/ 
				?>
			</td>
			<td width="100" title="Fabric Purchase Cost" align="right">
				<? 
					$tot_variance_fin_fabric_purchase_cost=$tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual;
					if($tot_variance_fin_fabric_purchase_cost==0)
					{
						$tot_variance_fin_fabric_purchase_cost_per=0;
					}
					else
					{
							$tot_variance_fin_fabric_purchase_cost_per=($tot_variance_fin_fabric_purchase_cost/$tot_fabric_purchase_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_fin_fabric_purchase_cost,2,'.','');
				?>
			</td>
				<td width="110"  align="right">
				<? 
					$tot_variance_fabric_purchase_cost=$tot_fabric_purchase_cost_mkt-$tot_grey_fabric_purchase_cost_actual;
					if($tot_variance_fabric_purchase_cost==0)
					{
						$tot_variance_fabric_purchase_cost_per=0;
					}
					else
					{
							$tot_variance_fabric_purchase_cost_per=($tot_variance_fabric_purchase_cost/$tot_fabric_purchase_cost_mkt)*100; 
					}
					echo fn_number_format($tot_variance_fabric_purchase_cost,2,'.','');
				?>
			</td>
			<td width="100" title="Tot Fin Fabric  Cost"  align="right">
				<? 
					$tot_variance_fin_fab_cost=$total_finish_fabric_cost_mkt-$tot_finished_fab_cost_actual;
					if($tot_variance_fin_fab_cost==0)
					{
						$tot_variance_fin_fab_cost_per=0;
					}
					else
					{
							$tot_variance_fin_fab_cost_per=($tot_variance_fin_fab_cost/$total_finish_fabric_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_fin_fab_cost,2,'.',''); 
				?>
			</td>
			<td width="100" title="Tot Fabric  Cost"  align="right">
				<? 
					$tot_variance_fabric_cost_mkt=$total_fabric_cost_mkt-$tot_fabric_cost_actaul;
					if($tot_variance_fabric_cost_mkt==0)
					{
						$tot_variance_fabric_cost_mkt_per=0;
					}
					else
					{
							$tot_variance_fabric_cost_mkt_per=($tot_variance_fabric_cost_mkt/$tot_fabric_cost_mkt)*100;  
					} 
					
					echo fn_number_format($tot_variance_fabric_cost_mkt,2,'.','');
				?>
			</td>
			<td width="110"  align="right">
				<? 
					$tot_variance_trims_cost=$tot_trims_cost_mkt-$tot_trims_cost_actual;
					if($tot_variance_trims_cost==0)
					{
						$tot_variance_trims_cost_per=0;
					}
					else
					{
							$tot_variance_trims_cost_per=($tot_variance_trims_cost/$tot_trims_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_trims_cost,2,'.','');
				?>
			</td>
				<td width="100" title="Garment Printing Cost" align="right">
				<? 
					$tot_variance_print_amount=$tot_print_amount_mkt-$tot_print_amount_actual;
					if($tot_variance_print_amount==0)
					{
						$tot_variance_print_per=0;
					}
					else
					{
							$tot_variance_print_per=($tot_variance_print_amount/$tot_print_amount_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_print_amount,2,'.','');
				?>
			</td>
				<td width="100" title="Garment Embro  Cost"  align="right">
				<? 
					$tot_variance_embro_cost=$tot_embro_amount_mkt-$tot_embro_amount_actual;//tot_wash_amount_mkt-tot_wash_amount_actual
					if($tot_variance_embro_cost==0)
					{
						$tot_variance_embro_cost_per=0;
					}
					else
					{
						$tot_variance_embro_cost_per=($tot_variance_embro_cost/$tot_embro_amount_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_embro_cost,2,'.','');
				?>
			</td>
				<td width="100" title="Garment Dyeing Cost"  align="right">
				<? 
				
					$tot_variance_dyeing_cost=$tot_dyeing_amount_mkt-$tot_dyeing_amount_actual;
					if($tot_variance_dyeing_cost==0)
					{
						$tot_variance_dyeing_cost_per=0;
					}
					else
					{
							$tot_variance_dyeing_cost_per=($tot_variance_dyeing_cost/$tot_dyeing_amount_mkt)*100; 
					} 
					//echo $tot_variance_dyeing_cost.'='.$tot_dyeing_amount_mkt.', ';
					echo fn_number_format($tot_variance_dyeing_cost,2,'.',''); 
				?>
			</td>
				<td width="100" title="Garment Wash Cost"  align="right">
				<? 
					$tot_variance_wash_cost=$tot_wash_amount_mkt-$tot_wash_amount_actual;
					if($tot_variance_wash_cost==0)
					{
						$tot_variance_wash_cost_per=0;
					}
					else
					{
							$tot_variance_wash_cost_per=($tot_variance_wash_cost/$tot_wash_amount_mkt)*100; 
					}   
					echo fn_number_format($tot_variance_wash_cost,2,'.','');
				?>
			</td>
			
			<td width="100" align="right">
				<? 
					$tot_variance_commission_cost=$tot_commission_cost_mkt-$tot_commission_cost_actual;
					if($tot_variance_commission_cost==0)
					{
						$tot_variance_commission_cost_per=0;
					}
					else
					{
							$tot_variance_commission_cost_per=($tot_variance_commission_cost/$tot_commission_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_commission_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_comm_cost=$tot_comm_cost_mkt-$tot_comm_cost_actual;
					if($tot_variance_comm_cost==0)
					{
						$tot_variance_comm_cost_per=0;
					}
					else
					{
							$tot_variance_comm_cost_per=($tot_variance_comm_cost/$tot_comm_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_comm_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_freight_cost=$tot_freight_cost_mkt-$tot_freight_cost_actual;
					if($tot_variance_freight_cost==0)
					{
						$tot_variance_freight_cost_per=0;
					}
					else
					{
						$tot_variance_freight_cost_per=($tot_variance_freight_cost/$tot_freight_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_freight_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_test_cost=$tot_test_cost_mkt-$tot_test_cost_actual;
					if($tot_variance_test_cost==0)
					{
						$tot_variance_test_cost_per=0;
					}
					else
					{
							$tot_variance_test_cost_per=($tot_variance_test_cost/$tot_test_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_test_cost,2,'.','');
				?>
			</td>
			<td width="100" align="right">
				<? 
					$tot_variance_inspection_cost=$tot_inspection_cost_mkt-$tot_inspection_cost_actual;
					if($tot_variance_inspection_cost==0)
					{
						$tot_variance_inspection_cost_per=0;
					}
					else
					{
							$tot_variance_inspection_cost_per=($tot_variance_inspection_cost/$tot_inspection_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_inspection_cost,2,'.','');
				?>
			</td>
			<td width="100" align="right">
				<? 
					$tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
					if($tot_variance_currier_cost==0)
					{
						$tot_variance_currier_cost_per=0;
					}
					else
					{
							$tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_currier_cost,2,'.','');
				?>
			</td>
			
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				
			
			
			<td width="100"  align="right">
				<? 
					$tot_variance_cm_cost=$tot_cm_cost_mkt-$tot_cm_cost_actual;
					if($tot_variance_cm_cost==0)
					{
						$tot_variance_cm_cost_per=0;
					}
					else
					{
						$tot_variance_cm_cost_per=($tot_variance_cm_cost/$tot_cm_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_cm_cost,2,'.',''); 
				?>
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
			
			
			<td width="100" align="right">
				<? 
					$tot_variance_all_cost=$tot_mkt_all_cost-$tot_actual_all_cost;
					if($tot_variance_all_cost==0)
					{
						$tot_variance_all_cost_per=0;
					}
					else
					{
						$tot_variance_all_cost_per=($tot_variance_all_cost/$tot_mkt_all_cost)*100; 
					} 
					echo fn_number_format($variance_all_cost,2,'.','');
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
					$tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
					echo fn_number_format($tot_variance_margin_cost,2,'.','');
				?>
			</td>
			<td width="100" align="right">
				<? 
					$tot_variance_per_cost=$tot_mkt_margin_perc-$tot_actual_margin_perc;
					$tot_variance_per_cost_per=($tot_variance_per_cost/$tot_mkt_margin_perc)*100; 
					echo fn_number_format($tot_variance_per_cost,2,'.','');
				?>
			</td>
				<td width="100"  align="right">
				<? 
					/* $tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
					$tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
					echo fn_number_format($tot_variance_margin_cost,2,'.','');*/
				?>
			</td>
				<td width=""  align="right">
				<? 
					/* $tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
					$tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
					echo fn_number_format($tot_variance_margin_cost,2,'.','');*/
				?>
			</td>
		</tr>
		<tr bgcolor="#CCCCEE" onClick="change_color('tr_vpt','#CCCCEE')" id="tr_vpt" style="font-weight:bold;">
			<td width="40">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="60">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="110">&nbsp;</td>
			<td width="120" align=""></td>
			<td width="90"  align="right">&nbsp;</td>
			<td width="50">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="110" align="right">&nbsp;</td>
			<td width="100"  align="right">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">Variance (%) Total</td>
			<td width="100" align="right" ><? echo fn_number_format($tot_variance_qnty_per,0,'.',''); ?></td>
			<td width="110" align="right" ><? echo fn_number_format($tot_variance_po_value_per,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_yarn_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_yarn_value_addition_cost_per,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_knit_cost_per,2,'.',''); ?></td>
			<td width="100" title="Grey Fabric Transfer Cost" align="right"><? //echo fn_number_format($tot_variance_knit_cost_per,2,'.',''); ?></td>
			
			<td width="100" title="Grey Fabric Cost" align="right"><? echo fn_number_format($tot_variance_grey_fab_cost_per,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_dye_finish_cost_per ,2,'.',''); ?></td>
			
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_aop_cost_per,2,'.',''); ?></td>
				<td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($tot_variance_aop_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($tot_variance_fin_fabric_purchase_cost_per,2,'.',''); ?></td>
				<td width="110" align="right"><? echo fn_number_format($tot_variance_fabric_purchase_cost_per ,2,'.',''); ?></td>
				<td width="100"  title="Finished Fabric Cost"  align="right"><? echo fn_number_format($tot_variance_fin_fab_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Total Fabric Cost"  align="right"><? echo fn_number_format($tot_variance_fabric_cost_mkt_per,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_trims_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Garment Printing Cost" align="right"><? echo fn_number_format($tot_variance_print_per,2,'.',''); ?></td>
				<td width="100"  title="Garment Embro Cost" align="right"><? echo fn_number_format($tot_variance_embro_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_variance_dyeing_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Garment Wash Cost" align="right"><? echo fn_number_format($tot_variance_wash_cost_per,2,'.',''); ?></td>
				
			
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_commission_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_comm_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_freight_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_test_cost_per,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_inspection_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
			
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
			
				
				
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_cm_cost_per,2,'.',''); ?></td>
			
				<td width="100" align="right" title="Interest"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
			
			
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_all_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_per_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
				<td width="" align="right"><? //echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
		</tr>
	</table>
	<br />
	<table width="4330">
		<tr>
			<td width="850" valign="top">
				<div align="center" style="width:450px" id="div_summary"><input type="button" value="Print Preview" class="formbutton" onClick="new_window2('company_div','summary_full')" /></div>
				<br /><? $po_ids=implode(',',$po_ids_array);$job_ids=rtrim($job_ids,','); $job_nos=implode(',',array_unique(explode(",",$job_ids))); ?>
				<div id="summary_full"> <font color="#FF0000" style="display:none">*Yarn Dyeing Charge included with actual Yarn Cost</font>
					<div align="center" id="company_div" style="visibility:hidden; font-size:24px;width:700px"><b><? echo $company_arr[$company_name].'<br>'; 
					echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to));
					?></b></div>
					<table width="850" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
						<thead>
						<tr>
							<th colspan="9">Summary</th>
						</tr>
						<tr>
							<th width="30">SL</th>
							<th width="180">Particulars</th>
							<th width="130">Pre Costing</th>
							<th width="80">%</th>
							<th width="130">At Actual</th>
							<th width="80">%</th>
							<th width="80">Variance</th>
							<th width="80">%</th>
							<th>Disclosure</th>
						</tr> 
						<?
							$bgcolor1='#E9F3FF';
							$bgcolor2='#FFFFFF';
						?>
						</thead>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_1','<? echo $bgcolor1; ?>')" id="trtd_1">
							<td align="center">1</td>
							<td>PO/Shipment Value</td>
							<td align="right"><? echo fn_number_format($tot_po_value,2); ?></td>
							<td align="right">&nbsp;</td>
							<td align="right"><? echo fn_number_format($tot_ex_factory_val,2); ?></td>
							<td align="right">&nbsp;</td>
							<td align="right"><? echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
							<td align="right"  title="Variance/PO-Shipment Value Mkt*100"><? echo fn_number_format((($tot_ex_factory_val-$tot_po_value)/$tot_po_value)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_2','<? echo $bgcolor2; ?>')" id="trtd_2">
							<td colspan="9"><b>Cost</b></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_3','<? echo $bgcolor1; ?>')" id="trtd_3">
							<td align="center">2</td>
							<td>Grey Yarn Cost</td>
							<td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_cost','Grey Yarn Mkt. Cost Details')"><? echo fn_number_format($tot_yarn_cost_mkt,2); //$tot_yarn_qty_actual?></a></td>
							<td align="right"><? echo fn_number_format(($tot_yarn_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_cost_actual','Yarn Cost Details')"><? echo fn_number_format($tot_yarn_cost_actual,2); //$tot_yarn_qty_actual;?></a></td>
							<td align="right"><? echo fn_number_format(($tot_yarn_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_yarn_cost_mkt-$tot_yarn_cost_actual,2);//$tot_yarn_amt_actual ?></td>
							<td align="right"  title="Variance/Grey Yarn Cost Mkt*100"><? echo fn_number_format((($tot_yarn_cost_mkt-$tot_yarn_cost_actual)/$tot_yarn_cost_mkt)*100,2); ?></td>
								<td align="right"><?  if($tot_yarn_qty_actual>$tot_yarn_cost_mkt) echo "Returnable Yarn Qty..".$tot_yarn_qty_actual."And Cost..".$tot_yarn_amt_actual; else echo " ";?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_4','<? echo $bgcolor2; ?>')" id="trtd_4">
							<td align="center">3</td>
							<td>Yarn  Value Addition Cost</td>
							<td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_dyeing_twisting_cost','Yarn Dyeing Cost Details')"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></a><? //echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_dye_twist_cost_actual','Yarn Dyeing & Twist Cost Details','2','900px')"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2); ?></a></td>
							<td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual,2); ?></td>
								<td align="right" title="Variance/Yarn Value  Addition Cost Mkt*100"><? echo fn_number_format((($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual)/$tot_yarn_value_addition_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_5','<? echo $bgcolor2; ?>')" id="trtd_5">
							<td align="center">4</td>
							<td>Knitting Cost</td>
							<td align="right"><? echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knit_cost_actual_popup','Knitting Cost Details')"><? echo fn_number_format($tot_knit_cost_actual,2); ?></a><? //echo fn_number_format($tot_knit_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
								<td align="right" title="Variance/Knitting Cost Mkt*100"><? echo fn_number_format((($tot_knit_cost_mkt-$tot_knit_cost_actual)/$tot_knit_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_6','<? echo $bgcolor2; ?>')" id="trtd_6">
							<td align="center">5</td>
							<td>Grey Fabric Transfer Cost</td>
							<td align="right"><? //echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></a><? echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
								<td align="right"><? echo ""; ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_7','<? echo $bgcolor2; ?>')" id="trtd_7">
							<td align="center">6</td>
							<td>Grey Fabric Cost =2+3+4+5</td>
							<td align="right"><? 
							$grey_fab_cost_mkt_sum=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt;
							$grey_fab_cost_act_sum=$tot_yarn_cost_actual+$tot_yarn_dyeing_twist_actual+$tot_knit_cost_actual+$tot_grey_fab_transfer_amt_actual;
							
							echo fn_number_format($grey_fab_cost_mkt_sum,2); ?></td>
							<td align="right"><? echo fn_number_format(($grey_fab_cost_mkt_sum/$tot_po_value)*100,2); ?></td>
							<td align="right" title=""><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_cost_actual,2); ?></a><? echo fn_number_format($grey_fab_cost_act_sum,2); ?></td>
							<td align="right"><? echo fn_number_format(($grey_fab_cost_act_sum/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum,2); ?></td>
								<td align="right" title="Variance/Grey Fab Cost Mkt*100"><? echo fn_number_format((($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum)/$grey_fab_cost_mkt_sum)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_8','<? echo $bgcolor2; ?>')" id="trtd_8">
							<td align="center">7</td>
							<td>Dye & Fin Cost</td>
							<td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_dye_finish_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage_actual3('<? echo $po_ids; ?>','dye_finish_cost_actual_popup','Actual Dyeing & Finish Cost Details','800px')"><? echo fn_number_format($tot_dye_finish_cost_actual,2,'.',''); ?></a></td>
							<td align="right"><? echo fn_number_format(($tot_dye_finish_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual,2); ?></td>
								<td align="right" title="Variance/Dye & Fin Cost Mkt*100"><?  echo fn_number_format((($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual)/$tot_dye_finish_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_9','<? echo $bgcolor1; ?>')" id="trtd_9">
							<td align="center">8</td>
							<td>AOP  Cost</td>
							<td align="right"><? echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_aop_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
								<td align="right" title="Variance/AOP Cost Mkt*100"><? echo fn_number_format((($tot_aop_cost_mkt-$tot_aop_cost_actual)/$tot_aop_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_10','<? echo $bgcolor2; ?>')" id="trtd_10">
							<td align="center">9</td>
							<td>Finished Fabric Transfer Cost</td>
							<td align="right"><? //echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
							<td align="right"><? // echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
								<td align="right"><? echo " "; ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_11','<? echo $bgcolor1; ?>')" id="trtd_11">
							<td align="center">10</td>
							<td>Finished Fabric Cost =6+7+8+9</td>
							<td align="right"><? $tot_fin_fab_cost_sum_mkt=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
							//$tot_fin_fabCost=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
							echo fn_number_format($tot_fin_fab_cost_sum_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? $tot_fin_fab_cost_sum_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual;
							echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual,2); ?></td>
								<td align="right" title="Variance/Finished Fabric Cost Mkt*100"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual)/$tot_fin_fab_cost_sum_mkt)*100,2);  ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_12','<? echo $bgcolor2; ?>')" id="trtd_12">
							<td align="center">11</td>
							<td>Fabric Purchase Cost</td>
							<td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','fabric_purchase_cost','Fabric Purchase Cost Details')"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2); ?></a></td>
							<td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual,2); ?></td>
							<td align="right" title="Variance/Fabric Purchase Cost Mkt*100"><? echo fn_number_format((($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual)/$tot_fabric_purchase_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_27','<? echo $bgcolor2; ?>')" id="trtd_27">
							<td align="center">12</td>
							<td>Total Fabric Cost(=10+11)</td>
							<td align="right"><? $tot_fab_cost_mkt=$tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt;
							echo fn_number_format($tot_fab_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)/$tot_po_value)*100,2); ?></td>
							<td align="right"><? 
							$tot_fabric_cost_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual;
							echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_fabric_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? $tot_fab_cost_vairance=($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual;
							echo fn_number_format(($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual,2); ?></td>
								<td align="right"><?  echo fn_number_format(($tot_fab_cost_vairance/$tot_fab_cost_mkt)*100,2); ?></td>
								<td align="right"><? echo ' '; ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_13','<? echo $bgcolor1; ?>')" id="trtd_13">
							<td align="center">13</td>
							<td>Trims Cost</td>
							<td align="right"><? echo fn_number_format($tot_trims_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_trims_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_trims_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_trims_cost_mkt-$tot_trims_cost_actual,2); ?></td>
								<td align="right" title="Variance/Trim Cost Mkt*100"><? echo fn_number_format((($tot_trims_cost_mkt-$tot_trims_cost_actual)/$tot_trims_cost_mkt)*100,2);  ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_14','<? echo $bgcolor2; ?>')" id="trtd_14">
							<td align="center">14</td>
							<td>Printing Cost</td>
							<td align="right"><? echo fn_number_format($tot_print_amount_mkt,2); ?></td>
							<td align="right"><?  echo fn_number_format(($tot_print_amount_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_print_amount_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_print_amount_mkt-$tot_print_amount_actual,2); ?></td>
							<td align="right" title="Variance/Printing Cost Mkt*100"><?  echo fn_number_format((($tot_print_amount_mkt-$tot_print_amount_actual)/$tot_print_amount_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_15','<? echo $bgcolor1; ?>')" id="trtd_15">
							<td align="center">15</td>
							<td> Embroidery Cost</td>
							<td align="right"><? echo fn_number_format($tot_embro_amount_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_embro_amount_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_embro_amount_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_embro_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_embro_amount_mkt-$tot_embro_amount_actual,2); ?></td>
								<td align="right" title="Variance/Embroidery Cost Mkt*100"><?  echo fn_number_format((($tot_embro_amount_mkt-$tot_embro_amount_actual)/$tot_embro_amount_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_16','<? echo $bgcolor2; ?>')" id="trtd_16">
							<td align="center">16</td>
							<td>Gmt Dyeing  Cost</td>
							<td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_dyeing_amount_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_dyeing_amount_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_dyeing_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual,2); ?></td>
								<td align="right" title="Variance/Gmt Dyeing Cost Mkt*100"><?  echo fn_number_format((($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual)/$tot_dyeing_amount_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_17','<? echo $bgcolor1; ?>')" id="trtd_17">
							<td align="center">17</td>
							<td>Washing  Cost</td>
							<td align="right"><? echo fn_number_format($tot_wash_amount_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_wash_amount_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_wash_amount_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_wash_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_wash_amount_mkt-$tot_wash_amount_actual,2); ?></td>
							<td align="right" title="Variance/Washing Cost Mkt*100"><?  echo fn_number_format((($tot_wash_amount_mkt-$tot_wash_amount_actual)/$tot_wash_amount_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_18','<? echo $bgcolor2; ?>')" id="trtd_18">
							<td align="center">18</td>
							<td>Commission Cost</td>
							<td align="right"><? echo fn_number_format($tot_commission_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_commission_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_commission_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_commission_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_commission_cost_mkt-$tot_commission_cost_actual,2); ?></td>
							<td align="right" title="Variance/Commission Cost Mkt*100"><?  echo fn_number_format((($tot_commission_cost_mkt-$tot_commission_cost_actual)/$tot_commission_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_19','<? echo $bgcolor1; ?>')" id="trtd_19">
							<td align="center">19</td>
							<td>Commercial Cost</td>
							<td align="right"><? echo fn_number_format($tot_comm_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_comm_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_comm_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_comm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_comm_cost_mkt-$tot_comm_cost_actual,2); ?></td>
							<td align="right" title="Variance/Commercial Cost Mkt*100"><?  echo fn_number_format((($tot_comm_cost_mkt-$tot_comm_cost_actual)/$tot_comm_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_20','<? echo $bgcolor2; ?>')" id="trtd_20">
							<td align="center">20</td>
							<td>Freight Cost</td>
							<td align="right"><? echo fn_number_format($tot_freight_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_freight_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_freight_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_freight_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_freight_cost_mkt-$tot_freight_cost_actual,2); ?></td>
								<td align="right" title="Variance/Freight Cost Mkt*100"><?  echo fn_number_format((($tot_freight_cost_mkt-$tot_freight_cost_actual)/$tot_freight_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_21','<? echo $bgcolor1; ?>')" id="trtd_21">
							<td align="center">21</td>
							<td>Testing Cost</td>
							<td align="right"><? echo fn_number_format($tot_test_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_test_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_test_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_test_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_test_cost_mkt-$tot_test_cost_actual,2); ?></td>
							<td align="right" title="Variance/Testing Cost Mkt*100"><?  echo fn_number_format((($tot_test_cost_mkt-$tot_test_cost_actual)/$tot_test_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_22','<? echo $bgcolor2; ?>')" id="trtd_22">
							<td align="center">22</td>
							<td>Inspection Cost</td>
							<td align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_inspection_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_inspection_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_inspection_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_inspection_cost_mkt-$tot_inspection_cost_actual,2); ?></td>
							<td align="right" title="Variance/Inspection Cost Mkt*100"><?  echo fn_number_format((($tot_inspection_cost_mkt-$tot_inspection_cost_actual)/$tot_inspection_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_23','<? echo $bgcolor1; ?>')" id="trtd_23">
							<td align="center">23</td>
							<td>Courier Cost</td>
							<td align="right"><? echo fn_number_format($tot_currier_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_currier_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_currier_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_currier_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_currier_cost_mkt-$tot_currier_cost_actual,2); ?></td>
								<td align="right" title="Variance/Courier Cost Mkt*100"><?  echo fn_number_format((($tot_currier_cost_mkt-$tot_currier_cost_actual)/$tot_currier_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_24','<? echo $bgcolor1; ?>')" id="trtd_23">
							<td align="center">24</td>
							<td>Certificate Cost</td>
							<td align="right"><? echo fn_number_format($tot_certificate_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_certificate_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_certificate_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_certificate_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_certificate_cost_mkt-$tot_certificate_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_certificate_cost_mkt-$tot_certificate_cost_actual)/$tot_certificate_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_25','<? echo $bgcolor1; ?>')" id="trtd_25">
							<td align="center">25</td>
							<td>Deffd. LC Cost</td>
							<td align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_deffdlc_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_deffdlc_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_deffdlc_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt-$tot_deffdlc_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_deffdlc_cost_mkt-$tot_deffdlc_cost_actual)/$tot_deffdlc_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_26','<? echo $bgcolor1; ?>')" id="trtd_26">
							<td align="center">26</td>
							<td>Design Cost</td>
							<td align="right"><? echo fn_number_format($tot_design_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_design_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_design_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_design_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_design_cost_mkt-$tot_design_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_design_cost_mkt-$tot_design_cost_actual)/$tot_design_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_27','<? echo $bgcolor1; ?>')" id="trtd_27">
							<td align="center">27</td>
							<td>Studio  Cost</td>
							<td align="right"><? echo fn_number_format($tot_studio_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_studio_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_studio_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_studio_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_studio_cost_mkt-$tot_studio_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_studio_cost_mkt-$tot_studio_cost_actual)/$tot_studio_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_28','<? echo $bgcolor1; ?>')" id="trtd_28">
							<td align="center">28</td>
							<td>Opert. Exp.</td>
							<td align="right"><? echo fn_number_format($tot_operating_exp_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_operating_exp_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_operating_exp_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_operating_exp_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_operating_exp_mkt-$tot_operating_exp_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_operating_exp_mkt-$tot_operating_exp_actual)/$tot_operating_exp_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
						
						
						
						
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_24','<? echo $bgcolor2; ?>')" id="trtd_24">
							<td align="center">29</td>
							<td>CM</td>
							<td align="right"><? echo fn_number_format($tot_cm_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_cm_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_cm_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_cm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_cm_cost_mkt-$tot_cm_cost_actual,2); ?></td>
							<td align="right" title="Variance/CM Cost Mkt*100"><?  echo fn_number_format((($tot_cm_cost_mkt-$tot_cm_cost_actual)/$tot_cm_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_30','<? echo $bgcolor1; ?>')" id="trtd_30">
							<td align="center">30</td>
							<td>Interest</td>
							<td align="right"><? echo fn_number_format($tot_interest_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_interest_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_interest_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_interest_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_interest_cost_mkt-$tot_interest_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_interest_cost_mkt-$tot_interest_cost_actual)/$tot_interest_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_31','<? echo $bgcolor1; ?>')" id="trtd_31">
							<td align="center">31</td>
							<td>Income Tax</td>
							<td align="right"><? echo fn_number_format($tot_incometax_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_incometax_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_incometax_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_incometax_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_incometax_cost_mkt-$tot_incometax_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_incometax_cost_mkt-$tot_incometax_cost_actual)/$tot_incometax_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_31','<? echo $bgcolor1; ?>')" id="trtd_31">
							<td align="center">32</td>
							<td>Depc. & Amort.</td>
							<td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_depr_amor_pre_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_depr_amor_pre_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt-$tot_depr_amor_pre_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_depr_amor_pre_cost_mkt-$tot_depr_amor_pre_cost_actual)/$tot_depr_amor_pre_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_33','<? echo $bgcolor1; ?>')" id="trtd_33">
							<td align="center">33</td>
							<td>Total Cost</td>
							<td align="right"><? echo fn_number_format($tot_mkt_all_cost,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_mkt_all_cost/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_actual_all_cost,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_actual_all_cost/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_mkt_all_cost-$tot_actual_all_cost,2); ?></td>
							<td align="right" title="Variance/Total Cost Mkt*100"><?  echo fn_number_format((($tot_mkt_all_cost-$tot_actual_all_cost)/$tot_mkt_all_cost)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_34,'<? echo $bgcolor2; ?>')" id="trtd_34">
							<td align="center">34</td>
							<td>Margin/Loss</td>
							<td align="right"><? echo fn_number_format($tot_mkt_margin,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_actual_margin,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
							<td align="right" title="Variance/Margin/Loss Mkt*100"><?  echo fn_number_format((($tot_mkt_margin-$tot_actual_margin)/$tot_mkt_margin)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_35','<? echo $bgcolor2; ?>')" id="trtd_35">
							<td align="center">35</td>
							<td>CPA/Short Fabric Cost</td>
							<td align="right"><? //echo fn_number_format($tot_mkt_margin,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_yarn_qty_cpa_actual,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
							<td align="right"><?  echo ' '; ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_36','<? echo $bgcolor2; ?>')" id="trtd_36">
							<td align="center">36</td>
							<td>Net Margin/Loss(=34-35)</td>
							<td align="right"><? //echo fn_number_format($tot_mkt_margin,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_actual_margin-$tot_yarn_qty_cpa_actual,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
								<td align="right"><?  echo ' ';  ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
					</table>
				</div>
			</td>
			<td width="525" align="center" valign="top" style="display:none">
				<div align="center" style="width:500px; height:53px" id="graph">&nbsp;</div>
				<fieldset style="text-align:center; width:450px" > 
					<legend>Chart</legend>
				</fieldset>
			</td>   
			<td width="" valign="top">
				<div align="center" style="width:600px" id="div_buyer"><input type="button" value="Print Preview" class="formbutton" onClick="new_window2('company_div_b','summary_buyer')" /></div>
				<br />
				<div id="summary_buyer">
					<div align="center" id="company_div_b" style="visibility:hidden; font-size:24px;width:2305px"><b><? echo $company_arr[$company_name].'<br>';echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to)); ?></b></div>
					<table width="100%" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
						<thead>
								<tr>
								<th colspan="38">Buyer Level Summary</th>
							</tr>
							<tr>
								<th width="35">SL</th>
								<th width="70">Buyer name</th>
								<th width="110">Cost Source</th>
								<th width="110">Ex-Factory Value</th>
								
								<th width="100">Yarn Value Addition Cost</th>
								<th width="110">Grey Yarn cost</th>
								<th width="110">Knitting Cost</th>
								<th width="100">Grey Fabric Transfer Cost</th>
								
								<th width="110">Grey Fabric Purchase Cost</th>
								<th width="100">Grey Fabric Cost</th>
								<th width="110">Dye & Fin Cost</th>
								<th width="110">AOP</th>
								<th width="100">Fin. Fab. Transfer Cost</th>
								<th width="100">Fin. Fabric Purchase Cost</th>
								<th width="100">Fin. Fabric Cost</th>
								<th width="110">Trims Cost</th>
								<th width="100">Printing Cost</th>
								<th width="100">Embroidery Cost</th>
								<th width="100">Dyeing  Cost</th>
								
								<th width="100">Washing  Cost</th>
									
								
								<th width="110">Commission Cost</th>
								<th width="100">Commercial Cost</th>
								<th width="110">Freight Cost</th>
								<th width="100">Testing Cost</th>
								<th width="100">Inspection Cost</th>
								<th width="100">Courier Cost</th>								
								<th width="100">Certificate Cost</th>
								<th width="100">Deffd. LC Cost</th>
								<th width="100">Design Cost</th>
								<th width="100">Studio Cost</th>
								<th width="100">Opert. Exp.</th>									
								<th width="110">CM Cost</th>								
								<th width="100">Interest</th>
								<th width="100">Income Tax</th>
								<th width="100">Depc. & Amort.</th>							
								<th width="110">Total Cost</th>
								<th width="110">Margin</th>
								<th width="90">Margin %</th>
							</tr>
						</thead>
						<?
							$j=1;$tot_fin_fab_transfer_amt_actual=$tot_mkt_print_cost=$tot_mkt_embro_cost=$tot_mkt_dyeing_cost=$tot_mkt_wash_cost=$tot_mkt_value_addition_cost=0;
							foreach($buyer_name_array as $key=>$value)
							{
								if ($j%2==0)  
									$bgcolor="#E9F3FF";
								else
									$bgcolor="#FFFFFF";	
							?>
								<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD_<? echo $j; ?>">
									<td rowspan="4"><? echo $j ;?></td>
									<td rowspan="4"><? echo $value ;?></td>
									<td><b>Pre Costing</b></td>
									<td align="right"><? echo fn_number_format($mkt_po_val_array[$key],2); $tot_mkt_po_val+=$mkt_po_val_array[$key];  ?></td>									
									<td align="right"><? echo fn_number_format($mkt_yarn_value_addition_array[$key],2); $tot_mkt_value_addition_cost+=$mkt_yarn_value_addition_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_yarn_array[$key],2); $tot_mkt_yarn_cost+=$mkt_yarn_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_knit_array[$key],2); $tot_mkt_knit_cost+=$mkt_knit_array[$key]; ?></td>
									<td align="right"><? //echo fn_number_format($mkt_yarn_array[$key],2); $tot_mkt_yarn_cost+=$mkt_yarn_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_fabric_purchase_array[$key],2); $tot_mkt_fin_pur_cost+=$mkt_fabric_purchase_array[$key];?></td>
									<td align="right"><? echo fn_number_format($mkt_grey_fab_cost_array[$key],2); $tot_mkt_grey_fab_cost+=$mkt_grey_fab_cost_array[$key];?></td>
									<td align="right"><? echo fn_number_format($mkt_dy_fin_array[$key],2); $tot_mkt_dy_fin_cost+=$mkt_dy_fin_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_aop_array[$key],2); $tot_mkt_aop_cost+=$mkt_aop_array[$key]; ?></td>
									<td align="right"><? //echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2);$tot_mkt_fin_fabric_purchase+=$mkt_fin_fabric_purchase_array[$key]; ?></td>
									<td align="right"><?  echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2);$tot_mkt_fin_fabric_purchase+=$mkt_fin_fabric_purchase_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2); ?></td>
									<td align="right"><? echo fn_number_format($mkt_trims_array[$key],2); $tot_mkt_trims_cost+=$mkt_trims_array[$key]; ?></td>										
									<td align="right"><? echo fn_number_format($mkt_print_array[$key],2); $tot_mkt_print_cost+=$mkt_print_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_embro_array[$key],2); $tot_mkt_embro_cost+=$mkt_embro_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_dyeing_array[$key],2); $tot_mkt_dyeing_cost+=$mkt_dyeing_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_wash_array[$key],2); $tot_mkt_wash_cost+=$mkt_wash_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_commn_array[$key],2); $tot_mkt_commn_cost+=$mkt_commn_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_commercial_array[$key],2); $tot_mkt_commercial_cost+=$mkt_commercial_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_freight_array[$key],2); $tot_mkt_freight_cost+=$mkt_freight_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_test_array[$key],2); $tot_mkt_test_cost+=$mkt_test_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_ins_array[$key],2); $tot_mkt_ins_cost+=$mkt_ins_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_courier_array[$key],2); $tot_mkt_courier_cost+=$mkt_courier_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_certificate_array[$key],2); $tot_mkt_certificate_cost+=$mkt_certificate_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_deffdlc_array[$key],2); $tot_mkt_deffdlc_cost+=$mkt_deffdlc_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_design_array[$key],2); $tot_mkt_design_cost+=$mkt_design_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_studio_array[$key],2); $tot_mkt_studio_cost+=$mkt_studio_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_operating_array[$key],2); $tot_mkt_operating_cost+=$mkt_operating_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_cm_array[$key],2); $tot_mkt_cm_cost+=$mkt_cm_array[$key]; ?></td>								
									<td align="right"><? echo fn_number_format($mkt_interest_array[$key],2); $tot_mkt_interest_cost+=$mkt_interest_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_incometax_array[$key],2); $tot_mkt_incometax_cost+=$mkt_incometax_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_depr_amor_array[$key],2); $tot_mkt_depr_amor_cost+=$mkt_depr_amor_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($mkt_total_array[$key],2); $tot_mkt_total_cost+=$mkt_total_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_margin_array[$key],2); $tot_mkt_margin_cost+=$mkt_margin_array[$key]; ?></td>
									<td align="right"><? $mkt_margin_perc=($mkt_margin_array[$key]/$mkt_po_val_array[$key])*100; echo fn_number_format($mkt_margin_perc,2); $tot_mkt_margin_perc_cost+=$mkt_margin_perc; ?></td> 
								</tr>
								<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD2_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD2_<? echo $j; ?>">
									<td><b>Actual</b></td>
									<td align="right"><? echo fn_number_format($ex_factory_val_array[$key],2); $tot_buyer_ex_factory_val+=$ex_factory_val_array[$key];  ?></td>
									
									<td align="right"><? echo fn_number_format($yarn_dyeing_twist_array[$key],2); $tot_yarn_dyeing_twist_cost+=$yarn_dyeing_twist_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($yarn_cost_array[$key],2); $tot_buyer_yarn_cost+=$yarn_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($knit_cost_array[$key],2); $tot_buyer_knit_cost+=$knit_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($grey_fab_cost_array[$key],2); $tot_grey_fab_cost+=$grey_fab_cost_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($actual_grey_fabric_purchase_array[$key],2); $tot_buyer_grey_fabric_pur_act_cost+=$actual_grey_fabric_purchase_array[$key]; ?></td>
									<td align="right" title="Grey Feb Cost"><? echo fn_number_format($grey_fab_cost_array[$key],2); $tot_grey_fab_cost_act+=$grey_fab_cost_array[$key];?></td>
									<td align="right"><? echo fn_number_format($dye_cost_array[$key],2); $tot_buyer_dye_cost+=$dye_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($aop_n_others_cost_array[$key],2); $tot_buyer_aop_n_others_cost+=$aop_n_others_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($fin_fab_transfer_amt_actual_array[$key],2); $tot_fin_fab_transfer_amt_actual+=$fin_fab_transfer_amt_actual_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($actual_fabric_purchase_array[$key],2); $tot_act_fin_fabric_purchase_cost+=$actual_fabric_purchase_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($finished_fab_cost_actual_array[$key],2); $tot_finished_fab_cost_actual_buy+=$finished_fab_cost_actual_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($trims_cost_array[$key],2); $tot_buyer_trims_cost+=$trims_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($print_act_cost_array[$key],2); $tot_act_print_cost+=$print_act_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($embro_act_cost_array[$key],2); $tot_act_embro_cost+=$embro_act_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($dyeing_act_cost_array[$key],2); $tot_act_dyeing_cost+=$dyeing_act_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($wash_act_cost_array[$key],2); $tot_act_wash_cost+=$wash_act_cost_array[$key]; ?></td>
										
									
									<td align="right"><? echo fn_number_format($commission_cost_array[$key],2); $tot_buyer_commi_cost+=$commission_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($commercial_cost_array[$key],2); $tot_buyer_commercial_cost+=$commercial_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($freight_cost_array[$key],2); $tot_buyer_freight_cost+=$freight_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($testing_cost_array[$key],2); $tot_buyer_testing_cost+=$testing_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($inspection_cost_array[$key],2); $tot_buyer_inspection_cost+=$inspection_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($courier_cost_array[$key],2); $tot_buyer_courier_cost+=$courier_cost_array[$key]; ?></td>
									
										<td align="right"><? echo fn_number_format($acl_certificate_array[$key],2); $tot_acl_certificate_cost+=$acl_certificate_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_deffdlc_array[$key],2); $tot_acl_deffdlc_cost+=$acl_deffdlc_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_design_array[$key],2); $tot_acl_design_cost+=$acl_design_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_studio_array[$key],2); $tot_acl_studio_cost+=$acl_studio_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_operating_array[$key],2); $tot_acl_operating_cost+=$acl_operating_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($cm_cost_array[$key],2); $tot_buyer_cm_cost+=$cm_cost_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($acl_interest_array[$key],2); $tot_acl_interest_cost+=$acl_interest_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_incometax_array[$key],2); $tot_acl_incometax_cost+=$acl_incometax_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_depr_amor_array[$key],2); $tot_acl_depr_amor_cost+=$acl_depr_amor_array[$key]; ?></td>
										
									<td align="right"><? echo fn_number_format($total_cost_array[$key],2); $tot_buyer_total_cost+=$total_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($margin_array[$key],2); $tot_buyer_margin_cost+=$margin_array[$key]; ?></td>
									<td align="right"><? $margin_perc=($margin_array[$key]/$ex_factory_val_array[$key])*100; echo fn_number_format($margin_perc,2); $tot_buyer_margin_perc_cost+=$margin_perc; ?></td> 
								</tr>
								<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD3_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD3_<? echo $j; ?>">
									<td><b>Variance</b></td>
									<td align="right">
									<?
										$ex_var= $mkt_po_val_array[$key]-$ex_factory_val_array[$key];
										echo fn_number_format($ex_var,2); 
									?>
									</td>
										
										<td align="right">
									<?
										$yarn_value_addition_var= $mkt_yarn_value_addition_array[$key]-$yarn_dyeing_twist_array[$key];
										echo fn_number_format($yarn_value_addition_var,2);
									?>
									</td>
									
									<td align="right">
									<?
										$yarn_var= $mkt_yarn_array[$key]-$yarn_cost_array[$key];
										echo fn_number_format($yarn_var,2);
									?>
									</td>
									<td align="right">
									<?
										$knit_var= $mkt_knit_array[$key]-$knit_cost_array[$key];
										echo fn_number_format($knit_var,2); 
									?>
									</td>
									<td align="right"></td>
									
									<td align="right">
									<?
										$fin_pur_var= $mkt_fabric_purchase_array[$key]-$actual_grey_fabric_purchase_array[$key];
										echo fn_number_format($fin_pur_var,2); 
									?>
									</td>
									<td align="right" title="grey Feb Cost"><? 
									$grey_feb_var=$mkt_grey_fab_cost_array[$key]-$grey_fab_cost_array[$key];echo fn_number_format($grey_feb_var,2);?></td>
									<td align="right">
									<?
										$dy_var= $mkt_dy_fin_array[$key]-$dye_cost_array[$key];
										echo fn_number_format($dy_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$aop_var= $mkt_aop_array[$key]-$aop_n_others_cost_array[$key];
										echo fn_number_format($aop_var,2); 
									?>
									</td>
									<td align="right"></td>
									<td align="right">
									<?
										$fin_feb_pur_var=$mkt_fin_fabric_purchase_array[$key]-$tot_act_fin_fabric_purchase_cost[$key];
										echo fn_number_format($fin_feb_pur_var,2); 
									?>
									</td>
									<td align="right">
									
									<?
										$totfin_fab_var= $mkt_fin_fabric_purchase_array[$key]-$finished_fab_cost_actual_array[$key];
										echo fn_number_format($totfin_fab_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$trims_var= $mkt_trims_array[$key]-$trims_cost_array[$key];
										echo fn_number_format($trims_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$print_var= $mkt_print_array[$key]-$print_act_cost_array[$key];
										echo fn_number_format($print_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$embro_var= $mkt_embro_array[$key]-$embro_act_cost_array[$key];
										
										echo fn_number_format($embro_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$dyeing_var= $mkt_dyeing_array[$key]-$dyeing_act_cost_array[$key];
										echo fn_number_format($dyeing_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$wash_var= $mkt_wash_array[$key]-$wash_act_cost_array[$key];
										echo fn_number_format($wash_var,2); 
									?>
									</td>
									
									
									<td align="right">
									<?
										$com_var= $mkt_commn_array[$key]-$commission_cost_array[$key];
										echo fn_number_format($com_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$commer_var= $mkt_commercial_array[$key]-$commercial_cost_array[$key];
										echo fn_number_format($commer_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$fr_var= $mkt_freight_array[$key]-$freight_cost_array[$key];
										echo fn_number_format($fr_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$test_var= $mkt_test_array[$key]-$testing_cost_array[$key];
										echo fn_number_format($test_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$ins_var= $mkt_ins_array[$key]-$inspection_cost_array[$key];
										echo fn_number_format($ins_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
										echo fn_number_format($cour_var,2); 
									?>
									</td>
									
									<td align="right"></td>
									<td align="right"></td>
									<td align="right"></td>
									<td align="right"></td>
									<td align="right"></td>									
									<td align="right">
									<?
										$cm_var= $mkt_cm_array[$key]-$cm_cost_array[$key];
										echo fn_number_format($cm_var,2); 
									?>
									</td>
									<td align="right" title="Interest"></td>
									<td align="right"></td>
									<td align="right"></td>									
									<td align="right">
									<?
										$tot_var= $mkt_total_array[$key]-$total_cost_array[$key];
										echo fn_number_format($tot_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$mar_var= $mkt_margin_array[$key]-$margin_array[$key];
										echo fn_number_format($mar_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$margin_perc_to= $mkt_margin_perc-$margin_perc;
										echo fn_number_format($margin_perc_to,2); 
									?>
									</td>
								</tr>
								<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD4_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD4_<? echo $j; ?>">
									<td><b>Variance (%)</b></td>
									<td align="right"><? echo fn_number_format(($ex_var/$mkt_po_val_array[$key]*100),2); ?></td>
									
										<td align="right"><? echo fn_number_format(($yarn_value_addition_var/$mkt_yarn_value_addition_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($yarn_var/$mkt_yarn_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($knit_var/$mkt_knit_array[$key]*100),2); ?></td>
									<td align="right"><? //echo fn_number_format(($ex_var/$mkt_po_val_array[$key]*100),2); ?></td>
									
									<td align="right"><? echo fn_number_format(($fin_pur_var/$mkt_fabric_purchase_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($grey_feb_var/$mkt_grey_fab_cost_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($dy_var/$mkt_dy_fin_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($aop_var/$mkt_aop_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($fin_fab_pur_var/$mkt_fin_fabric_purchase_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($fin_feb_pur_var/$mkt_fin_fabric_purchase_array[$key][$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($totfin_fab_var/$mkt_fin_fabric_purchase_array[$key]*100),2); ?></td> 
									<td align="right"><? echo fn_number_format(($trims_var/$mkt_trims_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($print_var/$mkt_print_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($embro_var/$mkt_embro_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($dyeing_var/$mkt_dyeing_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($wash_var/$mkt_wash_array[$key]*100),2); ?></td>
									
									<td align="right"><? echo fn_number_format(($com_var/$mkt_commn_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($commer_var/$mkt_commercial_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($fr_var/$mkt_freight_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($test_var/$mkt_test_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($ins_var/$mkt_ins_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
									
									<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
									
									
									<td align="right"><? echo fn_number_format(($cm_var/$mkt_cm_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										
									<td align="right"><? echo fn_number_format(($tot_var/$mkt_total_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($mar_var/$mkt_margin_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($margin_perc_to/$mkt_margin_perc*100),2); ?></td> 
								</tr>
						<?
							$j++;
							}
							
							$bgcolor5='#CCDDEE';
							$bgcolor6='#CCCCFF';
							$bgcolor7='#FFEEFF';
						?>
						<tr bgcolor="<? echo $bgcolor5; ?>" onClick="change_color('trTD5_<? echo $j; ?>','<? echo $bgcolor5; ?>')" id="trTD5_<? echo $j; ?>">
							<th colspan="3">Pre Costing</th>
							<th align="right"><? echo fn_number_format($tot_mkt_po_val,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_mkt_value_addition_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_yarn_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_knit_cost,2); ?></th>
								<th align="right"><? //echo fn_number_format($tot_mkt_po_val,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_mkt_fin_pur_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_grey_fab_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_dy_fin_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_aop_cost,2); ?></th>
							<th align="right"><? //echo fn_number_format($tot_mkt_aop_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_fin_fabric_purchase,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_fin_fabric_purchase,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_trims_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_print_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_embro_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_dyeing_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_wash_cost,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_mkt_commn_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_commercial_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_freight_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_test_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_ins_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_courier_cost,2); ?></th>
							
								<th align="right"><? echo fn_number_format($tot_mkt_certificate_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_deffdlc_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_design_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_studio_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_operating_cost,2); ?></th>
								
								
							<th align="right"><? echo fn_number_format($tot_mkt_cm_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_interest_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_incometax_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_depr_amor_cost,2); ?></th>
								
							<th align="right"><? echo fn_number_format($tot_mkt_total_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_margin_cost,2); ?></th>
							<th align="right"><? $mm=$tot_mkt_margin_cost/$tot_mkt_po_val*100; echo fn_number_format($mm,2); ?></th>   
						</tr>
						<tr bgcolor="<? echo $bgcolor6; ?>" onClick="change_color('trTD6_<? echo $j; ?>','<? echo $bgcolor6; ?>')" id="trTD6_<? echo $j; ?>">
							<th colspan="3">Actual</th>
							<th align="right"><? echo fn_number_format($tot_buyer_ex_factory_val,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_yarn_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_knit_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_grey_fab_cost,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_buyer_grey_fabric_pur_act_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_grey_fab_cost_act,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_dye_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_aop_n_others_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_act_fin_fabric_purchase_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_finished_fab_cost_actual_buy,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_trims_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_act_print_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_act_embro_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_act_dyeing_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_act_wash_cost,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_buyer_commi_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_commercial_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_freight_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_testing_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_inspection_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_courier_cost,2); ?></th>
							
								<th align="right"><? echo fn_number_format($tot_acl_certificate_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_deffdlc_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_design_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_studio_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_operating_cost,2); ?></th>
								
								
							<th align="right"><? echo fn_number_format($tot_buyer_cm_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_interest_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_incometax_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_depr_amor_cost,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_buyer_total_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_margin_cost,2); ?></th>
							<th align="right"><? $pp=$tot_buyer_margin_cost/$tot_buyer_ex_factory_val*100; echo fn_number_format($pp,2); ?></th>   
						</tr>
						<tr bgcolor="<? echo $bgcolor7; ?>" onClick="change_color('trTD7_<? echo $j; ?>','<? echo $bgcolor7; ?>')" id="trTD7_<? echo $j; ?>">
							<th colspan="3">Variance</th>
							<th align="right"><? $evar=$tot_mkt_po_val-$tot_buyer_ex_factory_val;  echo fn_number_format($evar,2); ?></th>
							<th align="right"><? $yarn_value_var=$tot_mkt_value_addition_cost-$tot_yarn_dyeing_twist_actual;  echo fn_number_format($yarn_value_var,2); ?></th>
							<th align="right"><? $grey_yvar=$tot_mkt_yarn_cost-$tot_buyer_yarn_cost;  echo fn_number_format($grey_yvar,2); ?></th>
							<th align="right"><? $knit_var=$tot_mkt_knit_cost-$tot_buyer_knit_cost;  echo fn_number_format($knit_var,2); ?></th>
							<th align="right"><? echo " ";//$kvar=$tot_mkt_knit_cost-$tot_buyer_knit_cost;  echo fn_number_format($kvar,2); ?></th>
							
							<th align="right"><? $fpfvar=$tot_mkt_fin_pur_cost-$tot_buyer_grey_fabric_pur_act_cost;  echo fn_number_format($fpfvar,2); ?></th>
								<th align="right"><? $greypfvar=$tot_mkt_grey_fab_cost-$tot_grey_fab_cost_act;  echo fn_number_format($greypfvar,2); ?></th>
								<th align="right"><? $dfvar=$tot_mkt_dy_fin_cost-$tot_buyer_dye_cost;  echo fn_number_format($dfvar,2); ?></th>
							<th align="right"><? $aopvar=$tot_mkt_aop_cost-$tot_buyer_aop_n_others_cost;  echo fn_number_format($aopvar,2); ?></th>
							<th align="right"><? echo " ";//$aopvar=$tot_mkt_aop_cost-$tot_buyer_aop_n_others_cost;  echo fn_number_format($aopvar,2); ?></th>
							<th align="right"><? //$fin_fab_var=$tot_mkt_fin_fabric_purchase-$tot_finished_fab_cost_actual_buy;  echo fn_number_format($fin_fab_var,2); ?></th>
								<th align="right"><? $fin_fab_var=$tot_mkt_fin_fabric_purchase-$tot_finished_fab_cost_actual_buy;  echo fn_number_format($fin_fab_var,2);; ?></th>
							<th align="right"><? $trimvar=$tot_mkt_trims_cost-$tot_buyer_trims_cost;  echo fn_number_format($trimvar,2); ?></th>
								<th align="right"><? $printvar=$tot_mkt_print_cost-$tot_act_print_cost;  echo fn_number_format($printvar,2); ?></th>
								<th align="right"><? $embrovar=$tot_mkt_embro_cost-$tot_act_embro_cost;  echo fn_number_format($embrovar,2); ?></th>
							<th align="right"><? $dyeingvar=$tot_mkt_dyeing_cost-$tot_act_dyeing_cost;  echo fn_number_format($dyeingvar,2); ?></th>
							<th align="right"><? $washingvar=$tot_mkt_wash_cost-$tot_act_wash_cost;  echo fn_number_format($washingvar,2); ?></th>
							
							<th align="right"><? $comvar=$tot_mkt_commn_cost-$tot_buyer_commi_cost;  echo fn_number_format($comvar,2); ?></th>
							<th align="right"><? $commercialvar=$tot_mkt_commercial_cost-$tot_buyer_commercial_cost;  echo fn_number_format($commercialvar,2); ?></th>
							<th align="right"><? $fvar=$tot_mkt_freight_cost-$tot_buyer_freight_cost;  echo fn_number_format($fvar,2); ?></th>
							<th align="right"><? $tvar=$tot_mkt_test_cost-$tot_buyer_testing_cost;  echo fn_number_format($tvar,2); ?></th>
							<th align="right"><? $ivar=$tot_mkt_ins_cost-$tot_buyer_inspection_cost;  echo fn_number_format($ivar,2); ?></th>
							<th align="right"><? $courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							
								
							
							<th align="right"><? $cmvar=$tot_mkt_cm_cost-$tot_buyer_cm_cost;  echo fn_number_format($cmvar,2); ?></th>
								<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							
							<th align="right"><? $totvar=$tot_mkt_total_cost-$tot_buyer_total_cost;  echo fn_number_format($totvar,2); ?></th>
							<th align="right"><? $mvar=$tot_mkt_margin_cost-$tot_buyer_margin_cost;  echo fn_number_format($mvar,2); ?></th>
							<th align="right"><? $mpvar=$mm-$pp;  echo fn_number_format($mpvar,2); ?></th>   
						</tr>
						<tr bgcolor="<? echo $bgcolor6; ?>" onClick="change_color('trTD8_<? echo $j; ?>','<? echo $bgcolor6; ?>')" id="trTD8_<? echo $j; ?>">
							<th colspan="3">Variance (%)</th>
							<th align="right"><? echo fn_number_format(($evar/$tot_mkt_po_val*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($yarn_value_var/$tot_mkt_value_addition_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($grey_yvar/$tot_mkt_yarn_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($knit_var/$tot_mkt_yarn_cost*100),2); ?></th>
							<th align="right"><? echo " ";//echo fn_number_format(($kvar/$tot_mkt_knit_cost*100),2); ?></th>
							
							<th align="right"><? echo fn_number_format(($fpfvar/$tot_mkt_fin_pur_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($greypfvar/$tot_mkt_grey_fab_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($dfvar/$tot_mkt_dy_fin_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($aopvar/$tot_mkt_aop_cost*100),2); ?></th>
							<th align="right"><? echo " ";//echo fn_number_format(($aopvar/$tot_mkt_aop_cost*100),2); ?></th>
							<th align="right"><?  echo fn_number_format(($fin_fab_var/$tot_mkt_fin_fabric_purchase*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($trimvar/$tot_mkt_trims_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($printvar/$tot_mkt_trims_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($embrovar/$tot_mkt_embro_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($dyeingvar/$tot_mkt_dyeing_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($washingvar/$tot_mkt_wash_cost*100),2); ?></th> 
								<th align="right"><? echo fn_number_format(($washingvar/$tot_mkt_wash_cost*100),2); ?></th> 
							
							<th align="right"><? echo fn_number_format(($comvar/$tot_mkt_commn_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($commercialvar/$tot_mkt_commercial_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($fvar/$tot_mkt_freight_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($tvar/$tot_mkt_test_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($ivar/$tot_mkt_ins_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
								
							<th align="right"><? echo fn_number_format(($cmvar/$tot_mkt_cm_cost*100),2); ?></th>
								<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($totvar/$tot_mkt_total_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($mvar/$tot_mkt_margin_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($mpvar/$mm*100),2); ?></th>   
						</tr>
					</table>
				</div>
			</td>
		</tr>
	</table>
	</fieldset>
 <?
	execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_name." and ref_from in (1,2,3,4,5,6) and ENTRY_FORM=123");
	oci_commit($con);
	disconnect($con);
	foreach (glob("../../../../ext_resource/tmp_report/$user_name*.xls") as $filename) 
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$html=ob_get_contents();
	$name=time();
	$filename="../../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,$html);
	$filename="../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	echo "$total_data****$filename****$report_type";
	exit();
}
if($action=="yarn_cost")
{
	echo load_html_head_contents("Report Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);

	//$exchange_rate=76;
	$costing_per_arr=return_library_array( "select job_no, costing_per_id from wo_pre_cost_dtls where status_active=1 and is_deleted=0", "job_no", "costing_per_id");
	//$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit"  );
	$yarn_count_details=return_library_array( "select id, yarn_count from lib_yarn_count", "id", "yarn_count");
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );

	$dataArrayYarn=array();
	$yarn_sql="select job_no, count_id, copm_one_id, percent_one, copm_two_id, percent_two, type_id, sum(cons_qnty) as qnty, sum(amount) as amount from wo_pre_cost_fab_yarn_cost_dtls where status_active=1 and is_deleted=0 group by job_no, count_id, copm_one_id, percent_one, copm_two_id, percent_two, type_id";
	$resultYarn=sql_select($yarn_sql);
	foreach($resultYarn as $yarnRow)
	{
		$dataArrayYarn[$yarnRow[csf('job_no')]].=$yarnRow[csf('count_id')]."**".$yarnRow[csf('copm_one_id')]."**".$yarnRow[csf('percent_one')]."**".$yarnRow[csf('copm_two_id')]."**".$yarnRow[csf('percent_two')]."**".$yarnRow[csf('type_id')]."**".$yarnRow[csf('qnty')]."**".$yarnRow[csf('amount')].",";
	}

	$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit"  );
	$receive_array=array();
	$sql_receive="select a.prod_id,c.receive_purpose,b.lot,b.color, sum(a.order_qnty) as qty, sum(a.order_amount) as amnt from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 group by a.prod_id,c.receive_purpose,b.lot,b.color";
	$resultReceive = sql_select($sql_receive);
	foreach($resultReceive as $invRow)
	{
		$avg_rate=$invRow[csf('amnt')]/$invRow[csf('qty')];
		$receive_array[$invRow[csf('prod_id')]]=$avg_rate;
		$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose']=$invRow[csf('receive_purpose')];
	}
$yarnData="select b.po_breakdown_id, b.prod_id, a.item_category, b.issue_purpose,c.lot,c.color,
		sum(CASE WHEN a.transaction_type=2 and b.entry_form ='3' and b.trans_type=2 and b.issue_purpose in(2,4,15,38) THEN b.quantity ELSE 0 END) AS yarn_iss_qty,
		sum(CASE WHEN a.transaction_type=2 and b.entry_form ='3' and b.trans_type=2 and b.issue_purpose in(2,4,15,38) THEN b.returnable_qnty ELSE 0 END) AS returnable_qnty,
		(CASE WHEN a.transaction_type=2 and b.entry_form ='3' and b.trans_type=2  THEN a.transaction_date ELSE null END) AS transaction_date,
		sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN b.quantity ELSE 0 END) AS yarn_iss_return_qty,
		sum(CASE WHEN a.transaction_type=5 and b.entry_form ='11' and b.trans_type=5 THEN b.quantity ELSE 0 END) AS trans_in_qty_yarn,
		sum(CASE WHEN a.transaction_type=6 and b.entry_form ='11' and b.trans_type=6 THEN b.quantity ELSE 0 END) AS trans_out_qty_yarn,
		sum(CASE WHEN a.transaction_type=2 and b.entry_form ='25' and b.trans_type=2 THEN a.cons_rate*b.quantity ELSE 0 END) AS trims_issue_amnt
		from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.po_breakdown_id in($po_id)  group by b.po_breakdown_id, b.prod_id, a.item_category,a.transaction_date,a.transaction_type,b.entry_form,b.trans_type,b.issue_purpose,c.lot,c.color";
		 $yarnDataArray=sql_select($yarnData); $yarnTrimsCostArray=array();
	
	foreach($yarnDataArray as $invRow)
	{
					$issue_purpose=$invRow[csf('issue_purpose')];
						//echo $recv_purpose.'<br>';
						$issue_qty=$invRow[csf('yarn_iss_qty')]-$invRow[csf('yarn_iss_return_qty')];
					
						$transaction_date=$invRow[csf('transaction_date')];
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						$currency_rate=set_conversion_rate($usd_id,$conversion_date );
						//echo $currency_rate.'dd';
						if($receive_array[$invRow[csf('prod_id')]]>0)
						{
							$rate=$receive_array[$invRow[csf('prod_id')]];
						}
						else
						{
							$rate=$avg_rate_array[$invRow[csf('prod_id')]]/$currency_rate;
						}
						
						$issue_amnt=$issue_qty*$rate;
						//$retble_iss_amnt=$returnable_qnty*$rate;	
						if($issue_purpose==1)
						{
							$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
							
							if($recv_purpose==16)
							{
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt']+=$issue_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_qty']+=$issue_qty;
								
							}
							
						}
						
		
		$iss_qty=$invRow[csf('yarn_iss_qty')]+$invRow[csf('trans_in_qty_yarn')]-$invRow[csf('yarn_iss_return_qty')]-$invRow[csf('trans_out_qty_yarn')];
		$dataArrayYarnIssue[$invRow[csf('po_breakdown_id')]][1]+=$iss_qty;
		$rate='';
		if($receive_array[$invRow[csf('prod_id')]]>0)
		{
			$rate=$receive_array[$invRow[csf('prod_id')]];
		}
		else
		{
			$rate=$avg_rate_array[$invRow[csf('prod_id')]]/$exchange_rate;
		}
		$dataArrayYarnIssue[$invRow[csf('po_breakdown_id')]][2]+=$iss_qty*$rate;
	}

?>
	<style>
		hr
		{
			color: #676767;
			background-color: #676767;
			height: 1px;
		}
	</style> 
    <div>
        <fieldset style="width:1033px;">
        	<table class="rpt_table" width="1030" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="40">SL</th>
                    <th width="60">Buyer</th>
                    <th width="80">PO No</th>
                    <th width="50">Year</th>
                    <th width="60">Job No</th>
                    <th width="90">Order Qty</th>
                    <th width="70">Count</th>
                    <th width="100">Composition</th>
                    <th width="70">Type</th>
                    <th width="90">Required<br/><font style="font-size:9px; font-weight:100">(As Per Pre-Cost)</font></th>
                    <th width="100">Cost ($)</th>
                    <th width="90">Issued</th>
                    <th>Cost ($)</th>
                </thead>
            </table>	
            <div style="width:1030px; max-height:310px; overflow-y:scroll" id="scroll_body">
                <table class="rpt_table" width="1010" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
					else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
					else $year_field="";//defined Later
						
					$sql="select a.job_no_prefix_num, a.job_no, $year_field, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, b.id, b.po_number, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($po_id) order by b.pub_shipment_date, a.job_no_prefix_num, b.id";
					$result=sql_select($sql);
					$i=1; $tot_po_qnty=0; $tot_mkt_required=0; $tot_required_cost=0; $tot_yarn_iss_qty=0; $tot_yarn_iss_cost=0;
				
					 $condition= new condition();
						if($po_id!='')
						{
							$condition->po_id("in($po_id)"); 
						}
					
					 $condition->init();
				
					 $yarn= new yarn($condition);
					 	// echo $yarn->getQuery(); die;
					$yarn_costing_arr=$yarn->getOrderWiseYarnAmountArray();
					foreach($result as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						$dzn_qnty=0; $job_mkt_required=0; $yarn_issued=0; $yarn_data_array=array(); //$job_mkt_required_cost=0;
						$costing_per_id=$costing_per_arr[$row[csf('job_no')]];
						if($costing_per_id==1)
						{
							$dzn_qnty=12;
						}
						else if($costing_per_id==3)
						{
							$dzn_qnty=12*2;
						}
						else if($costing_per_id==4)
						{
							$dzn_qnty=12*3;
						}
						else if($costing_per_id==5)
						{
							$dzn_qnty=12*4;
						}
						else
						{
							$dzn_qnty=1;
						}
						
						$dzn_qnty=$dzn_qnty*$row[csf('ratio')];
						$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
						$plan_cut_qnty=$row[csf('plan_cut')]*$row[csf('ratio')];
						$tot_po_qnty+=$order_qnty_in_pcs;
						$job_mkt_required_cost=$yarn_costing_arr[$row[csf('id')]];
						
						$dataYarn=explode(",",substr($dataArrayYarn[$row[csf('job_no')]],0,-1));
						foreach($dataYarn as $yarnRow)
						{
							$yarnRow=explode("**",$yarnRow);
							$count_id=$yarnRow[0];
							$copm_one_id=$yarnRow[1];
							$percent_one=$yarnRow[2];
							$copm_two_id=$yarnRow[3];
							$percent_two=$yarnRow[4];
							$type_id=$yarnRow[5];
							$qnty=$yarnRow[6];
							$amnt=$yarnRow[7];
							
							$mkt_required=$plan_cut_qnty*($qnty/$dzn_qnty);
							//$mkt_required_cost=$plan_cut_qnty*($amnt/$dzn_qnty);
							$job_mkt_required+=$mkt_required;
							//$job_mkt_required_cost+=$mkt_required_cost;
							
							$yarn_data_array['count'][]=$yarn_count_details[$count_id];
							$yarn_data_array['type'][]=$yarn_type[$type_id];
							
							if($percent_two!=0)
							{
								$compos=$composition[$copm_one_id]." ".$percent_one." %"." ".$composition[$copm_two_id]." ".$percent_two." %";
							}
							else
							{
								$compos=$composition[$copm_one_id]." ".$percent_one." %"." ".$composition[$copm_two_id];
							}

							$yarn_data_array['comp'][]=$compos;
						}
						
						$yarn_iss_qty=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_qty'];//$dataArrayYarnIssue[$row[csf('id')]][1];
						$yarn_iss_cost=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt'];//$dataArrayYarnIssue[$row[csf('id')]][2];
						
					?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td width="40"><? echo $i; ?></td>
							<td width="60" style="word-break:break-all;"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
                            <td width="80" style="word-break:break-all;"><? echo $row[csf('po_number')]; ?></td>
                            <td width="50" align="center"><? echo $row[csf('year')]; ?></td>
                            <td width="60" align="center"><? echo $row[csf('job_no_prefix_num')]; ?></td>
                            <td width="90" align="right"><? echo $order_qnty_in_pcs; ?></td>
                            <td width="70">
								<? 
                                    $d=1;
                                    foreach($yarn_data_array['count'] as $yarn_count_value)
                                    {
                                        if($d!=1)
                                        {
                                            echo "<hr/>";
                                        }
                                        echo $yarn_count_value;
                                        $d++;
                                    }
                                ?>
                            </td>
                            <td width="100">
                                <div style="word-wrap:break-word; width:100px">
                                    <? 
                                         $d=1;
                                         foreach($yarn_data_array['comp'] as $yarn_composition_value)
                                         {
                                            if($d!=1)
                                            {
                                                echo "<hr/>";
                                            }
                                            echo $yarn_composition_value;
                                            $d++;
                                         }
                                    ?>
                                </div>
                            </td>
                            <td width="70">
                                <p>
                                    <? 
                                         $d=1;
                                         foreach($yarn_data_array['type'] as $yarn_type_value)
                                         {
                                            if($d!=1)
                                            {
                                               echo "<hr/>";
                                            }
                                            
                                            echo $yarn_type_value; 
                                            $d++;
                                         }
                                    ?>
                                </p>
                            </td>
							<td width="90" align="right"><? echo fn_number_format($job_mkt_required,2,'.',''); ?></td>
                            <td width="100" align="right"><? echo fn_number_format($job_mkt_required_cost,2,'.',''); ?></td>
                            <td width="90" align="right"><? echo fn_number_format($yarn_iss_qty,2,'.',''); ?></td>
                            <td align="right" ><? echo fn_number_format($yarn_iss_cost,2,'.',''); ?></td>
						</tr>
					<?
						$i++;
						$tot_mkt_required+=$job_mkt_required; 
						$tot_required_cost+=$job_mkt_required_cost;
						$tot_yarn_iss_qty+=$yarn_iss_qty; 
						$tot_yarn_iss_cost+=$yarn_iss_cost; 
					}
					?>
                	<tfoot>
                        <th colspan="5">Total</th>
                        <th><? echo $tot_po_qnty; ?></th>
                        <th colspan="3">&nbsp;</th>
                        <th><? echo fn_number_format($tot_mkt_required,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_required_cost,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_yarn_iss_qty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_yarn_iss_cost,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
        </fieldset>
    </div>
<?
	exit();
}

if($action=="mkt_yarn_cost")
{
	echo load_html_head_contents("Report Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count"  );
	$color_library=return_library_array( "select id,color_name from lib_color", "id", "color_name"  );
	$data=explode("**",$mkt_data);
	$po_ids=$data[0];
	$job_nos=rtrim($data[1],',');
	//echo $po_ids.'='.$job_nos;
	$job_nos=array_unique(explode(",",$job_nos));$po_nos=array_unique(explode(",",$po_ids));
	$job_noss='';
	foreach($job_nos as $job)
	{
		if($job_noss=='') $job_noss="'".$job."'"; else $job_noss.=","."'".$job."'";
	}
	$job_noss=implode(',',array_unique(explode(",",$job_noss)));
	$po_no=str_replace("'","",$po_ids);
	$condition= new condition();
	if(str_replace("'","",$job_noss) !=''){
		 // $condition->job_no("=$job_noss");
	 }
	  if(str_replace("'","",$po_no)!='')
	 {
		$condition->po_id("in($po_no)"); 
	 }
	  $condition->init();
   $yarn= new yarn($condition);
   //echo $yarn->getQuery(); die;
  $yarn_costing_arr=$yarn->getOrderCountCompositionColorAndTypeWiseYarnAmountArray();
	//print_r($yarn_costing_arr);
	$sql = "select min(id) as id, count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, min(cons_ratio) as cons_ratio, sum(cons_qnty) as cons_qnty, rate, sum(amount) as amount from wo_pre_cost_fab_yarn_cost_dtls where job_no in($job_noss) group by count_id, copm_one_id, percent_one, copm_two_id, percent_two, color,type_id, rate";
 $data_array=sql_select($sql); 
?>

    <div align="center">
        <fieldset style="width:620px;">
        	<table class="rpt_table" width="600" cellpadding="0" cellspacing="0" border="1" rules="all">
            <caption> <h3> Grey Yarn Details</h3></caption>
            	<thead>
                    <th width="60">SL</th>
                   <th width="350">Yarn Desc </th>
                    <th width="">Yarn Cost</th>
                </thead>
                <tbody> 
                <?
				//order,Count,Composition,color,type wise
                  $total_yarn_amount=0;$k=1;
			foreach( $data_array as $row )
            { 
				if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				if($row[csf("percent_one")]==100)
					$item_descrition = $lib_yarn_count[$row[csf("count_id")]]." ".$composition[$row[csf("copm_one_id")]]." ".$row[csf("percent_one")]."% ".$color_library[$row[csf("color")]]." ".$yarn_type[$row[csf("type_id")]];
            	else
					$item_descrition = $lib_yarn_count[$row[csf("count_id")]]." ".$composition[$row[csf("copm_one_id")]]." ".$row[csf("percent_one")]."% ".$composition[$row[csf("copm_two_id")]]." ".$row[csf("percent_two")]."% ".$color_library[$row[csf("color")]]." ".$yarn_type[$row[csf("type_id")]];
					
 				
				$yarn_cost=0;
				foreach($po_nos as $pid)
				{
				 $yarn_cost+=$yarn_costing_arr[$pid][$row[csf("count_id")]][$row[csf("copm_one_id")]][$row[csf("color")]][$row[csf("type_id")]];	
				}
			?>	
            
				
                  <tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $k; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $k; ?>">
                	<td align="center" style="padding-right:3px"><? echo $k; ?></td>
                  <td align="center" style="padding-right:3px"><? echo $item_descrition; ?></td>
                    <td align="right" style="padding-right:3px"><? echo fn_number_format($yarn_cost,2); ?></td>
                </tr>
               
                <?
				$k++;
				$total_yarn_amount+=$yarn_cost;
			}
				?>
                </tbody>
                <tfoot>
                 <th colspan="2" align="right"> Total</th><th align="right"> <? echo fn_number_format($total_yarn_amount,2);?></th>
                 </tfoot>
            </table>	
        </fieldset>
    </div>
<?
	exit();
}
if($action=="mkt_yarn_dyeing_twisting_cost") 
{
	echo load_html_head_contents("Report Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	$data=explode("**",$mkt_data);
	$po_ids=$data[0];
	$job_nos=rtrim($data[1],',');
	//echo $po_ids.'='.$job_nos;
	$job_nos=array_unique(explode(",",$job_nos));$po_nos=array_unique(explode(",",$po_ids));
	$job_noss='';
	foreach($job_nos as $job)
	{
		if($job_noss=='') $job_noss="'".$job."'"; else $job_noss.=","."'".$job."'";
	}
	$job_noss=implode(',',array_unique(explode(",",$job_noss)));
	$po_no=str_replace("'","",$po_ids);
	$condition= new condition();
	if(str_replace("'","",$job_noss) !=''){
		 // $condition->job_no("=$job_noss");
	 }
	  if(str_replace("'","",$po_no)!='')
	 {
		$condition->po_id("in($po_no)"); 
	 }
	  $condition->init();
   $conversion= new conversion($condition);
   //echo $yarn->getQuery(); die;
  $conversion_costing_arr=$conversion->getAmountArray_by_orderAndProcess();
	//print_r($yarn_costing_arr);
	?>
    <script>
    function print_window()
	{
		document.getElementById('scroll_body').style.overflow="auto";
		document.getElementById('scroll_body').style.maxHeight="none";
		
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../../css/style_common.css" type="text/css" /><title></title></head><body>'+document.getElementById('main_body').innerHTML+'</body</html>');
	
		d.close();
		document.getElementById('scroll_body').style.overflowY="scroll";
		document.getElementById('scroll_body').style.maxHeight="290px";
	}
	
    </script>
    <input type="hidden" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/>
    <div id="main_body" style="width:400px;">
     <fieldset style="width:400px;">
        	<table class="rpt_table" width="400" cellpadding="0" cellspacing="0" id="table_search" border="1" rules="all" >
             <caption> <h3> Yarn Value Addition Cost </h3></caption>
            	<thead>
                	<th width="50">SL</th>
                    <th width="250">Process</th>
                    <th width="100">Amount</th>
                </thead>
                <tbody id="scroll_body">
                	<?
					$k=1;$total_conversion_cost=0;
					$sql = "select  a.cons_process	from wo_pre_cost_fab_conv_cost_dtls a left join wo_pre_cost_fabric_cost_dtls b on a.job_no=b.job_no and a.fabric_description=b.id
			where a.job_no in(".$job_noss.") and a.cons_process in(30,134)  group by a.cons_process ";
	$data_array=sql_select($sql);
					foreach($data_array as $row)
					{
						if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$conversion_cost=0;
						foreach($po_nos as $pid)
						{
						 $conversion_cost+=array_sum($conversion_costing_arr[$pid][$row[csf("cons_process")]]);	
						}
					?>
                  <tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $k; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $k; ?>">
                    <td align="center"><? echo $k; ?></td>
                    <td align="left"><? echo $conversion_cost_head_array[$row[csf("cons_process")]]; ?></td>
                    <td align="right"><? echo fn_number_format($conversion_cost,4); ?></td>
                    </tr>
                    <?
					$k++;
						$total_conversion_cost+=$conversion_cost;
					}
					?>
                    </tbody>
                <tfoot>
                 <th colspan="2" align="right"> Total</th><th align="right"> <? echo fn_number_format($total_conversion_cost,2);?></th>
                 </tfoot>
               </table>
           </table>
  </fieldset>
  <script>
  setFilterGrid("table_search",-1);
  </script>
    </div>
	<?
	exit();
}


if($action=="knitting_cost") //mkt_yarn_dyeing_twisting_cost
{
	echo load_html_head_contents("Report Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	
	$exchange_rate=76;
	$costing_per_arr=return_library_array( "select job_no, costing_per_id from wo_pre_cost_dtls where status_active=1 and is_deleted=0", "job_no", "costing_per_id");
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	
	$subconInBillDataArray=sql_select("select b.order_id, sum(b.amount) AS knit_bill, sum(b.delivery_qty) as qty from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b where a.id=b.mst_id and b.order_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.party_source=1 and a.process_id=2 group by b.order_id");
	foreach($subconInBillDataArray as $subRow)
	{
		$subconCostArray[$subRow[csf('order_id')]]['amnt']=$subRow[csf('knit_bill')];
		$subconCostArray[$subRow[csf('order_id')]]['qty']=$subRow[csf('qty')];
	}	
	
	$subconOutBillDataArray=sql_select("select b.order_id, sum(b.amount) AS knit_bill, sum(b.receive_qty) as qty from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.process_id=2 and b.order_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.order_id");
	foreach($subconOutBillDataArray as $subRow)
	{
		//$subconCostArray[$subRow[csf('order_id')]]['amnt']+=$subRow[csf('knit_bill')];
		//$subconCostArray[$subRow[csf('order_id')]]['qty']+=$subRow[csf('qty')];
	}
	
	$bookingArray=return_library_array( "select b.po_break_down_id, sum(b.grey_fab_qnty) as qnty from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id in($po_id) and a.item_category in(2,13) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.po_break_down_id", "po_break_down_id", "qnty");
	
	$greyProdArray=return_library_array( "select po_breakdown_id, sum(quantity) as qnty from order_wise_pro_details where po_breakdown_id in($po_id) and entry_form=2 and status_active=1 and is_deleted=0 group by po_breakdown_id", "po_breakdown_id", "qnty");
	
	$knitCostArray=return_library_array( "select job_no, sum(amount) AS knit_charge from wo_pre_cost_fab_conv_cost_dtls where cons_process=1 and status_active=1 and is_deleted=0 group by job_no", "job_no", "knit_charge");
?>
	<script>
    function print_window()
	{
		document.getElementById('scroll_body').style.overflow="auto";
		document.getElementById('scroll_body').style.maxHeight="none";
		
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../../css/style_common.css" type="text/css" /><title></title></head><body>'+document.getElementById('main_body').innerHTML+'</body</html>');
	
		d.close();
		document.getElementById('scroll_body').style.overflowY="scroll";
		document.getElementById('scroll_body').style.maxHeight="290px";
	}
	function openmypage_bill(po_id,type,tittle)
	{
		emailwindow=dhtmlmodal.open('EmailBox', 'iframe', 'post_costing_report_v3_controller.php?po_id='+po_id+'&action='+type, tittle, 'width=560px, height=350px, center=1, resize=0, scrolling=0', '../../../');
	}
    </script>
    <input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/>
    <div id="main_body" style="width:1050px;">
        <fieldset style="width:1050px;">
        	<table class="rpt_table" width="1030" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="40">SL</th>
                    <th width="60">Buyer</th>
                    <th width="80">PO No</th>
                    <th width="50">Year</th>
                    <th width="60">Job No</th>
                    <th width="80">Style Name</th>
                    <th width="110">Gmts Item</th>
                    <th width="90">Order Qty</th>
                    <th width="80">Booking Qty</th>
                    <th width="80">Grey Prod.</th>
                    <th width="90">Knitting Cost</th>
                    <th width="80">Fabric Bill Qty</th>
                    <th>Bill Amount (USD)</th>
                </thead>
            </table>	
            <div style="width:1050px; max-height:290px; overflow-y:scroll" id="scroll_body">
                <table class="rpt_table" width="1030" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
					else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
					else $year_field="";//defined Later
						
					$sql="select a.job_no_prefix_num, a.job_no, $year_field, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, b.id, b.po_number, b.pub_shipment_date, b.po_quantity, b.unit_price, b.po_total_price, b.shiping_status from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($po_id) order by b.pub_shipment_date";
					$result=sql_select($sql);
					$i=1; $tot_po_qnty=0; $tot_booking_qnty=0; $tot_greyProd_qnty=0; $tot_knitCost=0; $tot_knitbill=0; $tot_knitQty=0;
					foreach($result as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$gmts_item='';
						$gmts_item_id=explode(",",$row[csf('gmts_item_id')]);
						foreach($gmts_item_id as $item_id)
						{
							if($gmts_item=="") $gmts_item=$garments_item[$item_id]; else $gmts_item.=",".$garments_item[$item_id];
						}
						
						$dzn_qnty=0;
						$costing_per_id=$costing_per_arr[$row[csf('job_no')]];
						if($costing_per_id==1)
						{
							$dzn_qnty=12;
						}
						else if($costing_per_id==3)
						{
							$dzn_qnty=12*2;
						}
						else if($costing_per_id==4)
						{
							$dzn_qnty=12*3;
						}
						else if($costing_per_id==5)
						{
							$dzn_qnty=12*4;
						}
						else
						{
							$dzn_qnty=1;
						}
						
						$dzn_qnty=$dzn_qnty*$row[csf('ratio')];
						$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
						$tot_po_qnty+=$order_qnty_in_pcs;
						$bookingQty=$bookingArray[$row[csf('id')]];
						$tot_booking_qnty+=$bookingQty;
						$greyProdQty=$greyProdArray[$row[csf('id')]];
						$tot_greyProd_qnty+=$greyProdQty;
						$knitCost=($order_qnty_in_pcs/$dzn_qnty)*$knitCostArray[$row[csf('job_no')]];
						$tot_knitCost+=$knitCost;
						$knitQty=$subconCostArray[$row[csf('id')]]['qty'];
						$knitbill=$subconCostArray[$row[csf('id')]]['amnt']/$exchange_rate;
						$tot_knitQty+=$knitQty;
						$tot_knitbill+=$knitbill;
						
					?>
						<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">
							<td width="40"><? echo $i; ?></td>
							<td width="60" style="word-break:break-all;"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
                            <td width="80" style="word-break:break-all;"><? echo $row[csf('po_number')]; ?></td>
                            <td width="50" align="center"><? echo $row[csf('year')]; ?></td>
                            <td width="60" align="center"><? echo $row[csf('job_no_prefix_num')]; ?></td>
                            <td width="80" style="word-break:break-all;"><? echo $row[csf('style_ref_no')]; ?></td>
                            <td width="110" style="word-break:break-all;"><? echo $gmts_item; ?></td>
                            <td width="90" align="right"><? echo $order_qnty_in_pcs; ?></td>
							<td width="80" align="right"><? echo fn_number_format($bookingQty,2,'.',''); ?></td>
							<td width="80" align="right"><? echo fn_number_format($greyProdQty,2,'.',''); ?></td>
                            <td width="90" align="right"><? echo fn_number_format($knitCost,2,'.',''); ?></td>
							<td width="80" align="right"><? echo fn_number_format($knitQty,2,'.',''); ?></td>
							<td align="right"><a href="##" onClick="openmypage_bill('<? echo $row[csf('id')]; ?>','knitting_bill','Knitting bill Details')"><? echo fn_number_format($knitbill,2,'.',''); ?></a></td>
						</tr>
					<?
					$i++;
					}
					?>
                	<tfoot>
                        <th colspan="7">Total</th>
                        <th><? echo $tot_po_qnty; ?></th>
                        <th><? echo fn_number_format($tot_booking_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_greyProd_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_knitCost,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_knitQty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_knitbill,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
        </fieldset>
    </div>
<?
	exit();
}

if($action=="knitting_bill")
{
	echo load_html_head_contents("Report Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	$exchange_rate=76;
	$costing_per_arr=return_library_array( "select job_no, costing_per_id from wo_pre_cost_dtls where status_active=1 and is_deleted=0", "job_no", "costing_per_id");
	
	$subconInBillDataArray=sql_select("select a.id as mst_id, a.bill_no, a.company_id, a.party_source, sum(b.delivery_qty) as qty, sum(b.amount) AS knit_bill from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b where a.id=b.mst_id and b.order_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.party_source=1 and a.process_id=2 group by a.id, a.bill_no, a.company_id, a.party_source");// b.order_id, b.currency_id
	/*foreach($subconInBillDataArray as $subRow)
	{
		$subconCostArray[$subRow[csf('order_id')]]['amnt']=$subRow[csf('knit_bill')];
		$subconCostArray[$subRow[csf('order_id')]]['qty']=$subRow[csf('qty')];
	}*/	
	
	$subconOutBillDataArray=sql_select("select a.id as mst_id, a.bill_no, sum(b.receive_qty) as qty, sum(b.amount) AS knit_bill from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.process_id=2 and b.order_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.id, a.bill_no");// b.order_id, b.currency_id
	/*foreach($subconOutBillDataArray as $subRow)
	{
		$subconCostArray[$subRow[csf('order_id')]]['amnt']+=$subRow[csf('knit_bill')];
		$subconCostArray[$subRow[csf('order_id')]]['qty']+=$subRow[csf('qty')];
	}*/
	
	
	$bookingArray=return_library_array( "select b.po_break_down_id, sum(b.grey_fab_qnty) as qnty from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id in($po_id) and a.item_category in(2,13) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.po_break_down_id", "po_break_down_id", "qnty");
	
	$greyProdArray=return_library_array( "select po_breakdown_id, sum(quantity) as qnty from order_wise_pro_details where po_breakdown_id in($po_id) and entry_form=2 and status_active=1 and is_deleted=0 group by po_breakdown_id", "po_breakdown_id", "qnty");
	
	$knitCostArray=return_library_array( "select job_no, sum(amount) AS knit_charge from wo_pre_cost_fab_conv_cost_dtls where cons_process=1 and status_active=1 and is_deleted=0 group by job_no", "job_no", "knit_charge");
?>
	<script>
    function print_window()
	{
		document.getElementById('scroll_body').style.overflow="auto";
		document.getElementById('scroll_body').style.maxHeight="none";
		document.getElementById('scroll_body2').style.overflow="auto";
		document.getElementById('scroll_body2').style.maxHeight="none";
		
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../../css/style_common.css" type="text/css"/><title></title></head><body>'+document.getElementById('main_body').innerHTML+'</body</html>');
	
		d.close();
		document.getElementById('scroll_body').style.overflowY="scroll";
		document.getElementById('scroll_body').style.maxHeight="290px";
		document.getElementById('scroll_body2').style.overflowY="scroll";
		document.getElementById('scroll_body2').style.maxHeight="290px";
	}
	
	function print_report(data,party_source)
	{
		//alert("su..re");
		var report_title="Knitting Bill";
		var show_val_column='';
		if(party_source==1)
		{
			var r=confirm("Press \"OK\" to open with Order Comments\nPress \"Cancel\" to open without Order Comments");
			if (r==true)
			{
				show_val_column="1";
			}
			else
			{
				show_val_column="0";
			}
		}
		else show_val_column="0";
		var data=data+"*"+report_title+"*"+show_val_column;
		window.open("../../../../subcontract_bill/requires/knitting_bill_issue_controller.php?data="+data+'&action=knitting_bill_print', true );
	}
    </script>
    <input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/>
    <div id="main_body" style="width:470px;">
    
        <fieldset style="width:470px;">
        <legend>In Bound Bill</legend>
        	<table class="rpt_table" width="450" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="50">SL</th>
                    <th width="150">Bill No</th>
                    <th width="100">Bill Quantity</th>
                    <th>Bill Amount (USD)</th>
                </thead>
            </table>	
            <div style="width:470px; max-height:290px; overflow-y:scroll" id="scroll_body">
                <table class="rpt_table" width="450" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					$i=1;
					$tot_bill_qnty=$tot_bill_amt=0;
					foreach($subconInBillDataArray as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$knitbill=$row[csf('knit_bill')]/$exchange_rate;
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td width="50"><? echo $i; ?></td>
							<td width="150" style="word-break:break-all;"><a href="##" onClick="print_report('<?php echo $row[csf('company_id')]."*".$row[csf('mst_id')]."*".$row[csf('bill_no')]; ?>','<?php echo $row[csf('party_source')]; ?>')"><? echo $row[csf('bill_no')]; ?></a></td>
                            <td width="100" align="right"><? echo fn_number_format($row[csf('qty')],2,'.',''); $tot_bill_qnty+=$row[csf('qty')]; ?></td>
							<td align="right"><? echo fn_number_format($knitbill,2,'.',''); $tot_bill_amt+=$knitbill; ?></td>
						</tr>
						<?
                        $i++;
					}
					?>
                	<tfoot>
                        <th colspan="2">Total</th>
                        <th><? echo fn_number_format($tot_bill_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_bill_amt,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
            <br>
        <legend>Out Bound Bill</legend>
        	<table class="rpt_table" width="450" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="50">SL</th>
                    <th width="150">Bill No</th>
                    <th width="100">Bill Quantity</th>
                    <th>Bill Amount (USD)</th>
                </thead>
            </table>	
            <div style="width:470px; max-height:290px; overflow-y:scroll" id="scroll_body2">
                <table class="rpt_table" width="450" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					$i=1;
					$tot_bill_qnty=$tot_bill_amt=0;
					foreach($subconOutBillDataArray as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$knitbill=$row[csf('knit_bill')]/$exchange_rate;	
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td width="50"><? echo $i; ?></td>
							<td width="150" style="word-break:break-all;"><? echo $row[csf('bill_no')]; ?></td>
                            <td width="100" align="right"><? echo fn_number_format($row[csf('qty')],2,'.',''); $tot_bill_qnty+=$row[csf('qty')]; ?></td>
							<td align="right"><? echo fn_number_format($knitbill,2,'.',''); $tot_bill_amt+=$knitbill; ?></td>
						</tr>
						<?
                        $i++;
					}
					?>
                	<tfoot>
                        <th colspan="2">Total</th>
                        <th><? echo fn_number_format($tot_bill_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_bill_amt,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
        </fieldset>
    </div>
<?
	exit();
}

if($action=="dye_fin_cost")
{
	echo load_html_head_contents("Report Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	
	$exchange_rate=76;
	$costing_per_arr=return_library_array( "select job_no, costing_per_id from wo_pre_cost_dtls where status_active=1 and is_deleted=0", "job_no", "costing_per_id");
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	
	$subconInBillDataArray=sql_select("select b.order_id, sum(b.amount) AS knit_bill, sum(b.delivery_qty) as qty from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b where a.id=b.mst_id and b.order_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.party_source=1 and a.process_id=4 group by b.order_id");
	foreach($subconInBillDataArray as $subRow)
	{
		$subconCostArray[$subRow[csf('order_id')]]['amnt']=$subRow[csf('knit_bill')];
		$subconCostArray[$subRow[csf('order_id')]]['qty']=$subRow[csf('qty')];
	}	
	
	$subconOutBillDataArray=sql_select("select b.order_id, sum(b.amount) AS knit_bill, sum(b.receive_qty) as qty from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.process_id=4 and b.order_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.order_id");
	foreach($subconOutBillDataArray as $subRow)
	{
		$subconCostArray[$subRow[csf('order_id')]]['amnt']+=$subRow[csf('knit_bill')];
		$subconCostArray[$subRow[csf('order_id')]]['qty']+=$subRow[csf('qty')];
	}
	
	$bookingArray=array();
	$bookingDataArray=sql_select( "select b.po_break_down_id, sum(b.grey_fab_qnty) as grey_qnty, sum(b.fin_fab_qnty) as qnty from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id in($po_id) and a.item_category in(2,13) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.po_break_down_id");
	foreach($bookingDataArray as $bokRow)
	{
		$bookingArray[$bokRow[csf('po_break_down_id')]]['grey']=$bokRow[csf('grey_qnty')];
		$bookingArray[$bokRow[csf('po_break_down_id')]]['fin']=$bokRow[csf('qnty')];
	}
	
	$finProdArray=return_library_array( "select po_breakdown_id, sum(quantity) as qnty from order_wise_pro_details where po_breakdown_id in($po_id) and entry_form=7 and status_active=1 and is_deleted=0 group by po_breakdown_id", "po_breakdown_id", "qnty");
	
	$finCostArray=return_library_array( "select job_no, sum(amount) AS dye_fin_charge from wo_pre_cost_fab_conv_cost_dtls where cons_process not in(1,2,30,35) and status_active=1 and is_deleted=0 group by job_no", "job_no", "dye_fin_charge");

?>
<script>
	function openmypage_bill(po_id,type,tittle)
	{
		//alert("su..re"); return;
		emailwindow=dhtmlmodal.open('EmailBox', 'iframe', 'post_costing_report_v3_controller.php?po_id='+po_id+'&action='+type, tittle, 'width=560px, height=350px, center=1, resize=0, scrolling=0', '../../../');
	}
</script>
    <div>
        <fieldset style="width:1113px;">
        	<table class="rpt_table" width="1110" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="40">SL</th>
                    <th width="60">Buyer</th>
                    <th width="80">PO No</th>
                    <th width="50">Year</th>
                    <th width="60">Job No</th>
                    <th width="80">Style Name</th>
                    <th width="110">Gmts Item</th>
                    <th width="90">Order Qty</th>
                    <th width="80">Booking Qty(Grey)</th>
                    <th width="80">Booking Qty(Fin)</th>
                    <th width="80">Finish Prod.</th>
                    <th width="90">Dye & Fin Cost</th>
                    <th width="80">Fabric Bill Qty</th>
                    <th>Bill Amount (USD)</th>
                </thead>
            </table>	
            <div style="width:1110px; max-height:290px; overflow-y:scroll" id="scroll_body">
                <table class="rpt_table" width="1090" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					/*$po_ids=count(array_unique(explode(",",$po_id)));
					//echo $all_po_id;
					$all_po_ids=chop($all_po_id,','); $poIds_cond="";
					//print_r($all_po_ids);
					if($db_type==2 && $po_ids>990)
					{
						$poIds_cond=" and (";
						$poIdsArr=array_chunk(explode(",",$all_po_ids),990);
						//print_r($gate_outIds);
						foreach($poIdsArr as $ids)
						{
							$ids=implode(",",$ids);
							$poIds_cond.=" po_id  in($ids) or ";
						}
						$poIds_cond=chop($poIds_cond,'or ');
						$poIds_cond.=")";
					}
					else
					{
						$poIds_cond=" and  po_id  in($all_po_id)";
					}*/
					if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
					else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
					else $year_field="";//defined Later
						
					$sql="select a.job_no_prefix_num, a.job_no, $year_field, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, b.id, b.po_number, b.pub_shipment_date, b.po_quantity, b.plan_cut , b.unit_price, b.po_total_price, b.shiping_status from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($po_id) order by b.pub_shipment_date";
					$result=sql_select($sql);
					$i=1; $tot_po_qnty=0; $tot_booking_qnty=0; $tot_finProd_qnty=0; $tot_finCost=0; $tot_finbill=0; $tot_knitQty=0;
					$condition= new condition();
					
					/* $poids=explode(",",$po_id);
					 foreach( $poids as $po)
					 {
						$condition->po_id(" in($po)");  
					 }*/
					if(trim(str_replace("'","",$po_id))!='')
					 {
						$condition->po_id(" in($po_id)"); 
					 }
					  $condition->init();
					  $conversion= new conversion($condition);
					//  echo $conversion->getQuery();
				 	$conversion_costing_arr_process=$conversion->getAmountArray_by_orderAndProcess();
					
					  
					foreach($result as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$gmts_item='';
						$gmts_item_id=explode(",",$row[csf('gmts_item_id')]);
						foreach($gmts_item_id as $item_id)
						{
							if($gmts_item=="") $gmts_item=$garments_item[$item_id]; else $gmts_item.=",".$garments_item[$item_id];
						}
						
						$dzn_qnty=0;
						$costing_per_id=$costing_per_arr[$row[csf('job_no')]];
						if($costing_per_id==1)
						{
							$dzn_qnty=12;
						}
						else if($costing_per_id==3)
						{
							$dzn_qnty=12*2;
						}
						else if($costing_per_id==4)
						{
							$dzn_qnty=12*3;
						}
						else if($costing_per_id==5)
						{
							$dzn_qnty=12*4;
						}
						else
						{
							$dzn_qnty=1;
						}
						
						$dzn_qnty=$dzn_qnty*$row[csf('ratio')];
						$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
						$tot_po_qnty+=$order_qnty_in_pcs;
						
						$plun_qnty_in_pcs=$row[csf('plan_cut')]*$row[csf('ratio')];
						
						$bookingQty=$bookingArray[$row[csf('id')]]['fin'];
						$tot_booking_qnty+=$bookingQty;
						
						$bookingQtyGrey=$bookingArray[$row[csf('id')]]['grey'];
						$tot_booking_grey_qnty+=$bookingQtyGrey;
						
						$finProdQty=$finProdArray[$row[csf('id')]];
						$tot_finProd_qnty+=$finProdQty;
						
						$finCost=0;$not_yarn_dyed_cost_arr=array(1,2,30,35);
						foreach($conversion_cost_head_array as $process_id=>$val)
						{
							if(!in_array($process_id,$not_yarn_dyed_cost_arr))
							{
								$finCost+=array_sum($conversion_costing_arr_process[$row[csf('id')]][$process_id]);
							}
						}	
						//$finCost=($order_qnty_in_pcs/$dzn_qnty)*$finCostArray[$row[csf('job_no')]];
						//$finCost=($plun_qnty_in_pcs/$dzn_qnty)*$finCostArray[$row[csf('job_no')]];
						$tot_finCost+=$finCost;
						
						$finQty=$subconCostArray[$row[csf('id')]]['qty'];
						$finbill=$subconCostArray[$row[csf('id')]]['amnt']/$exchange_rate;
						
						$tot_finQty+=$finQty;
						$tot_finbill+=$finbill;
						
						
					?>
						<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">
							<td width="40"><? echo $i; ?></td>
							<td width="60" style="word-break:break-all;"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
                            <td width="80" style="word-break:break-all;"><? echo $row[csf('po_number')]; ?></td>
                            <td width="50" align="center"><? echo $row[csf('year')]; ?></td>
                            <td width="60" align="center"><? echo $row[csf('job_no_prefix_num')]; ?></td>
                            <td width="80" style="word-break:break-all;"><? echo $row[csf('style_ref_no')]; ?></td>
                            <td width="110" style="word-break:break-all;"><? echo $gmts_item; ?></td>
                            <td width="90" align="right"><? echo $order_qnty_in_pcs; ?></td>
							<td width="80" align="right"><? echo fn_number_format($bookingQtyGrey,2,'.',''); ?></td>
                            <td width="80" align="right"><? echo fn_number_format($bookingQty,2,'.',''); ?></td>
							<td width="80" align="right"><? echo fn_number_format($finProdQty,2,'.',''); ?></td>
                            <td width="90" align="right"><? echo fn_number_format($finCost,2,'.',''); ?></td>
							<td width="80" align="right"><? echo fn_number_format($finQty,2,'.',''); ?></td>
							<td align="right"><a href="##" onClick="openmypage_bill('<? echo $row[csf('id')]; ?>','dyeing_bill','Dyeing bill Details')"><? echo fn_number_format($finbill,2,'.',''); ?></a></td>
						</tr>
					<?
					$i++;
					}
					?>
                	<tfoot>
                        <th colspan="7">Total</th>
                        <th><? echo $tot_po_qnty; ?></th>
                        <th><? echo fn_number_format($tot_booking_grey_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_booking_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_finProd_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_finCost,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_finQty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_finbill,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
        </fieldset>
    </div>
<?
	exit();
}

if($action=="dyeing_bill")
{
	echo load_html_head_contents("Report Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	$exchange_rate=76;
	$costing_per_arr=return_library_array( "select job_no, costing_per_id from wo_pre_cost_dtls where status_active=1 and is_deleted=0", "job_no", "costing_per_id");
	
	$subconInBillDataArray=sql_select("select a.id as mst_id, a.bill_no, a.company_id, a.party_source, sum(b.delivery_qty) as qty, sum(b.amount) AS knit_bill from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b where a.id=b.mst_id and b.order_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.party_source=1 and a.process_id=4 group by a.id, a.bill_no, a.company_id, a.party_source");//, b.order_id, b.currency_id
	
	$subconOutBillDataArray=sql_select("select a.id as mst_id, a.bill_no, sum(b.receive_qty) as qty, sum(b.amount) AS knit_bill from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.process_id=4 and b.order_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.id, a.bill_no");//, b.currency_id, b.order_id
	
	$bookingArray=return_library_array( "select b.po_break_down_id, sum(b.grey_fab_qnty) as qnty from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id in($po_id) and a.item_category in(2,13) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.po_break_down_id", "po_break_down_id", "qnty");
	
	$greyProdArray=return_library_array( "select po_breakdown_id, sum(quantity) as qnty from order_wise_pro_details where po_breakdown_id in($po_id) and entry_form=2 and status_active=1 and is_deleted=0 group by po_breakdown_id", "po_breakdown_id", "qnty");
	
	$knitCostArray=return_library_array( "select job_no, sum(amount) AS knit_charge from wo_pre_cost_fab_conv_cost_dtls where cons_process=1 and status_active=1 and is_deleted=0 group by job_no", "job_no", "knit_charge");
?>
	<script>
    function print_window()
	{
		document.getElementById('scroll_body').style.overflow="auto";
		document.getElementById('scroll_body').style.maxHeight="none";
		document.getElementById('scroll_body2').style.overflow="auto";
		document.getElementById('scroll_body2').style.maxHeight="none";
		
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../../css/style_common.css" type="text/css"/><title></title></head><body>'+document.getElementById('main_body').innerHTML+'</body</html>');
	
		d.close();
		document.getElementById('scroll_body').style.overflowY="scroll";
		document.getElementById('scroll_body').style.maxHeight="290px";
		document.getElementById('scroll_body2').style.overflowY="scroll";
		document.getElementById('scroll_body2').style.maxHeight="290px";
	}
	
	function print_report(data)
	{
		//alert("su..re");
		var report_title="Dyeing And Finishing Bill";
		var show_val_column=1;
		var data=data+"*"+report_title+"*"+show_val_column;
		window.open("../../../../subcontract_bill/requires/sub_fabric_finishing_bill_issue_controller.php?data="+data+'&action=fabric_finishing_print', true );
	}
	
    </script>
    <input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/>
    <div id="main_body" style="width:470px;">
        <fieldset style="width:470px;">
        <legend>In Bound Bill</legend>
        	<table class="rpt_table" width="450" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="50">SL</th>
                    <th width="150">Bill No</th>
                    <th width="100">Bill Quantity</th>
                    <th>Bill Amount (USD)</th>
                </thead>
            </table>	
            <div style="width:470px; max-height:290px; overflow-y:scroll" id="scroll_body">
                <table class="rpt_table" width="450" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					$i=1;
					$tot_bill_qnty=$tot_bill_amt=0;
					foreach($subconInBillDataArray as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$knitbill=$row[csf('knit_bill')]/$exchange_rate;
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td width="50"><? echo $i; ?></td>
							<td width="150" style="word-break:break-all;"><a href="##" onClick="print_report('<?php echo $row[csf('company_id')]."*".$row[csf('mst_id')]."*".$row[csf('bill_no')]; ?>')"><? echo $row[csf('bill_no')]; ?></a></td>
                            <td width="100" align="right"><? echo fn_number_format($row[csf('qty')],2,'.',''); $tot_bill_qnty+=$row[csf('qty')]; ?></td>
							<td align="right"><? echo fn_number_format($knitbill,2,'.',''); $tot_bill_amt+=$knitbill; ?></td>
						</tr>
						<?
                        $i++;
					}
					?>
                	<tfoot>
                        <th colspan="2">Total</th>
                        <th><? echo fn_number_format($tot_bill_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_bill_amt,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
            <br>
        <legend>Out Bound Bill</legend>
        	<table class="rpt_table" width="450" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="50">SL</th>
                    <th width="150">Bill No</th>
                    <th width="100">Bill Quantity</th>
                    <th>Bill Amount (USD)</th>
                </thead>
            </table>	
            <div style="width:470px; max-height:290px; overflow-y:scroll" id="scroll_body2">
                <table class="rpt_table" width="450" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					$i=1;
					$tot_bill_qnty=$tot_bill_amt=0;
					foreach($subconOutBillDataArray as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$knitbill=$row[csf('knit_bill')]/$exchange_rate;	
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td width="50"><? echo $i; ?></td>
							<td width="150" style="word-break:break-all;"><? echo $row[csf('bill_no')]; ?></td>
                            <td width="100" align="right"><? echo fn_number_format($row[csf('qty')],2,'.',''); $tot_bill_qnty+=$row[csf('qty')]; ?></td>
							<td align="right"><? echo fn_number_format($knitbill,2,'.',''); $tot_bill_amt+=$knitbill; ?></td>
						</tr>
						<?
                        $i++;
					}
					?>
                	<tfoot>
                        <th colspan="2">Total</th>
                        <th><? echo fn_number_format($tot_bill_qnty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_bill_amt,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
        </fieldset>
    </div>
	<?
	exit();
}

if($action=="yarn_cost_actual")
{
	echo load_html_head_contents("Yarn Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);
	
	$supplier_array=return_library_array( "select id, short_name from lib_supplier", "id", "short_name"  );
	
	$sql_wo_fab="select a.id,a.item_category,a.booking_no,a.booking_type,a.is_short,b.job_no,b.po_break_down_id as po_id from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no  and a.item_category in(2,3) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0  and b.po_break_down_id in($po_id)";
	$result_fab_result=sql_select( $sql_wo_fab );
	foreach ($result_fab_result as $row)
	{
			$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
			$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
			$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
			$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
			$job_no=$row[csf('job_no')];
	}
	unset($result_fab_result);
	?>
	<script>

		function print_window()
		{
			var w = window.open("Surprise", "#");
			var d = w.document.open();
			d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
		'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
		
			d.close();
		}	
		
	</script>	
		<div style="width:980px" align="center"><input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/></div>
		<fieldset style="width:975px; margin-left:7px">
			<div id="report_container">
				<table class="rpt_table" width="975" cellpadding="0" cellspacing="0" border="1" rules="all">
					<thead>
						<th colspan="10"><b>Yarn Issue</b></th>
					</thead>
					<thead>
						<th width="40">SL</th>
						<th width="110">Issue Id</th>
						<th width="80">Issue Date</th>
						<th width="80">Purpose</th>
						<th width="80">Supplier</th>
						<th width="80">Lot</th>
						<th width="180">Yarn Description</th>
						<th width="90">Issue Qty.</th>
						<th width="80">Avg. Rate (USD)</th>
						<th>Cost ($)</th>
					</thead>
					<?
				$job_array=return_library_array( "select id,job_no_mst from wo_po_break_down where id in($po_id)", "id", "job_no_mst"  );
				$sql_yarn="select c.id,a.requisition_no,a.receive_basis,a.prod_id,(a.cons_amount) as cons_amount,c.issue_basis,c.issue_number,c.booking_no from inv_transaction a, order_wise_pro_details b, inv_issue_master c where  a.id=b.trans_id and  c.id=a.mst_id and c.entry_form in(3) and b.entry_form in(3)  and  a.transaction_type=2  and b.po_breakdown_id in($po_id)";
				$result_yarn=sql_select($sql_yarn);
				foreach($result_yarn as $invRow)
				{
					if($invRow[csf('issue_basis')]==1)// Booking
					{
						$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('booking_no')];
					}
					else if($invRow[csf('issue_basis')]==3)// Requesition
					{
						$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('requisition_no')];
					}
				}
				
				unset($result_yarn);
				
				$yarn_dyeing_costArray=array();
				$yarndyeing_data="select b.booking_date,b.id,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 and a.job_no='$job_no'  group by b.id,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";
				$yarndyeing_dataResult=sql_select($yarndyeing_data);
				foreach($yarndyeing_dataResult as $yarnRow)
				{
					$yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
					$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
				}
					
				$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit"  );
				$receive_array=array();
				$yarnIssueData="select b.prod_id,sum(a.cons_amount) as cons_amount,sum(a.cons_quantity) as cons_quantity
				from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and b.entry_form ='3' and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)   and b.po_breakdown_id in($po_id) group by  b.prod_id";
				$resultyarnIssueData = sql_select($yarnIssueData);
				$all_prod_ids="";
				foreach($resultyarnIssueData as $row)
				{
					if($all_prod_ids=="") $all_prod_ids=$row[csf('prod_id')];else $all_prod_ids.=",".$row[csf('prod_id')];
					
					$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt']+=$row[csf('cons_amount')];
					$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty']+=$row[csf('cons_quantity')];
				}
				unset($resultyarnIssueData);
				$prodIds=chop($all_prod_ids,',');
				$prod_cond_for_in="";
				$prod_ids=count(array_unique(explode(",",$all_prod_ids)));
				if($db_type==2 && $prod_ids>1000)
				{
					$prod_cond_for_in=" and (";
					$prodIdsArr=array_chunk(explode(",",$prodIds),999);
					foreach($prodIdsArr as $ids)
					{
						$ids=implode(",",$ids);
						$prod_cond_for_in.=" a.prod_id in($ids) or"; 
					}
					$prod_cond_for_in=chop($prod_cond_for_in,'or ');
					$prod_cond_for_in.=")";
				}
				else
				{
					$prodIds=implode(",",array_unique(explode(",",$all_prod_ids)));
					$prod_cond_for_in=" and a.prod_id in($prodIds)";
				}
				
				if($prodIds!='' || $prodIds!=0)
				{
					$prod_cond_for_in=$prod_cond_for_in;
				}
				else
				{
					$prod_cond_for_in="and a.prod_id in(0)";
				}
				
				$sql_receive_for_issue="select c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.currency_id,c.receive_purpose,c.exchange_rate,b.lot,b.color, sum(a.order_qnty) as qty, sum(a.order_amount) as amnt, sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $prod_cond_for_in  group by c.booking_id,a.job_no,a.prod_id,c.currency_id,c.receive_purpose,c.exchange_rate,b.lot,b.color";
				$resultReceive_chek = sql_select($sql_receive_for_issue);
				
				foreach($resultReceive_chek as $row)
				{
					$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose']=$row[csf('receive_purpose')];
					$receive_date_array[$row[csf('prod_id')]]['exchange_rate']=$row[csf('exchange_rate')];
					$avg_rate=$row[csf('amnt')]/$row[csf('qty')];
					$receive_array[$row[csf('prod_id')]]=$avg_rate;
				}
				unset($resultReceive_chek);
				
				
				
					$plan_details_array = return_library_array("select dtls_id, booking_no as booking_no from ppl_planning_entry_plan_dtls where po_id in($po_id)  group by dtls_id,booking_no", "dtls_id", "booking_no");
					//print_r($plan_details_array);
					$reqs_array = array();
					$reqs_sql = sql_select("select knit_id, requisition_no as reqs_no, sum(yarn_qnty) as yarn_req_qnty from ppl_yarn_requisition_entry where status_active=1 and is_deleted=0 group by knit_id, requisition_no");
					foreach ($reqs_sql as $row)
					{
						//$reqs_array[$row[csf('knit_id')]]['reqs_no'] = $row[csf('reqs_no')];
						$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
					}
					unset($reqs_sql);
					
					$i=1; $total_yarn_issue_qnty=0; $total_yarn_cost=0;
					$yarnTrimsData="SELECT a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25) and b.po_breakdown_id in($po_id) ";
						
					
				$yarnTrimsDataArray=sql_select($yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
				$usd_id=2;$tot_iss_amnt=0;
				foreach($yarnTrimsDataArray as $invRow)
				{
					if($invRow[csf('item_category')]==1)
					{
						$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
						$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
						$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['exchange_rate'];
					//	$receive_date_array[$row[csf('prod_id')]]['exchange_rate']
						
						if($invRow[csf('receive_basis')]==1)//Booking Basis
						{
							$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
							if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
							{
								$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
								$booking_type=1;
								//echo $booking_no.'= '.$booking_type.', ';
							}
							else
							{
								$booking_type=$booking_array[$booking_no]['btype'];
								$is_short=$booking_array[$booking_no]['is_short'];
								//echo $is_short.'= '.$booking_type.'A ';
							}
						}
						else if($invRow[csf('receive_basis')]==3) //Requisition Basis
						{
							$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
							
							$prog_no=$reqs_array[$booking_req_no]['knit_id'];
							$booking_no=$plan_details_array[$prog_no];
							//echo $prog_no.'req';
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						$transaction_date='';
						$transaction_date=$last_trans_date;
						if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						
					//	$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
						$exchange_rate=$last_exchange_rate;
						$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
						
						$avgrate=$issue_rate/$exchange_rate;
						$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
						if($invRow[csf('entry_form')]==3 && $recv_purpose==16)//recv_purpose==16=Grey Yarn
						{
							//echo $is_short.'='.$booking_type.'='.$recv_purpose.'<br>';
							if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
							{
			
								if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
								{
									//echo $invRow[csf('mst_id')].'='.$invRow[csf('issue_purpose')].'='.$q.'='.$invRow[csf('quantity')].'-k<br>';
									
									$iss_amnt=$invRow[csf('quantity')]*$avgrate;
									$tot_iss_amnt+=$iss_amnt;
									
									$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['grey_yarn_amt']+=$iss_amnt;
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['yq']+=$invRow[csf('quantity')];
								}
							}
							
						}
					}
					
				}
			//	print_r($yarnTrimsCostArray);
				unset($yarnTrimsDataArray);
					$sql_isssue="select d.issue_number,d.issue_date,a.mst_id, a.transaction_type,a.item_category,a.requisition_no, a.receive_basis, a.item_category, a.transaction_date as issue_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity as issue_qnty, b.returnable_qnty,c.supplier_id, c.lot, c.color,c.product_name_details from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_issue_master d where a.mst_id=d.id and a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and d.status_active=1 and a.is_deleted=0  and a.status_active=1 and a.is_deleted=0and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25) and b.po_breakdown_id in($po_id) ";
					$result_issue=sql_select($sql_isssue);$usd_id=2;
					foreach($result_issue as $row)
					{
						if ($i%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF";	
						if($row[csf('item_category')]==1)
						{
						$issue_purpose=$row[csf('issue_purpose')];
						$issue_basis=$row[csf('issue_basis')];
						$item_category=$row[csf('item_category')];
						$yarn_issue_amt=$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt'];
						$yarn_issue_qty=$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty'];
						
						$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
						
						$last_trans_date=$last_receive_date_array[$row[csf('prod_id')]]['last_date'];
						$is_short='';
						$yarn_cost=0;
						
						if($row[csf('receive_basis')]==1)//Booking Basis
						{
							$booking_no=$yarn_booking_no_arr[$row[csf('mst_id')]];
							if($row[csf('issue_purpose')]==2) //Yarn Dyeing purpose
							{
								$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
								$booking_type=1;
								//echo $is_short.'= '.$booking_type.', ';
							}
							else
							{
								$booking_type=$booking_array[$booking_no]['btype'];
								$is_short=$booking_array[$booking_no]['is_short'];
							}
						}
						else if($row[csf('receive_basis')]==3) //Requisition Basis
						{
							$booking_req_no=$yarn_booking_no_arr[$row[csf('mst_id')]];
							
							$prog_no=$reqs_array[$booking_req_no]['knit_id'];
							$booking_no=$plan_details_array[$prog_no];
							//echo $prog_no.'req';
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
							
							//echo $booking_type.'='.$is_short;
							//if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
							
						$yarn_issued=$row[csf('issue_qnty')]; 
						$issue_date=$row[csf('issue_date')];
						$issue_qty=$row[csf('issue_qnty')];
							//echo $row[csf('yarn_iss_return_qty')].'ff';
							$transaction_date=$last_trans_date;
							//$avg_rate='';
							if($db_type==0)
							{
								$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
							}
							else
							{
								$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
							}
							//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
							$currency_rate=$receive_date_array[$row[csf('prod_id')]]['exchange_rate'];
							$avg_rate=$issue_rate/$currency_rate;
							//echo $currency_rate.'dd'.$avg_rate;
							if(($booking_type==1 || $booking_type==4) && ($is_short==2 || $is_short==1 &&  $booking_type!='') ) //Main and Sample Faric Booking
							{
								$issue_amnt=$issue_qty*$avg_rate;
								
							}
							//echo $issue_purpose.'ff';
							if($issue_purpose==1 || $issue_purpose==4) //Knitting || Sample With Order
							{
								$recv_purpose=$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose'];
								//echo $recv_purpose.'R';
								if($recv_purpose==16) ////Grey Yarn
								{
								//	$yarn_cost=$issue_amnt;
									//$yarn_issued=$issue_qty;
								//	echo "A".$issue_amnt.'<br>';
								}
								
							}
							else if($issue_purpose==2) //Yarn Dyeing
							{
								$recv_purpose=$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose'];
								
								if($recv_purpose==16) ////Grey Yarn
								{
								}
							}
						}
						//echo $row[csf('issue_number')]."__".$booking_type.'__'.$is_short."__".$recv_purpose."__".$issue_purpose."<br>";
						
						if(($booking_type==1 || $booking_type==4) && (($is_short==2 || $is_short==1 ) &&  $booking_type!='') && ($recv_purpose==16 || $issue_purpose==2))
						{
							//echo $avg_rate.'a';
						$yarn_cost=$yarnTrimsCostArray[$row[csf('mst_id')]][$row[csf('prod_id')]]['grey_yarn_amt'];
						$yarn_issued=$yarnTrimsCostArray[$row[csf('mst_id')]][$row[csf('prod_id')]]['yq'];
					//	echo $yarn_cost;
							//$yarn_issued=$yarnTrimsCostArray[$row[csf('prod_id')]]['yq'];
						?>
						<tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
							<td width="40"><? echo $i; ?></td>
							<td width="110"><p><? echo $row[csf('issue_number')]; ?></p></td>
							<td width="80" align="center"><? echo change_date_format($row[csf('issue_date')]); ?></td>
							<td width="80" title="<?= $issue_purpose ?>"><p><? echo $yarn_issue_purpose[$issue_purpose]; ?></p></td>
							<td width="80"><p><? echo $supplier_array[$row[csf('supplier_id')]]; ?></p></td>
							<td width="80"><p><? echo $row[csf('lot')]; ?></p></td>
							<td width="180"><p><? echo $row[csf('product_name_details')]; ?></p></td>
							<td align="right" width="90">
								<? 
									echo fn_number_format($yarn_issued,2); 
									$total_yarn_issue_qnty+=$yarn_issued;
								?>
							</td>
							<td align="right" width="80">
								<? 
									
									echo fn_number_format($avg_rate,2); 
								?>&nbsp;
							</td>
							<td align="right">
								<?
									//$yarn_cost=$yarn_issued*$avg_rate;
									echo fn_number_format($yarn_cost,4); 
									$total_yarn_cost+=$yarn_cost;
								?>
							</td>
						</tr>
					<?
					$i++;
							}
							
							
					}
					?>
					<tr style="font-weight:bold">
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td align="right">Total</td>
						<td align="right"><? echo fn_number_format($total_yarn_issue_qnty,2);?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($total_yarn_cost,2);?></td>
					</tr>
					<thead>
						<th colspan="10"><b>Yarn Return</b></th>
					</thead>
					<thead>
						<th width="40">SL</th>
						<th width="110">Return Id</th>
						<th width="80">Return Date</th>
						<th width="80">Purpose</th>
						<th width="80">Supplier</th>
						<th width="80">Lot</th>
						<th width="180">Yarn Description</th>
						<th width="90">Return Qty.</th>
						<th width="80">Avg. Rate (USD)</th>
						<th>Cost ($)</th>
				</thead>
					<?
					$total_yarn_return_qnty=0; $total_yarn_return_cost=0;
					$sql="select a.booking_no,a.recv_number,a.receive_basis, a.receive_date,b.issue_purpose, sum(b.quantity) as returned_qnty, c.id as prod_id, c.supplier_id,c.color,c.lot, c.product_name_details, c.avg_rate_per_unit,d.requisition_no from inv_receive_master a, order_wise_pro_details b, product_details_master c, inv_transaction d where a.id=d.mst_id and d.transaction_type=4 and d.item_category=1 and c.item_category_id=1 and d.id=b.trans_id and b.trans_type=4 and b.entry_form=9 and b.po_breakdown_id in($po_id) and b.prod_id=c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0   group by a.id, c.id, a.recv_number, a.booking_no,a.receive_date,b.issue_purpose, c.supplier_id,c.color,c.lot, c.product_name_details,a.receive_basis, c.avg_rate_per_unit,d.requisition_no";
					//echo $sql; die;
					$result=sql_select($sql);
					foreach($result as $row)
					{
						if ($i%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF";	
					
						$issue_basis=$row[csf('receive_basis')];
						$issue_purpose=$row[csf('issue_purpose')];
						$item_category=$row[csf('item_category')];
						if($issue_basis==1) //Booking Basis
							{
								$booking_no=$row[csf('booking_no')];
							}
							else if($issue_basis==3) //Requisition Basis
							{
								$booking_req_no=$row[csf('booking_no')];
								
								$prog_no=$reqs_array[$booking_req_no]['knit_id'];
								$booking_no=$plan_details_array[$prog_no];
								//echo $prog_no.'req';
							}
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							//echo $issue_basis.'dsd';
							$transaction_date=$row[csf('receive_date')];
							if($db_type==0)
							{
								$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
							}
							else
							{
								$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
							}
							$currency_rate=$receive_date_array[$row[csf('prod_id')]]['exchange_rate'];
							//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
							
							$currency_id=$receive_curr_array[$row[csf('prod_id')]];
							if($receive_array[$row[csf('prod_id')]]>0)
							{
								
								//echo $currency_id.'D';
								if($currency_id==1) //Taka
								{
									$avg_rate=$receive_array[$row[csf('prod_id')]]/$currency_rate;
									//echo $avg_rate.'C';
								}
								else
								{
									$avg_rate=$receive_array[$row[csf('prod_id')]];	
									//echo $avg_rate.'B';
								}
							}
							else
							{
								$avg_rate=$avg_rate_array[$row[csf('prod_id')]]/$currency_rate;
								//echo $avg_rate.'A';
							}
							//echo $row[csf('prod_id')].'--'.$row[csf('lot')].'--'.$row[csf('color')].'<br>';
							$recv_purpose=$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose'];
							//echo $recv_purpose.', ';
						if($issue_purpose==1 || $issue_purpose==4)
						{
							if($recv_purpose==16)
							{
								//echo $row[csf('returned_qnty')].'--'.$avg_rate; die;
								$yarn_returned=$row[csf('returned_qnty')];
								$iss_ret_amnt=$row[csf('returned_qnty')]*$avg_rate;
								//echo $yarn_returned.'d'.$avg_rate;
							}
						}
						else if($issue_purpose==2) //Yarn Dyeing
						{
							if($recv_purpose==16)
							{
								$yarn_returned=$row[csf('returned_qnty')];
								$iss_ret_amnt=$row[csf('returned_qnty')]*$avg_rate;
								//echo $yarn_returned.'A';
							}
						}
						/* if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='' && $recv_purpose==16) //Main and Sample Faric Booking
							{ */
								$total_yarn_return_qnty+=$yarn_returned;
						?>
						<tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
							<td width="40"><? echo $i; ?></td>
							<td width="110"><p><? echo $row[csf('recv_number')]; ?></p></td>
							<td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
							<td width="80"><p><? echo $yarn_issue_purpose[$issue_purpose]; ?></p></td>
							<td width="80"><p><? echo $supplier_array[$row[csf('supplier_id')]]; ?></p></td>
							<td width="80"><p><? echo $row[csf('lot')]; ?></p></td>
						
							<td width="180"><p><? echo $row[csf('product_name_details')]; ?></p></td>
							<td align="right" width="90">
								<? 
									echo fn_number_format($yarn_returned,2); 
								?>
							</td>
							<td align="right" width="80">
								<? 
									echo fn_number_format($avg_rate,2); 
								?>&nbsp;
							</td>
							<td align="right">
								<?
									$yarn_return_cost=$iss_ret_amnt;
									echo fn_number_format($yarn_return_cost,2); 
									$total_yarn_return_cost+=$yarn_return_cost;
								?>
							</td>
						</tr>
					<?
						$i++;
							//}
					}
					?>
					<tr style="font-weight:bold">
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td align="right">Total</td>
						<td align="right"><? echo fn_number_format($total_yarn_return_qnty,2);?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($total_yarn_return_cost,2);?></td>
					</tr>
				
					<tfoot>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th align="right">Balance</th>
						<th align="right"><? echo fn_number_format(($total_yarn_issue_qnty+$total_trans_in_qnty)-($total_yarn_return_qnty+$total_trans_out_qnty),2); ?></th>
						<th>&nbsp;</th>
						<th align="right"><? echo fn_number_format(($total_yarn_cost+$total_trans_in_cost)-($total_yarn_return_cost+$total_trans_out_cost),2); ?></th>
					</tfoot>
				</table>	
			</div>
		</fieldset>  
	<?
	exit();
}
if($action=="yarn_cost_actual2")
{
	echo load_html_head_contents("Yarn Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);
	
	$supplier_array=return_library_array( "select id, short_name from lib_supplier", "id", "short_name"  );
	
	$sql_wo_fab="select a.id,a.item_category,a.booking_no,a.booking_type,a.is_short,b.job_no,b.po_break_down_id as po_id
				 from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no  and a.item_category in(2,3) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0  and b.po_break_down_id in($po_id)";
				$result_fab_result=sql_select( $sql_wo_fab );
				foreach ($result_fab_result as $row)
				{
						$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
						$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
						$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
						$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
						$job_no=$row[csf('job_no')];
				}
				unset($result_fab_result);
	?>
	<script>

		function print_window()
		{
			var w = window.open("Surprise", "#");
			var d = w.document.open();
			d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
		'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
		
			d.close();
		}	
		
	</script>	
		<div style="width:980px" align="center"><input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/></div>
		<fieldset style="width:975px; margin-left:7px">
			<div id="report_container">
				<table class="rpt_table" width="975" cellpadding="0" cellspacing="0" border="1" rules="all">
					<thead>
						<th colspan="10"><b>Yarn Issue</b></th>
					</thead>
					<thead>
						<th width="40">SL</th>
						<th width="110">Issue Id</th>
						<th width="80">Issue Date</th>
						<th width="80">Purpose</th>
						<th width="80">Supplier</th>
						<th width="80">Lot</th>
						<th width="180">Yarn Description</th>
						<th width="90">Issue Qty.</th>
						<th width="80">Avg. Rate (USD)</th>
						<th>Cost ($)</th>
					</thead>
					<?
					//echo $po_id;
					//$job_array=return_library_array( "select id,job_no_mst from wo_po_break_down where id in($po_id)", "id", "job_no_mst"  );
					$sql_po="select id,job_no_mst,status_active from wo_po_break_down where id in($po_id) and status_active!=0";
					$sql_po_result=sql_select($sql_po);
					foreach($sql_po_result as $row)
					{
						$job_array[$row[csf('id')]]=$row[csf('job_no_mst')];
						if($row[csf('status_active')]==3)
						{
							$cancel_po_array[$row[csf('id')]]=$row[csf('id')];
						}
						else
						{
							$po_array[$row[csf('id')]]=$row[csf('id')];
						}
					}
					$po_cond_for_in=where_con_using_array($po_array,0,"b.po_breakdown_id");
					$can_po_cond_for_in=where_con_using_array($cancel_po_array,0,"b.po_breakdown_id");
					//print_r($cancel_po_array);
					
					$sql_yarn="select c.id,a.requisition_no,a.receive_basis,a.prod_id,(a.cons_amount) as cons_amount,c.issue_basis,c.issue_number,c.booking_no from inv_transaction a, order_wise_pro_details b, inv_issue_master c where  a.id=b.trans_id and  c.id=a.mst_id and c.entry_form in(3) and b.entry_form in(3)  and  a.transaction_type=2  and b.po_breakdown_id in($po_id)";
				$result_yarn=sql_select($sql_yarn);
				foreach($result_yarn as $invRow)
				{
					if($invRow[csf('issue_basis')]==1)// Booking
					{
						$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('booking_no')];
					}
					else if($invRow[csf('issue_basis')]==3)// Requesition
					{
						$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('requisition_no')];
					}
				}
				
				unset($result_yarn);
				
					$yarn_dyeing_costArray=array();
					//$yarndyeing_data=sql_select("select a.ydw_no,a.is_short, b.job_no, sum(b.amount) as amnt,sum(b.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst a,wo_yarn_dyeing_dtls b where  a.id=b.mst_id and a.entry_form in(41,94) and b.status_active=1 and b.is_deleted=0 group by a.ydw_no,a.is_short,b.job_no");
					$yarndyeing_data="select b.booking_date,b.id,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 and a.job_no='$job_no'  group by b.id,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";
					$yarndyeing_dataResult=sql_select($yarndyeing_data);
					foreach($yarndyeing_dataResult as $yarnRow)
					{
					$yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
					$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
					}
					
					$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit"  );
					$receive_array=array();
					$yarnIssueData="select b.prod_id,sum(a.cons_amount) as cons_amount,sum(a.cons_quantity) as cons_quantity
					from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and b.entry_form ='3' and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)   and b.po_breakdown_id in($po_id) group by  b.prod_id";
				$resultyarnIssueData = sql_select($yarnIssueData);
				$all_prod_ids="";
				foreach($resultyarnIssueData as $row)
				{
					if($all_prod_ids=="") $all_prod_ids=$row[csf('prod_id')];else $all_prod_ids.=",".$row[csf('prod_id')];
					
					$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt']+=$row[csf('cons_amount')];
					$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty']+=$row[csf('cons_quantity')];
				}
				unset($resultyarnIssueData);
				//echo $all_prod_ids;
				//print_r($yarn_issue_amt_arr);
				$prodIds=chop($all_prod_ids,',');
				$prod_cond_for_in="";
				$prod_ids=count(array_unique(explode(",",$all_prod_ids)));
				if($db_type==2 && $prod_ids>1000)
				{
					$prod_cond_for_in=" and (";
					$prodIdsArr=array_chunk(explode(",",$prodIds),999);
					foreach($prodIdsArr as $ids)
					{
						$ids=implode(",",$ids);
						$prod_cond_for_in.=" a.prod_id in($ids) or"; 
					}
					$prod_cond_for_in=chop($prod_cond_for_in,'or ');
					$prod_cond_for_in.=")";
				}
				else
				{
					$prodIds=implode(",",array_unique(explode(",",$all_prod_ids)));
					$prod_cond_for_in=" and a.prod_id in($prodIds)";
				}
				
				if($prodIds!='' || $prodIds!=0)
				{
					$prod_cond_for_in=$prod_cond_for_in;
				}
				else
				{
					$prod_cond_for_in="and a.prod_id in(0)";
				}
				
				$sql_receive_for_issue="select c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.exchange_rate,c.currency_id,c.receive_purpose,b.lot,b.color, 
				sum(a.order_qnty) as qty, sum(a.order_amount) as amnt,
				sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv
				from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $prod_cond_for_in  group by c.booking_id,a.job_no,a.prod_id,c.currency_id,c.exchange_rate,c.receive_purpose,b.lot,b.color";
				$resultReceive_chek = sql_select($sql_receive_for_issue);
				
				foreach($resultReceive_chek as $row)
				{
					$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose']=$row[csf('receive_purpose')];
					$receive_date_array[$row[csf('prod_id')]]['last_exchange_rate']=$row[csf('exchange_rate')];
					$avg_rate=$row[csf('amnt')]/$row[csf('qty')];
					$receive_array[$row[csf('prod_id')]]=$avg_rate;
				}
				unset($resultReceive_chek);
				
				
				
						$plan_details_array = return_library_array("select dtls_id, booking_no as booking_no from ppl_planning_entry_plan_dtls where po_id in($po_id)  group by dtls_id,booking_no", "dtls_id", "booking_no");
					//print_r($plan_details_array);
					$reqs_array = array();
					$reqs_sql = sql_select("select knit_id, requisition_no as reqs_no, sum(yarn_qnty) as yarn_req_qnty from ppl_yarn_requisition_entry where status_active=1 and is_deleted=0 group by knit_id, requisition_no");
					foreach ($reqs_sql as $row)
					{
						//$reqs_array[$row[csf('knit_id')]]['reqs_no'] = $row[csf('reqs_no')];
						$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
					}
					unset($reqs_sql);
					
					$i=1; $total_yarn_issue_qnty=0; $total_yarn_cost=0;
					$yarnTrimsData="select a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color,c.supplier_id,c.product_name_details,d.issue_number,d.issue_date,d.issue_purpose
						from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_issue_master d where a.id=b.trans_id and c.id=b.prod_id and d.id=a.mst_id  and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3) $po_cond_for_in ";
					
				$yarnTrimsDataArray=sql_select($yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
				$usd_id=2;$tot_iss_amnt=0;
				foreach($yarnTrimsDataArray as $invRow)
				{
					if($invRow[csf('item_category')]==1)
					{
						$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
						$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
						$last_trans_date=$receive_date_array[$invRow[csf('prod_id')]]['last_trans_date'];
						
						if($invRow[csf('receive_basis')]==1)//Booking Basis
						{
							$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
							if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
							{
								$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
								$booking_type=1;
								//echo $booking_no.'= '.$booking_type.', ';
							}
							else
							{
								$booking_type=$booking_array[$booking_no]['btype'];
								$is_short=$booking_array[$booking_no]['is_short'];
								//echo $is_short.'= '.$booking_type.'A ';
							}
						}
						else if($invRow[csf('receive_basis')]==3) //Requisition Basis
						{
							$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
							
							$prog_no=$reqs_array[$booking_req_no]['knit_id'];
							$booking_no=$plan_details_array[$prog_no];
							//echo $prog_no.'req';
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						$transaction_date='';
						$transaction_date=$last_trans_date;
						if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['last_exchange_rate'];
						$exchange_rate=$last_exchange_rate;//set_conversion_rate($usd_id,$conversion_date );
						$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
						
						$avgrate=$issue_rate/$exchange_rate;
						$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
						if($invRow[csf('entry_form')]==3 && ($recv_purpose==16 || $recv_purpose==5))//recv_purpose==16=Grey Yarn
						{
							//echo $is_short.'='.$booking_type.'='.$recv_purpose.'<br>';
							if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
							{
								//echo $invRow[csf('issue_purpose')].'X';
								
								if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
								{
									//echo $invRow[csf('mst_id')].'='.$invRow[csf('issue_purpose')].'='.$q.'='.$invRow[csf('quantity')].'-k<br>';
									
									$iss_amnt=$invRow[csf('quantity')]*$avgrate;
									//$tot_iss_amnt+=$iss_amnt;
									
									$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['grey_yarn_amt']+=$iss_amnt;
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['yq']+=$invRow[csf('quantity')];
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_number']=$invRow[csf('issue_number')];
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_date']=$invRow[csf('issue_date')];
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['product_name_details']=$invRow[csf('product_name_details')];
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['supplier_id']=$invRow[csf('supplier_id')];
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['lot']=$invRow[csf('lot')];
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_purpose']=$invRow[csf('issue_purpose')];
								
									//$yarnTrimsCostArray[$invRow[csf('prod_id')]]['grey_yarn_amt_retble']+=$retble_iss_amnt;
								}
							}
							else
							{
								$iss_amnt=$invRow[csf('quantity')]*$avgrate;
								//$tot_iss_amnt+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['cpa_yq']+=$invRow[csf('quantity')];
								$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_number']=$invRow[csf('issue_number')];
								$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_date']=$invRow[csf('issue_date')];
								$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['product_name_details']=$invRow[csf('product_name_details')];
								$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['supplier_id']=$invRow[csf('supplier_id')];
								$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['lot']=$invRow[csf('lot')];
								$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_purpose']=$invRow[csf('issue_purpose')];
							}
							
						}
						
					}
					
				}
				//print_r($yarnTrimsCostArray);
				unset($yarnTrimsDataArray);
				//edn
					/*$sql="SELECT a.booking_no, a.issue_number, a.issue_basis, a.issue_date, c.supplier_id, d.item_category, b.issue_purpose, c.lot, c.color, d.requisition_no,
						sum(CASE WHEN d.transaction_type=2 and b.entry_form ='3' and b.trans_type=2 and b.issue_purpose in(1,2,4,15,38) THEN b.quantity ELSE 0 END) AS issue_qnty,
						sum(CASE WHEN d.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN b.quantity ELSE 0 END) AS yarn_iss_return_qty,
						(CASE WHEN d.transaction_type=2 and b.entry_form ='3' and b.trans_type=2  THEN d.transaction_date ELSE null END) AS transaction_date, c.id as prod_id, c.product_name_details, c.avg_rate_per_unit
						from inv_issue_master a, order_wise_pro_details b, product_details_master c, inv_transaction d 
						where a.id=d.mst_id and d.transaction_type in(2,4,5,6) and d.item_category=1 and c.item_category_id=1 and d.id=b.trans_id and b.trans_type in(2,4,5,6) and b.entry_form in(3,11,25) and b.po_breakdown_id in($po_id) and b.prod_id=c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  
						group by a.id,c.id,c.lot,c.color,d.item_category,b.issue_purpose, a.issue_number, a.issue_date, c.supplier_id, c.product_name_details, c.avg_rate_per_unit,d.transaction_type,b.entry_form,b.trans_type,d.transaction_date,a.booking_no,a.issue_basis,d.requisition_no";*/
					/*$sql_isssue="select d.issue_number,d.issue_date,a.mst_id, a.transaction_type,a.item_category,a.requisition_no, a.receive_basis, a.item_category, a.transaction_date as issue_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity as issue_qnty, b.returnable_qnty,c.supplier_id, c.lot, c.color,c.product_name_details
						from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_issue_master d where a.mst_id=d.id and a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and d.status_active=1 and a.is_deleted=0  and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3) and b.po_breakdown_id in($po_id) ";
					$result_issue=sql_select($sql_isssue);*/
					$usd_id=2;
					$i=1;
					foreach($yarnTrimsCostArray as $mst_id=>$mstData)
					{
						foreach($mstData as $prod_id=>$row)
						{
						if ($i%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF";	
						
						//echo $row[csf('issue_number')]."__".$booking_type.'__'.$is_short."__".$recv_purpose."__".$issue_purpose."<br>";
						$cpa_yarn_cost=0;
						
						$issue_purpose=$row[('issue_purpose')]; 
						
						//if(($booking_type==1 || $booking_type==4) && (($is_short==2 || $is_short==1 ) &&  $booking_type!='') && ($recv_purpose==16 || $issue_purpose==2))
						//{
							//echo $avg_rate.'a';
						//echo $booking_type.'='.$is_short.'<br>';
						//if($is_short==1)
						//{
							$cpa_yarn_cost=$row[('cpa_grey_yarn_amt')];//row[('grey_yarn_amt')]
							$cpa_yarn_issued=$row[('cpa_yq')]; 
							//echo $cpa_yarn_cost.'D';
						//}
						$yarn_cost=$row[('grey_yarn_amt')]+$cpa_yarn_cost;
						$yarn_issued=$row[('yq')]+$cpa_yarn_issued;
						
						
						//$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['cpa_grey_yarn_amt'];
					//	echo $yarn_cost;
							//$yarn_issued=$yarnTrimsCostArray[$row[csf('prod_id')]]['yq'];
						?>
						<tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
							<td width="40"><? echo $i; ?></td>
							<td width="110" title="Mst Id=<? echo $mst_id;?>"><p><? echo $row[('issue_number')]; ?></p></td>
							<td width="80" align="center"><? echo change_date_format($row[('issue_date')]); ?></td>
							<td width="80"><p><? echo $yarn_issue_purpose[$issue_purpose]; ?></p></td>
							<td width="80"><p><? echo $supplier_array[$row[('supplier_id')]]; ?></p></td>
							<td width="80"><p><? echo $row[('lot')]; ?></p></td>
							<td width="180"><p><? echo $row[('product_name_details')]; ?></p></td>
							<td align="right" width="90">
								<? 
									echo fn_number_format($yarn_issued,2); 
									$total_yarn_issue_qnty+=$yarn_issued;
								?>
							</td>
							<td align="right" width="80">
								<? 
									
									echo fn_number_format($yarn_cost/$yarn_issued,2); 
								?>&nbsp;
							</td>
							<td align="right">
								<?
									//$yarn_cost=$yarn_issued*$avg_rate;
									echo fn_number_format($yarn_cost,4); 
									$total_yarn_cost+=$yarn_cost;
								?>
							</td>
						</tr>
					<?
					$i++;
							//}
						}
							
							
					}
					?>
					<tr style="font-weight:bold">
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td align="right">Total</td>
						<td align="right"><? echo fn_number_format($total_yarn_issue_qnty,2);?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($total_yarn_cost,2);?></td>
					</tr>
					<?
					$i=1; //$total_yarn_issue_qnty=0; $total_yarn_cost=0;
					$cancel_yarnTrimsData="select a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color,c.supplier_id,c.product_name_details,d.issue_number,d.issue_date,d.issue_purpose
						from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_issue_master d where a.id=b.trans_id and c.id=b.prod_id and d.id=a.mst_id  and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3) $can_po_cond_for_in ";
						// select a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25) and b.po_breakdown_id in(50943) 
					
				$cancelyarnTrimsDataArray=sql_select($cancel_yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
				$usd_id=2;$tot_iss_amnt=0;
				foreach($cancelyarnTrimsDataArray as $invRow)
				{
					if($invRow[csf('item_category')]==1)
					{
						$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
						$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
						$last_trans_date=$receive_date_array[$invRow[csf('prod_id')]]['last_trans_date'];
						
						if($invRow[csf('receive_basis')]==1)//Booking Basis
						{
							$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
							if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
							{
								$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
								$booking_type=1;
								//echo $booking_no.'= '.$booking_type.', ';
							}
							else
							{
								$booking_type=$booking_array[$booking_no]['btype'];
								$is_short=$booking_array[$booking_no]['is_short'];
								//echo $is_short.'= '.$booking_type.'A ';
							}
						}
						else if($invRow[csf('receive_basis')]==3) //Requisition Basis
						{
							$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
							
							$prog_no=$reqs_array[$booking_req_no]['knit_id'];
							$booking_no=$plan_details_array[$prog_no];
							//echo $prog_no.'req';
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						$transaction_date='';
						$transaction_date=$last_trans_date;
						if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['last_exchange_rate'];
						$exchange_rate=$last_exchange_rate;//set_conversion_rate($usd_id,$conversion_date );
						$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
						
						$avgrate=$issue_rate/$exchange_rate;
						$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
						if($invRow[csf('entry_form')]==3 && $recv_purpose==16)//recv_purpose==16=Grey Yarn
						{
							//echo $is_short.'='.$booking_type.'='.$recv_purpose.'<br>';
							if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
							{
								//echo $invRow[csf('issue_purpose')].'X';
								
								if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
								{
									//echo $invRow[csf('mst_id')].'='.$invRow[csf('issue_purpose')].'='.$q.'='.$invRow[csf('quantity')].'-k<br>';
									
									$iss_amnt=$invRow[csf('quantity')]*$avgrate;
									//$tot_iss_amnt+=$iss_amnt;
									
									$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
									$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['grey_yarn_amt']+=$iss_amnt;
									$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['yq']+=$invRow[csf('quantity')];
									$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_number']=$invRow[csf('issue_number')];
									$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_date']=$invRow[csf('issue_date')];
									$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['product_name_details']=$invRow[csf('product_name_details')];
									$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['supplier_id']=$invRow[csf('supplier_id')];
									$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['lot']=$invRow[csf('lot')];
									$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_purpose']=$invRow[csf('issue_purpose')];
								
									//$yarnTrimsCostArray[$invRow[csf('prod_id')]]['grey_yarn_amt_retble']+=$retble_iss_amnt;
								}
							}
							else
							{
								$iss_amnt=$invRow[csf('quantity')]*$avgrate;
								//$tot_iss_amnt+=$iss_amnt;
								$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
								$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['cpa_yq']+=$invRow[csf('quantity')];
								$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_number']=$invRow[csf('issue_number')];
								$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_date']=$invRow[csf('issue_date')];
								$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['product_name_details']=$invRow[csf('product_name_details')];
								$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['supplier_id']=$invRow[csf('supplier_id')];
								$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['lot']=$invRow[csf('lot')];
								$cancelyarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['issue_purpose']=$invRow[csf('issue_purpose')];
							}
							
						}
						
					}
					
				}
				//print_r($yarnTrimsCostArray);
				unset($cancelyarnTrimsDataArray);
					?>
					<thead>
						<th colspan="6"><b>Cancel PO Grey Yarn Details</b></th>
					</thead>
					<thead>
						<th width="40">SL</th>
						<th width="110">Issue Id</th>
						<th width="80">Yarn Desc</th>
						<th width="80">Grey Yarn Qty</th>
						<th width="80">Avg. Rate (USD)</th>
						<th>Cost ($)</th>
				</thead>
				<?
				$usd_id=2;
					$m=1;$can_total_yarn_qty=$can_total_yarn_cost=0;
					foreach($cancelyarnTrimsCostArray as $mst_id=>$mstData)
					{
						foreach($mstData as $prod_id=>$row)
						{
						if ($m%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF";	
						
						//echo $row[csf('issue_number')]."__".$booking_type.'__'.$is_short."__".$recv_purpose."__".$issue_purpose."<br>";
						$cpa_yarn_cost=0;
						$issue_purpose=$row[('issue_purpose')]; 
						$cpa_yarn_cost=$row[('cpa_grey_yarn_amt')];//row[('grey_yarn_amt')]
						$cpa_yarn_issued=$row[('cpa_yq')]; 
						
						$yarn_cost=$row[('grey_yarn_amt')]+$cpa_yarn_cost;
						$yarn_issued=$row[('yq')]+$cpa_yarn_issued;
				?>
				<tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('trm_<? echo $m; ?>','<? echo $bgcolor;?>')" id="trm_<? echo $m;?>">
							<td width="40"><? echo $m; ?></td>
							<td width="110"><p><? echo $row[('issue_number')]; ?></p></td>
							<td width="180"><p><? echo $row[('product_name_details')]; ?></p></td>
							<td align="right" width="90">
								<? 
									echo fn_number_format($yarn_issued,2); 
								?>
							</td>
							<td title="<? echo $yarn_cost/$yarn_issued;?>" align="right" width="80">
								<? 
									echo fn_number_format($yarn_cost/$yarn_issued,2); 
								?>&nbsp;
							</td>
							<td align="right">
								<?
									//$yarn_return_cost=$iss_ret_amnt;
									echo fn_number_format($yarn_cost,2); 
									$can_total_yarn_qty+=$yarn_issued;
									$can_total_yarn_cost+=$yarn_cost;
								?>
							</td>
						</tr>
						<?
							$m++;
							}
						
						}
						?>
						<tr style="font-weight:bold">
						<td align="right" colspan="3">Total</td>
						<td align="right"><? echo fn_number_format($can_total_yarn_qty,2);?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($can_total_yarn_cost,2);?></td>
					</tr>
						
				
				
					
					<thead>
						<th colspan="10"><b>Yarn Return</b></th>
					</thead>
					<thead>
						<th width="40">SL</th>
						<th width="110">Return Id</th>
						<th width="80">Return Date</th>
						<th width="80">Purpose</th>
						<th width="80">Supplier</th>
						<th width="80">Lot</th>
						<th width="180">Yarn Description</th>
						<th width="90">Return Qty.</th>
						<th width="80">Avg. Rate (USD)</th>
						<th>Cost ($)</th>
				</thead>
					<?
					$total_yarn_return_qnty=0; $total_yarn_return_cost=0;
					$sql="select a.booking_no,a.exchange_rate,a.recv_number,a.receive_basis, a.receive_date,b.issue_purpose, sum(b.quantity) as returned_qnty, c.id as prod_id, c.supplier_id,c.color,c.lot, c.product_name_details, c.avg_rate_per_unit,d.requisition_no from inv_receive_master a, order_wise_pro_details b, product_details_master c, inv_transaction d where a.id=d.mst_id and d.transaction_type=4 and d.item_category=1 and c.item_category_id=1 and d.id=b.trans_id and b.trans_type=4 and b.entry_form=9 and b.po_breakdown_id in($po_id) and b.prod_id=c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  group by a.id, c.id, a.recv_number, a.booking_no,a.exchange_rate,a.receive_date,b.issue_purpose, c.supplier_id,c.color,c.lot, c.product_name_details,a.receive_basis, c.avg_rate_per_unit,d.requisition_no";
					$result=sql_select($sql);
					$i=1;
					foreach($result as $row)
					{
						if ($i%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF";	
					
						$issue_basis=$row[csf('receive_basis')];
						$issue_purpose=$row[csf('issue_purpose')];
						$item_category=$row[csf('item_category')];
						$exchange_rate=$row[csf('exchange_rate')];
						if($issue_basis==1) //Booking Basis
							{
								$booking_no=$row[csf('booking_no')];
							}
							else if($issue_basis==3) //Requisition Basis
							{
								$booking_req_no=$row[csf('booking_no')];
								
								$prog_no=$reqs_array[$booking_req_no]['knit_id'];
								$booking_no=$plan_details_array[$prog_no];
								//echo $prog_no.'req';
							}
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							//echo $issue_basis.'dsd';
							$transaction_date=$row[csf('receive_date')];
							if($db_type==0)
							{
								$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
							}
							else
							{
								$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
							}
							$currency_rate=$exchange_rate;//set_conversion_rate($usd_id,$conversion_date );
							
							$currency_id=$receive_curr_array[$row[csf('prod_id')]];
							if($receive_array[$row[csf('prod_id')]]>0)
							{
								
								//echo $currency_id.'D';
								if($currency_id==1) //Taka
								{
									$avg_rate=$receive_array[$row[csf('prod_id')]]/$currency_rate;
									//echo $avg_rate.'C';
								}
								else
								{
									$avg_rate=$receive_array[$row[csf('prod_id')]];	
									//echo $avg_rate.'B';
								}
							}
							else
							{
								$avg_rate=$avg_rate_array[$row[csf('prod_id')]]/$currency_rate;
								//echo $avg_rate.'A';
							}
							//$avg_rate=$receive_array[$row[csf('prod_id')]]/$currency_rate;
							//echo $avg_rate;
							$recv_purpose=$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose'];
							//echo $recv_purpose.', ';
						if($issue_purpose==1 || $issue_purpose==4)
						{
							if($recv_purpose==16)
							{
								$yarn_returned=$row[csf('returned_qnty')];
								$iss_ret_amnt=$row[csf('returned_qnty')]*$avg_rate;
								//echo $yarn_returned.'d'.$avg_rate;
							}
						}
						else if($issue_purpose==2) //Yarn Dyeing
						{
							if($recv_purpose==16)
							{
								$yarn_returned=$row[csf('returned_qnty')];
								$iss_ret_amnt=$row[csf('returned_qnty')]*$avg_rate;
								//echo $yarn_returned.'A';
							}
						}
						//$yarn_returned=$row[csf('returned_qnty')];
						//$iss_ret_amnt=$yarn_returned*$avg_rate;
						//$retble_iss_ret_amnt=$returnable_ret_qnty*$avg_rate;
							
						//echo $booking_type.'='.$is_short;
						if(($booking_type==1 || $booking_type==4) &&  ($is_short==2 || $is_short==1) &&  $booking_type!='' && $recv_purpose==16) //Main and Sample Faric Booking
							{
								$total_yarn_return_qnty+=$yarn_returned;
						//echo $iss_ret_amnt.'A'.$avg_rate;
						?>
						<tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('trret_<? echo $i; ?>','<? echo $bgcolor;?>')" id="trret_<? echo $i;?>">
							<td width="40"><? echo $i; ?></td>
							<td width="110"><p><? echo $row[csf('recv_number')]; ?></p></td>
							<td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
							<td width="80"><p><? echo $yarn_issue_purpose[$issue_purpose]; ?></p></td>
							<td width="80"><p><? echo $supplier_array[$row[csf('supplier_id')]]; ?></p></td>
							<td width="80"><p><? echo $row[csf('lot')]; ?></p></td>
						
							<td width="180"><p><? echo $row[csf('product_name_details')]; ?></p></td>
							<td align="right" width="90">
								<? 
									echo fn_number_format($yarn_returned,2); 
								?>
							</td>
							<td align="right" width="80">
								<? 
								$yarn_return_cost=$iss_ret_amnt;
									/*if($receive_array[$row[csf('prod_id')]]>0)
									{
										$avg_rate=$receive_array[$row[csf('prod_id')]];
									}
									else
									{
										$avg_rate=$row[csf('avg_rate_per_unit')]/$ex_rate;
									}*/
									echo fn_number_format($yarn_return_cost/$yarn_returned,2); 
								?>&nbsp;
							</td>
							<td align="right">
								<?
									
									echo fn_number_format($yarn_return_cost,2); 
									$total_yarn_return_cost+=$yarn_return_cost;
								?>
							</td>
						</tr>
					<?
						$i++;
							}
					}
					$tot_issue_cancelQty=$total_yarn_issue_qnty+$can_total_yarn_qty;//$can_total_yarn_qty
					$tot_issue_cancelAmount=$total_yarn_cost+$can_total_yarn_cost;
					?>
					<tr style="font-weight:bold">
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td align="right">Total :</td>
						<td align="right"><? echo fn_number_format($total_yarn_return_qnty,2);?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($total_yarn_return_cost,2);?></td>
					</tr>
				
					<tfoot>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th align="right">Balance:</th>
						<th align="right" title="Issue+Cancel Qty-ReturnQty"><? echo fn_number_format(($tot_issue_cancelQty-$total_yarn_return_qnty),2); ?></th>
						<th>&nbsp;</th>
						<th align="right" title="Issue+Cancel Cost-ReturnCost"><? echo fn_number_format(($tot_issue_cancelAmount-$total_yarn_return_cost),2); ?></th>
					</tfoot>
				</table>	
			</div>
		</fieldset>  
	<?
	exit();
}

if($action=="yarn_dye_twist_cost_actual")
{
	echo load_html_head_contents("Yarn Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);
	
	$supplier_array=return_library_array( "select id, short_name from lib_supplier", "id", "short_name"  );
		
	$job_array=array();
	 $sql_job="select  a.job_quantity,b.job_no_mst,b.po_quantity,b.id as po_id from wo_po_break_down b, wo_po_details_master a where  a.job_no=b.job_no_mst and b.id in($po_id)  and b.status_active=1 and b.is_deleted=0";
	$resultjob = sql_select($sql_job);
	$job_no="";
	foreach($resultjob as $row)
	{
		$job_array[$row[csf('po_id')]]['po_qty']+=$row[csf('po_quantity')];
		$job_array[$row[csf('po_id')]]['job_qty']=$row[csf('job_quantity')];
		$job_no.="'".$row[csf('job_no_mst')]."'".',';
	}
	$job_nos=rtrim($job_no,',');
	$jobnos=implode(",",array_unique(explode(",",$job_nos)));
	$po_ids=array_unique(explode(",",$po_id));
	

?>
<script>

	function print_window()
	{
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
	
		d.close();
	}	
	function generate_worder_report(version_type, booking_no, cbo_company_name, update_id,form_name,entry_form, cbo_pay_mode, cbo_supplier_name, show_comment, path,action_type) {
				
				
				if (action_type == 'show_trim_booking_report')
				{
					var action_method = "action=show_trim_booking_report";
				}
				
				if (entry_form == 41) {

						if (version_type == 1) {
							report_title = "&report_title=Yarn Dyeing Charge Booking";
							http.open("POST", "../../../../order/woven_order/requires/yarn_dyeing_charge_booking_controller.php", true);
						}
						else if (version_type == 2) {
							report_title = "&report_title=Partial Fabric Booking";
							http.open("POST", "../../../../order/woven_order/requires/yarn_dyeing_charge_booking_controller2.php", true);
						} 
						 
					
					
				}else {
					report_title = "&report_title=Yarn Service Work Order";
					http.open("POST", "../../../../order/woven_order/requires/yarn_service_work_order_controller.php", true);
				}

				var data = action_method + report_title +
				'&txt_booking_no=' + "'" + booking_no + "'" +
				'&cbo_company_name=' + "'" + cbo_company_name + "'" +
				'&update_id=' + "'" + update_id + "'" +
				'&cbo_pay_mode=' + "'" + cbo_pay_mode + "'" +
				'&cbo_supplier_name=' + "'" + cbo_supplier_name + "'" +
				'&show_comment=' + "'" + show_comment + "'" +
				'&path=' + "'" + path + "'";
				//alert(data);
				
				http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				http.send(data);
				http.onreadystatechange = generate_fabric_report_reponse;
			}

			function generate_fabric_report_reponse() {
				if (http.readyState == 4) {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">' +
						'<html><head><title></title></head><body>' + http.responseText + '</body</html>');
					d.close();
				}
			}
</script>	
	<div style="width:1000px" align="center"><input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/></div>
	<fieldset style="width:1000px; margin-left:7px">
		<div id="report_container">
            <table class="rpt_table" width="1000" cellpadding="0" cellspacing="0"  border="1" rules="all">
            	<thead>
					<th colspan="10"><b>Yarn Receive (Additional Value)</b></th>
				</thead>
				<thead>
                	<th width="40">SL</th>
                    <th width="110">Recv. Id</th>
					 <th width="120">Wo No</th>
                    <th width="80">Recv. Date</th>
                    <th width="80">Purpose</th>
                    <th width="70">Supplier</th>
                    <th width="180">Yarn Description</th>
                    <th width="90">Recv. Qty.</th>
                    <th width="80">Rate (USD)</th>
                    <th>Cost ($)</th>
				</thead>
				<tbody id="table_search">
                <?
			//	$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit"  );
			$yarn_dyeing_costArray=array(); //product_id
			$yarndyeing_sql="select b.booking_date,b.id,b.company_id,b.supplier_id,b.entry_form,b.pay_mode,b.budget_version,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 and a.job_no in($jobnos) group by b.id,b.company_id,b.budget_version,b.supplier_id,b.pay_mode,b.entry_form,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";
			$yarndyeing_result = sql_select($yarndyeing_sql);
				foreach($yarndyeing_result as $yarnRow)
				{
				  $yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
				  $yarn_dyeing_costArray2[$yarnRow[csf('id')]]['job']=$yarnRow[csf('job_no')];
				  $yarn_dyeing_costArray2[$yarnRow[csf('id')]]['ydw_no']=$yarnRow[csf('ydw_no')];
				   $yarn_dyeing_costArray2[$yarnRow[csf('id')]]['budget_version']=$yarnRow[csf('budget_version')];
				   $yarn_dyeing_costArray2[$yarnRow[csf('id')]]['company_id']=$yarnRow[csf('company_id')];
				   $yarn_dyeing_costArray2[$yarnRow[csf('id')]]['pay_mode']=$yarnRow[csf('pay_mode')];
				 $yarn_dyeing_costArray2[$yarnRow[csf('id')]]['supplier_id']=$yarnRow[csf('supplier_id')];
				 $yarn_dyeing_costArray2[$yarnRow[csf('id')]]['entry_form']=$yarnRow[csf('entry_form')];
					 
				  $yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
				  $yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['booking_date']=$yarnRow[csf('booking_date')];
				  $yarn_dyeing_curr_arr[$yarnRow[csf('ydw_no')]]['currency']=$yarnRow[csf('currency')];
				  
				  $yarn_dyeing_rate_arr[$yarnRow[csf('job_no')]][$yarnRow[csf('yarn_color')]]['rate']=$yarnRow[csf('dyeing_charge')];
				}
				
                $i=1; $total_yarn_recv_qnty=0; $total_yarn_cost=0;$usd_id=2;
				
				  $receive_array=array();
				$sql_receive="select  c.id,c.recv_number,c.receive_basis,c.supplier_id,c.receive_date,c.receive_purpose,c.booking_id,a.job_no,a.prod_id,c.exchange_rate,c.currency_id,c.receive_purpose,b.product_name_details,b.lot,b.color, 
				 sum(a.order_qnty) as qty, sum(a.order_amount) as amnt,
				 sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv,
				  sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.cons_quantity ELSE 0 END) AS cons_quantity_recv
				  from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1   and a.is_deleted=0 and c.receive_purpose in(2,15,38) and a.job_no in($jobnos)  group by  c.id,c.booking_id,c.recv_number,c.receive_basis,c.receive_date,a.job_no,a.prod_id,c.supplier_id,b.product_name_details,c.exchange_rate,c.currency_id,c.receive_purpose,b.lot,b.color";
				$resultReceive = sql_select($sql_receive);
				$prod_ids="";
				foreach($resultReceive as $row)
				{
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";	
					$po_quantity=$job_qty=0;
					foreach($po_ids as $poid)
					{
						
					 $po_quantity+=$job_array[$poid]['po_qty'];
					$job_qty=$job_array[$poid]['job_qty'];
					}
					$prod_ids.=$row[csf('prod_id')].',';
					$jobNo=$yarn_dyeing_costArray2[$row[csf('booking_id')]]['job'];
					$ydw_no=$yarn_dyeing_costArray2[$row[csf('booking_id')]]['ydw_no'];
					$budget_version=$yarn_dyeing_costArray2[$row[csf('booking_id')]]['budget_version'];
					$company_id=$yarn_dyeing_costArray2[$row[csf('booking_id')]]['company_id'];
					$entry_form=$yarn_dyeing_costArray2[$row[csf('booking_id')]]['entry_form'];
					$form_name="yarn_dyeing_wo_booking";
					$action_ydn="show_trim_booking_report";
					$show_comment=1;$path="../../../../";
					$cbo_pay_mode=$yarn_dyeing_costArray2[$row[csf('booking_id')]]['pay_mode'];
					$cbo_supplier_name=$yarn_dyeing_costArray2[$row[csf('booking_id')]]['supplier_id'];
					//echo $jobNo;
					$yarn_rec_job_arr[$row[csf('recv_number')]]['job']=$jobNo;
					$yarn_rec_job_arr[$row[csf('recv_number')]]['ydw_no']=$ydw_no;
					$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
					$ydye_rate=$yarn_dyeing_rate_arr[$row[csf('job_no')]][$row[csf('color')]]['rate'];
					
					$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
					
						//echo $currency.'d'.$chy_rate;
					$order_amount_recv=$row[csf('order_amount_recv')];
					$cons_quantity=$row[csf('cons_quantity_recv')];
					$exchange_rate=$row[csf('exchange_rate')];
					$transaction_date=$booking_date;
					if($db_type==0)
					{
						$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					}
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$currency_rate=$exchange_rate;
					$ex_rateArr[$row[csf('prod_id')]]=$exchange_rate;
						//echo $currency_id.'D';
					if($currency==1) //Taka
					{
						$dye_charge=$ydye_rate/$currency_rate;
					}
					else
					{
						$dye_charge=$ydye_rate;	
					}
							$recv_amount=$cons_quantity*$dye_charge;
							$avg_recv_amount=($recv_amount/$job_qty)*$po_quantity;
						//echo $recv_amount.'/'.$job_qty.'*'.$po_quantity.'<br>';
						$avg_cons_quantity=($cons_quantity/$job_qty)*$po_quantity;
						$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
					//echo $booking_type.'='.$is_short;
					//echo $avg_rate.'a';
					//$ydw_no=$service_booking_array[$row[csf('id')]]['ydw_no'];
					if($is_short==2)
					{
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                    	<td width="40"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('recv_number')]; ?></p></td>
						 <td width="120"><p><span style="cursor: pointer; text-decoration: underline; color: blue;" title="Print Booking"
							onClick="generate_worder_report(<?php echo $budget_version;?>,'<?php echo $ydw_no;?>',<?php echo $company_id;?>,'<?php echo $row[csf('booking_id')];?>','<?php echo $form_name;?>','<?php echo $entry_form;?>',<?php echo $cbo_pay_mode;?>,'<?php echo $cbo_supplier_name;?>',<?php echo $show_comment;?>,'<?php echo $path;?>','<?php echo $action_ydn;?>')"><?php echo $ydw_no;?></span></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
                        <td width="70"><p><? echo $yarn_issue_purpose[$row[csf('receive_purpose')]]; ?></p></td>
                        <td width="70"><p><? echo $supplier_array[$row[csf('supplier_id')]]; ?></p></td>
                      
                        <td width="180"><p><? echo $row[csf('product_name_details')]; ?></p></td>
                        <td align="right" width="90" title="<? echo $cons_quantity; ?>">
							<? 
								echo fn_number_format($avg_cons_quantity,2); 
								$total_yarn_recv_qnty+=$avg_cons_quantity;
                            ?>
                        </td>
                        <td align="right" width="80">
							<? 
								
								echo fn_number_format($dye_charge,2); 
                            ?>&nbsp;
                        </td>
                        <td align="right">
                        
							<?
								//$yarn_cost=$yarn_issued*$avg_rate;
								echo fn_number_format($avg_recv_amount,2); 
								$total_yarn_cost+=$avg_recv_amount;
                            ?>
                        </td>
                    </tr>
                <?
               
						
						
						 $i++;
					}
                }
				//print_r($yarn_rec_job_arr);
                ?>
                <tr style="font-weight:bold; background:#CCC">
                    <td>&nbsp;</td>
					 <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                      <td>&nbsp;</td>
                    <td align="right"> Total</td>
                    <td align="right"><? echo fn_number_format($total_yarn_recv_qnty,2);?></td>
                    <td>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($total_yarn_cost,2);?></td>
                </tr>
				</tbody>
                <? //die;?>
                <div>
                <thead >
                    <th colspan="10"><b>Yarn Recv Return</b></th>
                </thead>
                <thead>
                	<th>SL</th>
                	<th width="110">Return Id</th>
                    <th width="80">Return Date</th>
                    <th width="80">Recv MRR No</th>
                    <th width="70">Supplier</th>
                    <th width="180">Yarn Description</th>
                    <th width="90">Return Qty.</th>
                    <th width="80">Rate (USD)</th>
                    <th  colspan="2">Cost ($)</th>
               </thead>
			   <tbody id="table_search2">
                <?
				$prod_idss=rtrim($prod_ids,',');
				if($prod_idss!='') $prod_idss=$prod_idss;else $prod_idss=0;
                $total_yarn_return_qnty=0; $total_yarn_return_cost=0;
				 $sql_receive_ret="select a.prod_id,b.product_name_details,b.lot,b.color,c.received_mrr_no,c.issue_number,c.issue_date,c.issue_purpose,c.supplier_id,
				 sum(a.cons_quantity) as cons_quantity
				  from inv_transaction a,product_details_master b,inv_issue_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=8 and c.item_category=1 and a.transaction_type=3 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 and a.prod_id in($prod_idss)  group by a.prod_id,b.lot,b.color,b.product_name_details,c.received_mrr_no,c.issue_number,c.issue_purpose,c.supplier_id,c.issue_date";
				$resultReceive_ret = sql_select($sql_receive_ret);
            $k=1;
				foreach($resultReceive_ret as $row)
				{
					if ($k%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";	
				
						$ydw_no=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['ydw_no'];
						$recv_job=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['job'];
						$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
						$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
						$ydye_rate=$yarn_dyeing_rate_arr[$recv_job][$row[csf('color')]]['rate'];
						$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency']; 
							//echo $ydye_rate.'='.$ydw_no;
						$transaction_date=$booking_date;
						if($db_type==0)
						{
							$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						}
						
						//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
						$currency_rate=$ex_rateArr[$row[csf('prod_id')]];
							//echo $currency_id.'D';
						if($currency==1) //Taka
						{
							$dye_charge=$ydye_rate/$currency_rate;
						}
						else
						{
							$dye_charge=$ydye_rate;	
						}
						$po_quantity=$job_qty=0;
						foreach($po_ids as $poid)
						{
							
						 $po_quantity+=$job_array[$poid]['po_qty'];
						 $job_qty=$job_array[$poid]['job_qty'];
						}
					
						$recv_ret_amount=$row[csf('cons_quantity')]*$dye_charge;
						$avg_recv_ret_amount=($recv_ret_amount/$job_qty)*$po_quantity;
						//echo $recv_ret_amount.'/'.$job_qty.'*'.$po_quantity.'<br>';
						$avg_recv_ret_qty=($row[csf('cons_quantity')]/$job_qty)*$po_quantity;
						
						
						$total_yarn_return_qnty+=$avg_recv_ret_qty;
					if($is_short==2) //Main and Sample Faric Booking
					 {
						//echo $is_short.'ddd';
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $k; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $k;?>">
                    	<td width="40"><? echo $k; ?></td>
                    	<td width="110"><p><? echo $row[csf('issue_number')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('issue_date')]); ?></td>
						<td width="70"><p><? echo $row[csf('received_mrr_no')]; ?></p></td>
                        <td width="70"><p><? echo $supplier_array[$row[csf('supplier_id')]]; ?></p></td>
                        <td width="180"><p><? echo $row[csf('product_name_details')]; ?></p></td>
                        <td align="right" width="90">
							<? 
								echo fn_number_format($avg_recv_ret_qty,2); 
                            ?>
                        </td>
                        <td align="right" width="80">
							<? 
								echo fn_number_format($dye_charge,2); 
                            ?>&nbsp;
                        </td>
                        <td align="right" width="80" colspan="2">
							<?
								$yarn_return_cost=$avg_recv_ret_amount;
								echo fn_number_format($yarn_return_cost,2); 
								$total_yarn_return_cost+=$yarn_return_cost;
                            ?>
                        </td>
                    </tr>
                <?
                	$k++;
						}
                }
                ?>
                <tr style="font-weight:bold">
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                      <td>&nbsp;</td>
                    <td align="right">Total</td>
                    <td align="right"><? echo fn_number_format($total_yarn_return_qnty,2);?></td>
                     <td>&nbsp;</td>
                    <td align="right"  colspan="2"><? echo fn_number_format($total_yarn_return_cost,2);?></td>
                </tr>
				</tbody>
               
               	<tfoot>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                     <th>&nbsp;</th>
                    <th align="right">Balance</th>
                    <th align="right"><? echo fn_number_format(($total_yarn_recv_qnty+$total_trans_in_qnty)-($total_yarn_return_qnty+$total_trans_out_qnty),2); ?></th>
                    <th>&nbsp;</th>
                    <th align="right"  colspan="2"><? echo fn_number_format(($total_yarn_cost+$total_trans_in_cost)-($total_yarn_return_cost+$total_trans_out_cost),2); ?></th>
                </tfoot>
                </div>
            </table>	
		</div>
	<script>
  	setFilterGrid("table_search",-1);setFilterGrid("table_search2",-1);
  </script>
	</fieldset>  
<?
exit();
}

if($action=="knit_cost_actual")
{
	echo load_html_head_contents("Knitting Cost Actual Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);

	$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=13", "id", "product_name_details");

	?>
	<script>
	function generate_work_order_report(booking_no, cbo_company_name,show_comment,path,action_type) {
				
				if (action_type == 'show_trim_booking_report3')
				{
					var action_method = "action=show_trim_booking_report3";
				}
				
				report_title = "&report_title=Service Booking Sheet For Knitting";
				http.open("POST", "../../../../order/woven_order/requires/service_booking_knitting_controller.php", true);
						
				var data = action_method + report_title +
				'&txt_booking_no=' + "'" + booking_no + "'" +
				'&cbo_company_name=' + "'" + cbo_company_name + "'" +
				'&show_comment=' + "'" + show_comment + "'" +
				'&path=' + "'" + path + "'";
				//alert(data);
				
				http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				http.send(data);
				http.onreadystatechange = generate_fabric_report_reponse;
			}

			function generate_fabric_report_reponse() {
				if (http.readyState == 4) {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">' +
						'<html><head><title></title></head><body>' + http.responseText + '</body</html>');
					d.close();
				}
			}
	</script>
	<fieldset style="width:980px; margin-left:7px">
        <table class="rpt_table" width="875" cellpadding="0" cellspacing="0" border="1" rules="all">
		<caption style="background:#CCDDEE"><b>Knitting Cost Actaul</b></caption>
            <thead>
                <th width="40">SL</th>
                <th width="110">System No.</th> 
				<th width="110">Service Booking No.</th>
                <th width="80">Recv. Date</th>
                <th width="180">Fabric Description</th>
                <th width="110">Knitting Qty</th>
                <th width="80">Rate</th>
                <th>Amount (USD)</th>
            </thead>
        </table>
        <div style="width:875px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="855" cellpadding="0"  cellspacing="0">  
			
				 
				<tbody id="table_search">
            	
				<?
				$condition= new condition();//PROCESS_COSTING_MAINTAIN
				
				 if(str_replace("'","",$po_id) !=''){
					  $condition->po_id("in($po_id)");
				 }
				 	 $condition->init();
				
				
				  $conversion= new conversion($condition);
				 $conversion_costing_arr_process_arr=$conversion->getAmountArray_by_orderAndProcess();
				  $conversion= new conversion($condition);
				  $conversion_costing_arr_process_qty=$conversion->getQtyArray_by_orderAndProcess();
				  
				
				$plan_details_array = return_library_array("select dtls_id, booking_no as booking_no from ppl_planning_entry_plan_dtls where po_id in($po_id) group by dtls_id,booking_no", "dtls_id", "booking_no");
				//print_r($plan_details_array);
				$reqs_array = array();
				$reqs_sql = sql_select("select knit_id, requisition_no as reqs_no, sum(yarn_qnty) as yarn_req_qnty from ppl_yarn_requisition_entry where status_active=1 and is_deleted=0 group by knit_id, requisition_no");
				foreach ($reqs_sql as $row)
				 {
					//$reqs_array[$row[csf('knit_id')]]['reqs_no'] = $row[csf('reqs_no')];
					$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
				}
				unset($reqs_sql);
				$sql_wo_aop="select a.id,a.item_category,a.booking_no,a.booking_type,a.is_short,b.po_break_down_id as po_id,
				(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.wo_qnty ELSE 0 END) AS wo_qnty,
				(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.amount ELSE 0 END) AS amount
				 from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no  and a.item_category in(2,3,12) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0  and b.po_break_down_id in($po_id)";
				$result_aop_rate=sql_select( $sql_wo_aop );
				foreach ($result_aop_rate as $row)
				{
					if($row[csf('item_category')]==12)
					{
						$wo_qnty=$row[csf('wo_qnty')];
						$amount=$row[csf('amount')];
						$avg_wo_aop_rate=$amount/$wo_qnty;
						$aop_prod_array[$row[csf('po_id')]]['aop_rate']=$avg_wo_aop_rate;
					}
					else
					{
						$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
						$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
						
						$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
						$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
					}
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_aop_rate);
					
				
                $i=1;  
				$total_in_knit_qnty=0; $total_in_knit_cost_tk=0; $total_in_knit_cost_usd=0;
				$total_out_knit_qnty=0; $total_out_knit_cost_tk=0; $total_out_knit_cost_usd=0;
				$total_knit_qnty=0; $total_knit_cost_tk=0; $total_knit_cost_usd=0;
				$sql_grey_trans="select  a.recv_number,a.company_id,a.service_booking_no,a.receive_basis,a.booking_no,a.receive_date,b.po_breakdown_id as po_id,c.febric_description_id as deter_id,c.body_part_id,c.prod_id,c.kniting_charge,
				 (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
				
				  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(2,13)  and b.trans_type in(1) and b.po_breakdown_id in($po_id) ";
				  //group by a.recv_number,a.receive_basis,b.po_breakdown_id,a.booking_no,a.receive_date,c.febric_description_id,c.prod_id,c.body_part_id
				$result_grey=sql_select( $sql_grey_trans );
				$currency_id=1;$usd_id=2;
                foreach($result_grey as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
					
					$receive_basis=$row[csf('receive_basis')];
					$company_id=$row[csf('company_id')];
					$po_id=$row[csf('po_id')];
				$process_costing=return_field_value("process_costing_maintain", "variable_settings_production", "company_name=$company_id and variable_list=34 and is_deleted=0 and status_active=1");
				//echo $process_costing.'FF';
						
					
					
					if($db_type==0)
						{
							$conversion_date=change_date_format($row[csf('receive_date')], "Y-m-d", "-",1);
						}
						else
						{
							$conversion_date=change_date_format($row[csf('receive_date')], "d-M-y", "-",1);
						}
						$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
						
						if($process_costing==1)//Yes//Pre Costing
						{
							$knit_cost_mkt=array_sum($conversion_costing_arr_process_arr[$po_id][1]);
							$knit_qty_mkt=array_sum($conversion_costing_arr_process_qty[$po_id][1]);
							$knit_charge=$knit_cost_mkt/$knit_qty_mkt;
						}
						else //Knitting Prod.
						{
							if($currency_id==1) //TK
							{
								$knit_charge=$row[csf('kniting_charge')]/$exchange_rate;
								
							}
							else
							{
								$knit_charge=$row[csf('kniting_charge')];
							}
						}
						
						
						//$knit_charge=$row[csf('kniting_charge')];//$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['knit_charge'];
						//echo $knit_charge.'='.$row[csf('deter_id')].'ff'.$row[csf('po_breakdown_id')];
						if($receive_basis==1) //Booking Basis
						{
							 $booking_no=$row[csf('booking_no')];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						else if($receive_basis==2) //Knit plan Basis
						{
							$booking_no=$plan_details_array[$row[csf('booking_no')]];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						else if($receive_basis==4) //Salse Basis
						{
							 $prog_no=$row[csf('booking_no')];
							$booking_no=$plan_details_array[$prog_no];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						//echo $booking_type.'='.$is_short;
						if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							$grey_amt=$row[csf('grey_qnty')]*$knit_charge;
							//echo $row[csf('grey_qnty')].'*'.$knit_charge.', ';
						}
						//echo $booking_no.'='.$row[csf('service_booking_no')];
              		 if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
					 {
					 	$show_comment=1;$path="../../../../";$action_type="show_trim_booking_report3";
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('recv_number')]; ?></p></td>
						
						 <td width="110"><p><span style="cursor: pointer; text-decoration: underline; color: blue;" title="Print Booking"
							onClick="generate_work_order_report('<?php echo $row[csf('service_booking_no')];?>',<?php echo $row[csf('company_id')];?>,<?php echo $show_comment;?>,'<?php echo $path;?>','<?php echo $action_type;?>')"><?php echo $row[csf('service_booking_no')];?></span></p></td>
						
                        <td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
                        <td width="180"><p><? echo $product_array[$row[csf('prod_id')]]; ?></p></td>
                        <td align="right" width="110"><? echo fn_number_format($row[csf('grey_qnty')],2); ?></td>
                        <td align="right" width="80"><? echo fn_number_format($knit_charge,4); ?>&nbsp;</td>
                        <td align="right">
                            <?
								$amount_usd=$grey_amt;
                                echo fn_number_format($amount_usd,2); 
                            ?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_in_knit_qnty+=$row[csf('grey_qnty')];
				
					$total_in_knit_cost_usd+=$amount_usd;
						}
                }
                ?>
                <tr bgcolor="#CCCCCC">
                    <td>&nbsp;</td>
					 <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td align="right"><b>Total</b></td>
                    <td align="right"><? echo fn_number_format($total_in_knit_qnty,2); ?></td>
                    <td align="right"><? echo fn_number_format($total_in_knit_cost_usd/$total_in_knit_qnty,2); ?>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($total_in_knit_cost_usd,2); ?></td>
                </tr>
				</tbody>
                
              
			</table>
        </div>	
	<script>
  	setFilterGrid("table_search",-1);
  </script>
	</fieldset>  
<?
exit();
}

if($action=="knit_cost_actual5")
{
	echo load_html_head_contents("Knitting Cost Actual Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);
	$ex_rate=103;
	$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=13", "id", "product_name_details");

	?>
	<script>
	function generate_work_order_report(booking_no, cbo_company_name,show_comment,path,action_type) {
				
				if (action_type == 'show_trim_booking_report3')
				{
					var action_method = "action=show_trim_booking_report3";
				}
				
				report_title = "&report_title=Service Booking Sheet For Knitting";
				http.open("POST", "../../../../order/woven_order/requires/service_booking_knitting_controller.php", true);
						
				var data = action_method + report_title +
				'&txt_booking_no=' + "'" + booking_no + "'" +
				'&cbo_company_name=' + "'" + cbo_company_name + "'" +
				'&show_comment=' + "'" + show_comment + "'" +
				'&path=' + "'" + path + "'";
				//alert(data);
				
				http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				http.send(data);
				http.onreadystatechange = generate_fabric_report_reponse;
			}

			function generate_fabric_report_reponse() {
				if (http.readyState == 4) {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">' +
						'<html><head><title></title></head><body>' + http.responseText + '</body</html>');
					d.close();
				}
			}
	</script>
		<fieldset style="width:980px; margin-left:7px">
        <table class="rpt_table" width="875" cellpadding="0" cellspacing="0" border="1" rules="all">
		<caption style="background:#CCDDEE"><b>Knitting Cost Actaul</b></caption>
            <thead>
                <th width="40">SL</th>
                <th width="110">Bill No.</th> 
				<th width="110">Service Booking No.</th>
                <th width="80">Bill Date.</th>
                <th width="180">Fabric Description</th>
                <th width="110">Knitting Qty</th>
                <th width="80">Rate</th>
                <th>Amount (USD)</th>
            </thead>
        </table>
        <div style="width:875px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="855" cellpadding="0"  cellspacing="0">  
			
				 
				<tbody id="table_search">
            	
				<?
                $i=1;  
				$total_in_knit_qnty=0; $total_in_knit_cost_tk=0; $total_in_knit_cost_usd=0;
				$total_out_knit_qnty=0; $total_out_knit_cost_tk=0; $total_out_knit_cost_usd=0;
				$total_knit_qnty=0; $total_knit_cost_tk=0; $total_knit_cost_usd=0;


			//============================================knit inbound bill issue===============================================
			$knit_in_bill_sql="select a.bill_no,b.id as upd_id,b.challan_no,  b.process_id,b.rate, b.amount, b.order_id, b.currency_id ,b.add_rate,SUM(b.delivery_qty) as delivery_qty,a.bill_date,b.item_id from subcon_inbound_bill_mst a,subcon_inbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0  and b.status_active=1 and b.is_deleted=0 and a.process_id=2 and b.order_id in($po_id) group by a.bill_no,b.id,  b.process_id,b.rate, b.amount, b.order_id, b.currency_id ,b.add_rate,a.bill_date,b.item_id,b.challan_no ";
			$knit_in_bill_data=sql_select($knit_in_bill_sql);
			foreach($knit_in_bill_data as $kival){
					$currency_id=$kival[csf('currency_id')];
					$order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['bill_date']=$kival[csf('bill_date')];
					$usd_id=2;
					$conversion_date=change_date_format($order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['bill_date'], "d-M-y", "-",1);
					$currency_rate=set_conversion_rate($usd_id,$conversion_date,1 );
					$order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['bill_no']=$kival[csf('bill_no')];
					if($currency_id==1) //TK
					{
						$order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['rate']=$kival[csf('rate')]/$currency_rate;	
					}
					else
					{
						$order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['rate']=$kival[csf('rate')];
					}
					
					$order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['delivery_qty']+=$kival[csf('delivery_qty')];
					$order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['amount']+=$kival[csf('amount')];
					$order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['currency_id']=$kival[csf('currency_id')];
					$order_wise_knit_bill_data[$kival[csf('bill_no')]][$kival[csf('order_id')]][$kival[csf('upd_id')]]['item_id']=$kival[csf('item_id')];
			}

			//echo '<pre>';print_r($currency_rate);die;
			if(count($knit_in_bill_data)>0){
				foreach($knit_in_bill_data as $row){
					if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
			?>
			 <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="110"><p><? echo $order_wise_knit_bill_data[$row[csf('bill_no')]][$row[csf('order_id')]][$row[csf('upd_id')]]['bill_no']; ?></p></td>
						
						 <td width="110"><p><span style="cursor: pointer; text-decoration: underline; color: blue;" title="Print Booking"
							onClick="generate_work_order_report('<?php echo $row[csf('service_booking_no')];?>',<?php echo $row[csf('company_id')];?>,<?php echo $show_comment;?>,'<?php echo $path;?>','<?php echo $action_type;?>')"><?php echo $row[csf('service_booking_no')];?></span></p></td>
						
                        <td width="80" align="center"><? echo change_date_format($order_wise_knit_bill_data[$row[csf('bill_no')]][$row[csf('order_id')]][$row[csf('upd_id')]]['bill_date']); ?></td>
                        <td width="180"><p><? echo $product_array[$order_wise_knit_bill_data[$row[csf('bill_no')]][$row[csf('order_id')]][$row[csf('upd_id')]]['item_id']]; ?></p></td>
                        <td align="right" width="110"><? echo number_format($order_wise_knit_bill_data[$row[csf('bill_no')]][$row[csf('order_id')]][$row[csf('upd_id')]]['delivery_qty'],2); ?></td>
                        <td align="right" width="80"><? echo number_format($order_wise_knit_bill_data[$row[csf('bill_no')]][$row[csf('order_id')]][$row[csf('upd_id')]]['rate'],4); ?>&nbsp;</td>
                        <td align="right">
                            <?
								$amount_knit=$order_wise_knit_bill_data[$row[csf('bill_no')]][$row[csf('order_id')]][$row[csf('upd_id')]]['delivery_qty']*$order_wise_knit_bill_data[$row[csf('bill_no')]][$row[csf('order_id')]][$row[csf('upd_id')]]['rate'];
                                echo number_format($amount_knit,2); 
                            ?>
                        </td>
                    </tr><?
					 $i++;
					 $total_in_knit_qnty+=$order_wise_knit_bill_data[$row[csf('bill_no')]][$row[csf('order_id')]][$row[csf('upd_id')]]['delivery_qty'];
				 
					 $total_in_knit_cost_usd+=$amount_knit;
				}
			}
			unset($knit_in_bill_data);


                ?>
                <tr bgcolor="#CCCCCC">
                    <td>&nbsp;</td>
					 <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td align="right"><b>Total</b></td>
                    <td align="right"><? echo number_format($total_in_knit_qnty+$total_out_knit_qnty,2); ?></td>
                    <td align="right"><? //echo number_format($total_in_knit_cost_usd/$total_in_knit_qnty,2); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($total_in_knit_cost_usd+$total_out_knit_cost_usd,2); ?></td>
                </tr>
				</tbody>
                
              
			</table>
        </div>	
	<script>
  	setFilterGrid("table_search",-1);
  </script>
	</fieldset>  
	<?
	exit();
}

if($action=="knit_cost_actual_popup")
{
	echo load_html_head_contents("Knitting Cost Actual Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);

	$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=13", "id", "product_name_details");

?>
<script>
	function generate_work_order_report(booking_no, cbo_company_name,show_comment,path,action_type) {
				
				if (action_type == 'show_trim_booking_report3')
				{
					var action_method = "action=show_trim_booking_report3";
				}
				
				report_title = "&report_title=Service Booking Sheet For Knitting";
				http.open("POST", "../../../../order/woven_order/requires/service_booking_knitting_controller.php", true);
						
				var data = action_method + report_title +
				'&txt_booking_no=' + "'" + booking_no + "'" +
				'&cbo_company_name=' + "'" + cbo_company_name + "'" +
				'&show_comment=' + "'" + show_comment + "'" +
				'&path=' + "'" + path + "'";
				//alert(data);
				
				http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
				http.send(data);
				http.onreadystatechange = generate_fabric_report_reponse;
			}

			function generate_fabric_report_reponse() {
				if (http.readyState == 4) {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">' +
						'<html><head><title></title></head><body>' + http.responseText + '</body</html>');
					d.close();
				}
			}
</script>
	<fieldset style="width:980px; margin-left:7px">
        <table class="rpt_table" width="875" cellpadding="0" cellspacing="0" border="1" rules="all">
		<caption style="background:#CCDDEE"><b>Knitting Cost Actaul</b></caption>
            <thead>
                <th width="40">SL</th>
                <th width="110">System No.</th> 
				<th width="110">Service Booking No.</th>
                <th width="80">Recv. Date</th>
                <th width="180">Fabric Description</th>
                <th width="110">Knitting Qty</th>
                <th width="80">Rate</th>
                <th>Amount (USD)</th>
            </thead>
        </table>
        <div style="width:875px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="855" cellpadding="0"  cellspacing="0">  
			
				 
				<tbody id="table_search">
            	
				<?

				
				$condition= new condition();//PROCESS_COSTING_MAINTAIN
				
				 if(str_replace("'","",$po_id) !=''){
					 // $condition->po_id("in($po_id)");
				 }
				 	// $condition->init();
				
				
				 // $conversion= new conversion($condition);
				// $conversion_costing_arr_process_arr=$conversion->getAmountArray_by_orderAndProcess();
				 // $conversion= new conversion($condition);
				//  $conversion_costing_arr_process_qty=$conversion->getQtyArray_by_orderAndProcess();	
				$plan_details_array = return_library_array("select dtls_id, booking_no as booking_no from ppl_planning_entry_plan_dtls where po_id in($po_id) group by dtls_id,booking_no", "dtls_id", "booking_no");
				//print_r($plan_details_array);
				$reqs_array = array();
				$reqs_sql = sql_select("select knit_id, requisition_no as reqs_no, sum(yarn_qnty) as yarn_req_qnty from ppl_yarn_requisition_entry where status_active=1 and is_deleted=0 group by knit_id, requisition_no");
				foreach ($reqs_sql as $row)
				 {
					//$reqs_array[$row[csf('knit_id')]]['reqs_no'] = $row[csf('reqs_no')];
					$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
				}
				unset($reqs_sql);
				//echo $cbo_company_name.'DDDD';
				$usd_id=2;
				 $knit_fin_fab_array=array(); 
			  $converson_fab_cost_sql="select a.company_id,b.currency_id,a.bill_no,b.order_id, a.bill_date, b.id as dtls_id,b.item_id, b.rate, b.receive_qty,b.rate, b.amount as amount  from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and b.order_id in($po_id) and a.process_id=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   order by b.item_id";


				 $con_fab_data=sql_select($converson_fab_cost_sql);

				 foreach($con_fab_data as $row )
				 {
					$currency_id=$row[csf('currency_id')];
					$company_id=$row[csf('company_id')];
					$conversion_date=change_date_format($row[csf('bill_date')], "d-M-y", "-",1);
					$currency_rate=set_conversion_rate($usd_id,$conversion_date,$company_id );
					$knit_subcon_array[$row[csf('dtls_id')]]['currency_id']=$currency_id;
					$knit_subcon_array[$row[csf('dtls_id')]]['company_id']=$company_id;
					$knit_subcon_array[$row[csf('dtls_id')]]['bill_date']=$row[csf('bill_date')];

					if($currency_id==2) //Usd
					{	
					 $knit_fin_fab_array[$row[csf('order_id')]]['knit_gross_amt']=$row[csf('amount')];
				  	 $knit_fin_fab_array[$row[csf('order_id')]]['rate']=$row[csf('rate')];
					}
					else
					{
						$knit_fin_fab_array[$row[csf('order_id')]]['knit_gross_amt']=$row[csf('amount')]/$currency_rate;
						$knit_fin_fab_array[$row[csf('order_id')]]['rate']=$row[csf('rate')]/$currency_rate;
					}
				 }

				 unset($con_fab_data);
				$sql_wo_aop="select a.id,a.item_category,a.booking_no,a.booking_type,a.is_short,b.po_break_down_id as po_id,
				(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.wo_qnty ELSE 0 END) AS wo_qnty,
				(CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.amount ELSE 0 END) AS amount
				 from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no  and a.item_category in(2,3,12) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0  and b.po_break_down_id in($po_id)";
				$result_aop_rate=sql_select( $sql_wo_aop );
				foreach ($result_aop_rate as $row)
				{
					if($row[csf('item_category')]==12)
					{
						$wo_qnty=$row[csf('wo_qnty')];
						$amount=$row[csf('amount')];
						$avg_wo_aop_rate=$amount/$wo_qnty;
						$aop_prod_array[$row[csf('po_id')]]['aop_rate']=$avg_wo_aop_rate;
					}
					else
					{
						$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
						$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
						
						$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
						$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
					}
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_aop_rate);
					
				
                $i=1;  
				$total_in_knit_qnty=0; $total_in_knit_cost_tk=0; $total_in_knit_cost_usd=0;
				$total_out_knit_qnty=0; $total_out_knit_cost_tk=0; $total_out_knit_cost_usd=0;
				$total_knit_qnty=0; $total_knit_cost_tk=0; $total_knit_cost_usd=0;
				$sql_grey_trans="select  a.recv_number,a.company_id,d.currency_id,a.service_booking_no,a.receive_basis,a.booking_no,a.receive_date,b.po_breakdown_id as po_id,c.febric_description_id as deter_id,c.body_part_id,c.prod_id,c.kniting_charge,(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty,d.rate,d.amount,d.id as dtls_id from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,subcon_outbound_bill_dtls d where a.id=c.mst_id and c.id=b.dtls_id  and b.po_breakdown_id=d.order_id and c.body_part_id=d.body_part_id and c.prod_id=d.item_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(2,13)  and b.trans_type in(1) and b.po_breakdown_id in($po_id) ";
				$result_grey=sql_select( $sql_grey_trans );
				 $usd_id=2;
                foreach($result_grey as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
					
					$receive_basis=$row[csf('receive_basis')];
					//$company_id=$row[csf('company_id')];
					$po_id=$row[csf('po_id')];
					$currency_id=$row[csf('currency_id')];

					//$currency_id=$knit_subcon_array[$row[csf('dtls_id')]]['currency_id'];
					$company_id=$knit_subcon_array[$row[csf('dtls_id')]]['company_id'];
					$bill_date=$knit_subcon_array[$row[csf('dtls_id')]]['bill_date'];

					
				$process_costing=return_field_value("process_costing_maintain", "variable_settings_production", "company_name=$company_id and variable_list=34 and is_deleted=0 and status_active=1");
				//$conversion_date=change_date_format($row[csf('receive_date')], "d-M-y", "-",1);
				$conversion_date=change_date_format($bill_date, "d-M-y", "-",1);
				$exchange_rate=set_conversion_rate($usd_id,$conversion_date,$company_id );
						
						if($process_costing==1)//Yes//Pre Costing
						{
							$knit_cost_mkt=array_sum($conversion_costing_arr_process_arr[$po_id][1]);
							$knit_qty_mkt=array_sum($conversion_costing_arr_process_qty[$po_id][1]);
							$knit_charge=$knit_cost_mkt/$knit_qty_mkt;
						}
						else //Knitting Prod.
						{
							if($currency_id==1) //TK
							{
								$knit_charge=$row[csf('kniting_charge')]/$exchange_rate;
								
							}
							else
							{
								$knit_charge=$row[csf('kniting_charge')];
							}
						}
						 //echo $currency_id.'d'.$exchange_rate.'<br>';
						if($currency_id==1) //TK
						{
							$amount=$row[csf('amount')]/$exchange_rate;
							
						}
						else
						{
							$amount=$row[csf('amount')];
						}
						
						
						
						//$knit_charge=$row[csf('kniting_charge')];//$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['knit_charge'];
						//echo $knit_charge.'='.$row[csf('deter_id')].'ff'.$row[csf('po_breakdown_id')];
						if($receive_basis==1) //Booking Basis
						{
							 $booking_no=$row[csf('booking_no')];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						else if($receive_basis==2) //Knit plan Basis
						{
							$booking_no=$plan_details_array[$row[csf('booking_no')]];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						else if($receive_basis==4) //Salse Basis
						{
							 $prog_no=$row[csf('booking_no')];
							$booking_no=$plan_details_array[$prog_no];
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						//echo $booking_type.'='.$is_short;
						if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							$grey_amt=$row[csf('grey_qnty')]*$knit_charge;
							//echo $row[csf('grey_qnty')].'*'.$knit_charge.', ';
						}
						//echo $booking_no.'='.$row[csf('service_booking_no')];
              		 if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
					 {
					 	$show_comment=1;$path="../../../../";$action_type="show_trim_booking_report3";
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('recv_number')]; ?></p></td>
						<td width="110"><p><span style="cursor: pointer; text-decoration: underline; color: blue;" title="Print Booking"
							onClick="generate_work_order_report('<?php echo $row[csf('service_booking_no')];?>',<?php echo $row[csf('company_id')];?>,<?php echo $show_comment;?>,'<?php echo $path;?>','<?php echo $action_type;?>')"><?php echo $row[csf('service_booking_no')];?></span></p></td>
						
                        <td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
                        <td width="180"><p><? echo $product_array[$row[csf('prod_id')]]; ?></p></td>
                        <td align="right" width="110"> <? echo fn_number_format($row[csf('grey_qnty')],2); ?></td>
                        <td align="right" width="80"><? echo fn_number_format($amount/$row[csf('grey_qnty')],2); ?>&nbsp;</td>
                        <td align="right"><? echo fn_number_format($amount,2);?></td>
                    </tr>
                <?
                	$i++;
					$total_in_knit_qnty+=$row[csf('grey_qnty')];
					$total_in_knit_cost_usd+=$amount;
						}
                }
                ?>
                <tr bgcolor="#CCCCCC">
                    <td>&nbsp;</td>
					 <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td align="right"><b>Total</b></td>
                    <td align="right"><? echo fn_number_format($total_in_knit_qnty,2); ?></td>
                    <td align="right"><? echo fn_number_format($total_in_knit_cost_usd/$total_in_knit_qnty,2); ?>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($total_in_knit_cost_usd,2); ?></td>
                </tr>
				</tbody>
                
              
			</table>
        </div>	
	<script>
  	setFilterGrid("table_search",-1);
  </script>
	</fieldset>  
<?
exit();
}

if($action=="dye_finish_cost_actual")
{
	echo load_html_head_contents("Dyeing Bill Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);

	$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=2", "id", "product_name_details");
	$batch_no_array=return_library_array( "select id, batch_no from pro_batch_create_mst where status_active=1", "id", "batch_no");
	?>
	<script>
	function print_window()
	{
		//document.getElementById('scroll_body').style.overflow="auto";
		$("#list_view_data tr:first").hide();
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
	
		d.close();
		//document.getElementById('scroll_body').style.overflowY="scroll";
		$("#list_view_data tr:first").show();
	}	
    </script>
	<fieldset style="width:870px; margin-left:7px">
    <input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/>
    <div id="report_container">
        <table class="rpt_table" width="850" cellpadding="0" cellspacing="0" border="1" rules="all" >
        <caption style="background:#CCDDEE"> <b>Dye and Finish Details</b></caption>
            <thead>
                <th width="40">SL</th>
                <th width="130">System No.</th>
                <th width="80">Recv. Date</th>
                <th width="100">Barcode/ Batch No</th>
                <th width="200">Fabric Description</th>
                <th width="100">Qty</th>
                <th width="80">Rate</th>
                <th>Amount</th>
            </thead>
        </table>
        <div style="width:850px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="830" cellpadding="0" cellspacing="0" id="list_view_data">  
            	 
				<?
                $i=1; $avg_rate=76;
				$total_in_knit_qnty=0; $total_in_knit_cost_tk=0; $total_in_knit_cost_usd=0;
				$total_out_knit_qnty=0; $total_out_knit_cost_tk=0; $total_out_knit_cost_usd=0;
				$total_knit_qnty=0; $total_knit_cost_tk=0; $total_knit_cost_usd=0;
				
				 $prodcostDataArray="select a.body_part_id,a.lib_yarn_count_deter_id as deter_id,a.body_part_id,b.po_break_down_id as po_id,
									  avg(CASE WHEN c.cons_process=1 THEN c.charge_unit END) AS knit_charge,
									  avg(CASE WHEN c.cons_process=30 THEN c.charge_unit END) AS yarn_dye_charge,
									  avg(CASE WHEN c.cons_process=35 THEN c.charge_unit END) AS aop_charge,
									  avg(CASE WHEN c.cons_process not in(1,2,30,35,134) THEN c.charge_unit END) AS dye_finish_charge
									  from wo_pre_cost_fabric_cost_dtls a,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cos_fab_co_avg_con_dtls b where a.id=c.fabric_description and a.job_no=c.job_no and b.pre_cost_fabric_cost_dtls_id=a.id and b.job_no=c.job_no and c.status_active=1 and c.is_deleted=0  and b.po_break_down_id in($po_id) group by  a.lib_yarn_count_deter_id,b.po_break_down_id,a.body_part_id";
				$resultfab_arr = sql_select($prodcostDataArray);
				foreach($resultfab_arr as $prodRow)
				{
					//echo $prodRow[csf('knit_charge')].',';
					$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['knit_charge']=$prodRow[csf('knit_charge')];
					$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['yarn_dye_charge']=$prodRow[csf('yarn_dye_charge')];
					$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['aop_charge']=$prodRow[csf('aop_charge')];
					$prodcostArray2[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['dye_finish_charge']=$prodRow[csf('dye_finish_charge')];
				}	
				
				
				
				$grey_used_sql = "select a.body_part_id,a.fabric_description_id as deter_id,a.prod_id,b.barcode_no,b.qnty,b.po_breakdown_id as po_id,c.recv_number,c.receive_date,c.receive_purpose from pro_finish_fabric_rcv_dtls a, pro_roll_details b, inv_receive_master c where a.id=b.dtls_id and c.id=b.mst_id and b.entry_form=66 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in($po_id)";
				$grey_used_data =sql_select($grey_used_sql );
                foreach($grey_used_data as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
                
				$dye_finish_charge=$prodcostArray2[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$used_amount=$row[csf('qnty')]*$dye_finish_charge;
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="130"><p><? echo $row[csf('recv_number')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
                         <td width="100"><p><? echo $row[csf('barcode_no')]; ?></p></td>
                        <td width="200"><p><? echo $product_array[$row[csf('prod_id')]]; ?></p></td>
                        <td align="right" width="100"><? echo fn_number_format($row[csf('qnty')],2); ?></td>
                        <td align="right" width="80"><? echo fn_number_format($dye_finish_charge,2); ?>&nbsp;</td>
                        <td align="right" width="">
						<? 
							echo fn_number_format($used_amount,2); 
						?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_in_knit_qnty+=$row[csf('qnty')];
					
					$total_in_knit_cost_usd+=$used_amount;
                }
				
				$finProd_grey_used_sql = "select c.prod_id,c.batch_id,c.body_part_id,c.fabric_description_id as deter_id,d.recv_number,d.receive_date,d.receive_purpose,b.po_breakdown_id as po_id, b.quantity as qnty from order_wise_pro_details b,pro_finish_fabric_rcv_dtls c,inv_receive_master d where  b.dtls_id=c.id and  d.id=c.mst_id and b.entry_form=7 and d.entry_form=7 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in($po_id) ";
				$fingrey_used_data =sql_select($finProd_grey_used_sql );
				foreach($fingrey_used_data as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
                
				$dye_finish_charge=$prodcostArray2[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$used_amount=$row[csf('qnty')]*$dye_finish_charge;
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="130"><p><? echo $row[csf('recv_number')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
                         <td width="100"><p><? echo $batch_no_array[$row[csf('batch_id')]]; ?></p></td>
                        <td width="200"><p><? echo $product_array[$row[csf('prod_id')]]; ?></p></td>
                        <td align="right" width="100"><? echo fn_number_format($row[csf('qnty')],2); ?></td>
                        <td align="right" width="80"><? echo fn_number_format($dye_finish_charge,2); ?>&nbsp;</td>
                        <td align="right" width="">
						<? 
							echo fn_number_format($used_amount,2); 
						?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_in_knit_qnty+=$row[csf('qnty')];
					
					$total_in_knit_cost_usd+=$used_amount;
                }
                ?>
                <tr bgcolor="#CCCCCC">
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td align="right"><b>Total</b></td>
                    <td align="right"><? echo fn_number_format($total_in_knit_qnty,2); ?></td>
                    <td align="right"><? echo fn_number_format($total_in_knit_qnty/$total_in_knit_cost_usd,2); ?>&nbsp;</td>
                    <td  align="right"> <? echo fn_number_format($total_in_knit_cost_usd,2); ?>&nbsp;</td>
                </tr>
			</table>
        </div>	
        </div>
	</fieldset> 
    <script>
    	setFilterGrid("list_view_data",-1); 
	</script>
<?
exit();
}

if($action=="dye_finish_cost_actual5")
{
	echo load_html_head_contents("Dyeing Bill Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);

	$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=2", "id", "product_name_details");
	$batch_no_array=return_library_array( "select id, batch_no from pro_batch_create_mst where status_active=1", "id", "batch_no");
	?>
	<script>
	function print_window()
	{
		//document.getElementById('scroll_body').style.overflow="auto";
		$("#list_view_data tr:first").hide();
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
	
		d.close();
		//document.getElementById('scroll_body').style.overflowY="scroll";
		$("#list_view_data tr:first").show();
	}	
    </script>
	<fieldset style="width:770px; margin-left:7px">
    <input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/>
    <div id="report_container">
        <table class="rpt_table" width="750" cellpadding="0" cellspacing="0" border="1" rules="all" >
        <caption style="background:#CCDDEE"> <b>Dye and Finish Details</b></caption>
            <thead>
                <th width="40">SL</th>
                <th width="130">System No.</th>
                <th width="80">Recv. Date</th>
                <th width="200">Fabric Description</th>
                <th width="100">Qty</th>
                <th width="80">Rate</th>
                <th>Amount</th>
            </thead>
        </table>
        <div style="width:750px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="730" cellpadding="0" cellspacing="0" id="list_view_data">  
            	 
				<?
				$usd_id=2;
                $i=1;
				$total_in_knit_qnty=0; $total_in_knit_cost_tk=0; $total_in_knit_cost_usd=0;
				$total_out_knit_qnty=0; $total_out_knit_cost_tk=0; $total_out_knit_cost_usd=0;
				$total_knit_qnty=0; $total_knit_cost_tk=0; $total_knit_cost_usd=0;

	$composition_arr=array(); $constructtion_arr=array();
	$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id";
	$data_array=sql_select($sql_deter);
	foreach( $data_array as $row )
	{
		if(array_key_exists($row[csf('id')],$composition_arr))
		{
			$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
		}
		else
		{
			$composition_arr[$row[csf('id')]]=$row[csf('construction')].", ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
		}
	}

	$grey_sql="select a.bill_no,a.bill_date,b.delivery_qty,b.rate,b.amount,b.currency_id,b.febric_description_id,a.discount from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls    b where  a.id=b.mst_id and b.order_id in ($po_id) and a.process_id=4 group by a.bill_no,a.bill_date,b.delivery_qty,b.rate,b.amount,b.currency_id,b.febric_description_id,a.discount";
	$grey_used_data =sql_select($grey_sql);
	foreach($grey_used_data as $row)
	{
		$desc_composition=$composition_arr[$row[csf('febric_description_id')]];
		$currency_id=$row[csf('currency_id')];
		$bill_date=$row[csf('bill_date')];
		$conversion_date=change_date_format($bill_date, "d-M-y", "-",1);
		$currency_rate=set_conversion_rate($usd_id,$conversion_date,$company_id );
		if($currency_id==2) //Usd
		{
			if($row[csf('discount')]>0){
				$usd_amount=$row[csf('delivery_qty')]*$row[csf('rate')]-$row[csf('discount')];
			}else{
				$usd_amount=$row[csf('delivery_qty')]*$row[csf('rate')];
			}
		}
		else{
			if($row[csf('discount')]>0){
				$usd_amount=($row[csf('delivery_qty')]*$row[csf('rate')]-$row[csf('discount')])/$currency_rate;
			}else{
				$usd_amount=($row[csf('delivery_qty')]*$row[csf('rate')])/$currency_rate;
			}
		}
	if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
	$used_amount=$row[csf('delivery_qty')]*$row[csf('rate')];
    ?>
	<tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
		<td width="40"><? echo $i; ?></td>
		<td width="130"><p><? echo $row[csf('bill_no')]; ?></p></td>
		<td width="80" align="center"><? echo change_date_format($row[csf('bill_date')]); ?></td>
		<td width="200"><p><? echo $desc_composition; ?></p></td>
		<td align="right" width="100"><? echo fn_number_format($row[csf('delivery_qty')],2); ?></td>
		<td align="right" width="80"><? echo fn_number_format($usd_amount/$row[csf('delivery_qty')],2); ?>&nbsp;</td>
		<td align="right" width="">
		<? 
			echo fn_number_format($usd_amount,2); 
		?>
		</td>
	</tr>
	<?
		$i++;
		$total_in_knit_qnty+=$row[csf('delivery_qty')];
		
		$total_in_knit_cost_usd+=$usd_amount;
	}
	?>
	<tr bgcolor="#CCCCCC">
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td align="right"><b>Total</b></td>
		<td align="right"><? echo fn_number_format($total_in_knit_qnty,2); ?></td>
		<td align="right"><? //echo fn_number_format($total_in_knit_qnty/$total_in_knit_cost_usd,2); ?>&nbsp;</td>
		<td  align="right"> <? echo fn_number_format($total_in_knit_cost_usd,2); ?>&nbsp;</td>
	</tr>
	</table>
	</div>	
	</div>
	</fieldset> 
    <script>
    	setFilterGrid("list_view_data",-1); 
	</script>
<?
exit();
}

if($action=="dye_finish_cost_actual_popup")
{
	echo load_html_head_contents("Dyeing Bill Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);

	$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=2", "id", "product_name_details");
	$batch_no_array=return_library_array( "select id, batch_no from pro_batch_create_mst where status_active=1", "id", "batch_no");
	?>
	<script>
	function print_window()
	{
		//document.getElementById('scroll_body').style.overflow="auto";
		$("#list_view_data tr:first").hide();
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
	
		d.close();
		//document.getElementById('scroll_body').style.overflowY="scroll";
		$("#list_view_data tr:first").show();
	}	
    </script>
	<fieldset style="width:770px; margin-left:7px">
    <input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/>
    <div id="report_container">
        <table class="rpt_table" width="750" cellpadding="0" cellspacing="0" border="1" rules="all" >
        <caption style="background:#CCDDEE"> <b>Dye and Finish Details</b></caption>
            <thead>
                <th width="40">SL</th>
                <th width="130">System No.</th>
                <th width="80">Recv. Date</th>
                <th width="200">Fabric Description</th>
                <th width="100">Qty</th>
                <th width="80">Rate</th>
                <th>Amount</th>
            </thead>
        </table>
        <div style="width:750px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="730" cellpadding="0" cellspacing="0" id="list_view_data">  
            	 
				<?
				$usd_id=2;
                $i=1; $avg_rate=76;
				$total_in_knit_qnty=0; $total_in_knit_cost_tk=0; $total_in_knit_cost_usd=0;
				$total_out_knit_qnty=0; $total_out_knit_cost_tk=0; $total_out_knit_cost_usd=0;
				$total_knit_qnty=0; $total_knit_cost_tk=0; $total_knit_cost_usd=0;
				    $sql_dye=sql_select("select d.company_id,c.currency_id,d.bill_date from subcon_inbound_bill_mst d,subcon_inbound_bill_dtls c where d.id=c.mst_id and c.status_active=1 and c.order_id in ($po_id) ");
				 
				foreach($sql_dye as $row)
                {
					$currency_id=$row[csf('currency_id')];
					$bill_date=$row[csf('bill_date')];
					$company_id=$row[csf('company_id')];
				}

				 $grey_sql="select a.body_part_id,
				a.fabric_description_id     as deter_id,
				a.prod_id,
				d.delivery_qty,
				d.currency_id,
				b.discount,
				c.recv_number,
				c.receive_date,
				d.rate,
				e.item_description
		   from pro_finish_fabric_rcv_dtls  a,
		   subcon_inbound_bill_mst b,
				inv_receive_master c,
				subcon_inbound_bill_dtls    d,
				pro_batch_create_dtls e
		  where  c.id=d.delivery_id
				and a.fabric_description_id=d.febric_description_id
				and d.item_id=a.prod_id
				and d.order_id=e.po_id
				and b.id=d.mst_id
				and d.order_id in ($po_id)
				group by a.body_part_id,
				a.fabric_description_id,d.currency_id,
				a.prod_id,
				c.recv_number,
				c.receive_date,
				 d.delivery_qty,
				 d.rate,
				 b.discount,
				e.item_description";
				$grey_used_data =sql_select($grey_sql);
                foreach($grey_used_data as $row)
                {
					$currency_id=$row[csf('currency_id')];
					$conversion_date=change_date_format($bill_date, "d-M-y", "-",1);
					$currency_rate=set_conversion_rate($usd_id,$conversion_date,$company_id );
					if($currency_id==2) //Usd
					{
						if($row[csf('discount')]>0){
							$usd_amount=$row[csf('delivery_qty')]*$row[csf('rate')]-$row[csf('discount')];
						}else{
							$usd_amount=$row[csf('delivery_qty')]*$row[csf('rate')];
						}
					}
					else{
						if($row[csf('discount')]>0){
							$usd_amount=($row[csf('delivery_qty')]*$row[csf('rate')]-$row[csf('discount')])/$currency_rate;
						}else{
							$usd_amount=($row[csf('delivery_qty')]*$row[csf('rate')])/$currency_rate;
						}
					}


					
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
                
				$dye_finish_charge=$prodcostArray2[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$used_amount=$row[csf('delivery_qty')]*$row[csf('rate')];
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="130"><p><? echo $row[csf('recv_number')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
                        <td width="200"><p><? echo $row[csf('item_description')]; ?></p></td>
                        <td align="right" width="100"><? echo fn_number_format($row[csf('delivery_qty')],2); ?></td>
                        <td align="right" width="80"><? echo fn_number_format($usd_amount/$row[csf('delivery_qty')],2); ?>&nbsp;</td>
                        <td align="right" width="">
						<? 
							echo fn_number_format($usd_amount,2); 
						?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_in_knit_qnty+=$row[csf('delivery_qty')];
					
					$total_in_knit_cost_usd+=$usd_amount;
                }
				?>
                <tr bgcolor="#CCCCCC">
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td align="right"><b>Total</b></td>
                    <td align="right"><? echo fn_number_format($total_in_knit_qnty,2); ?></td>
                    <td align="right"><? //echo fn_number_format($total_in_knit_qnty/$total_in_knit_cost_usd,2); ?>&nbsp;</td>
                    <td  align="right"> <? echo fn_number_format($total_in_knit_cost_usd,2); ?>&nbsp;</td>
                </tr>
			</table>
        </div>	
        </div>
	</fieldset> 
    <script>
    	setFilterGrid("list_view_data",-1); 
	</script>
<?
exit();
}

if($action=="fabric_purchase_cost_actual")
{
	echo load_html_head_contents("Fabric Purchase Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);
	//$ex_rate=76;
	$sql_pre=sql_select("select  exchange_rate from wo_pre_cost_mst a,wo_po_break_down b  where b.job_id=a.job_id and b.id in($po_id)");
	foreach($sql_pre as $row)
	{
		$ex_rate=$row[csf('exchange_rate')];
	}
?>
<script>

	function print_window()
	{
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
	
		d.close();
	}	
	
</script>	
	<div style="width:860px" align="center"><input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/></div>
	<fieldset style="width:860px; margin-left:7px">
		<div id="report_container">
        	<u><b>Knit Fabric Purchase</b></u>
            <table class="rpt_table" width="855" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
                	<th width="40">SL</th>
                    <th width="110">Receive Id</th>
                    <th width="80">Receive Date</th>
                    <th width="280">Fabric Description</th>
                    <th width="110">Receive Qty.</th>
                    <th width="110">Avg. Rate (USD)</th>
                    <th>Cost ($)</th>
				</thead>
                <?
                $i=1; $total_recv_qnty=0; $total_recv_cost=0;
				$sql="select a.id, a.recv_number, a.receive_date, sum(b.quantity) as recv_qnty, sum(d.cons_rate*b.quantity) as amnt, c.id, c.product_name_details from inv_receive_master a, order_wise_pro_details b, product_details_master c, inv_transaction d where a.id=d.mst_id and d.transaction_type=1 and d.item_category=2 and c.item_category_id=2 and d.id=b.trans_id and b.trans_type=1 and b.entry_form=37 and a.entry_form=37 and b.po_breakdown_id=$po_id and b.prod_id=c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.receive_basis!=9 group by a.id, c.id, a.recv_number, a.receive_date, c.product_name_details";
                $result=sql_select($sql);
				foreach($result as $row)
				{
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";	
				
                    $total_recv_qnty+=$row[csf('recv_qnty')];
					
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                    	<td width="40"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('recv_number')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
                        <td width="280"><p><? echo $row[csf('product_name_details')]; ?></p></td>
                        <td align="right" width="110">
							<? 
								echo fn_number_format($row[csf('recv_qnty')],2); 
                            ?>
                        </td>
                        <td align="right" width="110">
							<? 
								$avg_rate=($row[csf('amnt')]/$row[csf('recv_qnty')])/$ex_rate;
								echo fn_number_format($avg_rate,2); 
                            ?>&nbsp;
                        </td>
                        <td align="right">
							<?
								$cost=$row[csf('recv_qnty')]*$avg_rate;
								//$cost=$row[csf('amnt')]/$ex_rate;
								$total_recv_cost+=$cost;
								echo fn_number_format($cost,2); 
                            ?>
                        </td>
                    </tr>
                <?
                $i++;
                }
                ?>
               	<tfoot>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th align="right">Total</th>
                    <th align="right"><? echo fn_number_format($total_recv_qnty,2); ?></th>
                    <th>&nbsp;</th>
                    <th align="right"><? echo fn_number_format($total_recv_cost,2); ?></th>
                </tfoot>
            </table>
            <br>
            <u><b>Woven Fabric Purchase</b></u>
            <table class="rpt_table" width="855" cellpadding="0" cellspacing="0" border="1" rules="all">
				<thead>
                	<th width="40">SL</th>
                    <th width="110">Receive Id</th>
                    <th width="80">Receive Date</th>
                    <th width="280">Fabric Description</th>
                    <th width="110">Receive Qty.</th>
                    <th width="110">Avg. Rate (USD)</th>
                    <th>Cost ($)</th>
				</thead>
                <?
                $i=1; $total_recv_qnty_w=0; $total_recv_cost_w=0;
				$sql="select a.id, a.recv_number, a.receive_date, sum(b.quantity) as recv_qnty, sum(d.cons_rate*b.quantity) as amnt, c.id, c.product_name_details from inv_receive_master a, order_wise_pro_details b, product_details_master c, inv_transaction d where a.id=d.mst_id and d.transaction_type=1 and d.item_category=3 and c.item_category_id=3 and d.id=b.trans_id and b.trans_type=1 and b.entry_form=17 and a.entry_form=17 and b.po_breakdown_id=$po_id and b.prod_id=c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by a.id, c.id, a.recv_number, a.receive_date, c.product_name_details";
                $result=sql_select($sql);
				foreach($result as $row)
				{
					if ($i%2==0)  
						$bgcolor="#E9F3FF";
					else
						$bgcolor="#FFFFFF";	
				
                    $total_recv_qnty_w+=$row[csf('recv_qnty')];
					
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                    	<td width="40"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('recv_number')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
                        <td width="280"><p><? echo $row[csf('product_name_details')]; ?></p></td>
                        <td align="right" width="110">
							<? 
								echo fn_number_format($row[csf('recv_qnty')],2); 
                            ?>
                        </td>
                        <td align="right" width="110">
							<? 
								$avg_rate=($row[csf('amnt')]/$row[csf('recv_qnty')])/$ex_rate;
								echo fn_number_format($avg_rate,2); 
                            ?>&nbsp;
                        </td>
                        <td align="right">
							<?
								$cost=$row[csf('recv_qnty')]*$avg_rate;
								//$cost=$row[csf('amnt')]/$ex_rate;
								$total_recv_cost_w+=$cost;
								echo fn_number_format($cost,2); 
                            ?>
                        </td>
                    </tr>
                <?
                $i++;
                }
                ?>
               	<tfoot>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th align="right">Total</th>
                    <th align="right"><? echo fn_number_format($total_recv_qnty_w,2); ?></th>
                    <th>&nbsp;</th>
                    <th align="right"><? echo fn_number_format($total_recv_cost_w,2); ?></th>
                </tfoot>
            </table>
            <table class="tbl_bottom" width="855" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<tr>
                	<td width="40">&nbsp;</td>
                    <td width="110">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="280">&nbsp;</td>
                    <td width="110">&nbsp;</td>
                    <td width="110">Grand Total</td>
                    <td align="right"><? echo fn_number_format($total_recv_cost+$total_recv_cost_w,2); ?></td>
                </tr>
            </table>	
		</div>
	</fieldset>  
<?
exit();
}

if($action=="fabric_purchase_cost5")
{
	echo load_html_head_contents("Fabric Purchase Cost Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	
	//$exchange_rate=76;
	$sql_pre=sql_select("select  exchange_rate from wo_pre_cost_mst a,wo_po_break_down b  where b.job_id=a.job_id and b.id in($po_id)");
	foreach($sql_pre as $row)
	{
		$exchange_rate=$row[csf('exchange_rate')];
	}
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$sql_fin_purchase="select a.currency_id,b.po_break_down_id, sum (b.fin_fab_qnty) as qty, sum (b.amount) as finish_purchase_amnt from wo_booking_dtls b,wo_booking_mst a where a.id=b.booking_mst_id and b.booking_type=1 and b.is_short=2 and b.status_active = 1 and b.is_deleted = 0 and a.status_active = 1 and b.is_deleted = 0 and b.po_break_down_id in($po_id) group by a.currency_id,b.po_break_down_id";
	$dataArrayFinPurchase=sql_select($sql_fin_purchase);
	foreach($dataArrayFinPurchase as $finRow)
	{
		$finish_purchase_arr[$finRow[csf('po_break_down_id')]]['qty']=$finRow[csf('qty')];
		if($finRow[csf('currency_id')]==1){
			$finish_purchase_arr[$finRow[csf('po_break_down_id')]]['amnt']=$finRow[csf('finish_purchase_amnt')]/$exchange_rate;
		}else{
			$finish_purchase_arr[$finRow[csf('po_break_down_id')]]['amnt']=$finRow[csf('finish_purchase_amnt')];
		}
		
	}
	
/* 	$sql_fin_purchase="select b.po_breakdown_id, sum(b.quantity) as qty, sum(a.cons_rate*b.quantity) as woven_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.item_category=3 and a.transaction_type=1 and b.entry_form=17 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in($po_id) group by b.po_breakdown_id";
	$dataArrayFinPurchase=sql_select($sql_fin_purchase);
	foreach($dataArrayFinPurchase as $finRow)
	{
		$finish_purchase_arr[$finRow[csf('po_breakdown_id')]]['qty']+=$finRow[csf('qty')];
		$finish_purchase_arr[$finRow[csf('po_breakdown_id')]]['amnt']+=$finRow[csf('woven_purchase_amnt')]/$exchange_rate;
	} */
	?>
    <div>
        <fieldset style="width:710px; margin-left:8px">
        	<table class="rpt_table" width="680" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="40">SL</th>
                    <th width="60">Buyer</th>
                    <th width="100">PO No</th>
                    <th width="50">Year</th>
                    <th width="60">Job No</th>
                    <th width="110">Order Qty.</th>
                    <th width="110">Received</th>
                    <th>Cost ($)</th>
                </thead>
            </table>	
            <div style="width:700px; max-height:310px; overflow-y:scroll" id="scroll_body">
                <table class="rpt_table" width="680" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
					else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
					else $year_field="";//defined Later
						

					$sql="select a.job_no_prefix_num, a.job_no, $year_field, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, b.id, b.po_number, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($po_id) order by b.pub_shipment_date, a.job_no_prefix_num, b.id";
					$result=sql_select($sql);
					$i=1; $tot_po_qnty=0; $tot_recv_qty=0; $tot_cost=0;
					foreach($result as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						
						$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
						$tot_po_qnty+=$order_qnty_in_pcs;
						
						$recv_qty=$finish_purchase_arr[$row[csf('id')]]['qty'];
						$recv_cost=$finish_purchase_arr[$row[csf('id')]]['amnt'];
						
					?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td width="40"><? echo $i; ?></td>
							<td width="60" style="word-break:break-all;"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
                            <td width="100" style="word-break:break-all;"><? echo $row[csf('po_number')]; ?></td>
                            <td width="50" align="center"><? echo $row[csf('year')]; ?></td>
                            <td width="60" align="center"><? echo $row[csf('job_no_prefix_num')]; ?></td>
                            <td width="110" align="right"><? echo $order_qnty_in_pcs; ?></td>
							<td width="110" align="right"><? echo fn_number_format($recv_qty,2,'.',''); ?></td>
                            <td align="right" ><? echo fn_number_format($recv_cost,2,'.',''); ?></td>
						</tr>
					<?
						$i++;
						$tot_recv_qty+=$recv_qty; 
						$tot_cost+=$recv_cost; 
					}
					?>
                	<tfoot>
                        <th colspan="5">Total</th>
                        <th><? echo $tot_po_qnty; ?></th>
                        <th><? echo fn_number_format($tot_recv_qty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_cost,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
        </fieldset>
    </div>
<?
	exit();
}

if($action=="fabric_purchase_cost")
{
	echo load_html_head_contents("Fabric Purchase Cost Info","../../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	
	//$exchange_rate=76;
	$sql_pre=sql_select("select  exchange_rate from wo_pre_cost_mst a,wo_po_break_down b  where b.job_id=a.job_id and b.id in($po_id)");
	foreach($sql_pre as $row)
	{
		$exchange_rate=$row[csf('exchange_rate')];
	}
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$sql_fin_purchase="select b.po_breakdown_id, sum(b.quantity) as qty, sum(a.cons_rate*b.quantity) as finish_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.receive_basis<>9 and a.item_category=2 and a.transaction_type=1 and b.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in($po_id) group by b.po_breakdown_id";
	$dataArrayFinPurchase=sql_select($sql_fin_purchase);
	foreach($dataArrayFinPurchase as $finRow)
	{
		$finish_purchase_arr[$finRow[csf('po_breakdown_id')]]['qty']=$finRow[csf('qty')];
		$finish_purchase_arr[$finRow[csf('po_breakdown_id')]]['amnt']=$finRow[csf('finish_purchase_amnt')]/$exchange_rate;
	}
	
	$sql_fin_purchase="select b.po_breakdown_id, sum(b.quantity) as qty, sum(a.cons_rate*b.quantity) as woven_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.item_category=3 and a.transaction_type=1 and b.entry_form=17 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in($po_id) group by b.po_breakdown_id";
	$dataArrayFinPurchase=sql_select($sql_fin_purchase);
	foreach($dataArrayFinPurchase as $finRow)
	{
		$finish_purchase_arr[$finRow[csf('po_breakdown_id')]]['qty']+=$finRow[csf('qty')];
		$finish_purchase_arr[$finRow[csf('po_breakdown_id')]]['amnt']+=$finRow[csf('woven_purchase_amnt')]/$exchange_rate;
	}
	?>
    <div>
        <fieldset style="width:710px; margin-left:8px">
        	<table class="rpt_table" width="680" cellpadding="0" cellspacing="0" border="1" rules="all">
            	<thead>
                	<th width="40">SL</th>
                    <th width="60">Buyer</th>
                    <th width="100">PO No</th>
                    <th width="50">Year</th>
                    <th width="60">Job No</th>
                    <th width="110">Order Qty.</th>
                    <th width="110">Received</th>
                    <th>Cost ($)</th>
                </thead>
            </table>	
            <div style="width:700px; max-height:310px; overflow-y:scroll" id="scroll_body">
                <table class="rpt_table" width="680" cellpadding="0" cellspacing="0" border="1" rules="all">
                	<?
					if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
					else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
					else $year_field="";//defined Later
						

					$sql="select a.job_no_prefix_num, a.job_no, $year_field, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, b.id, b.po_number, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status from wo_po_details_master a, wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($po_id) order by b.pub_shipment_date, a.job_no_prefix_num, b.id";
					$result=sql_select($sql);
					$i=1; $tot_po_qnty=0; $tot_recv_qty=0; $tot_cost=0;
					foreach($result as $row)
					{
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						
						$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
						$tot_po_qnty+=$order_qnty_in_pcs;
						
						$recv_qty=$finish_purchase_arr[$row[csf('id')]]['qty'];
						$recv_cost=$finish_purchase_arr[$row[csf('id')]]['amnt'];
						
					?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<td width="40"><? echo $i; ?></td>
							<td width="60" style="word-break:break-all;"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
                            <td width="100" style="word-break:break-all;"><? echo $row[csf('po_number')]; ?></td>
                            <td width="50" align="center"><? echo $row[csf('year')]; ?></td>
                            <td width="60" align="center"><? echo $row[csf('job_no_prefix_num')]; ?></td>
                            <td width="110" align="right"><? echo $order_qnty_in_pcs; ?></td>
							<td width="110" align="right"><? echo fn_number_format($recv_qty,2,'.',''); ?></td>
                            <td align="right" ><? echo fn_number_format($recv_cost,2,'.',''); ?></td>
						</tr>
					<?
						$i++;
						$tot_recv_qty+=$recv_qty; 
						$tot_cost+=$recv_cost; 
					}
					?>
                	<tfoot>
                        <th colspan="5">Total</th>
                        <th><? echo $tot_po_qnty; ?></th>
                        <th><? echo fn_number_format($tot_recv_qty,2,'.',''); ?></th>
                        <th><? echo fn_number_format($tot_cost,2,'.',''); ?></th>
                    </tfoot>    
                </table>
            </div>
        </fieldset>
    </div>
<?
	exit();
}

if($action=="aop_cost_actual")
{
	echo load_html_head_contents("AOP Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);

?>
	<fieldset style="width:760px; margin-left:7px">
        <table class="rpt_table" width="755" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="110">WO NO.</th>
                <th width="80">WO Date</th>
                <th width="80">Currency</th>
                <th width="120">Amount (Taka)</th>
                <th width="120">Conversion rate</th>
                <th>Amount (USD)</th>
            </thead>
        </table>
        <div style="width:755px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="735" cellpadding="0" cellspacing="0">    
				<?
                $i=1; $total_aop_cost=0; $avg_rate=76;
                $sql="select a.booking_no, a.booking_date, a.currency_id, a.exchange_rate, sum(b.amount) as amount from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=$po_id and a.item_category=12 and a.booking_type in(3,6) and b.process=35 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.booking_no, a.booking_date, a.currency_id, a.exchange_rate";
                $result=sql_select($sql);
                foreach($result as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
                
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('booking_no')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('booking_date')]); ?></td>
                        <td width="80"><p><? echo $currency[$row[csf('currency_id')]]; ?></p></td>
                        <td align="right" width="120">
                            <? 
								$amnt_tk=$row[csf('amount')]*$row[csf('exchange_rate')];
                                echo fn_number_format($amnt_tk,2); 
                            ?>
                        </td>
                        <td align="right" width="120"><? echo fn_number_format($row[csf('exchange_rate')],2); ?>&nbsp;</td>
                        <td align="right">
                            <?
								if($row[csf('currency_id')]==1)
								{
                                	$amount=$row[csf('amount')]/$row[csf('exchange_rate')];
								}
								else
								{
									$amount=$row[csf('amount')];
								}
                                echo fn_number_format($amount,2); 
                            ?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_aop_cost+=$amount;
                }
                ?>
                <tfoot>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>Total</th>
                    <th align="right"><? echo fn_number_format($total_aop_cost,2); ?></th>
                </tfoot>
			</table>
        </div>	
	</fieldset>  
<?
exit();
}

if($action=="trims_cost_actual")
{
	echo load_html_head_contents("AOP Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);

?>
	<fieldset style="width:760px; margin-left:7px">
        <table class="rpt_table" width="755" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="110">WO NO.</th>
                <th width="80">WO Date</th>
                <th width="80">Currency</th>
                <th width="120">Amount (Taka)</th>
                <th width="120">Conversion rate</th>
                <th>Amount (USD)</th>
            </thead>
        </table>
        <div style="width:755px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="735" cellpadding="0" cellspacing="0">    
				<?
                $i=1; $total_trims_cost=0; $avg_rate=76;
                $wo_sql="select a.booking_no, a.booking_date, a.currency_id, a.exchange_rate, sum(b.amount) as amount from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=$po_id and a.item_category=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.booking_no, a.booking_date, a.currency_id, a.exchange_rate";//c.booking_no,a.transaction_date,c.exchange_rate,c.currency_id
				
				$result_wo=sql_select( $wo_sql );
				 foreach($result_wo as $row)
                {
					$wo_date_arr[$row[csf('booking_no')]]=$row[csf('booking_date')];
				}
				 $sql_gen_trims_inv="select a.booking_no,b.prod_id,b.transaction_date,(b.cons_amount) as amount,b.order_id as po_id
				  from inv_issue_master a, inv_transaction b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(21)   and b.transaction_type in(2) and b.order_id in($po_id)";
				  $result_trims_gen=sql_select( $sql_gen_trims_inv );
				  
			      $sql_trims_inv="select c.booking_no,c.exchange_rate, a.transaction_date,a.prod_id, c.exchange_rate, c.currency_id, a.transaction_date, a.cons_amount as amount, b.po_breakdown_id as po_id, (b.quantity) as qnty,b.order_amount as cons_amount
				  from inv_receive_master c,inv_transaction a, order_wise_pro_details b where  c.id=a.mst_id and a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and b.entry_form in(24) and a.item_category=4 and a.transaction_type in(1) and b.trans_type in(1) and b.po_breakdown_id in($po_id) ";
				  //echo $sql_trims_inv; die;
				$result_trims=sql_select( $sql_trims_inv );
              $usd_id=2;
                foreach($result_trims as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
					$transaction_date=$row[csf('transaction_date')];
					$currency_id=$row[csf('currency_id')];
					$exchange_rate=$row[csf('exchange_rate')];
					if($currency_id==2){
						$usd_rate=$exchange_rate;
					}
					else
					$exchange_rateArr[$row[csf('prod_id')]]=$row[csf('exchange_rate')];
					if($db_type==0)
					{
						$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					}
					if($currency_id==1){
						$currency_rate=$usd_rate*$exchange_rate;
					}elseif($currency_id==2){
						$currency_rate=$usd_rate;
					}else {
						$currency_rate=$exchange_rate;
					}
					//
					
					$amnt_tk=$row[csf('amount')];
					//$amount=$row[csf('amount')]/$currency_rate;
					$amount=$row[csf('cons_amount')];
					//echo $row[csf('amount')].'=='.$currency_rate.'<br>';
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40" title="Receive"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('booking_no')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($wo_date_arr[$row[csf('booking_no')]]); ?></td>
                        <td width="80"><p><? if($currency_id!=1){echo $currency[$row[csf('currency_id')]];} else { echo "USD";}  ?></p></td>
                        <td align="right" width="120"><? echo fn_number_format($amount*$currency_rate,2); ?></td>
                        <td align="right" width="120"><? echo fn_number_format($currency_rate,2); ?>&nbsp;</td>
                        <td align="right"><? echo fn_number_format($amount,2); ?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_trims_cost+=$amount;
                }
				
				foreach($result_trims_gen as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
					$transaction_date=$row[csf('transaction_date')];
					if($db_type==0)
					{
						$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					}
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$currency_rate=$$exchange_rateArr[$row[csf('prod_id')]];
					
					$amnt_tk=$row[csf('amount')];
					$amount=$row[csf('amount')]/$currency_rate;
					
					//echo $row[csf('amount')].'=='.$currency_rate.'<br>';
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40" title="Issue"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('booking_no')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($wo_date_arr[$row[csf('booking_no')]]); ?></td>
                        <td width="80"><p><? echo $currency[$usd_id]; ?></p></td>
                        <td align="right" width="120"><? echo fn_number_format($amnt_tk,2); ?></td>
                        <td align="right" width="120"><? echo fn_number_format($currency_rate,2); ?>&nbsp;</td>
                        <td align="right"><? echo fn_number_format($amount,2); ?></td>
                    </tr>
                <?
                	$i++;
					$total_trims_cost+=$amount;
                }
                ?>
                <tfoot>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>Total</th>
                    <th align="right"><? echo fn_number_format($total_trims_cost,2); ?></th>
                </tfoot>
			</table>
        </div>	
	</fieldset>  
<?
exit();
}

if($action=="gmt_print_wash_dye_embell_cost_actual")
{
	echo load_html_head_contents("Embellishment Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);


 ?>
	<fieldset style="width:500px; margin-left:7px">
        <table class="rpt_table" width="460" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="30">SL</th>
                <th width="150">Embl. Name</th>
                <th width="100">Qty</th>
                <th width="80">Rate</th>
                <th width="">Amount</th>
                
            </thead>
        </table>
        <div style="width:480px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="460" cellpadding="0" cellspacing="0">    
				<?
				
		//$costing_per_arr=return_library_array( "select job_no, costing_per_id from wo_pre_cost_dtls where status_active=1 and is_deleted=0", "job_no", "costing_per_id");

		$sql_per="select a.job_no, a.costing_per_id,b.id as po_id ,c.total_set_qnty from wo_pre_cost_dtls a,wo_po_break_down b, wo_po_details_master c where b.job_no_mst=a.job_no   and b.job_no_mst=c.job_no and b.id in($po_id)";

		$result_costPer=sql_select( $sql_per );
		foreach($result_costPer as $row)
		{
			$costing_per_arr[$row[csf('job_no')]]=$row[csf('costing_per_id')];
			$job_ratio_arr[$row[csf('po_id')]]=$row[csf('total_set_qnty')];
			$job_arr[$row[csf('po_id')]]=$row[csf('job_no')];
		}

				$condition= new condition();
				if(trim(str_replace("'","",$po_id))!='')
				 {
					$condition->po_id("in($po_id)"); 
				 }
				  $condition->init();
				
				
			
				$emblishment= new emblishment($condition);
					// echo $conversion->getQuery();die;
				$emblishment_costing_arr_name=$emblishment->getAmountArray_by_orderAndEmbname();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name_qty=$emblishment->getQtyArray_by_orderAndEmbname();
				
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash=$wash->getAmountArray_by_orderAndEmbname();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash_qty=$wash->getQtyArray_by_orderAndEmbname();
				 
                $i=1; $total_gmt_cost=0; //$avg_rate=76;
                /*$sql="select a.booking_no, a.booking_date,b.job_no, a.currency_id, a.exchange_rate, sum(b.amount) as amount from wo_booking_mst a, wo_booking_dtls b, wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and b.pre_cost_fabric_cost_dtls_id=c.id and c.emb_name!=3 and b.po_break_down_id=$po_id and a.item_category=25 and a.booking_type in(3,6) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.booking_no,b.job_no, a.booking_date, a.currency_id, a.exchange_rate";*/
				$sql_garments="select b.po_break_down_id as po_id,b.embel_name,b.production_date,b.production_type,
				(CASE WHEN b.embel_name=$embl_name THEN b.production_quantity ELSE 0 END) AS gmt_qty
				
				 from pro_garments_production_mst b where  b.production_type=2    and b.is_deleted=0 and b.status_active=1 and b.status_active=1 and b.is_deleted=0 and b.po_break_down_id in($po_id) and b.embel_name=$embl_name";
				$result_gar=sql_select( $sql_garments );
				foreach ($result_gar as $row)
				{
					
					$embl_issue_prod_array[$row[csf('embel_name')]]['gmt_qty']+=$row[csf('gmt_qty')];
					//$embl_issue_prod_array[$row[csf('embel_name')]]['embro_qty']+=$row[csf('embro_qty')];
					//$embl_issue_prod_array[$row[csf('embel_name')]]['wash_qty']+=$row[csf('wash_qty')];
					//$embl_issue_prod_array[$row[csf('embel_name')]]['dyeing_qty']+=$row[csf('dyeing_qty')];
					
				}
				
              //  $result=sql_select($sql);
                foreach($embl_issue_prod_array as $embel_name=>$row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
					
					$jobno=$job_arr[$po_id];
					$ratio=$job_ratio_arr[$po_id];
					$costing_per_id=$costing_per_arr[$jobno];
					$dzn_qnty=0;
						//$costing_per_id=$costing_per_arr[$row[('job_no')]];
						if($costing_per_id==1)
						{
							$dzn_qnty=12;
						}
						else if($costing_per_id==3)
						{
							$dzn_qnty=12*2;
						}
						else if($costing_per_id==4)
						{
							$dzn_qnty=12*3;
						}
						else if($costing_per_id==5)
						{
							$dzn_qnty=12*4;
						}
						else
						{
							$dzn_qnty=1;
						}
						$dzn_qnty=$dzn_qnty*$ratio;
						if($embl_name==3) //Wash
						{
						$gmt_amount=$emblishment_costing_arr_name_wash[$po_id][$embl_name];
						$gmt_qty=$emblishment_costing_arr_name_wash_qty[$po_id][$embl_name];
						//echo $gmt_qty.'=='.$gmt_amount;
						$gmt_avg_rate=$gmt_amount/$gmt_qty;
						}
						else
						{
							//echo $embl_name;
						$gmt_amount=$emblishment_costing_arr_name[$po_id][$embl_name];
						$gmt_qty=$emblishment_costing_arr_name_qty[$po_id][$embl_name];
						$gmt_avg_rate=$gmt_amount/$gmt_qty;
						}
					
						$tot_amount=($row[('gmt_qty')]/$dzn_qnty)*$gmt_avg_rate;
                	//echo $gmt_qty.'='.$gmt_amount.'='.$ratio;
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="30"><? echo $i; ?></td>
                        <td width="150"><p><? echo $emblishment_name_array[$embel_name]; ?></p></td>
                        <td width="100" align="right"><? echo $row[('gmt_qty')]; ?></td>
                        <td width="80" align="right"><p><? echo fn_number_format($gmt_avg_rate,4); ?></p></td>
                        <td align="right" width="">
                            <? 
                                echo fn_number_format($tot_amount,2); 
                            ?>
                        </td>
                       
                    </tr>
                <?
                	$i++;
					$total_gmt_cost+=$tot_amount;
                }
                ?>
                <tfoot>
                    
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>Total</th>
                    <th align="right"><? echo fn_number_format($total_gmt_cost,2); ?></th>
                </tfoot>
			</table>
        </div>	
	</fieldset>  
<?
exit();
}

if($action=="wash_cost_actual")
{
	echo load_html_head_contents("Wash Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);

 ?>
	<fieldset style="width:760px; margin-left:7px">
        <table class="rpt_table" width="755" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="110">WO NO.</th>
                <th width="80">WO Date</th>
                <th width="80">Currency</th>
                <th width="120">Amount (Taka)</th>
                <th width="120">Conversion rate</th>
                <th>Amount (USD)</th>
            </thead>
        </table>
        <div style="width:755px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="735" cellpadding="0" cellspacing="0">    
				<?
                $i=1; $total_aop_cost=0; $avg_rate=76;
                $sql="select a.booking_no, a.booking_date, a.currency_id, a.exchange_rate, sum(b.amount) as amount from wo_booking_mst a, wo_booking_dtls b, wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and b.pre_cost_fabric_cost_dtls_id=c.id and c.emb_name=3 and b.po_break_down_id=$po_id and a.item_category=25 and a.booking_type in(3,6) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.booking_no, a.booking_date, a.currency_id, a.exchange_rate";
                $result=sql_select($sql);
                foreach($result as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
                
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="110"><p><? echo $row[csf('booking_no')]; ?></p></td>
                        <td width="80" align="center"><? echo change_date_format($row[csf('booking_date')]); ?></td>
                        <td width="80"><p><? echo $currency[$row[csf('currency_id')]]; ?></p></td>
                        <td align="right" width="120">
                            <? 
								$amnt_tk=$row[csf('amount')]*$row[csf('exchange_rate')];
                                echo fn_number_format($amnt_tk,2); 
                            ?>
                        </td>
                        <td align="right" width="120"><? echo fn_number_format($row[csf('exchange_rate')],2); ?>&nbsp;</td>
                        <td align="right">
                            <?
								if($row[csf('currency_id')]==1)
								{
                                	$amount=$row[csf('amount')]/$row[csf('exchange_rate')];
								}
								else
								{
									$amount=$row[csf('amount')];
								}
                                echo fn_number_format($amount,2); 
                            ?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_aop_cost+=$amount;
                }
                ?>
                <tfoot>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>Total</th>
                    <th align="right"><? echo fn_number_format($total_aop_cost,2); ?></th>
                </tfoot>
			</table>
        </div>	
	</fieldset>  
<?
exit();
}

if($action=="commission_cost_actual")
{
	echo load_html_head_contents("Commission Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);
	$data=explode("_",$po_id);
	$poId=$data[0];
	$job_no=$data[1];
	$ex_factory_qty=$data[2];
	$dzn_qnty=$data[3];

 ?>
	<fieldset style="width:560px; margin-left:10px">
        <table class="rpt_table" width="555" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="170">Commission Type</th>
                <th width="170">Commission Base</th>
                <th>Amount (USD)</th>
            </thead>
        </table>
        <div style="width:555px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="535" cellpadding="0" cellspacing="0">    
				<?
                $i=1; $total_comm_cost=0;
                $sql="select particulars_id, commission_base_id, commission_amount as amount from wo_pre_cost_commiss_cost_dtls where job_no='$job_no' and status_active=1 and is_deleted=0 and commission_amount>0";
                $result=sql_select($sql);
                foreach($result as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";	
                
                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="40"><? echo $i; ?></td>
                        <td width="170"><p><? echo $commission_particulars[$row[csf('particulars_id')]]; ?></p></td>
                        <td width="170"><p><? echo $commission_base_array[$row[csf('commission_base_id')]]; ?></p></td>
                        <td align="right">
                            <?
								$amount=($ex_factory_qty/$dzn_qnty)*$row[csf('amount')];
                                echo fn_number_format($amount,2); 
                            ?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_comm_cost+=$amount;
                }
                ?>
                <tfoot>
                    <th>&nbsp;</th>
                    <th>&nbsp;</th>
                    <th>Total</th>
                    <th align="right"><? echo fn_number_format($total_comm_cost,2); ?></th>
                </tfoot>
			</table>
        </div>	
	</fieldset>  
<?
exit();
}
//Ex-Factory Delv. and Return
if($action=="ex_factory_popup")
{
 	echo load_html_head_contents("Ex-Factory Details", "../../../../", 1, 1,$unicode,'','');
	extract($_REQUEST);
	//echo $id;//$job_no;
	
	$unit_price_arr=return_library_array( "select id, unit_price 
	from wo_po_break_down where status_active=1 and is_deleted=0 and id=$id ", "id", "unit_price");	
	?>
    
     <script>

	function print_window()
	{
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><link rel="stylesheet" href="../../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
	
		d.close();
	}	
	
 </script>
	<div style="width:100%" align="center" id="report_container">
    <input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/>
		<fieldset style="width:550px"> 
        <div class="form_caption" align="center"><strong>Ex-Factory Details</strong></div><br />
            <div style="width:100%"> 
            <table cellpadding="0" width="100%" class="rpt_table" rules="all" border="1">
                <thead>
                    <tr>
                        <th width="35">SL</th>
                        <th width="90">Ex-fac. Date</th>
                        <th width="120">System /Challan no</th>
                        <th width="100">Ex-Fact. Del.Qty.</th>
                        <th width="100">Ex-Fact. Return Qty.</th>
                        <th width="">Ex-Fact. Value</th>
                       
                     </tr>   
                </thead> 	 	
            </table>  
        </div>
        <div style="width:100%; max-height:400px;">
            <table cellpadding="0" width="100%" cellspacing="0" border="1" rules="all" class="rpt_table">
                <?
                $i=1;
              
				$exfac_sql=("select b.challan_no,b.ex_factory_date, 
				CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END as ex_factory_qnty,
				CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END as ex_factory_return_qnty 
				from   pro_ex_factory_mst b  where  b.status_active=1 and b.is_deleted=0 and b.po_break_down_id in($id) ");
                $sql_dtls=sql_select($exfac_sql);
                
                foreach($sql_dtls as $row_real)
                { 
                    if ($i%2==0) $bgcolor="#EFEFEF"; else $bgcolor="#FFFFFF"; 
					$tot_exfact_qty=$row_real[csf("ex_factory_qnty")]-$row_real[csf("ex_factory_return_qnty")]; 
					$unit_price=$unit_price_arr[$id]; 
					$tot_exfact_val=$tot_exfact_qty*$unit_price;                            
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_l<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">
                        <td width="35"><? echo $i; ?></td> 
                        <td width="90"><? echo change_date_format($row_real[csf("ex_factory_date")]); ?></td>
                        <td width="120"><? echo $row_real[csf("challan_no")]; ?></td>
                        <td width="100" align="right"><? echo $row_real[csf("ex_factory_qnty")]; ?></td>
                        <td width="100" align="right"><? echo $row_real[csf("ex_factory_return_qnty")]; ?></td>
                        <td width="" align="right"><? echo fn_number_format($tot_exfact_val,2); ?></td>
                    </tr>
                    <? 
                    $rec_qnty+=$row_real[csf("ex_factory_qnty")];
					 $rec_return_qnty+=$row_real[csf("ex_factory_return_qnty")];
					  $total_exfact_val+=$tot_exfact_val;
                    $i++;
                }
                ?>
                <tfoot>
                <tr>
                    <th colspan="3">Total</th>
                     <th><? echo fn_number_format($rec_qnty,2); ?></th>
                    <th><? echo fn_number_format($rec_return_qnty,2); ?></th>
                    <th><? echo fn_number_format($total_exfact_val,2); ?></th>
                </tr>
                <tr>
                 <th colspan="3">Total Balance</th>
                 <th colspan="2" align="right"><? echo fn_number_format($rec_qnty-$rec_return_qnty,2); ?></th>
                 <th><? echo fn_number_format($total_exfact_val,2); ?></th>
                </tr>
                </tfoot>
            </table>
        </div> 
		</fieldset>
	</div>    
	<?
    exit();	
}
//Ex-Factory Delv. and Return
if($action=="show_po_detail_report")
{
	?>
    <script>
	
	function new_window()
	{
		var w = window.open("Surprise", "#");
		var d = w.document.open();
		d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
	'<html><head><title></title><link rel="stylesheet" href="../../css/style_common.css" type="text/css" media="print" /></head><body>'+document.getElementById('html_print_data').innerHTML+'</body</html>');
		d.close(); 
	}
	function openmypage_mkt(mkt_data,type,tittle)
	{
		emailwindow=dhtmlmodal.open('EmailBox', 'iframe', 'post_costing_report_v3_controller.php?mkt_data='+mkt_data+'&action='+type, tittle, 'width=660px, height=200px, center=1, resize=0, scrolling=0', '../../../');
	}
	
	function openmypage(po_id,type,tittle)
	{
		var popup_width='';
		if(type=="dye_fin_cost") 
		{
			popup_width='1140px';
		}
		else if(type=="fabric_purchase_cost") 
		{
			popup_width='740px';
		}
		else popup_width='1060px';
		
		emailwindow=dhtmlmodal.open('EmailBox', 'iframe', 'post_costing_report_v3_controller.php?po_id='+po_id+'&action='+type, tittle, 'width='+popup_width+', height=400px, center=1, resize=0, scrolling=0', '../../../');
	}
	
	
 </script>
 <?	
		
		
		echo load_html_head_contents("Po Detail", "../../../../", 1, 1,$unicode,'','');
		extract($_REQUEST);
		$company_short_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
		$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
		
		
	  	$bgcolor="#E9F3FF";  $bgcolor2="#FFFFFF";	
		
	  	 $gsm_weight_top=return_field_value("gsm_weight", "wo_pre_cost_fabric_cost_dtls", "job_no='$job_no' and body_part_id=1");
		 $gsm_weight_bottom=return_field_value("gsm_weight", "wo_pre_cost_fabric_cost_dtls", "job_no='$job_no' and body_part_id=20");
		 $costing_date=return_field_value("costing_date", "wo_pre_cost_mst", "job_no='$job_no'","costing_date");
		 $po_qty=0;
		 $po_plun_cut_qty=0;
		 $total_set_qnty=0;$tot_po_value=0;
		 $sql_po="select a.job_no,a.total_set_qnty,b.id,c.order_total,b.unit_price,c.item_number_id,c.country_id,c.color_number_id,c.size_number_id,c.order_quantity ,c.plan_cut_qnty  from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and a.job_no=c.job_no_mst   and b.id=c.po_break_down_id and b.id =$po_id  and a.job_no ='$job_no'  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 order by b.id";
		$sql_po_data=sql_select($sql_po);
		foreach($sql_po_data as $sql_po_row)
		{
		$po_qty+=$sql_po_row[csf('order_quantity')];
		$po_plun_cut_qty+=$sql_po_row[csf('plan_cut_qnty')];
		$tot_po_value+=$sql_po_row[csf('order_total')];
		$total_set_qnty=$sql_po_row[csf('total_set_qnty')];
		$unit_price=$sql_po_row[csf('unit_price')]/$total_set_qnty;
		$tot_po_value=$po_qty*$unit_price;
		}
		$fab_knit_req_kg_avg=0;
		$fab_woven_req_yds_avg=0;
		if($db_type==0)
		{
		$sql = "select a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,b.costing_per,b.budget_minute,b.approved,b.updated_by,b.sew_smv,b.sew_effi_percent,b.incoterm,b.exchange_rate,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no and a.job_no='$job_no' and a.company_name=$company_name  and a.status_active=1  order by a.job_no";  
		}
		if($db_type==2)
		{
		 $sql = "select a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.gmts_item_id,a.order_uom,a.job_quantity,a.avg_unit_price,b.costing_per,b.budget_minute,b.approved,b.updated_by,b.sew_smv,b.sew_effi_percent,b.incoterm,b.exchange_rate,c.fab_knit_req_kg,c.fab_knit_fin_req_kg,c.fab_woven_req_yds,c.fab_woven_fin_req_yds,c.fab_yarn_req_kg from wo_po_details_master a, wo_pre_cost_mst b left join wo_pre_cost_sum_dtls c on   b.job_no=c.job_no where a.job_no=b.job_no and a.status_active=1 and a.job_no='$job_no' and a.company_name=$company_name  order by a.job_no";  
		}
		
		$data_array=sql_select($sql);
		
		
		$condition= new condition();
		if(str_replace("'","",$job_no) !='')
		{
		  $condition->job_no("='$job_no'");
		}
		if(str_replace("'","",$po_id) !='')
		{
		  $condition->po_id("=$po_id");
		}
		 $condition->init();
		
		$fabric= new fabric($condition);
		$fabric_costing_qty_arr=$fabric->getQtyArray_by_order_knitAndwoven_greyAndfinish();
		$yarn= new yarn($condition);
	    $yarn_req_arr=$yarn->getOrderWiseYarnQtyArray();
				
		
		 $fab_knit_qty_gray=($fabric_costing_qty_arr['knit']['grey'][$po_id]/$po_qty)*12;
		 $fab_woven_qty_gray=($fabric_costing_qty_arr['woven']['grey'][$po_id]/$po_qty)*12;
		 
		 $fab_knit_qty_finish=($fabric_costing_qty_arr['knit']['finish'][$po_id]/$po_qty)*12;
		 $fab_woven_qty_finish=($fabric_costing_qty_arr['woven']['finish'][$po_id]/$po_qty)*12;
		 $yarn_req_qty_avg=($yarn_req_arr[$po_id]/$po_qty)*12;
		 //echo  $fab_knit_qty_gray.'='.$fab_woven_qty_gray;
		 
	?>
	<div style="width:100%" align="center"> <input type="button" onClick="new_window()" value="Html Preview" name="Print" class="formbutton" style="width:120px;"/>
		<fieldset style="width:850px" id="html_print_data">
       
         <table width="840px"   cellpadding="0" cellspacing="0" border="0">
        	<tr>
            	<td rowspan="3" width="25%">
                   <?
                $data_array2=sql_select("select image_location  from common_photo_library  where master_tble_id='$company_name' and form_name='company_details' and is_deleted=0 and file_type=1");
              	foreach($data_array2 as $img_row)
                {
					?>
                    <img src='../../../../<? echo $img_row[csf('image_location')]; ?>' height='50' width='50' align="middle" />	
                    <? 
                }
                ?>
                </td>
            	<td align="center"><b style="font-size:20px;"><? echo $company_short_arr[$company_name]; ?></b></td>
            	<td rowspan="3" width="25%" align="right">
                <?
                   $data_array_img=sql_select("select image_location  from common_photo_library  where master_tble_id='$job_no' and form_name='knit_order_entry' and is_deleted=0 and file_type=1");               
                foreach($data_array_img as $img_row)
                {
					?>
                    <img src='../../../../<? echo $img_row[csf('image_location')]; ?>' height='50' width='80' align="middle" />	
                    <? 
                }
                ?>
               
                </td>
            </tr>
        	<tr>
            	<td align="center"><b style="font-size:14px;">Pre and Post Cost Comparison</b></td>
            </tr>
           <tr>
                <td align="center">
                    
					<? if( $data_array[0][csf("approved")]==1){echo "<div style='font-size:18px; color:#F00; background:#CCC;'>THIS COST SHEET IS APPROVED </div>";
					
					} else {echo "&nbsp;";} 
					
					$prepared_app_data = $data_array[0][csf("updated_by")];		

					?> 
                     
                </td>
            </tr>
        
        </table>
       			 <? 
				$uom="";
				foreach ($data_array as $row)
				{	
					$order_price_per_dzn=0;
					$order_job_qnty=0;
					$avg_unit_price=0;
					
					$order_values = $row[csf("job_quantity")]*$row[csf("avg_unit_price")];
					$result =sql_select("select po_number,grouping,file_no,pub_shipment_date from wo_po_break_down where job_no_mst='$job_no'  and id=$po_id and status_active=1 and is_deleted=0 order by pub_shipment_date DESC");
					$job_in_orders = '';$pulich_ship_date='';$job_in_file = '';$job_in_ref = '';
					foreach ($result as $val)
					{
						$job_in_orders= $val[csf('po_number')];
						$pulich_ship_date = $val[csf('pub_shipment_date')];
						$job_in_ref.=$val[csf('grouping')].",";
						$job_in_file.=$val[csf('file_no')].",";
						
					}
					$job_in_orders = $job_in_orders;
					
					$job_ref=array_unique(explode(",",rtrim($job_in_ref,", ")));
					$job_file=array_unique(explode(",",rtrim($job_in_file,", ")));
					
					foreach ($job_ref as $ref)
					{
						$ref_cond.=", ".$ref;
					}
					$file_con='';
					foreach ($job_file as $file)
					{
						if($file_con=='') $file_cond=$file; else $file_cond.=", ".$file;
					}
					if($row[csf("costing_per")]==1){$order_price_per_dzn=12;$costing_for=" For 1 DZN";}
					else if($row[csf("costing_per")]==2){$order_price_per_dzn=1;$costing_for=" For PCS";}
					else if($row[csf("costing_per")]==3){$order_price_per_dzn=24;$costing_for=" For 2 DZN";}
					else if($row[csf("costing_per")]==4){$order_price_per_dzn=36;$costing_for="For 3 DZN";}
					else if($row[csf("costing_per")]==5){$order_price_per_dzn=48;$costing_for=" For 4 DZN";}
		
		?>
            	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px" rules="all">
                	<tr bgcolor="<? echo $bgcolor2;?>">
                    	<td width="130">Job Number</td>
                        <td width="100"><b><? echo $row[csf("job_no")]; ?></b></td>
                        <td width="130">Buyer</td>
                        <td width="110"><b><? echo $buyer_arr[$row[csf("buyer_name")]]; $buyer_id=$row[csf("buyer_name")];?></b></td>
                        <td>Garments Item</td>
                        <? 
							$grmnt_items = "";
							if($garments_item[$row[csf("gmts_item_id")]]=="")
							{
								
								$grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no=$job_no");
								foreach($grmts_sql as $key=>$val){
									$grmnt_items .=$garments_item[$val[csf("gmts_item_id")]].", ";
								}
								$grmnt_items = substr_replace($grmnt_items,"",-1,1);
							}else{
								$grmnt_items = $garments_item[$row[csf("gmts_item_id")]];
							}
							
						?>
                        <td width="160"><b><? echo $grmnt_items; ?></b></td>
                    </tr>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                    	<td>Style Ref. No </td>
                        <td><b><? echo $row[csf("style_ref_no")]; ?></b></td>
                         <td>Costing Date</td><td><? echo $costing_date;?></td>
                        <td>PO Qnty</td>
                        <td><b><? $uom=$row[csf("order_uom")]; echo fn_number_format($po_qty)." ". $unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
                    </tr>
                    <tr bgcolor="<? echo $bgcolor2;?>">
                    	<td>Order Numbers</td>
                        <td colspan="3"><? echo $job_in_orders; ?></td>
                        <td>Plan Cut Qnty [Cut % <? echo fn_number_format((($po_plun_cut_qty/$total_set_qnty-$po_qty)/$po_qty)*100,2);?>]</td>
                        <td><b><? $uom=$row[csf("order_uom")]; echo fn_number_format($po_plun_cut_qty/$total_set_qnty)." ". $unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
                    </tr>
                    <tr bgcolor="<? echo $bgcolor;?>">
                    	<td>Knit Fabric Cons</td>
                        <td><b><? echo $fab_knit_qty_gray;$fab_knit_req_kg_avg+=$fab_knit_qty_gray; ?> (Kg)</b></td>
	
                        <td>Woven Fabric Cons</td>
                        <td><b><? echo $fab_woven_qty_gray;$fab_woven_req_yds_avg+= $fab_woven_qty_gray;?> (Yds)</b></td>
                        <td>Price Per Unit</td>
                        <td><b><? echo fn_number_format($row[csf("avg_unit_price")],2); ?> USD</b></td>
                    </tr>
                    
                    <tr bgcolor="<? echo $bgcolor2;?>">
                    	<td>Avg Yarn Req</td>
                        <td><b><? echo $yarn_req_qty_avg; ?> (Kg)</b></td>
                        <td>Woven Fin Fabric Cons</td>
                        <td><b><? echo $fab_woven_qty_finish; ?>(Yds)</b></td>
                        
                        <td>Order Value</td>
                        <td><b><? echo fn_number_format($po_qty*$row[csf("avg_unit_price")],2); ?></b></td>
                    </tr>
                    <tr bgcolor="<? echo $bgcolor;?>">
                    	<td>Knit Fin Fabric Cons</td>
                        <td><b><? echo $fab_knit_qty_finish; ?> (Kg)</b></td>
                        <td>Costing Per</td>
                        <td><b><? echo $costing_for; ?></b></td>
                        <td>Inco Term</td>
                        <td><b><? echo $incoterm[$row[csf("incoterm")]]; ?></b></td>
                    </tr>
                    <tr bgcolor="<? echo $bgcolor2;?>">
                        <td>GSM</td>
                        <td><b><? echo $gsm_weight_top.",".$gsm_weight_bottom ?></b></td>
                        <td>SMV</td>
                        <td><b><? $sew_smv=$row[csf("sew_smv")]; echo fn_number_format($sew_smv,2); ?> </b></td>
                        <td>Efficiency %</td>
                        <td colspan="1"><b><? echo $sew_effi_percent=$row[csf("sew_effi_percent")] ?> </b></td>
                    </tr>
                    <tr bgcolor="<? echo $bgcolor;?>">
                        <td>Exchange Rate</td>
                        <td><b><? echo $exchange_rate=$row[csf("exchange_rate")]; ?></b></td>
                        <td>Budget SAH</td>
                        <td><b><? echo fn_number_format(($row[csf("sew_smv")]*$po_qty)/60,2); ?></b></td>
                        <td>Shipment Date </td>
                        <td><b><? echo $pulich_ship_date;?></b></td>
                    </tr>
                    
                    
                    
                    
                </table>
            <?	
			
			
	}//end first foearch
	
				$condition= new condition();
				 $condition->company_name("=$company_name");
				 if(str_replace("'","",$job_no) !=''){
					  $condition->job_no("='$job_no'");
				 }
				if(str_replace("'","",$po_id)!='')
				 {
					 $condition->po_id("=$po_id");
				 }
				 $condition->init();
				$fabric= new fabric($condition);
				$fabric_costing_arr=$fabric->getAmountArray_by_order_knitAndwoven_greyAndfinish();
				 $yarn= new yarn($condition);
				 $yarn_costing_arr=$yarn->getOrderWiseYarnAmountArray();
				 $conversion= new conversion($condition);
				 $conversion_costing_arr_process=$conversion->getAmountArray_by_orderAndProcess();
				// print_r($conversion_costing_arr_process);
				 $trims= new trims($condition);
				 $trims_costing_arr=$trims->getAmountArray_by_order();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name=$emblishment->getAmountArray_by_orderAndEmbname();
				$commission= new commision($condition);
				$commission_costing_arr=$commission->getAmountArray_by_orderAndItemid();
				$commercial= new commercial($condition);
				$commercial_costing_arr=$commercial->getAmountArray_by_order();
				$other= new other($condition);
				$other_costing_arr=$other->getAmountArray_by_order();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash=$wash->getAmountArray_by_orderAndEmbname();
				
				$exchange_rate=76; 
				$sql_fin_purchase="select b.po_breakdown_id, sum(a.cons_rate*b.quantity) as finish_purchase_amnt from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.receive_basis<>9 and a.item_category=2 and a.transaction_type=1 and b.entry_form=37 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id=$po_id group by b.po_breakdown_id";
				$dataArrayFinPurchase=sql_select($sql_fin_purchase);
				foreach($dataArrayFinPurchase as $finRow)
				{
					$finish_purchase_amnt_arr[$finRow[csf('po_breakdown_id')]]=$finRow[csf('finish_purchase_amnt')]/$exchange_rate;
				}
				
				 $subconInBillDataArray=sql_select("select b.order_id, 
									  sum(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
									  sum(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
									  from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.party_source=1 and a.process_id in(2,4) and b.order_id=$po_id group by b.order_id");
				foreach($subconInBillDataArray as $subRow)
				{
					$subconCostArray[$subRow[csf('order_id')]]['knit_bill']=$subRow[csf('knit_bill')];
					$subconCostArray[$subRow[csf('order_id')]]['dye_finish_bill']=$subRow[csf('dye_finish_bill')];
				}	
				$prodcostDataArray=sql_select("select job_no, 
									  sum(CASE WHEN cons_process=1 THEN amount END) AS knit_charge,
									  sum(CASE WHEN cons_process=30 THEN amount END) AS yarn_dye_charge,
									  sum(CASE WHEN cons_process=35 THEN amount END) AS aop_charge,
									  sum(CASE WHEN cons_process not in(1,2,30,35) THEN amount END) AS dye_finish_charge
									  from wo_pre_cost_fab_conv_cost_dtls where status_active=1 and is_deleted=0 group by job_no");
				foreach($prodcostDataArray as $prodRow)
				{
					$prodcostArray[$prodRow[csf('job_no')]]['knit_charge']=$prodRow[csf('knit_charge')];
					$prodcostArray[$prodRow[csf('job_no')]]['yarn_dye_charge']=$prodRow[csf('yarn_dye_charge')];
					$prodcostArray[$prodRow[csf('job_no')]]['aop_charge']=$prodRow[csf('aop_charge')];
					$prodcostArray[$prodRow[csf('job_no')]]['dye_finish_charge']=$prodRow[csf('dye_finish_charge')];
				}
				$actualCostDataArray=sql_select("select cost_head,po_id,sum(amount_usd) as amount_usd from wo_actual_cost_entry where company_id=$company_name and status_active=1 and is_deleted=0 group by cost_head,po_id");
				foreach($actualCostDataArray as $actualRow)
				{
				   $actualCostArray[$actualRow[csf('cost_head')]][$actualRow[csf('po_id')]]=$actualRow[csf('amount_usd')];
				}
					
				$bookingDataArray=sql_select("select a.booking_type, a.item_category, a.currency_id, a.exchange_rate, b.po_break_down_id, b.process, b.amount, b.pre_cost_fabric_cost_dtls_id from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=$po_id and  a.company_id=$company_name and a.item_category in(4,12,25) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
				foreach($bookingDataArray as $woRow)
				{
					$amount=0; $trimsAmnt=0;
					if($woRow[csf('currency_id')]==1) { $amount=$woRow[csf('amount')]/$exchange_rate; } else { $amount=$woRow[csf('amount')]; }
					
					if($woRow[csf('item_category')]==25 && ($woRow[csf('booking_type')]==3 || $woRow[csf('booking_type')]==6)) 
					{ 
						if($embell_type_arr[$woRow[csf('pre_cost_fabric_cost_dtls_id')]]==3)
						{
							$washCostArray[$woRow[csf('po_break_down_id')]]+=$amount; 
						}
						else
						{
							$embellCostArray[$woRow[csf('po_break_down_id')]]+=$amount; 
						}
					}
					else if($woRow[csf('item_category')]==12 && $woRow[csf('process')]==35 && ($woRow[csf('booking_type')]==3 || $woRow[csf('booking_type')]==6)) 
					{ 
						$aopCostArray[$woRow[csf('po_break_down_id')]]+=$amount; 
					}
					else if($woRow[csf('item_category')]==4)
					{
						if($woRow[csf('currency_id')]==1) { $trimsAmnt=$woRow[csf('amount')]/$woRow[csf('exchange_rate')]; } else { $trimsAmnt=$woRow[csf('amount')]; }
						$actualTrimsCostArray[$woRow[csf('po_break_down_id')]]+=$trimsAmnt; 
					}
				}
				$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit"  );
				$receive_array=array();
				$sql_receive="select prod_id, sum(order_qnty) as qty, sum(order_amount) as amnt from inv_transaction where transaction_type=1 and item_category=1 and status_active=1 and is_deleted=0 group by prod_id";
				$resultReceive = sql_select($sql_receive);
				foreach($resultReceive as $invRow)
				{
					$avg_rate=$invRow[csf('amnt')]/$invRow[csf('qty')];
					$receive_array[$invRow[csf('prod_id')]]=$avg_rate;
				}
				$yarnTrimsDataArray=sql_select("select b.po_breakdown_id, b.prod_id, a.item_category, 
					sum(CASE WHEN a.transaction_type=2 and b.entry_form ='3' and b.trans_type=2 and b.issue_purpose!=2 THEN b.quantity ELSE 0 END) AS yarn_iss_qty,
					sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN b.quantity ELSE 0 END) AS yarn_iss_return_qty,
					sum(CASE WHEN a.transaction_type=5 and b.entry_form ='11' and b.trans_type=5 THEN b.quantity ELSE 0 END) AS trans_in_qty_yarn,
					sum(CASE WHEN a.transaction_type=6 and b.entry_form ='11' and b.trans_type=6 THEN b.quantity ELSE 0 END) AS trans_out_qty_yarn,
					sum(CASE WHEN a.transaction_type=2 and b.entry_form ='25' and b.trans_type=2 THEN a.cons_rate*b.quantity ELSE 0 END) AS trims_issue_amnt
					from inv_transaction a, order_wise_pro_details b where a.id=b.trans_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.po_breakdown_id=$po_id group by b.po_breakdown_id, b.prod_id, a.item_category");
				foreach($yarnTrimsDataArray as $invRow)
				{
					if($invRow[csf('item_category')]==1)
					{
						$iss_qty=$invRow[csf('yarn_iss_qty')]+$invRow[csf('trans_in_qty_yarn')]-$invRow[csf('yarn_iss_return_qty')]-$invRow[csf('trans_out_qty_yarn')];
						$rate='';
						if($receive_array[$invRow[csf('prod_id')]]>0)
						{
							$rate=$receive_array[$invRow[csf('prod_id')]];
						}
						else
						{
							$rate=$avg_rate_array[$invRow[csf('prod_id')]]/$exchange_rate;
						}
						
						$iss_amnt=$iss_qty*$rate;
						$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]][1]+=$iss_amnt;
					}
					else
					{
						$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]][4]+=$invRow[csf('trims_issue_amnt')];
					}
				}
				$yarncostDataArray=sql_select("select job_no, sum(amount) as amnt, sum(rate*avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls where status_active=1 and is_deleted=0 and job_no='$job_no' group by job_no");
				foreach($yarncostDataArray as $yarnRow)
				{
				   $yarncostArray[$yarnRow[csf('job_no')]]=$yarnRow[csf('amount')];
				}
				
				$fabriccostDataArray=sql_select("select job_no, costing_per_id, embel_cost, wash_cost, cm_cost, commission, currier_pre_cost, lab_test, inspection, freight, comm_cost from wo_pre_cost_dtls where status_active=1 and is_deleted=0 and job_no='$job_no'");
				foreach($fabriccostDataArray as $fabRow)
				{
					 $fabriccostArray[$fabRow[csf('job_no')]]['costing_per_id']=$fabRow[csf('costing_per_id')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['embel_cost']=$fabRow[csf('embel_cost')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['wash_cost']=$fabRow[csf('wash_cost')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['cm_cost']=$fabRow[csf('cm_cost')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['commission']=$fabRow[csf('commission')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['currier_pre_cost']=$fabRow[csf('currier_pre_cost')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['lab_test']=$fabRow[csf('lab_test')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['inspection']=$fabRow[csf('inspection')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['freight']=$fabRow[csf('freight')];
					 $fabriccostArray[$fabRow[csf('job_no')]]['comm_cost']=$fabRow[csf('comm_cost')];
				}
				
				$ex_factory_arr=return_library_array( "select po_break_down_id, 
				sum(CASE WHEN entry_form!=85 THEN ex_factory_qnty ELSE 0 END)-sum(CASE WHEN entry_form=85 THEN ex_factory_qnty ELSE 0 END) as qnty 
				from pro_ex_factory_mst where status_active=1 and is_deleted=0 and po_break_down_id =$po_id group by po_break_down_id", "po_break_down_id", "qnty");
				
					$dzn_qnty=0;
					$costing_per_id=$fabriccostArray[$job_no]['costing_per_id'];
					if($costing_per_id==1)
					{
						$dzn_qnty=12;
					}
					else if($costing_per_id==3)
					{
						$dzn_qnty=12*2;
					}
					else if($costing_per_id==4)
					{
						$dzn_qnty=12*3;
					}
					else if($costing_per_id==5)
					{
						$dzn_qnty=12*4;
					}
					else
					{
						$dzn_qnty=1;
					}
					
				 $ex_factory_qty=$ex_factory_arr[$po_id];
				 $unit_price=$unit_price/$total_set_qnty;
				$tot_ex_factory_val=$ex_factory_qty*$unit_price;
				$tot_fabric_purchase_cost_mkt=$fabric_costing_arr['knit']['grey'][$po_id]+$fabric_costing_arr['woven']['grey'][$po_id];
				$tot_fabric_purchase_cost_actual=$finish_purchase_amnt_arr[$po_id];
				$tot_yarn_cost_mkt=$yarn_costing_arr[$po_id];
				$tot_yarn_dye_cost_mkt=$conversion_costing_arr_process[$po_id][30];
				$tot_knit_cost_mkt=$conversion_costing_arr_process[$po_id][1];
				
					$tot_dye_finish_cost_mkt=0;$not_yarn_dyed_cost_arr=array(1,2,30,35);
					foreach($conversion_cost_head_array as $process_id=>$val)
					{
						if(!in_array($process_id,$not_yarn_dyed_cost_arr))
						{
							$tot_dye_finish_cost_mkt+=array_sum($conversion_costing_arr_process[$po_id][$process_id]);
						}
					}
					$tot_dye_finish_cost_actual=$subconCostArray[$po_id]['dye_finish_bill']/$exchange_rate;
					$tot_knit_cost_actual=$subconCostArray[$po_id]['knit_bill']/$exchange_rate;
					
					$tot_aop_cost_actual=$aopCostArray[$po_id];
					$tot_aop_cost_mkt=$conversion_costing_arr_process[$po_id][35];
					$tot_trims_cost_mkt=$trims_costing_arr[$po_id];
					$tot_trims_cost_actual=$actualTrimsCostArray[$po_id];
					
					$print_amount=$emblishment_costing_arr_name[$po_id][1];
					$embroidery_amount=$emblishment_costing_arr_name[$po_id][2];
					$special_amount=$emblishment_costing_arr_name[$po_id][4];
					$wash_cost=$emblishment_costing_arr_name_wash[$po_id][3];
					$other_amount=$emblishment_costing_arr_name[$po_id][5];
					
					$tot_embell_cost_mkt=$print_amount+$embroidery_amount+$special_amount+$other_amount;
					$tot_embell_cost_actual=$embellCostArray[$po_id];
					$tot_wash_cost_mkt=$wash_cost;
					$tot_wash_cost_actual=$washCostArray[$po_id];
					
					$foreign_cost=$commission_costing_arr[$po_id][1];
					$local_cost=$commission_costing_arr[$po_id][2];
					
					
					
					$tot_commission_cost_mkt=$foreign_cost+$local_cost;
					$tot_commission_cost_actual=($ex_factory_qty/$dzn_qnty)*$fabriccostArray[$job_no]['commission'];
					$tot_comm_cost_actual=$actualCostArray[6][$po_id];
					$tot_comm_cost_mkt=$commercial_costing_arr[$po_id];
					
					$tot_test_cost_mkt=$other_costing_arr[$po_id]['lab_test'];
					$tot_freight_cost_mkt=$other_costing_arr[$po_id]['freight'];
					$tot_inspection_cost_mkt=$other_costing_arr[$po_id]['inspection'];
					$tot_certificate_cos_mktt=$other_costing_arr[$po_id]['certificate_pre_cost'];
					//$common_oh_cost=$other_costing_arr[$row[csf('id')]]['common_oh'];
					$tot_currier_cost_mkt=$other_costing_arr[$po_id]['currier_pre_cost'];
					$tot_cm_cost_mkt=$other_costing_arr[$po_id]['cm_cost'];
					
					$tot_yarn_cost_actual=$yarnTrimsCostArray[$po_id][1];
					
					$tot_freight_cost_actual=$actualCostArray[2][$po_id];
					$tot_test_cost_actual=$actualCostArray[1][$po_id];
					$tot_inspection_cost_actual=$actualCostArray[3][$po_id];
					$tot_currier_cost_actual=$actualCostArray[4][$po_id];
					$tot_cm_cost_actual=$actualCostArray[5][$po_id];
					
					//$tot_mkt_all_cost=$tot_mkt_all_cost;
					$tot_mkt_all_cost=$tot_yarn_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_yarn_dye_cost_mkt+$tot_aop_cost_mkt+$tot_trims_cost_mkt+$tot_embell_cost_mkt+$tot_wash_cost_mkt+$tot_commission_cost_mkt+$tot_comm_cost_mkt+$tot_freight_cost_mkt+$tot_test_cost_mkt+$tot_inspection_cost_mkt+$tot_currier_cost_mkt+$tot_cm_cost_mkt+$tot_fabric_purchase_cost_mkt;
					
					$tot_mkt_margin=$tot_po_value-$tot_mkt_all_cost;
					$tot_mkt_margin_perc=($mkt_margin/$tot_po_value)*100;
					
					$tot_actual_all_cost=$tot_yarn_cost_actual+$tot_knit_cost_actual+$tot_dye_finish_cost_actual+$tot_yarn_dye_cost_actual+$tot_aop_cost_actual+$tot_trims_cost_actual+$tot_embell_cost_actual+$tot_wash_cost_actual+$tot_commission_cost_actual+$tot_comm_cost_actual+$tot_freight_cost_actual+$tot_test_cost_actual+$tot_inspection_cost_actual+$tot_currier_cost_actual+$tot_cm_cost_actual+$tot_fabric_purchase_cost_actual;
					
					$tot_actual_margin=$tot_ex_factory_val-$tot_actual_all_cost;
					$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
					
	?>
         <br/> <br/>
        <table width="760" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
      
                            <thead>
                                <th width="30">SL</th>
                                <th width="180">Particulars</th>
                                <th width="130">Pre Costing</th>
                                <th width="80">%</th>
                                <th width="130">Post-Costing</th>
                                <th width="80">%</th>
                                <th>Variance</th>
                            </thead> 
							<?
								$bgcolor1='#E9F3FF';
								$bgcolor2='#FFFFFF';
							?>
                            </thead>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_1','<? echo $bgcolor1; ?>')" id="trtd_1">
                                <td align="center">1</td>
                                <td>PO/Shipment Value</td>
                                <td align="right"><? echo fn_number_format($tot_po_value,2); ?></td>
                                <td align="right">&nbsp;</td>
                                <td align="right"><? echo fn_number_format($tot_ex_factory_val,2); ?></td>
                                <td align="right">&nbsp;</td>
                                <td align="right"><? echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_2','<? echo $bgcolor2; ?>')" id="trtd_2">
                                <td colspan="7"><b>Cost</b></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_3','<? echo $bgcolor1; ?>')" id="trtd_3">
                                <td align="center">2</td>
                                <td>Fabric Purchase Cost</td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_4','<? echo $bgcolor2; ?>')" id="trtd_4">
                                <td align="center">3</td>
                                <td>Yarn Cost+Yarn Dyeing Cost</td>
                                <td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $tot_yarn_cost_mkt."**".$tot_yarn_dye_cost_mkt; ?>','mkt_yarn_cost','Grey And Dyed Yarn Mkt. Cost Details')"></a><? echo fn_number_format($tot_yarn_cost_mkt+$tot_yarn_dye_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format((($tot_yarn_cost_mkt+$tot_yarn_dye_cost_mkt)/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_yarn_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_yarn_cost_mkt+$tot_yarn_dye_cost_mkt)-$tot_yarn_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_5','<? echo $bgcolor2; ?>')" id="trtd_5">
                                <td align="center">4</td>
                                <td>Knitting Cost</td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_6','<? echo $bgcolor2; ?>')" id="trtd_6">
                                <td align="center">5</td>
                                <td>Dye & Fin Cost</td>
                                <td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_dye_finish_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','dye_fin_cost','Dye & Fin Cost Details')"></a><? echo fn_number_format($tot_dye_finish_cost_actual,2); ?></td>
                                <td align="right">
								<? 
								echo fn_number_format(($tot_dye_finish_cost_actual/$tot_ex_factory_val)*100,2); 
								
								?>
                                </td>
                                <td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual,2); ?></td>
                            </tr>
                            
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_7','<? echo $bgcolor1; ?>')" id="trtd_7">
                                <td align="center">6</td>
                                <td>AOP & Others Cost</td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_8','<? echo $bgcolor2; ?>')" id="trtd_8">
                                <td align="center">7</td>
                                <td>Trims Cost</td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_trims_cost_mkt-$tot_trims_cost_actual,2); ?></td>
                            </tr> 
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_9','<? echo $bgcolor1; ?>')" id="trtd_9">
                                <td align="center">8</td>
                                <td>Embellishment Cost</td>
                                <td align="right"><? echo fn_number_format($tot_embell_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_embell_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_embell_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_embell_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_embell_cost_mkt-$tot_embell_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_10','<? echo $bgcolor2; ?>')" id="trtd_10">
                                <td align="center">9</td>
                                <td>Wash Cost</td>
                                <td align="right"><? echo fn_number_format($tot_wash_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_wash_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_wash_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_wash_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_wash_cost_mkt-$tot_wash_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_11','<? echo $bgcolor1; ?>')" id="trtd_11">
                                <td align="center">10</td>
                                <td>Commission Cost</td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_commission_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_commission_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_commission_cost_mkt-$tot_commission_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_12','<? echo $bgcolor2; ?>')" id="trtd_12">
                                <td align="center">11</td>
                                <td>Commercial Cost</td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_comm_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_comm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_comm_cost_mkt-$tot_comm_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_13','<? echo $bgcolor1; ?>')" id="trtd_13">
                                <td align="center">12</td>
                                <td>Freight Cost</td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_freight_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_freight_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_freight_cost_mkt-$tot_freight_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_14','<? echo $bgcolor2; ?>')" id="trtd_14">
                                <td align="center">13</td>
                                <td>Testing Cost</td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_test_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_test_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_test_cost_mkt-$tot_test_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_15','<? echo $bgcolor1; ?>')" id="trtd_15">
                                <td align="center">14</td>
                                <td>Inspection Cost</td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_inspection_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_inspection_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_inspection_cost_mkt-$tot_inspection_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_16','<? echo $bgcolor2; ?>')" id="trtd_16">
                                <td align="center">15</td>
                                <td>Courier Cost</td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_currier_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_currier_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_currier_cost_mkt-$tot_currier_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_17','<? echo $bgcolor1; ?>')" id="trtd_17">
                                <td align="center">16</td>
                                <td>CM</td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_mkt,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_cm_cost_mkt/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_actual,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_cm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_cm_cost_mkt-$tot_cm_cost_actual,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_18','<? echo $bgcolor2; ?>')" id="trtd_18">
                                <td align="center">17</td>
                                <td>Total Cost</td>
                                <td align="right"><? echo fn_number_format($tot_mkt_all_cost,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_mkt_all_cost/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_all_cost,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_actual_all_cost/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_mkt_all_cost-$tot_actual_all_cost,2); ?></td>
                            </tr>
                            <tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_19','<? echo $bgcolor1; ?>')" id="trtd_19">
                                <td align="center">18</td>
                                <td>Margin/Loss</td>
                                <td align="right"><? echo fn_number_format($tot_mkt_margin,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_actual_margin,2); ?></td>
                                <td align="right"><? echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
                                <td align="right"><? echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
                            </tr>
                        </table>
		</fieldset>
	</div>    
	<?
    exit();	
}
//disconnect($con);

if($action=="bomRpt2")
{
	extract($_REQUEST);
	//   var_dump($_REQUEST);

	  $exp=explode("**",$data);
	//   echo "<pre>";
	//    print_r($data);
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	// echo $exp[4];die;
	$txt_costing_date=change_date_format(str_replace("'","",$txt_costing_date),'yyyy-mm-dd','-');
	$txt_job_no=$exp[2];$cbo_company_name=$exp[0];$cbo_buyer_name=$exp[1];$hide_order_id=$exp[5];$cbo_year=$exp[4];
	
	if($db_type==0) $year_cond=" and YEAR(insert_date)=$cbo_year"; else if($db_type==2) $year_cond=" and to_char(insert_date,'YYYY')=$cbo_year"; else $year_cond="";


	$job_no=sql_select("select job_no from wo_po_details_master where JOB_NO_PREFIX_NUM='$txt_job_no'and company_name='$cbo_company_name' $year_cond");
	
	if($job_no[0][JOB_NO] !=''){	
		$txt_job_no=$job_no[0][JOB_NO];
	}


	if($txt_job_no=="") $job_no=''; else $job_no=" and a.job_no='".$txt_job_no."'";
	if($cbo_company_name=="") $company_name=''; else $company_name=" and a.company_name=".$cbo_company_name."";
	if($hide_order_id=="") $hide_order_id=''; else $hide_order_id=" and b.id=".$hide_order_id."";
	if($cbo_buyer_name==0) $cbo_buyer_name=''; else $cbo_buyer_name=" and a.buyer_name=".$cbo_buyer_name."";
	if($txt_style_ref=="") $txt_style_ref=''; else $txt_style_ref=" and a.style_ref_no=".$txt_style_ref."";
	if($txt_costing_date=="") $txt_costing_date=''; else $txt_costing_date=" and c.costing_date='".$txt_costing_date."'";
	if(str_replace("'",'',$txt_po_breack_down_id)=="")
	{
		$txt_po_breack_down_id_cond='';
		$txt_po_breack_down_id_cond1='';
		$txt_po_breack_down_id_cond2='';
		$txt_po_breack_down_id_cond3='';
	}
	else
	{
		$txt_po_breack_down_id_cond=" and b.id in(".$txt_po_breack_down_id.")";
		$txt_po_breack_down_id_cond1=" and id in(".$txt_po_breack_down_id.")";
		$txt_po_breack_down_id_cond2=" and po_break_down_id in(".$txt_po_breack_down_id.")";
		$txt_po_breack_down_id_cond3=" and b.id in(".$txt_po_breack_down_id.")";
	}

	//array for display name
	$buyer_arr=return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
	$comp=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$color_library=return_library_array( "select id, color_name from lib_color where status_active=1 and is_deleted=0", "id", "color_name");

	$gmtsitem_ratio_array=array();
	$grmnt_items = "";
    $grmts_sql = sql_select("select job_no,gmts_item_id,set_item_ratio from wo_po_details_mas_set_details where job_no='$txt_job_no'");
	foreach($grmts_sql as $key=>$val)
	{
		$grmnt_items .=$garments_item[$val[csf("gmts_item_id")]].",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]]=$val[csf('set_item_ratio')];
	}
	
	$grmnt_items = rtrim($grmnt_items,",");
	if($db_type==0) $po_id_cond="group_concat( distinct b.id) as po_id";
	if($db_type==2) $po_id_cond="listagg(b.id ,',') within group (order by b.id) AS po_id";
	if($db_type==0) ///fab_knit_fin_req_kg,fab_knit_req_kg
	{
	   $sql = "select a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price,sum(b.plan_cut) as job_quantity,sum(b.po_quantity) as ord_qty,$po_id_cond, c.costing_per,c.budget_minute,c.approved, d.fab_knit_req_kg,d.fab_knit_fin_req_kg, d.fab_woven_req_yds,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.style_description
			from wo_po_details_master a,wo_po_break_down b, wo_pre_cost_mst c left join wo_pre_cost_sum_dtls d on   c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0
			where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref $txt_costing_date $hide_order_id group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price, c.costing_per,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_knit_fin_req_kg,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.style_description order by a.job_no";
	}
	if($db_type==2)
	{
	    $sql = "select a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price,sum(b.plan_cut) as job_quantity,sum(b.po_quantity) as ord_qty,$po_id_cond, c.costing_per,c.budget_minute,c.approved,   d.fab_knit_fin_req_kg, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.style_description
			from wo_po_details_master a,wo_po_break_down b, wo_pre_cost_mst c left join  wo_pre_cost_sum_dtls d on  c.job_no=d.job_no and d.status_active=1 and d.is_deleted=0
			where a.job_no=b.job_no_mst and b.job_no_mst=c.job_no  and a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref $hide_order_id group by a.job_no,a.company_name, a.buyer_name,a.style_ref_no, a.gmts_item_id,a.order_uom, a.avg_unit_price, c.costing_per,c.approved,c.budget_minute, d.fab_knit_req_kg, d.fab_woven_req_yds,d.fab_knit_fin_req_kg,d.fab_woven_fin_req_yds, d.fab_yarn_req_kg,a.style_description  order by a.job_no"; //a.job_quantity as job_quantity,
	}
	
	$data_array=sql_select($sql);
	$plan_cut_qty=$data_array[0][csf('job_quantity')];
	$po_quantity=$data_array[0][csf('ord_qty')];
	$all_po_id=$data_array[0][csf('po_id')];
	$pocond="";
	if($all_po_id!="")
	{
		$pocond="and id in($all_po_id)";
		$pocond2="and b.id in($all_po_id)";
	}
	

	$exfact_qty_arr=sql_select("select a.delivery_mst_id, sum(a.ex_factory_qnty) as ex_factory_qnty 
	from pro_ex_factory_mst a,wo_po_break_down b where a.entry_form != 85 and a.po_break_down_id=b.id $pocond2  and a.status_active=1 and a.delivery_mst_id>0 group by a.delivery_mst_id");
	
	// print_r($exfact_qty_arr);
	

	//echo $plan_cut_qty;
	//echo $order_value=$plan_cut_qty*$data_array[0][csf('avg_unit_price')];
	$variArr=array();
	$sqlvari=sql_select("select embellishment_id,embellishment_budget_id from variable_order_tracking where company_name=$cbo_company_name and variable_list=56 and status_active=1 and is_deleted=0");
	//$embel_type_id=0;$embel_type_id=0;
	foreach($sqlvari as $vari_row)
	{
		//$is_manula_approved=$sql_row[csf('pre_cost_approval')];
		$embel_type_id=$vari_row[csf('embellishment_id')];
		$embelt_budget_qty_id_arr[$embel_type_id]=$vari_row[csf('embellishment_budget_id')];
	}
	
	?>
    <!--<div style="width:852px; margin:0 auto">
    <div style="width:850px; font-size:20px; font-weight:bold" align="center">< ? echo $comp[str_replace("'","",$cbo_company_name)]; ?></div>
    <div style="width:850px; font-size:14px; font-weight:bold" align="center">BOM Report 2</div>-->
	<?
	

	$result =sql_select("select po_number,pub_shipment_date,file_no,excess_cut,grouping from wo_po_break_down where job_no_mst='$txt_job_no' $txt_po_breack_down_id_cond1 and status_active=1 and is_deleted=0 $pocond order by pub_shipment_date DESC");

	

		//$tot_row=count($result);
		$job_in_orders = '';$pulich_ship_date='';$job_in_ref = '';$job_in_file = '';
		$tot_excess_cut=0;$tot_row=0;
		foreach ($result as $val)
		{
			$job_in_orders .= $val[csf('po_number')].", ";
			$pulich_ship_date = $val[csf('pub_shipment_date')];
			if($val[csf('excess_cut')]>0)
			{
				$tot_row++;
			}
			$tot_excess_cut+= $val[csf('excess_cut')];
			//$job_in_ref .= $val[csf('grouping')].", ";
			//$job_in_file .= $val[csf('file_no')].", ";
			if($job_in_ref=='') $job_in_ref= $val[csf('grouping')]; else $job_in_ref.=",". $val[csf('grouping')];
			if($job_in_file=='') $job_in_file= $val[csf('file_no')]; else $job_in_file.=",". $val[csf('file_no')];
		}
	foreach ($data_array as $row)
	{
		$order_price_per_dzn=0;
		$order_job_qnty=0;
		$ord_qty=0;
		$avg_unit_price=0;
		$order_values = $row[csf("ord_qty")]*$row[csf("avg_unit_price")];
		
		$avg_excess_cut=$tot_excess_cut/$tot_row;

		$job_in_orders = substr(trim($job_in_orders),0,-1);
		$job_ref=array_unique(explode(",",$job_in_ref));
		$job_file=array_unique(explode(",",rtrim($job_in_file,",")));
		$all_po_id = rtrim($all_po_id,",");
		$all_po_ids=implode(",",array_unique(explode(",",$all_po_id)));
		//print_r($job_ref);
		$ref_cond='';
		foreach ($job_ref as $ref)
		{
			//$ref_cond.=", ".$ref;
			if($ref_cond=='') $ref_cond=$ref; else $ref_cond.=", ".$ref;
		}
		$file_con='';
		foreach ($job_file as $file)
		{
			if($file_con=='') $file_cond=$file; else $file_cond.=", ".$file;
		}
		$exfact_qty=$exfact_qty_arr[0][csf('ex_factory_qnty')];

		?>
            	<table style="width:850px" ><tr><td colspan="6" align="center">
                   <?
				   	$image_location=return_field_value("image_location","common_photo_library","file_type=1 and form_name='company_details' and master_tble_id=$cbo_company_name","image_location");
					?>
                    <img  src='../../../<? echo $image_location; ?>' height='70' align="left" />
                    <b style="font-size:25px;"><? echo $comp[str_replace("'","",$cbo_company_name)]; ?></b><br>
                    <b style="font-size:14px;">Final Cost Report </b>
                </td></tr></table>
                <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px" rules="all">
                	<tr>
                    	<td width="80">Job Number</td>
                        <td width="80"><b><? echo $row[csf("job_no")]; ?></b></td>
                        <td width="90">Buyer</td>
                        <td width="100"><b><? echo $buyer_arr[$row[csf("buyer_name")]]; ?></b></td>
                        <td width="80">Ex-Factory Qty.</td>
                        <td width="100"><b><? echo $exfact_qty_arr[0][csf('ex_factory_qnty')]." ".$unit_of_measurement[$row[csf("order_uom")]]; $uom=$row[csf("order_uom")]; ?></b></td>
                    </tr>
                    <tr>
                        <td>Order Qty</td>
                        <td><b><? $tot_order_value=$row[csf("ord_qty")]*$row[csf("avg_unit_price")];$order_qty=$row[csf("ord_qty")];
						echo $row[csf("ord_qty")]." ".$unit_of_measurement[$row[csf("order_uom")]]; ?></b></td>
                    	<td>Style Ref. No</td>
                        <td><b><? echo $row[csf("style_ref_no")]; ?></b></td>

                        <td>Price Per Unit</td>
                        <td><b><? echo $row[csf("avg_unit_price")]; ?></b></td>
                    </tr>
                    <tr>
                    	<td>Order Numbers</td>
                        <td colspan="3"><? echo $job_in_orders; ?></td>
						<td>Style Desc</td>
                        <td><? echo $row[csf("style_description")]; ?></td>
                    </tr>
                    <tr>
                    	<td>Garments Item</td>
                        <td colspan="3"><b><? echo $grmnt_items; ?></b></td>
                        <td>Shipment Date</td>
                        <td><b><? echo change_date_format($pulich_ship_date); ?></b></td>
                    </tr>
                     <tr>
                    	<td>Avg Cons. Grey</td>
                        <td align=""><b><? echo fn_number_format($row[csf("fab_knit_req_kg")]+$row[csf("fab_woven_req_yds")],2); ?></b></td>
                        <td>Avg Cons. Fin.</td>
                        <td align=""><b><? echo fn_number_format($row[csf("fab_knit_fin_req_kg")]+$row[csf("fab_woven_fin_req_yds")],2); ?></b></td>
                       
                    </tr>
                    <tr>
                    <td>Budget Minute</td>
                        <td><b><? echo $row[csf("budget_minute")] ?> </b></td>
                        <td align="center" height="10" colspan="6" valign="top" id="app_sms" style="font-size:18px;"><font color="#FF0000"><? if( $row[csf("approved")]==1 || $row[csf("approved")]==3){echo "This Job is Approved ";} else {echo "";} ?> </font> </td>
                    </tr>
                     <tr>
                    	<td>Internal Ref</td>
                        <td colspan="2"><b><? echo ltrim($ref_cond,", "); ?></b></td>
                        <td>File No</td>
                        <td colspan="2"><b><? echo $file_cond; ?></b></td>
                    </tr>
                </table>

            <?
			if($row[csf("costing_per")]==1){$order_price_per_dzn=12;$costing_for=" DZN";}
			else if($row[csf("costing_per")]==2){$order_price_per_dzn=1;$costing_for=" PCS";}
			else if($row[csf("costing_per")]==3){$order_price_per_dzn=24;$costing_for=" 2 DZN";}
			else if($row[csf("costing_per")]==4){$order_price_per_dzn=36;$costing_for=" 3 DZN";}
			else if($row[csf("costing_per")]==5){$order_price_per_dzn=48;$costing_for=" 4 DZN";}
			$order_job_qnty=$row[csf("job_quantity")];
			$avg_unit_price=$row[csf("avg_unit_price")];
			$ord_qty=$row[csf("ord_qty")];
	}//end first foearch
 // ======================================all fabric cost ====================================

		$gray_fab_sql="select c.quantity,c.po_breakdown_id as order_id,b.body_part_id from inv_receive_master a,pro_grey_prod_entry_dtls b,order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and c.po_breakdown_id in ($all_po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active=1 and c.is_deleted=0 group by c.quantity,c.po_breakdown_id ,b.body_part_id ";
		$gray_fab_data=sql_select($gray_fab_sql);

		foreach($gray_fab_data as $row){
			$gray_fab_arr[$row[csf("order_id")]][$row[csf("body_part_id")]] +=$row[csf("quantity")];
			$gray_fab_rate_arr[$row[csf("order_id")]][$row[csf("body_part_id")]]=$row[csf("rate")];
		}

		unset($gray_fab_data);


		$finish_fab_sql="select c.quantity,c.po_breakdown_id as order_id,b.body_part_id from inv_receive_master a,pro_finish_fabric_rcv_dtls b,order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and c.po_breakdown_id in ($all_po_id)  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active=1 and c.is_deleted=0";


		$finish_fab_data=sql_select($finish_fab_sql);

		foreach($finish_fab_data as $row){
		$finish_fab_arr[$row[csf("order_id")]][$row[csf("body_part_id")]] +=$row[csf("quantity")];
		} 
		unset($finish_fab_data);

		$all_fabric_cost_sql="select a.id, a.job_no,a.item_number_id,a.uom,body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,b.id as order_id from wo_pre_cost_fabric_cost_dtls a,wo_po_break_down b where b.job_no_mst='".$txt_job_no."' and a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0";

		$all_fabric_data=sql_select($all_fabric_cost_sql);

		foreach( $all_fabric_data as $row )
       	 {
			if($row[csf("fab_nature_id")]==2)//knit fabrics
			{
				$knit_fabric_val +=$finish_fab_arr[$row[csf("order_id")]][$row[csf("body_part_id")]]*$row[csf("rate")];
			}else if($row[csf("fab_nature_id")]==3)//wovwn fabrics
			{
				$wvn_fabric_val +=$finish_fab_arr[$row[csf("order_id")]][$row[csf("body_part_id")]]*$row[csf("rate")];
			}
		}
		
		unset($all_fabric_data);

		
		///============================ end all fabric cost ==================

	//////////////=======================trims cost==============================

	$trims_sql="select a.booking_no,a.company_id,a.is_short,a.is_approved,a.item_from_precost,a.entry_form,a.budget_version,a.booking_date, a.currency_id, a.exchange_rate, sum(b.amount) as amount, sum(b.wo_qnty) as cu_woq,b.trim_group,b.fabric_description,b.uom from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id in ($all_po_id) and a.item_category=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.booking_no,a.company_id,a.is_approved,a.item_from_precost,a.entry_form,a.budget_version,a.booking_date, a.currency_id,a.is_short, a.exchange_rate,b.trim_group,b.fabric_description,b.uom";
	$trims_data=sql_select($trims_sql);
	foreach( $trims_data as $row ){		
		$tot_trims_cost +=$row[csf("amount")];	
	}
	unset($trims_data);

	///////=========================end  trims cost================================

 /////////////==========================Embellishment Cost start==============================================

 $exchange_rate=return_field_value("a.exchange_rate", "wo_pre_cost_mst a, wo_po_break_down b", "a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.id in ($all_po_id)","exchange_rate");

	$embl_sql="select a.id, a.challan_no, a.production_date, a.po_break_down_id, a.item_number_id, a.production_quantity, a.embel_name, a.embel_type,b.rate,b.amount from pro_garments_production_mst a ,subcon_outbound_bill_dtls b where company_id=$cbo_company_name  and a.production_source=3 and a.production_type=3 and a.status_active=1 and b.receive_id=a.id and a.is_deleted=0 and a.po_break_down_id in ($all_po_id) order by a.id Desc";

			$data_array=sql_select($embl_sql);

			foreach( $data_array as $row )
				{
					$rate=fn_number_format($row[csf("rate")]/$exchange_rate,4);
					$total_embellishment_amt +=($row[csf('production_quantity')]/12)*$rate;
				}

				unset($data_array);

	//============================================Embellishment Cost end===================

	//==========================================yarn cost start====================================

	$return_yarn_sql = "select a.recv_number,a.company_id,a.receive_date,a.item_category,a.recv_number,b.id as trans_id, b.cons_quantity, b.cons_reject_qnty, b.cons_uom, b.cons_rate, b.cons_amount, c.id as prod_id,c.lot,d.po_breakdown_id from  inv_receive_master a, inv_transaction b left join product_details_master c on b.prod_id=c.id join order_wise_pro_details d on  b.id=d.trans_id where a.id=b.mst_id and b.item_category=1 and b.transaction_type=4 and a.status_active=1 and b.status_active=1 and d.po_breakdown_id in($all_po_id)";

	$return_yarn_data=sql_select($return_yarn_sql);
	$yarn_return_qty=array();
	foreach( $return_yarn_data as $row )
	{
	$yarn_return_qty[$row[csf('prod_id')]][$row[csf('trans_id')]]+=$row[csf('cons_quantity')];
	}


	$yarn_sql="select a.issue_number, a.issue_date, c.supplier_id,  b.quantity as issue_qnty, c.id as prod_id, c.product_name_details, c.avg_rate_per_unit,d.id as trans_id from inv_issue_master a, order_wise_pro_details b, product_details_master c, inv_transaction d where a.id=d.mst_id and d.transaction_type=2 and d.item_category=1 and c.item_category_id=1 and d.id=b.trans_id and b.trans_type=2 and b.entry_form=3 and b.po_breakdown_id in($all_po_id) and b.prod_id=c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.issue_purpose!=2 ";

	
	$yarn_data=sql_select($yarn_sql);
	foreach( $yarn_data as $row )
	{
	   if($receive_array[$row[csf('prod_id')]]>0) {	$avg_rate=$receive_array[$row[csf('prod_id')]];}
	   else{ $avg_rate=$row[csf('avg_rate_per_unit')]/$exchange_rate;}
	  
	   $yarn_total_amount +=($row[csf("issue_qnty")]-$yarn_return_qty[$row[csf('prod_id')]][$row[csf('trans_id')]])*fn_number_format($avg_rate,0);
   }
   unset($yarn_data);
   //===============================================yarn cost end ===============================================

   //================================================conversion cost=============================================

   $converson_fab_cost_sql="select a.bill_no, a.bill_date, b.item_id, b.rate, b.receive_qty, b.amount as amount  from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and b.order_id in ($all_po_id) and a.process_id=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   order by b.item_id";


   // echo $sql1;
   $con_fab_data=sql_select($converson_fab_cost_sql);

   foreach($con_fab_data as $row )
   {
	   $rate=fn_number_format($row[csf('rate')]/$exchange_rate,2);
	   $conv_fab_cost+=fn_number_format($row[csf('receive_qty')]*$rate,2);
   }
   unset($con_fab_data);
			
   $converson_fab_dye_cost_sql="select a.bill_no, a.bill_date, b.item_id, b.rate, b.receive_qty, b.amount as amount from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and b.order_id in ($all_po_id) and a.process_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by a.bill_no, a.bill_date, b.item_id, b.rate, b.receive_qty, b.amount order by b.item_id";
   $con_fab_dye_data=sql_select($converson_fab_dye_cost_sql);
   foreach($con_fab_dye_data as $row )
   {
	   $rate=fn_number_format($row[csf('rate')]/$exchange_rate,2);
	   $con_fab_dye_cost+=$row[csf('receive_qty')]*$rate;
   }
   unset($con_fab_dye_data);
   $conversion_costing=$conv_fab_cost+$con_fab_dye_cost;
  
   //======================================================conversion cost end ===================

	//All Cost start here...
	//start	all summary report here -------------------------------------------
	//job_no $txt_po_breack_down_id_cond $company_name $cbo_buyer_name $txt_style_ref
	 $sql = "select fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,wash_cost,wash_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,currier_pre_cost,currier_percent,certificate_pre_cost,certificate_percent,common_oh,common_oh_percent,total_cost,deffdlc_cost,deffdlc_percent,interest_cost,interest_percent,incometax_cost,incometax_percent,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,depr_amor_pre_cost,depr_amor_po_price,price_pcs_or_set_percent,margin_pcs_set,margin_pcs_set_percent,cm_for_sipment_sche
			from wo_pre_cost_dtls
			where job_no='".$txt_job_no."' and status_active=1 and is_deleted=0";

			//echo  $sql;
	$data_array=sql_select($sql);
	$others_cost_value=0;
	$fabric_cost=0;
	$trims_cost=0;
	$embel_cost=0;
	$comm_cost=0;
	$commission=0;
	$lab_test=0;
	$inspection=0;
	$cm_cost=0;
	$freight=0;
	$currier_pre_cost=0;
	$certificate_pre_cost=0;
	$common_oh=0;
 	?>

        <div style="margin-top:15px">
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
                    <td width="80">SL</td>
                    <td width="300">Particulars</td>
                    <td width="100">Cost</td>
                    <td width="100">Amount (USD)</td>
                    <td width="180">% to Ord. Value</td>
                </tr>
            <?
			$po_no=str_replace("'","",$txt_po_breack_down_id);
		
			$condition= new condition();
			if(str_replace("'","",$txt_job_no) !=''){
				  $condition->job_no("='$txt_job_no'");
			 }
			 
			  if(str_replace("'","",$txt_po_breack_down_id)!='')
			 {
				$condition->po_id_in("$po_no");
			 }
			 else
			 { //$all_po_ids
				 $condition->po_id_in("$all_po_ids");
			 }
			  $condition->init();
			//$yarn= new yarn($condition);

		
			$trims= new trims($condition);
			//echo $trims->getQuery(); die;
			$trims_costing_arr=$trims->getAmountArray_by_job();
			$emblishment= new emblishment($condition);
			$emblishment_costing_arr=$emblishment->getAmountArray_by_job();
			$wash= new wash($condition);
			//echo $wash->getQuery(); die;
			$emblishment_costing_arr_wash=$wash->getAmountArray_by_job();
		    $commercial= new commercial($condition);
			$commercial_costing_arr=$commercial->getAmountArray_by_job();
			$commission= new commision($condition);
			$commission_costing_arr=$commission->getAmountArray_by_job();
			$other= new other($condition);
			$other_costing_arr=$other->getAmountArray_by_job();

			$job_no=str_replace("'","",$txt_job_no);

			$price_dzn=0;
            $sl=0;
            foreach( $data_array as $row )
            {
			//$fab_production_knit=$fabric_costing_arr['knit']['grey'][$job_no];
			//$fab_production_finish=$fabric_costing_arr['finish']['grey'][$job_no];
			
			
			$fab_purchase_knit2=$knit_fabric_val;
			$fab_purchase_woven2=$wvn_fabric_val;

			$yarn_costing=$yarn_total_amount;
			$tot_fabric_cost=$fab_purchase_knit2+$fab_purchase_woven2;
			$conversion_cost=$conversion_costing;
			//$testing_cost=$other_costing_arr[$job_no]['lab_test'];
			$freight_cost=$other_costing_arr[$job_no]['freight'];
			$inspection_cost=$other_costing_arr[$job_no]['inspection'];
			$certificate_cost=$other_costing_arr[$job_no]['certificate_pre_cost'];
			$common_oh=$other_costing_arr[$job_no]['common_oh'];
			$currier_cost=$other_costing_arr[$job_no]['currier_pre_cost'];
			$cm_cost=$other_costing_arr[$job_no]['cm_cost'];
			$lab_test_cost=$other_costing_arr[$job_no]['lab_test'];
			$depr_amor_pre_cost=$other_costing_arr[$job_no]['depr_amor_pre_cost'];
			$deffdlc_cost=$other_costing_arr[$job_no]['deffdlc_cost'];
			$fabric_cost=$tot_fabric_cost;
			// $trims_cost=$trims_costing_arr[$job_no];
			$trims_cost=$tot_trims_cost;
			// $embel_cost=$emblishment_costing_arr[$job_no];
			$embel_cost=$total_embellishment_amt;
			$wash=$emblishment_costing_arr_wash[$job_no];
			$commercial_cost=$commercial_costing_arr[$job_no];
			$comm_cost=$row[csf("comm_cost")];
			$cm_cost_dzn=$row[csf("cm_cost")];
			$deffdlc_cost_dzn=$row[csf("deffdlc_cost")];
			$interest_cost=$row[csf("interest_cost")];
			$incometax_cost=$row[csf("incometax_cost")];
			//deffdlc_cost,deffdlc_percent,interest_cost,interest_percent,incometax_cost,incometax_percent
			$deffdlc_percent=$row[csf("deffdlc_percent")];
			$interest_percent=$row[csf("interest_percent")];
			$incometax_percent=$row[csf("incometax_percent")];
			$depr_amor_po_price=$row[csf("depr_amor_po_price")];
			$depr_amor_pre_cost_dzn=$row[csf("depr_amor_pre_cost")];
			//interest_cost,interest_percent,incometax_cost
			$commission=$commission_costing_arr[$job_no];
			$lab_test=$lab_test_cost;
			$inspection=$inspection_cost;
			$cm_cost=$cm_cost;
			$freight=$freight_cost;
			$currier_pre_cost=$currier_cost;
			$certificate_pre_cost=$certificate_cost;
			$common_oh=$common_oh;

			$all_total_cost=$tot_fabric_cost+$yarn_costing+$conversion_cost+$trims_cost+$embel_cost+$wash+$commercial_cost+$commission+$lab_test_cost+$cm_cost+$currier_pre_cost+$inspection_cost+$freight+$common_oh+$certificate_pre_cost+$depr_amor_pre_cost+$interest_cost+$incometax_cost+$deffdlc_cost;
				$sl=$sl+1;
  				$others_cost_value=$all_total_cost-$cm_cost-$freight-$commercial_cost-$commission;
				if($zero_value==1)
				{
				?>
                <tr>
                    <td><? echo $sl; ?></td>
                    <td align="left"><b>Order Value</b></td>
                    <td></td>
                    <td align="right"><b><? echo fn_number_format($tot_order_value,4);$price_dzn=$tot_order_value;//$avg_unit_price*$order_price_per_dzn ?></b></td>
                    <td align="center"><? echo "100.00%"; ?></td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>  
                    <td align="left">All Fabric Cost</td>
                    <td align="right"><? $tot_fab_cot=$fabric_cost;
					echo fn_number_format($tot_fabric_cost,2); ?></td>
                    <td align="right" rowspan="17">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($tot_fab_cot/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Trims Cost</td>
                    <td align="right"><?$trims_cost=$tot_trims_cost;
					echo fn_number_format($trims_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($trims_cost/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Embellishment Cost</td>
                    <td align="right"><? echo fn_number_format($embel_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($embel_cost/$tot_order_value)*100,2);//fn_number_format($row[csf("embel_cost_percent")],2); ?>%</td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Gmts Wash</td>
                    <td align="right"><? echo fn_number_format($wash,4); ?></td>
                    <td align="center"><? echo fn_number_format(($wash/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Commercial Cost</td>
                    <td align="right"><? echo fn_number_format($commercial_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($commercial_cost/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Commission Cost</td>
                    <td align="right"><? echo fn_number_format($commission,4); ?></td>
                    <td align="center"><? echo fn_number_format(($commission/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Depc. & Amort.</td>
                    <td align="right"><? echo fn_number_format($depr_amor_pre_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($depr_amor_pre_cost/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Lab Test</td>
                    <td align="right"><? echo fn_number_format($lab_test_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($lab_test_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Inspection Cost</td>
                    <td align="right"><? echo fn_number_format($inspection_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($inspection_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">CM Cost</td>
                    <td align="right"><? echo fn_number_format($cm_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($cm_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Freight Cost</td>
                    <td align="right"><? echo fn_number_format($freight,4); ?></td>
                    <td align="center"><? echo fn_number_format(($freight/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                 <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Currier Cost</td>
                    <td align="right"><? echo fn_number_format($currier_pre_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($currier_pre_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                  <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Certificate Cost</td>
                    <td align="right"><? echo fn_number_format($certificate_pre_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($certificate_pre_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Deffd. LC Cost</td>
                    <td align="right"><? echo fn_number_format($deffdlc_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format(($deffdlc_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                  <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Interest </td>
                    <td align="right"><? echo fn_number_format($row[csf("interest_cost")],4); ?></td>
                    <td align="center"><? echo fn_number_format(($row[csf("interest_cost")]/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                  <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Income Tax</td>
                    <td align="right"><? echo fn_number_format($row[csf("incometax_cost")],4); ?></td>
                    <td align="center"><? echo fn_number_format(($row[csf("incometax_cost")]/$tot_order_value)*100,2); ?>%</td>
                 </tr>

                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Office OH </td>
                    <td align="right"><? echo fn_number_format($common_oh,4); ?></td>
                    <td align="center"><? echo fn_number_format(($common_oh/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left"><b>Total Cost (2:18)</b></td>
                    <td>&nbsp;</td>
                    <td align="right"><b><? echo fn_number_format($all_total_cost,4); ?></b></td>
                    <td align="center"><b><? echo fn_number_format(($all_total_cost/$tot_order_value)*100,2); ?>%</b></td>
                 </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Margin/<? echo $costing_for; ?> (1-19)</td>
                    <td>&nbsp;</td>
                    <td align="right"><? $tot_mergin=$tot_order_value-$all_total_cost;echo fn_number_format(($tot_mergin/$order_qty)*12,2);
					  //echo '=========='.$tot_order_value.'-'.$all_total_cost.'/'.$order_job_qnty;
					$marging_dzn=($tot_mergin/$order_qty)*12;
					  ?></td>
                    <td align="center"><b><? $margin_dzn_percent=($tot_mergin/$tot_order_value)*100;
					 echo fn_number_format($margin_dzn_percent,2); ?>%</b></td>
                </tr>

                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Price / <? echo $unit_of_measurement[$uom];?></td>
                    <td>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($row[csf("price_pcs_or_set")],4); ?></td>
                    <td align="right"></td>
                </tr>
                 <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Cost /<? echo $unit_of_measurement[$uom];?></td>
                    <td>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($all_total_cost/$order_job_qnty,4); ?></td>
                    <td align="center"></td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Margin/<? echo $unit_of_measurement[$uom];?></td>
                    <td>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($marging_dzn/12,2); ?></td>
                    <td align="right"></td>
                </tr>
            	<?
				}
				else
				{
					?>
                 <tr>
                    <td><? echo $sl; ?></td>
                    <td align="left"><b>Order Value</b></td>
                    <td></td>
                    <td align="right"><b><? echo fn_number_format($tot_order_value,4); $price_dzn=$tot_order_value;//$avg_unit_price*$order_price_per_dzn ?></b></td>
                    <td align="center"><? echo "100.00%"; ?></td>
                </tr>
                <?
				if($row[csf("fabric_cost")]!=0)
				{ 
				?>
                <tr>
                	<td><? echo ++$sl; ?></td>
                    <td align="left">All Fabric Cost</td>
                    <td align="right"><? $tot_fab_cot=$fabric_cost+$yarn_total_amount+$conversion_costing;				
					echo fn_number_format($tot_fab_cot=$fabric_cost+$yarn_total_amount+$conversion_costing,2); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($tot_fab_cot/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <?
				}
				if($row[csf("trims_cost")]!=0)
				{
				?>

                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Trims Cost</td>
                    <td align="right"><? echo fn_number_format($trims_cost,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($trims_cost/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <?
				}
				if($row[csf("embel_cost")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Embellishment Cost</td>
                    <td align="right"><? echo fn_number_format($embel_cost,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($embel_cost/$tot_order_value)*100,2);//fn_number_format($row[csf("embel_cost_percent")],2); ?>%</td>
                </tr>
                <?
				}
				if($row[csf("wash_cost")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Gmts Wash</td>
                    <td align="right"><? echo fn_number_format($wash,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($wash/$tot_order_value)*100,2); ?>%</td>
                </tr>

                <?
				}
				if($row[csf("comm_cost")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Commercial Cost</td>
                    <td align="right"><? echo fn_number_format($commercial_cost,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($commercial_cost/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <?
				}
				if($row[csf("commission")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Commission Cost</td>
                    <td align="right"><? echo fn_number_format($commission,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($commission/$tot_order_value)*100,2); ?>%</td>
                </tr>
                <?
				}
				if($row[csf("lab_test")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Lab Test</td>
                    <td align="right"><? echo fn_number_format($lab_test_cost,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($lab_test_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                <?
				}
				if($row[csf("inspection")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Inspection Cost</td>
                    <td align="right"><? echo fn_number_format($inspection_cost,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($inspection_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                 <?
				}
				if($row[csf("cm_cost")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">CM Cost</td>
                    <td align="right"><? echo fn_number_format($cm_cost,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($cm_cost/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                 <?
				}
				if($row[csf("freight")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Freight Cost</td>
                    <td align="right"><? echo fn_number_format($freight,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($freight/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                <?
				}
				if($row[csf("common_oh")]!=0)
				{
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Office OH </td>
                    <td align="right"><? echo fn_number_format($common_oh,4); ?></td>
                    <td align="right">&nbsp;</td>
                    <td align="center"><? echo fn_number_format(($common_oh/$tot_order_value)*100,2); ?>%</td>
                 </tr>
                 <?
				}
				?>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left"><b>Total Cost (2:<?=$sl-1;?>)</b></td>
                    <td>&nbsp;</td>
                    <td align="right"><b><? echo fn_number_format($all_total_cost,4); ?></b></td>
                    <td align="center"><b><? echo fn_number_format(($all_total_cost/$tot_order_value)*100,2); ?>%</b></td>
                 </tr>
                <tr>
                    <td><?= ++$sl; ?></td>
                    <td align="left">Margin/<? echo $costing_for; ?> (1-<? echo $sl-1;?>)</td>
                    <td>&nbsp;</td>
                    <td align="right"><? $tot_mergin=$tot_order_value-$all_total_cost;echo fn_number_format($tot_mergin/12,2);	 
					$marging_dzn=($tot_mergin/$order_qty)*12;
					  ?></td>
                    <td align="center"><b><? $margin_dzn_percent=($tot_mergin/$tot_order_value)*100;
					 echo fn_number_format($margin_dzn_percent,2); ?>%</b></td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Price / <? echo $unit_of_measurement[$uom];?></td>
                    <td>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($row[csf("price_pcs_or_set")],4); ?></td>
                    <td align="right"></td>
                </tr>
                 <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Cost /<? echo $unit_of_measurement[$uom];?></td>
                    <td>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($all_total_cost/$order_job_qnty,4); ?></td>
                    <td align="center"></td>
                </tr>
                <tr>
                    <td><? echo ++$sl; ?></td>
                    <td align="left">Margin/<? echo $unit_of_measurement[$uom];?></td>
                    <td>&nbsp;</td>
                    <td align="right"><? echo fn_number_format($marging_dzn/12,2); ?></td>
                    <td align="right"></td>
                </tr>
                    <?
				}
            }
            ?>
            </table>
      </div>
      <?
	  	$exchange_rate=return_field_value("a.exchange_rate", "wo_pre_cost_mst a, wo_po_break_down b", "a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.id in ($all_po_id)","exchange_rate");
		$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=2", "id", "product_name_details");
	//End all summary report here -------------------------------------------

	//End all summary report here -------------------------------------------

	//2 Fabric Cost part here-------------------------------------------
		//  $sql = "select id, job_no,item_number_id,uom,body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$txt_job_no."' and status_active=1 and is_deleted=0";

		
			// echo $sql;
		
		$data_array=sql_select($all_fabric_cost_sql);

		$po_cond2="";$po_cond="";
		if($all_po_id!="")
		{
			$po_cond="and po_break_down_id in($all_po_id)";
			$po_cond2="and b.id in($all_po_id)";
		}
		//echo $po_cond.'CCCXXXXXXXXXXX';die;
		$item_set=sql_select("select set_item_ratio,gmts_item_id,job_no from wo_po_details_mas_set_details where job_no='".$txt_job_no."'") ;
		foreach( $item_set as $row )
        {
			 $set_item_ratio_arr[$row[csf("job_no")]][$row[csf("gmts_item_id")]]=$row[csf("set_item_ratio")];
		}

		$knit_fab=""; $woven_fab=""; $knit_subtotal_amount=0; $woven_subtotal_amount=0; $knit_subtotal_amount_dzn=0; $knit_subtotal_amount_kg=0; $woven_subtotal_amount_dzn=0; $woven_subtotal_amount_kg=0;
        $i=2;$j=2;
		foreach( $data_array as $row )
        {
			$knit_cost_dzn=$row[csf("amount")];$woven_cost_dzn=$row[csf("amount")];

			if($row[csf("fab_nature_id")]==2)//knit fabrics
			{
				// $item_descrition = $body_part[$row[csf("body_part_id")]].", ".$color_type[$row[csf("color_type_id")]].", ".$row[csf("fabric_description")];
				 $fincons=$finish_fab_arr[$row[csf("order_id")]][$row[csf("body_part_id")]];
			     $greycons=$gray_fab_arr[$row[csf("order_id")]][$row[csf("body_part_id")]];
				// $row[csf("amount")]=$fabric_amount_arr['knit']['grey'][$row[csf("id")]][$row[csf("uom")]];
				$comp=$row[csf('fabric_description')];;
 				$i++;
                $knit_fab .= '<tr>
                    <td align="left">'.$comp.'</td>
                    <td align="left">'.$fabric_source[$row[csf("fabric_source")]].'</td>
                    <td align="right">'.fn_number_format($greycons,4).'</td>
 					<td align="right">'.fn_number_format($fincons,4).'</td>
                    <td align="right">'.fn_number_format($row[csf("rate")],4).'</td>
                    <td align="right">'.fn_number_format($row[csf("amount")],4).'</td>
                </tr>';
				$knit_subtotal_avg_cons+=$greycons;
				$knit_subtotal_avg_finish_cons+=$fincons;
            	$knit_subtotal_amount+=$row[csf("amount")];
				$knit_subtotal_amount_dzn+=$knit_cost_dzn;
				if($knit_subtotal_amount_dzn>0){
					$knit_subtotal_amount_kg=$knit_subtotal_amount/$knit_subtotal_avg_cons;
				}
				else{
					$knit_subtotal_amount_kg=0;
				}
			}
			if($row[csf("fab_nature_id")]==3)//woven fabrics
			{
				$item_descrition = $body_part[$row[csf("body_part_id")]].", ".$color_type[$row[csf("color_type_id")]].", ".$row[csf("fabric_description")];
				$fincons=$finish_fab_arr[$row[csf("order_id")]][$row[csf("body_part_id")]];
				$greycons=$gray_fab_arr[$row[csf("order_id")]][$row[csf("body_part_id")]];
				$row[csf("amount")]=$fincons*$row[csf("rate")];;
				
				$j++;
                 $woven_fab .= '<tr>
                    <td align="left">'.$item_descrition.'</td>
                    <td align="left">'.$fabric_source[$row[csf("fabric_source")]].'</td>
                    <td align="right">'.fn_number_format($greycons,4).'</td>
 					<td align="right">'.fn_number_format($fincons,4).'</td>
                    <td align="right">'.fn_number_format($row[csf("rate")],4).'</td>
                    <td align="right">'.fn_number_format($row[csf("amount")],4).'</td>
                </tr>';
				$woven_subtotal_avg_cons+=$greycons;
				$woven_subtotal_avg_finish_cons+=$fincons;
				$woven_subtotal_amount+=$row[csf("amount")];
				$woven_subtotal_amount_dzn+=$woven_cost_dzn;				

				$woven_subtotal_amount_kg=$woven_subtotal_amount/$woven_subtotal_amount_dzn;
			}
        }
	
		$knit_fab= '<div style="margin-top:15px">
				<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
						<tr style="font-weight:bold"  align="center">
							<td width="80" rowspan="'.$i.'" ><div class="verticalText"><b>Knit Fabric</b></div></td>
							<td width="300">Description</td>
							<td width="100">Source</td>
							<td width="100">Gray Fabric Qnty</td>
							<td width="100">Finish Fab Qnty</td>
 							<td width="50">Rate</td>
							<td width="50">Amount</td>
						</tr>'.$knit_fab;
		$woven_fab = '<tr><td colspan="7">&nbsp;</td></tr><tr>
						<td width="80" rowspan="'.$j.'"><div class="verticalText"><b>Woven Fabric</b></div></td></tr>'.$woven_fab;

		//knit fabrics table here
		$knit_fab .='<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2">Total</td>
						<td align="right">'.fn_number_format($knit_subtotal_avg_cons,4).'</td>
						<td align="right">'.fn_number_format($knit_subtotal_avg_finish_cons,4).'</td>
						<td align="right"></td>
						<td align="right">'.fn_number_format($knit_subtotal_amount,4).'</td>
					</tr>';
  		echo $knit_fab;

		//woven fabrics table here
		$woven_fab .='<tr class="rpt_bottom" style="font-weight:bold">
						<td colspan="2">Total</td>
						<td align="right">'.fn_number_format($woven_subtotal_avg_cons,4).'</td>
						<td align="right">'.fn_number_format($woven_subtotal_avg_finish_cons,4).'</td>
						<td align="right"></td>
						<td align="right">'.fn_number_format($woven_subtotal_amount,4).'</td>
					</tr>
   					</table></div>';
        echo $woven_fab;

			//======================yarn cost =================================		
		$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count"  );

				//oracle
				//  $sql = "select id, job_no,job_no_id, product_id, count, yarn_description, entry_form, yarn_comp_type1st, yarn_comp_percent1st, yarn_type, yarn_color, yarn_wo_qty from wo_yarn_dyeing_dtls where job_no='".$txt_job_no."' and status_active=1 and is_deleted=0";
				$exchange_rate=return_field_value("a.exchange_rate", "wo_pre_cost_mst a, wo_po_break_down b", "a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0 and b.id in ($all_po_id)","exchange_rate");

		        $data_array=sql_select($yarn_sql);

		?>
        <div style="margin-top:15px">
        	<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
                    <td width="70" rowspan="<? echo count($data_array)+2; ?>"><div class="verticalText"><b>Yarn Cost</b></div></td>
                    <td width="350">Yarn Desc</td>
                    <td width="100">Yarn Qnty</td>
                    <td width="100">Avg.Yarn Qnty</td>
                    <td width="100">Rate</td>
                    <td width="100">Amount</td>
                </tr>
			<?
			$total_yarn_qty = 0;
            $total_yarn_amount = 0; $total_yarn_cost_dzn=0; $total_yarn_cost_kg=0; $total_yarn_avg_cons_qty=0;
			foreach( $data_array as $row )
            {
				if ($i % 2 == 0) $bgcolor = "#E9F3FF"; else $bgcolor = "#FFFFFF";

					
			?>
                <tr>
                    <td align="left"><? echo $row[csf("product_name_details")]; ?></td>
                    <td align="right"><? echo fn_number_format($row[csf("issue_qnty")]-$yarn_return_qty[$row[csf('prod_id')]][$row[csf('trans_id')]],4); ?></td>
                    <td align="right"><? echo fn_number_format($row[csf("issue_qnty")]-$yarn_return_qty[$row[csf('prod_id')]][$row[csf('trans_id')]],4); ?></td>
                    <td align="right"><?
					
								if($receive_array[$row[csf('prod_id')]]>0)
								{
									$avg_rate=$receive_array[$row[csf('prod_id')]];
								}
								else
								{
									$avg_rate=$row[csf('avg_rate_per_unit')]/$exchange_rate;
								}
								echo fn_number_format($avg_rate,0); 
								$rowamount=($row[csf("issue_qnty")]-$yarn_return_qty[$row[csf('prod_id')]][$row[csf('trans_id')]])*fn_number_format($avg_rate,0);

				    ?>&nbsp;
				 </td>
                    <td align="right"><? echo fn_number_format($rowamount,4); ?></td>
                </tr>
            <?
			      $total_yarn_qty+=$row[csf("issue_qnty")]-$yarn_return_qty[$row[csf('prod_id')]][$row[csf('trans_id')]];
				  $total_avg_yarn_qty+=$row[csf("issue_qnty")]-$yarn_return_qty[$row[csf('prod_id')]][$row[csf('trans_id')]];
				  $total_yarn_amount +=$rowamount;
				  $total_yarn_cost_dzn+=$rowamount/12;
				  $total_yarn_avg_cons_qty+=$rowavgcons_qnty;
				  $total_yarn_cost_kg=$total_yarn_amount/$total_yarn_qty;
            }
            ?>
            	<tr class="rpt_bottom" style="font-weight:bold">
                    <td>Total</td>
                    <td align="right"><? echo fn_number_format($total_yarn_qty,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_avg_yarn_qty,4); ?></td>
                    <td></td>
                    <td align="right"><? echo fn_number_format($total_yarn_amount,4); ?></td>
                </tr>
        	</table>
      </div>
      <?

	//End Yarn Cost part report here -------------------------------------------

	//start	Conversion Cost to Fabric report here -------------------------------------------
			$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=13", "id", "product_name_details");

		

			$data_array=sql_select($converson_fab_cost_sql);
			$data_array1=sql_select($converson_fab_dye_cost_sql);
 	?>
         <div style="margin-top:15px">
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
                <tr style="font-weight:bold">
                    <td width="80" rowspan="<? echo count($data_array)+3+count($data_array1); ?>"><div class="verticalText"><b>Conversion Cost to Fabric</b></div></td>
                    <td width="350">Particulars</td>
                    <td width="100">Process</td>
                    <td width="100">Required</td>
                    <td width="100">Avg.Required</td>
                    <td width="100">Rate</td>
                    <td width="100">Amount</td>
                </tr>
            <?
	
			
            $total_conversion_cost=0;$total_conversion_cost_dzn=0;$total_conversion_cost_kg=0;
			$total_convsion_qty=0;
			$total_avg_convsion_qty=0;$grand_total_conv_qnty=0;$grand_total_avg_convsion_qty=0;$grand_total_conversion_cost=0;
			$process_array_check=array();$k=1;
            foreach( $data_array as $row )
            {
				$rate=fn_number_format($row[csf('rate')]/$exchange_rate,2);
		    	?>
                <tr>
                    <td align="left"><? echo  $product_array[$row[csf('item_id')]];; ?></td>
                    <td align="left"><? echo "Knitting"; ?></td>
                    <td align="right"><? echo fn_number_format($row[csf('receive_qty')],2); ?></td>
                    <td align="right"><? echo fn_number_format($row[csf('receive_qty')],2); ?></td>
                    <td align="right"><?  echo $rate; ?></td>
                    <td align="right"><?  echo fn_number_format($row[csf('receive_qty')]*$rate,2); ?></td>
                </tr>
				<?
				$total_conversion_cost+=fn_number_format($row[csf('receive_qty')]*$rate,2);
				$total_convsion_qty+=$row[csf('receive_qty')];
				$total_avg_convsion_qty+=$row[csf('receive_qty')];
			}?>
				<tr>
					<td>&nbsp;</td>
					<td><strong>Sub. Total : </strong></td>
					<td align="right"><strong><? echo fn_number_format($total_convsion_qty,4); ?></strong></td>
					<td align="right"><strong><? echo fn_number_format($total_avg_convsion_qty,4); ?></strong></td>
					<td>&nbsp;</td>
					<td align="right"><strong><? echo fn_number_format($total_conversion_cost,4); ?></strong></td>
				</tr>
			<?
			$product_array=return_library_array( "select id, product_name_details from product_details_master where item_category_id=2", "id", "product_name_details");
				if(count($data_array1)>0){
					foreach( $data_array1 as $row )
                	 {
							// unset($total_convsion_qty);
							$rate1=fn_number_format($row[csf('rate')]/$exchange_rate,2);
		    			?>
					<tr>
						<td align="left"><? echo  $product_array[$row[csf('item_id')]];; ?></td>
						<td align="left"><?  echo "Fabric Dyeing";; ?></td>
						<td align="right"><? echo fn_number_format($row[csf('receive_qty')],2); ?></td>
						<td align="right"><? echo fn_number_format($row[csf('receive_qty')],2); ?></td>
						<td align="right"><?  echo $rate1; ?></td>
						<td align="right"><?  echo fn_number_format($row[csf('receive_qty')]*$rate1,2); ?></td>
					</tr>
						<?
						$total_fab_dye_conversion_cost +=$row[csf('receive_qty')]*$rate1;
						$total_fab_dye_convsion_qty+=$row[csf('receive_qty')];
						$total_fab_dye_avg_convsion_qty+=$row[csf('receive_qty')];
			   		 }?>
					<tr>
						<td>&nbsp;</td>
						<td><strong>Sub. Total : </strong></td>
						<td align="right"><strong><? echo fn_number_format($total_fab_dye_convsion_qty,4); ?></strong></td>
						<td align="right"><strong><? echo fn_number_format($total_fab_dye_avg_convsion_qty,4); ?></strong></td>
						<td>&nbsp;</td>
						<td align="right"><strong><? echo fn_number_format($total_fab_dye_conversion_cost,4); ?></strong></td>
					</tr>
			
           			<?
	
				}$total_conversionCost=$total_conversion_cost+$total_fab_dye_conversion_cost;
				if($total_avg_yarn_qty>0){
					$total_conversion_cost_kg=$total_conversionCost/$total_avg_yarn_qty;
				}
				else{
					$total_conversion_cost_kg =0;
				}
				
				?>

				<tr>
					<td>&nbsp;</td>
					<td>&nbsp;</td>
					<td><strong>Grand Total: </strong></td>
					<td align="right"><strong><? echo fn_number_format($total_convsion_qty+$total_fab_dye_convsion_qty,4); ?></strong></td>
					<td align="right"><strong><? echo fn_number_format($total_avg_convsion_qty+$total_fab_dye_avg_convsion_qty,4); ?></strong></td>
					<td>&nbsp;</td>
					<td align="right"><strong><? echo fn_number_format($total_conversion_cost+$total_fab_dye_conversion_cost,4); ?></strong></td>
				</tr>
            </table>
      </div>
      <?
	//End Conversion Cost to Fabric report here -------------------------------------------



	//start	Trims Cost part report here -------------------------------------------

    	
	

		

		// echo  $sql;

		$data_array=sql_select($trims_sql);
 	?>
        <div style="margin-top:15px">
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
            <label><b>Trims Cost</b></label>
                <tr style="font-weight:bold">
                    <td width="150">Item Group</td>
                    <td width="150">Description</td>
                    <td width="150">Brand/Supp Ref</td>
                    <td width="100">UOM</td>
                    <td width="100">Consumption</td>
                    <td width="100">Rate</td>
                    <td width="100">Amount</td>
                </tr>
            <?
			$trim_qty_arr=$trims->getQtyArray_by_precostdtlsid();
			//print_r($trim_qty);
			$trim_amount_arr=$trims->getAmountArray_precostdtlsid();
			
            $total_trims_cost=0;  $total_trims_qty=0;$total_trims_cost_dzn=0;$total_trims_cost_kg=0;
			$trim_group=return_library_array( "select item_name,id from  lib_item_group ", "id", "item_name" );
            foreach( $data_array as $row ){
				
				$row[csf("cons_dzn_gmts")]=$trim_qty_arr[$row[csf("id")]];
				// $row[csf("amount")]=$trim_amount_arr[$row[csf("id")]];
				
				
			?>
                <tr>
                    <td align="left"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
                    <td align="left"><? echo $row[csf("fabric_description")]; ?></td>
                    <td align="left"><? echo $row[csf("brand_supplier")]; ?></td>
                    <td align="left"><? echo $unit_of_measurement[$row[csf("uom")]]; ?></td>
                    <td align="right"><? echo fn_number_format($row[csf("cu_woq")],4); ?></td>
                    <td align="right"><? echo fn_number_format($row[csf("amount")]/$row[csf("cu_woq")],4); ?></td>
                    <td align="right"><? echo fn_number_format($row[csf("amount")],4); ?></td>
                </tr>
            <?
                 $total_trims_cost += $row[csf("amount")];
				 $total_trims_qty += $row[csf("cons_dzn_gmts")];
            }
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td colspan="6">Total</td>
                    <td align="right"><? echo fn_number_format($total_trims_cost,4); ?></td>
                </tr>
            </table>
      </div>
      <?
	 //End Trims Cost Part report here -------------------------------------------



	 //start	Embellishment Details part report here -------------------------------------------
		

	// echo $sql;

		$data_array=sql_select($embl_sql);
	?>
        <div style="margin-top:15px">
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
            <label><b>Embellishment Details</b></label>
                <tr style="font-weight:bold">
                    <td width="150">Particulars</td>
                    <td width="150">Type</td>
                    <td width="150">Gmts. Qnty (Dzn)</td>
                    <td width="100">Rate</td>
                    <td width="100">Amount</td>
                 </tr>
            <?
	
	
            $total_embellishment_amt=0;$total_embellishment_amt_dzn=0;
            foreach( $data_array as $row )
            {
				$em_type ="";
				$total_embellishment_amt_dzn += $row[csf("amount")];
				//$emblishment_name_array=array(1=>"Printing",2=>"Embroidery",3=>"Wash",4=>"Special Works",5=>"Others");
				if($row[csf('embel_name')]==1) $embel_type=' & '.$emblishment_print_type[$row[csf('embel_type')]];
				elseif($row[csf('embel_name')]==2) $embel_type=' & '.$emblishment_embroy_type[$row[csf('embel_type')]];
				elseif($row[csf('embel_name')]==3) $embel_type=' & '.$emblishment_wash_type[$row[csf('embel_type')]];	
				elseif($row[csf('embel_name')]==4) $embel_type=' & '.$emblishment_spwork_type[$row[csf('embel_type')]];
				else $embel_type='';
				
				
				$rate=fn_number_format($row[csf("rate")]/$exchange_rate,4);
				
			?>
                <tr>
                    <td align="left"><? echo $garments_item[$row[csf('item_number_id')]]; ?></td>
                    <td align="left"><? echo $emblishment_name_array[$row[csf('embel_name')]]; ?></td>
                    <td align="right"><? echo fn_number_format($row[csf('production_quantity')]/12,2); ?></td>
                    <td align="right"><? echo $rate; ?></td>
                    <td align="right"><? echo fn_number_format(($row[csf('production_quantity')]/12)*$rate,4); ?></td>
                </tr>
            <?
                 $total_embellishment_amt +=($row[csf('production_quantity')]/12)*$rate;
            }
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td colspan="4">Total</td>
                    <td align="right"><? echo fn_number_format($total_embellishment_amt,4); ?></td>
                </tr>
            </table>
      </div>
      <?
	 //End Embellishment Details Part report here -------------------------------------------

	 $fabriccostDataArray=sql_select("select job_no, costing_per_id, embel_cost, wash_cost, cm_cost, commission, currier_pre_cost, lab_test, inspection, freight, comm_cost from wo_pre_cost_dtls where status_active=1 and is_deleted=0 and job_no='".$txt_job_no."'");
	 //echo "select job_no, costing_per_id, embel_cost, wash_cost, cm_cost, commission, currier_pre_cost, lab_test, inspection, freight, comm_cost from wo_pre_cost_dtls where status_active=1 and is_deleted=0 $jobCond"; die;
	 foreach($fabriccostDataArray as $fabRow)
	 {
		  $fabriccostArray[$fabRow[csf('job_no')]]['costing_per_id']=$fabRow[csf('costing_per_id')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['embel_cost']=$fabRow[csf('embel_cost')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['wash_cost']=$fabRow[csf('wash_cost')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['cm_cost']=$fabRow[csf('cm_cost')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['commission']=$fabRow[csf('commission')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['currier_pre_cost']=$fabRow[csf('currier_pre_cost')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['lab_test']=$fabRow[csf('lab_test')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['inspection']=$fabRow[csf('inspection')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['freight']=$fabRow[csf('freight')];
		  $fabriccostArray[$fabRow[csf('job_no')]]['comm_cost']=$fabRow[csf('comm_cost')];
	 }
	  unset($fabriccostDataArray);

	 //start	Commercial Cost part report here -------------------------------------------
   	$sql = "select id, job_no, item_id, rate, amount, status_active
			from  wo_pre_cost_comarci_cost_dtls
			where job_no='".$txt_job_no."' and status_active=1 and is_deleted=0";
	$data_array=sql_select($sql);
	?>

        <div style="margin-top:15px">
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
            <label><b>Commercial Cost</b></label>
                <tr style="font-weight:bold">
                    <td width="150">Particulars</td>
                    <td width="100">Rate</td>
                    <td width="100">Amount</td>
                 </tr>
            <?
			$commercial= new commercial($condition);
			$commarcial_amount_arr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
			
            $total_commercial_cost=0;$total_commercial_cost_dzn=0;

			$commission_cost_actual=($ex_factory_qty/$dzn_qnty)*$fabriccostArray[$row[csf('job_no')]]['commission'];
            foreach( $data_array as $row )
            {
				$total_commercial_cost_dzn+= $row[csf("amount")];

				$amount =$commarcial_amount_arr[$row[csf("job_no")]][$row[csf("id")]];
  			?>
                <tr>
                    <td align="left"><? echo $camarcial_items[$row[csf("item_id")]]; ?></td>
                    <td align="right"><? echo fn_number_format($row[csf("rate")],4); ?></td>
                    <td align="right"><? echo fn_number_format($amount,4); ?></td>
                </tr>
            <?
                 $total_commercial_cost += $amount;

            }
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td colspan="2">Total</td>
                    <td align="right"><? echo fn_number_format($total_commercial_cost,4); ?></td>
                </tr>
            </table>
      </div>
      <?
	 //End Commercial Cost Part report here -------------------------------------------


  	//start	Commission Cost part report here -------------------------------------------
   	$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$txt_job_no."'";
	$data_array=sql_select($sql);
	?>
        <div style="margin-top:15px">
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:850px;text-align:center;" rules="all">
            <label><b>Commission Cost</b></label>
                <tr style="font-weight:bold">
                    <td width="150">Particulars</td>
                    <td width="150">Commission Basis</td>
                    <td width="100">Rate</td>
                    <td width="100">Amount</td>
                 </tr>
            <?
			$commission= new commision($condition);
			$commission_amount_arr=$commission->getAmountArray_by_jobAndPrecostdtlsid();
			//print_r($commission_amount_arr);
            $total_commission_cost=0;   $total_commission_cost_dzn=0;
            foreach( $data_array as $row )
            {
				$commission_amount=$commission_amount_arr[$row[csf("job_no")]][$row[csf("id")]];// $row[csf("commission_amount")]/$order_price_per_dzn*$ord_qty;
  			?>
                <tr>
                    <td align="left"><? echo $commission_particulars[$row[csf("particulars_id")]]; ?></td>
                    <td align="left"><? echo $commission_base_array[$row[csf("commission_base_id")]]; ?></td>
                    <td align="right"><? echo fn_number_format($row[csf("commision_rate")],4); ?></td>
                    <td align="right"><? echo fn_number_format($commission_amount,4); ?></td>
                </tr>
            <?
                 $total_commission_cost += $commission_amount;
				 $total_commission_cost_dzn+=$row[csf("commission_amount")];
            }
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td colspan="3">Total</td>
                    <td align="right"><? echo fn_number_format($total_commission_cost,4); ?></td>
                </tr>
            </table>
      </div>
      <?
	//End Commission Cost Part report here -------------------------------------------


	//start	Other Components part report here -------------------------------------------
   	$sql = "select id,job_no,costing_per_id,order_uom_id,fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,currier_pre_cost, currier_percent, 	certificate_pre_cost, certificate_percent, total_cost, total_cost_percent, price_dzn, price_dzn_percent, margin_dzn, margin_dzn_percent, price_pcs_or_set, price_pcs_or_set_percent, margin_pcs_set,margin_pcs_set_percent,cm_for_sipment_sche  from wo_pre_cost_dtls where job_no='".$txt_job_no."' and status_active=1 and is_deleted=0";
	$data_array=sql_select($sql);
	?>

        <div style="margin-top:15px">
         <table>
         <tr>
         <td>
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:450px;text-align:center;" rules="all">
            <label><b>Others Components</b></label>
                <tr style="font-weight:bold">
                    <td width="150">Particulars</td>
                    <td width="100">Amount</td>
                 </tr>
            <?
            $total_other_components=0;$lab_test_dzn=0;
			$lab_test = 0;
			$inspection = 0;
			$cm_cost = 0;
			$freight = 0;
			$common_oh = 0;
           foreach( $data_array as $row )
           {
				$lab_test = $lab_test_cost;
				$inspection = $inspection_cost;
				$cm_cost=$other_costing_arr[$row[csf("job_no")]]['cm_cost'];
				$freight = $freight_cost;
				$common_oh = $common_oh;
				$currier_pre_cost = $currier_cost;
				$certificate_pre_cost = $certificate_cost;
				$lab_test_dzn=$row[csf("lab_test")];
				$inspection_dzn=$row[csf("inspection")];
				$cm_cost_dzn =$row[csf("cm_cost")];
				$common_oh_dzn =$row[csf("common_oh")];
				$freight_dzn =$row[csf("freight")];
				$currier_pre_cost_dzn = $row[csf("currier_pre_cost")];
				$certificate_pre_cost_dzn = $row[csf("certificate_pre_cost")];
				$total_trims_cost_dzn = $row[csf("trims_cost")];


   			?>
                <tr>
                    <td align="left"s>Lab Test </td>
                    <td align="right"><? echo fn_number_format($lab_test,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Inspection Cost</td>
                    <td align="right"><? echo fn_number_format($inspection,4); ?></td>
                </tr>
                <tr>
                    <td align="left">CM Cost - IE</td>
                    <td align="right"><? echo fn_number_format($cm_cost,4); ?></td>
                </tr>

                <tr>
                    <td align="left">Depc. & Amort.</td>
                    <td align="right"><? echo fn_number_format($depr_amor_pre_cost,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Freight Cost</td>
                    <td align="right"><? echo fn_number_format($freight,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Currier Cost </td>
                    <td align="right"><? echo fn_number_format($currier_pre_cost,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Certificate Cost </td>
                    <td align="right"><? echo fn_number_format($certificate_pre_cost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Deffd. LC Cost </td>
                    <td align="right"><? echo fn_number_format($deffdlc_cost,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Interest </td>
                    <td align="right"><? echo fn_number_format($interest_cost,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Income Tax </td>
                    <td align="right"><? echo fn_number_format($incometax_cost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Office OH</td>
                    <td align="right"><? echo fn_number_format($common_oh,4); ?></td>
                </tr>
            <?
                 $total_other_components += $lab_test+$inspection+$cm_cost+$freight+$currier_pre_cost+$certificate_pre_cost+$common_oh+$depr_amor_pre_cost+$deffdlc_cost+$incometax_cost+$interest_cost;
           }
            ?>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td>Total</td>
                    <td align="right"><? echo fn_number_format($total_other_components,4); ?></td>
                </tr>
            </table>
            </td>
            <td valign="top" rowspan="2">

            <?
     	 // image show here  -------------------------------------------
		 $sql = "select id,master_tble_id,image_location
				from common_photo_library
				where master_tble_id='$txt_job_no' limit 1";

		$data_array=sql_select($sql);
 	  ?>
          <div style="margin:15px 5px;float:right;width:500px" >
          	<? foreach($data_array AS $inf){ ?>
                <img  src='../../<? echo $inf[csf("image_location")]; ?>' height='400' width='300' />
            <?  } ?>
          </div>
          </td>
          </tr>
          <tr>
          <td>
			<?
            $total_summary_amount = 0;
            $total_summary_amount = $total_commission_cost+$total_commercial_cost+$total_embellishment_amt+$total_trims_cost+$total_conversionCost+$total_yarn_amount +$woven_subtotal_amount+$knit_subtotal_amount+$lab_test+$inspection+$cm_cost+$freight+$currier_pre_cost+$certificate_pre_cost+$common_oh+$depr_amor_pre_cost+$deffdlc_cost+$interest_cost+$interest_cost;

			$total_conversion_cost_dzn=$total_conversionCost/12;
            ?>
	 <div style="margin-top:15px">
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:500px;text-align:center" rules="all">
            <label><b>Summary</b></label>
                <tr style="font-weight:bold">
                    <td width="150">Cost Summary</td>
                    <td width="100">Cost/DZN</td>
                    <td width="100">Cost/Kg</td>
                    <td width="100">Total</td>
                 </tr>
                 <tr>
                    <td align="left">Knit Fabric (Purchase) </td>
                    <td align="right"><? echo fn_number_format($knit_subtotal_amount_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($knit_subtotal_amount_kg,4); ?></td>
                    <td align="right"><? echo fn_number_format($knit_subtotal_amount,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Woven Fabric (Purchase)</td>
                    <td align="right"><? echo fn_number_format($woven_subtotal_amount_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($woven_subtotal_amount_kg,4); ?></td>
                    <td align="right"><? echo fn_number_format($woven_subtotal_amount,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Yarn</td>
                    <td align="right"><? $total_yarn_cost_dzn=$total_yarn_amount/($exfact_qty/12);echo fn_number_format($total_yarn_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_yarn_cost_kg,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_yarn_amount,4); ?></td>
                </tr>
                <tr> 
                    <td align="left">Conversion to Fabric</td>
                    <td align="right"><?$total_conversion_cost_dzn=$total_conversionCost/($exfact_qty/12); echo fn_number_format($total_conversion_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_conversion_cost_kg,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_conversionCost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Trims</td>
                    <td align="right"><? echo fn_number_format($total_trims_cost_dzn,4); ?></td>
                    <td align="right" rowspan="15"><? //echo fn_number_format($total_trims_cost_kg,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_trims_cost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Embellishment</td>
                    <td align="right"><? echo fn_number_format($total_embellishment_amt,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_embellishment_amt,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Commercial</td>
                    <td align="right"><? echo fn_number_format($total_commercial_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_commercial_cost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Commission</td>
                    <td align="right"><? echo fn_number_format($total_commission_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($total_commission_cost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Depc. & Amort.</td>
                    <td align="right"><? echo fn_number_format($depr_amor_pre_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($depr_amor_pre_cost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Lab Test</td>
                    <td align="right"><? echo fn_number_format($lab_test_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($lab_test,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Inspection Cost</td>
                    <td align="right"><? echo fn_number_format($inspection_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($inspection,4); ?></td>
                </tr>
                <tr>
                    <td align="left">CM Cost - IE</td>
                    <td align="right"><? echo fn_number_format($cm_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($cm_cost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Freight Cost</td>
                    <td align="right"><? echo fn_number_format($freight_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($freight,4); ?></td>
                </tr>

                 <tr>
                    <td align="left">Currier Cost </td>
                    <td align="right"><? echo fn_number_format($currier_pre_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($currier_pre_cost,4); ?></td>
                </tr>

                 <tr>
                    <td align="left">Certificate Cost </td>
                    <td align="right"><? echo fn_number_format($certificate_pre_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($certificate_pre_cost,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Deffd. LC Cost </td>
                    <td align="right"><? echo fn_number_format($deffdlc_cost_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($deffdlc_cost,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Interest </td>
                    <td align="right"><? echo fn_number_format($interest_percent,4); ?></td>
                    <td align="right"><? echo fn_number_format($interest_cost,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Income Tax </td>
                    <td align="right"><? echo fn_number_format($incometax_percent,4); ?></td>
                    <td align="right"><? echo fn_number_format($interest_cost,4); ?></td>
                </tr>
                <tr>
                    <td align="left">Office OH</td>
                    <td align="right"><? echo fn_number_format($common_oh_dzn,4); ?></td>
                    <td align="right"><? echo fn_number_format($common_oh,4); ?></td>
                </tr>
                <tr class="rpt_bottom" style="font-weight:bold">
                    <td align="right" colspan="3">Total</td>
                    <td align="right"><? echo fn_number_format($total_summary_amount,4); ?></td>
                </tr>
            </table>
          </td>
          </tr>
          </table>
          <?
          //start	CM on Net Order Value part report here -------------------------------------------
    	$sql = "select id,job_no,costing_per_id,order_uom_id,fabric_cost,fabric_cost_percent,trims_cost,trims_cost_percent,embel_cost,embel_cost_percent,comm_cost,comm_cost_percent,commission,commission_percent,lab_test,lab_test_percent,inspection,inspection_percent,cm_cost,cm_cost_percent,freight,freight_percent,common_oh,common_oh_percent,total_cost,total_cost_percent,price_dzn,price_dzn_percent,margin_dzn,margin_dzn_percent,price_pcs_or_set,price_pcs_or_set_percent,margin_pcs_set,margin_pcs_set_percent,cm_for_sipment_sche
			from wo_pre_cost_dtls
			where job_no='".$txt_job_no."' and status_active=1 and is_deleted=0";
	$data_array=sql_select($sql);
	foreach( $data_array as $row );
	$order_net_value = 0;
	?>

        <div style="margin-top:15px">
        <div style="float:left">
            <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:420px;text-align:center;" rules="all">
            <label><b>CM on Net Order Value</b></label>
                <tr style="font-weight:bold">
                    <td width="150">Particulars</td>
                    <td width="100">Amount (USD)</td>
                    <td width="100">%</td>
                </tr>
                <tr>
                    <td align="left">Order Value </td>
                    <td align="right"><?  echo fn_number_format($order_values,4); ?></td>
                    <td align="right">&nbsp;</td>
                </tr>
                <tr>
                    <td align="left">Less Commission </td>
                    <td align="right"><? $less_commission=$commission_costing_arr[$job_no];//$less_commission = $row[csf("commission")]/$order_price_per_dzn*$order_job_qnty;
					echo fn_number_format($less_commission,4); ?></td>
                    <td align="right">&nbsp;</td>
                </tr>
                <tr>
                    <td align="left">Less Commercial Cost </td>
                    <td align="right"><? $less_commercial=$commercial_costing_arr[$job_no];//$less_commercial = $row[csf("comm_cost")]/$order_price_per_dzn*$order_job_qnty;
					 echo fn_number_format($less_commercial,4); ?></td>
                    <td align="right">&nbsp;</td>
                </tr>
                <tr>
                    <td align="left">Less Freight</td>
                    <td align="right"><? $less_freight=$other_costing_arr[$job_no]['freight'];//$less_freight = $row[csf("freight")]/$order_price_per_dzn*$order_job_qnty;
					echo fn_number_format($less_freight,4); ?></td>
                    <td align="right">&nbsp;</td>

                </tr>
                <tr>
                    <td align="left">Net Order Value</td>
                    <td align="right"><? $order_net_value=$order_values-($less_commission+$less_commercial+$less_freight);echo fn_number_format($order_net_value,4); ?></td>
                    <td align="center"><? echo fn_number_format($order_net_value/$order_net_value*100,2); ?></td>
                </tr>
                <tr>
                    <td align="left">Other Cost</td>
                    <td align="right">
					<?
		
						// $others_cost_value=$knit_subtotal_avg_finish_cons+$woven_subtotal_avg_finish_cons+$lab_test+			$total_trims_cost+$total_embellishment_amt+$inspection+$common_oh;
						$others_cost_value=$tot_fab_cot+$total_trims_cost+$total_embellishment_amt+$lab_test+$inspection+$common_oh;
					$otherCost=$others_cost_value;
					//	$otherCost=$others_cost_value/$order_price_per_dzn*$order_job_qnty;
					echo fn_number_format($otherCost,4);
					?>
                    </td>
                    <td align="center"><? echo fn_number_format($otherCost/$order_net_value*100,2); ?></td>
                </tr>
                <tr>
                    <td align="left">CM(Contribution Margin)</td>
                    <td align="right"><? $cmValue = $order_net_value-$otherCost; echo fn_number_format($cmValue,4); ?></td>
                    <td align="center"><? echo fn_number_format($cmValue/$order_net_value*100,2); ?></td>
                </tr>
                <tr>
                    <td align="left">CM /<? echo $costing_for; ?></td>
                    <td align="right"><? $cmPerDzn=$cmValue/$order_qty*$order_price_per_dzn; echo fn_number_format($cmPerDzn,4); ?></td>
                    <td align="center"></td>
                </tr>
                <tr>
                    <td align="left">CM Cost /<? echo $costing_for; ?></td>
                    <td align="right"><?
					$cm_cost=$cm_cost_dzn;//$other_costing_arr[$job_no]['cm_cost'];
					echo fn_number_format($cm_cost,4); ?></td>
                    <td align="center">&nbsp;</td>
                </tr>
                <tr>
                    <td align="left">Margin /<? echo $costing_for; ?></td>
                    <td align="right"><? echo fn_number_format($cmPerDzn-$cm_cost,4); ?></td>
                    <td align="center">&nbsp;</td>
                </tr>

            </table>
      </div>
      <div style="margin-left:5px;float:left;">
      		<table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:420px;text-align:center;" rules="all">
            <label><b>Cost Summary for order quantity</b></label>
                <tr style="font-weight:bold">
                    <td width="150">Particulars</td>
                    <td width="100">Amount (USD)</td>
                    <td width="100">%</td>
                </tr>
                <tr>
                    <td align="left">Total Order Value </td>
                    <td align="right"><? $total_order_val = $order_values;//$order_job_qnty*$avg_unit_price;
					 echo fn_number_format($total_order_val,4); ?></td>
                    <td align="center"><? echo fn_number_format($total_order_val/$total_order_val*100,4); ?></td>
                </tr>
                 <tr>
                    <td align="left">Total Cost </td>
                    <td align="right"><?  $total_cost = $total_summary_amount;//$all_total_cost;
					echo fn_number_format($total_cost,4);//$total_cost = $row[csf("total_cost")]/$order_price_per_dzn*$order_job_qnty; echo fn_number_format($total_cost,4); ?></td>
                    <td align="center"><? echo fn_number_format($total_cost/$total_order_val*100,2); ?></td>
                </tr>
                 <tr>
                    <td align="left">Margin </td>
                    <td align="right"><? $margin_val = $total_order_val-$total_cost; echo fn_number_format($margin_val,4); ?></td>
                    <td align="center"><? echo fn_number_format($margin_val/$total_order_val*100,2); ?></td>
                </tr>
                 <tr>
                    <td align="left">Margin /<? echo $costing_for; ?> </td>
                    <td align="right"><? echo fn_number_format($margin_val/$order_qty*$order_price_per_dzn,2); ?></td>
                    <td align="center">&nbsp;</td>
                </tr>
           </table>
      </div>
       <?
     	 // image show here  -------------------------------------------
		$sql = "select id,master_tble_id,image_location
				from common_photo_library
				where master_tble_id=".$txt_job_no."";
		$data_array=sql_select($sql);
 	  ?>
          <div style="margin:15px 5px;float:left;width:500px" >
          	<? foreach($data_array AS $inf){ ?>
                <img  src='../../<? echo $inf[csf("image_location")]; ?>' height='97' width='89' />
            <?  } ?>
          </div>
      <div style="clear:both"></div>
      </div>
	   <br/> <br/>
         <?
		
	 $lib_designation_arr=return_library_array(" select id,custom_designation from lib_designation","id","custom_designation");
	 $user_lib_designation_arr=return_library_array("SELECT id,designation from user_passwd", "id", "designation");
	 $user_lib_name_arr=return_library_array("SELECT id,user_full_name from user_passwd", "id", "user_full_name");
	
	$mst_id=return_field_value("id as mst_id","wo_pre_cost_mst","job_no=$txt_job_no","mst_id");
	//and b.un_approved_date is null
	 $approve_data_array=sql_select("select b.approved_by,min(b.approved_date) as approved_date from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  group by  b.approved_by order by b.approved_by asc");
	 $unapprove_data_array=sql_select("select b.approved_by, b.un_approved_by, b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  order by b.approved_date,b.approved_by");
	// echo "select b.approved_by,b.approved_date,b.un_approved_reason,b.un_approved_date,b.approved_no from   approval_history b where b.mst_id=$mst_id and b.entry_form=15  order by b.approved_no";
 
 	if(count($approve_data_array)>0)
	{
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="5" style="border:1px solid black;">Approval Status</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="40%" style="border:1px solid black;">Name</th>
				<th width="30%" style="border:1px solid black;">Designation</th>
				<th width="27%" style="border:1px solid black;">Approval Date</th>
				
                </tr>
            </thead>
            <tbody>
            <?
			$i=1;
			foreach($approve_data_array as $row){
			
			
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="40%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="27%" style="border:1px solid black;text-align:center"><? echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')]));?></td>
			
                </tr>
                <?
				$i++;
			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
    <br/>
	<?
	$sql_unapproved=sql_select("select user_id,booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=15 and approval_type=2  and booking_id=$mst_id and is_deleted=0 and status_active=1");
	//echo  "select booking_id,approval_cause from fabric_booking_approval_cause where  entry_form=15 and approval_type=2 and is_deleted=0 and status_active=1 and booking_id=$mst_id";
	$unapproved_request_arr=array();
	foreach($sql_unapproved as $rowu)
	{
		$unapproved_request_arr[$rowu[csf('booking_id')]]=$rowu[csf('approval_cause')];
	}
	
	if(count($unapprove_data_array)>0)
	{
 		?>
       <table  width="850" class="rpt_table"   border="1" cellpadding="0" cellspacing="0" rules="all">
            <thead>
            <tr style="border:1px solid black;">
                <th colspan="6" style="border:1px solid black;">Approval/Un Approval History</th>
                </tr>
                <tr style="border:1px solid black;">
                <th width="3%" style="border:1px solid black;">Sl</th>
				<th width="30%" style="border:1px solid black;">Name</th>
				<th width="20%" style="border:1px solid black;">Designation</th>
				<th width="5%" style="border:1px solid black;">Approval Status</th>
				<!--<th width="20%" style="border:1px solid black;">Reason For Un Approval</th>-->
				<th width="22%" style="border:1px solid black;"> Date</th>
				
                </tr>
            </thead>
            <tbody>
            <? 
			$i=1;  $un_approve_req_chk=array();$un=1;
			foreach($unapprove_data_array as $row)
			{
			?>
            <tr style="border:1px solid black;">
                <td width="3%" style="border:1px solid black;"><? echo $i;?></td>
				<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
				<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
				<td width="5%" style="border:1px solid black; text-align:center"><? echo 'Yes';?></td>
				<!--<td width="20%" style="border:1px solid black;"><? //echo $unapproved_request_arr[$row[csf('approved_by')]];?></td>-->
				<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('approved_date')])); else echo "";?></td>
             </tr>
				<?
				$i++;
				$un_approved_date= explode(" ",$row[csf('un_approved_date')]);
				$un_approved_date=$un_approved_date[0];
				if($db_type==0) //Mysql
				{
					if($un_approved_date=="" || $un_approved_date=="0000-00-00") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}
				else
				{
					if($un_approved_date=="") $un_approved_date="";else $un_approved_date=$un_approved_date;
				}
				
				if(!empty($un_approved_date))
				{
					$un_approv_user=$row[csf('approved_by')].$mst_id;
					if (!in_array($un_approv_user,$un_approve_req_chk))
					{ 	
						$un++;
						$un_approve_req_chk[]=$un_approv_user;
						$unapproved_request=$unapproved_request_arr[$mst_id];
						//echo $un_approv_user."=";
					}
					if($row[csf('un_approved_by')]!=0) $row[csf('approved_by')]=$row[csf('un_approved_by')];
					?>
					<tr style="border:1px solid black;">
						<td width="3%" style="border:1px solid black;"><? echo $i;?></td>
						<td width="30%" style="border:1px solid black;text-align:center"><? echo $user_lib_name_arr[$row[csf('approved_by')]];?></td>
						<td width="20%" style="border:1px solid black;text-align:center"><? echo $lib_designation_arr[$user_lib_designation_arr[$row[csf('approved_by')]]];?></td>
						<td width="5%" style="border:1px solid black;text-align:center;"><? echo 'No';?></td>
						<td width="22%" style="border:1px solid black;text-align:center"><? if($row[csf('un_approved_date')]!="") echo date ("d-m-Y h:i:s",strtotime($row[csf('un_approved_date')])); else echo "";?></td>
					</tr>
					<?
					$i++;
				}
			}
				?>
            </tbody>
        </table>
		<?
		}
		?>
    <!--End CM on Net Order Value Part report here -->
	<? echo "<br /><b>Note: Other Cost =  Fabric Cost + Trims Cost + Embellishment Cost + Lab Test + Inspection + Office OH</b><br /><br />"; ?>
      </div>
    <br/>
 
	</div>
	 <?
	 exit();
}
if($action=="report_generate4")
{ 
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process )); 
	
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );

	$company_name=str_replace("'","",$cbo_company_name);
	$txt_order_no=str_replace("'","",$txt_order_no);
	$txt_file_no=str_replace("'","",$txt_file_no);
	$txt_ref_no=str_replace("'","",$txt_ref_no);
	$cbo_based_on=str_replace("'","",$cbo_based_on);
	$report_type=str_replace("'","",$report);
	
	if($txt_ref_no!='') $ref_cond="and b.grouping='$txt_ref_no'";else $ref_cond="";
	if($txt_file_no!='') $file_cond="and b.file_no=$txt_file_no";else $file_cond="";
	
	if(str_replace("'","",$cbo_buyer_name)==0)
	{
		if ($_SESSION['logic_erp']["data_level_secured"]==1)
		{
			if($_SESSION['logic_erp']["buyer_id"]!="") $buyer_id_cond=" and a.buyer_name in (".$_SESSION['logic_erp']["buyer_id"].")"; else $buyer_id_cond="";
		}
		else $buyer_id_cond="";
	}
	else $buyer_id_cond=" and a.buyer_name=$cbo_buyer_name";//.str_replace("'","",$cbo_buyer_name)
	
	$txt_job_no=str_replace("'","",$txt_job_no);
	if(trim($txt_job_no)!="") $job_no=trim($txt_job_no); else $job_no="%%";
	
	$cbo_year=str_replace("'","",$cbo_year);
	if(trim($cbo_year)!=0) 
	{
		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year"; else if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year"; else $year_cond="";
	}
	else $year_cond="";
	
	$date_cond='';
	if(str_replace("'","",$txt_date_from)!="" && str_replace("'","",$txt_date_to)!="")
	{
		$date_cond=" and b.pub_shipment_date between $txt_date_from and $txt_date_to";
	}
	$ex_date_cond='';
	if(str_replace("'","",$txt_ex_date_from)!="" && str_replace("'","",$txt_ex_date_to)!="")
	{
		$ex_date_cond=" and d.ex_factory_date between $txt_ex_date_from and $txt_ex_date_to";
	}
	$po_id_cond="";
	if(trim(str_replace("'","",$txt_order_no))!="")
	{
		if(str_replace("'","",$hide_order_id)!="") $po_id_cond=" and b.id in(".str_replace("'","",$hide_order_id).")";
		else $po_id_cond=" and LOWER(b.po_number) like LOWER('%".trim(str_replace("'","",$txt_order_no))."%')";
	}
	
	$shipping_status_cond='';
	if(str_replace("'","",$shipping_status)!=0) $shipping_status_cond=" and b.shiping_status=$shipping_status";
	
	$po_ids_array=array();
		
	if($db_type==0) $year_field="YEAR(a.insert_date) as year"; 
	else if($db_type==2) $year_field="to_char(a.insert_date,'YYYY') as year";
	else $year_field="";//defined Later
	//echo $ex_date_cond;
	if($ex_date_cond=="" ){
		$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, $year_field,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c where a.job_no=b.job_no_mst and a.job_no=c.job_no and b.job_no_mst=c.job_no and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no'   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $date_cond $buyer_id_cond $po_id_cond $ref_cond $file_cond $shipping_status_cond $year_cond order by b.pub_shipment_date, a.job_no_prefix_num, b.id";
	}else {
		$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, $year_field,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate from wo_po_details_master a, wo_po_break_down b, wo_pre_cost_mst c,pro_ex_factory_mst d where a.job_no=b.job_no_mst and a.job_no=c.job_no and b.job_no_mst=c.job_no and b.id=d.po_break_down_id and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no'   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 $ex_date_cond $date_cond $buyer_id_cond $po_id_cond $ref_cond $file_cond $shipping_status_cond $year_cond group by  a.id,a.job_no_prefix_num, a.job_no, a.insert_date,a.job_quantity, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty, a.set_smv, b.id, b.po_number,b.grouping,b.file_no, b.pub_shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status,c.exchange_rate order by b.pub_shipment_date, a.job_no_prefix_num, b.id";

	}
	$result=sql_select($sql);
	$all_po_id="";	$all_job_id="";
	$po_id_arr=array(); $job_id_arr=array();
	foreach($result as $row)
	{
		$po_id_arr[$row[csf("id")]]=$row[csf("id")];
		$job_id_arr[$row[csf("job_id")]]=$row[csf("job_id")];

		$job_arr[$row[csf("id")]]['job']=$row[csf("job_no")];
		$job_arr2[$row[csf("job_no")]]['po_quantity']=$row[csf("po_quantity")];
		$job_arr2[$row[csf("job_no")]]['job_quantity']=$row[csf("job_quantity")];
		$po_exchange_rateArr[$row[csf("id")]]['exchange_rate']=$row[csf("exchange_rate")];
	}
	if(count($po_id_arr)==0) 
	{ 
		echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
	}
	$con = connect();
	execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_name." and ref_from in (1,2,3,4,5,6,7) and ENTRY_FORM=123");
	fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 1, $job_id_arr, $empty_arr);
	fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 2, $po_id_arr, $empty_arr);
	
	$ActualArray_sql=sql_select("select a.id,b.pr_date, b.man_power, b.target_per_hour, e.working_hour,e.operator,e.helper,c.from_date,c.to_date,c.capacity,e.po_id from prod_resource_mst a, prod_resource_dtls b,prod_resource_dtls_mast c,prod_resource_color_size e, gbl_temp_engine f where a.id=c.mst_id and c.id=b.mast_dtl_id and e.mst_id=a.id and e.dtls_id=c.id and a.company_id=$company_name  and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and e.po_id=f.ref_val and f.ref_from=2 and f.entry_form=123 and f.user_id=$user_name");
		foreach($ActualArray_sql as $val)
		{
			$pr_date=date("Y-m",strtotime(($val[csf('pr_date')])));
			$po_exchange_rate=$po_exchange_rateArr[$val[csf("po_id")]]['exchange_rate'];
			$prod_resource_array[$val[csf('po_id')]]['man_power']=$val[csf('man_power')];
			$prod_resource_array[$val[csf('po_id')]]['operator']=$val[csf('operator')];
			$prod_resource_array[$val[csf('po_id')]]['helper']=$val[csf('helper')];
			$prod_resource_array[$val[csf('po_id')]]['terget_hour']=$val[csf('target_per_hour')];
			$prod_resource_array[$val[csf('po_id')]]['operator_helper']=$val[csf('operator')]+$val[csf('helper')];
			$prod_resource_array[$val[csf('po_id')]]['working_hour']+=$val[csf('working_hour')];
			$prod_resource_array[$val[csf('po_id')]]['pr_date']=$val[csf('pr_date')];
			$prod_resource_array[$val[csf('po_id')]]['ex_rate']=$po_exchange_rate;
			$actual_prod_id_arr[$val[csf('id')]]=$val[csf('id')];			 
		}
		$adj_resource_array=array();
		if(count($actual_prod_id_arr)>0){
			fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 3, $actual_prod_id_arr, $empty_arr);
			$ActualExtraArray_sql=sql_select("select a.id,b.pr_date, b.man_power, e.style_ref_no,e.number_of_emp, e.adjust_hour as working_hour,c.from_date,c.to_date,c.capacity,e.style_ref_no from prod_resource_mst a, prod_resource_dtls b,prod_resource_dtls_mast c,prod_resource_smv_adj e, gbl_temp_engine f where a.id=c.mst_id and c.id=b.mast_dtl_id and e.mst_id=a.id and e.dtl_id=b.id and a.company_id=$company_name  and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0 and a.id=f.ref_val and f.ref_from=3 and f.entry_form=123 and f.user_id=$user_name");
			foreach($ActualExtraArray_sql as $val)
			{
				$pr_date=date("Y-m",strtotime(($val[csf('pr_date')])));
				$adj_resource_array[$val[csf('style_ref_no')]]['working_hour']+=$val[csf('working_hour')];
				$adj_resource_array[$val[csf('style_ref_no')]]['pr_date']=$val[csf('pr_date')];
				$adj_resource_array[$val[csf('style_ref_no')]]['number_of_emp']+=$val[csf('number_of_emp')];
			}
		}
		$sql_cpm="select monthly_cm_expense,applying_period_date,applying_period_to_date, no_factory_machine, working_hour, cost_per_minute, depreciation_amorti, operating_expn, interest_expense, income_tax from lib_standard_cm_entry where company_id=$company_name   and status_active=1 and is_deleted=0";
	 
		$lib_data_array=sql_select($sql_cpm);
		foreach ($lib_data_array as $row)
		{
			$applying_period_date=$row[csf("applying_period_date")];
			$from_cmp_date=date("Y-m",strtotime(($applying_period_date)));
			$lib_cpm_array[$from_cmp_date]['cpm']=$row[csf('cost_per_minute')];
		}
		unset($lib_data_array);	
		$ex_factory_arr=return_library_array( "select b.po_break_down_id, 
		sum(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as qnty 
		from pro_ex_factory_mst b, gbl_temp_engine c where b.status_active=1 and b.is_deleted=0 and b.po_break_down_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by b.po_break_down_id", "po_break_down_id", "qnty");
		ob_start();
	?>
    <fieldset>
    	<table width="5530">
            <tr class="form_caption">
                <td colspan="36" align="center"><strong>Post Costing Report V3</strong></td>
            </tr>
            <tr class="form_caption">
                <td colspan="36" align="center"><strong><? echo $company_arr[$company_name];?></strong>
                    <br>
                    <strong><? echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to)); ?></strong>
                </td>
            </tr>
        </table>
        <table style="margin-top:10px" id="table_header_1" class="rpt_table" width="5530" cellpadding="0" cellspacing="0" border="1" rules="all">
            <thead>
                <th width="40">SL</th>
                <th width="70">Buyer</th>
                <th width="60">Job Year</th>
                <th width="70">Job No</th>
                <th width="100">PO No</th>
				<th width="100">FB No</th>
                <th width="70">File No</th>
                <th width="80">Ref. No</th>
                <th width="110">Style Name</th>
                <th width="120">Garments Item</th>
                <th width="90">PO Quantity</th>
                <th width="50">UOM</th>
                <th width="70">Unit Price</th>
                <th width="110">PO Value</th>
                <th width="100">SMV</th>
                <th width="80">Shipment Date</th>
                <th width="100">Shipping Status</th>
                <th width="100">Cost Source</th>
                <th width="100">PO/Ex-Factory Qnty</th>
                <th width="110">PO/Ex-Factory Value</th>
                <th width="110">Grey Yarn Cost</th>
                <th width="100">Yarn Value Addition Cost</th>
                <th width="110">Knitting Cost</th>
                <th width="100">Grey Fabric Transfer Cost</th>
              
                <th width="100">Grey Fabric Cost</th>
                
                <th width="110">Dye & Fin Cost</th>
                <th width="110">AOP Cost</th>
                <th width="100">Fin. Fab. Transfer Cost</th>
                <th width="100">Fin.Fabric Purchase Cost</th>
                <th width="110">Grey Fabric Purchease Cost</th>
                <th width="100">Finished Fabric Cost[Production]</th>
                <th width="100" title="Fin.Fabric Purchase Cost+Finished Fabric Cost">Total Fabric Cost</th>
                <th width="110">Trims Cost</th>
                <th width="100">Printing Cost</th>
                <th width="100">Embroidery Cost</th>
                <th width="100">Gmt Dyeing Cost</th>
                <th width="100">Washing Cost</th>
               
                <th width="100">Commission Cost</th>
                <th width="100">Commercial Cost</th>
                <th width="100">Freight Cost</th>
                <th width="100">Testing Cost</th>
                <th width="100">Inspection Cost</th>
                <th width="100">Courier Cost</th>
                
                <th width="100">Certificate Cost</th>
                <th width="100">Deffd. LC Cost</th>
                <th width="100">Design Cost</th>
                <th width="100">Studio Cost</th>
                <th width="100">Opert. Exp.</th>               
                <th width="100">CM Cost</th>                
                <th width="100">Interest</th>
                <th width="100">Income Tax</th>
                <th width="100">Depc. & Amort.</th>
				<th width="100">Total Cost</th>
                <th width="100">Margin/Loss</th>
                <th  width="100">% to Ex-Factory Value</th>
                <th width="100">CPA/Short Fab. Cost</th>
                <th width="">Net Margin/Loss</th>
            </thead>
        </table>
    	<div style="width:5550px; max-height:400px; overflow-y:scroll" id="scroll_body">
            <table class="rpt_table" width="5530" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body">
            <?
			$process_costing=return_field_value("process_costing_maintain", "variable_settings_production", "company_name=$company_name and variable_list=34 and is_deleted=0 and status_active=1");
			
			$usd_id=2;
			$fabriccostArray=array(); $yarncostArray=array(); $trimsCostArray=array(); $prodcostArray=array(); $actualCostArray=array(); $actualTrimsCostArray=array(); 
			$subconCostArray=array(); $embellCostArray=array(); $washCostArray=array(); $aopCostArray=array(); $yarnTrimsCostArray=array(); 
			$yarncostDataArray=sql_select("select a.job_no, sum(a.amount) as amnt, sum(a.rate*a.avg_cons_qnty) as amount from wo_pre_cost_fab_yarn_cost_dtls a, gbl_temp_engine b where a.status_active=1 and a.is_deleted=0 and a.job_id=b.ref_val and b.ref_from=1 and b.entry_form=123 and b.user_id=$user_name group by a.job_no");			
			foreach($yarncostDataArray as $yarnRow)
			{
			   $yarncostArray[$yarnRow[csf('job_no')]]=$yarnRow[csf('amount')];
			}
			unset($yarncostDataArray);
			$fabriccostDataArray=sql_select("select a.job_no, a.costing_per_id, a.embel_cost, a.wash_cost, a.cm_cost, a.commission, a.currier_pre_cost, a.lab_test, a.inspection, a.freight, a.comm_cost from wo_pre_cost_dtls a, gbl_temp_engine b where a.status_active=1 and a.is_deleted=0 and a.job_id=b.ref_val and b.ref_from=1 and b.entry_form=123 and b.user_id=$user_name");
			foreach($fabriccostDataArray as $fabRow)
			{
				 $fabriccostArray[$fabRow[csf('job_no')]]['costing_per_id']=$fabRow[csf('costing_per_id')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['embel_cost']=$fabRow[csf('embel_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['wash_cost']=$fabRow[csf('wash_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['cm_cost']=$fabRow[csf('cm_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['commission']=$fabRow[csf('commission')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['currier_pre_cost']=$fabRow[csf('currier_pre_cost')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['lab_test']=$fabRow[csf('lab_test')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['inspection']=$fabRow[csf('inspection')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['freight']=$fabRow[csf('freight')];
				 $fabriccostArray[$fabRow[csf('job_no')]]['comm_cost']=$fabRow[csf('comm_cost')];
			}
			unset($fabriccostDataArray);
			$prodcostDataArray="SELECT a.body_part_id,a.lib_yarn_count_deter_id as deter_id,b.po_break_down_id as po_id, avg(case when c.cons_process=1 then c.charge_unit end) as knit_charge, avg(case when c.cons_process=30 then c.charge_unit end) as yarn_dye_charge, avg(case when c.cons_process=35 then c.charge_unit end) as aop_charge, avg(case when c.cons_process not in(1,2,30,35,134) then c.charge_unit end) as dye_finish_charge from wo_pre_cost_fabric_cost_dtls a,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cos_fab_co_avg_con_dtls b, gbl_temp_engine d where a.id=c.fabric_description and a.job_no=c.job_no and b.pre_cost_fabric_cost_dtls_id=a.id and b.job_no=c.job_no and c.status_active=1 and c.is_deleted=0 and b.po_break_down_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name group by  a.lib_yarn_count_deter_id,b.po_break_down_id,a.body_part_id"; $resultfab_arr = sql_select($prodcostDataArray);
			foreach($resultfab_arr as $prodRow)
			{
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['knit_charge']=$prodRow[csf('knit_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['yarn_dye_charge']=$prodRow[csf('yarn_dye_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['aop_charge']=$prodRow[csf('aop_charge')];
				$prodcostArray[$prodRow[csf('po_id')]][$prodRow[csf('deter_id')]][$prodRow[csf('body_part_id')]]['dye_finish_charge']=$prodRow[csf('dye_finish_charge')];
			}
			$finProd_grey_used_sql = "SELECT c.body_part_id,c.fabric_description_id as deter_id,b.po_breakdown_id as po_id, b.quantity as grey_used_qty from order_wise_pro_details b,pro_finish_fabric_rcv_dtls c, gbl_temp_engine d where  b.dtls_id=c.id and b.entry_form=7 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name";
			$fingrey_used_data =sql_select($finProd_grey_used_sql );
			foreach($fingrey_used_data as $row)
			{
				$fin_dye_finish_charge=$prodcostArray[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$fin_grey_used_arr[$row[csf('po_id')]]['grey_used_amt']+=$row[csf('grey_used_qty')]*$fin_dye_finish_charge;
			}
			unset($fingrey_used_data);
			
		
			$grey_used_sql = "SELECT a.body_part_id,a.fabric_description_id as deter_id,b.qnty,b.po_breakdown_id as po_id from pro_finish_fabric_rcv_dtls a, pro_roll_details b, gbl_temp_engine c where a.id=b.dtls_id and b.entry_form=66 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";

			$grey_used_data =sql_select($grey_used_sql );
			foreach($grey_used_data as $row)
			{
				$finProd_grey_used=$finProd_grey_usedArr[$row[csf('po_id')]];
				$dye_finish_charge=$prodcostArray[$row[csf('po_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
				$grey_used_arr[$row[csf('po_id')]]['grey_used_amt']+=$row[csf('qnty')]*$dye_finish_charge;
			}
			
			$yarn_dyeing_costArray=array(); //product_id
			 $yarndyeing_sql="SELECT b.booking_date,b.id,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a, gbl_temp_engine c where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 and a.job_no_id=c.ref_val and c.ref_from=1 and c.entry_form=123 and c.user_id=$user_name group by b.id,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";

			$yarndyeing_result = sql_select($yarndyeing_sql);
			foreach($yarndyeing_result as $yarnRow)
			{
				$yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['job']=$yarnRow[csf('job_no')];
				$yarn_dyeing_costArray2[$yarnRow[csf('id')]]['ydw_no']=$yarnRow[csf('ydw_no')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
				$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['booking_date']=$yarnRow[csf('booking_date')];
				$yarn_dyeing_curr_arr[$yarnRow[csf('ydw_no')]]['currency']=$yarnRow[csf('currency')];
				$yarn_dyeing_rate_arr[$yarnRow[csf('job_no')]][$yarnRow[csf('yarn_color')]]['rate']=$yarnRow[csf('dyeing_charge')];
				
				$yarn_dyeing_mst_idArr[$yarnRow[csf('id')]]=$yarnRow[csf('id')];
			}
			//print_r($yarn_dyeing_curr_arr);
			unset($resultyarnIssueData);	
				
			$yarnIssueData="SELECT b.prod_id,sum(a.cons_amount) as cons_amount,sum(a.cons_quantity) as cons_quantity from inv_transaction a, order_wise_pro_details b,product_details_master c, gbl_temp_engine d where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and b.entry_form ='3' and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)  and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name group by  b.prod_id";
			//echo $yarnIssueData; die;

			$resultyarnIssueData = sql_select($yarnIssueData);
			$all_prod_ids=array();
			foreach($resultyarnIssueData as $row)
			{
				$all_prod_ids[$row[csf('prod_id')]]=$row[csf('prod_id')];
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt']+=$row[csf('cons_amount')];
				$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty']+=$row[csf('cons_quantity')];
			}
			if(count($all_prod_ids)>0){
				fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 4, $all_prod_ids, $empty_arr);
				$sql_receive_for_issue="SELECT c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.exchange_rate,c.currency_id,c.receive_purpose,b.lot,b.color, sum(a.order_qnty) as qty, sum(a.order_amount) as amnt, sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv from inv_transaction a,product_details_master b,inv_receive_master c, gbl_temp_engine d where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 and a.prod_id=d.ref_val and d.ref_from=4 and d.entry_form=123 and d.user_id=$user_name  group by c.booking_id,a.job_no,a.prod_id,c.currency_id,c.exchange_rate,c.receive_purpose,b.lot,b.color";
				$resultReceive_chek = sql_select($sql_receive_for_issue);				
				foreach($resultReceive_chek as $row)
				{
					$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose']=$row[csf('receive_purpose')];
					$receive_date_array[$row[csf('prod_id')]]['last_exchange_rate']=$row[csf('exchange_rate')];
					$avg_rate=$row[csf('amnt')]/$row[csf('qty')];
					$receive_array[$row[csf('prod_id')]]=$avg_rate;
					if($row[csf('prod_id')]!="")
					{
						$prod_id_arr[$row[csf('prod_id')]]=$row[csf('prod_id')];
					}
				}
			}
			fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 5, $yarn_dyeing_mst_idArr, $empty_arr);	
			
			$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit");

			 $sql_receive="SELECT c.recv_number,c.booking_id,c.exchange_rate,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.receive_purpose,b.lot,b.color,c.currency_id, sum(a.order_qnty) as qty, sum(a.order_amount) as amnt, sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv, sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.cons_quantity ELSE 0 END) AS cons_quantity from inv_transaction a,product_details_master b,inv_receive_master c, gbl_temp_engine d where a.prod_id=b.id and c.id=a.mst_id  and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1  and c.booking_id=d.ref_val and d.ref_from=5 and d.entry_form=123 and d.user_id=$user_name  and a.is_deleted=0 group by c.recv_number,c.booking_id,c.exchange_rate,a.job_no,a.prod_id,c.currency_id,c.receive_purpose,b.lot,b.color";

			$resultReceive = sql_select($sql_receive);$all_recv_prod_ids=array();
			foreach($resultReceive as $invRow)
			{
				//if($all_recv_prod_ids=="") $all_recv_prod_ids=$invRow[csf('prod_id')];else $all_recv_prod_ids.=",".$invRow[csf('prod_id')];
				$all_recv_prod_ids[$invRow[csf('prod_id')]]=$invRow[csf('prod_id')];
				$receive_curr_array[$invRow[csf('prod_id')]]=$invRow[csf('currency_id')];
				$jobNo=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['job'];
				$ydw_no=$yarn_dyeing_costArray2[$invRow[csf('booking_id')]]['ydw_no'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['job']=$jobNo;
				$yarn_rec_job_arr[$invRow[csf('recv_number')]]['ydw_no']=$ydw_no;
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$dye_rate=$yarn_dyeing_rate_arr[$jobNo][$invRow[csf('color')]]['rate'];
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				$order_amount_recv=$invRow[csf('order_amount_recv')];
				$cons_quantity=$invRow[csf('cons_quantity')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				$exchange_rateArr[$invRow[csf('prod_id')]]=$invRow[csf('exchange_rate')];
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				$currency_rate=$exchange_rate;
			
				if($currency==1) $avg_rate=$dye_rate/$currency_rate;//Taka
				else $avg_rate=$dye_rate;	
				if($is_short==2) $yarn_receive_amount_arr[$jobNo]['order_amount_recv']+=$avg_rate*$cons_quantity;//Main Booking..
				else $yarn_receive_amount_arr[$jobNo]['cpa_order_amount_recv']+=$avg_rate*$cons_quantity;	
			}
			unset($resultReceive); 
			
			fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 6, $all_recv_prod_ids, $empty_arr);	

			$sql_receive_ret="SELECT a.prod_id,b.lot,b.color,c.received_mrr_no, sum(a.cons_quantity) as cons_quantity from inv_transaction a,product_details_master b,inv_issue_master c, gbl_temp_engine d where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=8 and c.item_category=1 and a.transaction_type=3 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 and a.prod_id=d.ref_val and d.ref_from=6 and d.entry_form=123 and d.user_id=$user_name  group by a.prod_id,b.lot,b.color,c.received_mrr_no";
			$resultReceive_ret = sql_select($sql_receive_ret);
			
			foreach($resultReceive_ret as $row)
			{
				$ydw_no=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['ydw_no'];
				$recv_job=$yarn_rec_job_arr[$row[csf('received_mrr_no')]]['job'];
				$is_short=$yarn_dyeing_isshort_arr[$ydw_no]['is_short'];
				$booking_date=$yarn_dyeing_isshort_arr[$ydw_no]['booking_date'];
				$ydye_rate=$yarn_dyeing_rate_arr[$jobNo][$row[csf('color')]]['rate'];
				$currency=$yarn_dyeing_curr_arr[$ydw_no]['currency'];
				$transaction_date=$booking_date;
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				
				//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
				$currency_rate=$exchange_rateArr[$row[csf('prod_id')]];;
				if($currency==1) $avg_rate=$ydye_rate/$currency_rate;//Taka
				else $avg_rate=$ydye_rate;	
				
				$ret_amt=$row[csf('cons_quantity')]*$avg_rate;
				if($is_short==2) $receive_ret_arr[$recv_job]['recv_ret_amt']+=$ret_amt; //Main Booking
				else $receive_ret_arr[$recv_job]['cpa_recv_ret_amt']+=$ret_amt;
			}
			unset($resultReceive_ret);

			/* $aop_amt_array=array();
			$sql_wo_aop="SELECT a.id,a.booking_date,a.currency_id,a.item_category,a.booking_no,a.booking_type,a.is_short,b.po_break_down_id as po_id, (CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.wo_qnty ELSE 0 END) AS wo_qnty, (CASE WHEN a.item_category=12 and a.booking_type ='3'  THEN b.amount ELSE 0 END) AS amount from wo_booking_mst a,wo_booking_dtls b, gbl_temp_engine c where a.booking_no=b.booking_no  and a.item_category in(2,3,12) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0 and b.po_break_down_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";

			$result_aop_rate=sql_select( $sql_wo_aop );
			foreach ($result_aop_rate as $row)
			{				
				if($row[csf('item_category')]==12)
				{
					$wo_qnty=$row[csf('wo_qnty')];
					$amount=$row[csf('amount')];
					$avg_wo_aop_rate=$amount/$wo_qnty;
					$aop_prod_array[$row[csf('po_id')]]['aop_rate']=$avg_wo_aop_rate;
					$aop_prod_array[$row[csf('po_id')]]['currency_id']=$row[csf('currency_id')];
					$aop_prod_array[$row[csf('po_id')]]['booking_date']=$row[csf('booking_date')];
					$aop_prod_array[$row[csf('po_id')]]['amount']=$row[csf('amount')];
				}
				else
				{
					$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
					$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
					$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
					$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
					$aop_amt_array[$row[csf('po_id')]]['amount']+=$aop_amt;
				}
			} */
			$sql_yarn="SELECT c.id,a.requisition_no,a.receive_basis,a.prod_id,(a.cons_amount) as cons_amount,c.issue_basis,c.issue_number,c.booking_no from inv_transaction a, order_wise_pro_details b, inv_issue_master c, gbl_temp_engine d where  a.id=b.trans_id and  c.id=a.mst_id and c.entry_form in(3) and b.entry_form in(3) and a.transaction_type=2 and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name";
			$result_yarn=sql_select($sql_yarn);
			foreach($result_yarn as $invRow)
			{
				if($invRow[csf('issue_basis')]==1)// Booking
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('booking_no')];
				}
				else if($invRow[csf('issue_basis')]==3)// Requesition
				{
					$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('requisition_no')];
				}
			}			
			$plan_details_array = return_library_array("select a.dtls_id, a.booking_no as booking_no from ppl_planning_entry_plan_dtls a join GBL_TEMP_ENGINE b on a.po_id=b.ref_val where a.company_id=$company_name and b.ref_from=2 and b.entry_form=123 and b.user_id=$user_name group by a.dtls_id,a.booking_no", "dtls_id", "booking_no");
			$reqs_array = array();
			
			$reqs_sql = sql_select("SELECT a.knit_id, a.requisition_no as reqs_no, sum(a.yarn_qnty) as yarn_req_qnty from ppl_planning_entry_plan_dtls b,ppl_yarn_requisition_entry a, gbl_temp_engine c where b.dtls_id=a.knit_id and b.status_active=1 and b.is_deleted=0 and b.po_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by a.knit_id, a.requisition_no");

			foreach ($reqs_sql as $row)
			{
				$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
			}
			unset($reqs_sql);
		    $yarnissue_retData="SELECT d.booking_no,a.item_category,b.po_breakdown_id, b.prod_id, a.mst_id,a.receive_basis, b.issue_purpose,c.lot,c.color,d.exchange_rate,
			(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.transaction_date ELSE null END) AS transaction_date,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN b.quantity+b.reject_qty ELSE 0 END) AS yarn_iss_return_qty,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_amount ELSE 0 END) AS order_amount_ret,
			sum(CASE WHEN a.transaction_type=4 and b.entry_form ='9' and b.trans_type=4 THEN a.order_qnty ELSE 0 END) AS order_qnty_ret
			from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_receive_master d, gbl_temp_engine e where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id  and d.id=a.mst_id and a.item_category in(1) and a.transaction_type in(4) and b.entry_form in(9) and d.entry_form in(9) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1  and b.po_breakdown_id=e.ref_val and e.ref_from=2 and e.entry_form=123 and e.user_id=$user_name and b.issue_purpose in (1)  group by d.booking_no,b.po_breakdown_id, b.prod_id, a.item_category,a.transaction_date,a.receive_basis,a.mst_id,d.exchange_rate,a.transaction_type,b.entry_form,b.trans_type,b.issue_purpose,c.lot,c.color";
			//echo $yarnissue_retData; die;
			$yarnissueretDataArray=sql_select($yarnissue_retData); $yarnissueRetCostArray=array();
			foreach($yarnissueretDataArray as $invRow)
			{
				$issue_purpose=$invRow[csf('issue_purpose')];
				$receive_basis=$invRow[csf('receive_basis')];
				$exchange_rate=$invRow[csf('exchange_rate')];
				if($receive_basis==1) //Booking Basis
				{
					$booking_no=$invRow[csf('booking_no')];
				}
				
				else if($receive_basis==3) //Requisition Basis
				{
					$booking_req_no=$invRow[csf('booking_no')];
					$prog_no=$reqs_array[$booking_req_no]['knit_id'];
					$booking_no=$plan_details_array[$prog_no];
				}
				$booking_type=$booking_array[$booking_no]['btype'];
				$is_short=$booking_array[$booking_no]['is_short'];
				$returnable_ret_qnty=$invRow[csf('returnable_qnty')];
				$issue_ret_qty=$invRow[csf('yarn_iss_return_qty')];
				$order_qnty_ret=$invRow[csf('order_qnty_ret')];
				$order_amount_ret=$invRow[csf('order_amount_ret')];
				$avg_rate=$order_amount_ret/$order_qnty_ret;
				$transaction_date=$invRow[csf('transaction_date')];
				if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
				else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
				$currency_rate=$exchange_rate;
				$currency_id=$receive_curr_array[$invRow[csf('prod_id')]];
				if($receive_array[$invRow[csf('prod_id')]]>0)
				{
					if($currency_id==1) $rate=$receive_array[$invRow[csf('prod_id')]]/$currency_rate;//Taka
					else $rate=$receive_array[$invRow[csf('prod_id')]];	
				}
				else $rate=$avg_rate_array[$invRow[csf('prod_id')]]/$currency_rate;
				
				$iss_ret_amnt=$issue_ret_qty*$rate;
				$retble_iss_ret_amnt=$returnable_ret_qnty*$rate;
				if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
				{
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) //Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else if($issue_purpose==2) //Yarn Dyeing
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
				}
				else //Short Fabric Booking
				{
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($issue_purpose==1 || $issue_purpose==4) // Knit || Sample With Order
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}
					else  if($issue_purpose==2)
					{
						if($recv_purpose==16) //Grey Yarn
						{
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_ret_amt']+=$iss_ret_amnt;
							$yarnissueRetCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_ret_amt']+=$iss_ret_amnt;
						}
					}	
				}
			}
			/* echo '<pre>';
			print_r($yarnissueRetCostArray); die;  */	
			
			$yarnTrimsData="SELECT a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color from inv_transaction a, order_wise_pro_details b,product_details_master c , gbl_temp_engine d where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name and b.issue_purpose in (1)";
			//echo $yarnTrimsData; die;
				
			$yarnTrimsDataArray=sql_select($yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
			foreach($yarnTrimsDataArray as $invRow)
			{
				if($invRow[csf('item_category')]==1)
				{
					$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
					$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
					$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['last_exchange_rate'];
					
					if($invRow[csf('receive_basis')]==1)//Booking Basis
					{
						$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
						{
							$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
							$booking_type=1;
						}
						else
						{
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
					}
					else if($invRow[csf('receive_basis')]==3) //Requisition Basis
					{
						$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
						
						$prog_no=$reqs_array[$booking_req_no]['knit_id'];
						$booking_no=$plan_details_array[$prog_no];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
					}
					$exchange_rate=$last_exchange_rate;
					$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
					$avgrate=$issue_rate/$exchange_rate;
					$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
					if($invRow[csf('entry_form')]==3 && $recv_purpose==16)//recv_purpose==16=Grey Yarn
					{
						if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
						{
							if($invRow[csf('issue_purpose')]==1)//Knitting||Yarn Dyeing||Sample With Order
							{
								$iss_amnt=$invRow[csf('quantity')]*$avgrate;
								$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['yq']+=$invRow[csf('quantity')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_qty_retble']+=$invRow[csf('returnable_qnty')];
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['grey_yarn_amt_retble']+=$retble_iss_amnt;
							}
						}
						else //Short Fabric Booking
						{
							$iss_amnt=$invRow[csf('quantity')]*$avgrate;
							$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
							
							if($invRow[csf('issue_purpose')]==1)//Knitting||Yarn Dyeing||Sample With Order
							{
								/* $yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_qty_retble']+=$returnable_qnty;
								$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt_retble']+=$retble_iss_amnt; */
							}
						}
					}
				}
				else
				{
					$trimsAmt=0;
					$trimsAmt=$invRow[csf('quantity')]*$invRow[csf('cons_rate')];
					$yarnTrimsCostArray[$invRow[csf('po_breakdown_id')]][4]+=$trimsAmt;
				}
			}
			unset($yarnTrimsDataArray);

			$usd_arr = array();
			$sqlSelectData = sql_select("select con_date,conversion_rate from currency_conversion_rate where currency=2 and is_deleted=0 order by con_date desc");
			foreach ($sqlSelectData as $row) 
			{
				$usd_arr[date('d-m-Y',strtotime($row[csf('con_date')]))] = $row[csf('conversion_rate')];
			}

			$cpa_yarnTrimsData="SELECT f.issue_number, e.booking_no, a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color, f.issue_date from inv_transaction a, order_wise_pro_details b, product_details_master c, gbl_temp_engine d, wo_booking_dtls e, inv_issue_master f  where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name and e.po_break_down_id=b.po_breakdown_id and e.booking_type=1 and e.is_short=1 and f.id=a.mst_id and f.is_deleted=0 and f.is_deleted=0 and  a.item_category=1 and f.booking_id=e.booking_mst_id group by f.issue_number, e.booking_no, a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color, f.issue_date";

			//echo $cpa_yarnTrimsData; die;
				
			$cpa_yarnTrimsDataArray=sql_select($cpa_yarnTrimsData);  $i=0; //$yarnTrimsCostArray=array();
			foreach($cpa_yarnTrimsDataArray as $invRow)
			{
				$exchangeRate=$usd_arr[date('d-m-Y',strtotime($invRow[csf('issue_date')]))];
				if($exchangeRate =="")
				{
					foreach ($usd_arr as $rate_date => $rat) 
					{
						if(strtotime($rate_date) <= strtotime($invRow[csf('issue_date')]))
						{
							$rate_date = date('d-m-Y',strtotime($rate_date));
							$exchangeRate=$rat;
							break;
						}
					}
				}
				$avgrate=$invRow[csf('cons_rate')]/$exchangeRate;
				$issue_rate_arr[$invRow[csf('mst_id')]]=$avgrate;
				$iss_amnt=$invRow[csf('quantity')]*$avgrate;
				$cpashortfabriccost_arr[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
				$issue_id_arr[$invRow[csf('mst_id')]]=$invRow[csf('mst_id')];
			}
			$DyedYarnData=sql_select("SELECT f.issue_number, e.booking_no, a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color, f.issue_date from inv_transaction a, order_wise_pro_details b, product_details_master c, gbl_temp_engine d, wo_booking_dtls e, inv_issue_master f, wo_yarn_dyeing_mst g  where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name and e.po_break_down_id=b.po_breakdown_id and e.booking_type=1 and e.is_short=1 and f.id=a.mst_id and f.is_deleted=0 and f.is_deleted=0 and  a.item_category=1 and f.booking_id=g.id group by f.issue_number, e.booking_no, a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color, f.issue_date");
			foreach($DyedYarnData as $invRow)
			{

				$exchangeRate=$usd_arr[date('d-m-Y',strtotime($invRow[csf('issue_date')]))];
				if($exchangeRate =="")
				{
					foreach ($usd_arr as $rate_date => $rat) 
					{
						if(strtotime($rate_date) <= strtotime($invRow[csf('issue_date')]))
						{
							$rate_date = date('d-m-Y',strtotime($rate_date));
							$exchangeRate=$rat;
							break;
						}
					}
				}
				$avgrate=$invRow[csf('cons_rate')]/$exchangeRate;
				$issue_rate_arr[$invRow[csf('mst_id')]]=$avgrate;
				$iss_amnt=$invRow[csf('quantity')]*$avgrate;
				$cpashortfabriccost_arr[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_amt']+=$iss_amnt;
				$issue_id_arr[$invRow[csf('mst_id')]]=$invRow[csf('mst_id')];
			}
			fnc_tempengine("GBL_TEMP_ENGINE", $user_name, 123, 7, $issue_id_arr, $empty_arr);

			$yarn_knitting_rtn=sql_select("SELECT b.cons_quantity, b.issue_id, f.po_breakdown_id from inv_receive_master a, inv_transaction b, inv_issue_master c,product_details_master d, gbl_temp_engine e, order_wise_pro_details f where a.id = b.mst_id and a.issue_id = c.id and b.transaction_type = 4 and b.item_category = 1 and b.prod_id=d.id and a.entry_form = 9 and b.status_active = 1 and b.is_deleted = 0 and a.status_active = 1 and c.id=e.ref_val and e.ref_from=7 and e.entry_form=123 and e.user_id=$user_name and d.id=f.prod_id and f.is_deleted=0 and f.status_active=1 and f.ENTRY_FORM=9  and f.TRANS_TYPE=4 group by b.cons_quantity, b.issue_id, f.po_breakdown_id");
			

			foreach($yarn_knitting_rtn as $invRow)
			{

				$avgrate=$issue_rate_arr[$invRow[csf('issue_id')]];
				$iss_amnt=$invRow[csf('cons_quantity')]*$avgrate;
				$cpashortfabriccost_arr[$invRow[csf('po_breakdown_id')]]['cpa_grey_yarn_rtn_amt']+=$iss_amnt;
			}
			/* echo '<pre>';
			print_r($cpashortfabriccost_arr); die; */


			$greyTransfer_array=array(); 
		
			$sql_grey_transfer="SELECT x.transfer_criteria,x.transfer_date, b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty,sum(a.cons_amount) as cons_amount from inv_item_transfer_mst x, inv_transaction a, order_wise_pro_details b, gbl_temp_engine c where x.id=a.mst_id and a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and x.entry_form in(82,110) and b.entry_form in(82,110) and a.item_category=13 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by x.transfer_criteria,x.transfer_date,b.trans_type, b.po_breakdown_id,a.cons_amount";
			$result_grey_trans=sql_select( $sql_grey_transfer );
			foreach ($result_grey_trans as $row)
			{
				/*if($row[csf('transfer_criteria')]==1)
				{

				}
				else if($row[csf('transfer_criteria')]==4)
				{

				}
				else if($row[csf('transfer_criteria')]==2)
				{

				}*/

				/*$exchangeRateGreyTrans=$usd_arr[date('d-m-Y',strtotime($row[csf('transfer_date')]))];
				echo $exchangeRateGreyTrans.",";
				if($exchangeRateGreyTrans =="")
				{
					foreach ($usd_arr as $rate_date => $rat) 
					{
						if(strtotime($rate_date) <= strtotime($row[csf('issue_date')]))
						{
							$rate_date = date('d-m-Y',strtotime($rate_date));
							$exchangeRateGreyTrans=$rat;
							break;
						}
					}
				}
				$avgrateGreyTran=$row[csf('cons_rate')]/$exchangeRateGreyTrans;
				$transAmount=$row[csf('qnty')]*$avgrateGreyTran;*/



				$greyTransfer_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]['qnty']=$row[csf('qnty')];
				//$greyTransfer_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]['cons_rate']=$row[csf('cons_rate')];
				$greyTransfer_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]['cons_amount']=$row[csf('cons_amount')];
				$greyTransfer_arr[$row[csf('po_breakdown_id')]]['transfer_criteria']=$row[csf('transfer_criteria')];
				//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
			}
			//print_r($greyTransfer_arr);
			echo $transAmount;
			unset($result_grey_trans);




					
			$sql_garments="SELECT b.po_break_down_id as po_id,b.embel_name,b.production_date,b.production_type,
				(CASE WHEN b.embel_name=1 THEN b.production_quantity ELSE 0 END) AS printing_qty,
				(CASE WHEN b.embel_name=2 THEN b.production_quantity ELSE 0 END) AS embro_qty,
				(CASE WHEN b.embel_name=3 THEN b.production_quantity ELSE 0 END) AS wash_qty,
				(CASE WHEN b.embel_name=5 THEN b.production_quantity ELSE 0 END) AS dyeing_qty
				 from pro_garments_production_mst b, gbl_temp_engine c where  b.production_type=2 and b.is_deleted=0 and b.status_active=1 and b.status_active=1 and b.is_deleted=0  and b.po_break_down_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";
				$result_gar=sql_select( $sql_garments );
				foreach ($result_gar as $row)
				{
					$embl_issue_prod_array[$row[csf('po_id')]]['printing_qty']+=$row[csf('printing_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['embro_qty']+=$row[csf('embro_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['wash_qty']+=$row[csf('wash_qty')];
					$embl_issue_prod_array[$row[csf('po_id')]]['dyeing_qty']+=$row[csf('dyeing_qty')];
				}
				unset($result_gar);
			
				//print_r($yarnTrimsCostArray);
				$recvIssue_array=array(); 
				$sql_trans="SELECT b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty from inv_transaction a, order_wise_pro_details b, gbl_temp_engine c where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(80,82,81,83,84,13,94) and a.item_category=13 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by b.trans_type, b.po_breakdown_id";
				$result_trans=sql_select( $sql_trans );
				foreach ($result_trans as $row)
				{
					$recvIssue_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_trans);
				
				
				/* $trims_trans_array=array(); 
				
				$sql_trims_inv="SELECT a.transaction_date, b.order_amount as cons_amount, a.prod_id,b.po_breakdown_id as po_id, b.quantity as qnty,c.exchange_rate, c.currency_id from inv_transaction a, order_wise_pro_details b, inv_receive_master c, gbl_temp_engine d  where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.entry_form in(24) and a.item_category=4 and a.transaction_type in(1) and b.trans_type in(1) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name " ;
				//echo $sql_trims_inv;die;
				$result_trims=sql_select( $sql_trims_inv );
				foreach ($result_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					$currency_id=$row[csf('currency_id')];
					$currency_rate=$row[csf('exchange_rate')];
					if($currency_id==2){
						$usd_rate=$currency_rate;
					}
					
					if($currency_id==1){
						$currency_rate=$usd_rate*$currency_rate;
					}elseif($currency_id==2){
						$currency_rate=$usd_rate;
					}else {
						$currency_rate=$currency_rate;
					}
					$amt=0;
					$amt=$row[csf('cons_amount')];
					$trims_trans_array[$row[csf('po_id')]]['amt']+=$amt;
					
					$last_exchnage_rateArr[$row[csf('prod_id')]]=$row[csf('exchange_rate')];
				}
				unset($result_trims); */
				
				$gen_trims_issue_array=array(); 
				 $sql_gen_trims_inv="SELECT b.transaction_date,(b.cons_amount) as cons_amount,b.order_id as po_id,b.prod_id from inv_issue_master  a, inv_transaction b, gbl_temp_engine c where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form in(21) and b.transaction_type in(2) and b.order_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name";
				$result_gen_trims=sql_select( $sql_gen_trims_inv );
				foreach ($result_gen_trims as $row)
				{
					$transaction_date=$row[csf('transaction_date')];
					if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					$currency_rate=$last_exchnage_rateArr[$row[csf('prod_id')]];
					$gen_trims_issue_array[$row[csf('po_id')]]['amt']+=$row[csf('cons_amount')]/$currency_rate;
				}
				unset($result_gen_trims);
				//die;
				
				$fin_fab_trans_array=array(); 
				 $sql_fin_trans="SELECT b.trans_type, b.po_breakdown_id, sum(b.quantity) as qnty
				  from inv_transaction a, order_wise_pro_details b, gbl_temp_engine c where a.id=b.trans_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15,14) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by b.trans_type, b.po_breakdown_id";
				  //echo $sql_fin_trans; die;
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
					$fin_fab_trans_array[$row[csf('po_breakdown_id')]][$row[csf('trans_type')]]=$row[csf('qnty')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				
				$batch_trans_array=array(); 
				$sql_batch="SELECT a.id,a.booking_no,batch_weight as batch_weight from  pro_batch_create_mst a,pro_batch_create_dtls b, gbl_temp_engine c where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and b.po_id=c.ref_val and c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name group by a.id,batch_weight,a.booking_no";
				$result_batch=sql_select( $sql_batch );
				foreach ($result_batch as $row)
				{
					$batch_trans_array[$row[csf('id')]]['book']=$row[csf('booking_no')];
					$batch_weight_array[$row[csf('id')]]['batch_weight']=$row[csf('batch_weight')];
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}
				unset($result_batch);
				
				$dye_fin_fab_array=array(); 
				 $sql_fin_trans="SELECT a.receive_date,a.exchange_rate, b.po_breakdown_id,c.mst_id,c.batch_id,c.body_part_id, sum(b.quantity) as finish_qnty from inv_receive_master a,pro_finish_fabric_rcv_dtls c, order_wise_pro_details b, gbl_temp_engine d where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(7) and a.item_category=2   and b.trans_type in(1) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name group by a.exchange_rate,a.receive_date, b.po_breakdown_id,c.batch_id,c.mst_id,c.body_part_id";
				$result_fin_trans=sql_select( $sql_fin_trans );
				foreach ($result_fin_trans as $row)
				{
					$receive_date=$row[csf('receive_date')];
					$booking_no=$batch_trans_array[$row[csf('batch_id')]]['book'];
					$booking_type=$booking_array[$booking_no]['btype'];
					$is_short=$booking_array[$booking_no]['is_short'];
					$batch_weight=$batch_weight_array[$row[csf('batch_id')]]['batch_weight'];
					$dye_finish_charge=$prodcostArray[$row[csf('po_breakdown_id')]][$row[csf('deter_id')]][$row[csf('body_part_id')]]['dye_finish_charge'];
					if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
					{
						
						$finish_qnty=$row[csf('finish_qnty')]*$dye_finish_charge;
					}
					else //short Fab. booking 
					{
						$cpa_batch_weight=$batch_weight*$dye_finish_charge;
					}
					//echo $finish_qnty.'='.$cpa_finish_qnty;
					if($db_type==0)
					{
						$conversion_date=change_date_format($receive_date, "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($receive_date, "d-M-y", "-",1);
					}
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['fin_amt']=$finish_qnty;
					$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['cpa_batch_weight']+=$cpa_batch_weight;
					$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['ex_rate']=$currency_rate;
				}
				unset($result_fin_trans);

	//================================================knitting cost=============================================
	//Zakaria joy(16/09/23)
	$service_booking_rate=sql_select("SELECT b.rate, b.po_break_down_id as po_id, b.booking_mst_id as booking_id from wo_booking_mst a join wo_booking_dtls b on a.id=b.booking_mst_id join gbl_temp_engine c on b.po_break_down_id=c.ref_val where c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.rate>0 group by b.rate, b.po_break_down_id, b.booking_mst_id");
	$sbooking_rate_arr=array();
	foreach($service_booking_rate as $row){
		$sbooking_rate_arr[$row[csf('po_id')]][$row[csf('booking_id')]]=$row[csf('rate')];
	}
	$grey_roll_rcv=sql_select("SELECT a.po_breakdown_id as po_id,  d.id as booking_id, sum(a.qnty) as  qnty from pro_roll_details a, pro_roll_details b, inv_receive_master c, wo_booking_mst d, gbl_temp_engine e where a.entry_form= 58 and a.is_sales=0 and a.booking_without_order=0 and a.barcode_no=b.barcode_no and b.entry_form=2 and b.mst_id=c.id and c.entry_form=2 and c.service_booking_no is not null and a.status_active=1 and b.status_active=1 and c.status_active=1 and d.booking_no=c.service_booking_no and a.po_breakdown_id=e.ref_val and e.ref_from=2 and e.entry_form=123 and e.user_id=$user_name and d.entry_form=182 and d.status_active=1 and d.is_deleted=0 group by a.po_breakdown_id, d.id");
	
	$knit_fin_fab_array=array();
	foreach($grey_roll_rcv as $row){
		$rate=$sbooking_rate_arr[$row[csf('po_id')]][$row[csf('booking_id')]];
		$knit_fin_fab_array[$row[csf('po_id')]]['knit_gross_amt']+=$row[csf('qnty')]*$rate;
	}
   unset($con_fab_data);
   $dye_fin_fab_array=array(); 

   $dye_booking_data=sql_select("SELECT a.entry_form,a.company_id,a.booking_date,a.currency_id,b.fabric_color_id as color_id,avg(b.rate) as rate, b.po_break_down_id as po_id, b.printing_color_id from wo_booking_mst a join wo_booking_dtls b on a.id=b.booking_mst_id join gbl_temp_engine c on b.po_break_down_id=c.ref_val where c.ref_from=2 and c.entry_form=123 and c.user_id=$user_name and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.rate>0 and b.booking_type=3 and a.entry_form in (232, 162) group by b.po_break_down_id,b.fabric_color_id, a.currency_id, a.booking_date, a.company_id, a.entry_form, b.printing_color_id");

   $dyefin_rate_arr=array();
   foreach($dye_booking_data as $data){
		$currency_id=$data[csf('currency_id')];
		if($currency_id==0){
			$currency_id=2;
		}
		$conversion_date=change_date_format($data[csf('booking_date')], "d-M-y", "-",1);
		$currency_rate=set_conversion_rate(2,$conversion_date,$data[csf('company_id')]);
		if($currency_id==2){
			$rate=$data[csf('rate')];
		}
		else{
			$rate=$data[csf('rate')]/$currency_rate;
		}
		if($data[csf('entry_form')]==232){
			$dyefin_rate_arr[$data[csf('po_id')]][$data[csf('color_id')]]=$rate;
		}
		if($data[csf('entry_form')]==162){
			$aop_wo_rate_arr[$data[csf('po_id')]][$data[csf('printing_color_id')]]=$rate;
		}
	   	
   }
   
   $dye_cost_in_sql=sql_select("SELECT b.color_id,c.po_breakdown_id, sum(c.qnty) as qnty from  inv_receive_master a join pro_finish_fabric_rcv_dtls b on a.id=b.mst_id join pro_roll_details c on b.id=c.dtls_id join gbl_temp_engine d on c.po_breakdown_id=d.ref_val where a.entry_form=68 and c.entry_form=68  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name group by b.color_id,c.po_breakdown_id");

   foreach($dye_cost_in_sql as $row){
		$rate=$dyefin_rate_arr[$row[csf('po_breakdown_id')]][$row[csf('color_id')]];
		$aoprate=$aop_wo_rate_arr[$row[csf('po_breakdown_id')]][$row[csf('color_id')]];
		$dye_fin_fab_array[$row[csf('po_breakdown_id')]]['dye_gross_amt']+=$row[csf('qnty')]*$rate;
		$aop_prod_array[$row[csf('po_breakdown_id')]]['amount']+=$row[csf('qnty')]*$aoprate;
   }
   
   $main_fabric_booking_data=sql_select("SELECT b.po_break_down_id as po_id, b.fabric_color_id as fabric_color, avg(b.rate) as rate, c.lib_yarn_count_deter_id, a.booking_date,a.currency_id from wo_booking_mst a join wo_booking_dtls b on a.id=b.booking_mst_id join wo_pre_cost_fabric_cost_dtls c on b.pre_cost_fabric_cost_dtls_id=c.id join gbl_temp_engine d on b.po_break_down_id=d.ref_val where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name and a.booking_type=1 and a.is_short=2 group by b.po_break_down_id, b.fabric_color_id, c.lib_yarn_count_deter_id, a.booking_date, a.currency_id");
   
   $fabric_booking_rate=array();
   foreach($main_fabric_booking_data as $row){
		$currency_id=$row[csf('currency_id')];
		if($currency_id==0){
			$currency_id=2;
		}
		$conversion_date=change_date_format($row[csf('booking_date')], "d-M-y", "-",1);
		$currency_rate=set_conversion_rate(2,$conversion_date,$data[csf('company_id')]);
		if($currency_id==2){
			$rate=$row[csf('rate')];
		}
		else{
			$rate=$row[csf('rate')]/$currency_rate;
		}
		$fabric_booking_rate[$row[csf('po_id')]][$row[csf('fabric_color')]][$row[csf('lib_yarn_count_deter_id')]]=$rate;
   }
   $fabric_purchase_knit_data=sql_select("SELECT c.quantity, b.fabric_description_id, c.po_breakdown_id, c.color_id from inv_receive_master a join pro_finish_fabric_rcv_dtls b on a.id=b.mst_id join order_wise_pro_details c on b.trans_id=c.trans_id and b.prod_id=c.prod_id and b.id=c.dtls_id join wo_po_break_down d on c.po_breakdown_id=d.id join gbl_temp_engine e on e.ref_val=d.id where e.entry_form=123 and e.ref_from=2 and e.user_id=$user_name and c.entry_form in (17,37) and c.trans_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0");
   foreach($fabric_purchase_knit_data as $row){
		$rate=$fabric_booking_rate[$row[csf('po_breakdown_id')]][$row[csf('color_id')]][$row[csf('fabric_description_id')]];
		$finish_purchase_amnt_arr[$row[csf('po_breakdown_id')]]+=$row[csf('quantity')]*$rate;
   }

   $trims_wo_rate=sql_select("SELECT a.id as booking_id, b.po_break_down_id, b.rate, c.trim_group from wo_booking_mst a join wo_booking_dtls b on a.id=b.booking_mst_id join wo_pre_cost_trim_cost_dtls c on b.pre_cost_fabric_cost_dtls_id=c.id join gbl_temp_engine d on d.ref_val=b.po_break_down_id where a.booking_type=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.entry_form=123 and d.ref_from=2 and d.user_id=$user_name");
   $trim_booking_rate=array();
   foreach($trims_wo_rate as $row){
		$trim_booking_rate[$row[csf('booking_id')]][$row[csf('po_break_down_id')]][$row[csf('trim_group')]]=$row[csf('rate')];
   }
   
   $trims_rcv=sql_select("SELECT c.quantity, d.booking_mst_id, b.item_group_id as trim_group, c.po_breakdown_id from inv_receive_master a join inv_trims_entry_dtls b on a.id=b.mst_id join order_wise_pro_details c on b.trans_id=c.trans_id and b.prod_id=c.prod_id and b.id=c.dtls_id join wo_booking_dtls d on c.po_breakdown_id=d.po_break_down_id join gbl_temp_engine e on e.ref_val=d.po_break_down_id where e.entry_form=123 and e.ref_from=2 and e.user_id=$user_name and c.entry_form=24 and c.trans_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and d.booking_type=2 group by c.quantity, d.booking_mst_id, b.item_group_id, c.po_breakdown_id");
	$trims_rcv_arr=array();
	foreach($trims_rcv as $row){
		$trims_rate=$trim_booking_rate[$row[csf('booking_mst_id')]][$row[csf('po_breakdown_id')]][$row[csf('trim_group')]];
		$trims_trans_array[$row[csf('po_breakdown_id')]]['amt']+=$row[csf('quantity')]*$trims_rate;
	}

	$print_embroidery_wo=sql_select("SELECT b.po_break_down_id, b.rate, c.emb_name, c.emb_type from wo_booking_mst a join wo_booking_dtls b on a.id=b.booking_mst_id join wo_pre_cost_embe_cost_dtls c on b.pre_cost_fabric_cost_dtls_id=c.id join gbl_temp_engine d on d.ref_val=b.po_break_down_id where d.entry_form=123 and d.ref_from=2 and d.user_id=$user_name and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.emb_name in (1,2)");
	$print_embroidery_rate=array();
	foreach($print_embroidery_wo as $row){
		$print_embroidery_rate[$row[csf('po_break_down_id')]][$row[csf('emb_name')]][$row[csf('emb_type')]]=$row[csf('rate')];
	}

	$print_rcv_data=sql_select("SELECT a.embel_name, a.embel_type, b.po_break_down_id, b.production_quantity from pro_gmts_delivery_mst a join pro_garments_production_mst b on a.id=b.delivery_mst_id join gbl_temp_engine c on c.ref_val=b.po_break_down_id where c.entry_form=123 and c.ref_from=2 and c.user_id=$user_name and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.production_type=3");
	$printing_cost_arr=array(); $embro_cost_arr=array();
	foreach($print_rcv_data as $row){
		if($row[csf('embel_name')]==1){
			$print_rate=$print_embroidery_rate[$row[csf('po_break_down_id')]][1][$row[csf('embel_type')]];
			$printing_cost_arr[$row[csf('po_break_down_id')]]['amount']+=$row[csf('production_quantity')]*$print_rate;
		}
		else{
			$embro_rate=$print_embroidery_rate[$row[csf('po_break_down_id')]][2][$row[csf('embel_type')]];
			$embro_cost_arr[$row[csf('po_break_down_id')]]['amount']+=$row[csf('production_quantity')]*$embro_rate;
		}
	}
	//echo $print_rcv_data; die;

  	
   	$cm_cost_arr=array(); 
	$cm_cost_sql="select a.amount, a.po_id from wo_actual_cost_entry a join gbl_temp_engine b on a.po_id=b.ref_val where a.cost_head=5 $po_cond_for_in2 and a.status_active=1 and a.is_deleted=0 and b.ref_from=2 and b.entry_form=123 and b.user_id=$user_name ";
   	$cm_cost_data=sql_select($cm_cost_sql);
	foreach($cm_cost_data as $row )
	{
		$exchange_rate=$po_exchange_rateArr[$row[csf("po_id")]]['exchange_rate'];
	 	$cm_cost_arr[$row[csf('po_id')]]['cm_amt']+=$row[csf('amount')]/$exchange_rate;
	}
	unset($cm_cost_data); 
  
   //======================================================conversion cost end ===================
				
			$grey_fab_array=array();  //Knitting Cost actual 
			$sql_grey_trans="SELECT  a.id,a.exchange_rate,a.currency_id,a.receive_basis,a.booking_no,a.receive_date,b.po_breakdown_id,c.febric_description_id as deter_id,c.body_part_id, c.kniting_charge, (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c, gbl_temp_engine d where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(2,13) and b.trans_type in(1) and b.po_breakdown_id=d.ref_val and d.ref_from=2 and d.entry_form=123 and d.user_id=$user_name";
			$result_grey=sql_select( $sql_grey_trans );
			$currency_id=1;
			foreach ($result_grey as $row)
			{
					$transaction_date=$row[csf('transaction_date')];
					$receive_basis=$row[csf('receive_basis')];
					$exchange_rate=$row[csf('exchange_rate')];
					$currency_id=$row[csf('currency_id')];
					if($db_type==0)
					{
						$conversion_date=change_date_format($row[csf('receive_date')], "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($row[csf('receive_date')], "d-M-y", "-",1);
					}
					//$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
					$exchange_rate=$exchange_rate;
					if($currency_id==1) //TK
					{
						$knit_charge=$row[csf('kniting_charge')]/$exchange_rate;
						
					}
					else
					{
						$knit_charge=$row[csf('kniting_charge')];
					}
					if($receive_basis==1) //Booking Basis
					{
							$booking_no=$row[csf('booking_no')];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
						//echo $booking_type.'='.$is_short;
					}
					else if($receive_basis==2) //Knit plan Basis
					{
							$prog_no=$grey_knit_array[$row[csf('mst_id')]];
						$booking_no=$plan_details_array[$row[csf('booking_no')]];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
					}
					else if($receive_basis==4) //Salse Basis
					{
							$prog_no=$row[csf('booking_no')];
						$booking_no=$plan_details_array[$prog_no];
						$booking_type=$booking_array[$booking_no]['btype'];
						$is_short=$booking_array[$booking_no]['is_short'];
						
					}
					
					if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
					{
						$grey_amt=$row[csf('grey_qnty')]*$knit_charge;
					}

					else //short Fab. booking 
					{
						$cpa_grey_amt=$row[csf('grey_qnty')]*$knit_charge;
					}
					if($db_type==0)
					{
						$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
					}
					else
					{
						$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
					}
					//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
					$currency_rate=$exchange_rate;
				$grey_fab_array[$row[csf('po_breakdown_id')]]['qnty']+=$row[csf('grey_qnty')];
				$grey_fab_array[$row[csf('po_breakdown_id')]]['grey_amt']+=$grey_amt;
				$grey_fab_array[$row[csf('po_breakdown_id')]]['cpa_grey_amt']+=$cpa_grey_amt;
				
			}
			unset($result_grey);
			
			/* $actualCostArray=array();
			$actualCostDataArray="select a.cost_head,a.po_id,sum(a.amount_usd) as amount_usd from wo_actual_cost_entry a join gbl_temp_engine b on a.po_id=b.ref_val where a.company_id=$company_name and a.status_active=1 and a.is_deleted=0 and b.ref_from=2 and b.entry_form=123 and b.user_id=$user_name group by a.cost_head,a.po_id";
			$actual_results=sql_select($actualCostDataArray);
			foreach($actual_results as $actualRow)
			{
				$actualCostArray[$actualRow[csf('cost_head')]][$actualRow[csf('po_id')]]=$actualRow[csf('amount_usd')];
			} */
			unset($actual_results);

			//////////////=======================booking no==============================

			$booking_sql="select a.booking_no,a.po_break_down_id from wo_booking_dtls a join gbl_temp_engine b on a.po_break_down_id=b.ref_val where b.ref_from=2 and b.entry_form=123 and b.user_id=$user_name and a.booking_type=1 and a.status_active=1 and a.is_deleted=0 group by a.booking_no,a.po_break_down_id";
			//echo $booking_sql; die;
			$booking_data=sql_select($booking_sql);
			foreach( $booking_data as $row ){		
				$booking_number[$row[csf("po_break_down_id")]]['booking']=$row[csf("booking_no")];	
			}
			unset($booking_data); 
			

			///////=========================end  booking no================================
			
			$i=1; $tot_po_qnty=0; $tot_po_value=0; $tot_ex_factory_qnty=0; $tot_ex_factory_val=0; $tot_yarn_cost_mkt=0; $tot_knit_cost_mkt=0; $tot_dye_finish_cost_mkt=0; $tot_yarn_dye_cost_mkt=0; $tot_aop_cost_mkt=0; $tot_trims_cost_mkt=0; $tot_embell_cost_mkt=0; $tot_wash_cost_mkt=0; $tot_commission_cost_mkt=0; $tot_comm_cost_mkt=0; $tot_freight_cost_mkt=0; $tot_test_cost_mkt=0; $tot_inspection_cost_mkt=0; $tot_currier_cost_mkt=0; $tot_cm_cost_mkt=0; $tot_mkt_all_cost=0; $tot_mkt_margin=0; $tot_yarn_cost_actual=0; $tot_knit_cost_actual=0; $tot_dye_finish_cost_actual=0; $tot_yarn_dye_cost_actual=0; $tot_aop_cost_actual=0; $tot_trims_cost_actual=0; $tot_embell_cost_actual=0; $tot_wash_cost_actual=0; $tot_commission_cost_actual=0; $tot_comm_cost_actual=0; $tot_freight_cost_actual=0; $tot_test_cost_actual=0; $tot_inspection_cost_actual=0; $tot_currier_cost_actual=0; $tot_cm_cost_actual=0; $tot_actual_all_cost=0; $tot_actual_margin=0; $tot_fabric_purchase_cost_mkt=$total_fabric_cost_mkt=0; $tot_fabric_purchase_cost_actual=$tot_grey_fab_cost_actual=$tot_grey_fab_transfer_amt_actual=$tot_actual_net_margin=0;$tot_print_amount_mkt=$tot_embro_amount_mkt=$tot_dyeing_amount_mkt=$tot_wash_amount_mkt=$tot_print_amount_actual=$tot_embro_amount_actual=$tot_dyeing_amount_actual=$tot_wash_amount_actual=$tot_finished_fab_cost_actual=$tot_fin_fab_transfer_amt_actual=$tot_yarn_dyeing_twist_actual=$tot_grey_fab_transfer_amt_actual=$tot_yarn_qty_actual=$tot_yarn_amt_actual=$tot_grey_fab_cost_mkt=$tot_yarn_value_addition_cost_mkt=$total_fabric_cost=$tot_fabric_cost_actaul=$tot_yarn_qty_cpa_actual=$total_finish_fabric_cost_mkt=$tot_yarn_qty_cpa_actual=$tot_gray_transfer_actual=0;
			$buyer_name_array=array();
			$mkt_po_val_array = array(); $mkt_yarn_array = array(); $mkt_knit_array = array(); $mkt_dy_fin_array = array(); $mkt_yarn_dy_array = array();
			$mkt_aop_array = array(); $mkt_trims_array = array(); $mkt_emb_array = array(); $mkt_wash_array=array(); $mkt_commn_array=array(); $mkt_commercial_array=array();
			$mkt_freight_array = array(); $mkt_test_array = array(); $mkt_ins_array = array(); $mkt_courier_array = array(); $mkt_cm_array = array();
			$mkt_total_array = array(); $mkt_margin_array = array(); $mkt_fabric_purchase_array = array();
			
			$ex_factory_val_array= array(); $yarn_cost_array= array(); $knit_cost_array= array(); $dye_cost_array= array(); $yarn_dyeing_cost_array= array();
			$aop_n_others_cost_array= array(); $trims_cost_array= array(); $enbellishment_cost_array= array(); $wash_cost_array= array(); $commission_cost_array= array(); 
			$commercial_cost_array= array(); $freight_cost_array= array(); $testing_cost_array= array(); $inspection_cost_array= array(); $courier_cost_array= array();
			$cm_cost_array= array(); $total_cost_array= array(); $margin_array= array(); $ex_factory_array=array(); $actual_cm_amnt=array(); $actual_fabric_purchase_array = array();
							
				$condition= new condition();
				$condition->company_name("=$company_name");
				if(str_replace("'","",$cbo_buyer_name)>0){
					$condition->buyer_name("=$cbo_buyer_name");
				}
				if(str_replace("'","",$txt_file_no) !=''){
					$condition->file_no("='$txt_file_no'");
				}
				if(str_replace("'","",$txt_ref_no) !=''){
					$condition->grouping("='$txt_ref_no'");
				}
				
				if(str_replace("'","",$txt_job_no) !=''){
					$condition->job_no_prefix_num("=$txt_job_no");
				}
				if(trim(str_replace("'","",$txt_order_no))!='')
				{
				//$condition->po_number(" like '%".trim(str_replace("'","",$txt_order_no))."%'"); 
				$condition->po_number("='".trim(str_replace("'","",$txt_order_no))."'"); 
				}
				if(str_replace("'","",$txt_date_from)!='' && str_replace("'","",$txt_date_to)!='')
				{
					$start_date=str_replace("'","",$txt_date_from);
					$end_date=str_replace("'","",$txt_date_to);
					$condition->pub_shipment_date(" between '$start_date' and '$end_date'");
				}
				if(count($po_id_arr)>0){
					$po_id_str=implode(",",$po_id_arr);
					$condition->po_id_in($po_id_str); 
				}
				
				
				$condition->init();
			
				$yarn= new yarn($condition);
				//echo $yarn->getQuery();die;
				$yarn_costing_arr=$yarn->getOrderWiseYarnAmountArray();
				//$yarn= new yarn($condition);
				$yarn_costing_qty_arr=$yarn->getOrderWiseYarnQtyArray();
				$conversion= new conversion($condition);
				$conversion_costing_arr_process=$conversion->getAmountArray_by_orderAndProcess(); 
				//$conversion= new conversion($condition);
				$conversion_costing_arr_process_qty=$conversion->getQtyArray_by_orderAndProcess();
				$trims= new trims($condition);
				$trims_costing_arr=$trims->getAmountArray_by_order();
				$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name=$emblishment->getAmountArray_by_orderAndEmbname();
				//$emblishment= new emblishment($condition);
				$emblishment_costing_arr_name_qty=$emblishment->getQtyArray_by_orderAndEmbname();
				$commission= new commision($condition);
				$commission_costing_arr=$commission->getAmountArray_by_order();
				$commercial= new commercial($condition);
				$commercial_costing_arr=$commercial->getAmountArray_by_order();
				$other= new other($condition);
				$other_costing_arr=$other->getAmountArray_by_order();
				$wash= new wash($condition);
				$emblishment_costing_arr_name_wash=$wash->getAmountArray_by_orderAndEmbname();
				$emblishment_costing_arr_name_wash_qty=$wash->getQtyArray_by_orderAndEmbname();
				$fabric= new fabric($condition);

				/* echo '<pre>';
				print_r($commission_costing_arr); die; */
			//echo $fabric->getQuery(); die;
			$fabric_costing_arr=$fabric->getAmountArray_by_order_knitAndwoven_greyAndfinish();
			$usd_id=2;//===============Dollar========
			//print_r($fabric_costing_arr);die;
			$not_yarn_dyed_cost_arr=array(1,2,30,134,35); $job_ids='';
			$tot_certificate_cost_mkt=$tot_deffdlc_cost_mkt=$tot_design_cost_mkt=$tot_studio_cost_mkt=$tot_operating_exp_mkt=$tot_interest_cost_mkt=$tot_incometax_cost_mkt=$tot_depr_amor_pre_cost_mkt=0;
			foreach($result as $row)
			{
				if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				
				$po_ids_array[]=$row[csf('id')];
					$job_ids.=$row[csf('job_no')].',';
				$gmts_item='';
				$gmts_item_id=explode(",",$row[csf('gmts_item_id')]);
				foreach($gmts_item_id as $item_id)
				{
					if($gmts_item=="") $gmts_item=$garments_item[$item_id]; else $gmts_item.=",".$garments_item[$item_id];
				}
				
				$order_qnty_in_pcs=$row[csf('po_quantity')]*$row[csf('ratio')];
				$plan_cut_qnty=$row[csf('plan_cut')]*$row[csf('ratio')];
				$unit_price=$row[csf('unit_price')]/$row[csf('ratio')];
				$po_value=$order_qnty_in_pcs*$unit_price;
				
				$tot_po_qnty+=$order_qnty_in_pcs; 
				$tot_po_value+=$po_value;
				//echo "DDD";die;
				$ex_factory_qty=$ex_factory_arr[$row[csf('id')]];
				$ex_factory_value=$ex_factory_qty*$unit_price;
				
				$tot_ex_factory_qnty+=$ex_factory_qty; 
				$tot_ex_factory_val+=$ex_factory_value; 
				
				$dzn_qnty=0;
				$costing_per_id=$fabriccostArray[$row[csf('job_no')]]['costing_per_id'];
				if($costing_per_id==1) $dzn_qnty=12;
				else if($costing_per_id==3) $dzn_qnty=12*2;
				else if($costing_per_id==4) $dzn_qnty=12*3;
				else if($costing_per_id==5) $dzn_qnty=12*4;
				else $dzn_qnty=1;

				$dzn_qnty=$dzn_qnty*$row[csf('ratio')];
				$yarn_cost_mkt=$yarn_costing_arr[$row[csf('id')]];
					$yarn_cost_mkt_qty=$yarn_costing_qty_arr[$row[csf('id')]];
				$knit_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][1]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['knit_charge'];
				$knit_qty_mkt=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][1]);
				$yarn_dyeing_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][30]);
				//if($yarn_dyeing_cost_mkt) $yarn_dyeing_cost_mkt=$yarn_dyeing_cost_mkt;else $yarn_dyeing_cost_mkt=0;
				$twisting_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][134]);
				//if($twisting_cost_mkt) $twisting_cost_mkt=$twisting_cost_mkt;else $twisting_cost_mkt=0;
				$yarn_value_addition_cost_mkt=$yarn_dyeing_cost_mkt+$twisting_cost_mkt;
				//echo $yarn_dyeing_cost_mkt.'=='.$twisting_cost_mkt.', ';
				
				if($knit_cost_mkt>0)
				{
				$knit_charge_mkt=$knit_cost_mkt/$knit_qty_mkt;//$dye_finish_cost_mkt_qty
				}
				
				$dye_finish_cost_mkt=0;$dye_finish_cost_mkt_qty=0;
				foreach($conversion_cost_head_array as $process_id=>$val)
				{
					if(!in_array($process_id,$not_yarn_dyed_cost_arr))
					{
						$dye_finish_cost_mkt+=array_sum($conversion_costing_arr_process[$row[csf('id')]][$process_id]);
						
						$dye_finish_cost_mkt_qty+=array_sum($conversion_costing_arr_process_qty[$row[csf('id')]][$process_id]);
					}
				}	
				if($dye_finish_cost_mkt>0)
				{			
				$knit_charge_mkt_fin=$dye_finish_cost_mkt/$dye_finish_cost_mkt_qty;
				}
				$aop_cost_mkt=array_sum($conversion_costing_arr_process[$row[csf('id')]][35]);//($plan_cut_qnty/$dzn_qnty)*$prodcostArray[$row[csf('job_no')]]['aop_charge'];
				$trims_cost_mkt=$trims_costing_arr[$row[csf('id')]];//($order_qnty_in_pcs/$dzn_qnty)*$trimsCostArray[$row[csf('id')]];
			
				
				$print_amount=$emblishment_costing_arr_name[$row[csf('id')]][1];
				$print_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][1];
				if($print_amount) $print_amount=$print_amount;else $print_amount=0;
				if($print_qty) $print_qty=$print_qty;else $print_qty=0;
				if($print_amount==0 || $print_qty==0) $print_avg_rate=0;
				else $print_avg_rate=$print_amount/$print_qty;
					
				$embroidery_amount=$emblishment_costing_arr_name[$row[csf('id')]][2];
				$embroidery_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][2];
				if($embroidery_amount) $embroidery_amount=$embroidery_amount;else $embroidery_amount=0;
				if($embroidery_qty) $embroidery_qty=$embroidery_qty;else $embroidery_qty=0;
				if($embroidery_amount==0 || $embroidery_qty==0) $embro_avg_rate=0;
				else $embro_avg_rate=$embroidery_amount/$embroidery_qty;
				//$special_amount=$emblishment_costing_arr_name[$row[csf('id')]][4];
				$wash_cost=$emblishment_costing_arr_name_wash[$row[csf('id')]][3];
				$wash_qty=$emblishment_costing_arr_name_wash_qty[$row[csf('id')]][3];
				if($wash_cost) $wash_cost=$wash_cost;else $wash_cost=0;
				if($wash_qty) $wash_qty=$wash_qty;else $wash_qty=0;
				if($wash_cost==0 || $wash_qty==0) $wash_avg_rate=0;
				else $wash_avg_rate=$wash_cost/$wash_qty;
				
				$other_amount=$emblishment_costing_arr_name[$row[csf('id')]][5];
				$dyeing_qty=$emblishment_costing_arr_name_qty[$row[csf('id')]][5];
				if($other_amount) $other_amount=$other_amount;else $other_amount=0;
				if($dyeing_qty) $dyeing_qty=$dyeing_qty;else $dyeing_qty=0;
				if($other_amount==0 || $dyeing_qty==0) $dyeing_avg_rate=0;
				else $dyeing_avg_rate=$other_amount/$dyeing_qty;
				
				$foreign_cost=$commission_costing_arr[$row[csf('id')]][1];
				$local_cost=$commission_costing_arr[$row[csf('id')]][2];
				
				$test_cost=$other_costing_arr[$row[csf('id')]]['lab_test'];
				$freight_cost=$other_costing_arr[$row[csf('id')]]['freight'];
				$inspection_cost=$other_costing_arr[$row[csf('id')]]['inspection'];
			
				$certificate_cost_mkt=$other_costing_arr[$row[csf('id')]]['certificate_pre_cost'];
				$deffdlc_cost_mkt=$other_costing_arr[$row[csf('id')]]['deffdlc_cost'];
				$design_cost_mkt=$other_costing_arr[$row[csf('id')]]['design_cost'];
				$studio_cost_mkt=$other_costing_arr[$row[csf('id')]]['studio_cost'];
				$operating_exp_mkt=$other_costing_arr[$row[csf('id')]]['common_oh'];
				$interest_cost_mkt=$other_costing_arr[$row[csf('id')]]['interest_cost'];
				$incometax_cost_mkt=$other_costing_arr[$row[csf('id')]]['incometax_cost'];
				$depr_amor_pre_cost_mkt=$other_costing_arr[$row[csf('id')]]['depr_amor_pre_cost'];
				
				
				//$common_oh_cost=$other_costing_arr[$row[csf('id')]]['common_oh'];
				$currier_cost=$other_costing_arr[$row[csf('id')]]['currier_pre_cost'];
				$cm_cost=$other_costing_arr[$row[csf('id')]]['cm_cost'];
				$embell_cost_mkt=$print_amount+$embroidery_amount+$wash_cost+$other_amount;
				
				$wash_cost_mkt=$wash_cost;
				$commission_cost_mkt=$foreign_cost+$local_cost;
				$comm_cost_mkt=$commercial_costing_arr[$row[csf('id')]];
				$freight_cost_mkt=$freight_cost;
				$test_cost_mkt=$test_cost;
				$inspection_cost_mkt=$inspection_cost;
				$currier_cost_mkt=$currier_cost;
				$cm_cost_mkt=$cm_cost;
					//echo "MM";die;
				
				$fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['grey'][$row[csf('id')]]);
				//+array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
				$fabric_purchase_cost2=array_sum($fabric_costing_arr['woven']['grey'][$row[csf('id')]]);
				$fabric_purchase_cost_mkt=$fabric_purchase_cost+$fabric_purchase_cost2;
				$finish_fabric_purchase_cost=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
				$finish_fabric_purchase_cost_mkt=array_sum($fabric_costing_arr['knit']['finish'][$row[csf('id')]])+array_sum($fabric_costing_arr['woven']['finish'][$row[csf('id')]]);
				$grey_fab_cost_mkt=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt;
				$mkt_all_cost=$yarn_cost_mkt+$yarn_value_addition_cost_mkt+$knit_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt+$trims_cost_mkt+$embell_cost_mkt+$wash_cost_mkt+$commission_cost_mkt+$comm_cost_mkt+$freight_cost_mkt+$test_cost_mkt+$inspection_cost_mkt+$currier_cost_mkt+$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt+$cm_cost_mkt+$fabric_purchase_cost_mkt;
				
				$mkt_margin=$po_value-$mkt_all_cost;
				$mkt_margin_perc=($mkt_margin/$po_value)*100;
				$tot_finish_fabric_cost_mkt=$grey_fab_cost_mkt+$dye_finish_cost_mkt+$aop_cost_mkt;
				$grey_prod_ex_rate=$grey_fab_array[$row[csf('id')]]['ex_rate'];
				$dye_fin_ex_rate=$dye_fin_fab_array[$row[csf('id')]]['ex_rate'];
				if($process_costing==1)
				{
					$grey_prod_cost=$knit_fin_fab_array[$row[csf('id')]]['knit_gross_amt'];
				}
				else
				{
					$grey_prod_cost=$knit_fin_fab_array[$row[csf('id')]]['knit_gross_amt'];
				}
				// echo $row[csf('id')].'d';
				$knit_cost_actual=$grey_prod_cost;
				
				$cpa_grey_prod_cost=$grey_fab_array[$row[csf('id')]]['cpa_grey_amt'];
				$cpa_knit_cost_actual=$cpa_grey_prod_cost;
				// echo $dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'].'/'.$knit_charge_mkt_fin.'=='.$dye_fin_ex_rate.', ';
				$cpa_dye_fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['cpa_batch_weight'];
					$cpa_dye_finish_cost_actual=$cpa_dye_fin_fab_prod_cost;
				
				//$fin_fab_prod_cost=$grey_used_arr[$row[csf('id')]]['grey_used_amt']+$fin_grey_used_arr[$row[csf('id')]]['grey_used_amt'];//$dye_fin_fab_array[$row[csf('id')]]['fin_amt'];
				if($dye_fin_fab_array[$row[csf('id')]]['discount_amt']>0){
					$fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['dye_gross_amt']-$dye_fin_fab_array[$row[csf('id')]]['discount_amt'];
				}else{
					$fin_fab_prod_cost=$dye_fin_fab_array[$row[csf('id')]]['dye_gross_amt'];
				}
				
				
				$cm_amt_cost= $cm_cost_arr[$row[csf('id')]]['cm_amt'];
				$booking=$booking_number[$row[csf("id")]]['booking'];
				$dye_finish_cost_actual=$fin_fab_prod_cost;
				
				$cpa_recv_ret_amt=$receive_ret_arr[$row[csf('job_no')]]['cpa_recv_ret_amt'];
				$cpa_yarn_recv_amt_bal=$yarn_receive_amount_arr[$row[csf('job_no')]]['cpa_order_amount_recv']-$cpa_recv_ret_amt;
				if($cpa_yarn_recv_amt_bal==0) $cpa_yarn_recv_amt_bal_actual=0;
				else $cpa_yarn_recv_amt_bal_actual=($cpa_yarn_recv_amt_bal/$job_quantity)*$order_qnty_in_pcs;
				
				//$yarn_cost_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt']+$cpa_yarn_recv_amt_bal_actual+$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_amt']+$cpa_knit_cost_actual+$cpa_dye_finish_cost_actual-($yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_yarn_ret_amt']+$yarnissueRetCostArray[$row[csf('id')]]['cpa_grey_dyeing_twist_ret_amt']);
				$yarn_cost_cpa_actual=$cpashortfabriccost_arr[$row[csf('id')]]['cpa_grey_yarn_amt']-$cpashortfabriccost_arr[$row[csf('id')]]['cpa_grey_yarn_rtn_amt'];

				$yarn_ret_qty_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_qty_retble'];
				$yarn_ret_amt_cpa_actual=$yarnTrimsCostArray[$row[csf('id')]]['cpa_grey_yarn_amt_retble'];
				$tot_yarn_qty_cpa_actual+=$yarn_cost_cpa_actual;
				$yarn_cost_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt']-$yarnissueRetCostArray[$row[csf('id')]]['grey_yarn_ret_amt'];
				$yarn_ret_qty_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_qty_retble'];
				$yarn_ret_amt_actual=$yarnTrimsCostArray[$row[csf('id')]]['grey_yarn_amt_retble'];
				$tot_yarn_qty_actual+=$yarn_ret_qty_actual;
				$tot_yarn_amt_actual+=$yarn_ret_amt_actual;
				$job_quantity=$job_arr2[$row[csf("job_no")]]['job_quantity'];
				
				$order_amount_recv=$yarn_receive_amount_arr[$row[csf('job_no')]]['order_amount_recv'];
				$order_amount_recv_ret=$receive_ret_arr[$row[csf('job_no')]]['recv_ret_amt'];
				
				$order_amount_recv_bal=$order_amount_recv-$order_amount_recv_ret;
				$avg_recv_amount_actual=($order_amount_recv_bal/$job_quantity)*$order_qnty_in_pcs;

				$yarn_dyeing_twist_actual=$avg_recv_amount_actual;//-$yarnissueRetCostArray[$row[csf('id')]]['grey_dyeing_twist_ret_amt'];
				
				// GREY TRANSFER PART--------------------

				$transfer_criteria=$greyTransfer_arr[$row[csf('id')]]['transfer_criteria'];
				if($transfer_criteria==2)
				{
					$greyTrnsfAmont=$grey_transferIn_amnt=$greyTransfer_array[$row[csf('id')]][5]['cons_amount']/$currency_rate;
				}
				else
				{
					$grey_transferIn_amnt=$greyTransfer_array[$row[csf('id')]][5]['cons_amount']/$currency_rate;
					$grey_transferOut_amnt=$greyTransfer_array[$row[csf('id')]][6]['cons_amount']/$currency_rate;
					$greyTrnsfAmont=$grey_transferIn_amnt-$grey_transferOut_amnt;

					//echo $grey_transferIn_amnt.'-'.$grey_transferOut_amnt;
				}
				
				//----------------
				
				$trans_in_amt=$recvIssue_array[$row[csf('id')]][5];
				$trans_out_amt=$recvIssue_array[$row[csf('id')]][6];
				
				$fin_trans_in_amt=$fin_fab_trans_array[$row[csf('id')]][5];
				$fin_trans_out_amt=$fin_fab_trans_array[$row[csf('id')]][6];
				
				$grey_fab_transfer=$trans_in_amt-$trans_out_amt;
				$grey_fab_transfer_amt_actual=$grey_fab_transfer*$knit_charge_mkt;
				
				$fin_fab_transfer=$fin_trans_in_amt-$fin_trans_out_amt;
				$fin_fab_transfer_amt_actual=$fin_fab_transfer*$knit_charge_mkt_fin;
				
				$trims_amount=$trims_trans_array[$row[csf('id')]]['amt'];
				$gen_trims_issue_amt=$gen_trims_issue_array[$row[csf('id')]]['amt'];
				//$trims_cost_actual=$trims_amount+$gen_trims_issue_amt;
				$trims_cost_actual=$trims_amount;
				$yarn_dye_cost_actual=0;
				$aop_prod_amt=$aop_prod_array[$row[csf('id')]]['amount'];
				$aop_cost_actual=$aop_prod_amt;
				$embell_cost_actual=$embellCostArray[$row[csf('id')]];
				
				//Finished Fabric Cost
				
				$printing_cost_actual=$printing_cost_arr[$row[csf('id')]]['amount'];
				$embro_cost_actual=$embro_cost_arr[$row[csf('id')]]['amount'];
				$dyeing_cost_actual=$emblishment_costing_arr_name[$row[csf('id')]][5];
				$wash_cost_actual=$emblishment_costing_arr_name_wash[$row[csf('id')]][3];
				
				//$commission_cost_actual=($ex_factory_qty/$dzn_qnty)*$fabriccostArray[$row[csf('job_no')]]['commission'];
				$commission_cost_actual=$commission_costing_arr[$row[csf('id')]];

				/* $comm_cost_actual=$actualCostArray[6][$row[csf('id')]];
				$freight_cost_actual=$actualCostArray[2][$row[csf('id')]];
				$test_cost_actual=$actualCostArray[1][$row[csf('id')]];
				$inspection_cost_actual=$actualCostArray[3][$row[csf('id')]];
				$currier_cost_actual=$actualCostArray[4][$row[csf('id')]]; */

				$comm_cost_actual=$commercial_costing_arr[$row[csf('id')]];
				$freight_cost_actual=$other_costing_arr[$row[csf('id')]]['freight'];
				$test_cost_actual=$other_costing_arr[$row[csf('id')]]['lab_test'];
				$inspection_cost_actual=$other_costing_arr[$row[csf('id')]]['inspection'];
				$currier_cost_actual=$other_costing_arr[$row[csf('id')]]['currier_pre_cost'];
				
				$working_hour=$prod_resource_array[$row[csf('id')]]['working_hour'];
				$operator_helper=$prod_resource_array[$row[csf('id')]]['operator_helper'];
				$extra_working_hour=$adj_resource_array[$row[csf('style_ref_no')]]['working_hour'];
				$extra_number_of_emp=$adj_resource_array[$row[csf('style_ref_no')]]['number_of_emp'];
				$tot_number_of_employee=$operator_helper+$extra_number_of_emp;
				$tot_working_hr=$working_hour+$extra_working_hour;
				$prod_date=$prod_resource_array[$row[csf('id')]]['pr_date']; 
				$from_cpm_date=date("Y-m",strtotime(($prod_date)));
				$cpm=$lib_cpm_array[$from_cpm_date]['cpm'];
				//$exchange_rate=set_conversion_rate($usd_id,$prod_date );
				$exchange_rate=$prod_resource_array[$row[csf('id')]]['ex_rate'];
			
				$cm_cost_actual=$cm_amt_cost;
				//echo $working_hour.'='.$extra_number_of_emp.'ds';
				//$cm_cost_actual=($tot_working_hr*60*$tot_number_of_employee*$cpm)/$exchange_rate;
				
				$fabric_purchase_cost_actual=$finish_purchase_amnt_arr[$row[csf('id')]];
				$grey_fabric_purchase_cost_actual=$grey_purchase_amnt_arr[$row[csf('id')]];
				$grey_fab_cost_actual=$grey_fab_transfer_amt_actual;
				$finished_fab_cost_actual=$grey_fab_cost_actual+$dye_finish_cost_actual+$aop_cost_actual+$fin_fab_transfer_amt_actual;
				$tot_fabric_cost_act=$fabric_purchase_cost_actual+$finished_fab_cost_actual;
				$tot_fabric_cost_actaul+=$tot_fabric_cost_act;
				$actual_all_cost=$yarn_cost_actual+$knit_cost_actual+$yarn_dyeing_twist_actual+$grey_fab_transfer_amt_actual+$dye_finish_cost_actual+$yarn_dye_cost_actual+$aop_cost_actual+$trims_cost_actual+$printing_cost_actual+$embro_cost_actual+$dyeing_cost_actual+$wash_cost_actual+$commission_cost_actual+$comm_cost_actual+$freight_cost_actual+$test_cost_actual+$inspection_cost_actual+$currier_cost_actual+$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt+$cm_cost_actual+$fabric_purchase_cost_actual+$grey_fabric_purchase_cost_actual;
				
				$actual_margin=$ex_factory_value-$actual_all_cost;
				$actual_margin_perc=($actual_margin/$ex_factory_value)*100;
				$tot_fabric_cost_mkt=$tot_finish_fabric_cost_mkt+$fabric_purchase_cost_mkt;
				$tot_yarn_cost_mkt+=$yarn_cost_mkt;
				$tot_yarn_value_addition_cost_mkt+=$yarn_value_addition_cost_mkt;
				$tot_grey_fab_cost_mkt+=$grey_fab_cost_mkt; 
				$tot_knit_cost_mkt+=$knit_cost_mkt; 
				$tot_dye_finish_cost_mkt+=$dye_finish_cost_mkt; 
				//$tot_yarn_dye_cost_mkt+=$yarn_dye_cost_mkt; 
				$tot_aop_cost_mkt+=$aop_cost_mkt; 
				$total_fabric_cost_mkt+=$tot_fabric_cost_mkt;
				$tot_trims_cost_mkt+=$trims_cost_mkt;
					$total_finish_fabric_cost_mkt+=$tot_finish_fabric_cost_mkt;
				$tot_print_amount_mkt+=$print_amount; 
				$tot_embro_amount_mkt+=$embroidery_amount; 
				$tot_dyeing_amount_mkt+=$other_amount; 
				$tot_wash_amount_mkt+=$wash_cost; 
				
				$tot_embell_cost_mkt+=$embell_cost_mkt; 
				$tot_wash_cost_mkt+=$wash_cost_mkt; 
				$tot_commission_cost_mkt+=$commission_cost_mkt; 
				$tot_comm_cost_mkt+=$comm_cost_mkt; 
				$tot_freight_cost_mkt+=$freight_cost_mkt; 
				$tot_test_cost_mkt+=$test_cost_mkt; 
				$tot_inspection_cost_mkt+=$inspection_cost_mkt; 
				$tot_currier_cost_mkt+=$currier_cost_mkt; 
				//$tot_certificate_cost_mkt=$tot_deffdlc_cost_mkt=$tot_design_cost_mkt=$tot_studio_cost_mkt=$tot_operating_exp_mkt=$tot_interest_cost_mkt=$tot_incometax_cost_mkt=$tot_depr_amor_pre_cost_mkt=0;
				$tot_certificate_cost_mkt+=$certificate_cost_mkt; 
				$tot_deffdlc_cost_mkt+=$deffdlc_cost_mkt; 
				$tot_design_cost_mkt+=$design_cost_mkt; 
				$tot_studio_cost_mkt+=$studio_cost_mkt; 
				$tot_operating_exp_mkt+=$operating_exp_mkt; 
				$tot_interest_cost_mkt+=$interest_cost_mkt; 
				$tot_incometax_cost_mkt+=$incometax_cost_mkt; 
				$tot_depr_amor_pre_cost_mkt+=$depr_amor_pre_cost_mkt; 
				
				
				//$certificate_cost_mkt+$deffdlc_cost_mkt+$design_cost_mkt+$studio_cost_mkt+$operating_exp_mkt+$interest_cost_mkt+$incometax_cost_mkt+$depr_amor_pre_cost_mkt
				
				$tot_cm_cost_mkt+=$cm_cost_mkt; 
				$tot_mkt_all_cost+=$mkt_all_cost; 
				$tot_mkt_margin+=$mkt_margin; 
				$tot_yarn_cost_actual+=$yarn_cost_actual; 
				$tot_yarn_dyeing_twist_actual+=$yarn_dyeing_twist_actual; 
				$tot_knit_cost_actual+=$knit_cost_actual; 
				$tot_grey_transfer_actual+=$greyTrnsfAmont; 
				$tot_dye_finish_cost_actual+=$dye_finish_cost_actual;
				$tot_yarn_dye_cost_actual+=$yarn_dye_cost_actual; 
				$tot_aop_cost_actual+=$aop_cost_actual; 
				$tot_trims_cost_actual+=$trims_cost_actual; 
				$tot_grey_fab_cost_actual+=$grey_fab_cost_actual; 
				$tot_grey_fab_transfer_amt_actual+=$grey_fab_transfer_amt_actual; 
				$tot_gray_transfer_actual+=$greyTrnsfAmont; 
				$tot_print_amount_actual+=$printing_cost_actual; 
				$tot_embro_amount_actual+=$embro_cost_actual; 
				$tot_dyeing_amount_actual+=$dyeing_cost_actual; 
				$tot_wash_amount_actual+=$wash_cost_actual; 
				$tot_finished_fab_cost_actual+=$finished_fab_cost_actual;
				$tot_fin_fab_transfer_amt_actual+=$fin_fab_transfer_amt_actual;
				$tot_embell_cost_actual+=$embell_cost_actual;
				$tot_wash_cost_actual+=$wash_cost_actual; 
				$tot_commission_cost_actual+=$commission_cost_actual; 
				$tot_comm_cost_actual+=$comm_cost_actual; 
				$tot_freight_cost_actual+=$freight_cost_actual; 
				$tot_test_cost_actual+=$test_cost_actual; 
				$tot_inspection_cost_actual+=$inspection_cost_actual; 
				$tot_currier_cost_actual+=$currier_cost_actual; 
				
				$tot_certificate_cost_actual+=$certificate_cost_mkt; 
				$tot_deffdlc_cost_actual+=$deffdlc_cost_mkt; 
				$tot_design_cost_actual+=$design_cost_mkt; 
				$tot_studio_cost_actual+=$studio_cost_mkt; 
				$tot_operating_exp_actual+=$operating_exp_mkt; 
				$tot_interest_cost_actual+=$interest_cost_mkt; 
				$tot_incometax_cost_actual+=$incometax_cost_mkt; 
				$tot_depr_amor_pre_cost_actual+=$depr_amor_pre_cost_mkt; 
				
				$tot_cm_cost_actual+=$cm_cost_actual; 
				$tot_actual_all_cost+=$actual_all_cost; 
				$tot_actual_margin+=$actual_margin;
				$tot_actual_net_margin+=$actual_margin-$yarn_cost_cpa_actual; 
				
				$tot_fabric_purchase_cost_mkt+=$fabric_purchase_cost_mkt;
				$tot_fabric_purchase_cost_actual+=$fabric_purchase_cost_actual;
				$tot_grey_fabric_purchase_cost_actual+=$grey_fabric_purchase_cost_actual;
				
				$buyer_name_array[$row[csf('buyer_name')]]=$buyer_arr[$row[csf('buyer_name')]];
				$mkt_po_val_array[$row[csf('buyer_name')]]+=$po_value;
				$mkt_yarn_array[$row[csf('buyer_name')]]+=$yarn_cost_mkt;
				
				$mkt_knit_array[$row[csf('buyer_name')]]+=$knit_cost_mkt;
				$mkt_yarn_value_addition_array[$row[csf('buyer_name')]]+=$yarn_value_addition_cost_mkt;
				$mkt_dy_fin_array[$row[csf('buyer_name')]]+=$dye_finish_cost_mkt;
				$mkt_grey_fab_cost_array[$row[csf('buyer_name')]]+=$grey_fab_cost_mkt;
				$mkt_aop_array[$row[csf('buyer_name')]]+=$aop_cost_mkt;
				$mkt_trims_array[$row[csf('buyer_name')]]+=$trims_cost_mkt;
				$mkt_print_array[$row[csf('buyer_name')]]+=$print_amount;
				$mkt_embro_array[$row[csf('buyer_name')]]+=$embroidery_amount;
				$mkt_dyeing_array[$row[csf('buyer_name')]]+=$other_amount;
				//$mkt_wash_array[$row[csf('buyer_name')]]+=$wash_cost;
				
				$mkt_emb_array[$row[csf('buyer_name')]]+=$embell_cost_mkt;
				$mkt_wash_array[$row[csf('buyer_name')]]+=$wash_cost_mkt;
				$mkt_commn_array[$row[csf('buyer_name')]]+=$commission_cost_mkt;
				$mkt_commercial_array[$row[csf('buyer_name')]]+=$comm_cost_mkt;
				$mkt_freight_array[$row[csf('buyer_name')]]+=$freight_cost_mkt;
				$mkt_test_array[$row[csf('buyer_name')]]+=$test_cost_mkt;
				$mkt_ins_array[$row[csf('buyer_name')]]+=$inspection_cost_mkt;
				$mkt_courier_array[$row[csf('buyer_name')]]+=$currier_cost_mkt;
				
				$mkt_certificate_array[$row[csf('buyer_name')]]+=$certificate_cost_mkt;
				$mkt_deffdlc_array[$row[csf('buyer_name')]]+=$deffdlc_cost_mkt;
				$mkt_design_array[$row[csf('buyer_name')]]+=$design_cost_mkt;
				$mkt_studio_array[$row[csf('buyer_name')]]+=$studio_cost_mkt;
				$mkt_operating_array[$row[csf('buyer_name')]]+=$operating_exp_mkt;
				$mkt_interest_array[$row[csf('buyer_name')]]+=$interest_cost_mkt;
				$mkt_incometax_array[$row[csf('buyer_name')]]+=$incometax_cost_mkt;
				$mkt_depr_amor_array[$row[csf('buyer_name')]]+=$depr_amor_pre_cost_mkt;
					
				
				$mkt_cm_array[$row[csf('buyer_name')]]+=$cm_cost_mkt;
				$mkt_total_array[$row[csf('buyer_name')]]+=$mkt_all_cost;
				$mkt_margin_array[$row[csf('buyer_name')]]+=$mkt_margin;
				$mkt_fabric_purchase_array[$row[csf('buyer_name')]]+=$fabric_purchase_cost_mkt;
				$mkt_fin_fabric_purchase_array[$row[csf('buyer_name')]]+=$finish_fabric_purchase_cost_mkt;
					
				$ex_factory_val_array[$row[csf('buyer_name')]]+=$ex_factory_value;
				$yarn_cost_array[$row[csf('buyer_name')]]+=$yarn_cost_actual;
				$yarn_dyeing_twist_array[$row[csf('buyer_name')]]+=$yarn_dyeing_twist_actual;
				$knit_cost_array[$row[csf('buyer_name')]]+=$knit_cost_actual;
				$grey_transfer_amnt_array[$row[csf('buyer_name')]]+=$greyTrnsfAmont;
				$dye_cost_array[$row[csf('buyer_name')]]+=$dye_finish_cost_actual;
				$grey_fab_cost_array[$row[csf('buyer_name')]]+=$grey_fab_cost_actual;
				$fin_fab_transfer_amt_actual_array[$row[csf('buyer_name')]]+=$fin_fab_transfer_amt_actual;
				$finished_fab_cost_actual_array[$row[csf('buyer_name')]]+=$finished_fab_cost_actual;
			
				$aop_n_others_cost_array[$row[csf('buyer_name')]]+=$aop_cost_actual;
				$trims_cost_array[$row[csf('buyer_name')]]+=$trims_cost_actual;
				
				$print_act_cost_array[$row[csf('buyer_name')]]+=$printing_cost_actual;
				$embro_act_cost_array[$row[csf('buyer_name')]]+=$embro_cost_actual;
				$dyeing_act_cost_array[$row[csf('buyer_name')]]+=$dyeing_cost_actual;
				$wash_act_cost_array[$row[csf('buyer_name')]]+=$wash_cost_actual;
				
				$enbellishment_cost_array[$row[csf('buyer_name')]]+=$embell_cost_actual;
				$wash_cost_array[$row[csf('buyer_name')]]+=$wash_cost_actual;
				$commission_cost_array[$row[csf('buyer_name')]]+=$commission_cost_actual;
				$commercial_cost_array[$row[csf('buyer_name')]]+=$comm_cost_actual;
				$freight_cost_array[$row[csf('buyer_name')]]+=$freight_cost_actual;
				$testing_cost_array[$row[csf('buyer_name')]]+=$test_cost_actual;
				$inspection_cost_array[$row[csf('buyer_name')]]+=$inspection_cost_actual;
				$courier_cost_array[$row[csf('buyer_name')]]+=$currier_cost_actual;
				
				$acl_certificate_array[$row[csf('buyer_name')]]+=$certificate_cost_mkt;
				$acl_deffdlc_array[$row[csf('buyer_name')]]+=$deffdlc_cost_mkt;
				$acl_design_array[$row[csf('buyer_name')]]+=$design_cost_mkt;
				$acl_studio_array[$row[csf('buyer_name')]]+=$studio_cost_mkt;
				$acl_operating_array[$row[csf('buyer_name')]]+=$operating_exp_mkt;
				$acl_interest_array[$row[csf('buyer_name')]]+=$interest_cost_mkt;
				$acl_incometax_array[$row[csf('buyer_name')]]+=$incometax_cost_mkt;
				$acl_depr_amor_array[$row[csf('buyer_name')]]+=$depr_amor_pre_cost_mkt;
				
				
				
				$cm_cost_array[$row[csf('buyer_name')]]+=$cm_cost_actual;
				$total_cost_array[$row[csf('buyer_name')]]+=$actual_all_cost;
				$margin_array[$row[csf('buyer_name')]]+=$actual_margin;
				$actual_fabric_purchase_array[$row[csf('buyer_name')]]+=$fabric_purchase_cost_actual;
				$actual_grey_fabric_purchase_array[$row[csf('buyer_name')]]+=$grey_fabric_purchase_cost_actual;
				
				
					
					
				//$prod_resource_array[$val[csf('po_id')]]['pr_date']=$val[csf('pr_date')]
				$button_po="<a href='#' onClick=\"generate_po_report('".$company_name."','".$row[csf('id')]."','".$row[csf('job_no')]."','show_po_detail_report','1')\" '> ".$row[csf('po_number')]."<a/>";
				
				?>
				<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">
					<td width="40" rowspan="4"><? echo $i; ?></td>
					<td width="70" rowspan="4"><? echo $buyer_arr[$row[csf('buyer_name')]]; ?></td>
					<td width="60" align="center" rowspan="4"><? echo $row[csf('year')]; ?></td>
					<td width="70" align="center" rowspan="4"><? echo $row[csf('job_no_prefix_num')]; ?></td>
					<td width="100"  align="center" rowspan="4" style="word-break:break-all;"><? echo  $row[csf('po_number')];//$button_po; ?></td>
					<td width="100"  align="center" rowspan="4" style="word-break:break-all;"><? echo  $booking;//$button_po; ?></td>
					<td width="70"  align="center" rowspan="4" style="word-break:break-all;"><? echo $row[csf('file_no')]; ?></td>
					<td width="80"  align="center" rowspan="4" style="word-break:break-all;"><? echo $row[csf('grouping')]; ?></td>
					<td width="110"  align="center" rowspan="4" style="word-break:break-all;"><? echo $row[csf('style_ref_no')]; ?></td>
					<td width="120"  align="center" rowspan="4" style="word-break:break-all;"><? echo $gmts_item; ?></td>
					<td width="90" align="right"  rowspan="4"><? echo $order_qnty_in_pcs; ?></td>
					<td width="50" align="center" rowspan="4"><? echo $unit_of_measurement[$row[csf('order_uom')]]; ?></td>
					<td width="70" align="right"  rowspan="4"><? echo fn_number_format($unit_price,2,'.',''); ?></td>
					<td width="110" align="right"  rowspan="4"><? echo fn_number_format($po_value,2,'.',''); ?></td>
					<td width="100" align="right"  rowspan="4"><? echo fn_number_format($row[csf('set_smv')],2,'.',''); ?></td>
					<td width="80" align="center" rowspan="4"><? echo change_date_format($row[csf('pub_shipment_date')]); ?></td>
					<td width="100" rowspan="4" style="word-break:break-all;"><? echo $shipment_status[$row[csf('shiping_status')]]; ?></td>
					<td width="100" align="left"><b>Pre Costing</b></td>
					<td width="100" align="right" ><? echo fn_number_format($order_qnty_in_pcs,0,'.',''); ?></td>
					<td width="110" align="right" ><? echo fn_number_format($po_value,2,'.',''); ?></td>
					<td width="110"  align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $row[csf('id')]."**".$row[csf('job_no')]; ?>','mkt_yarn_cost','Grey Yarn Mkt. Cost Details')"><? echo fn_number_format($yarn_cost_mkt,2); //$tot_yarn_qty_actual?></a><? //echo  fn_number_format($yarn_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Yarn Value Addition Cost=Yarn Dyeing & Twisting"  align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $row[csf('id')]."**".$row[csf('job_no')]; ?>','mkt_yarn_dyeing_twisting_cost','Yarn Dyeing & Twisting Cost Details')"><? echo fn_number_format($yarn_value_addition_cost_mkt,2); ?></a><? //echo fn_number_format($yarn_value_addition_cost_mkt,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($knit_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Grey Fabric Transfer Cost"  align="right"><? //echo fn_number_format($knit_cost_mkt,2,'.',''); ?></td>
					
					<td width="100" title="Tot Grey Fabric Cost"  align="right"><? echo fn_number_format($grey_fab_cost_mkt,2,'.',''); ?></td>
					<td width="110" title="Without Conv. Process Name: -Knitting,Twisting,All Over Printing,Yarn Dyeing,Weaving"  align="right"><? echo fn_number_format($dye_finish_cost_mkt,2,'.',''); ?></td>
					
					<td width="110"  align="right"><? echo fn_number_format($aop_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($aop_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Fabric Purchase Cost"  align="right"><? echo fn_number_format($finish_fabric_purchase_cost_mkt,2,'.',''); ?></td>
						<td width="110"  align="right"><? echo fn_number_format($fabric_purchase_cost_mkt,2,'.',''); ?></td>
					<td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($tot_finish_fabric_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><?
					
						echo fn_number_format($tot_fabric_cost_mkt,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($trims_cost_mkt,2,'.',''); ?></td>
						<td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($print_amount,2,'.',''); ?></td>
						<td width="100"  align="right"><? echo fn_number_format($embroidery_amount,2,'.',''); ?></td>
						<td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($other_amount,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($wash_cost,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? echo fn_number_format($commission_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($comm_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($freight_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($test_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($inspection_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($currier_cost_mkt,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? echo fn_number_format($certificate_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($deffdlc_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($design_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($studio_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($operating_exp_mkt,2,'.',''); ?></td>
					
					
					
					
					<td width="100"  align="right"><? echo fn_number_format($cm_cost_mkt,2,'.',''); ?></td>
					
						<td width="100"  align="right"><? echo fn_number_format($interest_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($incometax_cost_mkt,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($depr_amor_pre_cost_mkt,2,'.',''); ?></td>
					
					
					
					<td width="100"  align="right"><? echo fn_number_format($mkt_all_cost,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($mkt_margin,2,'.',''); ?></td>
					<td  width="100"  align="right"><? echo fn_number_format($mkt_margin_perc,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($mkt_margin,2,'.',''); ?></td>
					<td  align="right"><? //echo fn_number_format($mkt_margin,2,'.',''); ?></td>
				</tr>
				<tr bgcolor="#F5F5F5" onClick="change_color('tr_a<? echo $i; ?>','#F5F5F5')" id="tr_a<? echo $i; ?>">
					<td width="100" align="left"><b>Actual</b></td>
					<td width="100" align="right" >
					<a href="##" onClick="generate_ex_factory_popup('ex_factory_popup','<? echo $row[csf('job_no_prefix_num')];?>','<? echo $row[csf('id')]; ?>','650px')"><? echo  fn_number_format($ex_factory_qty,0,'.',''); ?></a>
					<? //echo fn_number_format($ex_factory_qty,0,'.',''); ?></td>
					<td width="110" align="right" ><? echo fn_number_format($ex_factory_value,2,'.',''); ?></td>
					<td width="110"  align="right"><a href="#report_details" onClick="openmypage_actual2('<? echo $row[csf('id')]; ?>','yarn_cost_actual3','Actual Yarn Cost Details','1','1020px')"><? echo fn_number_format($yarn_cost_actual,2,'.',''); ?></a></td>
					<td width="100" title="Yarn Dying With Order, Yarn Service Work Order(Rate): Yarn Recv: Yarn Dyeing/Twisting/Re-Waxing Cost :<? echo $order_amount_recv.' - Recv Ret: '.$order_amount_recv_ret.'/ Job Qty :'.$job_quantity.'* Po Qty :'.$order_qnty_in_pcs;?>"  align="right"><a href="#report_details"  onClick="openmypage_actual2('<? echo $row[csf('id')]; ?>','yarn_dye_twist_cost_actual','Actual Yarn Dyeing Twsit Cost Details','2','930px')"><? echo fn_number_format($yarn_dyeing_twist_actual,2,'.',''); ?></a></td>
					<td width="110" title="Knitting Bill Entry for Gross."  align="right"><? echo fn_number_format($knit_cost_actual,2,'.',''); ?></td>
					<td width="100" title="Grey Fabric Transfer Cost<? echo $knit_charge_mkt;?>"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','knit_cost_actual','Actual Knitting Cost Details','900px')"><? //echo fn_number_format($grey_fab_transfer_amt_actual,2,'.',''); ?></a><? echo fn_number_format($greyTrnsfAmont,2,'.',''); ?></td>					
					<td width="100" title="Grey Yarn Cost+Yarn Dyeing/Twisting/Re-Waxing Cost+Knitting Cost+Grey Fabric Transfer Cost"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','knit_cost_actual','Actual Knitting Cost Details','900px')"><? //echo fn_number_format($grey_fab_cost_actual,2,'.',''); ?></a><? echo fn_number_format($grey_fab_cost_actual,2,'.',''); ?></td>
					<td width="110"  title="From Dyeing And Finishing Bill Issue or Dyeing And Finishing Bill Entry" align="right"><a href="#report_details" onClick="openmypage_actual3('<? echo $row[csf('id')]; ?>','dye_finish_cost_actual_popup','Actual Dyeing & Finish Cost Details','800px')"><? echo fn_number_format($dye_finish_cost_actual,2,'.',''); ?></a><? //echo fn_number_format($dye_finish_cost_actual,2,'.',''); ?></td>
					
					<td width="110"  align="right" title="From Service Booking For AOP V2"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($aop_cost_actual,2,'.',''); ?></a><? echo fn_number_format($aop_cost_actual,2,'.',''); ?></td>
						<td width="100" title="<? echo 'Avg Dye Fin Charge from Budget='.$knit_charge_mkt_fin;?>"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','Fin Feb Transfer Cost Details','800px')"><? //echo fn_number_format($fin_fab_transfer_amt_actual,2,'.',''); ?></a><? echo fn_number_format($fin_fab_transfer_amt_actual,2,'.',''); ?></td>
						<td width="100" title="From- Knit & woven Finish Fabric Rcv"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($fabric_purchase_cost_actual,2,'.',''); ?></a><? echo fn_number_format($fabric_purchase_cost_actual,2,'.',''); ?></td>
						<td width="110"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','fabric_purchase_cost_actual','Fabric Purchase Cost Details','900px')"><? //echo fn_number_format($grey_fabric_purchase_cost_actual,2,'.',''); ?></a><? echo fn_number_format($grey_fabric_purchase_cost_actual,2,'.',''); ?></td>
						<td width="100" title="Without Purchase Fabric"  align="right"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','aop_cost_actual','AOP Cost Details','800px')"><? //echo fn_number_format($finished_fab_cost_actual,2,'.',''); ?></a><? echo fn_number_format($finished_fab_cost_actual,2,'.',''); ?></td>
							<td width="100" title="Tot Fab. Cost"  align="right"><? echo fn_number_format($tot_fabric_cost_act,2,'.',''); ?></td>
							
					<td width="110"  align="right" ><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]; ?>','trims_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($trims_cost_actual,2,'.',''); ?></a></td>
					<td width="100"  title="Garment Printing Cost" align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','1','gmt_print_wash_dye_embell_cost_actual','Print Cost Details','800px')"><? echo fn_number_format($printing_cost_actual,2,'.',''); ?></a></td>
					<td width="100" title="Garment Embro Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','2','gmt_print_wash_dye_embell_cost_actual','Embro Cost Details','800px')"><? echo fn_number_format($embro_cost_actual,2,'.',''); ?></a></td>
					<td width="100" title="Garment Dyeing Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','5','gmt_print_wash_dye_embell_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($dyeing_cost_actual,2,'.',''); ?></a></td>
					<td width="100" title="Garment Wash Cost"  align="right"><a href="#report_details" onClick="openmypage_gmt_actual('<? echo $row[csf('id')]; ?>','3','gmt_print_wash_dye_embell_cost_actual','Trims Cost Details','800px')"><? echo fn_number_format($wash_cost_actual,2,'.',''); ?></a></td>						
					<td width="100"  align="right" title="<?= __LINE__; ?>"><a href="#report_details" onClick="openmypage_actual('<? echo $row[csf('id')]."_".$row[csf('job_no')]."_".$ex_factory_qty."_".$dzn_qnty; ?>','commission_cost_actual','Commission Cost Details','600px')"><? echo fn_number_format($commission_cost_actual,2,'.',''); ?></a></td>
					<td width="100"  align="right"><? echo fn_number_format($comm_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($freight_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($test_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($inspection_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($currier_cost_actual,2,'.',''); ?></td>
					
						<td width="100"  align="right"><? $certificate_cost_actual=$certificate_cost_mkt;echo fn_number_format($certificate_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><?  $deffdlc_cost_mkt_actual=$deffdlc_cost_mkt; echo fn_number_format($deffdlc_cost_mkt_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? $design_cost_actual=$design_cost_mkt; echo fn_number_format($design_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? $studio_cost_actual=$studio_cost_mkt;echo fn_number_format($studio_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><?  $operating_exp_actual=$operating_exp_mkt;echo fn_number_format($operating_exp_actual,2,'.',''); ?></td>
					
					
					<?
					//	$cm_cost_actual=($tot_working_hr*60*$tot_number_of_employee*$cpm)/$exchange_rate;
					?>
					<td width="100"  title="From Actual Cost Entry Quantity" align="right"><? echo fn_number_format($cm_cost_actual,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? $interest_cost_actual=$interest_cost_mkt;echo fn_number_format($interest_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? $incometax_cost_actual=$incometax_cost_mkt;echo fn_number_format($incometax_cost_actual,2,'.',''); ?></td>
					<td width="100"  align="right"><? $depr_amor_pre_cost_actual=$depr_amor_pre_cost_mkt;echo fn_number_format($depr_amor_pre_cost_actual,2,'.',''); ?></td>
					
					
					<td width="100"  align="right"><? echo fn_number_format($actual_all_cost,2,'.',''); ?></td>
					<td width="100"  align="right" title="Ex factory value-Actual all cost;"><? echo fn_number_format($actual_margin,2,'.',''); ?></td>
					<td  width="100" align="right"  title="Margin /Ex Fact Value*100"><? echo fn_number_format($actual_margin_perc,2,'.',''); ?></td>
					
					<td width="100" title="Short Booking,yarn issue for Grey +Dyed Yarn Amount"  align="right"><? echo fn_number_format($yarn_cost_cpa_actual,2,'.',''); ?></td>
					<td   align="right"><? echo fn_number_format($actual_margin-$yarn_cost_cpa_actual,2,'.',''); ?></td>
				</tr>
				<tr bgcolor="#E9E9E9" onClick="change_color('tr_v<? echo $i; ?>','#E9E9E9')" id="tr_v<? echo $i; ?>">
					<td width="100" align="left"><b>Variance</b></td>
					<td width="100" align="right" ></td>
					<td width="110" align="right" >
						<? 
							$variance_po_value=$po_value-$ex_factory_value;
							$variance_po_value_per=($variance_po_value/$po_value)*100; 
							echo fn_number_format($variance_po_value,2,'.',''); 
						?>
					</td>
					<td width="110"  align="right">
						<? 
							$variance_yarn_cost=($yarn_cost_mkt+$yarn_dye_cost_mkt)-$yarn_cost_actual;
							if($variance_yarn_cost==0)
							{
								$variance_yarn_cost_per=0;
							}
							else
							{
								$variance_yarn_cost_per=($variance_yarn_cost/($yarn_cost_mkt+$yarn_dye_cost_mkt))*100; 
							}
							echo fn_number_format($variance_yarn_cost,2,'.',''); 
						?>
					</td>
					<td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right">
						<? 
							$variance_yarn_value_addition_cost=$yarn_value_addition_cost_mkt-$yarn_dyeing_twist_actual;
							//$variance_yarn_value_addition_cost_per=($variance_yarn_value_addition_cost/$yarn_value_addition_cost_mkt)*100;
							if($variance_yarn_value_addition_cost==0 && $yarn_value_addition_cost_mkt==0)
							{
								$variance_yarn_value_addition_cost_per=0;
							}
							else
							{
								$variance_yarn_value_addition_cost_per=($variance_yarn_value_addition_cost/$yarn_value_addition_cost_mkt)*100;
							} 
							echo fn_number_format($variance_yarn_value_addition_cost,2,'.',''); 
						?>
					</td>
					<td width="110"  align="right">
						<? 
							$variance_kint_cost=$knit_cost_mkt-$knit_cost_actual;
							if($variance_kint_cost==0)
							{
								$variance_knit_cost_per=0;
							}
							else
							{
								$variance_knit_cost_per=($variance_kint_cost/$knit_cost_mkt)*100; 
							}
							echo fn_number_format($variance_kint_cost,2,'.',''); 
						?>
					</td>
						<td width="100" title="Grey Fabric Transfer Cost"  align="right">
					</td>
					
						<td width="100" title="Tot Grey Fabric Cost"  align="right">
						<? 
							$variance_grey_fab_cost=$grey_fab_cost_mkt-$grey_fab_cost_actual;
							if($variance_grey_fab_cost==0 )
							{
								$variance_grey_fab_cost_per=0;
							}
							else
							{
								$variance_grey_fab_cost_per=($variance_grey_fab_cost/$grey_fab_cost_mkt)*100; 
							}
							echo fn_number_format($variance_grey_fab_cost,2,'.',''); 
						?>
					</td>
					<td width="110"  align="right">
						<? 
							$variance_dye_finish_cost=$dye_finish_cost_mkt-$dye_finish_cost_actual;
							if($variance_dye_finish_cost==0 && $dye_finish_cost_mkt==0)
							{
								$variance_dye_finish_cost_per=0;
							}
							else
							{
								$variance_dye_finish_cost_per=($variance_dye_finish_cost/$dye_finish_cost_mkt)*100; 
							}
							echo fn_number_format($variance_dye_finish_cost,2,'.','');
						?>
					</td>
					<td width="110"  align="right">
						<? 
							$variance_aop_cost=$aop_cost_mkt-$aop_cost_actual;
							if($variance_aop_cost==0)
							{
								$variance_aop_cost_per=0;
							}
							else
							{
								$variance_aop_cost_per=($variance_aop_cost/$aop_cost_mkt)*100; 
							}
							echo fn_number_format($variance_aop_cost,2,'.',''); 
						?>
					</td>
						<td width="100" title="Finished Fabric Transfer Cost"  align="right">
						</td>
						<td width="100" title="Finished Fabric Purchase Cost"  align="right">
						<? 
							$variance_fin_fabric_purchase_cost=$finish_fabric_purchase_cost_mkt-$fabric_purchase_cost_actual;
							//$variance_fin_fabric_cost_per=($variance_fin_fabric_purchase_cost/$finish_fabric_purchase_cost_mkt)*100;
							if($variance_fin_fabric_purchase_cost==0)
							{
								$variance_fin_fabric_cost_per=0;
							}
							else
							{
								$variance_fin_fabric_cost_per=($variance_fin_fabric_purchase_cost/$finish_fabric_purchase_cost_mkt)*100; 
							} 
							echo fn_number_format($variance_fin_fabric_purchase_cost,2,'.',''); 
						?>
					</td>
						<td width="110"  align="right">
						<? 
							$variance_finish_purchase_cost=$fabric_purchase_cost_mkt-$grey_fabric_purchase_cost_actual;
							if($variance_finish_purchase_cost==0 && $fabric_purchase_cost_mkt==0)
							{
								$variance_finish_purchase_cost_per=0;
							}
							else
							{
								$variance_finish_purchase_cost_per=($variance_finish_purchase_cost/$fabric_purchase_cost_mkt)*100; 
							}
							echo fn_number_format($variance_finish_purchase_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Finished Fabric Cost"  align="right">
						<? 
							$variance_finished_fab_cost=$tot_finish_fabric_cost_mkt-$finished_fab_cost_actual;
							if($variance_finished_fab_cost==0)
							{
								$variance_finished_fab_cost_per=0;
							}
							else
							{
								$variance_finished_fab_cost_per=($variance_finished_fab_cost/$tot_finish_fabric_cost_mkt)*100; 
							} 
							echo fn_number_format($variance_finished_fab_cost,2,'.',''); 
						?>
					</td>
					<td width="100" title="Total Fabric Cost"  align="right">
						<? 
							$variance_tot_fabric_cost=$tot_fabric_cost_mkt-$tot_fabric_cost_act;
							//$variance_tot_fabric_cost_per=($variance_tot_fabric_cost/$tot_fabric_cost_mkt)*100; 
							if($variance_tot_fabric_cost==0 && $tot_fabric_cost_mkt==0)
							{
								$variance_tot_fabric_cost_per=0;
							}
							else
							{
								$variance_tot_fabric_cost_per=($variance_tot_fabric_cost/$tot_fabric_cost_mkt)*100; 
							}
							echo fn_number_format($variance_tot_fabric_cost,2,'.',''); 
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_trims_cost=$trims_cost_mkt-$trims_cost_actual;
							if($variance_trims_cost==0)
							{
								$variance_trims_cost_per=0;
							}
							else
							{
								$variance_trims_cost_per=($variance_trims_cost/$trims_cost_mkt)*100; 
							}
							echo fn_number_format($variance_trims_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Garment Printing Cost"  align="right">
						<? 
							$variance_print_cost=$print_amount-$printing_cost_actual;
							if($variance_print_cost==0)
							{
								$variance_print_cost_per=0;
							}
							else
							{
								$variance_print_cost_per=($variance_print_cost/$print_amount)*100; 
							}
							echo fn_number_format($variance_print_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Garment Embro Cost"  align="right">
						<? 
							$variance_embro_cost=$embroidery_amount-$embro_cost_actual;
							if($variance_embro_cost==0 && $embroidery_amount==0)
							{
								$variance_embro_cost_per=0;
							}
							else
							{
								$variance_embro_cost_per=($variance_embro_cost/$embroidery_amount)*100; 
							}
							echo fn_number_format($variance_embro_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Garment Dyeing Cost"  align="right">
						<? 
							$variance_dyeing_cost=$other_amount-$dyeing_cost_actual;
							if($variance_dyeing_cost==0 && $other_amount==0)
							{
								$variance_dyeing_cost_per=0;
							}
							else
							{
								$variance_dyeing_cost_per=($variance_dyeing_cost/$other_amount)*100; 
							}
							echo fn_number_format($variance_dyeing_cost,2,'.','');
						?>
					</td>
						<td width="100" title="Garment Wasing Cost"  align="right">
						<? 
							$variance_wash_cost=$wash_cost-$wash_cost_actual;
						if($variance_wash_cost==0 )
							{
								$variance_wash_cost_per=0;
							}
							else
							{
								$variance_wash_cost_per=($variance_wash_cost/$wash_cost)*100; 
							}
							echo fn_number_format($variance_wash_cost_per,2,'.','');
						?>
					</td>
					
					<td width="100"  align="right">
						<? 
							$variance_commission_cost=$commission_cost_mkt-$commission_cost_actual;
							if($variance_commission_cost==0 && $commission_cost_mkt==0)
							{
								$variance_commission_cost_per=0;
							}
							else
							{
								$variance_commission_cost_per=($variance_commission_cost/$commission_cost_mkt)*100; 
							}
							echo fn_number_format($variance_commission_cost,2,'.',''); 
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_comm_cost=$comm_cost_mkt-$comm_cost_actual;
							if($variance_comm_cost==0 )
							{
								$variance_commission_cost_per=0;
							}
							else
							{
								$variance_comm_cost_per=($variance_comm_cost/$comm_cost_mkt)*100; 
							}
							echo fn_number_format($variance_comm_cost,2,'.',''); 
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_freight_cost=$freight_cost_mkt-$freight_cost_actual;
							if($variance_freight_cost==0 && $freight_cost_mkt==0)
							{
								$variance_freight_cost_per=0;
							}
							else
							{
								$variance_freight_cost_per=($variance_freight_cost/$freight_cost_mkt)*100; 
							}
							echo fn_number_format($variance_freight_cost,2,'.',''); 
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_test_cost=$test_cost_mkt-$test_cost_actual;
							if($variance_test_cost==0 && $test_cost_mkt==0)
							{
								$variance_test_cost_per=0;
							}
							else
							{
								$variance_test_cost_per=($variance_test_cost/$test_cost_mkt)*100; 
							}
							echo fn_number_format($variance_test_cost,2,'.','');
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_inspection_cost=$inspection_cost_mkt-$inspection_cost_actual;
							if($variance_inspection_cost==0 && $inspection_cost_mkt==0)
							{
								$variance_inspection_cost_per=0;
							}
							else
							{
								$variance_inspection_cost_per=($variance_inspection_cost/$inspection_cost_mkt)*100; 
							}
							echo fn_number_format($variance_inspection_cost,2,'.','');
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_currier_cost=$currier_cost_mkt-$currier_cost_actual;
							if($variance_currier_cost==0 )
							{
								$variance_currier_cost_per=0;
							}
							else
							{
								$variance_currier_cost_per=($variance_currier_cost/$currier_cost_mkt)*100; 
							}
							echo fn_number_format($variance_currier_cost,2,'.','');
						?>
					</td>
					
						<td width="100"  align="right"></td>
						<td width="100"  align="right">
					</td>
						<td width="100"  align="right">
					</td>
						<td width="100"  align="right">
					</td>
						<td width="100"  align="right">
					</td>
						
					
					
					<td width="100"  align="right">
						<? 
							$variance_cm_cost=$cm_cost_mkt-$cm_cost_actual;
							if($variance_cm_cost_per==0)
							{
								$variance_cm_cost_per=0;
							}
							else
							{
								$variance_cm_cost_per=($variance_cm_cost/$cm_cost_mkt)*100; 
							}
							echo fn_number_format($variance_cm_cost,2,'.',''); 
						?>
					</td>
					
						<td width="100"  align="right"></td>
						<td width="100"  align="right"></td>
						<td width="100"  align="right"></td>
						
					
					<td width="100"  align="right">
						<? 
							$variance_all_cost=$mkt_all_cost-$actual_all_cost;
							if($variance_all_cost==0)
							{
								$variance_all_cost_per=0;
							}
							else
							{
								$variance_all_cost_per=($variance_all_cost/$mkt_all_cost)*100; 
							}
							
							echo fn_number_format($variance_all_cost,2,'.','');
						?>
					</td>
					<td width="100"  align="right">
						<? 
							$variance_margin_cost=$mkt_margin-$actual_margin;
							if($variance_margin_cost==0)
							{
								$variance_margin_cost_per=0;
							}
							else
							{
								$variance_margin_cost_per=($variance_margin_cost/$mkt_margin)*100; 
							}
							echo fn_number_format($variance_margin_cost,2,'.','');
						?>
					</td>
					<td  width="100" align="right">
						<? 
							$variance_per_cost=$mkt_margin_perc-$actual_margin_perc;
							if($variance_per_cost==0)
							{
								$variance_per_cost_per=0;
							}
							else
							{
								$variance_per_cost_per=($variance_per_cost/$mkt_margin_perc)*100; 
							}
							echo fn_number_format($variance_per_cost,2,'.','');
						?>
					</td>
						<td width="100"  align="right"></td>
						<td   align="right"></td>
					
				</tr>
				<tr bgcolor="#DFDFDF" onClick="change_color('tr_vp<? echo $i; ?>','#DFDFDF')" id="tr_vp<? echo $i; ?>">
					<td width="100" align="left"><b>Variance (%)</b></td>
					<td width="100" align="right" ><? echo fn_number_format($variance_qnty_per,2,'.',''); ?></td>
					<td width="110" align="right" ><? echo fn_number_format($variance_po_value_per,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($variance_yarn_cost_per,2,'.',''); ?></td>
					<td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($variance_yarn_value_addition_cost_per,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($variance_knit_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_knit_cost_per,2,'.',''); ?></td>
					
					<td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($variance_grey_fab_cost_per,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($variance_dye_finish_cost_per,2,'.',''); ?></td>
					
					<td width="110"  align="right"><? echo fn_number_format($variance_aop_cost_per,2,'.',''); ?></td>
					<td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($variance_aop_cost_per,2,'.',''); ?></td>
					<td width="100" title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($variance_fin_fabric_cost_per,2,'.',''); ?></td>
					
					<td width="110"  align="right"><? echo fn_number_format($variance_finish_purchase_cost_per,2,'.',''); ?></td>
					<td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($variance_finished_fab_cost_per,2,'.',''); ?></td>
						<td width="100"  align="right"><?  echo fn_number_format($variance_tot_fabric_cost_per,2,'.',''); ?></td>
					<td width="110"  align="right"><? echo fn_number_format($variance_trims_cost_per,2,'.',''); ?></td>
					<td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($variance_print_cost_per,2,'.',''); ?></td>
					<td width="100" title="Garment Embro Cost"  align="right"><? echo fn_number_format($variance_embro_cost_per,2,'.',''); ?></td>
					<td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($variance_dyeing_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_wash_cost_per,2,'.',''); ?></td>
					
					
					<td width="100"  align="right"><? echo fn_number_format($variance_commission_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_comm_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_freight_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_test_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_inspection_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					
					
						
					
					<td width="100"  align="right"><? echo fn_number_format($variance_cm_cost_per,2,'.',''); ?></td>
					
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_currier_cost_per,2,'.',''); ?></td>
					
					
					<td width="100"  align="right"><? echo fn_number_format($variance_all_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
					<td   width="100" align="right"><? echo fn_number_format($variance_per_cost_per,2,'.',''); ?></td>
					<td width="100"  align="right"><? //echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
					<td   align="right"><? //echo fn_number_format($variance_margin_cost_per,2,'.',''); ?></td>
				</tr>
				<?
				$i++;
			}
			
			$tot_mkt_margin_perc=($tot_mkt_margin/$tot_po_value)*100;
			if($tot_ex_factory_val==0)
			{
				$tot_actual_margin_perc=0;
			}
			else
			{
				$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
			}
			
			//$tot_actual_margin_perc=($tot_actual_margin/$tot_ex_factory_val)*100;
			
			?>
		</table>
	</div>
	<table class="rpt_table" width="5530" cellpadding="0" cellspacing="0" border="1" rules="all">
		<tr bgcolor="#CCDDEE" onClick="change_color('tr_pt','#CCDDEE')" id="tr_pt" style="font-weight:bold;">
			<td width="40">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="60">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="110">&nbsp;</td>
			<td width="120" align="">Total</td>
			
			<td width="90"  align="right"><? echo fn_number_format($tot_po_qnty,0,'.',''); ?></td>
			<td width="50">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="110"  align="right"><? echo fn_number_format($tot_po_value,2,'.',''); ?></td>
			<td width="100"  align="right">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">Pre Costing Total</td>
			<td width="100"  align="right"><? echo fn_number_format($tot_po_qnty,0,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_po_value,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_yarn_cost_mkt,2,'.',''); ?></td>
				<td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_knit_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? //echo fn_number_format($tot_knit_cost_mkt,2,'.',''); ?></td>
			
			<td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($tot_grey_fab_cost_mkt,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2,'.',''); ?></td>
			
			
			<td width="110"  align="right"><? echo fn_number_format($tot_aop_cost_mkt,2,'.',''); ?></td>
			<td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($tot_yarn_dye_cost_mkt,2,'.',''); ?></td> 
				<td width="100" title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2,'.',''); ?></td> 
				<td width="110"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2,'.',''); ?></td>
				<td width="100" title="Tot Finished Fabric Cost"  align="right"><? echo fn_number_format($total_finish_fabric_cost_mkt,2,'.',''); ?></td> 
				<td width="100"  align="right"><? echo fn_number_format($total_fabric_cost_mkt,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_trims_cost_mkt,2,'.',''); ?></td>
			<td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($tot_print_amount_mkt,2,'.',''); ?></td> 
			<td width="100" title="Garment Embroidery Cost"  align="right"><? echo fn_number_format($tot_embro_amount_mkt,2,'.',''); ?></td> 
			<td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_dyeing_amount_mkt,2,'.',''); ?></td> 
			<td width="100" title="Garment Wash Cost"  align="right"><? echo fn_number_format($tot_wash_amount_mkt,2,'.',''); ?></td> 
			
			
			<td width="100"  align="right"><? echo fn_number_format($tot_commission_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_comm_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_freight_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_test_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_currier_cost_mkt,2,'.',''); ?></td>
			
			<td width="100"  align="right"><? echo fn_number_format($tot_certificate_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_design_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_studio_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_operating_exp_mkt,2,'.',''); ?></td>
			
			
			<td width="100"  align="right"><? echo fn_number_format($tot_cm_cost_mkt,2,'.',''); ?></td>
			
			<td width="100"  align="right"><? echo fn_number_format($tot_interest_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_incometax_cost_mkt,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt,2,'.',''); ?></td>
			
			
			<td width="100"  align="right"><? echo fn_number_format($tot_mkt_all_cost,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_mkt_margin_perc,2,'.',''); ?></td>
			<td width="100"  align="right"><? //echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
			<td width=""  align="right"><? //echo fn_number_format($tot_mkt_margin,2,'.',''); ?></td>
		</tr>
		<? //echo die;?>
		<tr bgcolor="#CCCCFF" onClick="change_color('tr_at','#CCCCFF')" id="tr_at" style="font-weight:bold;">
			<td width="40">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="60">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="110">&nbsp;</td>
			<td width="120" align="">&nbsp;</td>
			<td width="90"  align="right">&nbsp;</td>
			<td width="50">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="110"  align="right">&nbsp;</td>
			<td width="100"  align="right">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">Actual Total</td>
			<td width="100" align="right" ><? echo fn_number_format($tot_ex_factory_qnty,0,'.',''); ?></td>
			<td width="110" align="right" ><? echo fn_number_format($tot_ex_factory_val,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_yarn_cost_actual,2,'.',''); ?></td>
			<td width="100" title="Yarn Dyeing/Twisting/Re-Waxing Cost"  align="right"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_knit_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_grey_fab_transfer_amt_actual,2,'.',''); ?></td>
			
			<td width="100" title="Grey Fabric Cost"  align="right"><? echo fn_number_format($tot_grey_fab_cost_actual,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_dye_finish_cost_actual,2,'.',''); ?></td>
			
			
			<td width="110"  align="right"><? echo fn_number_format($tot_aop_cost_actual,2,'.',''); ?></td>
			<td width="100" title="Finished Fabric Transfer Cost act"  align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2,'.',''); ?></td>
			<td width="100" title="Finished Fabric Purchase Cost act"  align="right"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2,'.',''); ?></td>
				<td width="110"  align="right"><? echo fn_number_format($tot_grey_fabric_purchase_cost_actual,2,'.',''); ?></td>
			<td width="100" title="Tot Finished Fabric Cost act"  align="right"><? echo fn_number_format($tot_finished_fab_cost_actual,2,'.',''); ?></td>
				<td width="100" title="Total Fab. Cost" align="right" ><? echo fn_number_format($tot_fabric_cost_actaul,2,'.',''); ?></td>
			<td width="110" align="right" ><? echo fn_number_format($tot_trims_cost_actual,2,'.',''); ?></td>
			<td width="100" title="Garment Printing Cost"  align="right"><? echo fn_number_format($tot_print_amount_actual,2,'.',''); ?></td>
			<td width="100" title="Garment Embro Cost"  align="right"><? echo fn_number_format($tot_embro_amount_actual,2,'.',''); ?></td>
			<td width="100" title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_dyeing_amount_actual,2,'.',''); ?></td>
			<td width="100" title="Garment Wash Cost"  align="right"><? echo fn_number_format($tot_wash_amount_actual,2,'.',''); ?></td>
				
				
			
			<td width="100"  align="right"><? echo fn_number_format($tot_commission_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_comm_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_freight_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_test_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_inspection_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_currier_cost_actual,2,'.',''); ?></td>
			
			<td width="100"  align="right"><? echo fn_number_format($tot_certificate_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_deffdlc_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_design_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_studio_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_operating_exp_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_cm_cost_actual,2,'.',''); ?></td>                
			<td width="100"  align="right"><? echo fn_number_format($tot_interest_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_incometax_cost_actual,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_actual,2,'.',''); ?></td>               
			<td width="100"  align="right"><? echo fn_number_format($tot_actual_all_cost,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_actual_margin,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_actual_margin_perc,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_yarn_qty_cpa_actual,2,'.',''); ?></td>
			<td width=""  align="right"><? echo fn_number_format($tot_actual_net_margin,2,'.',''); ?></td>
		</tr>
		<tr bgcolor="#FFEEFF" onClick="change_color('tr_vt','#FFEEFF')" id="tr_vt" style="font-weight:bold;">
			<td width="40">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="60">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="110">&nbsp;</td>
			<td width="120" align="">&nbsp;</td>
			<td width="90"  align="right">&nbsp;</td>
			<td width="50">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="110"  align="right">&nbsp;</td>
			<td width="100"  align="right">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">Variance Total</td>
			<td width="100" align="right" >
				<? 
					$tot_variance_qnty=$tot_po_qnty-$tot_ex_factory_qnty;
					$tot_variance_qnty_per=($tot_variance_qnty/$tot_po_qnty)*100; 
					echo fn_number_format($tot_variance_qnty,0,'.',''); 
				?>
			</td>
			<td width="110" align="right" >
				<? 
					$tot_variance_po_value=$tot_po_value-$tot_ex_factory_val;
					$tot_variance_po_value_per=($tot_variance_po_value/$tot_po_value)*100; 
					echo fn_number_format($tot_variance_po_value,2,'.',''); 
				?>
			</td>
			<td width="110"  align="right">
				<? 
					$tot_variance_yarn_cost=$tot_yarn_cost_mkt-$tot_yarn_cost_actual;
					$tot_variance_yarn_cost_per=($tot_variance_yarn_cost/$tot_yarn_cost_mkt)*100; 
					echo fn_number_format($tot_variance_yarn_cost,2,'.',''); 
				?>
			</td>
				<td width="100"  align="right">
				<? 
					$tot_variance_yarn_value_addition_cost=$tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual;
					if($tot_variance_yarn_value_addition_cost==0)
					{
					$tot_variance_yarn_value_addition_cost_per=0;
					}
					else
					{
					$tot_variance_yarn_value_addition_cost_per=($tot_variance_yarn_value_addition_cost/$tot_yarn_value_addition_cost_mkt)*100; 
					}
					// $tot_variance_yarn_value_addition_cost_per=($tot_variance_yarn_value_addition_cost/$tot_yarn_value_addition_cost_mkt)*100; 
					echo fn_number_format($tot_variance_yarn_value_addition_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_kint_cost=$tot_knit_cost_mkt-$tot_knit_cost_actual;
					$tot_variance_knit_cost_per=($tot_variance_kint_cost/$tot_knit_cost_mkt)*100; 
					echo fn_number_format($tot_variance_kint_cost,2,'.',''); 
				?>
			</td>
				<td width="100"  align="right">
				<? 
					//$tot_variance_kint_cost=$tot_knit_cost_mkt-$tot_knit_cost_actual;
					// $tot_variance_knit_cost_per=($tot_variance_kint_cost/$tot_knit_cost_mkt)*100; 
					// echo fn_number_format($tot_variance_kint_cost,2,'.',''); 
				?>
			</td>
			
				<td width="100"  title="Grey Fabric Cost" align="right">
				<? 
					$tot_variance_grey_fab_cost=$tot_grey_fab_cost_mkt-$tot_grey_fab_cost_actual;
					if($tot_variance_grey_fab_cost==0)
					{
						$tot_variance_grey_fab_cost_per=0;
					}
					else
					{
							$tot_variance_grey_fab_cost_per=($tot_variance_grey_fab_cost/$tot_grey_fab_cost_mkt)*100; 
					}    
					echo fn_number_format($tot_variance_grey_fab_cost,2,'.',''); 
				?>
			</td>
			<td width="110"  align="right">
				<? 
					$tot_variance_dye_finish_cost=$tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual;
					if($tot_variance_dye_finish_cost==0)
					{
						$tot_variance_dye_finish_cost_per=0;
					}
					else
					{
							$tot_variance_dye_finish_cost_per=($tot_variance_dye_finish_cost/$tot_dye_finish_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_dye_finish_cost,2,'.','');
				?>
			</td>
			
			<td width="110"  align="right">
				<? 
					$tot_variance_aop_cost=$tot_aop_cost_mkt-$tot_aop_cost_actual;
					if($tot_variance_aop_cost==0)
					{
						$tot_variance_aop_cost_per=0;
					}
					else
					{
							$tot_variance_aop_cost_per=($tot_variance_aop_cost/$tot_aop_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_aop_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  title="Fabric Purchase Trans Cost"  align="right">
				<? 
					/*$tot_variance_aop_cost=$tot_aop_cost_mkt-$tot_aop_cost_actual;
					$tot_variance_aop_cost_per=($tot_variance_aop_cost/$tot_aop_cost_mkt)*100; 
					echo fn_number_format($tot_variance_aop_cost,2,'.','');*/ 
				?>
			</td>
			<td width="100" title="Fabric Purchase Cost" align="right">
				<? 
					$tot_variance_fin_fabric_purchase_cost=$tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual;
					if($tot_variance_fin_fabric_purchase_cost==0)
					{
						$tot_variance_fin_fabric_purchase_cost_per=0;
					}
					else
					{
							$tot_variance_fin_fabric_purchase_cost_per=($tot_variance_fin_fabric_purchase_cost/$tot_fabric_purchase_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_fin_fabric_purchase_cost,2,'.','');
				?>
			</td>
				<td width="110"  align="right">
				<? 
					$tot_variance_fabric_purchase_cost=$tot_fabric_purchase_cost_mkt-$tot_grey_fabric_purchase_cost_actual;
					if($tot_variance_fabric_purchase_cost==0)
					{
						$tot_variance_fabric_purchase_cost_per=0;
					}
					else
					{
							$tot_variance_fabric_purchase_cost_per=($tot_variance_fabric_purchase_cost/$tot_fabric_purchase_cost_mkt)*100; 
					}
					echo fn_number_format($tot_variance_fabric_purchase_cost,2,'.','');
				?>
			</td>
			<td width="100" title="Tot Fin Fabric  Cost"  align="right">
				<? 
					$tot_variance_fin_fab_cost=$total_finish_fabric_cost_mkt-$tot_finished_fab_cost_actual;
					if($tot_variance_fin_fab_cost==0)
					{
						$tot_variance_fin_fab_cost_per=0;
					}
					else
					{
							$tot_variance_fin_fab_cost_per=($tot_variance_fin_fab_cost/$total_finish_fabric_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_fin_fab_cost,2,'.',''); 
				?>
			</td>
			<td width="100" title="Tot Fabric  Cost"  align="right">
				<? 
					$tot_variance_fabric_cost_mkt=$total_fabric_cost_mkt-$tot_fabric_cost_actaul;
					if($tot_variance_fabric_cost_mkt==0)
					{
						$tot_variance_fabric_cost_mkt_per=0;
					}
					else
					{
							$tot_variance_fabric_cost_mkt_per=($tot_variance_fabric_cost_mkt/$tot_fabric_cost_mkt)*100;  
					} 
					
					echo fn_number_format($tot_variance_fabric_cost_mkt,2,'.','');
				?>
			</td>
			<td width="110"  align="right">
				<? 
					$tot_variance_trims_cost=$tot_trims_cost_mkt-$tot_trims_cost_actual;
					if($tot_variance_trims_cost==0)
					{
						$tot_variance_trims_cost_per=0;
					}
					else
					{
							$tot_variance_trims_cost_per=($tot_variance_trims_cost/$tot_trims_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_trims_cost,2,'.','');
				?>
			</td>
				<td width="100" title="Garment Printing Cost" align="right">
				<? 
					$tot_variance_print_amount=$tot_print_amount_mkt-$tot_print_amount_actual;
					if($tot_variance_print_amount==0)
					{
						$tot_variance_print_per=0;
					}
					else
					{
							$tot_variance_print_per=($tot_variance_print_amount/$tot_print_amount_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_print_amount,2,'.','');
				?>
			</td>
				<td width="100" title="Garment Embro  Cost"  align="right">
				<? 
					$tot_variance_embro_cost=$tot_embro_amount_mkt-$tot_embro_amount_actual;//tot_wash_amount_mkt-tot_wash_amount_actual
					if($tot_variance_embro_cost==0)
					{
						$tot_variance_embro_cost_per=0;
					}
					else
					{
						$tot_variance_embro_cost_per=($tot_variance_embro_cost/$tot_embro_amount_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_embro_cost,2,'.','');
				?>
			</td>
				<td width="100" title="Garment Dyeing Cost"  align="right">
				<? 
				
					$tot_variance_dyeing_cost=$tot_dyeing_amount_mkt-$tot_dyeing_amount_actual;
					if($tot_variance_dyeing_cost==0)
					{
						$tot_variance_dyeing_cost_per=0;
					}
					else
					{
							$tot_variance_dyeing_cost_per=($tot_variance_dyeing_cost/$tot_dyeing_amount_mkt)*100; 
					} 
					//echo $tot_variance_dyeing_cost.'='.$tot_dyeing_amount_mkt.', ';
					echo fn_number_format($tot_variance_dyeing_cost,2,'.',''); 
				?>
			</td>
				<td width="100" title="Garment Wash Cost"  align="right">
				<? 
					$tot_variance_wash_cost=$tot_wash_amount_mkt-$tot_wash_amount_actual;
					if($tot_variance_wash_cost==0)
					{
						$tot_variance_wash_cost_per=0;
					}
					else
					{
							$tot_variance_wash_cost_per=($tot_variance_wash_cost/$tot_wash_amount_mkt)*100; 
					}   
					echo fn_number_format($tot_variance_wash_cost,2,'.','');
				?>
			</td>
			
			<td width="100" align="right">
				<? 
					$tot_variance_commission_cost=$tot_commission_cost_mkt-$tot_commission_cost_actual;
					if($tot_variance_commission_cost==0)
					{
						$tot_variance_commission_cost_per=0;
					}
					else
					{
							$tot_variance_commission_cost_per=($tot_variance_commission_cost/$tot_commission_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_commission_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_comm_cost=$tot_comm_cost_mkt-$tot_comm_cost_actual;
					if($tot_variance_comm_cost==0)
					{
						$tot_variance_comm_cost_per=0;
					}
					else
					{
							$tot_variance_comm_cost_per=($tot_variance_comm_cost/$tot_comm_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_comm_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_freight_cost=$tot_freight_cost_mkt-$tot_freight_cost_actual;
					if($tot_variance_freight_cost==0)
					{
						$tot_variance_freight_cost_per=0;
					}
					else
					{
						$tot_variance_freight_cost_per=($tot_variance_freight_cost/$tot_freight_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_freight_cost,2,'.',''); 
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_test_cost=$tot_test_cost_mkt-$tot_test_cost_actual;
					if($tot_variance_test_cost==0)
					{
						$tot_variance_test_cost_per=0;
					}
					else
					{
							$tot_variance_test_cost_per=($tot_variance_test_cost/$tot_test_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_test_cost,2,'.','');
				?>
			</td>
			<td width="100" align="right">
				<? 
					$tot_variance_inspection_cost=$tot_inspection_cost_mkt-$tot_inspection_cost_actual;
					if($tot_variance_inspection_cost==0)
					{
						$tot_variance_inspection_cost_per=0;
					}
					else
					{
							$tot_variance_inspection_cost_per=($tot_variance_inspection_cost/$tot_inspection_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_inspection_cost,2,'.','');
				?>
			</td>
			<td width="100" align="right">
				<? 
					$tot_variance_currier_cost=$tot_currier_cost_mkt-$tot_currier_cost_actual;
					if($tot_variance_currier_cost==0)
					{
						$tot_variance_currier_cost_per=0;
					}
					else
					{
							$tot_variance_currier_cost_per=($tot_variance_currier_cost/$tot_currier_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_currier_cost,2,'.','');
				?>
			</td>
			
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				
			
			
			<td width="100"  align="right">
				<? 
					$tot_variance_cm_cost=$tot_cm_cost_mkt-$tot_cm_cost_actual;
					if($tot_variance_cm_cost==0)
					{
						$tot_variance_cm_cost_per=0;
					}
					else
					{
						$tot_variance_cm_cost_per=($tot_variance_cm_cost/$tot_cm_cost_mkt)*100; 
					} 
					echo fn_number_format($tot_variance_cm_cost,2,'.',''); 
				?>
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
				<td width="100" align="right">
			</td>
			
			
			<td width="100" align="right">
				<? 
					$tot_variance_all_cost=$tot_mkt_all_cost-$tot_actual_all_cost;
					if($tot_variance_all_cost==0)
					{
						$tot_variance_all_cost_per=0;
					}
					else
					{
						$tot_variance_all_cost_per=($tot_variance_all_cost/$tot_mkt_all_cost)*100; 
					} 
					echo fn_number_format($variance_all_cost,2,'.','');
				?>
			</td>
			<td width="100"  align="right">
				<? 
					$tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
					$tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
					echo fn_number_format($tot_variance_margin_cost,2,'.','');
				?>
			</td>
			<td width="100" align="right">
				<? 
					$tot_variance_per_cost=$tot_mkt_margin_perc-$tot_actual_margin_perc;
					$tot_variance_per_cost_per=($tot_variance_per_cost/$tot_mkt_margin_perc)*100; 
					echo fn_number_format($tot_variance_per_cost,2,'.','');
				?>
			</td>
				<td width="100"  align="right">
				<? 
					/* $tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
					$tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
					echo fn_number_format($tot_variance_margin_cost,2,'.','');*/
				?>
			</td>
				<td width=""  align="right">
				<? 
					/* $tot_variance_margin_cost=$tot_mkt_margin-$tot_actual_margin;
					$tot_variance_margin_cost_per=($tot_variance_margin_cost/$tot_mkt_margin)*100; 
					echo fn_number_format($tot_variance_margin_cost,2,'.','');*/
				?>
			</td>
		</tr>
		<tr bgcolor="#CCCCEE" onClick="change_color('tr_vpt','#CCCCEE')" id="tr_vpt" style="font-weight:bold;">
			<td width="40">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="60">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="110">&nbsp;</td>
			<td width="120" align=""></td>
			<td width="90"  align="right">&nbsp;</td>
			<td width="50">&nbsp;</td>
			<td width="70">&nbsp;</td>
			<td width="110" align="right">&nbsp;</td>
			<td width="100"  align="right">&nbsp;</td>
			<td width="80">&nbsp;</td>
			<td width="100">&nbsp;</td>
			<td width="100">Variance (%) Total</td>
			<td width="100" align="right" ><? echo fn_number_format($tot_variance_qnty_per,0,'.',''); ?></td>
			<td width="110" align="right" ><? echo fn_number_format($tot_variance_po_value_per,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_yarn_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_yarn_value_addition_cost_per,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_knit_cost_per,2,'.',''); ?></td>
			<td width="100" title="Grey Fabric Transfer Cost" align="right"><? //echo fn_number_format($tot_variance_knit_cost_per,2,'.',''); ?></td>
			
			<td width="100" title="Grey Fabric Cost" align="right"><? echo fn_number_format($tot_variance_grey_fab_cost_per,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_dye_finish_cost_per ,2,'.',''); ?></td>
			
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_aop_cost_per,2,'.',''); ?></td>
				<td width="100" title="Finished Fabric Transfer Cost"  align="right"><? //echo fn_number_format($tot_variance_aop_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Finished Fabric Purchase Cost"  align="right"><? echo fn_number_format($tot_variance_fin_fabric_purchase_cost_per,2,'.',''); ?></td>
				<td width="110" align="right"><? echo fn_number_format($tot_variance_fabric_purchase_cost_per ,2,'.',''); ?></td>
				<td width="100"  title="Finished Fabric Cost"  align="right"><? echo fn_number_format($tot_variance_fin_fab_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Total Fabric Cost"  align="right"><? echo fn_number_format($tot_variance_fabric_cost_mkt_per,2,'.',''); ?></td>
			<td width="110"  align="right"><? echo fn_number_format($tot_variance_trims_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Garment Printing Cost" align="right"><? echo fn_number_format($tot_variance_print_per,2,'.',''); ?></td>
				<td width="100"  title="Garment Embro Cost" align="right"><? echo fn_number_format($tot_variance_embro_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Garment Dyeing Cost"  align="right"><? echo fn_number_format($tot_variance_dyeing_cost_per,2,'.',''); ?></td>
				<td width="100"  title="Garment Wash Cost" align="right"><? echo fn_number_format($tot_variance_wash_cost_per,2,'.',''); ?></td>
				
			
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_commission_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_comm_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_freight_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_test_cost_per,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_inspection_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
			
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
			
				
				
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_cm_cost_per,2,'.',''); ?></td>
			
				<td width="100" align="right" title="Interest"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_currier_cost_per,2,'.',''); ?></td>
			
			
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_all_cost_per,2,'.',''); ?></td>
			<td width="100" align="right"><? echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
			<td width="100"  align="right"><? echo fn_number_format($tot_variance_per_cost_per,2,'.',''); ?></td>
				<td width="100" align="right"><? //echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
				<td width="" align="right"><? //echo fn_number_format($tot_variance_margin_cost_per,2,'.',''); ?></td>
		</tr>
	</table>
	<br />
	<table width="4330">
		<tr>
			<td width="850" valign="top">
				<div align="center" style="width:450px" id="div_summary"><input type="button" value="Print Preview" class="formbutton" onClick="new_window2('company_div','summary_full')" /></div>
				<br /><? $po_ids=implode(',',$po_ids_array);$job_ids=rtrim($job_ids,','); $job_nos=implode(',',array_unique(explode(",",$job_ids))); ?>
				<div id="summary_full"> <font color="#FF0000" style="display:none">*Yarn Dyeing Charge included with actual Yarn Cost</font>
					<div align="center" id="company_div" style="visibility:hidden; font-size:24px;width:700px"><b><? echo $company_arr[$company_name].'<br>'; 
					echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to));
					?></b></div>
					<table width="850" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
						<thead>
						<tr>
							<th colspan="9">Summary</th>
						</tr>
						<tr>
							<th width="30">SL</th>
							<th width="180">Particulars</th>
							<th width="130">Pre Costing</th>
							<th width="80">%</th>
							<th width="130">At Actual</th>
							<th width="80">%</th>
							<th width="80">Variance</th>
							<th width="80">%</th>
							<th>Disclosure</th>
						</tr> 
						<?
							$bgcolor1='#E9F3FF';
							$bgcolor2='#FFFFFF';
						?>
						</thead>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_1','<? echo $bgcolor1; ?>')" id="trtd_1">
							<td align="center">1</td>
							<td>PO/Shipment Value</td>
							<td align="right"><? echo fn_number_format($tot_po_value,2); ?></td>
							<td align="right">&nbsp;</td>
							<td align="right"><? echo fn_number_format($tot_ex_factory_val,2); ?></td>
							<td align="right">&nbsp;</td>
							<td align="right"><? echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
							<td align="right"  title="Variance/PO-Shipment Value Mkt*100"><? echo fn_number_format((($tot_ex_factory_val-$tot_po_value)/$tot_po_value)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_2','<? echo $bgcolor2; ?>')" id="trtd_2">
							<td colspan="9"><b>Cost</b></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_3','<? echo $bgcolor1; ?>')" id="trtd_3">
							<td align="center">2</td>
							<td>Grey Yarn Cost</td>
							<td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_cost','Grey Yarn Mkt. Cost Details')"><? echo fn_number_format($tot_yarn_cost_mkt,2); //$tot_yarn_qty_actual?></a></td>
							<td align="right"><? echo fn_number_format(($tot_yarn_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_cost_actual','Yarn Cost Details')"><? echo fn_number_format($tot_yarn_cost_actual,2); //$tot_yarn_qty_actual;?></a></td>
							<td align="right"><? echo fn_number_format(($tot_yarn_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_yarn_cost_mkt-$tot_yarn_cost_actual,2);//$tot_yarn_amt_actual ?></td>
							<td align="right"  title="Variance/Grey Yarn Cost Mkt*100"><? echo fn_number_format((($tot_yarn_cost_mkt-$tot_yarn_cost_actual)/$tot_yarn_cost_mkt)*100,2); ?></td>
								<td align="right"><?  if($tot_yarn_qty_actual>$tot_yarn_cost_mkt) echo "Returnable Yarn Qty..".$tot_yarn_qty_actual."And Cost..".$tot_yarn_amt_actual; else echo " ";?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_4','<? echo $bgcolor2; ?>')" id="trtd_4">
							<td align="center">3</td>
							<td>Yarn  Value Addition Cost</td>
							<td align="right"><a href="#report_details" onClick="openmypage_mkt('<? echo $po_ids."**".$job_nos; ?>','mkt_yarn_dyeing_twisting_cost','Yarn Dyeing Cost Details')"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></a><? //echo fn_number_format($tot_yarn_value_addition_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','yarn_dye_twist_cost_actual','Yarn Dyeing & Twist Cost Details','2','900px')"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2); ?></a></td>
							<td align="right"><? echo fn_number_format(($tot_yarn_value_addition_cost_mkt/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual,2); ?></td>
								<td align="right" title="Variance/Yarn Value  Addition Cost Mkt*100"><? echo fn_number_format((($tot_yarn_value_addition_cost_mkt-$tot_yarn_dyeing_twist_actual)/$tot_yarn_value_addition_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_5','<? echo $bgcolor2; ?>')" id="trtd_5">
							<td align="center">4</td>
							<td>Knitting Cost</td>
							<td align="right"><? echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knit_cost_actual_popup','Knitting Cost Details')"><? echo fn_number_format($tot_knit_cost_actual,2); ?></a><? //echo fn_number_format($tot_knit_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
								<td align="right" title="Variance/Knitting Cost Mkt*100"><? echo fn_number_format((($tot_knit_cost_mkt-$tot_knit_cost_actual)/$tot_knit_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_6','<? echo $bgcolor2; ?>')" id="trtd_6">
							<td align="center">5</td>
							<td>Grey Fabric Transfer Cost</td>
							<td align="right"><? //echo fn_number_format($tot_knit_cost_mkt,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_knit_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? 
									//echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); ?></a><? 
									//echo fn_number_format($tot_grey_fab_transfer_amt_actual,2); 
									echo fn_number_format($tot_gray_transfer_actual,2); 

								?>

							</td>
							<td align="right"><? //echo fn_number_format(($tot_knit_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_knit_cost_mkt-$tot_knit_cost_actual,2); ?></td>
								<td align="right"><? echo ""; ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_7','<? echo $bgcolor2; ?>')" id="trtd_7">
							<td align="center">6</td>
							<td>Grey Fabric Cost =2+3+4+5</td>
							<td align="right"><? 
							$grey_fab_cost_mkt_sum=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt;
							$grey_fab_cost_act_sum=$tot_yarn_cost_actual+$tot_yarn_dyeing_twist_actual+$tot_knit_cost_actual+$tot_grey_fab_transfer_amt_actual;
							
							echo fn_number_format($grey_fab_cost_mkt_sum,2); ?></td>
							<td align="right"><? echo fn_number_format(($grey_fab_cost_mkt_sum/$tot_po_value)*100,2); ?></td>
							<td align="right" title=""><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','knitting_cost','Knitting Cost Details')"><? //echo fn_number_format($tot_grey_fab_cost_actual,2); ?></a><? echo fn_number_format($grey_fab_cost_act_sum,2); ?></td>
							<td align="right"><? echo fn_number_format(($grey_fab_cost_act_sum/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum,2); ?></td>
								<td align="right" title="Variance/Grey Fab Cost Mkt*100"><? echo fn_number_format((($grey_fab_cost_mkt_sum-$grey_fab_cost_act_sum)/$grey_fab_cost_mkt_sum)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_8','<? echo $bgcolor2; ?>')" id="trtd_8">
							<td align="center">7</td>
							<td>Dye & Fin Cost</td>
							<td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_dye_finish_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage_actual3('<? echo $po_ids; ?>','dye_finish_cost_actual_popup','Actual Dyeing & Finish Cost Details','800px')"><? echo fn_number_format($tot_dye_finish_cost_actual,2,'.',''); ?></a></td>
							<td align="right"><? echo fn_number_format(($tot_dye_finish_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual,2); ?></td>
								<td align="right" title="Variance/Dye & Fin Cost Mkt*100"><?  echo fn_number_format((($tot_dye_finish_cost_mkt-$tot_dye_finish_cost_actual)/$tot_dye_finish_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_9','<? echo $bgcolor1; ?>')" id="trtd_9">
							<td align="center">8</td>
							<td>AOP  Cost</td>
							<td align="right"><? echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_aop_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
								<td align="right" title="Variance/AOP Cost Mkt*100"><? echo fn_number_format((($tot_aop_cost_mkt-$tot_aop_cost_actual)/$tot_aop_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_10','<? echo $bgcolor2; ?>')" id="trtd_10">
							<td align="center">9</td>
							<td>Finished Fabric Transfer Cost</td>
							<td align="right"><? //echo fn_number_format($tot_aop_cost_mkt,2); ?></td>
							<td align="right"><? // echo fn_number_format(($tot_aop_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_aop_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_aop_cost_mkt-$tot_aop_cost_actual,2); ?></td>
								<td align="right"><? echo " "; ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_11','<? echo $bgcolor1; ?>')" id="trtd_11">
							<td align="center">10</td>
							<td>Finished Fabric Cost =6+7+8+9</td>
							<td align="right"><? $tot_fin_fab_cost_sum_mkt=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
							//$tot_fin_fabCost=$tot_yarn_cost_mkt+$tot_yarn_value_addition_cost_mkt+$tot_knit_cost_mkt+$tot_dye_finish_cost_mkt+$tot_aop_cost_mkt;
							echo fn_number_format($tot_fin_fab_cost_sum_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? $tot_fin_fab_cost_sum_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual;
							echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_fin_fab_cost_sum_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual,2); ?></td>
								<td align="right" title="Variance/Finished Fabric Cost Mkt*100"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt-$tot_fin_fab_cost_sum_actual)/$tot_fin_fab_cost_sum_mkt)*100,2);  ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_12','<? echo $bgcolor2; ?>')" id="trtd_12">
							<td align="center">11</td>
							<td>Fabric Purchase Cost</td>
							<td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><a href="#report_details" onClick="openmypage('<? echo $po_ids; ?>','fabric_purchase_cost','Fabric Purchase Cost Details')"><? echo fn_number_format($tot_fabric_purchase_cost_actual,2); ?></a></td>
							<td align="right"><? echo fn_number_format(($tot_fabric_purchase_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual,2); ?></td>
							<td align="right" title="Variance/Fabric Purchase Cost Mkt*100"><? echo fn_number_format((($tot_fabric_purchase_cost_mkt-$tot_fabric_purchase_cost_actual)/$tot_fabric_purchase_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_27','<? echo $bgcolor2; ?>')" id="trtd_27">
							<td align="center">12</td>
							<td>Total Fabric Cost(=10+11)</td>
							<td align="right"><? $tot_fab_cost_mkt=$tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt;
							echo fn_number_format($tot_fab_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format((($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)/$tot_po_value)*100,2); ?></td>
							<td align="right"><? 
							$tot_fabric_cost_actual=$tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual;
							echo fn_number_format($tot_grey_fab_cost_actual+$tot_dye_finish_cost_actual+$tot_aop_cost_actual+$tot_fin_fab_transfer_amt_actual+$tot_fabric_purchase_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_fabric_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? $tot_fab_cost_vairance=($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual;
							echo fn_number_format(($tot_fin_fab_cost_sum_mkt+$tot_fabric_purchase_cost_mkt)-$tot_fabric_cost_actual,2); ?></td>
								<td align="right"><?  echo fn_number_format(($tot_fab_cost_vairance/$tot_fab_cost_mkt)*100,2); ?></td>
								<td align="right"><? echo ' '; ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_13','<? echo $bgcolor1; ?>')" id="trtd_13">
							<td align="center">13</td>
							<td>Trims Cost</td>
							<td align="right"><? echo fn_number_format($tot_trims_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_trims_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_trims_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_trims_cost_mkt-$tot_trims_cost_actual,2); ?></td>
								<td align="right" title="Variance/Trim Cost Mkt*100"><? echo fn_number_format((($tot_trims_cost_mkt-$tot_trims_cost_actual)/$tot_trims_cost_mkt)*100,2);  ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_14','<? echo $bgcolor2; ?>')" id="trtd_14">
							<td align="center">14</td>
							<td>Printing Cost</td>
							<td align="right"><? echo fn_number_format($tot_print_amount_mkt,2); ?></td>
							<td align="right"><?  echo fn_number_format(($tot_print_amount_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_print_amount_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_trims_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_print_amount_mkt-$tot_print_amount_actual,2); ?></td>
							<td align="right" title="Variance/Printing Cost Mkt*100"><?  echo fn_number_format((($tot_print_amount_mkt-$tot_print_amount_actual)/$tot_print_amount_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_15','<? echo $bgcolor1; ?>')" id="trtd_15">
							<td align="center">15</td>
							<td> Embroidery Cost</td>
							<td align="right"><? echo fn_number_format($tot_embro_amount_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_embro_amount_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_embro_amount_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_embro_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_embro_amount_mkt-$tot_embro_amount_actual,2); ?></td>
								<td align="right" title="Variance/Embroidery Cost Mkt*100"><?  echo fn_number_format((($tot_embro_amount_mkt-$tot_embro_amount_actual)/$tot_embro_amount_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_16','<? echo $bgcolor2; ?>')" id="trtd_16">
							<td align="center">16</td>
							<td>Gmt Dyeing  Cost</td>
							<td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_dyeing_amount_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_dyeing_amount_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_dyeing_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual,2); ?></td>
								<td align="right" title="Variance/Gmt Dyeing Cost Mkt*100"><?  echo fn_number_format((($tot_dyeing_amount_mkt-$tot_dyeing_amount_actual)/$tot_dyeing_amount_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_17','<? echo $bgcolor1; ?>')" id="trtd_17">
							<td align="center">17</td>
							<td>Washing  Cost</td>
							<td align="right"><? echo fn_number_format($tot_wash_amount_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_wash_amount_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_wash_amount_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_wash_amount_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_wash_amount_mkt-$tot_wash_amount_actual,2); ?></td>
							<td align="right" title="Variance/Washing Cost Mkt*100"><?  echo fn_number_format((($tot_wash_amount_mkt-$tot_wash_amount_actual)/$tot_wash_amount_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr> 
						
						<tr bgcolor="<? echo $bgcolor2; ?>"  onclick="change_color('trtd_18','<? echo $bgcolor2; ?>')" id="trtd_18">
							<td align="center">18</td>
							<td>Commission Cost</td>
							<td align="right"><? echo fn_number_format($tot_commission_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_commission_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_commission_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_commission_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_commission_cost_mkt-$tot_commission_cost_actual,2); ?></td>
							<td align="right" title="Variance/Commission Cost Mkt*100"><?  echo fn_number_format((($tot_commission_cost_mkt-$tot_commission_cost_actual)/$tot_commission_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_19','<? echo $bgcolor1; ?>')" id="trtd_19">
							<td align="center">19</td>
							<td>Commercial Cost</td>
							<td align="right"><? echo fn_number_format($tot_comm_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_comm_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_comm_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_comm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_comm_cost_mkt-$tot_comm_cost_actual,2); ?></td>
							<td align="right" title="Variance/Commercial Cost Mkt*100"><?  echo fn_number_format((($tot_comm_cost_mkt-$tot_comm_cost_actual)/$tot_comm_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_20','<? echo $bgcolor2; ?>')" id="trtd_20">
							<td align="center">20</td>
							<td>Freight Cost</td>
							<td align="right"><? echo fn_number_format($tot_freight_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_freight_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_freight_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_freight_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_freight_cost_mkt-$tot_freight_cost_actual,2); ?></td>
								<td align="right" title="Variance/Freight Cost Mkt*100"><?  echo fn_number_format((($tot_freight_cost_mkt-$tot_freight_cost_actual)/$tot_freight_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>"  onclick="change_color('trtd_21','<? echo $bgcolor1; ?>')" id="trtd_21">
							<td align="center">21</td>
							<td>Testing Cost</td>
							<td align="right"><? echo fn_number_format($tot_test_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_test_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_test_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_test_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_test_cost_mkt-$tot_test_cost_actual,2); ?></td>
							<td align="right" title="Variance/Testing Cost Mkt*100"><?  echo fn_number_format((($tot_test_cost_mkt-$tot_test_cost_actual)/$tot_test_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_22','<? echo $bgcolor2; ?>')" id="trtd_22">
							<td align="center">22</td>
							<td>Inspection Cost</td>
							<td align="right"><? echo fn_number_format($tot_inspection_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_inspection_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_inspection_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_inspection_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_inspection_cost_mkt-$tot_inspection_cost_actual,2); ?></td>
							<td align="right" title="Variance/Inspection Cost Mkt*100"><?  echo fn_number_format((($tot_inspection_cost_mkt-$tot_inspection_cost_actual)/$tot_inspection_cost_mkt)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_23','<? echo $bgcolor1; ?>')" id="trtd_23">
							<td align="center">23</td>
							<td>Courier Cost</td>
							<td align="right"><? echo fn_number_format($tot_currier_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_currier_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_currier_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_currier_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_currier_cost_mkt-$tot_currier_cost_actual,2); ?></td>
							<td align="right" title="Variance/Courier Cost Mkt*100"><?  echo fn_number_format((($tot_currier_cost_mkt-$tot_currier_cost_actual)/$tot_currier_cost_mkt)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>						
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_24','<? echo $bgcolor1; ?>')" id="trtd_23">
							<td align="center">24</td>
							<td>Certificate Cost</td>
							<td align="right"><? echo fn_number_format($tot_certificate_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_certificate_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_certificate_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_certificate_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_certificate_cost_mkt-$tot_certificate_cost_actual,2); ?></td>
							<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_certificate_cost_mkt-$tot_certificate_cost_actual)/$tot_certificate_cost_mkt)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>						
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_25','<? echo $bgcolor1; ?>')" id="trtd_25">
							<td align="center">25</td>
							<td>Deffd. LC Cost</td>
							<td align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_deffdlc_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_deffdlc_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_deffdlc_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_deffdlc_cost_mkt-$tot_deffdlc_cost_actual,2); ?></td>
							<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_deffdlc_cost_mkt-$tot_deffdlc_cost_actual)/$tot_deffdlc_cost_mkt)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_26','<? echo $bgcolor1; ?>')" id="trtd_26">
							<td align="center">26</td>
							<td>Design Cost</td>
							<td align="right"><? echo fn_number_format($tot_design_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_design_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_design_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_design_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_design_cost_mkt-$tot_design_cost_actual,2); ?></td>
							<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_design_cost_mkt-$tot_design_cost_actual)/$tot_design_cost_mkt)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>						
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_27','<? echo $bgcolor1; ?>')" id="trtd_27">
							<td align="center">27</td>
							<td>Studio  Cost</td>
							<td align="right"><? echo fn_number_format($tot_studio_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_studio_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_studio_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_studio_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_studio_cost_mkt-$tot_studio_cost_actual,2); ?></td>
							<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_studio_cost_mkt-$tot_studio_cost_actual)/$tot_studio_cost_mkt)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_28','<? echo $bgcolor1; ?>')" id="trtd_28">
							<td align="center">28</td>
							<td>Opert. Exp.</td>
							<td align="right"><? echo fn_number_format($tot_operating_exp_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_operating_exp_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_operating_exp_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_operating_exp_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_operating_exp_mkt-$tot_operating_exp_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_operating_exp_mkt-$tot_operating_exp_actual)/$tot_operating_exp_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>						
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_24','<? echo $bgcolor2; ?>')" id="trtd_24">
							<td align="center">29</td>
							<td>CM</td>
							<td align="right"><? echo fn_number_format($tot_cm_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_cm_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_cm_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_cm_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_cm_cost_mkt-$tot_cm_cost_actual,2); ?></td>
							<td align="right" title="Variance/CM Cost Mkt*100"><?  echo fn_number_format((($tot_cm_cost_mkt-$tot_cm_cost_actual)/$tot_cm_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_30','<? echo $bgcolor1; ?>')" id="trtd_30">
							<td align="center">30</td>
							<td>Interest</td>
							<td align="right"><? echo fn_number_format($tot_interest_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_interest_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_interest_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_interest_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_interest_cost_mkt-$tot_interest_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_interest_cost_mkt-$tot_interest_cost_actual)/$tot_interest_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_31','<? echo $bgcolor1; ?>')" id="trtd_31">
							<td align="center">31</td>
							<td>Income Tax</td>
							<td align="right"><? echo fn_number_format($tot_incometax_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_incometax_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_incometax_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_incometax_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_incometax_cost_mkt-$tot_incometax_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_incometax_cost_mkt-$tot_incometax_cost_actual)/$tot_incometax_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
							<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_31','<? echo $bgcolor1; ?>')" id="trtd_31">
							<td align="center">32</td>
							<td>Depc. & Amort.</td>
							<td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_depr_amor_pre_cost_mkt/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_actual,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_depr_amor_pre_cost_actual/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_depr_amor_pre_cost_mkt-$tot_depr_amor_pre_cost_actual,2); ?></td>
								<td align="right" title="Variance/Certificate Mkt*100"><?  echo fn_number_format((($tot_depr_amor_pre_cost_mkt-$tot_depr_amor_pre_cost_actual)/$tot_depr_amor_pre_cost_mkt)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor1; ?>" onClick="change_color('trtd_33','<? echo $bgcolor1; ?>')" id="trtd_33">
							<td align="center">33</td>
							<td>Total Cost</td>
							<td align="right"><? echo fn_number_format($tot_mkt_all_cost,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_mkt_all_cost/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_actual_all_cost,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_actual_all_cost/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_mkt_all_cost-$tot_actual_all_cost,2); ?></td>
							<td align="right" title="Variance/Total Cost Mkt*100"><?  echo fn_number_format((($tot_mkt_all_cost-$tot_actual_all_cost)/$tot_mkt_all_cost)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_34,'<? echo $bgcolor2; ?>')" id="trtd_34">
							<td align="center">34</td>
							<td>Margin/Loss</td>
							<td align="right"><? echo fn_number_format($tot_mkt_margin,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_actual_margin,2); ?></td>
							<td align="right"><? echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
							<td align="right" title="Variance/Margin/Loss Mkt*100"><?  echo fn_number_format((($tot_mkt_margin-$tot_actual_margin)/$tot_mkt_margin)*100,2); ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_35','<? echo $bgcolor2; ?>')" id="trtd_35">
							<td align="center">35</td>
							<td>CPA/Short Fabric Cost</td>
							<td align="right"><? //echo fn_number_format($tot_mkt_margin,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_yarn_qty_cpa_actual,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
							<td align="right"><?  echo ' '; ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
						<tr bgcolor="<? echo $bgcolor2; ?>" onClick="change_color('trtd_36','<? echo $bgcolor2; ?>')" id="trtd_36">
							<td align="center">36</td>
							<td>Net Margin/Loss(=34-35)</td>
							<td align="right"><? //echo fn_number_format($tot_mkt_margin,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_mkt_margin/$tot_po_value)*100,2); ?></td>
							<td align="right"><? echo fn_number_format($tot_actual_margin-$tot_yarn_qty_cpa_actual,2); ?></td>
							<td align="right"><? //echo fn_number_format(($tot_actual_margin/$tot_ex_factory_val)*100,2); ?></td>
							<td align="right"><? //echo fn_number_format($tot_mkt_margin-$tot_actual_margin,2); ?></td>
								<td align="right"><?  echo ' ';  ?></td>
								<td align="right"><? //echo fn_number_format($tot_ex_factory_val-$tot_po_value,2); ?></td>
						</tr>
					</table>
				</div>
			</td>
			<td width="525" align="center" valign="top" style="display:none">
				<div align="center" style="width:500px; height:53px" id="graph">&nbsp;</div>
				<fieldset style="text-align:center; width:450px" > 
					<legend>Chart</legend>
				</fieldset>
			</td>   
			<td width="" valign="top">
				<div align="center" style="width:600px" id="div_buyer"><input type="button" value="Print Preview" class="formbutton" onClick="new_window2('company_div_b','summary_buyer')" /></div>
				<br />
				<div id="summary_buyer">
					<div align="center" id="company_div_b" style="visibility:hidden; font-size:24px;width:2305px"><b><? echo $company_arr[$company_name].'<br>';echo change_date_format(str_replace("'","",$txt_date_from)) .' To '. change_date_format(str_replace("'","",$txt_date_to)); ?></b></div>
					<table width="100%" cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all">
						<thead>
								<tr>
								<th colspan="38">Buyer Level Summary</th>
							</tr>
							<tr>
								<th width="35">SL</th>
								<th width="70">Buyer name</th>
								<th width="110">Cost Source</th>
								<th width="110">Ex-Factory Value</th>
								
								<th width="100">Yarn Value Addition Cost</th>
								<th width="110">Grey Yarn cost</th>
								<th width="110">Knitting Cost</th>
								<th width="100">Grey Fabric Transfer Cost</th>
								
								<th width="110">Grey Fabric Purchase Cost</th>
								<th width="100">Grey Fabric Cost</th>
								<th width="110">Dye & Fin Cost</th>
								<th width="110">AOP</th>
								<th width="100">Fin. Fab. Transfer Cost</th>
								<th width="100">Fin. Fabric Purchase Cost</th>
								<th width="100">Fin. Fabric Cost</th>
								<th width="110">Trims Cost</th>
								<th width="100">Printing Cost</th>
								<th width="100">Embroidery Cost</th>
								<th width="100">Dyeing  Cost</th>
								
								<th width="100">Washing  Cost</th>
									
								
								<th width="110">Commission Cost</th>
								<th width="100">Commercial Cost</th>
								<th width="110">Freight Cost</th>
								<th width="100">Testing Cost</th>
								<th width="100">Inspection Cost</th>
								<th width="100">Courier Cost</th>								
								<th width="100">Certificate Cost</th>
								<th width="100">Deffd. LC Cost</th>
								<th width="100">Design Cost</th>
								<th width="100">Studio Cost</th>
								<th width="100">Opert. Exp.</th>									
								<th width="110">CM Cost</th>								
								<th width="100">Interest</th>
								<th width="100">Income Tax</th>
								<th width="100">Depc. & Amort.</th>							
								<th width="110">Total Cost</th>
								<th width="110">Margin</th>
								<th width="90">Margin %</th>
							</tr>
						</thead>
						<?
							$j=1;$tot_fin_fab_transfer_amt_actual=$tot_mkt_print_cost=$tot_mkt_embro_cost=$tot_mkt_dyeing_cost=$tot_mkt_wash_cost=$tot_mkt_value_addition_cost=0;
							foreach($buyer_name_array as $key=>$value)
							{
								if ($j%2==0)  
									$bgcolor="#E9F3FF";
								else
									$bgcolor="#FFFFFF";	
							?>
								<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD_<? echo $j; ?>">
									<td rowspan="4"><? echo $j ;?></td>
									<td rowspan="4"><? echo $value ;?></td>
									<td><b>Pre Costing</b></td>
									<td align="right"><? echo fn_number_format($mkt_po_val_array[$key],2); $tot_mkt_po_val+=$mkt_po_val_array[$key];  ?></td>									
									<td align="right"><? echo fn_number_format($mkt_yarn_value_addition_array[$key],2); $tot_mkt_value_addition_cost+=$mkt_yarn_value_addition_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_yarn_array[$key],2); $tot_mkt_yarn_cost+=$mkt_yarn_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_knit_array[$key],2); $tot_mkt_knit_cost+=$mkt_knit_array[$key]; ?></td>
									<td align="right"><? //echo fn_number_format($mkt_yarn_array[$key],2); $tot_mkt_yarn_cost+=$mkt_yarn_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_fabric_purchase_array[$key],2); $tot_mkt_fin_pur_cost+=$mkt_fabric_purchase_array[$key];?></td>
									<td align="right"><? echo fn_number_format($mkt_grey_fab_cost_array[$key],2); $tot_mkt_grey_fab_cost+=$mkt_grey_fab_cost_array[$key];?></td>
									<td align="right"><? echo fn_number_format($mkt_dy_fin_array[$key],2); $tot_mkt_dy_fin_cost+=$mkt_dy_fin_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_aop_array[$key],2); $tot_mkt_aop_cost+=$mkt_aop_array[$key]; ?></td>
									<td align="right"><? //echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2);$tot_mkt_fin_fabric_purchase+=$mkt_fin_fabric_purchase_array[$key]; ?></td>
									<td align="right"><?  echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2);$tot_mkt_fin_fabric_purchase+=$mkt_fin_fabric_purchase_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_fin_fabric_purchase_array[$key],2); ?></td>
									<td align="right"><? echo fn_number_format($mkt_trims_array[$key],2); $tot_mkt_trims_cost+=$mkt_trims_array[$key]; ?></td>										
									<td align="right"><? echo fn_number_format($mkt_print_array[$key],2); $tot_mkt_print_cost+=$mkt_print_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_embro_array[$key],2); $tot_mkt_embro_cost+=$mkt_embro_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_dyeing_array[$key],2); $tot_mkt_dyeing_cost+=$mkt_dyeing_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_wash_array[$key],2); $tot_mkt_wash_cost+=$mkt_wash_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_commn_array[$key],2); $tot_mkt_commn_cost+=$mkt_commn_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_commercial_array[$key],2); $tot_mkt_commercial_cost+=$mkt_commercial_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_freight_array[$key],2); $tot_mkt_freight_cost+=$mkt_freight_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_test_array[$key],2); $tot_mkt_test_cost+=$mkt_test_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_ins_array[$key],2); $tot_mkt_ins_cost+=$mkt_ins_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_courier_array[$key],2); $tot_mkt_courier_cost+=$mkt_courier_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_certificate_array[$key],2); $tot_mkt_certificate_cost+=$mkt_certificate_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_deffdlc_array[$key],2); $tot_mkt_deffdlc_cost+=$mkt_deffdlc_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_design_array[$key],2); $tot_mkt_design_cost+=$mkt_design_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_studio_array[$key],2); $tot_mkt_studio_cost+=$mkt_studio_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_operating_array[$key],2); $tot_mkt_operating_cost+=$mkt_operating_array[$key]; ?></td>									
									<td align="right"><? echo fn_number_format($mkt_cm_array[$key],2); $tot_mkt_cm_cost+=$mkt_cm_array[$key]; ?></td>								
									<td align="right"><? echo fn_number_format($mkt_interest_array[$key],2); $tot_mkt_interest_cost+=$mkt_interest_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_incometax_array[$key],2); $tot_mkt_incometax_cost+=$mkt_incometax_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_depr_amor_array[$key],2); $tot_mkt_depr_amor_cost+=$mkt_depr_amor_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($mkt_total_array[$key],2); $tot_mkt_total_cost+=$mkt_total_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($mkt_margin_array[$key],2); $tot_mkt_margin_cost+=$mkt_margin_array[$key]; ?></td>
									<td align="right"><? $mkt_margin_perc=($mkt_margin_array[$key]/$mkt_po_val_array[$key])*100; echo fn_number_format($mkt_margin_perc,2); $tot_mkt_margin_perc_cost+=$mkt_margin_perc; ?></td> 
								</tr>
								<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD2_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD2_<? echo $j; ?>">
									<td><b>Actual</b></td>
									<td align="right"><? echo fn_number_format($ex_factory_val_array[$key],2); $tot_buyer_ex_factory_val+=$ex_factory_val_array[$key];  ?></td>
									
									<td align="right"><? echo fn_number_format($yarn_dyeing_twist_array[$key],2); $tot_yarn_dyeing_twist_cost+=$yarn_dyeing_twist_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($yarn_cost_array[$key],2); $tot_buyer_yarn_cost+=$yarn_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($knit_cost_array[$key],2); $tot_buyer_knit_cost+=$knit_cost_array[$key]; ?></td>
									<td align="right"><? 
										
										echo fn_number_format($grey_transfer_amnt_array[$key],2); 
										$tot_grey_transfer_cost+=$grey_transfer_amnt_array[$key]; 
										//echo fn_number_format($grey_fab_cost_array[$key],2); 
										//$tot_grey_fab_cost+=$grey_fab_cost_array[$key]; 

										?>
											
									</td>
									
									<td align="right"><? echo fn_number_format($actual_grey_fabric_purchase_array[$key],2); $tot_buyer_grey_fabric_pur_act_cost+=$actual_grey_fabric_purchase_array[$key]; ?></td>
									<td align="right" title="Grey Feb Cost"><? echo fn_number_format($grey_fab_cost_array[$key],2); $tot_grey_fab_cost_act+=$grey_fab_cost_array[$key];?></td>
									<td align="right"><? echo fn_number_format($dye_cost_array[$key],2); $tot_buyer_dye_cost+=$dye_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($aop_n_others_cost_array[$key],2); $tot_buyer_aop_n_others_cost+=$aop_n_others_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($fin_fab_transfer_amt_actual_array[$key],2); $tot_fin_fab_transfer_amt_actual+=$fin_fab_transfer_amt_actual_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($actual_fabric_purchase_array[$key],2); $tot_act_fin_fabric_purchase_cost+=$actual_fabric_purchase_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($finished_fab_cost_actual_array[$key],2); $tot_finished_fab_cost_actual_buy+=$finished_fab_cost_actual_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($trims_cost_array[$key],2); $tot_buyer_trims_cost+=$trims_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($print_act_cost_array[$key],2); $tot_act_print_cost+=$print_act_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($embro_act_cost_array[$key],2); $tot_act_embro_cost+=$embro_act_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($dyeing_act_cost_array[$key],2); $tot_act_dyeing_cost+=$dyeing_act_cost_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($wash_act_cost_array[$key],2); $tot_act_wash_cost+=$wash_act_cost_array[$key]; ?></td>
										
									
									<td align="right"><? echo fn_number_format($commission_cost_array[$key],2); $tot_buyer_commi_cost+=$commission_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($commercial_cost_array[$key],2); $tot_buyer_commercial_cost+=$commercial_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($freight_cost_array[$key],2); $tot_buyer_freight_cost+=$freight_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($testing_cost_array[$key],2); $tot_buyer_testing_cost+=$testing_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($inspection_cost_array[$key],2); $tot_buyer_inspection_cost+=$inspection_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($courier_cost_array[$key],2); $tot_buyer_courier_cost+=$courier_cost_array[$key]; ?></td>
									
										<td align="right"><? echo fn_number_format($acl_certificate_array[$key],2); $tot_acl_certificate_cost+=$acl_certificate_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_deffdlc_array[$key],2); $tot_acl_deffdlc_cost+=$acl_deffdlc_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_design_array[$key],2); $tot_acl_design_cost+=$acl_design_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_studio_array[$key],2); $tot_acl_studio_cost+=$acl_studio_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_operating_array[$key],2); $tot_acl_operating_cost+=$acl_operating_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($cm_cost_array[$key],2); $tot_buyer_cm_cost+=$cm_cost_array[$key]; ?></td>
									
									<td align="right"><? echo fn_number_format($acl_interest_array[$key],2); $tot_acl_interest_cost+=$acl_interest_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_incometax_array[$key],2); $tot_acl_incometax_cost+=$acl_incometax_array[$key]; ?></td>
										<td align="right"><? echo fn_number_format($acl_depr_amor_array[$key],2); $tot_acl_depr_amor_cost+=$acl_depr_amor_array[$key]; ?></td>
										
									<td align="right"><? echo fn_number_format($total_cost_array[$key],2); $tot_buyer_total_cost+=$total_cost_array[$key]; ?></td>
									<td align="right"><? echo fn_number_format($margin_array[$key],2); $tot_buyer_margin_cost+=$margin_array[$key]; ?></td>
									<td align="right"><? $margin_perc=($margin_array[$key]/$ex_factory_val_array[$key])*100; echo fn_number_format($margin_perc,2); $tot_buyer_margin_perc_cost+=$margin_perc; ?></td> 
								</tr>
								<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD3_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD3_<? echo $j; ?>">
									<td><b>Variance</b></td>
									<td align="right">
									<?
										$ex_var= $mkt_po_val_array[$key]-$ex_factory_val_array[$key];
										echo fn_number_format($ex_var,2); 
									?>
									</td>
										
										<td align="right">
									<?
										$yarn_value_addition_var= $mkt_yarn_value_addition_array[$key]-$yarn_dyeing_twist_array[$key];
										echo fn_number_format($yarn_value_addition_var,2);
									?>
									</td>
									
									<td align="right">
									<?
										$yarn_var= $mkt_yarn_array[$key]-$yarn_cost_array[$key];
										echo fn_number_format($yarn_var,2);
									?>
									</td>
									<td align="right">
									<?
										$knit_var= $mkt_knit_array[$key]-$knit_cost_array[$key];
										echo fn_number_format($knit_var,2); 
									?>
									</td>
									<td align="right"></td>
									
									<td align="right">
									<?
										$fin_pur_var= $mkt_fabric_purchase_array[$key]-$actual_grey_fabric_purchase_array[$key];
										echo fn_number_format($fin_pur_var,2); 
									?>
									</td>
									<td align="right" title="grey Feb Cost"><? 
									$grey_feb_var=$mkt_grey_fab_cost_array[$key]-$grey_fab_cost_array[$key];echo fn_number_format($grey_feb_var,2);?></td>
									<td align="right">
									<?
										$dy_var= $mkt_dy_fin_array[$key]-$dye_cost_array[$key];
										echo fn_number_format($dy_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$aop_var= $mkt_aop_array[$key]-$aop_n_others_cost_array[$key];
										echo fn_number_format($aop_var,2); 
									?>
									</td>
									<td align="right"></td>
									<td align="right">
									<?
										$fin_feb_pur_var=$mkt_fin_fabric_purchase_array[$key]-$tot_act_fin_fabric_purchase_cost[$key];
										echo fn_number_format($fin_feb_pur_var,2); 
									?>
									</td>
									<td align="right">
									
									<?
										$totfin_fab_var= $mkt_fin_fabric_purchase_array[$key]-$finished_fab_cost_actual_array[$key];
										echo fn_number_format($totfin_fab_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$trims_var= $mkt_trims_array[$key]-$trims_cost_array[$key];
										echo fn_number_format($trims_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$print_var= $mkt_print_array[$key]-$print_act_cost_array[$key];
										echo fn_number_format($print_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$embro_var= $mkt_embro_array[$key]-$embro_act_cost_array[$key];
										
										echo fn_number_format($embro_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$dyeing_var= $mkt_dyeing_array[$key]-$dyeing_act_cost_array[$key];
										echo fn_number_format($dyeing_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$wash_var= $mkt_wash_array[$key]-$wash_act_cost_array[$key];
										echo fn_number_format($wash_var,2); 
									?>
									</td>
									
									
									<td align="right">
									<?
										$com_var= $mkt_commn_array[$key]-$commission_cost_array[$key];
										echo fn_number_format($com_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$commer_var= $mkt_commercial_array[$key]-$commercial_cost_array[$key];
										echo fn_number_format($commer_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$fr_var= $mkt_freight_array[$key]-$freight_cost_array[$key];
										echo fn_number_format($fr_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$test_var= $mkt_test_array[$key]-$testing_cost_array[$key];
										echo fn_number_format($test_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$ins_var= $mkt_ins_array[$key]-$inspection_cost_array[$key];
										echo fn_number_format($ins_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$cour_var= $mkt_courier_array[$key]-$courier_cost_array[$key];
										echo fn_number_format($cour_var,2); 
									?>
									</td>
									
									<td align="right"></td>
									<td align="right"></td>
									<td align="right"></td>
									<td align="right"></td>
									<td align="right"></td>									
									<td align="right">
									<?
										$cm_var= $mkt_cm_array[$key]-$cm_cost_array[$key];
										echo fn_number_format($cm_var,2); 
									?>
									</td>
									<td align="right" title="Interest"></td>
									<td align="right"></td>
									<td align="right"></td>									
									<td align="right">
									<?
										$tot_var= $mkt_total_array[$key]-$total_cost_array[$key];
										echo fn_number_format($tot_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$mar_var= $mkt_margin_array[$key]-$margin_array[$key];
										echo fn_number_format($mar_var,2); 
									?>
									</td>
									<td align="right">
									<?
										$margin_perc_to= $mkt_margin_perc-$margin_perc;
										echo fn_number_format($margin_perc_to,2); 
									?>
									</td>
								</tr>
								<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('trTD4_<? echo $j; ?>','<? echo $bgcolor; ?>')" id="trTD4_<? echo $j; ?>">
									<td><b>Variance (%)</b></td>
									<td align="right"><? echo fn_number_format(($ex_var/$mkt_po_val_array[$key]*100),2); ?></td>
									
										<td align="right"><? echo fn_number_format(($yarn_value_addition_var/$mkt_yarn_value_addition_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($yarn_var/$mkt_yarn_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($knit_var/$mkt_knit_array[$key]*100),2); ?></td>
									<td align="right"><? //echo fn_number_format(($ex_var/$mkt_po_val_array[$key]*100),2); ?></td>
									
									<td align="right"><? echo fn_number_format(($fin_pur_var/$mkt_fabric_purchase_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($grey_feb_var/$mkt_grey_fab_cost_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($dy_var/$mkt_dy_fin_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($aop_var/$mkt_aop_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($fin_fab_pur_var/$mkt_fin_fabric_purchase_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($fin_feb_pur_var/$mkt_fin_fabric_purchase_array[$key][$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($totfin_fab_var/$mkt_fin_fabric_purchase_array[$key]*100),2); ?></td> 
									<td align="right"><? echo fn_number_format(($trims_var/$mkt_trims_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($print_var/$mkt_print_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($embro_var/$mkt_embro_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($dyeing_var/$mkt_dyeing_array[$key]*100),2); ?></td>
										<td align="right"><? echo fn_number_format(($wash_var/$mkt_wash_array[$key]*100),2); ?></td>
									
									<td align="right"><? echo fn_number_format(($com_var/$mkt_commn_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($commer_var/$mkt_commercial_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($fr_var/$mkt_freight_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($test_var/$mkt_test_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($ins_var/$mkt_ins_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
									
									<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
									
									
									<td align="right"><? echo fn_number_format(($cm_var/$mkt_cm_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										<td align="right"><? //echo fn_number_format(($cour_var/$mkt_courier_array[$key]*100),2); ?></td>
										
									<td align="right"><? echo fn_number_format(($tot_var/$mkt_total_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($mar_var/$mkt_margin_array[$key]*100),2); ?></td>
									<td align="right"><? echo fn_number_format(($margin_perc_to/$mkt_margin_perc*100),2); ?></td> 
								</tr>
						<?
							$j++;
							}
							
							$bgcolor5='#CCDDEE';
							$bgcolor6='#CCCCFF';
							$bgcolor7='#FFEEFF';
						?>
						<tr bgcolor="<? echo $bgcolor5; ?>" onClick="change_color('trTD5_<? echo $j; ?>','<? echo $bgcolor5; ?>')" id="trTD5_<? echo $j; ?>">
							<th colspan="3">Pre Costing</th>
							<th align="right"><? echo fn_number_format($tot_mkt_po_val,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_mkt_value_addition_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_yarn_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_knit_cost,2); ?></th>
								<th align="right"><? //echo fn_number_format($tot_mkt_po_val,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_mkt_fin_pur_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_grey_fab_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_dy_fin_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_aop_cost,2); ?></th>
							<th align="right"><? //echo fn_number_format($tot_mkt_aop_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_fin_fabric_purchase,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_fin_fabric_purchase,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_trims_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_print_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_embro_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_dyeing_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_wash_cost,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_mkt_commn_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_commercial_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_freight_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_test_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_ins_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_courier_cost,2); ?></th>
							
								<th align="right"><? echo fn_number_format($tot_mkt_certificate_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_deffdlc_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_design_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_studio_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_operating_cost,2); ?></th>
								
								
							<th align="right"><? echo fn_number_format($tot_mkt_cm_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_interest_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_incometax_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_mkt_depr_amor_cost,2); ?></th>
								
							<th align="right"><? echo fn_number_format($tot_mkt_total_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_mkt_margin_cost,2); ?></th>
							<th align="right"><? $mm=$tot_mkt_margin_cost/$tot_mkt_po_val*100; echo fn_number_format($mm,2); ?></th>   
						</tr>
						<tr bgcolor="<? echo $bgcolor6; ?>" onClick="change_color('trTD6_<? echo $j; ?>','<? echo $bgcolor6; ?>')" id="trTD6_<? echo $j; ?>">
							<th colspan="3">Actual</th>
							<th align="right"><? echo fn_number_format($tot_buyer_ex_factory_val,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_yarn_dyeing_twist_actual,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_yarn_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_knit_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_grey_transfer_cost,2); //echo fn_number_format($tot_grey_fab_cost,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_buyer_grey_fabric_pur_act_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_grey_fab_cost_act,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_dye_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_aop_n_others_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_fin_fab_transfer_amt_actual,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_act_fin_fabric_purchase_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_finished_fab_cost_actual_buy,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_trims_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_act_print_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_act_embro_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_act_dyeing_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_act_wash_cost,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_buyer_commi_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_commercial_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_freight_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_testing_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_inspection_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_courier_cost,2); ?></th>
							
								<th align="right"><? echo fn_number_format($tot_acl_certificate_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_deffdlc_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_design_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_studio_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_operating_cost,2); ?></th>
								
								
							<th align="right"><? echo fn_number_format($tot_buyer_cm_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_interest_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_incometax_cost,2); ?></th>
								<th align="right"><? echo fn_number_format($tot_acl_depr_amor_cost,2); ?></th>
							
							<th align="right"><? echo fn_number_format($tot_buyer_total_cost,2); ?></th>
							<th align="right"><? echo fn_number_format($tot_buyer_margin_cost,2); ?></th>
							<th align="right"><? $pp=$tot_buyer_margin_cost/$tot_buyer_ex_factory_val*100; echo fn_number_format($pp,2); ?></th>   
						</tr>
						<tr bgcolor="<? echo $bgcolor7; ?>" onClick="change_color('trTD7_<? echo $j; ?>','<? echo $bgcolor7; ?>')" id="trTD7_<? echo $j; ?>">
							<th colspan="3">Variance</th>
							<th align="right"><? $evar=$tot_mkt_po_val-$tot_buyer_ex_factory_val;  echo fn_number_format($evar,2); ?></th>
							<th align="right"><? $yarn_value_var=$tot_mkt_value_addition_cost-$tot_yarn_dyeing_twist_actual;  echo fn_number_format($yarn_value_var,2); ?></th>
							<th align="right"><? $grey_yvar=$tot_mkt_yarn_cost-$tot_buyer_yarn_cost;  echo fn_number_format($grey_yvar,2); ?></th>
							<th align="right"><? $knit_var=$tot_mkt_knit_cost-$tot_buyer_knit_cost;  echo fn_number_format($knit_var,2); ?></th>
							<th align="right"><? echo " ";//$kvar=$tot_mkt_knit_cost-$tot_buyer_knit_cost;  echo fn_number_format($kvar,2); ?></th>
							
							<th align="right"><? $fpfvar=$tot_mkt_fin_pur_cost-$tot_buyer_grey_fabric_pur_act_cost;  echo fn_number_format($fpfvar,2); ?></th>
								<th align="right"><? $greypfvar=$tot_mkt_grey_fab_cost-$tot_grey_fab_cost_act;  echo fn_number_format($greypfvar,2); ?></th>
								<th align="right"><? $dfvar=$tot_mkt_dy_fin_cost-$tot_buyer_dye_cost;  echo fn_number_format($dfvar,2); ?></th>
							<th align="right"><? $aopvar=$tot_mkt_aop_cost-$tot_buyer_aop_n_others_cost;  echo fn_number_format($aopvar,2); ?></th>
							<th align="right"><? echo " ";//$aopvar=$tot_mkt_aop_cost-$tot_buyer_aop_n_others_cost;  echo fn_number_format($aopvar,2); ?></th>
							<th align="right"><? //$fin_fab_var=$tot_mkt_fin_fabric_purchase-$tot_finished_fab_cost_actual_buy;  echo fn_number_format($fin_fab_var,2); ?></th>
								<th align="right"><? $fin_fab_var=$tot_mkt_fin_fabric_purchase-$tot_finished_fab_cost_actual_buy;  echo fn_number_format($fin_fab_var,2);; ?></th>
							<th align="right"><? $trimvar=$tot_mkt_trims_cost-$tot_buyer_trims_cost;  echo fn_number_format($trimvar,2); ?></th>
								<th align="right"><? $printvar=$tot_mkt_print_cost-$tot_act_print_cost;  echo fn_number_format($printvar,2); ?></th>
								<th align="right"><? $embrovar=$tot_mkt_embro_cost-$tot_act_embro_cost;  echo fn_number_format($embrovar,2); ?></th>
							<th align="right"><? $dyeingvar=$tot_mkt_dyeing_cost-$tot_act_dyeing_cost;  echo fn_number_format($dyeingvar,2); ?></th>
							<th align="right"><? $washingvar=$tot_mkt_wash_cost-$tot_act_wash_cost;  echo fn_number_format($washingvar,2); ?></th>
							
							<th align="right"><? $comvar=$tot_mkt_commn_cost-$tot_buyer_commi_cost;  echo fn_number_format($comvar,2); ?></th>
							<th align="right"><? $commercialvar=$tot_mkt_commercial_cost-$tot_buyer_commercial_cost;  echo fn_number_format($commercialvar,2); ?></th>
							<th align="right"><? $fvar=$tot_mkt_freight_cost-$tot_buyer_freight_cost;  echo fn_number_format($fvar,2); ?></th>
							<th align="right"><? $tvar=$tot_mkt_test_cost-$tot_buyer_testing_cost;  echo fn_number_format($tvar,2); ?></th>
							<th align="right"><? $ivar=$tot_mkt_ins_cost-$tot_buyer_inspection_cost;  echo fn_number_format($ivar,2); ?></th>
							<th align="right"><? $courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							
								
							
							<th align="right"><? $cmvar=$tot_mkt_cm_cost-$tot_buyer_cm_cost;  echo fn_number_format($cmvar,2); ?></th>
								<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							<th align="right"><? //$courvar=$tot_mkt_courier_cost-$tot_buyer_courier_cost;  echo fn_number_format($courvar,2); ?></th>
							
							<th align="right"><? $totvar=$tot_mkt_total_cost-$tot_buyer_total_cost;  echo fn_number_format($totvar,2); ?></th>
							<th align="right"><? $mvar=$tot_mkt_margin_cost-$tot_buyer_margin_cost;  echo fn_number_format($mvar,2); ?></th>
							<th align="right"><? $mpvar=$mm-$pp;  echo fn_number_format($mpvar,2); ?></th>   
						</tr>
						<tr bgcolor="<? echo $bgcolor6; ?>" onClick="change_color('trTD8_<? echo $j; ?>','<? echo $bgcolor6; ?>')" id="trTD8_<? echo $j; ?>">
							<th colspan="3">Variance (%)</th>
							<th align="right"><? echo fn_number_format(($evar/$tot_mkt_po_val*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($yarn_value_var/$tot_mkt_value_addition_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($grey_yvar/$tot_mkt_yarn_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($knit_var/$tot_mkt_yarn_cost*100),2); ?></th>
							<th align="right"><? echo " ";//echo fn_number_format(($kvar/$tot_mkt_knit_cost*100),2); ?></th>
							
							<th align="right"><? echo fn_number_format(($fpfvar/$tot_mkt_fin_pur_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($greypfvar/$tot_mkt_grey_fab_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($dfvar/$tot_mkt_dy_fin_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($aopvar/$tot_mkt_aop_cost*100),2); ?></th>
							<th align="right"><? echo " ";//echo fn_number_format(($aopvar/$tot_mkt_aop_cost*100),2); ?></th>
							<th align="right"><?  echo fn_number_format(($fin_fab_var/$tot_mkt_fin_fabric_purchase*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($trimvar/$tot_mkt_trims_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($printvar/$tot_mkt_trims_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($embrovar/$tot_mkt_embro_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($dyeingvar/$tot_mkt_dyeing_cost*100),2); ?></th>
								<th align="right"><? echo fn_number_format(($washingvar/$tot_mkt_wash_cost*100),2); ?></th> 
								<th align="right"><? echo fn_number_format(($washingvar/$tot_mkt_wash_cost*100),2); ?></th> 
							
							<th align="right"><? echo fn_number_format(($comvar/$tot_mkt_commn_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($commercialvar/$tot_mkt_commercial_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($fvar/$tot_mkt_freight_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($tvar/$tot_mkt_test_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($ivar/$tot_mkt_ins_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
								
							<th align="right"><? echo fn_number_format(($cmvar/$tot_mkt_cm_cost*100),2); ?></th>
								<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? // echo fn_number_format(($courvar/$tot_mkt_courier_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($totvar/$tot_mkt_total_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($mvar/$tot_mkt_margin_cost*100),2); ?></th>
							<th align="right"><? echo fn_number_format(($mpvar/$mm*100),2); ?></th>   
						</tr>
					</table>
				</div>
			</td>
		</tr>
	</table>
	</fieldset>
 <?
	execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_name." and ref_from in (1,2,3,4,5,6) and ENTRY_FORM=123");
	oci_commit($con);
	disconnect($con);
	foreach (glob("../../../../ext_resource/tmp_report/$user_name*.xls") as $filename) 
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$html=ob_get_contents();
	$name=time();
	$filename="../../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,$html);
	$filename="../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	echo "$total_data****$filename****$report_type";
	exit();
}

if($action=="yarn_cost_actual3")
{
	echo load_html_head_contents("Yarn Cost Info","../../../../", 1, 1, '','','');
	extract($_REQUEST);
	
	$supplier_array=return_library_array( "select id, short_name from lib_supplier", "id", "short_name"  );
	
	$sql_wo_fab="select a.id,a.item_category,a.booking_no,a.booking_type,a.is_short,b.job_no,b.po_break_down_id as po_id from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no  and a.item_category in(2,3) and a.booking_type in(1,3,4)  and a.is_deleted=0 and a.status_active=1 and b.status_active=1 and b.is_deleted=0  and b.po_break_down_id in($po_id)";
	$result_fab_result=sql_select( $sql_wo_fab );
	foreach ($result_fab_result as $row)
	{
			$booking_array[$row[csf('booking_no')]]['btype']=$row[csf('booking_type')];
			$booking_array[$row[csf('booking_no')]]['is_short']=$row[csf('is_short')];
			$booking_type_arr[$row[csf('id')]]['btype']=$row[csf('booking_type')];
			$booking_type_arr[$row[csf('id')]]['is_short']=$row[csf('is_short')];
			$job_no=$row[csf('job_no')];
	}
	unset($result_fab_result);
	?>
	<script>

		function print_window()
		{
			var w = window.open("Surprise", "#");
			var d = w.document.open();
			d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
		'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');
		
			d.close();
		}	
		
	</script>	
		<div style="width:980px" align="center"><input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/></div>
		<fieldset style="width:975px; margin-left:7px">
			<div id="report_container">
				<table class="rpt_table" width="975" cellpadding="0" cellspacing="0" border="1" rules="all">
					<thead>
						<th colspan="10"><b>Yarn Issue</b></th>
					</thead>
					<thead>
						<th width="40">SL</th>
						<th width="110">Issue Id</th>
						<th width="80">Issue Date</th>
						<th width="80">Purpose</th>
						<th width="80">Supplier</th>
						<th width="80">Lot</th>
						<th width="180">Yarn Description</th>
						<th width="90">Issue Qty.</th>
						<th width="80">Avg. Rate (USD)</th>
						<th>Cost ($)</th>
					</thead>
					<?
				$job_array=return_library_array( "select id,job_no_mst from wo_po_break_down where id in($po_id)", "id", "job_no_mst"  );
				$sql_yarn="select c.id,a.requisition_no,a.receive_basis,a.prod_id,(a.cons_amount) as cons_amount,c.issue_basis,c.issue_number,c.booking_no from inv_transaction a, order_wise_pro_details b, inv_issue_master c where  a.id=b.trans_id and  c.id=a.mst_id and c.entry_form in(3) and b.entry_form in(3)  and  a.transaction_type=2  and b.po_breakdown_id in($po_id)";
				$result_yarn=sql_select($sql_yarn);
				foreach($result_yarn as $invRow)
				{
					if($invRow[csf('issue_basis')]==1)// Booking
					{
						$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('booking_no')];
					}
					else if($invRow[csf('issue_basis')]==3)// Requesition
					{
						$yarn_booking_no_arr[$invRow[csf('id')]]=$invRow[csf('requisition_no')];
					}
				}
				
				unset($result_yarn);
				
				$yarn_dyeing_costArray=array();
				$yarndyeing_data="select b.booking_date,b.id,b.currency,b.is_short,b.ydw_no,a.job_no,a.yarn_color,a.product_id,avg(a.dyeing_charge) as dyeing_charge,  sum(a.amount) as amnt,sum(a.yarn_wo_qty) as yarn_wo_qty from wo_yarn_dyeing_mst b,wo_yarn_dyeing_dtls a where  b.id=a.mst_id and b.entry_form in(41,94) and a.status_active=1 and a.is_deleted=0 and a.job_no='$job_no'  group by b.id,b.currency,b.is_short,a.job_no,a.product_id,b.ydw_no,a.yarn_color,b.booking_date";
				$yarndyeing_dataResult=sql_select($yarndyeing_data);
				foreach($yarndyeing_dataResult as $yarnRow)
				{
					$yarn_dyeing_costArray[$yarnRow[csf('job_no')]]['avg_rate']=$yarnRow[csf('amnt')]/$yarnRow[csf('yarn_wo_qty')];
					$yarn_dyeing_isshort_arr[$yarnRow[csf('ydw_no')]]['is_short']=$yarnRow[csf('is_short')];
				}
					
				$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master where item_category_id=1", "id", "avg_rate_per_unit"  );
				$receive_array=array();
				$yarnIssueData="select b.prod_id,sum(a.cons_amount) as cons_amount,sum(a.cons_quantity) as cons_quantity
				from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1) and a.transaction_type in(2,4,5,6) and b.entry_form ='3' and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25)   and b.po_breakdown_id in($po_id) group by  b.prod_id";
				$resultyarnIssueData = sql_select($yarnIssueData);
				$all_prod_ids="";
				foreach($resultyarnIssueData as $row)
				{
					if($all_prod_ids=="") $all_prod_ids=$row[csf('prod_id')];else $all_prod_ids.=",".$row[csf('prod_id')];
					
					$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt']+=$row[csf('cons_amount')];
					$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty']+=$row[csf('cons_quantity')];
				}
				unset($resultyarnIssueData);
				$prodIds=chop($all_prod_ids,',');
				$prod_cond_for_in="";
				$prod_ids=count(array_unique(explode(",",$all_prod_ids)));
				if($db_type==2 && $prod_ids>1000)
				{
					$prod_cond_for_in=" and (";
					$prodIdsArr=array_chunk(explode(",",$prodIds),999);
					foreach($prodIdsArr as $ids)
					{
						$ids=implode(",",$ids);
						$prod_cond_for_in.=" a.prod_id in($ids) or"; 
					}
					$prod_cond_for_in=chop($prod_cond_for_in,'or ');
					$prod_cond_for_in.=")";
				}
				else
				{
					$prodIds=implode(",",array_unique(explode(",",$all_prod_ids)));
					$prod_cond_for_in=" and a.prod_id in($prodIds)";
				}
				
				if($prodIds!='' || $prodIds!=0)
				{
					$prod_cond_for_in=$prod_cond_for_in;
				}
				else
				{
					$prod_cond_for_in="and a.prod_id in(0)";
				}
				
				$sql_receive_for_issue="select c.booking_id,a.job_no,a.prod_id,max(a.transaction_date) as transaction_date,c.currency_id,c.receive_purpose,c.exchange_rate,b.lot,b.color, sum(a.order_qnty) as qty, sum(a.order_amount) as amnt, sum(CASE WHEN c.receive_purpose in(2,15,38)   THEN a.order_amount ELSE 0 END) AS order_amount_recv from inv_transaction a,product_details_master b,inv_receive_master c where a.prod_id=b.id and c.id=a.mst_id and c.entry_form=1 and c.item_category=1 and a.transaction_type=1 and a.item_category=1 and a.status_active=1 and a.is_deleted=0 $prod_cond_for_in  group by c.booking_id,a.job_no,a.prod_id,c.currency_id,c.receive_purpose,c.exchange_rate,b.lot,b.color";
				$resultReceive_chek = sql_select($sql_receive_for_issue);
				
				foreach($resultReceive_chek as $row)
				{
					$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose']=$row[csf('receive_purpose')];
					$receive_date_array[$row[csf('prod_id')]]['exchange_rate']=$row[csf('exchange_rate')];
					$avg_rate=$row[csf('amnt')]/$row[csf('qty')];
					$receive_array[$row[csf('prod_id')]]=$avg_rate;
				}
				unset($resultReceive_chek);
				
				
				
					$plan_details_array = return_library_array("select dtls_id, booking_no as booking_no from ppl_planning_entry_plan_dtls where po_id in($po_id)  group by dtls_id,booking_no", "dtls_id", "booking_no");
					//print_r($plan_details_array);
					$reqs_array = array();
					$reqs_sql = sql_select("select knit_id, requisition_no as reqs_no, sum(yarn_qnty) as yarn_req_qnty from ppl_yarn_requisition_entry where status_active=1 and is_deleted=0 group by knit_id, requisition_no");
					foreach ($reqs_sql as $row)
					{
						//$reqs_array[$row[csf('knit_id')]]['reqs_no'] = $row[csf('reqs_no')];
						$reqs_array[$row[csf('reqs_no')]]['knit_id'] = $row[csf('knit_id')];
					}
					unset($reqs_sql);
					
					$i=1; $total_yarn_issue_qnty=0; $total_yarn_cost=0;
					$yarnTrimsData="SELECT a.mst_id, a.transaction_type, a.receive_basis, a.item_category, a.transaction_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity, b.returnable_qnty, c.lot, c.color from inv_transaction a, order_wise_pro_details b,product_details_master c where a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25) and b.po_breakdown_id in($po_id) ";
						
					
				$yarnTrimsDataArray=sql_select($yarnTrimsData); $yarnTrimsCostArray=array(); $i=0;
				$usd_id=2;$tot_iss_amnt=0;
				foreach($yarnTrimsDataArray as $invRow)
				{
					if($invRow[csf('item_category')]==1)
					{
						$yarn_issue_amt=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['amt'];
						$yarn_issue_qty=$yarn_issue_amt_arr[$invRow[csf('prod_id')]]['qty'];
						$last_exchange_rate=$receive_date_array[$invRow[csf('prod_id')]]['exchange_rate'];
					//	$receive_date_array[$row[csf('prod_id')]]['exchange_rate']
						
						if($invRow[csf('receive_basis')]==1)//Booking Basis
						{
							$booking_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
							if($invRow[csf('issue_purpose')]==2) //Yarn Dyeing purpose
							{
								$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
								$booking_type=1;
								//echo $booking_no.'= '.$booking_type.', ';
							}
							else
							{
								$booking_type=$booking_array[$booking_no]['btype'];
								$is_short=$booking_array[$booking_no]['is_short'];
								//echo $is_short.'= '.$booking_type.'A ';
							}
						}
						else if($invRow[csf('receive_basis')]==3) //Requisition Basis
						{
							$booking_req_no=$yarn_booking_no_arr[$invRow[csf('mst_id')]];
							
							$prog_no=$reqs_array[$booking_req_no]['knit_id'];
							$booking_no=$plan_details_array[$prog_no];
							//echo $prog_no.'req';
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
						$transaction_date='';
						$transaction_date=$last_trans_date;
						if($db_type==0) $conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
						else $conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
						
					//	$exchange_rate=set_conversion_rate($usd_id,$conversion_date );
						$exchange_rate=$last_exchange_rate;
						$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
						
						$avgrate=$issue_rate/$exchange_rate;
						$recv_purpose=$yarn_receive_arr[$invRow[csf('prod_id')]][$invRow[csf('lot')]][$invRow[csf('color')]]['purpose'];
						if($invRow[csf('entry_form')]==3 && $recv_purpose==16)//recv_purpose==16=Grey Yarn
						{
							//echo $is_short.'='.$booking_type.'='.$recv_purpose.'<br>';
							if(($booking_type==1 || $booking_type==4) && $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
							{
			
								if($invRow[csf('issue_purpose')]==1 || $invRow[csf('issue_purpose')]==2 || $invRow[csf('issue_purpose')]==4)//Knitting||Yarn Dyeing||Sample With Order
								{
									//echo $invRow[csf('mst_id')].'='.$invRow[csf('issue_purpose')].'='.$q.'='.$invRow[csf('quantity')].'-k<br>';
									
									$iss_amnt=$invRow[csf('quantity')]*$avgrate;
									$tot_iss_amnt+=$iss_amnt;
									
									$retble_iss_amnt=$invRow[csf('returnable_qnty')]*$avgrate;
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['grey_yarn_amt']+=$iss_amnt;
									$yarnTrimsCostArray[$invRow[csf('mst_id')]][$invRow[csf('prod_id')]]['yq']+=$invRow[csf('quantity')];
								}
							}
							
						}
					}
					
				}
			//	print_r($yarnTrimsCostArray);
				unset($yarnTrimsDataArray);
					$sql_isssue="select d.issue_number,d.issue_date,a.mst_id, a.transaction_type,a.item_category,a.requisition_no, a.receive_basis, a.item_category, a.transaction_date as issue_date, a.cons_rate, b.entry_form, b.po_breakdown_id, b.prod_id, b.issue_purpose, b.quantity as issue_qnty, b.returnable_qnty,c.supplier_id, c.lot, c.color,c.product_name_details from inv_transaction a, order_wise_pro_details b,product_details_master c,inv_issue_master d where a.mst_id=d.id and a.id=b.trans_id and c.id=b.prod_id and c.id=a.prod_id and a.item_category in(1,4) and a.transaction_type in(2,4,5,6) and d.status_active=1 and a.is_deleted=0  and a.status_active=1 and a.is_deleted=0and b.is_deleted=0 and b.status_active=1 and b.entry_form in(3,11,25) and b.issue_purpose in (1) and b.po_breakdown_id in($po_id) ";
					$result_issue=sql_select($sql_isssue);$usd_id=2;
					foreach($result_issue as $row)
					{
						if ($i%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF";	
						if($row[csf('item_category')]==1)
						{
						$issue_purpose=$row[csf('issue_purpose')];
						$issue_basis=$row[csf('issue_basis')];
						$item_category=$row[csf('item_category')];
						$yarn_issue_amt=$yarn_issue_amt_arr[$row[csf('prod_id')]]['amt'];
						$yarn_issue_qty=$yarn_issue_amt_arr[$row[csf('prod_id')]]['qty'];
						
						$issue_rate=$yarn_issue_amt/$yarn_issue_qty;
						
						$last_trans_date=$last_receive_date_array[$row[csf('prod_id')]]['last_date'];
						$is_short='';
						$yarn_cost=0;
						
						if($row[csf('receive_basis')]==1)//Booking Basis
						{
							$booking_no=$yarn_booking_no_arr[$row[csf('mst_id')]];
							if($row[csf('issue_purpose')]==2) //Yarn Dyeing purpose
							{
								$is_short=$yarn_dyeing_isshort_arr[$booking_no]['is_short'];
								$booking_type=1;
								//echo $is_short.'= '.$booking_type.', ';
							}
							else
							{
								$booking_type=$booking_array[$booking_no]['btype'];
								$is_short=$booking_array[$booking_no]['is_short'];
							}
						}
						else if($row[csf('receive_basis')]==3) //Requisition Basis
						{
							$booking_req_no=$yarn_booking_no_arr[$row[csf('mst_id')]];
							
							$prog_no=$reqs_array[$booking_req_no]['knit_id'];
							$booking_no=$plan_details_array[$prog_no];
							//echo $prog_no.'req';
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
						}
							
							//echo $booking_type.'='.$is_short;
							//if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='') //Main and Sample Faric Booking
							
						$yarn_issued=$row[csf('issue_qnty')]; 
						$issue_date=$row[csf('issue_date')];
						$issue_qty=$row[csf('issue_qnty')];
							//echo $row[csf('yarn_iss_return_qty')].'ff';
							$transaction_date=$last_trans_date;
							//$avg_rate='';
							if($db_type==0)
							{
								$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
							}
							else
							{
								$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
							}
							//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
							$currency_rate=$receive_date_array[$row[csf('prod_id')]]['exchange_rate'];
							$avg_rate=$issue_rate/$currency_rate;
							//echo $currency_rate.'dd'.$avg_rate;
							if(($booking_type==1 || $booking_type==4) && ($is_short==2 || $is_short==1 &&  $booking_type!='') ) //Main and Sample Faric Booking
							{
								$issue_amnt=$issue_qty*$avg_rate;
								
							}
							//echo $issue_purpose.'ff';
							if($issue_purpose==1 || $issue_purpose==4) //Knitting || Sample With Order
							{
								$recv_purpose=$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose'];
								//echo $recv_purpose.'R';
								if($recv_purpose==16) ////Grey Yarn
								{
								//	$yarn_cost=$issue_amnt;
									//$yarn_issued=$issue_qty;
								//	echo "A".$issue_amnt.'<br>';
								}
								
							}
							else if($issue_purpose==2) //Yarn Dyeing
							{
								$recv_purpose=$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose'];
								
								if($recv_purpose==16) ////Grey Yarn
								{
								}
							}
						}
						//echo $row[csf('issue_number')]."__".$booking_type.'__'.$is_short."__".$recv_purpose."__".$issue_purpose."<br>";
						
						if(($booking_type==1 || $booking_type==4) && (($is_short==2 || $is_short==1 ) &&  $booking_type!='') && ($recv_purpose==16 || $issue_purpose==2))
						{
							//echo $avg_rate.'a';
						$yarn_cost=$yarnTrimsCostArray[$row[csf('mst_id')]][$row[csf('prod_id')]]['grey_yarn_amt'];
						$yarn_issued=$yarnTrimsCostArray[$row[csf('mst_id')]][$row[csf('prod_id')]]['yq'];
					//	echo $yarn_cost;
							//$yarn_issued=$yarnTrimsCostArray[$row[csf('prod_id')]]['yq'];
						?>
						<tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
							<td width="40"><? echo $i; ?></td>
							<td width="110"><p><? echo $row[csf('issue_number')]; ?></p></td>
							<td width="80" align="center"><? echo change_date_format($row[csf('issue_date')]); ?></td>
							<td width="80" title="<?= $issue_purpose ?>"><p><? echo $yarn_issue_purpose[$issue_purpose]; ?></p></td>
							<td width="80"><p><? echo $supplier_array[$row[csf('supplier_id')]]; ?></p></td>
							<td width="80"><p><? echo $row[csf('lot')]; ?></p></td>
							<td width="180"><p><? echo $row[csf('product_name_details')]; ?></p></td>
							<td align="right" width="90">
								<? 
									echo fn_number_format($yarn_issued,2); 
									$total_yarn_issue_qnty+=$yarn_issued;
								?>
							</td>
							<td align="right" width="80">
								<? 
									
									echo fn_number_format($avg_rate,2); 
								?>&nbsp;
							</td>
							<td align="right">
								<?
									//$yarn_cost=$yarn_issued*$avg_rate;
									echo fn_number_format($yarn_cost,4); 
									$total_yarn_cost+=$yarn_cost;
								?>
							</td>
						</tr>
					<?
					$i++;
							}
							
							
					}
					?>
					<tr style="font-weight:bold">
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td align="right">Total</td>
						<td align="right"><? echo fn_number_format($total_yarn_issue_qnty,2);?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($total_yarn_cost,2);?></td>
					</tr>
					<thead>
						<th colspan="10"><b>Yarn Return</b></th>
					</thead>
					<thead>
						<th width="40">SL</th>
						<th width="110">Return Id</th>
						<th width="80">Return Date</th>
						<th width="80">Purpose</th>
						<th width="80">Supplier</th>
						<th width="80">Lot</th>
						<th width="180">Yarn Description</th>
						<th width="90">Return Qty.</th>
						<th width="80">Avg. Rate (USD)</th>
						<th>Cost ($)</th>
				</thead>
					<?
					$total_yarn_return_qnty=0; $total_yarn_return_cost=0;
					$sql="select a.booking_no,a.recv_number,a.receive_basis, a.receive_date,b.issue_purpose, sum(b.quantity+b.reject_qty) as returned_qnty, c.id as prod_id, c.supplier_id,c.color,c.lot, c.product_name_details, c.avg_rate_per_unit,d.requisition_no from inv_receive_master a, order_wise_pro_details b, product_details_master c, inv_transaction d where a.id=d.mst_id and d.transaction_type=4 and d.item_category=1 and c.item_category_id=1 and d.id=b.trans_id and b.trans_type=4 and b.entry_form=9 and b.po_breakdown_id in($po_id) and b.prod_id=c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.issue_purpose in (1)  group by a.id, c.id, a.recv_number, a.booking_no,a.receive_date,b.issue_purpose, c.supplier_id,c.color,c.lot, c.product_name_details,a.receive_basis, c.avg_rate_per_unit,d.requisition_no";
					//echo $sql; die;
					$result=sql_select($sql);
					foreach($result as $row)
					{
						if ($i%2==0)  
							$bgcolor="#E9F3FF";
						else
							$bgcolor="#FFFFFF";	
					
						$issue_basis=$row[csf('receive_basis')];
						$issue_purpose=$row[csf('issue_purpose')];
						$item_category=$row[csf('item_category')];
						if($issue_basis==1) //Booking Basis
							{
								$booking_no=$row[csf('booking_no')];
							}
							else if($issue_basis==3) //Requisition Basis
							{
								$booking_req_no=$row[csf('booking_no')];
								
								$prog_no=$reqs_array[$booking_req_no]['knit_id'];
								$booking_no=$plan_details_array[$prog_no];
								//echo $prog_no.'req';
							}
							$booking_type=$booking_array[$booking_no]['btype'];
							$is_short=$booking_array[$booking_no]['is_short'];
							//echo $issue_basis.'dsd';
							$transaction_date=$row[csf('receive_date')];
							if($db_type==0)
							{
								$conversion_date=change_date_format($transaction_date, "Y-m-d", "-",1);
							}
							else
							{
								$conversion_date=change_date_format($transaction_date, "d-M-y", "-",1);
							}
							$currency_rate=$receive_date_array[$row[csf('prod_id')]]['exchange_rate'];
							//$currency_rate=set_conversion_rate($usd_id,$conversion_date );
							
							$currency_id=$receive_curr_array[$row[csf('prod_id')]];
							if($receive_array[$row[csf('prod_id')]]>0)
							{
								
								//echo $currency_id.'D';
								if($currency_id==1) //Taka
								{
									$avg_rate=$receive_array[$row[csf('prod_id')]]/$currency_rate;
									//echo $avg_rate.'C';
								}
								else
								{
									$avg_rate=$receive_array[$row[csf('prod_id')]];	
									//echo $avg_rate.'B';
								}
							}
							else
							{
								$avg_rate=$avg_rate_array[$row[csf('prod_id')]]/$currency_rate;
								//echo $avg_rate.'A';
							}
							//echo $row[csf('prod_id')].'--'.$row[csf('lot')].'--'.$row[csf('color')].'<br>';
							$recv_purpose=$yarn_receive_arr[$row[csf('prod_id')]][$row[csf('lot')]][$row[csf('color')]]['purpose'];
							//echo $recv_purpose.', ';
						if($issue_purpose==1 || $issue_purpose==4)
						{
							if($recv_purpose==16)
							{
								//echo $row[csf('returned_qnty')].'--'.$avg_rate; die;
								$yarn_returned=$row[csf('returned_qnty')];
								$iss_ret_amnt=$row[csf('returned_qnty')]*$avg_rate;
								//echo $yarn_returned.'d'.$avg_rate;
							}
						}
						else if($issue_purpose==2) //Yarn Dyeing
						{
							if($recv_purpose==16)
							{
								$yarn_returned=$row[csf('returned_qnty')];
								$iss_ret_amnt=$row[csf('returned_qnty')]*$avg_rate;
								//echo $yarn_returned.'A';
							}
						}
						/* if(($booking_type==1 || $booking_type==4) &&  $is_short==2 &&  $booking_type!='' && $recv_purpose==16) //Main and Sample Faric Booking
							{ */
								$total_yarn_return_qnty+=$yarn_returned;
						?>
						<tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
							<td width="40"><? echo $i; ?></td>
							<td width="110"><p><? echo $row[csf('recv_number')]; ?></p></td>
							<td width="80" align="center"><? echo change_date_format($row[csf('receive_date')]); ?></td>
							<td width="80"><p><? echo $yarn_issue_purpose[$issue_purpose]; ?></p></td>
							<td width="80"><p><? echo $supplier_array[$row[csf('supplier_id')]]; ?></p></td>
							<td width="80"><p><? echo $row[csf('lot')]; ?></p></td>
						
							<td width="180"><p><? echo $row[csf('product_name_details')]; ?></p></td>
							<td align="right" width="90">
								<? 
									echo fn_number_format($yarn_returned,2); 
								?>
							</td>
							<td align="right" width="80">
								<? 
									echo fn_number_format($avg_rate,2); 
								?>&nbsp;
							</td>
							<td align="right">
								<?
									$yarn_return_cost=$iss_ret_amnt;
									echo fn_number_format($yarn_return_cost,2); 
									$total_yarn_return_cost+=$yarn_return_cost;
								?>
							</td>
						</tr>
					<?
						$i++;
							//}
					}
					?>
					<tr style="font-weight:bold">
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td align="right">Total</td>
						<td align="right"><? echo fn_number_format($total_yarn_return_qnty,2);?></td>
						<td>&nbsp;</td>
						<td align="right"><? echo fn_number_format($total_yarn_return_cost,2);?></td>
					</tr>
				
					<tfoot>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th>&nbsp;</th>
						<th align="right">Balance</th>
						<th align="right"><? echo fn_number_format(($total_yarn_issue_qnty+$total_trans_in_qnty)-($total_yarn_return_qnty+$total_trans_out_qnty),2); ?></th>
						<th>&nbsp;</th>
						<th align="right"><? echo fn_number_format(($total_yarn_cost+$total_trans_in_cost)-($total_yarn_return_cost+$total_trans_out_cost),2); ?></th>
					</tfoot>
				</table>	
			</div>
		</fieldset>  
	<?
	exit();
}
?>
<script>
function openmypage(po_id,type,tittle)
	{
		//alert(po_id);
		var popup_width='';
		if(type=="dye_fin_cost") 
		{
			popup_width='1140px';
		}
		else if(type=="fabric_purchase_cost") 
		{
			popup_width='740px';
		}
		else popup_width='1060px';
		
		emailwindow=dhtmlmodal.open('EmailBox', 'iframe', 'post_costing_report_v3_controller.php?po_id='+po_id+'&action='+type, tittle, 'width='+popup_width+', height=400px, center=1, resize=0, scrolling=0', '');
	}
</script>