<?
header('Content-type:text/html; charset=utf-8');
session_start();
if( $_SESSION['logic_erp']['user_id'] == "" ) header("location:login.php");
require_once('../../../../includes/common.php');
require_once('../../../../includes/class4/class.conditions.php');
require_once('../../../../includes/class4/class.reports.php');
require_once('../../../../includes/class4/class.yarns.php');
require_once('../../../../includes/class4/class.conversions.php');
require_once('../../../../includes/class4/class.trims.php');
require_once('../../../../includes/class4/class.emblishments.php');
require_once('../../../../includes/class4/class.commisions.php');
require_once('../../../../includes/class4/class.commercials.php');
require_once('../../../../includes/class4/class.others.php');
require_once('../../../../includes/class4/class.washes.php');
require_once('../../../../includes/class4/class.fabrics.php');

$_SESSION['page_permission']=$permission;
if( $_SESSION['logic_erp']['user_id'] == "" ) { header("location:login.php"); die; }
//--------------------------------------------------------------------------------------------------------------------

$user_name = $_SESSION['logic_erp']["user_id"];
$user_id = $_SESSION['logic_erp']["user_id"];

$data=$_REQUEST['data'];
$action=$_REQUEST['action'];
if ($action=="load_drop_down_buyer")
{
	echo create_drop_down( "cbo_buyer_name", 150, "select buy.id, buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data' $buyer_cond and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90)) order by buy.buyer_name","id,buyer_name", 1, "-- All Buyer --", $selected, "" );
	exit();
}

if ($action=="order_popup")
{
	echo load_html_head_contents("Popup Info","../../../../", 1, 1, $unicode);
	extract($_REQUEST);

	?>
	<script>
		function set_checkvalue(){
			if(document.getElementById('chk_job_wo_po').value==0) document.getElementById('chk_job_wo_po').value=1;
			else document.getElementById('chk_job_wo_po').value=0;
		}
		function js_set_value( str ){
			var data=str.split("_");
		//	alert(data[3]);
			document.getElementById('selected_job').value=data[0];
			document.getElementById('selected_year').value=data[1];
			document.getElementById('selected_company').value=data[2];
			document.getElementById('selected_exchange_rate').value=data[3];

			parent.emailwindow.hide();
		}
	</script>
	</head>
	<body>
	<div align="center" style="width:100%;" >
		<form name="searchorderfrm_1"  id="searchorderfrm_1" autocomplete="off">
            <table width="1110" cellspacing="0" cellpadding="0" border="1" class="rpt_table" align="center" rules="all">
                <thead>
                    <tr>
                        <th colspan="12"><? echo create_drop_down( "cbo_string_search_type", 130, $string_search_type,'', 1, "-- Searching Type --" ); ?></th>
                    </tr>
                    <tr>
                        <th width="120">Company Name</th>
                        <th width="150">Buyer Name</th>
                        <th width="80">Job No</th>
                        <th width="80">Style Ref </th>
                        <th width="80">Internal Ref</th>
                        <th width="80">File No</th>
                        <th width="80">Order No</th>
                        <th width="100">Shipment Status</th>
                        <th width="100">Date Category</th>
                        <th colspan="2" width="130" id="search_by_td_up">Enter Ship Date</th>
                        <th>
                            <input type="checkbox" value="0" onClick="set_checkvalue()" id="chk_job_wo_po">
                            <input type="hidden" id="selected_job">
                            <input type="hidden" id="selected_year">
                            <input type="hidden" id="selected_company">
                            <input type="hidden" id="selected_exchange_rate">
                            <input type="hidden" id="garments_nature" value="<? echo $garments_nature; ?>">
                            <input type="hidden" id="budget_version" value="<? echo $cbo_budget_version; ?>">
                            <input type="hidden" id="cost_control" value="<? echo $cbo_costcontrol_source; ?>">
                            Job Without PO
                        </th>
                     </tr>
                </thead>
                <tr class="general">
                    <td><? echo create_drop_down( "cbo_company_mst", 120, "select id,company_name from lib_company comp where status_active =1 and is_deleted=0 $company_cond order by company_name","id,company_name",1, "-- Select Company --", $company_name,"load_drop_down( 'style_wise_cost_comparison_report_controller2', this.value, 'load_drop_down_buyer', 'buyer_td' );" ); ?></td>
                    <td id="buyer_td"><? echo create_drop_down( "cbo_buyer_name", 150, $blank_array,'', 1, "-- Select Buyer --" ); ?></td>
                    <td><input name="txt_job_prifix" id="txt_job_prifix" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_style" id="txt_style" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_internal_ref" id="txt_internal_ref" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_file_no" id="txt_file_no" class="text_boxes" style="width:70px"></td>
                    <td><input name="txt_order_search" id="txt_order_search" class="text_boxes" style="width:70px"></td>
                    <td>
                        <?
                        echo create_drop_down( "shipping_status", 100, $shipment_status,"", 0, "-- Select --", 3, "",0,'','','','','' );
                        $search_by = array(1 => 'Country Ship Date', 2 => 'Ship Date', 3 => 'Ex Factory');
                        $dd = "change_search_event(this.value, '0*0*0', '0*0*0', '../../../../')";
                        ?>
                    </td>
                    <td><? echo create_drop_down("cbo_search_by", 100, $search_by, "", 0, "--Select--", "", $dd, 0); ?></td>
                    <td><input name="txt_date_from" id="txt_date_from" class="datepicker" style="width:60px" placeholder="From Date"></td>
                    <td><input name="txt_date_to" id="txt_date_to" class="datepicker" style="width:60px" placeholder="To Date"></td>
                    <td>
                        <input type="button" name="button2" class="formbutton" value="Show" onClick="show_list_view ( document.getElementById('cbo_company_mst').value+'_'+document.getElementById('cbo_buyer_name').value+'_'+document.getElementById('chk_job_wo_po').value+'_'+document.getElementById('txt_date_from').value+'_'+document.getElementById('txt_date_to').value+'_'+document.getElementById('garments_nature').value+'_'+document.getElementById('txt_job_prifix').value+'_'+document.getElementById('cbo_year_selection').value+'_'+document.getElementById('cbo_string_search_type').value+'_'+document.getElementById('txt_order_search').value+'_'+document.getElementById('txt_style').value+'_'+document.getElementById('txt_internal_ref').value+'_'+document.getElementById('txt_file_no').value+'_'+document.getElementById('shipping_status').value+'_'+document.getElementById('cbo_search_by').value+'_'+document.getElementById('budget_version').value, 'create_po_search_list_view', 'search_div', 'style_wise_cost_comparison_report_controller2', 'setFilterGrid(\'list_view\',-1)')" style="width:70px;" /></td>
                    </tr>
                    <tr>
                        <td align="center" colspan="12" valign="middle"><? echo load_month_buttons(1); ?></td>
                    </tr>
                </table>
                <div id="search_div"></div>
            </form>
        </div>
    </body>
     <script>
        load_drop_down( 'style_wise_cost_comparison_report_controller2', <? echo $company_name;?>, 'load_drop_down_buyer', 'buyer_td' );
    </script>
    <script src="../../../../includes/functions_bottom.js" type="text/javascript"></script>
    </html>
    <?
	exit();
}

if($action=="create_po_search_list_view")
{
	$data=explode('_',$data);
	$cbo_search_by = str_replace("'","",$data[14]);
	$budget_version = str_replace("'","",$data[15]);
	if ($data[0]!=0) $company=" and a.company_name='$data[0]'"; else { echo "Please Select Company First."; die; }
	if ($data[1]!=0) $buyer=" and a.buyer_name='$data[1]'"; else $buyer="";//{ echo "Please Select Buyer First."; die; }

	if(str_replace("'","",$data[3])!="" && str_replace("'","",$data[4])!="")
	{
	 	if($db_type==0)
		{
			$year_cond=" and SUBSTRING_INDEX(a.insert_date, '-', 1)=$data[7]";
			$start_date=change_date_format(str_replace("'","",$data[3]),"yyyy-mm-dd","");
			$end_date=change_date_format(str_replace("'","",$data[4]),"yyyy-mm-dd","");
		}
		else if($db_type==2)
		{
			$year_cond=" and to_char(a.insert_date,'YYYY')=$data[7]";
			$start_date=change_date_format(str_replace("'","",$data[3]),"","",1);
			$end_date=change_date_format(str_replace("'","",$data[4]),"","",1);
		}

		$date_cond="";
		if($cbo_search_by==1) $date_cond=" and c.country_ship_date between '$start_date' and '$end_date'";
		else if($cbo_search_by==2) $date_cond=" and b.pub_shipment_date between '$start_date' and '$end_date'";
		else if($cbo_search_by==3) $date_cond=" and d.ex_factory_date between '$start_date' and '$end_date'";
	}

	if($budget_version==1) $budget_version_cond="and f.entry_from=111";
	else $budget_version_cond="and f.entry_from=158";

	//echo $date_cond.'dssssssssss';
	if($cbo_search_by==3 && $data[13]==3)
	{
		if(str_replace("'","",$data[3])=="" && str_replace("'","",$data[4])=="")
		{
			echo "Please Select Ex-Factory Date Range"; die;
		}
	}

	$order_cond=""; $job_cond=""; $style_cond="";
	//echo  $data[8];die;
	if($data[8]==1)
	{
		if (str_replace("'","",$data[6])!="") $job_cond=" and a.job_no_prefix_num='$data[6]'  $year_cond";
		if (trim($data[9])!="") $order_cond=" and b.po_number='$data[9]'  "; //else  $order_cond="";
		if (trim($data[10])!="") $style_cond=" and a.style_ref_no='$data[10]'  "; //else  $style_cond="";
	}
	else if($data[8]==4 || $data[8]==0)
	{
		if (str_replace("'","",$data[6])!="") $job_cond=" and a.job_no like '%$data[6]%'  $year_cond"; //else  $job_cond="";
		if (trim($data[9])!="") $order_cond=" and b.po_number like '%$data[9]%'  ";
		if (trim($data[10])!="") $style_cond=" and a.style_ref_no like '%$data[10]%'  "; //else  $style_cond="";
	}
	else if($data[8]==2)
	{
		if (str_replace("'","",$data[6])!="") $job_cond=" and a.job_no like '$data[6]%'  $year_cond"; //else  $job_cond="";
		if (trim($data[9])!="") $order_cond=" and b.po_number like '$data[9]%'  ";
		if (trim($data[10])!="") $style_cond=" and a.style_ref_no like '$data[10]%'  "; //else  $style_cond="";
	}
	else if($data[8]==3)
	{
		if (str_replace("'","",$data[6])!="") $job_cond=" and a.job_no like '%$data[6]'  $year_cond"; //else  $job_cond="";
		if (trim($data[9])!="") $order_cond=" and b.po_number like '%$data[9]'  ";
		if (trim($data[10])!="") $style_cond=" and a.style_ref_no like '%$data[10]'  "; //else  $style_cond="";
	}

	$internal_ref = str_replace("'","",$data[11]);

	$file_no = str_replace("'","",$data[12]);
	if ($file_no=="") $file_no_cond=""; else $file_no_cond=" and b.file_no='".trim($file_no)."' ";
	if ($internal_ref=="") $internal_ref_cond=""; else $internal_ref_cond=" and b.grouping='".trim($internal_ref)."' ";
	$shiping_status=0;
	if($data[13]!=0) $shiping_status=" and b.shiping_status=$data[13]"; else $shiping_status=" ";

	$buyer_arr=return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
	$comp=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$exchange_rate_arr=return_library_array( "select job_no,exchange_rate from wo_pre_cost_mst",'job_no','exchange_rate');
	$arr=array (2=>$comp,3=>$buyer_arr,9=>$item_category);

	if ($data[2]==0)
	{
		if($cbo_search_by==1 || $cbo_search_by==2)
		{
			if($db_type==0)
			{
				$sql="select a.job_no_prefix_num, a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity,b.id as po_id, b.po_number,sum(b.po_quantity) as  po_quantity,b.shipment_date,a.garments_nature,b.grouping,b.file_no,DATEDIFF(pub_shipment_date,po_received_date) as  date_diff,SUBSTRING_INDEX(a.`insert_date`, '-', 1) as year from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_mst f  where a.job_no=b.job_no_mst and a.job_no=f.job_no and b.job_no_mst=f.job_no and c.job_no_mst=f.job_no and c.job_no_mst=a.job_no and c.po_break_down_id=b.id and a.garments_nature=$data[5] and a.status_active=1 and b.status_active=1  $company $buyer $job_cond $order_cond $style_cond $date_cond $shiping_status $file_no_cond $internal_ref_cond  $budget_version_cond ".set_user_lavel_filtering(' and a.buyer_name','buyer_id')."  group by a.job_no_prefix_num, a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity,b.id, b.po_number,b.shipment_date,a.garments_nature,b.grouping,b.file_no,a.insert_date,b.pub_shipment_date,b.po_received_date order by a.job_no DESC";
			}
			if($db_type==2)
			{
				$sql="select a.job_no_prefix_num, a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity, b.id as po_id,b.po_number,sum(b.po_quantity) as  po_quantity,b.shipment_date,a.garments_nature,b.grouping,b.file_no,(pub_shipment_date - po_received_date) as  date_diff,to_char(a.insert_date,'YYYY') as year from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,wo_pre_cost_mst f where a.job_no=b.job_no_mst and c.job_no_mst=a.job_no and c.po_break_down_id=b.id  and a.job_no=f.job_no and b.job_no_mst=f.job_no and c.job_no_mst=f.job_no and a.garments_nature=$data[5] and a.status_active=1 and b.status_active=1  $company $buyer ".set_user_lavel_filtering(' and a.buyer_name','buyer_id')." $job_cond $order_cond $style_cond $shiping_status $file_no_cond $internal_ref_cond $date_cond $budget_version_cond group by a.job_no_prefix_num, a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity,b.id, b.po_number,b.shipment_date,a.garments_nature,b.grouping,b.file_no,a.insert_date,b.pub_shipment_date,b.po_received_date order by a.job_no DESC";
			}
		}
		else
		{
			if($db_type==0)
			{
				$sql="select a.job_no_prefix_num, a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity, b.id as po_id,b.po_number,sum(b.po_quantity) as  po_quantity,b.shipment_date,a.garments_nature,b.grouping,b.file_no,DATEDIFF(pub_shipment_date,po_received_date) as  date_diff,SUBSTRING_INDEX(a.`insert_date`, '-', 1) as year from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,pro_ex_factory_mst d,wo_pre_cost_mst f where a.job_no=b.job_no_mst and c.job_no_mst=a.job_no and c.po_break_down_id=b.id and c.po_break_down_id=d.po_break_down_id and b.id=d.po_break_down_id and a.job_no=f.job_no and b.job_no_mst=f.job_no and c.job_no_mst=f.job_no and a.garments_nature=$data[5] and a.status_active=1 and b.status_active=1  $company $buyer $job_cond $order_cond $style_cond $shiping_status $file_no_cond $date_cond $internal_ref_cond $budget_version_cond ".set_user_lavel_filtering(' and a.buyer_name','buyer_id')."  group by a.job_no_prefix_num, a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity, b.po_number,b.shipment_date,a.garments_nature,b.id,b.grouping,b.file_no,a.insert_date,b.pub_shipment_date,b.po_received_date order by a.job_no DESC";
			}
			if($db_type==2)
			{
				$sql="select a.job_no_prefix_num, a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity, b.id as po_id,b.po_number,sum(b.po_quantity) as  po_quantity,b.shipment_date,a.garments_nature,b.grouping,b.file_no,(pub_shipment_date - po_received_date) as  date_diff,to_char(a.insert_date,'YYYY') as year from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c,pro_ex_factory_mst d,wo_pre_cost_mst f where a.job_no=b.job_no_mst and c.job_no_mst=a.job_no and c.po_break_down_id=b.id  and c.po_break_down_id=d.po_break_down_id and b.id=d.po_break_down_id and a.job_no=f.job_no and b.job_no_mst=f.job_no and c.job_no_mst=f.job_no and a.garments_nature=$data[5] and a.status_active=1 and b.status_active=1  $company $buyer ".set_user_lavel_filtering(' and a.buyer_name','buyer_id')." $job_cond $date_cond $order_cond $style_cond $shiping_status $file_no_cond $internal_ref_cond $date_cond $budget_version_cond group by a.job_no_prefix_num, a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.job_quantity, b.po_number,b.shipment_date,a.garments_nature,b.id,b.grouping,b.file_no,a.insert_date,b.pub_shipment_date,b.po_received_date order by a.job_no DESC";
			}
		}
	//echo $sql;
		//echo  create_list_view("list_view", "Job No,Year,Company,Buyer Name,Style Ref. No,Job Qty.,PO number,PO Quantity,Shipment Date,Gmts Nature,Ref no, File No,Lead time", "40,30,120,100,100,70,90,70,80,110,70,70,50","1120","320",0, $sql , "js_set_value", "job_no_prefix_num,year,company_name", "", 1, "0,0,company_name,buyer_name,0,0,0,0,0,garments_nature,0,0,0", $arr , "job_no_prefix_num,year,company_name,buyer_name,style_ref_no,job_quantity,po_number,po_quantity,shipment_date,garments_nature,grouping,file_no,date_diff", "",'','0,0,0,0,0,1,0,1,3,0,0,0,0');
	}
	else
	{
		$arr=array (2=>$comp,3=>$buyer_arr,5=>$item_category);
		if($db_type==0)
		{
			$sql="select a.job_no_prefix_num,a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.garments_nature,SUBSTRING_INDEX(a.`insert_date`, '-', 1) as year from wo_po_details_master a,wo_pre_cost_mst f where  a.job_no=f.job_no  and a.job_no not in( select distinct job_no_mst from wo_po_break_down where status_active=1 and is_deleted=0 ) and a.garments_nature=$data[5] and a.status_active=1 ".set_user_lavel_filtering(' and a.buyer_name','buyer_id')."   and a.is_deleted=0 $company $buyer $job_cond $budget_version_cond $style_cond  order by a.job_no DESC";
		}
		if($db_type==2)
		{
			$sql="select a.job_no_prefix_num,a.job_no,a.company_name,a.buyer_name,a.style_ref_no,a.garments_nature,to_char(a.insert_date,'YYYY') as year from wo_po_details_master a,wo_pre_cost_mst f where   a.job_no=f.job_no and a.job_no not in( select distinct job_no_mst from wo_po_break_down where status_active=1 and is_deleted=0 ) and a.garments_nature=$data[5] and a.status_active=1 ".set_user_lavel_filtering(' and a.buyer_name','buyer_id')."  and a.is_deleted=0 $company $buyer $budget_version_cond $job_cond $style_cond order by a.job_no DESC";
		}
		//echo  create_list_view("list_view", "Job No,Year,Company,Buyer Name,Style Ref. No,Gmts Nature", "90,60,120,100,100,90","1000","320",0, $sql , "js_set_value", "job_no", "", 1, "0,0,company_name,buyer_name,0,garments_nature", $arr , "job_no_prefix_num,year,company_name,buyer_name,style_ref_no,garments_nature", "",'','0,0,0,0,0,0');
	}
	//echo $sql; die;
	$result=sql_select($sql);
	if($cbo_search_by==3 && $data[13]==3)
	{
		$maxDateChkRes = sql_select("select a.job_no,a.id as job_id, b.id,c.ex_factory_date
		from wo_po_details_master a, wo_po_break_down b, pro_ex_factory_mst c
		where a.job_no = b.job_no_mst and b.id = c.po_break_down_id and b.status_active = 1 and c.status_active=1  $job_cond $order_cond $style_cond $shiping_status $file_no_cond $internal_ref_cond ");
		foreach ($maxDateChkRes as $md)
		{
			if($maxDateChkArr[$md[csf("job_no")]]["ex_date"]=="")
			{
				$maxDateChkArr[$md[csf("job_no")]]["ex_date"]= $md[csf("ex_factory_date")];
			}else if($maxDateChkArr[$md[csf("job_no")]]["ex_date"] < $md[csf("ex_factory_date")])
			{
				$maxDateChkArr[$md[csf("job_no")]]["ex_date"]= $md[csf("ex_factory_date")];
			}
		}
	}
	$to_date=str_replace("'","",$data[4]);
	//echo $to_date.'dd';
	$po_chk = array();

	foreach ($result as $row)
	{
		if($cbo_search_by==3 && $data[13]==3)
		{
			if(strtotime($maxDateChkArr[$row[csf("job_no")]]["ex_date"]) <= strtotime($to_date))
			{
				if($po_chk[$row[("po_id")]] == "")
				{
					$style_po_arr[$row[csf("job_no")]]["job_prefix"]= $row[csf("job_no_prefix_num")];
					$style_po_arr[$row[csf("job_no")]]["job_no"]= $row[csf("job_no")];
					$style_po_arr[$row[csf("job_no")]]["po_number"].= $row[csf("po_number")].',';
					$style_po_arr[$row[csf("job_no")]]["company_name"]= $row[csf("company_name")];
					$style_po_arr[$row[csf("job_no")]]["buyer_name"]= $row[csf("buyer_name")];
					$style_po_arr[$row[csf("job_no")]]["style_ref_no"]= $row[csf("style_ref_no")];
					$style_po_arr[$row[csf("job_no")]]["garments_nature"]= $row[csf("garments_nature")];
					$style_po_arr[$row[csf("job_no")]]["year"]= $row[csf("year")];
					$style_po_arr[$row[csf("job_no")]]["job_quantity"]= $row[csf("job_quantity")];
					$style_po_arr[$row[csf("job_no")]]["po_quantity"]+= $row[csf("po_quantity")];
					$style_po_arr[$row[csf("job_no")]]["shipment_date"]=$maxDateChkArr[$row[csf("job_no")]]["ex_date"];// $row[csf("ex_factory_date")];
					$style_po_arr[$row[csf("job_no")]]["grouping"].= $row[csf("grouping")].',';
					$style_po_arr[$row[csf("job_no")]]["date_diff"]+= $row[csf("date_diff")];
					$style_po_arr[$row[csf("job_no")]]["file_no"].= $row[csf("file_no")].',';
				}
			}
		}
		else
		{
			$style_po_arr[$row[csf("po_id")]]["job_prefix"]= $row[csf("job_no_prefix_num")];
			$style_po_arr[$row[csf("po_id")]]["job_no"]= $row[csf("job_no")];
			$style_po_arr[$row[csf("po_id")]]["po_number"]= $row[csf("po_number")];
			$style_po_arr[$row[csf("po_id")]]["company_name"]= $row[csf("company_name")];
			$style_po_arr[$row[csf("po_id")]]["buyer_name"]= $row[csf("buyer_name")];
			$style_po_arr[$row[csf("po_id")]]["style_ref_no"]= $row[csf("style_ref_no")];
			$style_po_arr[$row[csf("po_id")]]["garments_nature"]= $row[csf("garments_nature")];
			$style_po_arr[$row[csf("po_id")]]["year"]= $row[csf("year")];
			$style_po_arr[$row[csf("po_id")]]["job_quantity"]= $row[csf("job_quantity")];
			$style_po_arr[$row[csf("po_id")]]["po_quantity"]= $row[csf("po_quantity")];
			$style_po_arr[$row[csf("po_id")]]["shipment_date"]= $row[csf("shipment_date")];
			$style_po_arr[$row[csf("po_id")]]["grouping"]= $row[csf("grouping")];
			$style_po_arr[$row[csf("po_id")]]["date_diff"]= $row[csf("date_diff")];
			$style_po_arr[$row[csf("po_id")]]["file_no"]= $row[csf("file_no")];
		}
	}
	?>
	<div>
	<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1180" class="rpt_table">
		<thead>
			<th width="30">SL</th>
			<th width="80">	Job No</th>
			<th width="60">Year</th>
			<th width="120">Company</th>
			<th width="110">Buyer</th>
			<th width="110">Style Ref. No</th>
			<th width="100">Gmts Nature</th>
			<th width="80">Job Qty.</th>
			<th width="100">PO number</th>
			<th width="80">PO Qty</th>
			<th width="70"><? if($cbo_search_by==3 && $data[13]==3) echo "Ex-Factory";else echo "Shipment Date";?></th>
			<th width="70">Ref no</th>
			<th width="70">File no</th>
			<th>Lead time</th>
		</thead>
	</table>
	<div style="width:1180px; max-height:270px;overflow-y:scroll;" >
		<table cellspacing="0" cellpadding="0" border="1" rules="all" width="1160" class="rpt_table" id="list_view">
		<?

		$k=1;
		foreach($style_po_arr as $po_id=>$row)
		{
			if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
			//$exchange_rate=$exchange_rate_arr[$row[('job_no')]];
			$exchange_rate=set_conversion_rate( 2, date('d-m-Y'),$row[('company_name')]);
			$style_data=$row[("job_prefix")].'_'.$row[("year")].'_'.$row[('company_name')].'_'.$exchange_rate;
			$po_number=rtrim($row[("po_number")],",");
			$po_number=implode(",",array_unique(explode(",",$po_number)));
			$grouping=rtrim($row[("grouping")],",");
			$grouping=implode(",",array_unique(explode(",",$grouping)));
			$file_no=rtrim($row[("file_no")],",");
			$file_no=implode(",",array_unique(explode(",",$file_no)));

		?>
			<tr bgcolor="<? echo $bgcolor;?>"   style="cursor:pointer;" id="tr_<? echo $k; ?>" onClick="js_set_value('<? echo $style_data; ?>');change_color('tr_<? echo $k; ?>','<? echo $bgcolor;?>')">
                <td width="30"> <? echo $k; ?></td>
                <td width="80"><? echo $row[('job_prefix')]; ?></td>
                <td width="60"><? echo $row[('year')];; ?></td>
                <td width="120"><? echo $comp[$row[('company_name')]];//$garments_item[$row[csf('company_name')]]; ?></td>
                <td width="110"><p><? echo $buyer_arr[$row[('buyer_name')]]; ?></p></td>
                <td width="110"><p><? echo $row[('style_ref_no')]; ?></p></td>
                <td width="100"><? echo $item_category[$row[('garments_nature')]]; ?></p></td>
                <td width="80"><? echo $row[('job_quantity')]; ?></td>
                <td width="100"><p><? echo $po_number; ?></p></td>
                <td width="80"><? echo $row[('po_quantity')]; ?></td>
                <td width="70"><p><? echo change_date_format($row[('shipment_date')]); ?></td>
                <td width="70"><p><? echo $grouping; ?></p></td>
                <td width="70"><p><? echo $file_no; ?></p></td>
                <td width=""><? echo $row[('date_diff')]; ?></td>
			</tr>
			<?
			$k++;
		}
			?>
		</table>
	</div>
    </div>
    <?
	exit();
}

if($action=="load_exchange_rate")
{
	$data=explode("_",$data);
	$company_id=$data[0];
	$cbo_year=$data[1];
	$job_no=$data[2];
	$budget_version=$data[3];

	if($budget_version==1) $budget_version_cond="and f.entry_from=111"; else $budget_version_cond="and f.entry_from=158";

	if($db_type==0) $year_cond=" and SUBSTRING_INDEX(a.insert_date, '-', 1)=$cbo_year";
	if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

	$sql_data=sql_select("select b.job_no,b.exchange_rate from wo_po_details_master a,wo_pre_cost_mst b,wo_pre_cost_mst f where  a.job_no=b.job_no and a.job_no=f.job_no and a.company_name=$company_id and a.job_no_prefix_num=$job_no $year_cond $budget_version_cond");

	 $exchange_rate= $sql_data[0][csf('exchange_rate')];
	 echo $exchange_rate;
	exit();
}

if($action=="report_generate")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	//echo str_replace("'","",$cbo_costcontrol_source);die;
	$budget_version=str_replace("'","",$cbo_budget_version);
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	$dealing_merchant_array = return_library_array("select id, team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$team_leader_library=return_library_array( "select id, team_leader_name from lib_marketing_team", "id", "team_leader_name");
	//echo $budget_version; die;
	if($budget_version==1){
		$entry_from=111;
	}
	else if($budget_version==2){
		$entry_from=158;
	}
	else if($budget_version==3){
		$entry_from=520;
	}
	else{
		$entry_from=237;
	}


	if(str_replace("'","",$cbo_costcontrol_source)==1 || str_replace("'","",$cbo_costcontrol_source)==4)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("SELECT a.job_no from wo_po_details_master a,wo_pre_cost_mst f where  a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=$entry_from and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");
		//echo "SELECT a.job_no from wo_po_details_master a,wo_pre_cost_mst f where  a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=$entry_from and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no"; die;

		$chk_job_nos='';
		foreach($check_data as $row)
		{
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
			 $sql="SELECT a.id as job_id,a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id,a.inquiry_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}
		 $ref_no="";
		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();
		$shipArry=array(0,1,2);
		$shiping_status=1;$shiping_status_id="";
		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('inquiry_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$jobIdArr[$row[csf('job_id')]]=$row[csf('job_id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$ShipDateArrall[date("d-m-Y",strtotime($row[csf('shipment_date')]))]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			if($row[csf('shiping_status')]==3) //Full
			{
			 $shiping_status=2;
			}
			//echo $shiping_status.'D';
			$shipingStatus=$shiping_status;
			$shiping_status_id.=$row[csf('shiping_status')].',';
			$po_ids.=$row[csf('id')].',';$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
		}
		 //print_r($ShipDateArrall);
		$shiping_status_id=rtrim($shiping_status_id,',');

		$shiping_status_idAll=array_unique(explode(",",$shiping_status_id));
		//print_r($shiping_status_idAll);
		$shiping_status=3;
		foreach($shiping_status_idAll as $sid)
		{
			//echo $sid."D,";
			if(in_array($sid,$shipArry))
			{
				$shiping_status=2;
			}
		}
		//echo $shiping_status;
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2) and ENTRY_FORM=18");
		oci_commit($con);
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//PO ID Ref from=1
		disconnect($con);
		//$po_cond_for_in="";
		//if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")"; else $po_cond_for_in="";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		if($costPerQty>1){
			$costPerUom=($costPerQty/12)." Dzn";
		}else{
			$costPerUom=($costPerQty/1)." Pcs";
		}
		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array(); $washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/*echo "<pre>";
		print_r($YarnData); die;*/
		//production_logicsoft

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group  ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}

		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			  $sqlQc="select a.qc_no,a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.inquery_id =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$jobQty;//$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$qc_no=$qcrow[csf('qc_no')];
				$quaCostingPerQty=0;
				//if($quaCostingPer==1)
				$quaCostingPerQty=1;
			}
			unset($dataQc);
			//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$qc_no." order by id asc";
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1) //Fabric
				{
					if(($rowConsRate[csf("rate")]*1)>0)
					{
						//$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";

						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
						//echo $mktcons.'-'.$mktamt.'-'.$rowConsRate[csf('tot_cons')].'-'.$quaCostingPerQty.'-'.$quaOfferQnty.'<br>';
						$fabPurArr['mkt']['woven']['qty']+=$mktcons;
						$fabPurArr['mkt']['woven']['amount']+=$ConsRate*$mktcons;
					}

				}
				if($rowConsRate[csf("type")]==3 ) //Wash
				{
					$index="'".$emblishment_wash_type_arr[$rowConsRate[csf("particular_type_id")]]."'";

					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					if($rowConsRate[csf('rate')]>0)
					{
					$washData[$index]['mkt']['qty']+=$mktcons;
					$washData[$index]['mkt']['amount']+=$ConsRate*$mktcons;
					}
				}
				if($rowConsRate[csf("type")]==2)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$ConsRate*$mktcons;
				}
				if($rowConsRate[csf("type")]==4) //Acceoosries
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['qty']+=$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['amount']+=$ConsRate*$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['cons_uom']=$rowConsRate[csf('cons_uom')];
				}
			}
			//echo "<pre>";
			//print_r($washData);
			//die;

			$sql_item_summ="select mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$qc_no." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}

		 $grey_fab_trans_array=array();
		$sql_grey_trans="select c.from_order_id as FROM_ORDER_ID,a.from_prod_id as FROM_PROD_ID,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS GREY_IN,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS GREY_OUT,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_IN_AMT,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_OUT_AMT
		  from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) ";//
		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_id_array[$row[('FROM_PROD_ID')]]=$row[('FROM_PROD_ID')];
		}
		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 2, $from_prod_id_array, $empty_arr);//Prod ID Ref from=3
		disconnect($con);
		
		$avg_rate_array=return_library_array( "select b.id, b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=18", "id", "avg_rate_per_unit"  );
		
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$avg_rate=$avg_rate_array[$row[('FROM_PROD_ID')]];
			$from_order_id.=$row[('FROM_ORDER_ID')].',';
			$grey_fab_trans_qty_acl+=$row[('GREY_IN')]-$row[('GREY_OUT')];
			$grey_fab_trans_amt_acl+=($row[('GREY_IN_AMT')]-$row[('GREY_OUT_AMT')]);
		}
		$from_order_id=rtrim($from_order_id,',');
		$from_order_ids=array_unique(explode(",",$from_order_id));

		 $subconOutBillData="select b.order_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g  where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
		}
	
		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
			(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
			(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		 c.from_order_id
		  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) ";
		$result_fin_trans=sql_select( $sql_fin_trans );
		$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
		foreach ($result_fin_trans as $row)
		{
			$fin_from_order_id.=$row[csf('from_order_id')].',';
			$avg_rate=$avg_rate_array[$row[csf('prod_id')]];

			$fin_in_qnty+=$row[csf('in_qty')];
			$fin_out_qnty+=$row[csf('out_qty')];

			$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
			$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;
		}

		$po_ids=implode(",",$poIdArr);
		unset($result_fin_trans);
		$fin_from_order_id=rtrim($fin_from_order_id,',');
		$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

		$fin_trans_in_qty=$fin_in_qnty;
		$fin_trans_out_qty=$fin_out_qnty;

		$fin_trans_in_amt=$fin_in_amt;
		$fin_trans_out_amt=$fin_out_amt;



		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row)
		{
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		//$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=1 and a.fabric_source=2 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.booking_type=1 and a.fabric_source=2  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$data_fabPur=sql_select($sql);
			foreach($data_fabPur as $fabPur_row)
			{
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}



		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		//print_r($trimData);

		$trimsRecArr=array();


		 $sql_trim_wo = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.trim_group from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_trim_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=2  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18    and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_wo=sql_select($sql_trim_wo);
		foreach($data_array_wo as $row){
			$index=$row[csf('trim_group')];
			$trimData[$index]['acl']['qty']+=$row[csf('wo_qnty')];
			$trimData[$index]['acl']['amount']+=$row[csf('amount')];

		}
		unset($data_array_wo);


		//print_r($trimData);

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();

		 $sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row)
		{
			$index="'".$emblishment_wash_type_arr[$row[csf("emb_type")]]."'";
			if($row[csf('emb_name')]==3)
			{
				$washData[$index]['pre']['qty']+=$washQtyArr[$row[csf("job_no")]][$row[csf('id')]];
				$washData[$index]['pre']['amount']+=$washAmtArr[$row[csf("job_no")]][$row[csf('id')]];
			}
			else
			{
				$embData['pre']['qty']+=$embQtyArr[$jobNumber][$row[csf('id')]];
				$embData['pre']['amount']+=$embAmtArr[$jobNumber][$row[csf('id')]];
			}
		}
		//print_r($washData);
		 $sql_emb = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.emb_name, c.emb_type from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g  where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.booking_type=6 and c.emb_name!=3  and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_emb=sql_select($sql_emb);
		foreach($data_array_emb as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];
		}
		// Embl Cost End ============================
		// Wash Cost ============================


		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.emb_name, c.emb_type from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and c.emb_name =3   and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$index="'".$emblishment_wash_type_arr[$row[csf("emb_type")]]."'";
			$washData[$index]['acl']['qty']+=$row[csf('wo_qnty')];
			$washData[$index]['acl']['amount']+=$row[csf('amount')];

		}

		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}

		 $sql_cm_cost="select jobNo, available_min, production_date from production_logicsoft where jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			$production_date=change_date_format($row[csf('production_date')],'','',1);
			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		$sql="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  ";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (1,2) and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);
		// Other Cost End ============================
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><?
					 echo implode(",",$ShipDateArrall);
					 ?></td>
					<td>Team Leader</td>
                    <td style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td>Dealing Marchant</td>
                    <td style="word-break:break-all;" colspan="3"><? echo $dealing_marchants;?></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"><? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right" colspan="3"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>
			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px; margin-top:10px" rules="all">
				<thead>
                	<tr>
                    <td> </td>
                    <td> </td>
                     <td colspan="3" align="center"> <b>Buyer Cost</b></td>
                     <td colspan="4" align="center"> <b>Booking Cost</b></td>
                     <td colspan="4" align="center"> <b>Post Cost</b></td>
                    </tr>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="60">UOM</td>
						<td width="100">Marketing Qty</td>
						<td width="100">Marketing Price</td>
						<td width="100">Marketing Value</td>

						<td width="100">Pre-Cost Qty</td>
						<td width="100">Pre-Cost Price</td>
						<td width="100">Pre-Cost Value</td>
                        <td width="100">Cont. % On FOB Value</td>

						<td width="100">Actual Qty</td>
						<td width="100">Actual Price</td>
						<td width="100">Actual Value</td>
                        <td width="100">Cont. % On FOB Value</td>
					</tr>
				</thead>

				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;

				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";

				?>

				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="60">Yds</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($fabPurArr['pre']['woven']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($fabPurArr['acl']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">
						<?
						$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","");
						echo fn_number_format($fabPurMkt,4);
						$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
						$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","");
						$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","");
						?>
					</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor="<? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<? echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
                      <td width="100" align="right"><? echo fn_number_format(($fabPurPre*100/$jobValue),2).'%'; ?></td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
                     <td width="100" align="right"><? echo fn_number_format(($fabPurAcl*100/$jobValue),2).'%'; ?></td>
				</tr>


				 <tr style="font-weight:bold" class="transc">
					<td colspan="12">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Trims Cost<? //echo $item_descrition ?></td>
						<td width="60"></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount'],4); ?></td>

						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
                        <td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
                        <td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>


						<td width="100" align="right"><? //echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($tot_grey_fab_cost_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($tot_grey_fab_cost_acl,4); ?></A>&nbsp;<? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
                       <td width="100" align="right"><? echo fn_number_format(($tot_grey_fab_cost_acl*100/$jobValue),2).'%'; ?></td>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="60">Yds</td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>

						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
                        <td width="100" align="right"></td>

						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_cost/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
                         <td width="100" align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>

					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
                    <td width="100" align="right"><? //echo fn_number_format(($tot_fin_fab_transfer_cost*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl,4);
						$total_grey_fin_fab_transfer_actl_cost=$tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format((($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr>
					<td colspan="12" style="font-weight:bold" class="trims">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					if($index>0)
					{
						$item_descrition = $trim_groupArr[$index]['item_name'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="60"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>

							<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="100" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
                             <td width="100" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>

							<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="100" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
                            <td width="100" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="trimstotal" class="adl-signs" onClick="yarnT(this.id,'.trims')">+</span>&nbsp;&nbspTrims Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
                     <td width="100" align="right"><? echo fn_number_format(($totalTrimPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format(($totalTrimAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>

				  <?
				$w=1;$total_mkt_qty=$total_mkt_amt=$total_pre_qty=$total_pre_amt=$total_acl_qty=$total_acl_amt=0;
                foreach($washData as $index=>$row ){
					$index=str_replace("'","",$index);
					$item_des=explode("_",$index);
					$item_des=implode(",",$item_des);
					/*$item_descrition = $trim_groupArr[$index]['item_name'];
					$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");*/
					if($w%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				?>
				<tr  class="wash" bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" ><? echo  $item_des;	?></td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); $GrandTotalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");?></td>

					<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($row['pre']['amount'],4,".","")>fn_number_format($row['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($row['pre']['amount'],4);$GrandTotalPreValue+=fn_number_format($row['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($row['pre']['amount']/$jobValue)*100,4); ?></td>
                     <td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($row['acl']['amount'],4);$GrandTotalAclValue+=fn_number_format($row['acl']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($row['acl']['amount']/$jobValue)*100,4); ?></td>
				</tr>
                <?
				$w++;
				$total_mkt_qty+=$row['mkt']['qty'];
				$total_mkt_amt+=$row['mkt']['amount'];
				$total_pre_qty+=$row['pre']['qty'];
				$total_pre_amt+=$row['pre']['amount'];
				$total_acl_qty+=$row['acl']['qty'];
				$total_acl_amt+=$row['acl']['amount'];
				}
				?>
                 <tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="washtotal"  class="adl-signs" onClick="yarnT(this.id,'.wash')">+</span>&nbsp;&nbsp;Wash Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_amt/$total_mkt_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_amt,4); //$totalOtherMktValue+=fn_number_format($total_mkt_amt,4,".","");?></td>


					<td width="100" align="right"><? echo fn_number_format($total_pre_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_pre_amt/$total_pre_qty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($total_pre_amt,4,".","")>fn_number_format($total_pre_amt,4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($total_pre_amt,4);//$totalOtherPreValue+=fn_number_format($total_pre_amt,4,".",""); ?></td>
                      <td width="100" align="right"><? echo fn_number_format(($total_pre_amt/$jobValue)*100,4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($total_acl_qty,4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($total_acl_amt/$total_acl_qty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($total_acl_amt,4,".","")>fn_number_format($total_acl_amt,4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($total_acl_amt,4);//$totalOtherAclValue+=fn_number_format($total_acl_amt,4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($total_acl_amt/$jobValue)*100,4); ?></td>
				</tr>
                <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($embData['mkt']['amount'],4,".","");?></td>


					<td width="100" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? echo fn_number_format(($embData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? echo fn_number_format(($embData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>



				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commiData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //$aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty; echo fn_number_format($aclCommiAmt/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($aclCommiAmt,4); $totalOtherAclValue+=$aclCommiAmt; ?></td>
                    <td width="100" align="right"><? //echo fn_number_format(($aclCommiAmt*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commaData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($commaData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="100" align="right"><? //echo  fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>

					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? //if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($commer_act_cost,4); $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".",""); ?></td>
                    <td width="100" align="right"><? //echo fn_number_format(($commer_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? //if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['freight']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['acl']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['ore']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><?
					//$test_act_cost=$unitPrice*$exfactoryQty*(0.05/100);
					//echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.05/100)" bgcolor="<? //if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($test_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['inspection']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><?// echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['acl']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>

					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")) $font_color="white";
					else $font_color="black";
					?>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['cm_cost']['amount']/$exfactoryQty,4); ?></td>
					<!--<td width="100" align="right"  bgcolor="<? //if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?
						$making_cost_act=$otherData['pre']['cm_cost']['rate']*$exfactoryQty*(80/100);
					//$totalOtherAclValue+=fn_number_format($otherData['acl']['cm_cost']['amount'],4,".",""); //echo fn_number_format($otherData['acl']['cm_cost']['amount'],4);?></td>-->

					<!-- <a href="#report_details" style="color:<? //echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? //echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"></a> -->

					<td width="100" title="(Pre Cost Rate*Ex Fact Qty*80)/100)"  align="right"  bgcolor="<? if(fn_number_format($making_cost_act,4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=fn_number_format($making_cost_act,4,".",""); echo fn_number_format($making_cost_act,4); ?>
                    </td>
                     <td width="100" align="right"><? echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo fn_number_format($totalOtherMktValue,4); $GrandTotalMktValue+=fn_number_format($totalOtherMktValue,4,".",""); ?></td>

                    <td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherPreValue,4); $GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".",""); ?>
					</td>
                   <td width="100" align="right"><? echo fn_number_format(($totalOtherPreValue*100/$jobValue),2).'%'; ?></td>

					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherAclValue,4); $GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".",""); ?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format(($totalOtherAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>

					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
                     <td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue*100/$jobValue),2).'%'; ?></td>

					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
                    <td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue*100/$jobValue),2).'%'; ?></td>

				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="100" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo fn_number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="100" align="right"><? $quaOfferValue=$quaOfferQnty*$quaPriceWithCommnPcs; echo fn_number_format($quaOfferValue,4) ?></td>

                    <td width="100" align="right"><? echo $jobQty ?></td>
					<td width="100" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($jobValue,4) ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
                      <td width="100" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>

                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>


							<?
							foreach($nameArray_img AS $inf) {
								?>
                                 <td width="120">
                                <div style="float:left;width:120px" >
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
                                </div>
                                 </td>
                               
							    <?
							}
							?>

						<?
					}
					else echo ""; ?>

				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr><td colspan="10"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Trims</td>
					<td width="100">Trims %</td>
                    <td width="150">Wash</td>
					<td width="100">Wash %</td>

					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"  title="TotalMktValue/OfferValue*100"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right" title="Total Expand/OfferValue*100"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
                    <td width="150" align="right"><? echo fn_number_format($total_mkt_amt,4) ?></td>
					<td width="100" align="right" title="Total Mkt Wash/OfferValue*100"><? echo fn_number_format(($total_mkt_amt/$quaOfferValue)*100,4); ?></td>

					<td width="200" align="right" title="Offer Value-GrandTotal Mkt Value"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right" title="Offer Value-GrandTotal Mkt Value/OfferValue*100"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right" title="TotalPreValue/JobValue*100"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right" title="Total Trims/Job Value*100"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
                     <td width="150" align="right"><? echo fn_number_format($total_pre_amt,4) ?></td>
					<td width="100" align="right" title="Total Pre Wash/JobValue*100"><? echo fn_number_format(($total_pre_amt/$jobValue)*100,4); ?></td>

					<td width="200" align="right" title="Job Value-GrandTotal Pre Value"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right" title="Job Value-GrandTotal Pre Value/PreValue*100"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right" title="TotalActualValue/Ex-FactValue*100"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right" title="Total TrimsAcl/Ex-fact Value*100"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
                     <td width="150" align="right"><? echo fn_number_format($total_acl_amt,4) ?></td>
					<td width="100" align="right" title="Total Wash Acl/Ex-FactValue*100"><? echo fn_number_format(($total_acl_amt/$exfactoryValue)*100,4); ?></td>

					<td width="200" align="right" title="Ex-Fact Value-GrandTotal Acl Value"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right" title="Ex-fact Value-GrandTotal Ex Value/AclValue*100"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}
	if(str_replace("'","",$cbo_costcontrol_source)==2)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("select a.job_no from wo_po_details_master a,wo_pre_cost_mst f where a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=158 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row)
		{
			$chk_job_nos=$row[csf('job_no')];
		}
		if($chk_job_nos!='')
		{
			$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and  a.id=c.job_id and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $ref_no="";$uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();

		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$JobIdArr[$row[csf('job_id')]]=$row[csf('job_id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		 $con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (3,4) and ENTRY_FORM=18");
		oci_commit($con);
		
		
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 3, $poIdArr, $empty_arr);//PO id Ref from=1
		disconnect($con);
		//$po_cond_for_in="";
		//if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")"; else $po_cond_for_in="";
		 $exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g  where 1=1 and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;
		if($quotationId){
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;
			$sqlQua="select a.offer_qnty,a.costing_per,b.confirm_price,b.confirm_price_dzn,b.price_with_commn_pcs from wo_price_quotation a, wo_price_quotation_costing_mst b where a.id=b.quotation_id and a.id =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQua=sql_select($sqlQua);
			foreach($dataQua as $rowQua){
				$quaOfferQnty=$rowQua[csf('offer_qnty')];
				$quaConfirmPrice=$rowQua[csf('confirm_price')];
				$quaConfirmPriceDzn=$rowQua[csf('confirm_price_dzn')];
				$quaPriceWithCommnPcs=$rowQua[csf('price_with_commn_pcs')];
				$quaCostingPer=$rowQua[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
				if($quaCostingPer==2) $quaCostingPerQty=1;
				if($quaCostingPer==3) $quaCostingPerQty=24;
				if($quaCostingPer==4) $quaCostingPerQty=36;
				if($quaCostingPer==5) $quaCostingPerQty=48;
			}
		}

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		if($costPerQty>1){
			$costPerUom=($costPerQty/12)." Dzn";
		}else{
			$costPerUom=($costPerQty/1)." Pcs";
		}
		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$YarnData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id,copm_one_id,percent_one,type_id   from wo_pre_cost_fab_yarn_cost_dtls f where     f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id,copm_one_id,percent_one,type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row){
		//$yarnrate=$yarn_row[csf("rate")];
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		if($quotationId){
			$sql_yarn_pri="select f.id as yarn_id,f.cons_ratio,f.cons_qnty,f.rate,f.amount,count_id,copm_one_id,percent_one,type_id   from wo_pri_quo_fab_yarn_cost_dtls f where     f.quotation_id =".$quotationId." and f.is_deleted=0 and f.status_active=1  order by f.id";
			$data_arr_yarn_pri=sql_select($sql_yarn_pri);
			foreach($data_arr_yarn_pri as $yarn_row_pri){
				$yarnrate=$yarn_row_pri[csf("rate")];
		//$consQnty=($sql_yarn_pri[csf("cons_qnty")]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$consQnty=($yarn_row_pri[csf("cons_qnty")]/$quaCostingPerQty)*($quaOfferQnty);
		//echo "(".$sql_yarn_pri[csf("cons_qnty")]."/".$quaCostingPerQty.")*(".$quaOfferQnty.")";
				$amount=$consQnty*$yarnrate;
				$index="'".$yarn_row_pri[csf("count_id")]."_".$yarn_row_pri[csf("copm_one_id")]."_".$yarn_row_pri[csf("percent_one")]."_".$yarn_row_pri[csf("type_id")]."'";

				$YarnData[$index]['mkt']['qty']+=$consQnty;
				$YarnData[$index]['mkt']['amount']+=$amount;
			}
		}
	    //print_r($YarnData);
	    $yarn_recv =sql_select("select b.job_no,b.cons_amount,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a,inv_transaction b,product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
		foreach ($yarn_recv as $row) {
		//$index="'".$composition[$row[csf("yarn_comp_type1st")]]." ".$row[csf("yarn_comp_percent1st")].'%'."'";
			$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
			$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
		}
		//print_r($conv_yarn_arr);


		$issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,d.booking_no,c.receive_basis from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id  and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and a.trans_type in(4,5,6) and a.entry_form in(9,11)  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1");
		//echo "select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,c.cons_amount,c.order_amount,c.issue_id,d.booking_no,c.receive_basis from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id and a.trans_type in(4,5,6) and a.entry_form in(9,11) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";die;
		$YarnIssueReturn = $booking_req_return = array();
		foreach ($issue_return as $row) {
		$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if($row[csf("receive_basis")] == 1){
				//$YarnIssueReturn[$index]["qty"] += $row[csf("quantity")];
			}else{
				//$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
				//$booking_req_return[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			}
			$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
			$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
		}
		$YarnIssue=array();
	    //print_r($YarnIssueReturn);
		$issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3  and d.entry_form=3  and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18   and d.issue_purpose not in(2,8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");
		//echo "select a.po_breakdown_id,a.prod_id,a.quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3 and a.po_breakdown_id in(".implode(",",$poIdArr).") and d.issue_purpose!=2 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id";die;


		$issue_arr = $booking_req = array();
		foreach ($issue_details as $row) {
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			if($row[csf("receive_basis")] == 1){
				//$issue_arr[$row[csf("booking_no")]]["issue_qnty"] += $row[csf("quantity")];
			}else{
			//	$issue_arr[$row[csf("requisition_no")]]['req_qnty'] += $row[csf("quantity")];
				//$booking_req[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			}
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}


		foreach($YarnIssue as $ind=>$value){
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
			//echo $value['amount'].'-'.$YarnIssueReturn[$ind]['amount'].'/'.$g_exchange_rate.'<br>';
		}

		$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		//echo $conversion1->getQuery(); die;
		//$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndProcess();
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion1= new conversion($condition1);
		//$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndProcess();
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();

		$sql_conv_yarn="select b.id as po_id,c.job_no,c.id as conv_id, d.composition  from   wo_po_break_down b,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cost_fabric_cost_dtls d,
		 gbl_temp_engine g  where  b.job_no_mst=c.job_no and c.job_no=d.job_no  and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(30) and b.is_deleted=0  and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and c.amount>0 ";
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$index="".$row[csf("composition")]."";
			$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
			$conv_yarn_arr[$index]['acl']['qty']=$recv_yarn_arr[$row[csf("job_no")]]['qty'];
			$conv_yarn_arr[$index]['acl']['amount']=$recv_yarn_arr[$row[csf("job_no")]]['amt'];
		}
		//print_r($conv_yarn_arr);

		/* $sql="select x.*,(x.quantity*x.cons_rate) cons_amount from ( select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id, a.quantity,a.issue_purpose,a.returnable_qnty,a.is_sales,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type, c.cons_rate,d.issue_basis,d.booking_no,b.lot from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,wo_booking_mst e where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and d.booking_no=e.booking_no and a.trans_type in(2) and a.entry_form in(3) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and e.booking_type in(1,4) )x";
		$data_Yac=sql_select($sql);
		foreach($data_Yac as $row){
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}*/
		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		$grey_fab_array=array();  //Knitting Cost actual
		$sql_knit_prod="select c.yarn_lot,
		  (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g  where a.id=c.mst_id and c.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.")  ";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			//$grey_fab_array[$row[csf("yarn_lot")]]['knit_grey_qty']+=$row[csf("grey_qnty")];
			//$grey_fab_array[$row[csf("yarn_lot")]]['knit_grey_amt']+=$row[csf("grey_qnty")]*$avg_rate;
			//echo $row[csf("grey_qnty")].'='.$avg_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
	//	$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );
	
		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
	    $sql_grey_trans="select c.FROM_ORDER_ID,a.FROM_PROD_ID,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS GREY_IN,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS GREY_OUT,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_IN_AMT,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_OUT_AMT
		  from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).")";//
		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_id_array[$row[('FROM_PROD_ID')]]=$row[('FROM_PROD_ID')];
		}
		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 4, $from_prod_id_array, $empty_arr);//Prod ID Ref from=3
		disconnect($con);
		
		$avg_rate_array=return_library_array( "select b.id, b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=4 and g.entry_form=18", "id", "avg_rate_per_unit"  );
		
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			//$grey_fab_trans_array['gtt'][$row[csf('yarn_lot')]]+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$avg_rate=$avg_rate_array[$row[('FROM_PROD_ID')]];
			$from_order_id.=$row[('FROM_ORDER_ID')].',';
			$grey_fab_trans_qty_acl+=$row[('GREY_IN')]-$row[('GREY_OUT')];
			//$grey_fab_trans_amt_acl+=($row[csf('grey_in')]-$row[csf('grey_out')])*$avg_rate;
			$grey_fab_trans_amt_acl+=($row[('GREY_IN_AMT')]-$row[('GREY_OUT_AMT')]);
		}
		//echo $grey_fab_trans_qty_acl.'='.$grey_fab_trans_amt_acl;
		$from_order_id=rtrim($from_order_id,',');
		$from_order_ids=array_unique(explode(",",$from_order_id));

		$subconOutBillData="select b.order_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4)  ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
			//$subconCostArray[$subRow[csf('order_id')]]['dye_finish_bill']+=$subRow[csf('dye_finish_bill')]/$g_exchange_rate;
		}
		//echo $knit_grey_amt.'='.$tot_knit_charge.'='.$knit_grey_qty;
		//$grey_fab_cost=$knit_grey_amt+$tot_knit_charge;
		//$tot_grey_fab_cost_acl=($grey_fab_cost/$knit_grey_qty)*$grey_fab_trans_qty_acl;


		// Transfer Fin Actual
				$fin_fab_trans_array=array();
				 $sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
					(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
					(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
				 c.from_order_id
				  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and c.transfer_criteria!=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) ";
				$result_fin_trans=sql_select( $sql_fin_trans );
				$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
				foreach ($result_fin_trans as $row)
				{
					$fin_from_order_id.=$row[csf('from_order_id')].',';
					$avg_rate=$avg_rate_array[$row[csf('prod_id')]];

						$fin_in_qnty+=$row[csf('in_qty')];
						$fin_out_qnty+=$row[csf('out_qty')];

						$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
						$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;

					//echo $fin_in_qnty.'='.$fin_out_qnty.',';
					//$fin_fab_trans_qty+=$in_qnty-$out_qnty;
					//$fin_fab_trans_amt+=($in_qnty-$out_qnty)*$avg_rate;
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}

				$po_ids=implode(",",$poIdArr);
				unset($result_fin_trans);
				$fin_from_order_id=rtrim($fin_from_order_id,',');
				$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

				$fin_trans_in_qty=$fin_in_qnty;
				$fin_trans_out_qty=$fin_out_qnty;

				$fin_trans_in_amt=$fin_in_amt;
				$fin_trans_out_amt=$fin_out_amt;

			//	echo $fin_trans_in_amt.'AA'.$fin_trans_out_amt;

				$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
				$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

				$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
				$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;
				if($from_order_id!="") //Grey Transfer
				{
					 $knit_cost=$knit_qty=0;
					 foreach($from_order_ids as $po_id)
					 {
						$knit_cost+=array_sum($conversion_costing_arr_process[$po_id][1]);
						 $knit_qty+=array_sum($conversion_costing_arr_process_qty[$po_id][1]);
					 }
				}
				if($fin_from_order_id!="") //Finish Transfer
				{
					$condition2= new condition();
					$condition2->po_id("in($fin_from_order_id)");
					$condition2->init();
					$conversion2= new conversion($condition2);
					//echo $conversion2->getQuery(); die;
					$fin_conversion_costing_arr_process=$conversion2->getAmountArray_by_orderAndProcess();
					//print_r($fin_conversion_costing_arr_process);
					$conversion2= new conversion($condition2);
					$fin_conversion_costing_arr_process_qty=$conversion2->getQtyArray_by_orderAndProcess();
					 foreach($fin_from_order_ids as $po_id)
					 {
						 $tot_dye_finish_cost_pre=0;$tot_dye_finish_cost_pre_qty=0;
						foreach($conversion_cost_head_array as $process_id=>$val)
						{
							if($process_id!=30 && $process_id!=1 && $process_id!=35) //Yarn Dyeing,Knitting,Aop
							{
								$tot_dye_finish_cost_pre+=array_sum($fin_conversion_costing_arr_process[$po_id][$process_id]);

								$tot_dye_finish_cost_pre_qty+=array_sum($fin_conversion_costing_arr_process_qty[$po_id][$process_id]);
							}
						}
					 }
				}
				$knit_charge=$knit_cost/$knit_qty;

		if($quotationId){
			 $pq_conv_yarn_data="select a.composition,b.quotation_id,b.cost_head,b.charge_unit,
				(CASE WHEN b.cons_type=30 THEN b.amount END) AS yarn_dyeing_cost,
				(CASE WHEN b.cons_type=30 THEN  b.req_qnty END) AS req_qnty
				from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.id=b.cost_head and b.quotation_id =".$quotationId." and b.cons_type=30 and b.status_active=1  and b.is_deleted=0";
				$result_price_conv_yarn=sql_select($pq_conv_yarn_data);
				foreach($result_price_conv_yarn as $p_row)
				{
					$pri_yarnrate=$p_row[csf("charge_unit")];
					$index="".$p_row[csf("composition")]."";
					$mktcons=($p_row[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$amount=$mktcons*$pri_yarnrate;
					$conv_yarn_arr[$index]['mkt']['amount']+=$amount;
					$conv_yarn_arr[$index]['mkt']['qty']+=$mktcons;
				}
			}

		//print_r($YarnData);
		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
		$fabPurArr=array();
		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		if($quotationId){
			$totMktcons=0; $totMktAmt=0;
			$sql = "select id, item_number_id, body_part_id, fab_nature_id, color_type_id, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pri_quo_fabric_cost_dtls where quotation_id='".$quotationId."' and fabric_source=2";
			$data_fabPur=sql_select($sql);
			foreach($data_fabPur as $fabPur_row){
			//$mktcons=($fabPur_row[csf('avg_cons')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($fabPur_row[csf('avg_cons')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$fabPur_row[csf('rate')];
				if($fabPur_row[csf('fab_nature_id')]==2){
					$fabPurArr['mkt']['knit']['qty']+=$mktcons;
					$fabPurArr['mkt']['knit']['amount']+=$mktamt;
				}
				if($fabPur_row[csf('fab_nature_id')]==3){
					$fabPurArr['mkt']['woven']['qty']+=$mktcons;
					$fabPurArr['mkt']['woven']['amount']+=$mktamt;
				}
			}
		}

		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  and a.booking_type=1 and a.fabric_source=2   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('item_category')]==2){
				$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
				if($fabPur_row[csf('grey_fab_qnty')]>0){
					$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
				}
			}
			if($fabPur_row[csf('item_category')]==3){
				$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
				if($fabPur_row[csf('grey_fab_qnty')]>0){
					$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
				}
			}
		}

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		//$knitData=array();
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		//$knitDesArr=array();
		// $sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process,c.id as po_id from wo_po_break_down c, wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  c.job_no_mst=a.job_no  and c.job_no_mst=b.job_no  and a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1";
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				//echo $knitQtyArr[$row_knit[csf('po_id')]][$row_knit[csf('cons_process')]].'=';
				$knitData[$index]['pre']['qty']+=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']+=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}

		}
		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type=1";
			$data_knit=sql_select($sql);
			foreach($data_knit as $row_knit){
				$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
				if($row_knit[csf('cons_type')]==1){
				//$mktcons=($row_knit[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
					$mktcons=($row_knit[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$row_knit[csf('charge_unit')];
					$knitData[$index]['mkt']['qty']+=$mktcons;
					$knitData[$index]['mkt']['amount']+=$mktamt;
				}
			}
		}

		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}

		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}
	
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('delivery_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$finishData=array();
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process not in(1,2,30,35)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
		}
		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type not in(1,2,30,35)";
			$data_finish=sql_select($sql);
			foreach($data_finish as $row_finish){
				$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
				//$mktcons=($row_finish[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row_finish[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row_finish[csf('charge_unit')];
				$finishData[$index]['mkt']['qty']+=$mktcons;
				$finishData[$index]['mkt']['amount']+=$mktamt;
			}
		}
		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and a.process_id=4   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$aopData=array();
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$finishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$finishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}

		}

		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type=35";
			$data_aop=sql_select($sql);
			foreach($data_aop as $row_aop){
				$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
				if($row_aop[csf('cons_type')]==35){
				//$mktcons=($row_aop[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
					$mktcons=($row_aop[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$row_aop[csf('charge_unit')];
					$finishData[$index]['mkt']['qty']+=$mktcons;
					$finishData[$index]['mkt']['amount']+=$mktamt;
				}
			}
		}

		/*$sql = "select  b.batch_issue_qty, b.rate, b.amount, b.currency_id, b.exchange_rate,b.process_id from inv_receive_mas_batchroll a, pro_grey_batch_dtls b where a.id=b.mst_id and b.process_id=35 and b.job_no ='".$jobNumber."' and  b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			if($row_aop[csf('process_id')]==35){
				$exchange_rate=$row_aop[csf('batch_issue_qty')];
				if(!$exchange_rate){
					$exchange_rate=1;
				}
				$aopData['acl']['qty']+=$row_aop[csf('batch_issue_qty')];
				$aopData['acl']['amount']+=$row_aop[csf('amount')]/$exchange_rate;
			}
		}*/

		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id  and a.process_id=4 and b.sub_process_id in(31,35)  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			//$index=$row_aop[csf('product_name_details')];
			//$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('febric_description_id')]."'";
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
		}

		// Fabric AOP  End============================



		// Trim Cost ============================

		//$trim_group=return_library_array( "select item_name,id from  lib_item_group", "id", "item_name" );
		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group  ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}
		//print_r($trim_groupArr);
		$trimData=array();
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();

		$trim= new trims($condition);
		//$trimAmtArr=$trim->getAmountArray_by_jobAndItemid();
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$jobNumber][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$jobNumber][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		if($quotationId){
			$sql = "select id,  trim_group, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active from wo_pri_quo_trim_cost_dtls  where quotation_id='".$quotationId."' and status_active=1";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$trimData[$row[csf('trim_group')]]['mkt']['qty']+=$mktcons;
				$trimData[$row[csf('trim_group')]]['mkt']['amount']+=$mktamt;
				$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
			}
		}
		$trimsRecArr=array();
		$receive_qty_data=sql_select("select b.po_breakdown_id, d.item_group_id, b.id as prop_id, b.quantity as quantity, a.order_rate as rate, a.cons_rate, a.payment_over_recv  
		from inv_receive_master c, product_details_master d, inv_transaction a, order_wise_pro_details b,gbl_temp_engine g 
		where a.mst_id=c.id and a.id=b.trans_id and a.prod_id=d.id   and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and a.transaction_type=1 and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   ");
		foreach($receive_qty_data as $row)
		{
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['rate']=$row[csf('rate')];
			if($row[csf('payment_over_recv')] !=1)
			{
				$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			}
		}
		//print_r($trimsRecArr);
		$trimsRecReArr=array();
	//	$receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d  where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  d.po_breakdown_id in(".implode(",",$poIdArr).")");
		$receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d,gbl_temp_engine g  where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id  and d.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  ");
		foreach($receive_rtn_qty_data as $row){
			$trimsRecReArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecReArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];//$trimsRecArr[$row[csf('item_group_id')]]['rate'];
		}
		$sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		(CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		(CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		c.from_order_id
		from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g  where a.id=b.dtls_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6)  ";
		$result_trim_trans=sql_select( $sql_trim_trans );
		$trim_in_qnty=$trim_out_qnty=$trim_in_amt=$trim_out_amt=0;
		foreach ($result_trim_trans as $row)
		{
			$trim_from_order_id.=$row[csf('from_order_id')].',';
			$rate=$row[csf('rate')];
			$con_factor=$trim_groupArr[$row[csf('item_group')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group')]]['in_qty']+=$row[csf('in_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['out_qty']+=$row[csf('out_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['in_amt']+=$row[csf('in_qty')]*$con_factor*$rate;
			$trimsRecArr[$row[csf('item_group')]]['out_amt']+=$row[csf('out_qty')]*$con_factor*$rate;
		}

		foreach($trimsRecArr as $ind=>$value){
			$trimData[$ind]['acl']['qty']+=($trimsRecArr[$ind]['qty']+$trimsRecArr[$ind]['in_qty'])-($trimsRecReArr[$ind]['qty']+$trimsRecArr[$ind]['out_qty']);
			$trimData[$ind]['acl']['amount']+=($trimsRecArr[$ind]['amount']+$trimsRecArr[$ind]['in_amt'])-($trimsRecReArr[$ind]['amount']+$trimsRecArr[$ind]['out_amt']);
			$trimData[$ind]['cons_uom']=$trimsRecArr[$ind]['cons_uom'];
		}

		//print_r($trimData);

		// Trim Cost End============================
		// Embl Cost ============================
		$embData=array();
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and emb_name !=3";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['pre']['qty']+=$embQtyArr[$jobNumber][$row[csf('id')]];
			$embData['pre']['amount']+=$embAmtArr[$jobNumber][$row[csf('id')]];
		}
		//print_r($embData);
		if($quotationId){
			$sql = "select id, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pri_quo_embe_cost_dtls where quotation_id='".$quotationId."' and emb_name !=3";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$embData['mkt']['qty']+=$mktcons;
				$embData['mkt']['amount']+=$mktamt;
			}
		}
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g  where a.booking_no=b.booking_no and a.booking_type=6 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18 and b.emblishment_name !=3 a  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];

		}
		// Embl Cost End ============================
		// Wash Cost ============================
		$washData=array();
		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and emb_name =3";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['pre']['qty']+=$washQtyArr[$jobNumber][$row[csf('id')]];
			$washData['pre']['amount']+=$washAmtArr[$jobNumber][$row[csf('id')]];
		}
		if($quotationId){
			$sql = "select id, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pri_quo_embe_cost_dtls where quotation_id='".$quotationId."' and emb_name =3";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$washData['mkt']['qty']+=$mktcons;
				$washData['mkt']['amount']+=$mktamt;
			}
		}
		$sql="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  ";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}
		// Wash Cost End ============================
		// Commision Cost  ============================
		$commiData=array();
		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		if($quotationId){
			$sql = "select id,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pri_quo_commiss_cost_dtls  where quotation_id='".$quotationId."'";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktamt=($row[csf('commission_amount')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktamt=($row[csf('commission_amount')]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['qty']=$quaOfferQnty;
				$commiData['mkt']['amount']+=$mktamt;
				$commiData['mkt']['rate']+=$mktamt/$quaOfferQnty;
			}
		}
		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}

				$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;

			//echo $commaAmtArr[$jobNumber][$row[csf('id')]].'/'.$exfactory_qty;
		}
		if($quotationId){
			$sql = "select id, item_id, rate, amount, status_active from  wo_pri_quo_comarcial_cost_dtls where quotation_id=".$quotationId."";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktamt=($row[csf('amount')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktamt=($row[csf('amount')]/$quaCostingPerQty)*($quaOfferQnty);
				$commaData['mkt']['qty']=$quaOfferQnty;
				$commaData['mkt']['amount']+=$mktamt;
				$commaData['mkt']['rate']+=$mktamt/$quaOfferQnty;
			}
		}
		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$otherData=array();
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id ,lab_test ,inspection  ,cm_cost ,freight ,currier_pre_cost ,certificate_pre_cost ,common_oh ,depr_amor_pre_cost  from  wo_pre_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}
		if($quotationId){
			$sql = "select id ,lab_test ,inspection  ,cm_cost ,freight ,currier_pre_cost ,certificate_pre_cost ,common_oh ,depr_amor_pre_cost  from  wo_price_quotation_costing_mst where quotation_id='".$quotationId."'";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
				$freightAmt=($row[csf('freight')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['qty']=$quaOfferQnty;
				$otherData['mkt']['freight']['amount']=$freightAmt;
				$otherData['mkt']['freight']['rate']=$freightAmt/$quaOfferQnty;

				$labTestAmt=($row[csf('lab_test')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['qty']=$quaOfferQnty;
				$otherData['mkt']['lab_test']['amount']=$labTestAmt;
				$otherData['mkt']['lab_test']['rate']=$labTestAmt/$quaOfferQnty;

				$inspectionAmt=($row[csf('inspection')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['inspection']['qty']=$quaOfferQnty;
				$otherData['mkt']['inspection']['amount']=$inspectionAmt;
				$otherData['mkt']['inspection']['rate']=$inspectionAmt/$quaOfferQnty;

				$currierPreCostAmt=($row[csf('currier_pre_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['currier_pre_cost']['qty']=$quaOfferQnty;

				$otherData['mkt']['currier_pre_cost']['amount']=$currierPreCostAmt;
				$otherData['mkt']['currier_pre_cost']['rate']=$currierPreCostAmt/$quaOfferQnty;

				$cmCostAmt=($row[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['qty']=$quaOfferQnty;
				$otherData['mkt']['cm_cost']['amount']=$cmCostAmt;
				$otherData['mkt']['cm_cost']['rate']=$cmCostAmt/$quaOfferQnty;
			}
		}
		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0  order by id desc");
			foreach($sql_std_para as $row )
			{
				$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
				$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
				$diff=datediff('d',$applying_period_date,$applying_period_to_date);
				for($j=0;$j<$diff;$j++)
				{
					//$newDate=add_date(str_replace("'","",$applying_period_date),$j);
					$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);

					$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
					//$asking_profit_arr[$newDate]['max_profit']=$ask_row[csf('max_profit')];
				}
			}

	 $sql_cm_cost="select  jobNo, available_min,production_date from production_logicsoft where  jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			//$production_date=date("d-m-Y", strtotime($row[csf('production_date')]));

			$production_date=change_date_format($row[csf('production_date')],'','',1);

			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		$sql="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  ";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['freight']['rate']=$row[csf('freight')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['lab_test']['rate']=$row[csf('lab_test')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['inspection']['rate']=$row[csf('inspection')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['currier_pre_cost']['rate']=$row[csf('currier_pre_cost')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['cm_cost']['rate']=$row[csf('cm_cost')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
		//$commaData['acl']['cm_cost']['rate']=$row[csf('cm_cost')];
			}
		}
		 $con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (3,4) and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con); 
		// Other Cost End ============================
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td> <td><p><? echo $team_leaders;?></p></td>
					<td>Dealing Marchant</td><td  colspan="2"><p><? echo $dealing_marchants;?> </p></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"> <? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right"  colspan="2"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>
			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px; margin-top:10px" rules="all">
				<thead>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="60">UOM</td>
						<td width="100">Marketing Qty</td>
						<td width="100">Marketing Price</td>
						<td width="100">Marketing Value</td>
						<td width="100">Pre-Cost Qty</td>
						<td width="100">Pre-Cost Price</td>
						<td width="100">Pre-Cost Value</td>
						<td width="100">Actual Qty</td>
						<td width="100">Actual Price</td>
						<td width="100">Actual Value</td>
					</tr>
				</thead>
				<tr style="font-weight:bold" class="yarn">
					<td colspan="12">Yarn including yarn dyed</td>
				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0;

				$yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0;

				$totalMktValue=0; $totalPreValue=0; $totalAclValue=0;

				$totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$y++;
				}

				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row ){
					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					$totalAclQty+=fn_number_format($yarn_acl_qty,4,".","");
					?>

				 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($yarn_acl_qty,4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
				<?
				$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Yarn Total</td>
					<td width="60"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalMktQty,4);
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalPreQty,4);
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalPreValue>$totalMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','1')"><? echo fn_number_format($totalAclQty,4); ?></A>
					</td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalAclValue>$totalPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalAclValue,4,".","");
						?>
					</td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="300" >Fabric Purchase Cost (Knit)</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['amount']/$fabPurArr['mkt']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="60">Yds</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['mkt']['knit']['amount'],4,".","");
						echo  fn_number_format($fabPurMkt,4);
						$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
						$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['pre']['knit']['amount'],4,".","");
						$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['acl']['knit']['amount'],4,".","");

						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="12">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0;
				$totalKnitPreValue=0;
				$totalKnitAclValue=0;

				$totalKniMktQty=0;
				$totalKnitPreQty=0;
				$totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=fn_number_format($row['acl']['qty'],4,".","");
				//$knitDesArr[$index]=$body_part[$row_knit[csf('body_part_id')]].", ".$color_type[$row_knit[csf('color_type_id')]].", ".$row_knit[csf('fabric_description')].", ".$row_knit[csf('gsm_weight')];
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="60"></td>
					<td width="100" align="right">
						<? echo fn_number_format($totalKniMktQty,4);?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<? echo fn_number_format($totalKniMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalKniMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalKnitPreQty,4);?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalKnitAclQty,4);?></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalKnitAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="dyfi">
					<td colspan="12">Dye , Fin & Aop Cost</td>
				</tr>
				<?
				$totalFinMktValue=0;
				$totalFinPreValue=0;
				$totalFinAclValue=0;

				$totalFinMktQty=0;
				$totalFinPreQty=0;
				$totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="dyfi" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish & AOP Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">
						<? echo fn_number_format($totalFinMktQty,4);?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" >
						<?
						echo fn_number_format($totalFinMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalFinMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"  bgcolor=" <? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="300" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['amount']/$aopData['mkt']['qty'],4)?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['amount'],4); //$GrandTotalMktValue+=fn_number_format($aopData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aopData['pre']['amount'],4,".","")>fn_number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($aopData['pre']['amount'],4); //$GrandTotalPreValue+=fn_number_format($aopData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aopData['acl']['amount'],4,".","")>fn_number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aopData['acl']['amount'],4); //$GrandTotalAclValue+=fn_number_format($aopData['acl']['amount'],4,".","");?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="12">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;//$tot_grey_fab_cost=($grey_fab_cost/$knit_grey_qty)*$grey_fab_trans_qty;;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_grey_fab_cost_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($tot_grey_fab_cost_acl,4); ?></A><? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
					</tr>

				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="60">Kg</td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_cost/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">

					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" >

					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">

					</td>
					<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="100"  align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl,4);
						$total_grey_fin_fab_transfer_actl_cost=$tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
				</tr>

				<tr>
					<td colspan="12" style="font-weight:bold">Trims Cost</td>
				</tr>
				<?
				$t=1;
				$totalTrimMktValue=0;
				$totalTrimPreValue=0;
				$totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					$item_descrition = $trim_groupArr[$index]['item_name'];
					$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$t++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Trims Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($embData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" >Wash Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($washData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($washData['pre']['amount'],4,".","")>fn_number_format($washData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($washData['pre']['amount'],4);$totalOtherPreValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($washData['acl']['amount'],4,".","")>fn_number_format($washData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($washData['acl']['amount'],4);$totalOtherAclValue+=fn_number_format($washData['acl']['amount'],4,".",""); ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commiData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right">
						<?
			//$aclCommiAmt=($commiData['pre']['rate']/($costPerQty*$totalSetQnty))*$exfactoryQty;
						$aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty;
			//echo "(".$commiData['pre']['rate']."/(".$costPerQty*$totalSetQnty."))*".$exfactoryQty;
						echo fn_number_format($aclCommiAmt/$exfactoryQty,4);

						?>
					</td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>">
						<?
						echo fn_number_format($aclCommiAmt,4);
						$totalOtherAclValue+=$aclCommiAmt;
						?>
					</td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commaData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($commer_act_cost,4); $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['freight']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><?
					$test_act_cost=$unitPrice*$exfactoryQty*(0.05/100);
					echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.05/100)" bgcolor="<? if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['inspection']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".",""))
					{
						$font_color="white";
					}
					else
					{
						$font_color="black";
					}
					?>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['cm_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=fn_number_format($otherData['acl']['cm_cost']['amount'],4,".",""); echo fn_number_format($otherData['acl']['cm_cost']['amount'],4);?></td>
					<!-- <a href="#report_details" style="color:<? //echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? //echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"></a> -->
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalOtherMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalOtherMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalOtherPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalOtherAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="60"></td>
					<td width="100" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="100" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo fn_number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="100" align="right">
						<?
						$quaOfferValue=$quaOfferQnty *$quaPriceWithCommnPcs;
						echo fn_number_format($quaOfferValue,4)
						?>
					</td>
					<td width="100" align="right"><? echo $jobQty ?></td>
					<td width="100" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>
					<td width="120">
                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>
						    <div style="float:left;width:120px" >
							<?
							foreach($nameArray_img AS $inf) {
								?>
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
							    <?
							}
							?>
							</div>
						<?
					}
					else echo ""; ?>
                    </td>
				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr><td colspan="8"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}

	else if(str_replace("'","",$cbo_costcontrol_source)==3)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("select a.job_no from wo_po_details_master a,wo_pre_cost_mst f where a.job_no=f.job_no and a.company_name=$company_name and f.entry_from=158 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row) {
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
		 	$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and  a.id=c.job_id and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus=""; $ref_no="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();
		$job_no_arr=array();
		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$jobIdArr[$row[csf('job_id')]]=$row[csf('job_id')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';	$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
			array_push($job_no_arr, $row[csf('job_no')]);
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}

		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (5,6,7) and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);
		 
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 5, $poIdArr, $empty_arr);//Po id Ref from=1
		
		
		//$po_cond_for_in="";
		//if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")";
		 $exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		//echo $costPerQty.'m';die;
		if ($costPerQty>1) $costPerUom=($costPerQty/12)." Dzn";
		else $costPerUom=($costPerQty/1)." Pcs";

		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array();
		$washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/*echo "<pre>";
		print_r($YarnData); die;*/

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group where status_active=1 and is_deleted=0 ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}

		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			$sqlQc="select a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.qc_no =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
			}
			unset($dataQc);
			//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$quotationId." order by id asc";
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1)
				{
					if($rowConsRate[csf("rate_data")]!="")
					{
						$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];
						if($rowConsRate[csf("rate_data")]!="")
						{
							$qYarnData[$index]['mkt']['qty']+=$consQnty;
							$qYarnData[$index]['mkt']['amount']+=$amount;
						}


						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[14];
						$knitData[$index]['mkt']['qty']+=$mktcons;
						$knitData[$index]['mkt']['amount']+=$mktamt;

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$rate=0;
						$rate=$edata[15]+$edata[16]+$edata[17];
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rate;
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;
					}
					else
					{
						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						//echo $mktcons.'-'.$mktamt.'-'.$rowConsRate[csf('tot_cons')].'-'.$quaCostingPerQty.'-'.$quaOfferQnty.'<br>';
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;
					}
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$washData['mkt']['qty']+=$mktcons;
					$washData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]!=3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['qty']+=$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['amount']+=$mktamt;
					$trimData[$rowConsRate[csf('particular_type_id')]]['cons_uom']=$rowConsRate[csf('cons_uom')];
				}
			}
			/*echo "<pre>";
			print_r($trimData);
			die;*/

			$sql_item_summ="select mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$quotationId." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}

		$yarn_recv="select a.id as receive_id, a.booking_no,a.currency_id,a.receive_purpose,b.job_no,b.cons_amount,b.dye_charge,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a, inv_transaction b, product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1   and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
	 	$yarn_recv_res =sql_select($yarn_recv);

		$yarn_typeArr=array(7,12,15,38,46,50,51);
		foreach ($yarn_recv_res as $row)
		{
			$receive_purpose_id=$row[csf("receive_purpose")];
			$currency_id=$row[csf("currency_id")];
			$dye_charge=$row[csf("dye_charge")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			if($receive_purpose_id ==2)
			{
				$YarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
				$YarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
				$YarnRecv_arr[$index]['currency_id']=$currency_id;
				$dyedYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
			}
			else
			{
				if(in_array($receive_purpose_id,$yarn_typeArr))
				{
					$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
					$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
					if($row[csf("dye_charge")]>0)
					{
						$recv_yarn_rate_arr[$row[csf("job_no")]]['rate']=$dye_charge;
					}

					$SYarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
					$SYarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
					$SYarnRecv_arr[$index]['currency_id']=$currency_id;
					$SYarnRecv_arr[$index]['dye_charge']=$dye_charge;
					$serviceYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
				}
			}
		}
	    //echo '<pre>';print_r($serviceYarnRecv_arr);die;
		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 6, $dyedYarnRecv_arr, $empty_arr);//Recv ID Ref from=2
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 7, $serviceYarnRecv_arr, $empty_arr);//Service Recv ID Ref from=3
		disconnect($con);

	    // DYarn receive return
		$Dyarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d,gbl_temp_engine g
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=6 and g.entry_form=18  and c.transaction_type in(3) and c.item_category=1   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Dyarn_recv_return_res=sql_select($Dyarn_recv_return);

		$DYarnReceiveReturn_arr = array();
		foreach ($Dyarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$DYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$DYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}
		//echo '<pre>';print_r($DYarnReceiveReturn_arr);die;

		// SYarn receive return
	$Syarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d,gbl_temp_engine g
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=7 and g.entry_form=18   and c.transaction_type in(3) and c.item_category=1  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Syarn_recv_return_res=sql_select($Syarn_recv_return);

		$SYarnReceiveReturn_arr = array();
		foreach ($Syarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$SYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$SYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}
		unset($Syarn_recv_return_res);

			$YarnIssue=array();
	    //print_r($YarnIssueReturn);
		$issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no,d.id as issue_id from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id  and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18 and a.trans_type=2 and a.entry_form=3  and d.entry_form=3   and d.issue_purpose not in(8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");


		$issue_arr = $booking_req=$DYarnIssue = array();
		foreach ($issue_details as $row)
		{
			$issue_id_str.=$row[csf("issue_id")].",";
			$dyed_type=$row[csf("dyed_type")];
			$issue_purpose_id=$row[csf("issue_purpose")];
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if($issue_purpose_id==2) //Gery Yarn- for Dyed Yarn
			{
				$DYarnIssue[$index]['qty']+=$row[csf("quantity")];
				$DYarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			}
			else if(($issue_purpose_id==1 || $issue_purpose_id==4) && $dyed_type!=1) //Grey for knitting,Sample with
			{
				$YarnIssue[$index]['qty']+=$row[csf("quantity")];
				$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			}
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}

		$issue_ids = chop($issue_id_str,",");
		$issue_idsArr=array_unique(explode(",",$issue_ids));
		//$issue_id_string=where_con_using_array(array_unique(explode(",",$issue_ids)),0,"c.issue_id");
		//$issue_id_string = implode(",",array_unique(explode(",",$issue_ids)));
		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 8, $issue_idsArr, $empty_arr);//Issue ID Ref from=4
		disconnect($con);

		//echo '<pre>';print_r($DYarnReceiveReturn_arr);die;

		if($issue_ids !="")
		{
			$issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,c.receive_basis, b.dyed_type from order_wise_pro_details a, product_details_master b,inv_transaction c,gbl_temp_engine g,gbl_temp_engine gg where a.prod_id=b.id and a.trans_id=c.id  and a.po_breakdown_id=g.ref_val  and c.issue_id=gg.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18 and gg.user_id = ".$user_id." and gg.ref_from=8 and gg.entry_form=18  and a.trans_type in(4) and a.entry_form in(9)   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1  ");

			$YarnIssueReturn = $booking_req_return = array();
			foreach ($issue_return as $row)
			{
				$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
				if ($row[csf("dyed_type")] != 1){
					$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
					$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
				}
			}
		}

	    //print_r($DYarnIssue);
		foreach($YarnIssue as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'A';
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
		}
		foreach($YarnRecv_arr as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'b';
			$currency_id=$value['currency_id'];
			$DYarnData[$ind]['acl']['qty']+=($value['qty']-$DYarnReceiveReturn_arr[$ind]['qty']);
			if($currency_id==1) //TK
			{
				$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt'])/$g_exchange_rate;
			}
			else
			{
			 	$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt']);
			}
		}

		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 9, $jobIdArr, $empty_arr);//Job id Ref from=5
		disconnect($con);

		/*$sql_dy="SELECT a.qnty,c.yarn_count_id, c.yarn_comp_type1st, c.yarn_comp_percent1st, c.yarn_type, (a.qnty*c.avg_rate_per_unit) as amt FROM inv_material_allocation_mst a, wo_po_details_master b, product_details_master c, wo_booking_mst d WHERE a.job_no = b.job_no and a.booking_no = d.booking_no $job_no_cond and a.item_id = c.id and a.is_dyied_yarn = 1 and a.qnty > 0 and a.status_active = 1 and a.is_deleted = 0 and b.status_active = 1 and b.is_deleted = 0 and c.status_active = 1 and c.is_deleted = 0 and a.entry_form in (0,1)";*/
		$sql_dy="SELECT 
				       a.qnty,
				       c.yarn_count_id,
				       c.yarn_comp_type1st,
				       c.yarn_comp_percent1st,
				       c.yarn_type,
				       (a.qnty*c.avg_rate_per_unit) as amt
				  FROM inv_material_allocation_mst a,
				       wo_po_details_master b,
				       product_details_master c,
				       wo_booking_mst d,gbl_temp_engine g
				 WHERE a.job_no = b.job_no
				 	   and a.booking_no = d.booking_no
				       
				       and a.item_id = c.id
					   and b.id=g.ref_val   and g.user_id = ".$user_id." and g.ref_from =9 and g.entry_form=18
					   
				       and a.is_dyied_yarn = 1
				       and a.qnty > 0
				       and a.status_active = 1
				       and a.is_deleted = 0
				       and b.status_active = 1
				       and b.is_deleted = 0
				       and c.status_active = 1
				       and c.is_deleted = 0
				       and a.entry_form in (0,1)
				       ";
	    //echo $sql_dy;
	    $res_dy=sql_select($sql_dy);

	    $data_dried_yarn=array();

		foreach ($res_dy as $row)
		{


			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			$data_dried_yarn[$index]['qty']+=$row[csf("qnty")];
			$data_dried_yarn[$index]['amt']+=$row[csf("amt")];
		}
		$dried_yarn_data_arr=array();
		foreach ($data_dried_yarn as $index => $value) {
			$dried_yarn_data_arr[$index]['acl']['qty']+=$value['qty'];
			$dried_yarn_data_arr[$index]['acl']['amount']+=($value['amt'])/$g_exchange_rate;

		}

		$issue_details_yarn_service = sql_select("select d.id as prod_id,e.currency,f.cons_quantity as cons_quantity,c.dyeing_charge as dye_charge,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(c.amount) as service_amount,d.booking_no from inv_transaction f,product_details_master b,wo_yarn_dyeing_dtls c,inv_receive_master d,wo_yarn_dyeing_mst e where f.prod_id=b.id  and f.mst_id=d.id  and e.id=c.mst_id
		 and d.booking_id=e.id and d.entry_form=1  and  c.job_no ='".$jobNumber."' and d.receive_purpose in(7,12,15,38,46,50,51)   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1 order by b.id");

		$yarn_service_arr = array();
		foreach ($issue_details_yarn_service as $row)
		{
			$dyed_type=$row[csf("dyed_type")];
			$currency=$row[csf("currency")];
			$yarn_service_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			//	$recv_yarn_rate=$recv_yarn_rate_arr[$jobNumber]['rate'];
			$ServiceYarnIssue[$index]['qty']+=$row[csf("cons_quantity")];
			if($currency==1) //Tk
			{
				$ServiceYarnIssue[$index]['amount']+=($row[csf("cons_quantity")]*$row[csf("dye_charge")])/$g_exchange_rate;
			}
			else
			{
				$ServiceYarnIssue[$index]['amount']+=$row[csf("cons_quantity")]*$row[csf("dye_charge")];

			}
		}

	    //	print_r($SYarnRecv_arr);die;
		foreach($SYarnRecv_arr as $ind=>$value){
			$currency_id=$value['currency_id'];
			$SYarnData[$ind]['acl']['qty']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty']);
			if( $currency_id==1)
			{
				$SYarnData[$ind]['acl']['amount']+=(($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"])/$g_exchange_rate;
			}
			else
			{
				$SYarnData[$ind]['acl']['amount']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"];

			}
		}

		/*echo "<pre>";
		print_r($SYarnData); */

	 	/* $condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();  */

		$sql_conv_yarn="select b.id as po_id, c.job_no, c.id as conv_id,c.cons_process, d.fabric_description,d.composition from wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d, gbl_temp_engine g  where  b.job_id=c.job_id and c.job_id=d.job_id  and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18   and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(153,134,30) and b.is_deleted=0   and c.amount>0 "; 
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$cons_process=$row[csf("cons_process")];
			$index="".$row[csf("composition")]."";
			$desc="".$row[csf("fabric_description")]."";
			if($cons_process==30)
			{
				$index="".$row[csf("fabric_description")]."";
				$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
				$conv_yarn_arr[$index]['acl']['qty']=$YarnRecv_arr[$row[csf("job_no")]]['qty'];
				$conv_yarn_arr[$index]['acl']['amount']=$YarnRecv_arr[$row[csf("job_no")]]['amt'];
			}
			else
			{
				$ServiceYarnConv[$desc]['amount']+=array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$ServiceYarnConv[$desc]['qty']+=array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			}
		}

		foreach($ServiceYarnConv as $ind=>$value) {
			$SYarnData[$ind]['pre']['qty']+=$value['qty'];
			$SYarnData[$ind]['pre']['amount']+=$value['amount'];
		}
		//print_r($SYarnData);

		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		//echo $lot_tmp;
		$grey_fab_array=array();  //Knitting Cost actual
		$sql_knit_prod="select c.yarn_lot,
		 sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g where a.id=c.mst_id and c.id=b.dtls_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.")   group by c.yarn_lot";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
		 

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
		$sql_grey_trans="select c.from_order_id, a.from_prod_id, 
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		from inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,82,183,110,13) and b.trans_type in(5,6) )";//
		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_idarr[$row[csf('from_prod_id')]]=$row[csf('from_prod_id')];
		}
		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 10, $from_prod_idarr, $empty_arr);//Prod ID Ref from=6
		disconnect($con);
		 
		 
		//$sql_prod=sql_select("select id, avg_rate_per_unit,product_name_details from product_details_master");
		$sql_prod=sql_select("select b.id, b.product_name_details,b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=10 and g.entry_form=18");
		foreach($sql_prod as $row){
			$avg_rate_array[$row[csf("id")]]=$row[csf("avg_rate_per_unit")];
			$desc_array[$row[csf("id")]]=$row[csf("product_name_details")];
		}
		
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			$grey_in_amt=$row[csf('grey_in')]*$avg_rate;
			$grey_out_amt=$row[csf('grey_out')]*$avg_rate;
			$from_order_id.=$row[csf('from_order_id')].',';
			$grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$grey_fab_trans_amt_acl+=$grey_in_amt-$grey_out_amt;

		}
		$from_order_id=rtrim($from_order_id,',');
		//$transferIn_order_ids=implode(',',array_flip(array_flip(explode(",",rtrim($transferIn_order_id,',')))));
		$from_order_ids=array_unique(explode(",",$from_order_id));

		$subconOutBillData="select b.order_id,b.currency_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4)  ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			if($subRow[csf('knit_bill')]>0 && $subRow[csf('currency_id')]==1)
			{
				$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
			}
			else
			{
				$tot_knit_charge+=$subRow[csf('knit_bill')];
			}
		}

	 
		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
			(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
			(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		 c.from_order_id
		  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and c.transfer_criteria!=2 and b.is_deleted=0 and b.entry_form in(15,14,306) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6)";

		$result_fin_trans=sql_select( $sql_fin_trans );
		$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
		foreach ($result_fin_trans as $row)
		{
			$fin_from_order_id.=$row[csf('from_order_id')].',';

			$avg_rate=$avg_rate_array[$row[csf('prod_id')]];
			$fin_in_qnty+=$row[csf('in_qty')];
			$fin_out_qnty+=$row[csf('out_qty')];

			$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
			$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;
		}

		$po_ids=implode(",",$poIdArr);
		unset($result_fin_trans);
		$fin_from_order_id=rtrim($fin_from_order_id,',');
		$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

		$fin_trans_in_qty=$fin_in_qnty;
		$fin_trans_out_qty=$fin_out_qnty;

		$fin_trans_in_amt=$fin_in_amt;
		$fin_trans_out_amt=$fin_out_amt;

		$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
		$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

		$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
		$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;

		$job=str_replace("'","",$job);
		$jobWise_yarn_qty=0;
		$jobWise_yarn_amt=0;
		$sql_jobWise_yarn=sql_select("select JOB_NO, CONS_QNTY, AMOUNT from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_yarn as $val) {
			$jobWise_yarn_qty += $val['CONS_QNTY'];
			$jobWise_yarn_amt += $val['AMOUNT'];
		}
		$per_kg_yarn=$jobWise_yarn_amt/$jobWise_yarn_qty;

		$gray_conversion_costing_process_qty=0;
		$gray_conversion_costing_process_amt=0;
		$finish_conversion_costing_process_qty=0;
		$finish_conversion_costing_process_amt=0;

		$sql_jobWise_conversion=sql_select("select JOB_NO, CONS_PROCESS, REQ_QNTY, AMOUNT from wo_pre_cost_fab_conv_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_conversion as $val) {
			if ($val['CONS_PROCESS']==1){
				$gray_conversion_costing_process_qty += $val['REQ_QNTY'];
				$gray_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if($val['CONS_PROCESS'] !=30 && $val['CONS_PROCESS'] !=1  && $val['CONS_PROCESS'] !=35 && $val['CONS_PROCESS'] !=134) {
				$finish_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if ($val['CONS_PROCESS'] ==31) $finish_conversion_costing_process_qty += $val['REQ_QNTY'];
		}
		$gray_charge_unit = $gray_conversion_costing_process_amt/$gray_conversion_costing_process_qty;
		$finish_charge_unit = $finish_conversion_costing_process_amt/$finish_conversion_costing_process_qty;
		$gray_transfer_amount=$grey_fab_trans_qty_acl*$per_kg_yarn+$grey_fab_trans_qty_acl*$gray_charge_unit;
		$finish_transfer_amount=$tot_fin_fab_transfer_qty*$per_kg_yarn+$tot_fin_fab_transfer_qty*$gray_charge_unit+$tot_fin_fab_transfer_qty*$finish_charge_unit;
		//echo $gray_transfer_amount.'**'.$finish_transfer_amount;


		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0; 
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		$sql = "select a.item_category, a.booking_type, a.exchange_rate,a.fabric_source, b.trim_group,b.wo_qnty,b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount, b.uom as cons_uom from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no   and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_fabPur=sql_select($sql);//and a.booking_type=1 and a.fabric_source=2
		foreach($data_fabPur as $fabPur_row){
			$booking_type=$fabPur_row[csf('booking_type')];$fabric_source=$fabPur_row[csf('fabric_source')];
			if($booking_type==1 && $fabric_source==2) //Purchase and Fabric
			{
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('fin_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('fin_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}
			else //Trims
			{
				if($fabPur_row[csf('item_category')]==4){
					$rate=$fabPur_row[csf('rate')];
					$con_factor=$trim_groupArr[$fabPur_row[csf('trim_group')]]['con_factor'];
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['qty']+=$fabPur_row[csf('wo_qnty')]*$con_factor;
					//$trimsRecArr[$row[csf('trim_group')]]['out_qty']+=$row[csf('wo_qnty')]*$con_factor;
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['amt']+=$fabPur_row[csf('wo_qnty')]*$con_factor*$rate;
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['cons_uom']=$fabPur_row[csf('cons_uom')];
					//	$trimsRecArr[$row[csf('trim_group')]]['out_amt']+=$row[csf('wo_qnty')]*$con_factor*$rate;
				}

			}
		}
		//echo '<pre>';print_r($trimsRecArr);die;

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		$conversion= new conversion($condition);
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_id=b.job_id and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				$knitData[$index]['pre']['qty']=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}
		}

		$sql = "select b.receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];

			}
		}
		//
		 $sql_in = "select b.delivery_qty as receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  and a.process_id=2 and a.party_source=1  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit_in=sql_select($sql_in);
		foreach($data_knit_in as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];
			}
		}

		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_no='".$jobNumber."' and b.cons_process not in(1,2,134,30,35,153)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']+=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']+=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['process_name'].=$conversion_cost_head_array[$row_finish[csf('cons_process')]].',';
		}

		$sql_fin_in = "select  b.delivery_qty as receive_qty,b.rate,b.amount,b.currency_id,c.product_name_details, a.process_id from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  and a.process_id=4   and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish_in=sql_select($sql_fin_in);
		foreach($data_finish_in as $row_finish){
			$currency_id=$row_finish[csf('currency_id')];
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
			}
			else//usd
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')];
			}
			//$finishData[$index]['process_name'].=$conversion_cost_head_array[$row_finish[csf('process_id')]].',';
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_id=b.job_id and a.id=b.fabric_description and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$AopfinishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}
		}

		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18   and a.process_id=4  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop)
		{
			$sub_process_id=$row_aop[csf('sub_process_id')];
			$currency_id=$row_aop[csf('currency_id')];
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
			}
			else
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')];
			}
		}

		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
	

		$sql_trim_acl = "select a.item_category,a.currency_id,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.trim_group from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_trim_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=2  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
	//	echo $sql_trim_acl;die;
		$data_array_wo=sql_select($sql_trim_acl);
		foreach($data_array_wo as $row){
			$index=$row[csf('trim_group')];
			$currency_id=$row[csf('currency_id')];
			$trimData[$index]['acl']['qty']+=$row[csf('wo_qnty')];
			if($currency_id==1)
			{
				$trimData[$index]['acl']['amount']+=$row[csf('amount')]/$g_exchange_rate;
			}
			else
			{
				$trimData[$index]['acl']['amount']+=$row[csf('amount')];
			}

		}
		unset($data_array_wo);


		 // echo '<pre>';print_r($trimData);die;

		// foreach($trimsRecArr as $ind=>$value){
		// 	$trimData[$ind]['acl']['qty']+=$value['qty'];
		// 	$trimData[$ind]['acl']['amount']+=$value['amt'];
		// 	$trimData[$ind]['cons_uom']=$value['cons_uom'];
		// 	$trimData[$ind]['item_description']=$value['item_description'];
		// }
		$sql_issue_mrr = "select a.id as trid, a.transaction_type, a.cons_uom, a.order_id, a.cons_quantity, a.cons_amount, c.item_group_id, c.item_description from  product_details_master c,inv_transaction a,gbl_temp_engine g
		where   c.id=a.prod_id  and a.order_id=g.ref_val and  a.order_id>0  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18   and a.transaction_type=2 and a.item_category=4 ";
		$result_trim_trans=sql_select( $sql_issue_mrr );
		
		$trimsRecArr_new=array();

		foreach ($result_trim_trans as $row)
		{
			$index= $row[csf('item_description')]."***".$row[csf('item_group_id')];
			$trimsRecArr_new[$index]['qty']+=$row[csf('cons_quantity')];
			$trimsRecArr_new[$index]['amt']+=$row[csf('cons_amount')]/$g_exchange_rate;
			$trimsRecArr_new[$index]['cons_uom']=$row[csf('cons_uom')];
			$trimsRecArr_new[$index]['item_description']=$row[csf('item_description')];
		}
		$trimData_new=array();
		foreach($trimsRecArr_new as $ind=>$value){
			$trimData_new[$ind]['acl']['qty']+=$value['qty'];
			$trimData_new[$ind]['acl']['amount']+=$value['amt'];
			$trimData_new[$ind]['cons_uom']=$value['cons_uom'];
			$trimData_new[$ind]['item_description']=$value['item_description'];
		}

		$general_item_issue_sql="SELECT e.po_breakdown_id as po_id, a.item_group_id as item_group_id, a.unit_of_measure as uom, a.item_description as description, b.store_id, a.id as prod_id, e.QUANTITY as cons_quantity, e.AMOUNT as cons_amount
		from product_details_master a, inv_transaction b, order_wise_general_details e, gbl_temp_engine g 
		where a.id=b.prod_id and b.id=e.trans_id  and a.id=e.prod_id and b.prod_id=e.prod_id   and e.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form<>24 and b.transaction_type in(2,3,6)";
		$result_general_item_issue_sql=sql_select( $general_item_issue_sql );
		foreach ($result_general_item_issue_sql as $row)
		{
			$index= $row[csf('description')]."***".$row[csf('item_group_id')];
			$trimsRecArr_new[$index]['qty']+=$row[csf('cons_quantity')];
			$trimsRecArr_new[$index]['amt']+=$row[csf('cons_amount')]/$g_exchange_rate;
			$trimsRecArr_new[$index]['cons_uom']=$row[csf('cons_uom')];
			$trimsRecArr_new[$index]['item_description']=$row[csf('description')];
		}
		foreach($trimsRecArr_new as $ind=>$value){
			//echo $value['amt'].',';
			$trimData_new[$ind]['acl']['qty']+=$value['qty'];
			$trimData_new[$ind]['acl']['amount']+=$value['amt'];
			$trimData_new[$ind]['cons_uom']=$value['cons_uom'];
			$trimData_new[$ind]['item_description']=$value['item_description'];
		}
		//echo '<pre>';print_r($trimData);die;

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		//print_r($washAmtArr);die;
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$job_no=$row[csf('job_no')];
			if($row[csf('emb_name')]==3)
			{
				$washData['pre']['qty']+=$washQtyArr[$job_no][$row[csf('id')]];
				$washData['pre']['amount']+=$washAmtArr[$job_no][$row[csf('id')]];
			}
			else
			{
				$embData['pre']['qty']+=$embQtyArr[$job_no][$row[csf('id')]];
				$embData['pre']['amount']+=$embAmtArr[$job_no][$row[csf('id')]];
			}
		}
		//print_r($embData);

		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g  where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  and a.booking_type=6 and c.emb_name!=3  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1  and c.is_deleted=0 and c.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];
		}
		// Embl Cost End ============================
		// Wash Cost ============================

	 		$sql_wash = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and  c.emb_name=3 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_wash=sql_select($sql_wash);
		foreach($data_array_wash as $row) {
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}

		$sql_aop = "select a.id,a.currency_id, b.job_no,c.item_number_id, c.body_part_id, c.fab_nature_id, c.color_type_id, c.fabric_description, c.gsm_weight, d.cons_process,b.wo_qnty,b.amount from wo_booking_mst a,wo_booking_dtls b ,wo_pre_cost_fabric_cost_dtls c, wo_pre_cost_fab_conv_cost_dtls d where a.booking_no=b.booking_no   and c.job_no=b.job_no  and d.id=b.pre_cost_fabric_cost_dtls_id  and d.fabric_description=c.id  and a.booking_type=3 and a.process=35 and  a.item_category=12 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.job_no='".$jobNumber."' and d.cons_process=35";

		$data_array_aop=sql_select($sql_aop);
		foreach($data_array_aop as $row_aop){
			$desc=$row_aop[csf("fabric_description")];
			$index="'".$row_aop[csf('body_part_id')]."_".$desc."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['acl']['qty']+=$row_aop[csf('wo_qnty')];
				$currency_id=$row_aop[csf('currency_id')];
				if($currency_id==1)
				{
					$AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
				}
				else
				{
				    $AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')];

				}

			}
		//}

		}
		//print_r($AopfinishData);

		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'  and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}

		$sql_cm_cost="select jobNo, available_min, production_date from production_logicsoft where jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			$production_date=change_date_format($row[csf('production_date')],'','',1);
			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		$sql_c="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  ";
		$data_array=sql_select($sql_c);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		// Other Cost End ============================
		// Transfer Trim Cost Start============================
		$transfer_inArr=array();
		$transfer_inQty_data="SELECT a.from_order_id,b.item_group,(b.transfer_qnty) AS transfer_qnty,b.rate,c.grouping FROM inv_item_transfer_mst a,inv_item_transfer_dtls b,wo_po_break_down c,gbl_temp_engine g WHERE a.id = b.mst_id AND a.from_order_id=c.id and a.to_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  AND a.status_active = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0 ";
		$transfer_inQty_data_sql=sql_select($transfer_inQty_data);
		foreach ($transfer_inQty_data_sql as $row)
		{
			$index=$row[csf('item_group_id')];
			$in_rate=$row[csf('rate')];
			$transfer_inArr[$index]['qnty']+=$row[csf('transfer_qnty')];
		}
		$transfer_inAmount=$transfer_inArr[$index]['qnty']*$in_rate;
		unset($transfer_inQty_data_sql);
		$transfer_outArr=array();
		$transfer_outQty_data="SELECT a.from_order_id,b.item_group,sum(b.transfer_qnty) AS transfer_qnty,b.rate,c.grouping FROM inv_item_transfer_mst a,inv_item_transfer_dtls b,wo_po_break_down c,gbl_temp_engine g WHERE a.id = b.mst_id AND a.from_order_id=c.id AND  a.from_order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18   AND a.status_active = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0 group by a.from_order_id, b.item_group, b.rate,c.grouping";
		$transfer_outQty_data_sql=sql_select($transfer_outQty_data);
		foreach ($transfer_outQty_data_sql as $row)
		{
			$index=$row[csf('item_group_id')];
			$out_rate=$row[csf('rate')];
			$transfer_outArr[$index]['qty']+=$row[csf('transfer_qnty')];
		}
		$transfer_outAmount=$transfer_outArr[$index]['qty']*$out_rate;
		unset($transfer_outQty_data_sql);
		//$trims_transfer_cost=($transfer_outAmount-$transfer_inAmount)/$g_exchange_rate;
		$trims_transfer_cost=($transfer_inAmount-$transfer_outAmount)/$g_exchange_rate;
		// Transfer Trim Cost End============================
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (5,6,7,8,9,10) and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td>
                    <td style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td>Dealing Marchant</td>
                    <td colspan="3" style="word-break:break-all;"><? echo $dealing_marchants;?></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"><? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right" colspan="2"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>

			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1100px; margin-top:10px; float: left" rules="all">
				<thead>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="30">UOM</td>
						<td width="80">Pre-Cost Qty</td>
						<td width="80">Pre-Cost Price</td>
						<td width="80">Pre-Cost Value</td>
						<td width="80">Cont. % On FOB Value</td>
						<td width="80">Actual Qty</td>
						<td width="80">Actual Price</td>
						<td width="80">Actual Value</td>
						<td width="80">Cont. % On FOB Value</td>
					</tr>
				</thead>
				<tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="including yarn dyed">Yarn Cost<br>Grey Yarn</td>

				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					if($row['preCost']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['acl']['qty']>0)
					{
						$item_descrition =$lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				foreach($qYarnData as $index=>$row ){

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="QC"><?=$index; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo " "; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}

				?>
                <tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="yarn dyed">Dyed Yarn Cost</td>
				</tr>
                <?
				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row )
				{
					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					?>

				    <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right" title="yarn Recv Actual"><? echo fn_number_format($yarn_acl_qty,4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				
				
                foreach($DYarnData as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['preCost']['qty']>0)
					{
						$item_descrition =$index;
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				

				/* foreach($dried_yarn_data_arr as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['preCost']['qty']>0)
					{
						$item_descrition =$index;
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				} */
				//Dyed End
				?>

                 <tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="yarn dyed">Service Yarn Cost</td>
				</tr>
                <?
                  foreach($SYarnData as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['pre']['qty']>0)
					{
						$item_descrition =$index;
					}
					//$item_descrition =$index;

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['pre']['amount']>0) echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Yarn Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalPreQty,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalPreValue>$totalMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','1')"><? echo fn_number_format($totalAclQty,4); ?></A>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalAclValue>$totalPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="300" >Fabric Purchase Cost (Knit)</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="30">Yds</td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<?
				$fabPurPreQty=$fabPurArr['pre']['knit']['qty']+$fabPurArr['pre']['woven']['qty'];
				$fabPurPre=$fabPurArr['pre']['knit']['amount']+$fabPurArr['pre']['woven']['amount'];

				$fabPurAclQty=$fabPurArr['acl']['knit']['qty']+$fabPurArr['acl']['woven']['qty'];
				$fabPurAcl=$fabPurArr['acl']['knit']['amount']+$fabPurArr['acl']['woven']['amount'];
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right">  <? echo  fn_number_format($fabPurPreQty,4);
						 
						?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						  <? echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurPre*100/$jobValue),2).'%'; ?></td>
				
					<td width="80" align="right"> <? echo  fn_number_format($fabPurAclQty,4); ?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurAcl*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="10">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0; $totalKnitPreValue=0; $totalKnitAclValue=0; $totalKniMktQty=0; $totalKnitPreQty=0; $totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=fn_number_format($row['acl']['qty'],4,".","");
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalKnitAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold" class="dyfi">
					<td colspan="10">Dye & Fin  Cost</td>
				</tr>
				<?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$process_names='';
					if ($row['pre']['qty'] != 0){
						$process_names="(".rtrim($row['pre']['process_name'],',').")";
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="dyfi" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? echo $item_descrition.' '.$process_names; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish  Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
                <tr style="font-weight:bold" class="aop">
					<td colspan="10">AOP Cost</td>
				</tr>
                <?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$a=1;
				foreach($AopfinishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($a%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="aop" bgcolor="<? echo $bgcolor;?>" onClick="change_color('traop_<? echo $a; ?>','<? echo $bgcolor;?>')" id="traop_<? echo $a; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$a++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="aoptotal"  class="adl-signs" onClick="yarnT(this.id,'.aop')">+</span>&nbsp;&nbsp  AOP Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>

				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="300" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aopData['pre']['amount'],4,".","")>fn_number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($aopData['pre']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aopData['acl']['amount'],4,".","")>fn_number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aopData['acl']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="10">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($gray_transfer_amount/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="80" title="Transfer Qty*Avg Yarn Rate + Transfer Qty*Avg Knitting Charge" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($gray_transfer_amount,4); ?></A>&nbsp;<? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($gray_transfer_amount*100/$jobValue),2).'%'; ?></td>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="30">Kg</td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($finish_transfer_amount/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="80" align="right"  title="Transfer Qty*Avg Yarn Rate + Transfer Qty*Avg Knitting Charge + Transfer Qty*Avg Finishing Charge"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($finish_transfer_amount,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($finish_transfer_amount*100/$jobValue),2).'%'; ?></td>
					</tr>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Trims Cost</td>
						<td width="30">Kg</td>
						<td width="80" align="right">&nbsp;</td>
						<td width="80" align="right">&nbsp;</td>
						<td width="80" align="right">&nbsp;</td>
						<td width="80" align="right">&nbsp;</td>
						<td width="80" align="right">&nbsp;</td>
						<td width="80" align="right">&nbsp;</td>
						<td width="80" align="right"  title="Transfer Out - Transfer In"><A href='##' onClick="openmypage_issue2('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($trims_transfer_cost,4); ?></A></td>
						<td width="80" align="right"><? echo fn_number_format(($trims_transfer_cost*100/$jobValue),2).'%'; ?></td>
					</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($gray_transfer_amount/$grey_fab_trans_qty_acl)+($finish_transfer_amount/$tot_fin_fab_transfer_qty),4);//echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($gray_transfer_amount+$finish_transfer_amount,4);
						$total_grey_fin_fab_transfer_actl_cost=$gray_transfer_amount+$finish_transfer_amount;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format((($gray_transfer_amount+$finish_transfer_amount)*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr>
					<td colspan="10" style="font-weight:bold" class="trims">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;$totalTrimPreQty=0;$totalTrimAclAmt=0;$totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					if($index>0)
					{
						$item_descrition = $trim_groupArr[$index]['item_name'].' '.$row['item_description'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");

						$totalTrimPreQty+=fn_number_format($row['pre']['qty'],4,".","");

						$totalTrimAclQty+=fn_number_format($row['acl']['qty'],4,".","");
						$totalTrimAclAmt+=fn_number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="80" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="<? echo 'Act='.$row['acl']['amt'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				foreach($trimData_new as $index=>$row ){
					if($index!="")
					{
						$explode=explode("***", $index);
						$item_group_ids=$explode[1];
						$item_descrition = $trim_groupArr[$item_group_ids]['item_name'].' '.$row['item_description'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");

						$totalTrimPreQty+=fn_number_format($row['pre']['qty'],4,".","");

						$totalTrimAclQty+=fn_number_format($row['acl']['qty'],4,".","");
						$totalTrimAclAmt+=fn_number_format($row['acl']['amount'],4,".","");

						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'] ,4); ?></td>
							<td width="80" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']*100/$jobValue,2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="trimstotal" class="adl-signs" onClick="yarnT(this.id,'.trims')">+</span>&nbsp;&nbsp;Trims Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimPreQty),2); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimAclQty),2); ?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
							echo fn_number_format($totalTrimAclValue,4);
							$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
							$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimAclValue*100/$jobValue),2).'%'; ?></td>


				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($embData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>

					<td width="80" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($embData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" >Wash Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($washData['pre']['amount'],4,".","")>fn_number_format($washData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($washData['pre']['amount'],4);$totalOtherPreValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($washData['acl']['amount'],4,".","")>fn_number_format($washData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($washData['acl']['amount'],4);$totalOtherAclValue+=fn_number_format($washData['acl']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; ?></td>
					<td width="80" align="right"><? $aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty; echo fn_number_format($aclCommiAmt/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aclCommiAmt,4); $totalOtherAclValue+=$aclCommiAmt; ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aclCommiAmt*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount']/$commaData['pre']['qty'],4);  ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($commaData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="80" align="right"><? echo  fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)"  bgcolor="<? if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //($exfactoryQty*$commaData['pre']['rate'])*80/100; $unitPrice
					echo fn_number_format($commer_act_cost,4);//fn_number_format($exfactoryQty*$commaData['pre']['rate'],4);
					 $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".","");?></td>
					 <td width="80" align="right"><? echo fn_number_format(($commer_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['freight']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['freight']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['freight']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['lab_test']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><?
					$test_act_cost=$unitPrice*$exfactoryQty*(0.5/100);
					echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($test_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['inspection']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><?
					//$courier_cost_act=$otherData['pre']['currier_pre_cost']['rate']*$exfactoryQty*(80/100);
					echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")) $font_color="white";
					else $font_color="black";
					?>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><?
					$making_cost_act=$otherData['pre']['cm_cost']['rate']*$exfactoryQty*(80/100);
					echo fn_number_format($making_cost_act/$exfactoryQty,4); ?></td>
					<td width="80" title="Pre Cost Rate*Ex Fact Qty*(80/100)"  align="right"  bgcolor="<? if(fn_number_format($making_cost_act,4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=fn_number_format($making_cost_act,4,".",""); echo fn_number_format($making_cost_act,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherPreValue,4); $GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherAclValue,4); $GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo $jobQty ?></td>
					<td width="80" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($exfactoryValue*100/$jobValue),2).'%'; ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>
					<td width="120">
                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>
						    <div style="float:left;width:120px" >
							<?
							foreach($nameArray_img AS $inf) {
								?>
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
							    <?
							}
							?>
							</div>
						<?
					}
					else echo ""; ?>
                    </td>
				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px;" rules="all">
				<tr><td colspan="8"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}

	$html = ob_get_contents();
    ob_clean();
    foreach (glob("*.xls") as $filename) {
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_name."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');
    $is_created = fwrite($create_new_doc, $html);
    echo "$html****$filename";

	exit();
}

if($action=="report_generate4")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	//echo str_replace("'","",$cbo_costcontrol_source);die;
	$budget_version=str_replace("'","",$cbo_budget_version);
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	$dealing_merchant_array = return_library_array("select id, team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$team_leader_library=return_library_array( "select id, team_leader_name from lib_marketing_team", "id", "team_leader_name");
	//echo $budget_version; die;
	if($budget_version==1){
		$entry_from=111;
	}
	else if($budget_version==2){
		$entry_from=158;
	}
	else if($budget_version==3){
		$entry_from=520;
	}
	else{
		$entry_from=237;
	}


	if(str_replace("'","",$cbo_costcontrol_source)==1 || str_replace("'","",$cbo_costcontrol_source)==4)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("SELECT a.job_no from wo_po_details_master a,wo_pre_cost_mst f where  a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=$entry_from and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");
		//echo "SELECT a.job_no from wo_po_details_master a,wo_pre_cost_mst f where  a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=$entry_from and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no"; die;

		$chk_job_nos='';
		foreach($check_data as $row)
		{
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
			 $sql="SELECT a.id as job_id,a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id,a.inquiry_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}
		 $ref_no="";
		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();
		$shipArry=array(0,1,2);
		$shiping_status=1;$shiping_status_id="";
		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('inquiry_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$jobIdArr[$row[csf('job_id')]]=$row[csf('job_id')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$ShipDateArrall[date("d-m-Y",strtotime($row[csf('shipment_date')]))]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			if($row[csf('shiping_status')]==3) //Full
			{
			 $shiping_status=2;
			}
			//echo $shiping_status.'D';
			$shipingStatus=$shiping_status;
			$shiping_status_id.=$row[csf('shiping_status')].',';
			$po_ids.=$row[csf('id')].',';$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (11,12) and ENTRY_FORM=18");
		oci_commit($con);
		
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 11, $poIdArr, $empty_arr);//PO ID Ref from=1
		disconnect($con);
		 //print_r($ShipDateArrall);
		$shiping_status_id=rtrim($shiping_status_id,',');

		$shiping_status_idAll=array_unique(explode(",",$shiping_status_id));
		//print_r($shiping_status_idAll);
		$shiping_status=3;
		foreach($shiping_status_idAll as $sid)
		{
			//echo $sid."D,";
			if(in_array($sid,$shipArry))
			{
				$shiping_status=2;
			}
		}
		//echo $shiping_status;
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		//$po_cond_for_in="";
		//if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")"; else $po_cond_for_in="";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		if($costPerQty>1){
			$costPerUom=($costPerQty/12)." Dzn";
		}else{
			$costPerUom=($costPerQty/1)." Pcs";
		}
		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array(); $washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/*echo "<pre>";
		print_r($YarnData); die;*/
		//production_logicsoft

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group  ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}

		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			  $sqlQc="select a.qc_no,a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.inquery_id =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$jobQty;//$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$qc_no=$qcrow[csf('qc_no')];
				$quaCostingPerQty=0;
				//if($quaCostingPer==1)
				$quaCostingPerQty=1;
			}
			unset($dataQc);
			//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$qc_no." order by id asc";
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1) //Fabric
				{
					if(($rowConsRate[csf("rate")]*1)>0)
					{
						//$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";

						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
						//echo $mktcons.'-'.$mktamt.'-'.$rowConsRate[csf('tot_cons')].'-'.$quaCostingPerQty.'-'.$quaOfferQnty.'<br>';
						$fabPurArr['mkt']['woven']['qty']+=$mktcons;
						$fabPurArr['mkt']['woven']['amount']+=$ConsRate*$mktcons;
					}

				}
				if($rowConsRate[csf("type")]==3 ) //Wash
				{
					$index="'".$emblishment_wash_type_arr[$rowConsRate[csf("particular_type_id")]]."'";

					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					if($rowConsRate[csf('rate')]>0)
					{
					$washData[$index]['mkt']['qty']+=$mktcons;
					$washData[$index]['mkt']['amount']+=$ConsRate*$mktcons;
					}
				}
				if($rowConsRate[csf("type")]==2)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$ConsRate*$mktcons;
				}
				if($rowConsRate[csf("type")]==4) //Acceoosries
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['qty']+=$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['amount']+=$ConsRate*$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['cons_uom']=$rowConsRate[csf('cons_uom')];
				}
			}
			//echo "<pre>";
			//print_r($washData);
			//die;

			$sql_item_summ="select mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$qc_no." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}

		//$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
		$grey_fab_trans_array=array();
		$sql_grey_trans="select c.from_order_id as FROM_ORDER_ID,a.from_prod_id as FROM_PROD_ID,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS GREY_IN,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS GREY_OUT,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_IN_AMT,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_OUT_AMT
		  from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18   and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) ";//
		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_id_array[$row[('FROM_PROD_ID')]]=$row[('FROM_PROD_ID')];
		}
		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 12, $from_prod_id_array, $empty_arr);//Prod ID Ref from=3
		disconnect($con);
		$avg_rate_array=return_library_array( "select b.id, b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=12 and g.entry_form=18", "id", "avg_rate_per_unit"  );
		
		
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$avg_rate=$avg_rate_array[$row[('FROM_PROD_ID')]];
			$from_order_id.=$row[('FROM_ORDER_ID')].',';
			$grey_fab_trans_qty_acl+=$row[('GREY_IN')]-$row[('GREY_OUT')];
			$grey_fab_trans_amt_acl+=($row[('GREY_IN_AMT')]-$row[('GREY_OUT_AMT')]);
		}
		
		$from_order_id=rtrim($from_order_id,',');
		$from_order_ids=array_unique(explode(",",$from_order_id));

		$subconOutBillData="select b.order_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g  where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18 ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
		}

		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
			(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
			(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		 c.from_order_id
		  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) ";
		$result_fin_trans=sql_select( $sql_fin_trans );
		$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
		foreach ($result_fin_trans as $row)
		{
			$fin_from_order_id.=$row[csf('from_order_id')].',';
			$avg_rate=$avg_rate_array[$row[csf('prod_id')]];

			$fin_in_qnty+=$row[csf('in_qty')];
			$fin_out_qnty+=$row[csf('out_qty')];

			$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
			$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;
		}

		$po_ids=implode(",",$poIdArr);
		unset($result_fin_trans);
		$fin_from_order_id=rtrim($fin_from_order_id,',');
		$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

		$fin_trans_in_qty=$fin_in_qnty;
		$fin_trans_out_qty=$fin_out_qnty;

		$fin_trans_in_amt=$fin_in_amt;
		$fin_trans_out_amt=$fin_out_amt;



		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row)
		{
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18   and a.booking_type=1 and a.fabric_source=2  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$data_fabPur=sql_select($sql);
			foreach($data_fabPur as $fabPur_row)
			{
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}



		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		//print_r($trimData);

		$trimsRecArr=array();


		 $sql_trim_wo = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.trim_group from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_trim_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=2  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18    and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_wo=sql_select($sql_trim_wo);
		foreach($data_array_wo as $row){
			$index=$row[csf('trim_group')];
			$trimData[$index]['acl']['qty']+=$row[csf('wo_qnty')];
			$trimData[$index]['acl']['amount']+=$row[csf('amount')];

		}
		unset($data_array_wo);

		//print_r($trimData);

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();

		 $sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row)
		{
			$index="'".$emblishment_wash_type_arr[$row[csf("emb_type")]]."'";
			if($row[csf('emb_name')]==3)
			{
				$washData[$index]['pre']['qty']+=$washQtyArr[$row[csf("job_no")]][$row[csf('id')]];
				$washData[$index]['pre']['amount']+=$washAmtArr[$row[csf("job_no")]][$row[csf('id')]];
			}
			else
			{
				$embData['pre']['qty']+=$embQtyArr[$jobNumber][$row[csf('id')]];
				$embData['pre']['amount']+=$embAmtArr[$jobNumber][$row[csf('id')]];
			}
		}
		//print_r($washData);
		 $sql_emb = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.emb_name, c.emb_type from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g  where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18   and a.booking_type=6 and c.emb_name!=3  and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_emb=sql_select($sql_emb);
		foreach($data_array_emb as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];
		}
		// Embl Cost End ============================
		// Wash Cost ============================


		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.emb_name, c.emb_type from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18 and a.booking_type=6 and c.emb_name =3   and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$index="'".$emblishment_wash_type_arr[$row[csf("emb_type")]]."'";
			$washData[$index]['acl']['qty']+=$row[csf('wo_qnty')];
			$washData[$index]['acl']['amount']+=$row[csf('amount')];

		}

		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}

		 $sql_cm_cost="select jobNo, available_min, production_date from production_logicsoft where jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			$production_date=change_date_format($row[csf('production_date')],'','',1);
			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		$sql="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=11 and g.entry_form=18  ";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ref_from in (11,12) and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);
		// Other Cost End ============================
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><?
					 echo implode(",",$ShipDateArrall);
					 ?></td>
					<td>Team Leader</td>
                    <td style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td>Dealing Marchant</td>
                    <td style="word-break:break-all;" colspan="3"><? echo $dealing_marchants;?></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"><? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right" colspan="3"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>
			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px; margin-top:10px" rules="all">
				<thead>
                	<tr>
                    <td> </td>
                    <td> </td>
                     <td colspan="3" align="center"> <b>Buyer Cost</b></td>
                     <td colspan="4" align="center"> <b>Booking Cost</b></td>
                     <td colspan="4" align="center"> <b>Post Cost</b></td>
                    </tr>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="60">UOM</td>
						<td width="100">Marketing Qty</td>
						<td width="100">Marketing Price</td>
						<td width="100">Marketing Value</td>

						<td width="100">Pre-Cost Qty</td>
						<td width="100">Pre-Cost Price</td>
						<td width="100">Pre-Cost Value</td>
                        <td width="100">Cont. % On FOB Value</td>

						<td width="100">Actual Qty</td>
						<td width="100">Actual Price</td>
						<td width="100">Actual Value</td>
                        <td width="100">Cont. % On FOB Value</td>
					</tr>
				</thead>

				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;

				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";

				?>

				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="60">Yds</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($fabPurArr['pre']['woven']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($fabPurArr['acl']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">
						<?
						$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","");
						echo fn_number_format($fabPurMkt,4);
						$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
						$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","");
						$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","");
						?>
					</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor="<? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<? echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
                      <td width="100" align="right"><? echo fn_number_format(($fabPurPre*100/$jobValue),2).'%'; ?></td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
                     <td width="100" align="right"><? echo fn_number_format(($fabPurAcl*100/$jobValue),2).'%'; ?></td>
				</tr>


				 <tr style="font-weight:bold" class="transc">
					<td colspan="12">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Trims Cost<? //echo $item_descrition ?></td>
						<td width="60"></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount'],4); ?></td>

						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
                        <td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
                        <td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>


						<td width="100" align="right"><? //echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($tot_grey_fab_cost_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($tot_grey_fab_cost_acl,4); ?></A>&nbsp;<? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
                       <td width="100" align="right"><? echo fn_number_format(($tot_grey_fab_cost_acl*100/$jobValue),2).'%'; ?></td>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="60">Yds</td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>

						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
                        <td width="100" align="right"></td>

						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_cost/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
                         <td width="100" align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>

					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
                    <td width="100" align="right"><? //echo fn_number_format(($tot_fin_fab_transfer_cost*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl,4);
						$total_grey_fin_fab_transfer_actl_cost=$tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format((($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr>
					<td colspan="12" style="font-weight:bold" class="trims">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					if($index>0)
					{
						$item_descrition = $trim_groupArr[$index]['item_name'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="60"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>

							<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="100" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
                             <td width="100" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>

							<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="100" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
                            <td width="100" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="trimstotal" class="adl-signs" onClick="yarnT(this.id,'.trims')">+</span>&nbsp;&nbspTrims Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
                     <td width="100" align="right"><? echo fn_number_format(($totalTrimPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format(($totalTrimAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>

				  <?
				$w=1;$total_mkt_qty=$total_mkt_amt=$total_pre_qty=$total_pre_amt=$total_acl_qty=$total_acl_amt=0;
                foreach($washData as $index=>$row ){
					$index=str_replace("'","",$index);
					$item_des=explode("_",$index);
					$item_des=implode(",",$item_des);
					/*$item_descrition = $trim_groupArr[$index]['item_name'];
					$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");*/
					if($w%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				?>
				<tr  class="wash" bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" ><? echo  $item_des;	?></td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); $GrandTotalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");?></td>

					<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($row['pre']['amount'],4,".","")>fn_number_format($row['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($row['pre']['amount'],4);$GrandTotalPreValue+=fn_number_format($row['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($row['pre']['amount']/$jobValue)*100,4); ?></td>
                     <td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($row['acl']['amount'],4);$GrandTotalAclValue+=fn_number_format($row['acl']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($row['acl']['amount']/$jobValue)*100,4); ?></td>
				</tr>
                <?
				$w++;
				$total_mkt_qty+=$row['mkt']['qty'];
				$total_mkt_amt+=$row['mkt']['amount'];
				$total_pre_qty+=$row['pre']['qty'];
				$total_pre_amt+=$row['pre']['amount'];
				$total_acl_qty+=$row['acl']['qty'];
				$total_acl_amt+=$row['acl']['amount'];
				}
				?>
                 <tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="washtotal"  class="adl-signs" onClick="yarnT(this.id,'.wash')">+</span>&nbsp;&nbsp;Wash Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_amt/$total_mkt_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_amt,4); //$totalOtherMktValue+=fn_number_format($total_mkt_amt,4,".","");?></td>


					<td width="100" align="right"><? echo fn_number_format($total_pre_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_pre_amt/$total_pre_qty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($total_pre_amt,4,".","")>fn_number_format($total_pre_amt,4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($total_pre_amt,4);//$totalOtherPreValue+=fn_number_format($total_pre_amt,4,".",""); ?></td>
                      <td width="100" align="right"><? echo fn_number_format(($total_pre_amt/$jobValue)*100,4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($total_acl_qty,4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($total_acl_amt/$total_acl_qty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($total_acl_amt,4,".","")>fn_number_format($total_acl_amt,4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($total_acl_amt,4);//$totalOtherAclValue+=fn_number_format($total_acl_amt,4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($total_acl_amt/$jobValue)*100,4); ?></td>
				</tr>
                <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($embData['mkt']['amount'],4,".","");?></td>


					<td width="100" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? echo fn_number_format(($embData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? echo fn_number_format(($embData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>



				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commiData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //$aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty; echo fn_number_format($aclCommiAmt/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($aclCommiAmt,4); $totalOtherAclValue+=$aclCommiAmt; ?></td>
                    <td width="100" align="right"><? //echo fn_number_format(($aclCommiAmt*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commaData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($commaData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="100" align="right"><? //echo  fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>

					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? //if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($commer_act_cost,4); $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".",""); ?></td>
                    <td width="100" align="right"><? //echo fn_number_format(($commer_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? //if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['freight']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['acl']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['ore']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><?
					//$test_act_cost=$unitPrice*$exfactoryQty*(0.05/100);
					//echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.05/100)" bgcolor="<? //if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($test_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['inspection']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><?// echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['acl']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>

					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")) $font_color="white";
					else $font_color="black";
					?>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['cm_cost']['amount']/$exfactoryQty,4); ?></td>
					<!--<td width="100" align="right"  bgcolor="<? //if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?
						$making_cost_act=$otherData['pre']['cm_cost']['rate']*$exfactoryQty*(80/100);
					//$totalOtherAclValue+=fn_number_format($otherData['acl']['cm_cost']['amount'],4,".",""); //echo fn_number_format($otherData['acl']['cm_cost']['amount'],4);?></td>-->

					<!-- <a href="#report_details" style="color:<? //echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? //echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"></a> -->

					<td width="100" title="(Pre Cost Rate*Ex Fact Qty*80)/100)"  align="right"  bgcolor="<? if(fn_number_format($making_cost_act,4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=fn_number_format($making_cost_act,4,".",""); echo fn_number_format($making_cost_act,4); ?>
                    </td>
                     <td width="100" align="right"><? echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo fn_number_format($totalOtherMktValue,4); $GrandTotalMktValue+=fn_number_format($totalOtherMktValue,4,".",""); ?></td>

                    <td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherPreValue,4); $GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".",""); ?>
					</td>
                   <td width="100" align="right"><? echo fn_number_format(($totalOtherPreValue*100/$jobValue),2).'%'; ?></td>

					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherAclValue,4); $GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".",""); ?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format(($totalOtherAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>

					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
                     <td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue*100/$jobValue),2).'%'; ?></td>

					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
                    <td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue*100/$jobValue),2).'%'; ?></td>

				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="100" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo fn_number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="100" align="right"><? $quaOfferValue=$quaOfferQnty*$quaPriceWithCommnPcs; echo fn_number_format($quaOfferValue,4) ?></td>

                    <td width="100" align="right"><? echo $jobQty ?></td>
					<td width="100" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($jobValue,4) ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
                      <td width="100" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>

                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>


							<?
							foreach($nameArray_img AS $inf) {
								?>
                                 <td width="120">
                                <div style="float:left;width:120px" >
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
                                 </div>
                                 </td>
                              
							    <?
							}
							?>

						<?
					}
					else echo ""; ?>

				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr><td colspan="10"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Trims</td>
					<td width="100">Trims %</td>
                    <td width="150">Wash</td>
					<td width="100">Wash %</td>

					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"  title="TotalMktValue/OfferValue*100"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right" title="Total Expand/OfferValue*100"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
                    <td width="150" align="right"><? echo fn_number_format($total_mkt_amt,4) ?></td>
					<td width="100" align="right" title="Total Mkt Wash/OfferValue*100"><? echo fn_number_format(($total_mkt_amt/$quaOfferValue)*100,4); ?></td>

					<td width="200" align="right" title="Offer Value-GrandTotal Mkt Value"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right" title="Offer Value-GrandTotal Mkt Value/OfferValue*100"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right" title="TotalPreValue/JobValue*100"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right" title="Total Trims/Job Value*100"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
                     <td width="150" align="right"><? echo fn_number_format($total_pre_amt,4) ?></td>
					<td width="100" align="right" title="Total Pre Wash/JobValue*100"><? echo fn_number_format(($total_pre_amt/$jobValue)*100,4); ?></td>

					<td width="200" align="right" title="Job Value-GrandTotal Pre Value"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right" title="Job Value-GrandTotal Pre Value/PreValue*100"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right" title="TotalActualValue/Ex-FactValue*100"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right" title="Total TrimsAcl/Ex-fact Value*100"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
                     <td width="150" align="right"><? echo fn_number_format($total_acl_amt,4) ?></td>
					<td width="100" align="right" title="Total Wash Acl/Ex-FactValue*100"><? echo fn_number_format(($total_acl_amt/$exfactoryValue)*100,4); ?></td>

					<td width="200" align="right" title="Ex-Fact Value-GrandTotal Acl Value"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right" title="Ex-fact Value-GrandTotal Ex Value/AclValue*100"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}
	if(str_replace("'","",$cbo_costcontrol_source)==2)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("select a.job_no from wo_po_details_master a,wo_pre_cost_mst f where a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=158 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row)
		{
			$chk_job_nos=$row[csf('job_no')];
		}
		if($chk_job_nos!='')
		{
			$sql="select a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $ref_no="";$uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();

		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."   and ENTRY_FORM=18");
		oci_commit($con);
		
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//PO ID Ref from=1
		
		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")"; else $po_cond_for_in="";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g  where 1=1 and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;
		if($quotationId){
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;
			$sqlQua="select a.offer_qnty,a.costing_per,b.confirm_price,b.confirm_price_dzn,b.price_with_commn_pcs from wo_price_quotation a, wo_price_quotation_costing_mst b where a.id=b.quotation_id and a.id =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQua=sql_select($sqlQua);
			foreach($dataQua as $rowQua){
				$quaOfferQnty=$rowQua[csf('offer_qnty')];
				$quaConfirmPrice=$rowQua[csf('confirm_price')];
				$quaConfirmPriceDzn=$rowQua[csf('confirm_price_dzn')];
				$quaPriceWithCommnPcs=$rowQua[csf('price_with_commn_pcs')];
				$quaCostingPer=$rowQua[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
				if($quaCostingPer==2) $quaCostingPerQty=1;
				if($quaCostingPer==3) $quaCostingPerQty=24;
				if($quaCostingPer==4) $quaCostingPerQty=36;
				if($quaCostingPer==5) $quaCostingPerQty=48;
			}
		}

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		if($costPerQty>1){
			$costPerUom=($costPerQty/12)." Dzn";
		}else{
			$costPerUom=($costPerQty/1)." Pcs";
		}
		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$YarnData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id,copm_one_id,percent_one,type_id   from wo_pre_cost_fab_yarn_cost_dtls f where     f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id,copm_one_id,percent_one,type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row){
		//$yarnrate=$yarn_row[csf("rate")];
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		if($quotationId){
			$sql_yarn_pri="select f.id as yarn_id,f.cons_ratio,f.cons_qnty,f.rate,f.amount,count_id,copm_one_id,percent_one,type_id   from wo_pri_quo_fab_yarn_cost_dtls f where     f.quotation_id =".$quotationId." and f.is_deleted=0 and f.status_active=1  order by f.id";
			$data_arr_yarn_pri=sql_select($sql_yarn_pri);
			foreach($data_arr_yarn_pri as $yarn_row_pri){
				$yarnrate=$yarn_row_pri[csf("rate")];
		//$consQnty=($sql_yarn_pri[csf("cons_qnty")]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$consQnty=($yarn_row_pri[csf("cons_qnty")]/$quaCostingPerQty)*($quaOfferQnty);
		//echo "(".$sql_yarn_pri[csf("cons_qnty")]."/".$quaCostingPerQty.")*(".$quaOfferQnty.")";
				$amount=$consQnty*$yarnrate;
				$index="'".$yarn_row_pri[csf("count_id")]."_".$yarn_row_pri[csf("copm_one_id")]."_".$yarn_row_pri[csf("percent_one")]."_".$yarn_row_pri[csf("type_id")]."'";

				$YarnData[$index]['mkt']['qty']+=$consQnty;
				$YarnData[$index]['mkt']['amount']+=$amount;
			}
		}
	    //print_r($YarnData);
	    $yarn_recv =sql_select("select b.job_no,b.cons_amount,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a,inv_transaction b,product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
		foreach ($yarn_recv as $row) {
		//$index="'".$composition[$row[csf("yarn_comp_type1st")]]." ".$row[csf("yarn_comp_percent1st")].'%'."'";
			$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
			$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
		}
		//print_r($conv_yarn_arr);


		$issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,d.booking_no,c.receive_basis from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g  where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id  and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.trans_type in(4,5,6) and a.entry_form in(9,11)  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1");
		//echo "select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,c.cons_amount,c.order_amount,c.issue_id,d.booking_no,c.receive_basis from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id and a.trans_type in(4,5,6) and a.entry_form in(9,11) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";die;
		$YarnIssueReturn = $booking_req_return = array();
		foreach ($issue_return as $row) {
		$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if($row[csf("receive_basis")] == 1){
				//$YarnIssueReturn[$index]["qty"] += $row[csf("quantity")];
			}else{
				//$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
				//$booking_req_return[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			}
			$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
			$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
		}
		$YarnIssue=array();
	    //print_r($YarnIssueReturn);
		$issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id  and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.trans_type=2 and a.entry_form=3  and d.entry_form=3 and d.issue_purpose not in(2,8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");
		//echo "select a.po_breakdown_id,a.prod_id,a.quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3 and a.po_breakdown_id in(".implode(",",$poIdArr).") and d.issue_purpose!=2 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id";die;


		$issue_arr = $booking_req = array();
		foreach ($issue_details as $row) {
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			if($row[csf("receive_basis")] == 1){
				//$issue_arr[$row[csf("booking_no")]]["issue_qnty"] += $row[csf("quantity")];
			}else{
			//	$issue_arr[$row[csf("requisition_no")]]['req_qnty'] += $row[csf("quantity")];
				//$booking_req[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			}
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}


		foreach($YarnIssue as $ind=>$value){
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
			//echo $value['amount'].'-'.$YarnIssueReturn[$ind]['amount'].'/'.$g_exchange_rate.'<br>';
		}

		$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		//echo $conversion1->getQuery(); die;
		//$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndProcess();
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion1= new conversion($condition1);
		//$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndProcess();
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();

		 $sql_conv_yarn="select b.id as po_id,c.job_no,c.id as conv_id, d.composition  from   wo_po_break_down b,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cost_fabric_cost_dtls d,gbl_temp_engine g  where  b.job_id=c.job_id and c.job_id=d.job_id and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(30) and b.is_deleted=0   and c.amount>0 ";
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$index="".$row[csf("composition")]."";
			$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
			$conv_yarn_arr[$index]['acl']['qty']=$recv_yarn_arr[$row[csf("job_no")]]['qty'];
			$conv_yarn_arr[$index]['acl']['amount']=$recv_yarn_arr[$row[csf("job_no")]]['amt'];
		}
		//print_r($conv_yarn_arr);

		/* $sql="select x.*,(x.quantity*x.cons_rate) cons_amount from ( select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id, a.quantity,a.issue_purpose,a.returnable_qnty,a.is_sales,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type, c.cons_rate,d.issue_basis,d.booking_no,b.lot from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,wo_booking_mst e where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and d.booking_no=e.booking_no and a.trans_type in(2) and a.entry_form in(3) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and e.booking_type in(1,4) )x";
		$data_Yac=sql_select($sql);
		foreach($data_Yac as $row){
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}*/
		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		//echo $lot_tmp;
		$grey_fab_array=array();  //Knitting Cost actual
		$sql_knit_prod="select c.yarn_lot,
		 (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g  where a.id=c.mst_id and c.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.")   ";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			//$grey_fab_array[$row[csf("yarn_lot")]]['knit_grey_qty']+=$row[csf("grey_qnty")];
			//$grey_fab_array[$row[csf("yarn_lot")]]['knit_grey_amt']+=$row[csf("grey_qnty")]*$avg_rate;
			//echo $row[csf("grey_qnty")].'='.$avg_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
		//$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
	    // $sql_grey_trans="select c.from_order_id,a.from_prod_id,
		//  sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		//  sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		//   sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		//   sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		//   from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b where c.id=a.mst_id and a.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by  a.from_prod_id,c.from_order_id";//
		$sql_grey_trans="select c.FROM_ORDER_ID,a.FROM_PROD_ID,
		(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS GREY_IN,
		(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS GREY_OUT,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_IN_AMT,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_OUT_AMT
		 from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6)";//
	   $result_grey_trans=sql_select( $sql_grey_trans );
	   foreach ($result_grey_trans as $row)
	   {
		   $from_prod_id_array[$row[('FROM_PROD_ID')]]=$row[('FROM_PROD_ID')];
	   }
	   
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 2, $from_prod_id_array, $empty_arr);//Prod ID Ref from=3
		//disconnect($con);
		
		$avg_rate_array=return_library_array( "select b.id, b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=18", "id", "avg_rate_per_unit"  );

		$result_grey_trans=sql_select( $sql_grey_trans );
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			//$grey_fab_trans_array['gtt'][$row[csf('yarn_lot')]]+=$row[csf('grey_in')]-$row[csf('grey_out')];
			// $avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			// $from_order_id.=$row[csf('from_order_id')].',';
			// $grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			// //$grey_fab_trans_amt_acl+=($row[csf('grey_in')]-$row[csf('grey_out')])*$avg_rate;
			// $grey_fab_trans_amt_acl+=($row[csf('grey_in_amt')]-$row[csf('grey_out_amt')]);
			$avg_rate=$avg_rate_array[$row[('FROM_PROD_ID')]];
			$from_order_id.=$row[('FROM_ORDER_ID')].',';
			$grey_fab_trans_qty_acl+=$row[('GREY_IN')]-$row[('GREY_OUT')];
			//$grey_fab_trans_amt_acl+=($row[csf('grey_in')]-$row[csf('grey_out')])*$avg_rate;
			$grey_fab_trans_amt_acl+=($row[('GREY_IN_AMT')]-$row[('GREY_OUT_AMT')]);
		}
		//echo $grey_fab_trans_qty_acl.'='.$grey_fab_trans_amt_acl;
		$from_order_id=rtrim($from_order_id,',');
		$from_order_ids=array_unique(explode(",",$from_order_id));

		// $subconOutBillData="select b.order_id,
		// sum(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		// sum(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		// from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id in(".implode(",",$poIdArr).") group by b.order_id";
		// $subconOutBillDataArray=sql_select($subconOutBillData);
		// $tot_knit_charge=0;
		// foreach($subconOutBillDataArray as $subRow)
		// {
		// 	$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
		// 	//$subconCostArray[$subRow[csf('order_id')]]['dye_finish_bill']+=$subRow[csf('dye_finish_bill')]/$g_exchange_rate;
		// }
		$subconOutBillData="select b.order_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4)  ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
			//$subconCostArray[$subRow[csf('order_id')]]['dye_finish_bill']+=$subRow[csf('dye_finish_bill')]/$g_exchange_rate;
		}
		//echo $knit_grey_amt.'='.$tot_knit_charge.'='.$knit_grey_qty;
		//$grey_fab_cost=$knit_grey_amt+$tot_knit_charge;
		//$tot_grey_fab_cost_acl=($grey_fab_cost/$knit_grey_qty)*$grey_fab_trans_qty_acl;


		// Transfer Fin Actual
				$fin_fab_trans_array=array();
				//  $sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, sum(b.quantity) as qnty,
				// 	sum(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
				// 	sum(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
				//  c.from_order_id
				//   from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and c.transfer_criteria!=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by b.trans_type, b.po_breakdown_id,c.from_order_id,b.prod_id";
				$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
				(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
				(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
			 c.from_order_id
			  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and c.transfer_criteria!=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) ";
				$result_fin_trans=sql_select( $sql_fin_trans );
				$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
				foreach ($result_fin_trans as $row)
				{
					$fin_from_order_id.=$row[csf('from_order_id')].',';
					$avg_rate=$avg_rate_array[$row[csf('prod_id')]];

						$fin_in_qnty+=$row[csf('in_qty')];
						$fin_out_qnty+=$row[csf('out_qty')];

						$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
						$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;

					//echo $fin_in_qnty.'='.$fin_out_qnty.',';
					//$fin_fab_trans_qty+=$in_qnty-$out_qnty;
					//$fin_fab_trans_amt+=($in_qnty-$out_qnty)*$avg_rate;
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}

				$po_ids=implode(",",$poIdArr);
				unset($result_fin_trans);
				$fin_from_order_id=rtrim($fin_from_order_id,',');
				$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

				$fin_trans_in_qty=$fin_in_qnty;
				$fin_trans_out_qty=$fin_out_qnty;

				$fin_trans_in_amt=$fin_in_amt;
				$fin_trans_out_amt=$fin_out_amt;

			//	echo $fin_trans_in_amt.'AA'.$fin_trans_out_amt;

				$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
				$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

				$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
				$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;
				if($from_order_id!="") //Grey Transfer
				{
					 $knit_cost=$knit_qty=0;
					 foreach($from_order_ids as $po_id)
					 {
						$knit_cost+=array_sum($conversion_costing_arr_process[$po_id][1]);
						 $knit_qty+=array_sum($conversion_costing_arr_process_qty[$po_id][1]);
					 }
				}
				if($fin_from_order_id!="") //Finish Transfer
				{
					$condition2= new condition();
					$condition2->po_id("in($fin_from_order_id)");
					$condition2->init();
					$conversion2= new conversion($condition2);
					//echo $conversion2->getQuery(); die;
					$fin_conversion_costing_arr_process=$conversion2->getAmountArray_by_orderAndProcess();
					//print_r($fin_conversion_costing_arr_process);
					$conversion2= new conversion($condition2);
					$fin_conversion_costing_arr_process_qty=$conversion2->getQtyArray_by_orderAndProcess();
					 foreach($fin_from_order_ids as $po_id)
					 {
						 $tot_dye_finish_cost_pre=0;$tot_dye_finish_cost_pre_qty=0;
						foreach($conversion_cost_head_array as $process_id=>$val)
						{
							if($process_id!=30 && $process_id!=1 && $process_id!=35) //Yarn Dyeing,Knitting,Aop
							{
								$tot_dye_finish_cost_pre+=array_sum($fin_conversion_costing_arr_process[$po_id][$process_id]);

								$tot_dye_finish_cost_pre_qty+=array_sum($fin_conversion_costing_arr_process_qty[$po_id][$process_id]);
							}
						}
					 }
				}
				$knit_charge=$knit_cost/$knit_qty;

		if($quotationId){
			 $pq_conv_yarn_data="select a.composition,b.quotation_id,b.cost_head,b.charge_unit,
				(CASE WHEN b.cons_type=30 THEN b.amount END) AS yarn_dyeing_cost,
				(CASE WHEN b.cons_type=30 THEN  b.req_qnty END) AS req_qnty
				from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.id=b.cost_head and b.quotation_id =".$quotationId." and b.cons_type=30 and b.status_active=1  and b.is_deleted=0";
				$result_price_conv_yarn=sql_select($pq_conv_yarn_data);
				foreach($result_price_conv_yarn as $p_row)
				{
					$pri_yarnrate=$p_row[csf("charge_unit")];
					$index="".$p_row[csf("composition")]."";
					$mktcons=($p_row[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$amount=$mktcons*$pri_yarnrate;
					$conv_yarn_arr[$index]['mkt']['amount']+=$amount;
					$conv_yarn_arr[$index]['mkt']['qty']+=$mktcons;
				}
			}

		//print_r($YarnData);
		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
		$fabPurArr=array();
		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		if($quotationId){
			$totMktcons=0; $totMktAmt=0;
			$sql = "select id, item_number_id, body_part_id, fab_nature_id, color_type_id, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pri_quo_fabric_cost_dtls where quotation_id='".$quotationId."' and fabric_source=2";
			$data_fabPur=sql_select($sql);
			foreach($data_fabPur as $fabPur_row){
			//$mktcons=($fabPur_row[csf('avg_cons')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($fabPur_row[csf('avg_cons')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$fabPur_row[csf('rate')];
				if($fabPur_row[csf('fab_nature_id')]==2){
					$fabPurArr['mkt']['knit']['qty']+=$mktcons;
					$fabPurArr['mkt']['knit']['amount']+=$mktamt;
				}
				if($fabPur_row[csf('fab_nature_id')]==3){
					$fabPurArr['mkt']['woven']['qty']+=$mktcons;
					$fabPurArr['mkt']['woven']['amount']+=$mktamt;
				}
			}
		}

		// $sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=1 and a.fabric_source=2 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.booking_type=1 and a.fabric_source=2   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('item_category')]==2){
				$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
				if($fabPur_row[csf('grey_fab_qnty')]>0){
					$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
				}
			}
			if($fabPur_row[csf('item_category')]==3){
				$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
				if($fabPur_row[csf('grey_fab_qnty')]>0){
					$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
				}
			}
		}

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		//$knitData=array();
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		//$knitDesArr=array();
		// $sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process,c.id as po_id from wo_po_break_down c, wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  c.job_no_mst=a.job_no  and c.job_no_mst=b.job_no  and a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1";
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				//echo $knitQtyArr[$row_knit[csf('po_id')]][$row_knit[csf('cons_process')]].'=';
				$knitData[$index]['pre']['qty']+=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']+=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}

		}
		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type=1";
			$data_knit=sql_select($sql);
			foreach($data_knit as $row_knit){
				$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
				if($row_knit[csf('cons_type')]==1){
				//$mktcons=($row_knit[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
					$mktcons=($row_knit[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$row_knit[csf('charge_unit')];
					$knitData[$index]['mkt']['qty']+=$mktcons;
					$knitData[$index]['mkt']['amount']+=$mktamt;
				}
			}
		}

		// $sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}

		$sql = "select  b.delivery_qty,b.rate,b.amount,c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c ,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('delivery_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$finishData=array();
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process not in(1,2,30,35)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
		}
		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type not in(1,2,30,35)";
			$data_finish=sql_select($sql);
			foreach($data_finish as $row_finish){
				$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
				//$mktcons=($row_finish[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row_finish[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row_finish[csf('charge_unit')];
				$finishData[$index]['mkt']['qty']+=$mktcons;
				$finishData[$index]['mkt']['amount']+=$mktamt;
			}
		}
		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=4  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$aopData=array();
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$finishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$finishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}

		}

		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type=35";
			$data_aop=sql_select($sql);
			foreach($data_aop as $row_aop){
				$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
				if($row_aop[csf('cons_type')]==35){
				//$mktcons=($row_aop[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
					$mktcons=($row_aop[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$row_aop[csf('charge_unit')];
					$finishData[$index]['mkt']['qty']+=$mktcons;
					$finishData[$index]['mkt']['amount']+=$mktamt;
				}
			}
		}

		/*$sql = "select  b.batch_issue_qty, b.rate, b.amount, b.currency_id, b.exchange_rate,b.process_id from inv_receive_mas_batchroll a, pro_grey_batch_dtls b where a.id=b.mst_id and b.process_id=35 and b.job_no ='".$jobNumber."' and  b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			if($row_aop[csf('process_id')]==35){
				$exchange_rate=$row_aop[csf('batch_issue_qty')];
				if(!$exchange_rate){
					$exchange_rate=1;
				}
				$aopData['acl']['qty']+=$row_aop[csf('batch_issue_qty')];
				$aopData['acl']['amount']+=$row_aop[csf('amount')]/$exchange_rate;
			}
		}*/

		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g  where a.id=b.mst_id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=4 and b.sub_process_id in(31,35) a  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			//$index=$row_aop[csf('product_name_details')];
			//$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('febric_description_id')]."'";
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
		}

		// Fabric AOP  End============================



		// Trim Cost ============================

		//$trim_group=return_library_array( "select item_name,id from  lib_item_group", "id", "item_name" );
		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group  ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}
		//print_r($trim_groupArr);
		$trimData=array();
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();

		$trim= new trims($condition);
		//$trimAmtArr=$trim->getAmountArray_by_jobAndItemid();
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$jobNumber][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$jobNumber][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		if($quotationId){
			$sql = "select id,  trim_group, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active from wo_pri_quo_trim_cost_dtls  where quotation_id='".$quotationId."' and status_active=1";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$trimData[$row[csf('trim_group')]]['mkt']['qty']+=$mktcons;
				$trimData[$row[csf('trim_group')]]['mkt']['amount']+=$mktamt;
				$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
			}
		}
		$trimsRecArr=array();
		//echo "select b.po_breakdown_id, a.item_group_id,b.quantity as quantity,a.rate,a.cons_rate  from  inv_receive_master c,product_details_master d,inv_trims_entry_dtls a , order_wise_pro_details b where a.mst_id=c.id and a.trans_id=b.trans_id and a.prod_id=d.id and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ";
		/*$receive_qty_data=sql_select("select b.po_breakdown_id, a.item_group_id,b.quantity as quantity, a.rate, a.cons_rate
		from inv_receive_master c, product_details_master d, inv_trims_entry_dtls a, order_wise_pro_details b
		where a.mst_id=c.id and a.trans_id=b.trans_id and a.prod_id=d.id and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ");*/
		$receive_qty_data=sql_select("select b.po_breakdown_id, d.item_group_id, b.id as prop_id, b.quantity as quantity, a.order_rate as rate, a.cons_rate, a.payment_over_recv
		from inv_receive_master c, product_details_master d, inv_transaction a, order_wise_pro_details b,gbl_temp_engine g  
		where a.mst_id=c.id and a.id=b.trans_id and a.prod_id=d.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.transaction_type=1 and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ");
		foreach($receive_qty_data as $row)
		{
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['rate']=$row[csf('rate')];
			if($row[csf('payment_over_recv')] !=1)
			{
				$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			}
		}
		//print_r($trimsRecArr);
		$trimsRecReArr=array();
		$receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d,gbl_temp_engine g    where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and d.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  d.po_breakdown_id in(".implode(",",$poIdArr).")");
		foreach($receive_rtn_qty_data as $row){
			$trimsRecReArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecReArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];//$trimsRecArr[$row[csf('item_group_id')]]['rate'];
		}
		$sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		(CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		(CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		c.from_order_id
		from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.dtls_id and c.id=a.mst_id and d.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and b.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6)  ";
		$result_trim_trans=sql_select( $sql_trim_trans );
		$trim_in_qnty=$trim_out_qnty=$trim_in_amt=$trim_out_amt=0;
		foreach ($result_trim_trans as $row)
		{
			$trim_from_order_id.=$row[csf('from_order_id')].',';
			$rate=$row[csf('rate')];
			$con_factor=$trim_groupArr[$row[csf('item_group')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group')]]['in_qty']+=$row[csf('in_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['out_qty']+=$row[csf('out_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['in_amt']+=$row[csf('in_qty')]*$con_factor*$rate;
			$trimsRecArr[$row[csf('item_group')]]['out_amt']+=$row[csf('out_qty')]*$con_factor*$rate;
		}

		foreach($trimsRecArr as $ind=>$value){
			$trimData[$ind]['acl']['qty']+=($trimsRecArr[$ind]['qty']+$trimsRecArr[$ind]['in_qty'])-($trimsRecReArr[$ind]['qty']+$trimsRecArr[$ind]['out_qty']);
			$trimData[$ind]['acl']['amount']+=($trimsRecArr[$ind]['amount']+$trimsRecArr[$ind]['in_amt'])-($trimsRecReArr[$ind]['amount']+$trimsRecArr[$ind]['out_amt']);
			$trimData[$ind]['cons_uom']=$trimsRecArr[$ind]['cons_uom'];
		}

		//print_r($trimData);

		// Trim Cost End============================
		// Embl Cost ============================
		$embData=array();
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and emb_name !=3";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['pre']['qty']+=$embQtyArr[$jobNumber][$row[csf('id')]];
			$embData['pre']['amount']+=$embAmtArr[$jobNumber][$row[csf('id')]];
		}
		//print_r($embData);
		if($quotationId){
			$sql = "select id, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pri_quo_embe_cost_dtls where quotation_id='".$quotationId."' and emb_name !=3";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$embData['mkt']['qty']+=$mktcons;
				$embData['mkt']['amount']+=$mktamt;
			}
		}
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and b.emblishment_name !=3   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];

		}
		// Embl Cost End ============================
		// Wash Cost ============================
		$washData=array();
		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and emb_name =3";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['pre']['qty']+=$washQtyArr[$jobNumber][$row[csf('id')]];
			$washData['pre']['amount']+=$washAmtArr[$jobNumber][$row[csf('id')]];
		}
		if($quotationId){
			$sql = "select id, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pri_quo_embe_cost_dtls where quotation_id='".$quotationId."' and emb_name =3";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$washData['mkt']['qty']+=$mktcons;
				$washData['mkt']['amount']+=$mktamt;
			}
		}
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g  where a.booking_no=b.booking_no and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.booking_type=6 and b.emblishment_name =3   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}
		// Wash Cost End ============================
		// Commision Cost  ============================
		$commiData=array();
		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		if($quotationId){
			$sql = "select id,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pri_quo_commiss_cost_dtls  where quotation_id='".$quotationId."'";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktamt=($row[csf('commission_amount')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktamt=($row[csf('commission_amount')]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['qty']=$quaOfferQnty;
				$commiData['mkt']['amount']+=$mktamt;
				$commiData['mkt']['rate']+=$mktamt/$quaOfferQnty;
			}
		}
		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}

				$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;

			//echo $commaAmtArr[$jobNumber][$row[csf('id')]].'/'.$exfactory_qty;
		}
		if($quotationId){
			$sql = "select id, item_id, rate, amount, status_active from  wo_pri_quo_comarcial_cost_dtls where quotation_id=".$quotationId."";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktamt=($row[csf('amount')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktamt=($row[csf('amount')]/$quaCostingPerQty)*($quaOfferQnty);
				$commaData['mkt']['qty']=$quaOfferQnty;
				$commaData['mkt']['amount']+=$mktamt;
				$commaData['mkt']['rate']+=$mktamt/$quaOfferQnty;
			}
		}
		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$otherData=array();
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id ,lab_test ,inspection  ,cm_cost ,freight ,currier_pre_cost ,certificate_pre_cost ,common_oh ,depr_amor_pre_cost  from  wo_pre_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}
		if($quotationId){
			$sql = "select id ,lab_test ,inspection  ,cm_cost ,freight ,currier_pre_cost ,certificate_pre_cost ,common_oh ,depr_amor_pre_cost  from  wo_price_quotation_costing_mst where quotation_id='".$quotationId."'";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
				$freightAmt=($row[csf('freight')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['qty']=$quaOfferQnty;
				$otherData['mkt']['freight']['amount']=$freightAmt;
				$otherData['mkt']['freight']['rate']=$freightAmt/$quaOfferQnty;

				$labTestAmt=($row[csf('lab_test')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['qty']=$quaOfferQnty;
				$otherData['mkt']['lab_test']['amount']=$labTestAmt;
				$otherData['mkt']['lab_test']['rate']=$labTestAmt/$quaOfferQnty;

				$inspectionAmt=($row[csf('inspection')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['inspection']['qty']=$quaOfferQnty;
				$otherData['mkt']['inspection']['amount']=$inspectionAmt;
				$otherData['mkt']['inspection']['rate']=$inspectionAmt/$quaOfferQnty;

				$currierPreCostAmt=($row[csf('currier_pre_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['currier_pre_cost']['qty']=$quaOfferQnty;

				$otherData['mkt']['currier_pre_cost']['amount']=$currierPreCostAmt;
				$otherData['mkt']['currier_pre_cost']['rate']=$currierPreCostAmt/$quaOfferQnty;

				$cmCostAmt=($row[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['qty']=$quaOfferQnty;
				$otherData['mkt']['cm_cost']['amount']=$cmCostAmt;
				$otherData['mkt']['cm_cost']['rate']=$cmCostAmt/$quaOfferQnty;
			}
		}
		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0  order by id desc");
			foreach($sql_std_para as $row )
			{
				$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
				$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
				$diff=datediff('d',$applying_period_date,$applying_period_to_date);
				for($j=0;$j<$diff;$j++)
				{
					//$newDate=add_date(str_replace("'","",$applying_period_date),$j);
					$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);

					$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
					//$asking_profit_arr[$newDate]['max_profit']=$ask_row[csf('max_profit')];
				}
			}

	 $sql_cm_cost="select  jobNo, available_min,production_date from production_logicsoft where  jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			//$production_date=date("d-m-Y", strtotime($row[csf('production_date')]));

			$production_date=change_date_format($row[csf('production_date')],'','',1);

			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		// $sql="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where po_id in(".implode(",",$poIdArr).")";
		$sql="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  ";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['freight']['rate']=$row[csf('freight')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['lab_test']['rate']=$row[csf('lab_test')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['inspection']['rate']=$row[csf('inspection')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['currier_pre_cost']['rate']=$row[csf('currier_pre_cost')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['cm_cost']['rate']=$row[csf('cm_cost')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
		//$commaData['acl']['cm_cost']['rate']=$row[csf('cm_cost')];
			}
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."   and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con); 
		// Other Cost End ============================
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td> <td><p><? echo $team_leaders;?></p></td>
					<td>Dealing Marchant</td><td  colspan="2"><p><? echo $dealing_marchants;?> </p></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"> <? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right"  colspan="2"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>
			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px; margin-top:10px" rules="all">
				<thead>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="60">UOM</td>
						<td width="100">Marketing Qty</td>
						<td width="100">Marketing Price</td>
						<td width="100">Marketing Value</td>
						<td width="100">Pre-Cost Qty</td>
						<td width="100">Pre-Cost Price</td>
						<td width="100">Pre-Cost Value</td>
						<td width="100">Actual Qty</td>
						<td width="100">Actual Price</td>
						<td width="100">Actual Value</td>
					</tr>
				</thead>
				<tr style="font-weight:bold" class="yarn">
					<td colspan="12">Yarn including yarn dyed</td>
				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0;

				$yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0;

				$totalMktValue=0; $totalPreValue=0; $totalAclValue=0;

				$totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$y++;
				}

				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row ){
					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					$totalAclQty+=fn_number_format($yarn_acl_qty,4,".","");
					?>

				 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($yarn_acl_qty,4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
				<?
				$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Yarn Total</td>
					<td width="60"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalMktQty,4);
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalPreQty,4);
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalPreValue>$totalMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','1')"><? echo fn_number_format($totalAclQty,4); ?></A>
					</td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalAclValue>$totalPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalAclValue,4,".","");
						?>
					</td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="300" >Fabric Purchase Cost (Knit)</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['amount']/$fabPurArr['mkt']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="60">Yds</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['mkt']['knit']['amount'],4,".","");
						echo  fn_number_format($fabPurMkt,4);
						$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
						$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['pre']['knit']['amount'],4,".","");
						$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['acl']['knit']['amount'],4,".","");

						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="12">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0;
				$totalKnitPreValue=0;
				$totalKnitAclValue=0;

				$totalKniMktQty=0;
				$totalKnitPreQty=0;
				$totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=fn_number_format($row['acl']['qty'],4,".","");
				//$knitDesArr[$index]=$body_part[$row_knit[csf('body_part_id')]].", ".$color_type[$row_knit[csf('color_type_id')]].", ".$row_knit[csf('fabric_description')].", ".$row_knit[csf('gsm_weight')];
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="60"></td>
					<td width="100" align="right">
						<? echo fn_number_format($totalKniMktQty,4);?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<? echo fn_number_format($totalKniMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalKniMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalKnitPreQty,4);?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalKnitAclQty,4);?></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalKnitAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="dyfi">
					<td colspan="12">Dye , Fin & Aop Cost</td>
				</tr>
				<?
				$totalFinMktValue=0;
				$totalFinPreValue=0;
				$totalFinAclValue=0;

				$totalFinMktQty=0;
				$totalFinPreQty=0;
				$totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="dyfi" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish & AOP Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">
						<? echo fn_number_format($totalFinMktQty,4);?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" >
						<?
						echo fn_number_format($totalFinMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalFinMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"  bgcolor=" <? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="300" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['amount']/$aopData['mkt']['qty'],4)?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['amount'],4); //$GrandTotalMktValue+=fn_number_format($aopData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aopData['pre']['amount'],4,".","")>fn_number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($aopData['pre']['amount'],4); //$GrandTotalPreValue+=fn_number_format($aopData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aopData['acl']['amount'],4,".","")>fn_number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aopData['acl']['amount'],4); //$GrandTotalAclValue+=fn_number_format($aopData['acl']['amount'],4,".","");?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="12">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;//$tot_grey_fab_cost=($grey_fab_cost/$knit_grey_qty)*$grey_fab_trans_qty;;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_grey_fab_cost_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($tot_grey_fab_cost_acl,4); ?></A><? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
					</tr>

				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="60">Kg</td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_cost/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">

					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" >

					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">

					</td>
					<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="100"  align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl,4);
						$total_grey_fin_fab_transfer_actl_cost=$tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
				</tr>

				<tr>
					<td colspan="12" style="font-weight:bold">Trims Cost</td>
				</tr>
				<?
				$t=1;
				$totalTrimMktValue=0;
				$totalTrimPreValue=0;
				$totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					$item_descrition = $trim_groupArr[$index]['item_name'];
					$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$t++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Trims Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($embData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" >Wash Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($washData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($washData['pre']['amount'],4,".","")>fn_number_format($washData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($washData['pre']['amount'],4);$totalOtherPreValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($washData['acl']['amount'],4,".","")>fn_number_format($washData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($washData['acl']['amount'],4);$totalOtherAclValue+=fn_number_format($washData['acl']['amount'],4,".",""); ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commiData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right">
						<?
			//$aclCommiAmt=($commiData['pre']['rate']/($costPerQty*$totalSetQnty))*$exfactoryQty;
						$aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty;
			//echo "(".$commiData['pre']['rate']."/(".$costPerQty*$totalSetQnty."))*".$exfactoryQty;
						echo fn_number_format($aclCommiAmt/$exfactoryQty,4);

						?>
					</td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>">
						<?
						echo fn_number_format($aclCommiAmt,4);
						$totalOtherAclValue+=$aclCommiAmt;
						?>
					</td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commaData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($commer_act_cost,4); $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['freight']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><?
					$test_act_cost=$unitPrice*$exfactoryQty*(0.05/100);
					echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.05/100)" bgcolor="<? if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['inspection']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".",""))
					{
						$font_color="white";
					}
					else
					{
						$font_color="black";
					}
					?>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['cm_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=fn_number_format($otherData['acl']['cm_cost']['amount'],4,".",""); echo fn_number_format($otherData['acl']['cm_cost']['amount'],4);?></td>
					<!-- <a href="#report_details" style="color:<? //echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? //echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"></a> -->
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalOtherMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalOtherMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalOtherPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalOtherAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="60"></td>
					<td width="100" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="100" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo fn_number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="100" align="right">
						<?
						$quaOfferValue=$quaOfferQnty *$quaPriceWithCommnPcs;
						echo fn_number_format($quaOfferValue,4)
						?>
					</td>
					<td width="100" align="right"><? echo $jobQty ?></td>
					<td width="100" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>
					<td width="120">
                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>
						    <div style="float:left;width:120px" >
							<?
							foreach($nameArray_img AS $inf) {
								?>
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
							    <?
							}
							?>
							</div>
						<?
					}
					else echo ""; ?>
                    </td>
				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr><td colspan="8"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}

	else if(str_replace("'","",$cbo_costcontrol_source)==3)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("select a.job_no from wo_po_details_master a,wo_pre_cost_mst f where a.id=f.job_id and a.company_name=$company_name and f.entry_from=158 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row) {
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
			$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and  a.id=c.job_id and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			//echo $sql;
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus=""; $ref_no="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();
		$job_no_arr=array();
		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$jobIdArr[$row[csf('job_id')]]=$row[csf('job_id')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';	$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
			array_push($job_no_arr, $row[csf('job_no')]);
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and  ENTRY_FORM=18");
		oci_commit($con);
		 
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//Po id Ref from=1
		//disconnect($con);


		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
		(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
		(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
		from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
	foreach($exfactory_data as $exfatory_row){
		$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
	}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		//echo $costPerQty.'m';die;
		if ($costPerQty>1) $costPerUom=($costPerQty/12)." Dzn";
		else $costPerUom=($costPerQty/1)." Pcs";

		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array();
		$washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/*echo "<pre>";
		print_r($YarnData); die;*/

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group where status_active=1 and is_deleted=0 ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}

		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			$sqlQc="select a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.qc_no =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
			}
			unset($dataQc);
			//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$quotationId." order by id asc";
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1)
				{
					if($rowConsRate[csf("rate_data")]!="")
					{
						$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];
						//echo $edata[3].'='.$edata[7].'='.$edata[11].'='.$rowConsRate[csf("tot_cons")].'='.$quaOfferQnty.'<br>';
						if($rowConsRate[csf("rate_data")]!="")
						{
							$qYarnData[$index]['mkt']['qty']+=$consQnty;
							$qYarnData[$index]['mkt']['amount']+=$amount;
						}

						/*$index=""; $mktcons=$mktamt=0;
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;*/

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[14];
						$knitData[$index]['mkt']['qty']+=$mktcons;
						$knitData[$index]['mkt']['amount']+=$mktamt;

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$rate=0;
						$rate=$edata[15]+$edata[16]+$edata[17];
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rate;
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;

						/*$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[16];
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;*/
					}
					else
					{
						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						//echo $mktcons.'-'.$mktamt.'-'.$rowConsRate[csf('tot_cons')].'-'.$quaCostingPerQty.'-'.$quaOfferQnty.'<br>';
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;
					}
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$washData['mkt']['qty']+=$mktcons;
					$washData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]!=3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['qty']+=$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['amount']+=$mktamt;
					$trimData[$rowConsRate[csf('particular_type_id')]]['cons_uom']=$rowConsRate[csf('cons_uom')];
				}
			}
			/*echo "<pre>";
			print_r($trimData);
			die;*/

			$sql_item_summ="select mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$quotationId." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}



	 	//print_r($qYarnData);
		//and a.receive_purpose in(7,12,15,38,46,50,51)
		$yarn_recv="select a.id as receive_id, a.booking_no,a.currency_id,a.receive_purpose,b.job_no,b.cons_amount,b.dye_charge,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a, inv_transaction b, product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1   and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
	 	$yarn_recv_res =sql_select($yarn_recv);

		$yarn_typeArr=array(7,12,15,38,46,50,51);
		foreach ($yarn_recv_res as $row)
		{
			$receive_purpose_id=$row[csf("receive_purpose")];
			$currency_id=$row[csf("currency_id")];
			$dye_charge=$row[csf("dye_charge")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			if($receive_purpose_id ==2)
			{
				$YarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
				$YarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
				$YarnRecv_arr[$index]['currency_id']=$currency_id;
				$dyedYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
			}
			else
			{
				if(in_array($receive_purpose_id,$yarn_typeArr))
				{
					$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
					$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
					if($row[csf("dye_charge")]>0)
					{
						$recv_yarn_rate_arr[$row[csf("job_no")]]['rate']=$dye_charge;
					}

					$SYarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
					$SYarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
					$SYarnRecv_arr[$index]['currency_id']=$currency_id;
					$SYarnRecv_arr[$index]['dye_charge']=$dye_charge;
					$serviceYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
				}
			}
		}
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 2, $dyedYarnRecv_arr, $empty_arr);//Recv ID Ref from=2
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 3, $serviceYarnRecv_arr, $empty_arr);//Service Recv ID Ref from=3
	    //echo '<pre>';print_r($serviceYarnRecv_arr);die;

	    // DYarn receive return
		// $Dyarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		// from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d
		// where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id and c.transaction_type in(3) and c.item_category=1 and a.id in(".implode(",",$dyedYarnRecv_arr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Dyarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d,gbl_temp_engine g
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=2 and g.entry_form=18  and c.transaction_type in(3) and c.item_category=1   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Dyarn_recv_return_res=sql_select($Dyarn_recv_return);

		$DYarnReceiveReturn_arr = array();
		foreach ($Dyarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$DYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$DYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}
		//echo '<pre>';print_r($DYarnReceiveReturn_arr);die;

		// SYarn receive return
		// $Syarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		// from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d
		// where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id and c.transaction_type in(3) and c.item_category=1 and a.id in(".implode(",",$serviceYarnRecv_arr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Syarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d,gbl_temp_engine g
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18   and c.transaction_type in(3) and c.item_category=1  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Syarn_recv_return_res=sql_select($Syarn_recv_return);

		$SYarnReceiveReturn_arr = array();
		foreach ($Syarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$SYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$SYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}


			$YarnIssue=array();
	    //print_r($YarnIssueReturn);
		// $issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no,d.id as issue_id from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3  and d.entry_form=3 and a.po_breakdown_id in(".implode(",",$poIdArr).") and d.issue_purpose not in(8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");
		$issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no,d.id as issue_id from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id  and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.trans_type=2 and a.entry_form=3  and d.entry_form=3   and d.issue_purpose not in(8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");


		$issue_arr = $booking_req=$DYarnIssue = array();
		foreach ($issue_details as $row)
		{
			$issue_id_str.=$row[csf("issue_id")].",";
			$dyed_type=$row[csf("dyed_type")];
			$issue_purpose_id=$row[csf("issue_purpose")];
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if($issue_purpose_id==2) //Gery Yarn- for Dyed Yarn
			{
				$DYarnIssue[$index]['qty']+=$row[csf("quantity")];
				$DYarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			}
			else if(($issue_purpose_id==1 || $issue_purpose_id==4) && $dyed_type!=1) //Grey for knitting,Sample with
			{
				$YarnIssue[$index]['qty']+=$row[csf("quantity")];
				$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			}
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}

		$issue_ids = chop($issue_id_str,",");
		$issue_id_string=where_con_using_array(array_unique(explode(",",$issue_ids)),0,"c.issue_id");
		$issue_idsArr=array_unique(explode(",",$issue_ids));
		//$issue_id_string = implode(",",array_unique(explode(",",$issue_ids)));

		//echo '<pre>';print_r($DYarnReceiveReturn_arr);die;
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 4, $issue_idsArr, $empty_arr);//Issue ID Ref from=10

		if($issue_ids !="")
		{
			// $issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,c.receive_basis, b.dyed_type from order_wise_pro_details a, product_details_master b,inv_transaction c where a.prod_id=b.id and a.trans_id=c.id and a.trans_type in(4) and a.entry_form in(9) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 $issue_id_string ");
			$issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,c.receive_basis, b.dyed_type from order_wise_pro_details a, product_details_master b,inv_transaction c,gbl_temp_engine g,gbl_temp_engine gg where a.prod_id=b.id and a.trans_id=c.id  and a.po_breakdown_id=g.ref_val  and c.issue_id=gg.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and gg.user_id = ".$user_id." and gg.ref_from=4 and gg.entry_form=18  and a.trans_type in(4) and a.entry_form in(9)   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1  ");


			$YarnIssueReturn = $booking_req_return = array();
			foreach ($issue_return as $row)
			{
				$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
				if ($row[csf("dyed_type")] != 1){
					$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
					$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
				}
			}
		}

	    //print_r($DYarnIssue);
		foreach($YarnIssue as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'A';
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
		}
		foreach($YarnRecv_arr as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'b';
			$currency_id=$value['currency_id'];
			$DYarnData[$ind]['acl']['qty']+=($value['qty']-$DYarnReceiveReturn_arr[$ind]['qty']);
			if($currency_id==1) //TK
			{
				$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt'])/$g_exchange_rate;
			}
			else
			{
			 	$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt']);
			}
		}

		$job_no_cond=where_con_using_array(array_unique($job_no_arr),1,"b.job_no");
		 
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 5, $jobIdArr, $empty_arr);//Job id Ref from=5

		$sql_dy="SELECT
				       a.qnty,
				       c.yarn_count_id,
				       c.yarn_comp_type1st,
				       c.yarn_comp_percent1st,
				       c.yarn_type,
				       (a.qnty*c.avg_rate_per_unit) as amt
				  FROM inv_material_allocation_mst a,
				       wo_po_details_master b,
				       product_details_master c,
				       wo_booking_mst d,gbl_temp_engine g
				 WHERE a.job_no = b.job_no
				 	   and a.booking_no = d.booking_no
					    and b.id=g.ref_val   and g.user_id = ".$user_id." and g.ref_from =5 and g.entry_form=18
				       
				       and a.item_id = c.id
				       and a.is_dyied_yarn = 1
				       and a.qnty > 0
				       and a.status_active = 1
				       and a.is_deleted = 0
				       and b.status_active = 1
				       and b.is_deleted = 0
				       and c.status_active = 1
				       and c.is_deleted = 0
				       and a.entry_form in (0,1)
				       ";
	    //echo $sql_dy;
	    $res_dy=sql_select($sql_dy);

	    $data_dried_yarn=array();

		foreach ($res_dy as $row)
		{


			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			$data_dried_yarn[$index]['qty']+=$row[csf("qnty")];
			$data_dried_yarn[$index]['amt']+=$row[csf("amt")];
		}
		$dried_yarn_data_arr=array();
		foreach ($data_dried_yarn as $index => $value) {
			$dried_yarn_data_arr[$index]['acl']['qty']+=$value['qty'];
			$dried_yarn_data_arr[$index]['acl']['amount']+=($value['amt'])/$g_exchange_rate;

		}

		//print_r($DYarnData);
						//print_r($qYarnData);
	 	//	$yarn_recv =sql_select("select a.booking_no,b.job_no,b.cons_amount,b.dye_charge,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a,inv_transaction b,product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");

		$issue_details_yarn_service = sql_select("select d.id as prod_id,e.currency,f.cons_quantity as cons_quantity,c.dyeing_charge as dye_charge,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(c.amount) as service_amount,d.booking_no from inv_transaction f,product_details_master b,wo_yarn_dyeing_dtls c,inv_receive_master d,wo_yarn_dyeing_mst e where f.prod_id=b.id  and f.mst_id=d.id  and e.id=c.mst_id
		 and d.booking_id=e.id and d.entry_form=1  and  c.job_no ='".$jobNumber."' and d.receive_purpose in(7,12,15,38,46,50,51)   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1 order by b.id");

		$yarn_service_arr = array();
		foreach ($issue_details_yarn_service as $row)
		{
			$dyed_type=$row[csf("dyed_type")];
			$currency=$row[csf("currency")];
			$yarn_service_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			//	$recv_yarn_rate=$recv_yarn_rate_arr[$jobNumber]['rate'];
			$ServiceYarnIssue[$index]['qty']+=$row[csf("cons_quantity")];
			if($currency==1) //Tk
			{
				$ServiceYarnIssue[$index]['amount']+=($row[csf("cons_quantity")]*$row[csf("dye_charge")])/$g_exchange_rate;
			}
			else
			{
				$ServiceYarnIssue[$index]['amount']+=$row[csf("cons_quantity")]*$row[csf("dye_charge")];

			}
		}

	    //	print_r($SYarnRecv_arr);die;
		foreach($SYarnRecv_arr as $ind=>$value){
			$currency_id=$value['currency_id'];
			$SYarnData[$ind]['acl']['qty']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty']);
			if( $currency_id==1)
			{
				$SYarnData[$ind]['acl']['amount']+=(($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"])/$g_exchange_rate;
			}
			else
			{
				$SYarnData[$ind]['acl']['amount']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"];

			}
		}

		/*echo "<pre>";
		print_r($SYarnData); */

		$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();

		// $sql_conv_yarn="select b.id as po_id, c.job_no, c.id as conv_id,c.cons_process, d.fabric_description,d.composition from wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d  where  b.job_no_mst=c.job_no and c.job_no=d.job_no  and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(153,134,30) and b.is_deleted=0 and b.id in(".implode(",",$poIdArr).") and c.amount>0 ";
		$sql_conv_yarn="select b.id as po_id, c.job_no, c.id as conv_id,c.cons_process, d.fabric_description,d.composition from wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d, gbl_temp_engine g  where  b.job_id=c.job_id and c.job_id=d.job_id  and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(153,134,30) and b.is_deleted=0   and c.amount>0 "; 
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$cons_process=$row[csf("cons_process")];
			$index="".$row[csf("composition")]."";
			$desc="".$row[csf("fabric_description")]."";
			if($cons_process==30)
			{
				$index="".$row[csf("fabric_description")]."";
				$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
				$conv_yarn_arr[$index]['acl']['qty']=$YarnRecv_arr[$row[csf("job_no")]]['qty'];
				$conv_yarn_arr[$index]['acl']['amount']=$YarnRecv_arr[$row[csf("job_no")]]['amt'];
			}
			else
			{
				//echo $index="".$row[csf("composition")]."";
				//$SYarnData[$ind]['pre']['qty']+=$value['qty'];
				$ServiceYarnConv[$desc]['amount']+=array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$ServiceYarnConv[$desc]['qty']+=array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			}
		}

		foreach($ServiceYarnConv as $ind=>$value) {
			$SYarnData[$ind]['pre']['qty']+=$value['qty'];
			$SYarnData[$ind]['pre']['amount']+=$value['amount'];
		}
		//print_r($SYarnData);

		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		//echo $lot_tmp;
		$grey_fab_array=array();  //Knitting Cost actual
		// $sql_knit_prod="select c.yarn_lot,
		//  sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		//   from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.") and b.po_breakdown_id in(".implode(",",$poIdArr).") group by c.yarn_lot";
		$sql_knit_prod="select c.yarn_lot,
		(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		 from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g where a.id=c.mst_id and c.id=b.dtls_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.")  ";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
		//$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );
		// $sql_prod=sql_select("select id, avg_rate_per_unit,product_name_details from product_details_master");
		// foreach($sql_prod as $row){
		// 	$avg_rate_array[$row[csf("id")]]=$row[csf("avg_rate_per_unit")];
		// 	$desc_array[$row[csf("id")]]=$row[csf("product_name_details")];
		// }

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		// $grey_fab_trans_array=array();
		// $sql_grey_trans="select c.from_order_id, a.from_prod_id,
		// sum(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		// sum(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		// sum(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		// sum(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		// from inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b where c.id=a.mst_id and a.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,82,183,110,13) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by  a.from_prod_id,c.from_order_id";//
		$sql_grey_trans="select c.from_order_id, a.from_prod_id, 
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		from inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,82,183,110,13) and b.trans_type in(5,6)";
		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_idarr[$row[csf('from_prod_id')]]=$row[csf('from_prod_id')];
		}
		 
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 6, $from_prod_idarr, $empty_arr);//Prod ID Ref from=6

		$sql_prod=sql_select("select b.id, b.product_name_details,b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=6 and g.entry_form=18");
		foreach($sql_prod as $row){
			$avg_rate_array[$row[csf("id")]]=$row[csf("avg_rate_per_unit")];
			$desc_array[$row[csf("id")]]=$row[csf("product_name_details")];
		}

		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			$grey_in_amt=$row[csf('grey_in')]*$avg_rate;
			$grey_out_amt=$row[csf('grey_out')]*$avg_rate;
			$from_order_id.=$row[csf('from_order_id')].',';
			$grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$grey_fab_trans_amt_acl+=$grey_in_amt-$grey_out_amt;

		}
		$from_order_id=rtrim($from_order_id,',');
		//$transferIn_order_ids=implode(',',array_flip(array_flip(explode(",",rtrim($transferIn_order_id,',')))));
		$from_order_ids=array_unique(explode(",",$from_order_id));

		/*$condition5= new condition();
		if(str_replace("'","",$job) !=''){
			$condition5->job_no("=$job");
		}
		$condition5->init();
		$conversion5= new conversion($condition5);
		$conversion_costing_arr_jobProcess_amt=$conversion5->getAmountArray_by_jobAndConversionid();
		$conversion5= new conversion($condition5);
		$conversion_costing_arr_jobProcess_qty=$conversion5->getQtyArray_by_jobAndConversionid();
		//$tot_gray_cost_pre=0;$tot_dye_finish_cost_pre_qty=0;
		foreach($conversion_cost_head_array as $process_id=>$val)
		{
			if($process_id==1) //Knitting
			{
				$tot_gray_costQty_jobwise_pre+=array_sum($conversion_costing_arr_jobProcess_qty[$job][$process_id]);
				$tot_gray_costAmt_jobwise_pre+=array_sum($conversion_costing_arr_jobProcess_amt[$job][$process_id]);
			}
		}
		echo $tot_gray_costQty_jobwise_pre.'**'.$tot_gray_costAmt_jobwise_pre;*/



		// $subconOutBillData="select b.order_id,b.currency_id,
		// sum(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		// sum(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		// from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id in(".implode(",",$poIdArr).") group by b.currency_id,b.order_id";
		$subconOutBillData="select b.order_id,b.currency_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4)  ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			if($subRow[csf('knit_bill')]>0 && $subRow[csf('currency_id')]==1)
			{
				$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
			}
			else
			{
				$tot_knit_charge+=$subRow[csf('knit_bill')];
			}
		}

		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		// $sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, sum(b.quantity) as qnty,
		// 	sum(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		// 	sum(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		//  c.from_order_id
		//   from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and c.transfer_criteria!=2 and b.is_deleted=0 and b.entry_form in(15,14,306) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by b.trans_type, b.po_breakdown_id,c.from_order_id,b.prod_id";
		$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
			(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
			(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		 c.from_order_id
		  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and c.transfer_criteria!=2 and b.is_deleted=0 and b.entry_form in(15,14,306) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6)";
		  /*$sql_fin_trans="select c.trans_type, c.po_breakdown_id,c.prod_id, sum(c.quantity) as qnty,
			sum(CASE WHEN c.trans_type=5 THEN c.quantity END) AS in_qty,
			sum(CASE WHEN c.trans_type=6 THEN c.quantity END) AS out_qty,
		    a.from_order_id
		  from inv_item_transfer_mst a, inv_item_transfer_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.entry_form in(15,14,306) and a.item_category=2 and c.trans_type in(5,6) and c.po_breakdown_id in(".implode(",",$poIdArr).") group by c.trans_type, c.po_breakdown_id,a.from_order_id,c.prod_id";*/
		$result_fin_trans=sql_select( $sql_fin_trans );
		$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
		foreach ($result_fin_trans as $row)
		{
			$fin_from_order_id.=$row[csf('from_order_id')].',';

			$avg_rate=$avg_rate_array[$row[csf('prod_id')]];
			$fin_in_qnty+=$row[csf('in_qty')];
			$fin_out_qnty+=$row[csf('out_qty')];

			$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
			$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;
		}

		$po_ids=implode(",",$poIdArr);
		unset($result_fin_trans);
		$fin_from_order_id=rtrim($fin_from_order_id,',');
		$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

		$fin_trans_in_qty=$fin_in_qnty;
		$fin_trans_out_qty=$fin_out_qnty;

		$fin_trans_in_amt=$fin_in_amt;
		$fin_trans_out_amt=$fin_out_amt;

	    //	echo $fin_trans_in_amt.'AA'.$fin_trans_out_amt;

		$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
		$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

		$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
		$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;

		
		/*if($from_order_id!="") //Grey Transfer
		{
			 $knit_cost=$knit_qty=0;
			 foreach($from_order_ids as $po_id)
			 {
				$knit_cost+=array_sum($conversion_costing_arr_process[$po_id][1]);
				$knit_qty+=array_sum($conversion_costing_arr_process_qty[$po_id][1]);
			 }
		}
        */
		/*if($fin_from_order_id!="") //Finish Transfer
		{
			$condition2= new condition();
			$condition2->po_id("in($fin_from_order_id)");
			$condition2->init();
			$conversion2= new conversion($condition2);
			//echo $conversion2->getQuery(); die;
			$fin_conversion_costing_arr_process=$conversion2->getAmountArray_by_orderAndProcess();
			//print_r($fin_conversion_costing_arr_process);
			$conversion2= new conversion($condition2);
			$fin_conversion_costing_arr_process_qty=$conversion2->getQtyArray_by_orderAndProcess();
			 foreach($fin_from_order_ids as $po_id)
			 {
				$tot_dye_finish_cost_pre=0;$tot_dye_finish_cost_pre_qty=0;
				foreach($conversion_cost_head_array as $process_id=>$val)
				{
					if($process_id!=30 && $process_id!=1 && $process_id!=35) //Yarn Dyeing,Knitting,Aop
					{
						$tot_dye_finish_cost_pre+=array_sum($fin_conversion_costing_arr_process[$po_id][$process_id]);

						$tot_dye_finish_cost_pre_qty+=array_sum($fin_conversion_costing_arr_process_qty[$po_id][$process_id]);
					}
				}
			 }
		}
		$knit_charge=$knit_cost/$knit_qty;*/
		$job=str_replace("'","",$job);
		$jobWise_yarn_qty=0;
		$jobWise_yarn_amt=0;
		$sql_jobWise_yarn=sql_select("select JOB_NO, CONS_QNTY, AMOUNT from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_yarn as $val) {
			$jobWise_yarn_qty += $val['CONS_QNTY'];
			$jobWise_yarn_amt += $val['AMOUNT'];
		}
		$per_kg_yarn=$jobWise_yarn_amt/$jobWise_yarn_qty;

		$gray_conversion_costing_process_qty=0;
		$gray_conversion_costing_process_amt=0;
		$finish_conversion_costing_process_qty=0;
		$finish_conversion_costing_process_amt=0;

		$sql_jobWise_conversion=sql_select("select JOB_NO, CONS_PROCESS, REQ_QNTY, AMOUNT from wo_pre_cost_fab_conv_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_conversion as $val) {
			if ($val['CONS_PROCESS']==1){
				$gray_conversion_costing_process_qty += $val['REQ_QNTY'];
				$gray_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if($val['CONS_PROCESS'] !=30 && $val['CONS_PROCESS'] !=1  && $val['CONS_PROCESS'] !=35 && $val['CONS_PROCESS'] !=134) {
				$finish_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if ($val['CONS_PROCESS'] ==31) $finish_conversion_costing_process_qty += $val['REQ_QNTY'];
		}
		$gray_charge_unit = $gray_conversion_costing_process_amt/$gray_conversion_costing_process_qty;
		$finish_charge_unit = $finish_conversion_costing_process_amt/$finish_conversion_costing_process_qty;
		//echo $gray_conversion_costing_process_qty.'**'.$gray_conversion_costing_process_amt.'**'.$finish_conversion_costing_process_qty.'**'.$finish_conversion_costing_process_amt.'**'.$jobWise_yarn_qty.'**'.$jobWise_yarn_amt;
		$gray_transfer_amount=$grey_fab_trans_qty_acl*$per_kg_yarn+$grey_fab_trans_qty_acl*$gray_charge_unit;

		$finish_transfer_amount=$tot_fin_fab_transfer_qty*$per_kg_yarn+$tot_fin_fab_transfer_qty*$gray_charge_unit+$tot_fin_fab_transfer_qty*$finish_charge_unit;
		//echo $gray_transfer_amount.'**'.$finish_transfer_amount;


		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		// $sql = "select a.item_category, a.booking_type, a.exchange_rate,a.fabric_source, b.trim_group,b.wo_qnty,b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount, b.uom as cons_uom from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no  and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category, a.booking_type, a.exchange_rate,a.fabric_source, b.trim_group,b.wo_qnty,b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount, b.uom as cons_uom from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no   and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_fabPur=sql_select($sql);//and a.booking_type=1 and a.fabric_source=2
		foreach($data_fabPur as $fabPur_row){
			$booking_type=$fabPur_row[csf('booking_type')];$fabric_source=$fabPur_row[csf('fabric_source')];
			if($booking_type==1 && $fabric_source==2) //Purchase and Fabric
			{
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('fin_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('fin_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}
			else //Trims
			{
				if($fabPur_row[csf('item_category')]==4){
					$rate=$fabPur_row[csf('rate')];
					$con_factor=$trim_groupArr[$fabPur_row[csf('trim_group')]]['con_factor'];
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['qty']+=$fabPur_row[csf('wo_qnty')]*$con_factor;
					//$trimsRecArr[$row[csf('trim_group')]]['out_qty']+=$row[csf('wo_qnty')]*$con_factor;
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['amt']+=$fabPur_row[csf('wo_qnty')]*$con_factor*$rate;
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['cons_uom']=$fabPur_row[csf('cons_uom')];
					//	$trimsRecArr[$row[csf('trim_group')]]['out_amt']+=$row[csf('wo_qnty')]*$con_factor*$rate;
				}

			}
		}
		//echo '<pre>';print_r($trimsRecArr);die;

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				$knitData[$index]['pre']['qty']=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}
		}

		// $sql = "select b.receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select b.receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];

			}
		}
		//
		//  $sql_in = "select b.delivery_qty as receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and a.party_source=1 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql_in = "select b.delivery_qty as receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=2 and a.party_source=1  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit_in=sql_select($sql_in);
		foreach($data_knit_in as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];
			}
		}

		/*$sql = "select  b.delivery_qty, b.rate, b.amount, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('delivery_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}*/
		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.id=b.job_id and a.id=b.fabric_description and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_no='".$jobNumber."' and b.cons_process not in(1,2,134,30,35,153)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']+=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']+=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['process_name'].=$conversion_cost_head_array[$row_finish[csf('cons_process')]].',';
		}
		//echo '<pre>';print_r($finishData);

		/*
		$sql = "select  b.receive_qty,b.rate,b.amount,b.currency_id,c.product_name_details, a.process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=4 and b.order_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$currency_id=$row_finish[csf('currency_id')];
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
			}
			else//usd
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')];
			}
			//$finishData[$index]['process_name'].=$conversion_cost_head_array[$row_finish[csf('process_id')]].',';
		}
		*/

		// $sql_fin_in = "select  b.delivery_qty as receive_qty,b.rate,b.amount,b.currency_id,c.product_name_details, a.process_id from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=4 and b.order_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql_fin_in = "select  b.delivery_qty as receive_qty,b.rate,b.amount,b.currency_id,c.product_name_details, a.process_id from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=4   and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish_in=sql_select($sql_fin_in);
		foreach($data_finish_in as $row_finish){
			$currency_id=$row_finish[csf('currency_id')];
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
			}
			else//usd
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')];
			}
			//$finishData[$index]['process_name'].=$conversion_cost_head_array[$row_finish[csf('process_id')]].',';
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.id=b.job_id and a.id=b.fabric_description and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$AopfinishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}
		}


		/*$sql = "select  b.batch_issue_qty, b.rate, b.amount, b.currency_id,b.prod_id,b.body_part_id, b.febric_description_id, b.gsm, b.exchange_rate,b.process_id from inv_receive_mas_batchroll a, pro_grey_batch_dtls b where a.id=b.mst_id and b.process_id=35 and b.job_no ='".$jobNumber."' and  b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			 $desc=$desc_array[$row_aop[csf("prod_id")]];
			$index="'".$row_aop[csf('body_part_id')]."_".$desc."_".$row_aop[csf('gsm')]."'";
			if($row_aop[csf('process_id')]==35){
				$exchange_rate=$row_aop[csf('batch_issue_qty')];
				if(!$exchange_rate) $exchange_rate=1;
				//$aopData['acl']['qty']+=$row_aop[csf('batch_issue_qty')];
				//$aopData['acl']['amount']+=$row_aop[csf('amount')]/$exchange_rate;

				$AopfinishData[$index]['acl']['qty']+=$row_aop[csf('batch_issue_qty')];
				$AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$exchange_rate;

			}
		}*/

		/*$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id  and a.process_id=4 and b.sub_process_id in(31,35) and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$sub_process_id=$row_aop[csf('sub_process_id')];
			$currency_id=$row_aop[csf('currency_id')];
			$index="'".$row_aop[csf('body_part_id')]."'";
			if($sub_process_id==35)
			{
				$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
				if($currency_id==1)
				{
					$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
				}
				else
				{
					$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')];
				}

				//$finishData[$index]['process_name'].=$conversion_cost_head_array[$sub_process_id].',';
			}
			else
			{
			//$AopfinishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
				if($currency_id==1)
				{
				//$AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
				}
				else
				{
				//$AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')];
				}
			}
		}
		*/

		// $sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id  and a.process_id=4  and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.process_id=4  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop)
		{
			$sub_process_id=$row_aop[csf('sub_process_id')];
			$currency_id=$row_aop[csf('currency_id')];
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
			}
			else
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')];
			}
		}

		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		//echo '<pre>';print_r($trimData);die;

		//$trimsRecArr=array();
		/*$receive_qty_data=sql_select("select b.po_breakdown_id, a.item_group_id,b.quantity as quantity,b.order_rate as rate,a.cons_rate  from  inv_receive_master c,product_details_master d,inv_trims_entry_dtls a , order_wise_pro_details b where a.mst_id=c.id and a.trans_id=b.trans_id and a.prod_id=d.id and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ");
		foreach($receive_qty_data as $row){
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['rate']=$row[csf('rate')];
			$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			$trimsRecArr[$row[csf('item_group_id')]]['cons_uom']=$trim_groupArr[$row[csf('item_group_id')]]['cons_uom'];
		}
		$receive_qty_data=sql_select("select b.po_breakdown_id, d.item_group_id, b.id as prop_id, b.quantity as quantity, a.order_rate as rate, a.cons_rate, a.payment_over_recv
		from inv_receive_master c, product_details_master d, inv_transaction a, order_wise_pro_details b
		where a.mst_id=c.id and a.id=b.trans_id and a.prod_id=d.id and a.transaction_type=1 and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ");
		foreach($receive_qty_data as $row)
		{
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['rate']=$row[csf('rate')];
			if($row[csf('payment_over_recv')] !=1)
			{
				$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			}
			$trimsRecArr[$row[csf('item_group_id')]]['cons_uom']=$trim_groupArr[$row[csf('item_group_id')]]['cons_uom'];
		}
		//echo "<pre>"; print_r($trimsRecArr);die;
		$trimsRecReArr=array();
		$receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d  where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  d.po_breakdown_id in(".implode(",",$poIdArr).")");
		foreach($receive_rtn_qty_data as $row){
			$trimsRecReArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecReArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
		}
		$sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		(CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		(CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		c.from_order_id
		from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.dtls_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") ";
		$result_trim_trans=sql_select( $sql_trim_trans );
		$trim_in_qnty=$trim_out_qnty=$trim_in_amt=$trim_out_amt=0;

		{
			$trim_from_order_id.=$row[csf('from_order_id')].',';
			$rate=$row[csf('rate')];
			$con_factor=$trim_groupArr[$row[csf('item_group')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group')]]['in_qty']+=$row[csf('in_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['out_qty']+=$row[csf('out_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['in_amt']+=$row[csf('in_qty')]*$con_factor*$rate;
			$trimsRecArr[$row[csf('item_group')]]['out_amt']+=$row[csf('out_qty')]*$con_factor*$rate;
		}

		foreach($trimsRecArr as $ind=>$value){
			$trimData[$ind]['acl']['qty']+=($trimsRecArr[$ind]['qty']+$trimsRecArr[$ind]['in_qty'])-($trimsRecReArr[$ind]['qty']+$trimsRecArr[$ind]['out_qty']);
			$trimData[$ind]['acl']['amount']+=($trimsRecArr[$ind]['amount']+$trimsRecArr[$ind]['in_amt'])-($trimsRecReArr[$ind]['amount']+$trimsRecArr[$ind]['out_amt']);
			$trimData[$ind]['cons_uom']=$trimsRecArr[$ind]['cons_uom'];
		}*/
		foreach($trimsRecArr as $ind=>$value){
			//echo $value['amt'].',';
			$trimData[$ind]['acl']['qty']+=$value['qty'];
			$trimData[$ind]['acl']['amount']+=$value['amt'];
			$trimData[$ind]['cons_uom']=$value['cons_uom'];
			$trimData[$ind]['item_description']=$value['item_description'];
		}
		// $sql_issue_mrr = "select a.id as trid, a.transaction_type, a.cons_uom, b.issue_number, b.issue_purpose, a.order_id, a.cons_quantity, a.cons_amount, c.item_group_id, c.item_description from inv_transaction a, inv_issue_master b, product_details_master c
		// where a.mst_id=b.id and c.id=a.prod_id  and a.transaction_type in (2) and a.item_category=4 and a.order_id in(".implode(",",$poIdArr).")";
		// $result_trim_trans=sql_select( $sql_issue_mrr );
		$sql_issue_mrr = "select a.id as trid, a.transaction_type, a.cons_uom, a.order_id, a.cons_quantity, a.cons_amount, c.item_group_id, c.item_description from  product_details_master c,inv_transaction a,gbl_temp_engine g
		where   c.id=a.prod_id  and a.order_id=g.ref_val and  a.order_id>0  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.transaction_type=2 and a.item_category=4 ";
		$trimsRecArr_new=array();

		foreach ($result_trim_trans as $row)
		{
			/*$con_factor=$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('cons_quantity')]*$con_factor ;
			$trimsRecArr[$row[csf('item_group_id')]]['amt']+=$row[csf('cons_quantity')]*$con_factor*$rate;
			$trimsRecArr[$row[csf('item_group_id')]]['cons_uom']=$row[csf('cons_uom')];*/
			$index= $row[csf('item_description')]."***".$row[csf('item_group_id')];
			$trimsRecArr_new[$index]['qty']+=$row[csf('cons_quantity')];
			$trimsRecArr_new[$index]['amt']+=$row[csf('cons_amount')]/$g_exchange_rate;
			$trimsRecArr_new[$index]['cons_uom']=$row[csf('cons_uom')];
			$trimsRecArr_new[$index]['item_description']=$row[csf('item_description')];
		}
		$trimData_new=array();
		foreach($trimsRecArr_new as $ind=>$value){
			//echo $value['amt'].',';
			$trimData_new[$ind]['acl']['qty']+=$value['qty'];
			$trimData_new[$ind]['acl']['amount']+=$value['amt'];
			$trimData_new[$ind]['cons_uom']=$value['cons_uom'];
			$trimData_new[$ind]['item_description']=$value['item_description'];
		}

		//echo '<pre>';print_r($trimData);die;

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		//print_r($washAmtArr);die;
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$job_no=$row[csf('job_no')];
			if($row[csf('emb_name')]==3)
			{
				$washData['pre']['qty']+=$washQtyArr[$job_no][$row[csf('id')]];
				$washData['pre']['amount']+=$washAmtArr[$job_no][$row[csf('id')]];
			}
			else
			{
				$embData['pre']['qty']+=$embQtyArr[$job_no][$row[csf('id')]];
				$embData['pre']['amount']+=$embAmtArr[$job_no][$row[csf('id')]];
			}
		}
		//print_r($embData);

		// $sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and c.emb_name!=3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1  and c.is_deleted=0 and c.status_active=1";
		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g  where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.booking_type=6 and c.emb_name!=3  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1  and c.is_deleted=0 and c.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];
		}
		// Embl Cost End ============================
		// Wash Cost ============================

	 	// $sql_wash = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and  c.emb_name=3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		 $sql_wash = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and  c.emb_name=3 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_wash=sql_select($sql_wash);
		foreach($data_array_wash as $row) {
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}
		//echo $sql_aop = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=3 and a.process=35 and  a.item_category=12 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";

		$sql_aop = "select a.id,a.currency_id, b.job_no,c.item_number_id, c.body_part_id, c.fab_nature_id, c.color_type_id, c.fabric_description, c.gsm_weight, d.cons_process,b.wo_qnty,b.amount from wo_booking_mst a,wo_booking_dtls b ,wo_pre_cost_fabric_cost_dtls c, wo_pre_cost_fab_conv_cost_dtls d where a.booking_no=b.booking_no   and c.job_no=b.job_no  and d.id=b.pre_cost_fabric_cost_dtls_id  and d.fabric_description=c.id  and a.booking_type=3 and a.process=35 and  a.item_category=12 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.job_no='".$jobNumber."' and d.cons_process=35";

		$data_array_aop=sql_select($sql_aop);
		//foreach($data_array as $row){
			//$washData['acl']['qty']+=$row[csf('wo_qnty')];
		//	$washData['acl']['amount']+=$row[csf('amount')];
		foreach($data_array_aop as $row_aop){
			$desc=$row_aop[csf("fabric_description")];
			$index="'".$row_aop[csf('body_part_id')]."_".$desc."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['acl']['qty']+=$row_aop[csf('wo_qnty')];
				$currency_id=$row_aop[csf('currency_id')];
				if($currency_id==1)
				{
					$AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
				}
				else
				{
				    $AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')];

				}

			}
		//}

		}
		//print_r($AopfinishData);

		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'  and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}

		$sql_cm_cost="select jobNo, available_min, production_date from production_logicsoft where jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			$production_date=change_date_format($row[csf('production_date')],'','',1);
			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		// $sql_c="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where po_id in(".implode(",",$poIdArr).")";
		$sql_c="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  ";
		$data_array=sql_select($sql_c);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		//echo '<pre>';print_r($otherData);
		// Other Cost End ============================
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."  and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td>
                    <td style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td>Dealing Marchant</td>
                    <td colspan="3" style="word-break:break-all;"><? echo $dealing_marchants;?></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"><? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right" colspan="2"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>

			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1100px; margin-top:10px; float: left" rules="all">
				<thead>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="30">UOM</td>
						<!-- <td width="80">Marketing Qty</td>
						<td width="80">Marketing Value</td> -->
						<td width="80">Pre-Cost Qty</td>
						<td width="80">Pre-Cost Price</td>
						<td width="80">Pre-Cost Value</td>
						<td width="80">Cont. % On FOB Value</td>
						<td width="80">Actual Qty</td>
						<td width="80">Actual Price</td>
						<td width="80">Actual Value</td>
						<td width="80">Cont. % On FOB Value</td>
					</tr>
				</thead>
				<tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="including yarn dyed">Yarn Cost<br>Grey Yarn</td>

				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					if($row['preCost']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['acl']['qty']>0)
					{
						$item_descrition =$lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition ?></td>
						<td width="60">Kg</td>
						<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['mkt']['amount']>0) echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4);else echo " "; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				foreach($qYarnData as $index=>$row ){

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="QC"><?=$index; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo " "; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}

				?>
                <tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="yarn dyed">Dyed Yarn Cost</td>
				</tr>
                <?
				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row )
				{
					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					?>

				    <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right" title="yarn Recv Actual"><? echo fn_number_format($yarn_acl_qty,4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				/*
				previous data comes from recieve page
                foreach($DYarnData as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['preCost']['qty']>0)
					{
						$item_descrition =$index;
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				*/

				foreach($dried_yarn_data_arr as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['preCost']['qty']>0)
					{
						$item_descrition =$index;
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				//Dyed End
				?>

                 <tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="yarn dyed">Service Yarn Cost</td>
				</tr>
                <?
                  foreach($SYarnData as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['pre']['qty']>0)
					{
						$item_descrition =$index;
					}
					//$item_descrition =$index;

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['pre']['amount']>0) echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Yarn Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right"><? echo fn_number_format($totalMktQty,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalMktValue,4,".","");
						?>
					</td> -->
					<td width="80" align="right"><? echo fn_number_format($totalPreQty,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalPreValue>$totalMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','1')"><? echo fn_number_format($totalAclQty,4); ?></A>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalAclValue>$totalPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="300" >Fabric Purchase Cost (Knit)</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><?// echo fn_number_format($fabPurArr['mkt']['knit']['amount']/$fabPurArr['mkt']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['knit']['amount'],4); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="30">Yds</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<?
						$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['mkt']['knit']['amount'],4,".","");
						echo fn_number_format($fabPurMkt,4);
						$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
						$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['pre']['knit']['amount'],4,".","");
						$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['acl']['knit']['amount'],4,".","");
						?>
					</td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<? echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurPre*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurAcl*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="10">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0; $totalKnitPreValue=0; $totalKnitAclValue=0; $totalKniMktQty=0; $totalKnitPreQty=0; $totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=fn_number_format($row['acl']['qty'],4,".","");
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($totalKniMktQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? //echo fn_number_format($totalKniMktValue,4); $GrandTotalMktValue+=fn_number_format($totalKniMktValue,4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($totalKnitPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalKnitAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold" class="dyfi">
					<td colspan="10">Dye & Fin  Cost</td>
				</tr>
				<?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$process_names='';
					if ($row['pre']['qty'] != 0){
						$process_names="(".rtrim($row['pre']['process_name'],',').")";
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="dyfi" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? echo $item_descrition.' '.$process_names; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish  Cost Total</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($totalFinMktQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? //echo fn_number_format($totalFinMktValue,4); $GrandTotalMktValue+=fn_number_format($totalFinMktValue,4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
                <tr style="font-weight:bold" class="aop">
					<td colspan="10">AOP Cost</td>
				</tr>
                <?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$a=1;
				foreach($AopfinishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($a%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="aop" bgcolor="<? echo $bgcolor;?>" onClick="change_color('traop_<? echo $a; ?>','<? echo $bgcolor;?>')" id="traop_<? echo $a; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$a++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="aoptotal"  class="adl-signs" onClick="yarnT(this.id,'.aop')">+</span>&nbsp;&nbsp  AOP Cost Total</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($totalFinMktQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? //echo fn_number_format($totalFinMktValue,4); $GrandTotalMktValue+=fn_number_format($totalFinMktValue,4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>

				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="300" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? echo fn_number_format($aopData['mkt']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['mkt']['amount']/$aopData['mkt']['qty'],4)?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['mkt']['amount'],4); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aopData['pre']['amount'],4,".","")>fn_number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($aopData['pre']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aopData['acl']['amount'],4,".","")>fn_number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aopData['acl']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="10">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($gray_transfer_amount/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="80" title="Transfer Qty*Avg Yarn Rate + Transfer Qty*Avg Knitting Charge" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($gray_transfer_amount,4); ?></A>&nbsp;<? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($gray_transfer_amount*100/$jobValue),2).'%'; ?></td>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td> -->
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($finish_transfer_amount/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="80" align="right"  title="Transfer Qty*Avg Yarn Rate + Transfer Qty*Avg Knitting Charge + Transfer Qty*Avg Finishing Charge"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($finish_transfer_amount,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($finish_transfer_amount*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($gray_transfer_amount/$grey_fab_trans_qty_acl)+($finish_transfer_amount/$tot_fin_fab_transfer_qty),4);//echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($gray_transfer_amount+$finish_transfer_amount,4);
						$total_grey_fin_fab_transfer_actl_cost=$gray_transfer_amount+$finish_transfer_amount;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format((($gray_transfer_amount+$finish_transfer_amount)*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr>
					<td colspan="10" style="font-weight:bold" class="trims">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					if($index>0)
					{
						$item_descrition = $trim_groupArr[$index]['item_name'].' '.$row['item_description'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="80" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				foreach($trimData_new as $index=>$row ){
					if($index>0)
					{
						$explode=explode("***", $index);
						$item_group_ids=$explode[1];
						$item_descrition = $trim_groupArr[$item_group_ids]['item_name'].' '.$row['item_description'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'] ,4); ?></td>
							<td width="80" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']*100/$jobValue,2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="trimstotal" class="adl-signs" onClick="yarnT(this.id,'.trims')">+</span>&nbsp;&nbsp;Trims Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						?>
					</td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>

					<?php
						//$sqlResult= sql_select("select category,over_rcv_status,over_rcv_percent,over_rcv_payment from variable_inv_ile_standard where company_name='$company_name' and variable_list=23 and category=4 order by id");


					 ?>

					<td width="80" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						//if($sqlResult[0][csf('over_rcv_payment')]==1){

							echo fn_number_format($totalTrimAclValue,4);
							$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
							$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						//}
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimAclValue*100/$jobValue),2).'%'; ?></td>


				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<!-- <td width="80" align="right"><? echo fn_number_format($embData['mkt']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($embData['mkt']['amount'],4,".","");?></td> -->
					<td width="80" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($embData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>

					<td width="80" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($embData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" >Wash Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<!-- <td width="80" align="right"><? echo fn_number_format($washData['mkt']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($washData['mkt']['amount'],4,".","");?></td> -->
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($washData['pre']['amount'],4,".","")>fn_number_format($washData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($washData['pre']['amount'],4);$totalOtherPreValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($washData['acl']['amount'],4,".","")>fn_number_format($washData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($washData['acl']['amount'],4);$totalOtherAclValue+=fn_number_format($washData['acl']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<!-- <td width="80" align="right"><? echo fn_number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commiData['mkt']['amount'],4,".","");?></td> -->
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; ?></td>
					<td width="80" align="right"><? $aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty; echo fn_number_format($aclCommiAmt/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aclCommiAmt,4); $totalOtherAclValue+=$aclCommiAmt; ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aclCommiAmt*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commaData['mkt']['amount'],4,".","");?></td> -->
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount']/$commaData['pre']['qty'],4);  ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($commaData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="80" align="right"><? echo  fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)"  bgcolor="<? if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //($exfactoryQty*$commaData['pre']['rate'])*80/100; $unitPrice
					echo fn_number_format($commer_act_cost,4);//fn_number_format($exfactoryQty*$commaData['pre']['rate'],4);
					 $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".","");?></td>
					 <td width="80" align="right"><? echo fn_number_format(($commer_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<!-- <td width="80" align="right"><? echo fn_number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['freight']['amount'],4,".","");?></td> -->
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['freight']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['freight']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['freight']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<!-- td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="80" align="right"><? // echo fn_number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td> -->
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['lab_test']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><?
					$test_act_cost=$unitPrice*$exfactoryQty*(0.5/100);
					echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($test_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['inspection']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><?
					//$courier_cost_act=$otherData['pre']['currier_pre_cost']['rate']*$exfactoryQty*(80/100);
					echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<!-- <td width="80" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td> -->
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")) $font_color="white";
					else $font_color="black";
					?>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><?
					$making_cost_act=$otherData['pre']['cm_cost']['rate']*$exfactoryQty*(80/100);
					echo fn_number_format($making_cost_act/$exfactoryQty,4); ?></td>
					<td width="80" title="Pre Cost Rate*Ex Fact Qty*(80/100)"  align="right"  bgcolor="<? if(fn_number_format($making_cost_act,4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=fn_number_format($making_cost_act,4,".",""); echo fn_number_format($making_cost_act,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>
					<!-- <a href="#report_details" style="color:<? //echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? //echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"></a> -->
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalOtherMktValue,4); $GrandTotalMktValue+=fn_number_format($totalOtherMktValue,4,".",""); ?></td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherPreValue,4); $GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherAclValue,4); $GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="80" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo fn_number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="80" align="right"><? $quaOfferValue=$quaOfferQnty*$quaPriceWithCommnPcs; echo fn_number_format($quaOfferValue,4) ?></td> -->
					<td width="80" align="right"><? echo $jobQty ?></td>
					<td width="80" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($exfactoryValue*100/$jobValue),2).'%'; ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>
					<td width="120">
                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>
						    <div style="float:left;width:120px" >
							<?
							foreach($nameArray_img AS $inf) {
								?>
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
							    <?
							}
							?>
							</div>
						<?
					}
					else echo ""; ?>
                    </td>
				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px;" rules="all">
				<tr><td colspan="8"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<!-- <tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr> -->
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}

	$html = ob_get_contents();
    ob_clean();
    foreach (glob("*.xls") as $filename) {
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_name."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');
    $is_created = fwrite($create_new_doc, $html);
    echo "$html****$filename";

	exit();
}

if($action=="issue_popup")
{
	echo load_html_head_contents("Popup Info","../../../../", 1, 1);
	extract($_REQUEST);
	$po_id = implode(",",explode("_",$po_id));
	 $sql_job=sql_select("select a.quotation_id,b.job_no_mst from wo_po_details_master a,wo_po_break_down b where b.job_no_mst=a.job_no and b.id in($po_id)");
		foreach($sql_job as $row)
		{
			$quotationId=$row[csf('quotation_id')];
			$job_no=$row[csf('job_no_mst')];
		}

	// $job_no = return_field_value("b.job_no_mst as job_no_mst", "wo_po_break_down b", "b.id in($po_id)", "job_no_mst");

	?>
	<script type="text/javascript">
		function generate_worder_report(type, booking_no, company_id, order_id, fabric_nature, fabric_source, job_no, approved, entry_form, is_short) {
			if (entry_form == 108)
			{
				var action_method = "action=print_booking_3";
			}
			else
			{
				var action_method = "action=show_fabric_booking_report3";
			}

			if (type == 1) {

				if(is_short==2){

					if (entry_form == 108) {
						report_title = "&report_title=Partial Fabric Booking";
						http.open("POST", "../../../../order/woven_order/requires/partial_fabric_booking_controller.php", true);
					}
					else if (entry_form == 118) {
						report_title = "&report_title=Partial Fabric Booking";
						http.open("POST", "../../../../order/woven_order/requires/fabric_booking_urmi_controller.php", true);
					}
					 else {
						report_title = "&report_title=Main Fabric Booking";
						http.open("POST", "../../../../order/woven_order/requires/fabric_booking_controller.php", true);
					}
				}
				if(is_short==1){
					report_title = "&report_title=Short Fabric Booking";
					http.open("POST", "../../../../order/woven_order/requires/short_fabric_booking_controller.php", true);
				}
			}else {
				report_title = "&report_title=Sample Fabric Booking Urmi";
				http.open("POST", "../../../../order/woven_order/requires/sample_booking_controller.php", true);
			}

			var data = action_method + report_title +
			'&txt_booking_no=' + "'" + booking_no + "'" +
			'&cbo_company_name=' + "'" + company_id + "'" +
			'&txt_order_no_id=' + "'" + order_id + "'" +
			'&cbo_fabric_natu=' + "'" + fabric_nature + "'" +
			'&cbo_fabric_source=' + "'" + fabric_source + "'" +
			'&id_approved_id=' + "'" + approved + "'" +
			'&txt_job_no=' + "'" + job_no + "'";
			freeze_window(5);
			http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			http.send(data);
			http.onreadystatechange = generate_fabric_report_reponse;
		}

		function generate_fabric_report_reponse() {
			release_freezing();
			if (http.readyState == 4) {
				var w = window.open("Surprise", "#");
				var d = w.document.open();
				d.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">' +
					'<html><head><title></title></head><body>' + http.responseText + '</body</html>');
				d.close();
			}
		}
	</script>
	<?
	//$po_id = implode(",",explode("_",$po_id));

	$requisition_details = sql_select("select a.booking_no, c.requisition_no from ppl_planning_info_entry_mst a,ppl_planning_entry_plan_dtls b,ppl_yarn_requisition_entry c where a.id=b.mst_id and b.dtls_id=c.knit_id and b.po_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
	$requisition_arr = array();
	foreach ($requisition_details as $row) {
		$requisition_arr[$row[csf("requisition_no")]] = $row[csf("booking_no")];
	}

	$booking_details=sql_select("select c.booking_no, c.booking_type, c.is_short, d.entry_form, d.company_id, d.item_category, d.fabric_source, c.job_no, d.is_approved from wo_po_break_down b, wo_booking_dtls c, wo_booking_mst d where b.id=c.po_break_down_id and c.booking_no=d.booking_no and b.id in($po_id) and c.booking_type in(1,4) and c.status_active=1 group by c.booking_no, c.booking_type, c.is_short, d.entry_form, d.company_id, d.item_category, d.fabric_source, c.job_no, d.is_approved");
	foreach($booking_details as $row)
	{
		$booking_arr[$row[csf("booking_no")]]['booking_type']=$row[csf("booking_type")];
		$booking_arr[$row[csf("booking_no")]]['is_short']=$row[csf("is_short")];
		$booking_arr[$row[csf("booking_no")]]['entry_form']=$row[csf("entry_form")];
		$booking_arr[$row[csf("booking_no")]]['company_id']=$row[csf("company_id")];
		$booking_arr[$row[csf("booking_no")]]['item_category']=$row[csf("item_category")];
		$booking_arr[$row[csf("booking_no")]]['job_no']=$row[csf("job_no")];
		$booking_arr[$row[csf("booking_no")]]['is_approved']=$row[csf("is_approved")];
		$booking_arr[$row[csf("booking_no")]]['fabric_source']=$row[csf("fabric_source")];
	}

	$sql_issue_return="SELECT a.id, a.trans_id, a.trans_type, a.entry_form, a.po_breakdown_id, a.prod_id, a.quantity as quantity, a.issue_purpose, a.returnable_qnty, a.is_sales, b.yarn_count_id, b.detarmination_id, b.yarn_comp_type1st, b.yarn_comp_percent1st, b.yarn_type, c.cons_rate, c.cons_amount, c.issue_id, d.booking_no as requisition_no, d.receive_basis from order_wise_pro_details a, product_details_master b, inv_transaction c, inv_receive_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=4 and a.entry_form in(9) and b.dyed_type!=1 and a.po_breakdown_id in($po_id) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id";
	$issue_return=sql_select($sql_issue_return);

	$issue_return_arr = $booking_req_return = array();
	foreach ($issue_return as $row) {
		$bookingNo='';
		$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

		if($row[csf("receive_basis")] == 1){

		}
		else
		{
			//$booking_req_return[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			$bookingNo=$requisition_arr[$row[csf("requisition_no")]];
			//$issue_return_arr[$row[csf("prod_id")]][$bookingNo]['ret_issue_no'].= $row[csf("issue_number")].',';
			$issue_return_arr[$row[csf("prod_id")]][$bookingNo]["qty"] += $row[csf("quantity")];
		}

	}
	//echo '<pre>';print_r($issue_return_arr);
	//print_r($issue_return_arr);
	$sql_issue_details="SELECT a.po_breakdown_id, a.prod_id, a.quantity as quantity, a.issue_purpose, b.detarmination_id, b.product_name_details, a.prod_id, b.yarn_count_id, b.detarmination_id, b.yarn_comp_type1st, b.yarn_comp_percent1st, b.yarn_type, c.receive_basis, d.booking_no, d.issue_number, c.requisition_no from order_wise_pro_details a, product_details_master b, inv_transaction c, inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3 and b.dyed_type!=1 and d.issue_purpose in(1,4) and a.po_breakdown_id in($po_id) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by d.issue_number";
	$issue_details = sql_select($sql_issue_details);
	//$issue_arr = $booking_req = array();
	$issue_dtls_arr=array();
	foreach ($issue_details as $row)
	{
		$bookingNo='';
		$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
		if($row[csf("receive_basis")] == 1)
		{
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['booking']= $row[csf("booking_no")];
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['issue_no'].= $row[csf("issue_number")].',';
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['issue_qnty'] += $row[csf("quantity")];
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['desc'] = $row[csf("product_name_details")];
		}
		else
		{
			//$issue_arr[$index]['issue_qnty'] += $row[csf("quantity")]-$issue_return_arr[$index]["qty"];
			$booking_req[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			//$issue_dtls_arr[$row[csf("prod_id")]]['booking']=$requisition_arr[$row[csf("requisition_no")]];
			$bookingNo=$requisition_arr[$row[csf("requisition_no")]];
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['booking']= $bookingNo;
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['prod_id']= $row[csf("prod_id")];
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['issue_no'].= $row[csf("issue_number")].',';
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['issue_qnty'] += $row[csf("quantity")];
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['desc'] = $row[csf("product_name_details")];
		}
		/*$issue_dtls_arr[$row[csf("prod_id")]]['issue_no'].= $row[csf("issue_number")].',';
		$issue_dtls_arr[$row[csf("prod_id")]]['issue_qnty'] += $row[csf("quantity")];
		$issue_dtls_arr[$row[csf("prod_id")]]['desc'] = $row[csf("product_name_details")];*/
		//$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['detarmination_id']= $row[csf("detarmination_id")];
	}

	//echo '<pre>';print_r($issue_dtls_arr);

	$sql_yarn_recv="select a.booking_id, b.prod_id, b.job_no, b.cons_amount, b.cons_quantity, c.product_name_details from inv_receive_master a, inv_transaction b, product_details_master c where a.id=b.mst_id and b.prod_id=c.id and b.job_no ='".$job_no."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
	$yarn_recv =sql_select($sql_yarn_recv);

	foreach ($yarn_recv as $row) {
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['recv_qty']+=$row[csf("cons_quantity")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['amt']+=$row[csf("cons_amount")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['job_no']=$row[csf("job_no")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['booking_id']=$row[csf("booking_id")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['desc']=$row[csf("product_name_details")];
	}
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	echo load_freeze_divs ("../../",$permission);
	?>
	<table class="rpt_table" border="1" cellpadding="5" cellspacing="2" width="100%" rules="all">
		<caption> <b>Yarn Issue </b> </caption>
		<thead>
			<th>Yarn Description</th>
			<th>Booking Type</th>
			<th>Booking NO</th>
			<th>Yarn Issue Qty</th>
		</thead>
		<?php
		$issue_total = 0;$m=1;
		foreach ($issue_dtls_arr as $key=>$prod_id)
		{
			foreach ($prod_id as $booking_no => $row)
			{
				if($m%2==0) $bgcolor="#E9F3FF";
				else $bgcolor="#FFFFFF";

				$booking=$row['booking'];
				$booking_type=$booking_arr[$booking]['booking_type'];
				$is_short=$booking_arr[$booking]['is_short'];
				$entry_form=$booking_arr[$booking]['entry_form'];
				$company_id=$booking_arr[$booking]['company_id'];
				$item_category=$booking_arr[$booking]['item_category'];
				$job_no=$booking_arr[$booking]['job_no'];
				$is_approved=$booking_arr[$booking]['is_approved'];
				$fabric_source_id=$booking_arr[$booking]['fabric_source'];
				$detarmination_id=$issue_arr2[$prod_id][$booking]['detarmination_id'];

				$des=explode("_",str_replace("'","",$desc));
				$item_descrition =$row['desc'];

				?>
				 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $m; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $m; ?>" style="font-size:11px">
					<td align="center" ><? echo $item_descrition;?></td>
					<td align="center">
						<?
							if($booking_type == 1){
								if($is_short == 1){
									echo "Short Fabric Booking";
								}else{
									echo "Main Fabric Booking";
								}
							} else if($booking_type == 4){
								echo "Sample Fabric Booking";
							}
						?>
					</td>
					<td align="center">
						<?
						if($booking_type == 1 && $is_short == 2)
						{
							?>
							<span style="cursor: pointer; text-decoration: underline; color: blue;" title="Print Booking"
							onClick="generate_worder_report(<? echo $booking_type;?>,'<? echo $booking;?>',<? echo $company_id;?>,'<? echo $po_id;?>',<? echo $item_category;?>,<? echo $fabric_source_id;?>,'<? echo $job_no;?>',<? echo $is_approved;?>,<? echo $entry_form;?>,<? echo $is_short;?>)"><? echo $booking;?></span>
							<?
						} else {
							echo $booking;
						}
						?>
					</td>
					<td align="right">
						<?
						$issue_return_qty=$issue_return_arr[$row['prod_id']][$booking_no]["qty"];
						$issue_qnty =$row['issue_qnty']-$issue_return_qty;
						echo $issue_qnty = fn_number_format(($issue_qnty),2,'.','');
						?>
					</td>
				</tr>
				<?
				$issue_total += $issue_qnty;
				$m++;
			}
		}
		?>
		<tfoot>
		<tr>
			<th colspan="3" align="right">Grand Total</th>
			<th align="right"><? echo fn_number_format($issue_total,2,'.','');?></th>
		</tr>
		</tfoot>
	</table>
	<br>
	<table class="rpt_table" width="100%" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body">
		<caption> <b>Yarn Recv </b> </caption>
		<thead>
			<th>Yarn Description</th>
			<th>Booking Type</th>
			<th>Booking NO</th>
			<th>Yarn Recv Qty</th>
		</thead>
		<?
		$recv_qty_total = 0;$m=1;
		foreach ($recv_yarn_arr as $key=>$prod_id)
		{
			foreach ($prod_id as $booking_id=>$row)
			{
				if($m%2==0) $bgcolor="#E9F3FF";
				else $bgcolor="#FFFFFF";
				$ydw_no = return_field_value("ydw_no as ydw_no", "wo_yarn_dyeing_mst", "id=".$row['booking_id']." ", "ydw_no");
				// echo $row['booking_id'].', ';
				?>
				 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trrc_<? echo $m; ?>','<? echo $bgcolor;?>')" id="trrc_<? echo $m; ?>" style="font-size:11px">
					<td align="center"><? echo $row['desc']; ?></td>
					<td align="center">
						<? echo "Yarn Dyeing Booking"; ?>
					</td>
					<td align="center">
						<? echo $ydw_no; ?>

					</td>
					<td align="right">
						<?
						$recv_qty =$row['recv_qty'];
						echo $recv_qty = fn_number_format(($recv_qty),2,'.','');
						?>
					</td>
				</tr>
			    <?
				$recv_qty_total += $recv_qty;
				$m++;
			}
		}
		?>
		<tfoot>
		<tr>
			<th colspan="3" align="right">Grand Total</th>
			<th align="right"><? echo fn_number_format($recv_qty_total,2,'.','');?></th>
		</tr>
		</tfoot>
	</table>
	<?
	exit();
}

if($action=="grey_dyed_issue_popup")
{
	echo load_html_head_contents("Popup Info","../../../../", 1, 1);
	extract($_REQUEST);
	$po_id = implode(",",explode("_",$po_id));
	$g_exchange_rate=str_replace("'","",$g_exchange_rate);

	 $sql_job=sql_select("select a.quotation_id,b.job_no_mst from wo_po_details_master a,wo_po_break_down b where b.job_no_mst=a.job_no and b.id in($po_id)");
		foreach($sql_job as $row)
		{
			$quotationId=$row[csf('quotation_id')];
			$job_no=$row[csf('job_no_mst')];
		}

	// $job_no = return_field_value("b.job_no_mst as job_no_mst", "wo_po_break_down b", "b.id in($po_id)", "job_no_mst");

	?>
	<script type="text/javascript">
		function generate_worder_report(type, booking_no, company_id, order_id, fabric_nature, fabric_source, job_no, approved, entry_form, is_short) {
			if (entry_form == 108)
			{
				var action_method = "action=print_booking_3";
			}
			else
			{
				var action_method = "action=show_fabric_booking_report3";
			}

			if (type == 1) {

				if(is_short==2){

					if (entry_form == 108) {
						report_title = "&report_title=Partial Fabric Booking";
						http.open("POST", "../../../../order/woven_order/requires/partial_fabric_booking_controller.php", true);
					}
					else if (entry_form == 118) {
						report_title = "&report_title=Partial Fabric Booking";
						http.open("POST", "../../../../order/woven_order/requires/fabric_booking_urmi_controller.php", true);
					}
					 else {
						report_title = "&report_title=Main Fabric Booking";
						http.open("POST", "../../../../order/woven_order/requires/fabric_booking_controller.php", true);
					}
				}
				if(is_short==1){
					report_title = "&report_title=Short Fabric Booking";
					http.open("POST", "../../../../order/woven_order/requires/short_fabric_booking_controller.php", true);
				}
			}else {
				report_title = "&report_title=Sample Fabric Booking Urmi";
				http.open("POST", "../../../../order/woven_order/requires/sample_booking_controller.php", true);
			}

			var data = action_method + report_title +
			'&txt_booking_no=' + "'" + booking_no + "'" +
			'&cbo_company_name=' + "'" + company_id + "'" +
			'&txt_order_no_id=' + "'" + order_id + "'" +
			'&cbo_fabric_natu=' + "'" + fabric_nature + "'" +
			'&cbo_fabric_source=' + "'" + fabric_source + "'" +
			'&id_approved_id=' + "'" + approved + "'" +
			'&txt_job_no=' + "'" + job_no + "'";
			freeze_window(5);
			http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			http.send(data);
			http.onreadystatechange = generate_fabric_report_reponse;
		}

		function generate_fabric_report_reponse() {
			release_freezing();
			if (http.readyState == 4) {
				var w = window.open("Surprise", "#");
				var d = w.document.open();
				d.write('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">' +
					'<html><head><title></title></head><body>' + http.responseText + '</body</html>');
				d.close();
			}
		}
	</script>
	<?
	//$po_id = implode(",",explode("_",$po_id));

	$requisition_details = sql_select("select a.booking_no, c.requisition_no from ppl_planning_info_entry_mst a,ppl_planning_entry_plan_dtls b,ppl_yarn_requisition_entry c where a.id=b.mst_id and b.dtls_id=c.knit_id and b.po_id in($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
	$requisition_arr = array();
	foreach ($requisition_details as $row) {
		$requisition_arr[$row[csf("requisition_no")]] = $row[csf("booking_no")];
	}

	$booking_details=sql_select("select c.booking_no, c.booking_type, c.is_short, d.entry_form, d.company_id, d.item_category, d.fabric_source, c.job_no, d.is_approved from wo_po_break_down b, wo_booking_dtls c, wo_booking_mst d where b.id=c.po_break_down_id and c.booking_no=d.booking_no and b.id in($po_id) and c.booking_type in(1,4) and c.status_active=1 group by c.booking_no, c.booking_type, c.is_short, d.entry_form, d.company_id, d.item_category, d.fabric_source, c.job_no, d.is_approved");
	foreach($booking_details as $row)
	{
		$booking_arr[$row[csf("booking_no")]]['booking_type']=$row[csf("booking_type")];
		$booking_arr[$row[csf("booking_no")]]['is_short']=$row[csf("is_short")];
		$booking_arr[$row[csf("booking_no")]]['entry_form']=$row[csf("entry_form")];
		$booking_arr[$row[csf("booking_no")]]['company_id']=$row[csf("company_id")];
		$booking_arr[$row[csf("booking_no")]]['item_category']=$row[csf("item_category")];
		$booking_arr[$row[csf("booking_no")]]['job_no']=$row[csf("job_no")];
		$booking_arr[$row[csf("booking_no")]]['is_approved']=$row[csf("is_approved")];
		$booking_arr[$row[csf("booking_no")]]['fabric_source']=$row[csf("fabric_source")];
	}

	$sql_issue_return="SELECT a.id, a.trans_id, a.trans_type, a.entry_form, a.po_breakdown_id, a.prod_id, a.quantity as quantity, a.issue_purpose, a.returnable_qnty, a.is_sales, b.yarn_count_id, b.detarmination_id, b.yarn_comp_type1st, b.yarn_comp_percent1st, b.yarn_type, c.cons_rate, c.cons_amount, c.issue_id, d.booking_no as requisition_no, d.receive_basis from order_wise_pro_details a, product_details_master b, inv_transaction c, inv_receive_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=4 and a.entry_form in(9) and b.dyed_type!=1 and a.po_breakdown_id in($po_id) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id";
	$issue_return=sql_select($sql_issue_return);

	$issue_return_arr = $booking_req_return = array();
	foreach ($issue_return as $row) {
		$bookingNo='';
		$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

		if($row[csf("receive_basis")] == 1){

		}
		else
		{
			//$booking_req_return[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			$bookingNo=$requisition_arr[$row[csf("requisition_no")]];
			//$issue_return_arr[$row[csf("prod_id")]][$bookingNo]['ret_issue_no'].= $row[csf("issue_number")].',';
			$issue_return_arr[$row[csf("prod_id")]][$bookingNo]["qty"] += $row[csf("quantity")];
		}

	}
	//echo '<pre>';print_r($issue_return_arr);
	//print_r($issue_return_arr);
	$sql_issue_details="SELECT a.po_breakdown_id, a.prod_id, a.quantity as quantity, a.issue_purpose, b.detarmination_id, b.product_name_details, a.prod_id, b.yarn_count_id, b.detarmination_id, b.yarn_comp_type1st, b.yarn_comp_percent1st, b.yarn_type, c.receive_basis, d.booking_no, d.issue_number, c.requisition_no,b.lot,c.cons_rate from order_wise_pro_details a, product_details_master b, inv_transaction c, inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3 and b.dyed_type!=1 and d.issue_purpose in(1,4) and a.po_breakdown_id in($po_id) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by d.issue_number";
	//echo $sql_issue_details;
	$issue_details = sql_select($sql_issue_details);
	//$issue_arr = $booking_req = array();
	$issue_dtls_arr=array();
	foreach ($issue_details as $row)
	{
		if($row[csf("color")]==93)//ISD-23-23117
		{
		$bookingNo='';
		$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
		if($row[csf("receive_basis")] == 1)
		{
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['booking']= $row[csf("booking_no")];
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['issue_no'].= $row[csf("issue_number")].',';
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['issue_qnty'] += $row[csf("quantity")];
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['desc'] = $row[csf("product_name_details")];
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['lot'] = $row[csf("lot")];
			$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['cons_rate'] = $row[csf("cons_rate")];
		}
		else
		{
			//$issue_arr[$index]['issue_qnty'] += $row[csf("quantity")]-$issue_return_arr[$index]["qty"];
			$booking_req[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			//$issue_dtls_arr[$row[csf("prod_id")]]['booking']=$requisition_arr[$row[csf("requisition_no")]];
			$bookingNo=$requisition_arr[$row[csf("requisition_no")]];
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['booking']= $bookingNo;
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['prod_id']= $row[csf("prod_id")];
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['issue_no'].= $row[csf("issue_number")].',';
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['issue_qnty'] += $row[csf("quantity")];
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['desc'] = $row[csf("product_name_details")];
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['lot'] = $row[csf("lot")];
			$issue_dtls_arr[$row[csf("prod_id")]][$bookingNo]['cons_rate'] = $row[csf("cons_rate")];
		}
		}
		/*$issue_dtls_arr[$row[csf("prod_id")]]['issue_no'].= $row[csf("issue_number")].',';
		$issue_dtls_arr[$row[csf("prod_id")]]['issue_qnty'] += $row[csf("quantity")];
		$issue_dtls_arr[$row[csf("prod_id")]]['desc'] = $row[csf("product_name_details")];*/
		//$issue_dtls_arr[$row[csf("prod_id")]][$row[csf("booking_no")]]['detarmination_id']= $row[csf("detarmination_id")];
	}

	//echo '<pre>';print_r($issue_dtls_arr);

	$sql_yarn_recv="SELECT a.booking_id, b.prod_id, b.job_no, b.cons_amount, b.cons_quantity, c.product_name_details,c.lot,b.cons_rate from inv_receive_master a, inv_transaction b, product_details_master c where a.id=b.mst_id and b.prod_id=c.id and b.job_no ='".$job_no."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
	$yarn_recv =sql_select($sql_yarn_recv);

	foreach ($yarn_recv as $row) {
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['recv_qty']+=$row[csf("cons_quantity")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['amt']+=$row[csf("cons_amount")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['job_no']=$row[csf("job_no")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['booking_id']=$row[csf("booking_id")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['desc']=$row[csf("product_name_details")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['lot']=$row[csf("lot")];
		$recv_yarn_arr[$row[csf("prod_id")]][$row[csf("booking_id")]]['cons_rate']=$row[csf("cons_rate")];
	}
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	echo load_freeze_divs ("../../",$permission);
	?>
	<table class="rpt_table" border="1" cellpadding="5" cellspacing="2" width="100%" rules="all">
		<caption> <b>Yarn Issue </b> </caption>
		<thead>
			<th>Yarn Description</th>
			<th>Lot</th>
			<th>Rate</th>
			<th>Booking Type</th>
			<th>Booking NO</th>
			<th>Yarn Issue Qty</th>
		</thead>
		<?php
		$issue_total = 0;$m=1;
		foreach ($issue_dtls_arr as $key=>$prod_id)
		{
			foreach ($prod_id as $booking_no => $row)
			{
				if($m%2==0) $bgcolor="#E9F3FF";
				else $bgcolor="#FFFFFF";

				$booking=$row['booking'];
				$booking_type=$booking_arr[$booking]['booking_type'];
				$is_short=$booking_arr[$booking]['is_short'];
				$entry_form=$booking_arr[$booking]['entry_form'];
				$company_id=$booking_arr[$booking]['company_id'];
				$item_category=$booking_arr[$booking]['item_category'];
				$job_no=$booking_arr[$booking]['job_no'];
				$is_approved=$booking_arr[$booking]['is_approved'];
				$fabric_source_id=$booking_arr[$booking]['fabric_source'];
				$detarmination_id=$issue_arr2[$prod_id][$booking]['detarmination_id'];

				$des=explode("_",str_replace("'","",$desc));
				$item_descrition =$row['desc'];

				$cons_rate = $row['cons_rate']/$g_exchange_rate;

				?>
				 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr_<? echo $m; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $m; ?>" style="font-size:11px">
					<td align="center" ><? echo $item_descrition;?></td>
					<td align="center" ><? echo $row['lot'];?></td>
					<td align="center" ><? echo number_format($cons_rate,4);?></td>
					<td align="center">
						<?
							if($booking_type == 1){
								if($is_short == 1){
									echo "Short Fabric Booking";
								}else{
									echo "Main Fabric Booking";
								}
							} else if($booking_type == 4){
								echo "Sample Fabric Booking";
							}
						?>
					</td>
					<td align="center">
						<?
						if($booking_type == 1 && $is_short == 2)
						{
							?>
							<span style="cursor: pointer; text-decoration: underline; color: blue;" title="Print Booking"
							onClick="generate_worder_report(<? echo $booking_type;?>,'<? echo $booking;?>',<? echo $company_id;?>,'<? echo $po_id;?>',<? echo $item_category;?>,<? echo $fabric_source_id;?>,'<? echo $job_no;?>',<? echo $is_approved;?>,<? echo $entry_form;?>,<? echo $is_short;?>)"><? echo $booking;?></span>
							<?
						} else {
							echo $booking;
						}
						?>
					</td>
					<td align="right">
						<?
						$issue_return_qty=$issue_return_arr[$row['prod_id']][$booking_no]["qty"];
						$issue_qnty =$row['issue_qnty']-$issue_return_qty;
						echo $issue_qnty = fn_number_format(($issue_qnty),2,'.','');
						?>
					</td>
				</tr>
				<?
				$issue_total += $issue_qnty;
				$m++;
			}
		}
		?>
		<tfoot>
		<tr>
			<th colspan="5" align="right">Grand Total</th>
			<th align="right"><? echo fn_number_format($issue_total,2,'.','');?></th>
		</tr>
		</tfoot>
	</table>
	<br>
	<table class="rpt_table" width="100%" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_body">
		<caption> <b>Yarn Recv </b> </caption>
		<thead>
			<th>Yarn Description</th>
			<th>Lot</th>
			<th>Rate</th>
			<th>Booking Type</th>
			<th>Booking NO</th>
			<th>Yarn Recv Qty</th>
		</thead>
		<?
		$recv_qty_total = 0;$m=1;
		foreach ($recv_yarn_arr as $key=>$prod_id)
		{
			foreach ($prod_id as $booking_id=>$row)
			{
				if($m%2==0) $bgcolor="#E9F3FF";
				else $bgcolor="#FFFFFF";
				$ydw_no = return_field_value("ydw_no as ydw_no", "wo_yarn_dyeing_mst", "id=".$row['booking_id']." ", "ydw_no");
				// echo $row['booking_id'].', ';
				?>
				 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trrc_<? echo $m; ?>','<? echo $bgcolor;?>')" id="trrc_<? echo $m; ?>" style="font-size:11px">
					<td align="center"><? echo $row['desc']; ?></td>
					<td align="center" ><? echo $row['lot'];?></td>
					<td align="center" ><? echo number_format($row['cons_rate'],4);?></td>
					<td align="center">
						<? echo "Yarn Dyeing Booking"; ?>
					</td>
					<td align="center">
						<? echo $ydw_no; ?>

					</td>
					<td align="right">
						<?
						$recv_qty =$row['recv_qty'];
						echo $recv_qty = fn_number_format(($recv_qty),2,'.','');
						?>
					</td>
				</tr>
			    <?
				$recv_qty_total += $recv_qty;
				$m++;
			}
		}
		?>
		<tfoot>
		<tr>
			<th colspan="5" align="right">Grand Total</th>
			<th align="right"><? echo fn_number_format($recv_qty_total,2,'.','');?></th>
		</tr>
		</tfoot>
	</table>
	<?
	exit();
}

if($action=="trim_transfer_popup")
{
	echo load_html_head_contents("Transfer Info", "../../../../", 1, 1,'','','');
	extract($_REQUEST);
	$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );

	$sql_wopo="select id,po_number from wo_po_break_down where  is_deleted=0 and status_active=1";
	$data_result=sql_select($sql_wopo);
	foreach($data_result as $row){
		$po_dtls_arr[$row[csf("id")]]['po_no']=$row[csf("po_number")];
	}

	$po_id = implode(",",explode("_",$po_id));
	$g_exchange_rate=str_replace("'","",$g_exchange_rate);
	?>
	<fieldset style="width:700px; margin-left:7px">
	<div id="report_container" align="center">
		<table border="1" class="rpt_table" rules="all" width="730" cellpadding="0" cellspacing="0">
		<thead>
				<tr>
					<th colspan="7">Transfer In</th>
				</tr>
				<tr>
					<th width="160">Item Description</th>
					<th width="100">From Order</th>
					<th width="80">From Internal ref</th>
					<th width="80">UOM</th>
					<th width="80">Transfer Qnty</th>
					<th width="80">Actual Price</th>
					<th width="80">Actual Value</th>
				</tr>
			</thead>
			<?
			$total_trans_in_qnty=$total_trans_in_amt=0;
			/* $sql="SELECT a.from_order_id,b.item_group,sum(b.transfer_qnty) AS transfer_qnty,b.rate,c.grouping FROM inv_item_transfer_mst a,inv_item_transfer_dtls b,wo_po_break_down c WHERE a.id = b.mst_id AND a.from_order_id=c.id AND a.to_order_id in(".implode(",",$poIdArr).") AND a.status_active = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0 group by a.from_order_id, b.item_group, b.rate,c.grouping"; */
			$sql = "select a.transfer_system_id, a.transfer_date, a.challan_no, a.from_order_id,a.to_order_id,b.rate,b.uom, b.from_prod_id, d.product_name_details, sum(c.quantity) as transfer_qnty,sum(c.quantity*b.rate) as transfer_amount from inv_item_transfer_mst a, inv_item_transfer_dtls b, order_wise_pro_details c, product_details_master d where a.id=b.mst_id and b.id=c.dtls_id and c.prod_id=d.id and a.to_order_id =c.po_breakdown_id and a.to_order_id in ($po_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by a.id, a.from_order_id,b.rate,c.prod_id, a.transfer_system_id, a.transfer_date, a.challan_no, a.to_order_id,b.uom, b.from_prod_id, d.product_name_details"; 
			$result = sql_select($sql);
				$prod_id_arr=array();
		        $order_id_arr=array();
		        foreach($result as $row)
		          	{
		              array_push($prod_id_arr, $row[csf('prod_id')]);
		              array_push($order_id_arr, $row[csf('from_order_id')]);
		              array_push($order_id_arr, $row[csf('to_order_id')]);
		            }
		        $prod_cond=where_con_using_array($prod_id_arr,0,"id");
		        $order_id_cond=where_con_using_array($order_id_arr,0,"id");
		        $order_sql=sql_select("SELECT grouping,id,po_number from wo_po_break_down where 1=1 $order_id_cond");
		        $order_data=array();
		            foreach ($order_sql as $row) 
		            {
		              $order_data[$row[csf('id')]]['grouping']=$row[csf('grouping')];
		              $order_data[$row[csf('id')]]['po_number']=$row[csf('po_number')];
		            }
			foreach ($result as $row) {
				if ($i % 2 == 0)
					$bgcolor = "#E9F3FF";
				else
					$bgcolor = "#FFFFFF";
					$avg_rate=$avg_rate_array[$row[csf("from_prod_id")]];
					$actual_price=$row[csf('rate')]/$g_exchange_rate;
				?>
				<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>', '<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">
					<td><p><? echo $row[csf('product_name_details')]; ?></p></td>
					<td align="center"><p><? echo $order_data[$row[csf('from_order_id')]]['po_number']; ?></p></td>
	                <td align="center"><p><? echo $order_data[$row[csf('from_order_id')]]['grouping']; ?></p></td>	
					<td align="center"><p><? echo $unit_of_measurement[$row[csf('uom')]]; ?></p></td>			
					<td align="right"><? echo fn_number_format($row[csf('transfer_qnty')], 2); ?> </td>
					<td align="right"><? echo  fn_number_format($actual_price,2); ?> </td>
					<td align="right"><? $trans_in=$row[csf('transfer_amount')]/$g_exchange_rate;echo fn_number_format($trans_in,2); ?> </td>
				</tr>
				<?
				$total_trans_in_qnty += $row[csf('transfer_qnty')];
				$total_trans_in_amt +=$trans_in;
				$i++;
			}
			?>
			<tr style="font-weight:bold">
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td align="right">Total</td>
			   	<td align="right"><? echo fn_number_format($total_trans_in_qnty, 2); ?></td>
				<td>&nbsp;</td>
				<td align="right"><? echo fn_number_format($total_trans_in_amt, 2); ?></td>
			</tr>
			<thead>
				<tr>
					<th colspan="7">Transfer Out</th>
				</tr>
				<tr>
					<th width="160">Item Description</th>
					<th width="100">To Order</th>
					<th width="80">To Internal ref</th>
					<th width="80">UOM</th>
					<th width="80">Transfer Qnty</th>
					<th width="80">Actual Price</th>
					<th width="80">Actual Value</th>
				</tr>
			</thead>
			<?
			$i = 1;
			$total_trans_out_qnty =$total_trans_out_amt= 0;
		$sql = "select a.transfer_system_id, a.transfer_date, a.challan_no, a.from_order_id,a.to_order_id,b.rate,b.uom, b.from_prod_id, d.product_name_details, sum(c.quantity) as transfer_qnty,sum(c.quantity*b.rate) as transfer_amount from inv_item_transfer_mst a, inv_item_transfer_dtls b, order_wise_pro_details c, product_details_master d where a.id=b.mst_id and b.id=c.dtls_id and c.prod_id=d.id and a.from_order_id =c.po_breakdown_id and a.from_order_id in ($po_id)  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by a.id, a.from_order_id,b.rate,c.prod_id, a.transfer_system_id, a.transfer_date, a.challan_no, a.to_order_id,b.uom, b.from_prod_id, d.product_name_details"; 
			$result = sql_select($sql);
				$prod_id_arr=array();
		        $order_id_arr=array();
		        foreach($result as $row)
		          	{
		              array_push($prod_id_arr, $row[csf('prod_id')]);
		              array_push($order_id_arr, $row[csf('from_order_id')]);
		              array_push($order_id_arr, $row[csf('to_order_id')]);
		            }
		        $prod_cond=where_con_using_array($prod_id_arr,0,"id");
		        $order_id_cond=where_con_using_array($order_id_arr,0,"id");
		        $order_sql=sql_select("SELECT grouping,id,po_number from wo_po_break_down where 1=1 $order_id_cond");
		        $order_data=array();
		            foreach ($order_sql as $row) 
		            {
		              $order_data[$row[csf('id')]]['grouping']=$row[csf('grouping')];
		              $order_data[$row[csf('id')]]['po_number']=$row[csf('po_number')];
		            }
			foreach ($result as $row) {
				if ($i % 2 == 0)
					$bgcolor = "#E9F3FF";
				else
					$bgcolor = "#FFFFFF";
					$avg_rate=$avg_rate_array[$row[csf("from_prod_id")]];
					$actual_price=$row[csf('rate')]/$g_exchange_rate;
				?>
				<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>', '<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>">	
					<td><p><? echo $row[csf('product_name_details')]; ?></p></td>
					<td align="center"><p><? echo $order_data[$row[csf('to_order_id')]]['po_number']; ?></p></td>
	                <td align="center"><p><? echo $order_data[$row[csf('to_order_id')]]['grouping']; ?></p></td>	
					<td align="center"><p><? echo $unit_of_measurement[$row[csf('uom')]]; ?></p></td>			
					<td align="right"><? echo fn_number_format($row[csf('transfer_qnty')], 2); ?> </td>
					<td align="right"><? echo  fn_number_format($actual_price,2); ?> </td>
					<td align="right"><? $trans_out=$row[csf('transfer_amount')]/$g_exchange_rate;echo fn_number_format($trans_out,2); ?> </td>
				</tr>
				<?
				$total_trans_out_qnty += $row[csf('transfer_qnty')];
				$total_trans_out_amt +=$trans_out;
				$i++;
			}
			?>
			<tr style="font-weight:bold">
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td>&nbsp;</td>
				<td align="right">Total</td>
			   	<td align="right"><? echo fn_number_format($total_trans_out_qnty, 2); ?></td>
				<td>&nbsp;</td>
				<td align="right"><? echo fn_number_format($total_trans_out_amt, 2); ?></td>
			</tr>
			<tfoot>
			<th></th>
			<th></th>
			<th></th>
			<th>Net Transfer</th>
			<th align="right"><? echo fn_number_format($total_trans_in_qnty - $total_trans_out_qnty, 2); ?></th>
			<th></th>
			<th align="right"><?  echo fn_number_format($total_trans_in_amt  - $total_trans_out_amt , 2); ?></th>
			</tfoot>
		</table>
	</div>
	</fieldset>
	<?
}


if($action=="mkt_cm_cost_popup")
{
	echo load_html_head_contents("Popup Info","../../../../", 1, 1);
	extract($_REQUEST);


	?>
	<fieldset style="width:950px; margin-left:7px">
        <table class="rpt_table" width="950px" cellpadding="0" cellspacing="0" border="1" rules="all">
        <caption> <b>Making Cost (CM) Actaul</b></caption>
            <thead>
                <th width="30">SL</th>
                <th width="110">Order Closing Date</th>
                <th width="100">Buyer</th>
                <th width="180">Style</th>
                <th width="110">Job No.</th>
                <th width="80">Used Min.</th>
                <th width="80">Produced Min</th>
                <th width="60">Effi%</th>
                <th width="60">CPM</th>
                <th>CM</th>
            </thead>
        </table>
        <div style="width:970px; max-height:330px; overflow-y:scroll" id="scroll_body">
			<table border="1" class="rpt_table" rules="all" width="950px" cellpadding="0" cellspacing="0">
				<?
				$buyer_array = return_library_array("select id, buyer_name from lib_buyer ", "id", "buyer_name");
				$job_effi_array = return_library_array("select job_no, sew_effi_percent from wo_pre_cost_mst ", "job_no", "sew_effi_percent");

				$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company and status_active=1 and is_deleted=0  order by id desc");
			foreach($sql_std_para as $row )
			{
				$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
				$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
				$diff=datediff('d',$applying_period_date,$applying_period_to_date);
				for($j=0;$j<$diff;$j++)
				{
					$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
					$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
				}
			}

                $i=1;  $total_cm=$tot_used_min=$tot_produce_min=0;
				$sql_job="select  a.job_no,a.buyer_name,a.style_ref_no,b.production_date,b.produce_min,b.available_min from wo_po_details_master a,production_logicsoft b where a.job_no=b.jobNo and a.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.is_self_order=1  order by b.production_date desc";
				$result_job=sql_select( $sql_job );
                foreach($result_job as $row)
                {
                    if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					//$production_date=date("d-m-Y", strtotime($row[csf('production_date')]));
					$production_date=change_date_format($row[csf('production_date')],'','',1);

					$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
					$cm_cost=($row[csf('available_min')]*$cost_per_minute)/$exchange_rate;

                    ?>
                    <tr bgcolor="<? echo  $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i;?>">
                        <td width="30"><? echo $i; ?></td>
                        <td width="110"><p><? echo change_date_format($row[csf('production_date')]) ?></p></td>
                        <td width="100" align="center"><? echo $buyer_array[$row[csf('buyer_name')]]; ?></td>
                        <td width="180"><p><? echo $row[csf('style_ref_no')]; ?></p></td>
                        <td width="110"><p><? echo $row[csf('job_no')]; ?></p></td>
                        <td align="right" width="80"><? echo fn_number_format($row[csf('available_min')],2,".",""); ?></td>
                        <td align="right" width="80"><? echo $row[csf('produce_min')]; ?>&nbsp;</td>
                        <td align="right" width="60"  title="Produced Min/Used  Min*100"><? echo fn_number_format(($row[csf('produce_min')]/$row[csf('available_min')])*100,2);//$job_effi_array[$row[csf('job_no')]]; ?>&nbsp;</td>
                        <td align="right" width="60"><? echo $cost_per_minute; ?>&nbsp;</td>
                        <td align="right" title="Used Min*CPM/Exchange Rate">
                            <?
                                echo fn_number_format($cm_cost,4);
                            ?>
                        </td>
                    </tr>
                <?
                	$i++;
					$total_cm+=$cm_cost;
					$tot_used_min+=$row[csf('available_min')];
					$tot_produce_min+=$row[csf('produce_min')];
                }
                ?>
                   <tr bgcolor="#CCCCCC">
                    <th width="30">&nbsp;</th>
                    <th width="110">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="180">&nbsp;</th>
                    <th width="110">&nbsp;</th>
					<th width="80"><?  echo fn_number_format($tot_used_min,2); ?></th>
                    <th width="80"><?  echo fn_number_format($tot_produce_min,2); ?></th>

                   <th width="60"><?  echo fn_number_format((($tot_produce_min/$tot_used_min)*100),2); ?></th>
                    <th width="60">&nbsp;</th>
                    <th align="right" style="color:#FFFFFF"> <?  echo fn_number_format($total_cm,4); ?></th>
                </tr>



			</table>
        </div>
	</fieldset>
	<?
	exit();
}

if($action=="report_generate2")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	$dealing_merchant_array = return_library_array("select id, team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$team_leader_library=return_library_array( "select id, team_leader_name from lib_marketing_team", "id", "team_leader_name");
	$cbo_budget_version=str_replace("'","",$cbo_budget_version);
	if($cbo_budget_version==2){
		$entry_from=158;
	}
	if($cbo_budget_version==3){
		$entry_from=520;
	}
	else{
		$entry_from=237;
	}
	if(str_replace("'","",$cbo_costcontrol_source)==2)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);

		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";



		$check_data=sql_select("select a.job_no,f.sew_effi_percent from wo_po_details_master a,production_logicsoft d,wo_pre_cost_mst f where  a.job_no=d.jobNo and  a.job_no=f.job_no  and  f.job_no=d.jobNo  and a.company_name=$company_name and f.entry_from=$entry_from and d.is_self_order=1 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no,f.sew_effi_percent");

		$chk_job_nos='';$sew_efficency=0;
		foreach($check_data as $row)
		{
			$chk_job_nos=$row[csf('job_no')];
			$sew_efficency=$row[csf('sew_effi_percent')];
		}
		if($chk_job_nos!='')
		{
			 $sql="select a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();

		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$sew_smv=$row[csf('set_smv')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." and ENTRY_FORM=18");
		oci_commit($con);
		
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//PO ID Ref from=1
		disconnect($con);

		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")"; else $po_cond_for_in="";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
		(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
		(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
		from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
		//$quotationId=1;
		//echo $quotationId;die;
		if($quotationId){
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;
			$sqlQua="select a.offer_qnty,a.costing_per,b.confirm_price,b.confirm_price_dzn,b.price_with_commn_pcs from wo_price_quotation a, wo_price_quotation_costing_mst b where a.id=b.quotation_id and a.id =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQua=sql_select($sqlQua);
			foreach($dataQua as $rowQua){
				$quaOfferQnty=$rowQua[csf('offer_qnty')];
				$quaConfirmPrice=$rowQua[csf('confirm_price')];
				$quaConfirmPriceDzn=$rowQua[csf('confirm_price_dzn')];
				$quaPriceWithCommnPcs=$rowQua[csf('price_with_commn_pcs')];
				$quaCostingPer=$rowQua[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
				if($quaCostingPer==2) $quaCostingPerQty=1;
				if($quaCostingPer==3) $quaCostingPerQty=24;
				if($quaCostingPer==4) $quaCostingPerQty=36;
				if($quaCostingPer==5) $quaCostingPerQty=48;
			}
		}

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		if($costPerQty>1){
			$costPerUom=($costPerQty/12)." Dzn";
		}else{
			$costPerUom=($costPerQty/1)." Pcs";
		}
		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
		// Yarn ============================
		$totYarn=0;
		$YarnData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
		//print_r($yarn_data_array);die;
		$sql_yarn="select count_id,copm_one_id,percent_one,type_id   from wo_pre_cost_fab_yarn_cost_dtls f where     f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id,copm_one_id,percent_one,type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row){
		//$yarnrate=$yarn_row[csf("rate")];
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		if($quotationId){
			$sql_yarn_pri="select f.id as yarn_id,f.cons_ratio,f.cons_qnty,f.rate,f.amount,count_id,copm_one_id,percent_one,type_id   from wo_pri_quo_fab_yarn_cost_dtls f where     f.quotation_id =".$quotationId." and f.is_deleted=0 and f.status_active=1  order by f.id";
			$data_arr_yarn_pri=sql_select($sql_yarn_pri);
			foreach($data_arr_yarn_pri as $yarn_row_pri){
				$yarnrate=$yarn_row_pri[csf("rate")];
		//$consQnty=($sql_yarn_pri[csf("cons_qnty")]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$consQnty=($yarn_row_pri[csf("cons_qnty")]/$quaCostingPerQty)*($quaOfferQnty);
		//echo "(".$sql_yarn_pri[csf("cons_qnty")]."/".$quaCostingPerQty.")*(".$quaOfferQnty.")";
				$amount=$consQnty*$yarnrate;
				$index="'".$yarn_row_pri[csf("count_id")]."_".$yarn_row_pri[csf("copm_one_id")]."_".$yarn_row_pri[csf("percent_one")]."_".$yarn_row_pri[csf("type_id")]."'";

				$YarnData[$index]['mkt']['qty']+=$consQnty;
				$YarnData[$index]['mkt']['amount']+=$amount;
			}
		}
	 //print_r($YarnData);
	 $yarn_recv =sql_select("select b.job_no,b.cons_amount,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a,inv_transaction b,product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
		foreach ($yarn_recv as $row) {
		//$index="'".$composition[$row[csf("yarn_comp_type1st")]]." ".$row[csf("yarn_comp_percent1st")].'%'."'";
			$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
			$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
		}
		//print_r($conv_yarn_arr);


		// $issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,d.booking_no,c.receive_basis from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id and a.trans_type in(4,5,6) and a.entry_form in(9,11) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1");
		$issue_return=sql_select("select A.QUANTITY AS QUANTITY,A.ISSUE_PURPOSE,A.RETURNABLE_QNTY, B.YARN_COUNT_ID,B.YARN_COMP_TYPE1ST, B.YARN_COMP_PERCENT1ST,B.YARN_TYPE,C.CONS_RATE,(A.QUANTITY*C.CONS_RATE) AS CONS_AMOUNT,C.ORDER_AMOUNT,C.RECEIVE_BASIS from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.trans_type in(4,5,6) and a.entry_form in(9,11)   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1");
		//echo "select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,c.cons_amount,c.order_amount,c.issue_id,d.booking_no,c.receive_basis from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id and a.trans_type in(4,5,6) and a.entry_form in(9,11) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";die;
		$YarnIssueReturn = $booking_req_return = array();
		foreach ($issue_return as $row) {
		$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if($row[csf("receive_basis")] == 1){
				//$YarnIssueReturn[$index]["qty"] += $row[csf("quantity")];
			}else{
				//$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
				//$booking_req_return[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			}
			$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
			$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
		}
		$YarnIssue=array();
		//print_r($YarnIssueReturn);
		// $issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3  and d.entry_form=3 and a.po_breakdown_id in(".implode(",",$poIdArr).") and d.issue_purpose not in(2,8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");
		$issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.trans_type=2 and a.entry_form=3  and d.entry_form=3  and d.issue_purpose not in(2,8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");


		$issue_arr = $booking_req = array();
		foreach ($issue_details as $row) {
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			if($row[csf("receive_basis")] == 1){
				//$issue_arr[$row[csf("booking_no")]]["issue_qnty"] += $row[csf("quantity")];
			}else{
			//	$issue_arr[$row[csf("requisition_no")]]['req_qnty'] += $row[csf("quantity")];
				//$booking_req[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			}
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}


		foreach($YarnIssue as $ind=>$value){
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
			//echo $value['amount'].'-'.$YarnIssueReturn[$ind]['amount'].'/'.$g_exchange_rate.'<br>';
		}

		$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		//echo $conversion1->getQuery(); die;
		//$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndProcess();
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion1= new conversion($condition1);
		//$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndProcess();
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();

		//  $sql_conv_yarn="select b.id as po_id,c.job_no,c.id as conv_id, d.composition  from   wo_po_break_down b,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cost_fabric_cost_dtls d  where  b.job_no_mst=c.job_no and c.job_no=d.job_no  and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(30) and b.is_deleted=0 and b.id in(".implode(",",$poIdArr).") and c.amount>0 ";
		$sql_conv_yarn="select b.id as po_id,c.job_no,c.id as conv_id, d.composition  from   wo_po_break_down b,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cost_fabric_cost_dtls d,gbl_temp_engine g  where  b.job_id=c.job_id and c.job_id=d.job_id  and c.fabric_description=d.id   and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.status_active=1 and c.cons_process in(30) and b.is_deleted=0  and c.amount>0 ";
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$index="".$row[csf("composition")]."";
			$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
			$conv_yarn_arr[$index]['acl']['qty']=$recv_yarn_arr[$row[csf("job_no")]]['qty'];
			$conv_yarn_arr[$index]['acl']['amount']=$recv_yarn_arr[$row[csf("job_no")]]['amt'];
		}
		//print_r($conv_yarn_arr);

		/* $sql="select x.*,(x.quantity*x.cons_rate) cons_amount from ( select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id, a.quantity,a.issue_purpose,a.returnable_qnty,a.is_sales,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type, c.cons_rate,d.issue_basis,d.booking_no,b.lot from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,wo_booking_mst e where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and d.booking_no=e.booking_no and a.trans_type in(2) and a.entry_form in(3) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and e.booking_type in(1,4) )x";
		$data_Yac=sql_select($sql);
		foreach($data_Yac as $row){
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}*/
		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		//echo $lot_tmp;
		$grey_fab_array=array();  //Knitting Cost actual
		// $sql_knit_prod="select c.yarn_lot,
		//  sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		//   from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.") and b.po_breakdown_id in(".implode(",",$poIdArr).") group by c.yarn_lot";
		$sql_knit_prod="select c.yarn_lot,
		 sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g where a.id=c.mst_id and c.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.")  group by c.yarn_lot";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			//$grey_fab_array[$row[csf("yarn_lot")]]['knit_grey_qty']+=$row[csf("grey_qnty")];
			//$grey_fab_array[$row[csf("yarn_lot")]]['knit_grey_amt']+=$row[csf("grey_qnty")]*$avg_rate;
			//echo $row[csf("grey_qnty")].'='.$avg_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
			$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
		// $sql_grey_trans="select c.from_order_id,a.from_prod_id, sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in, sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out, sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt, sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b where c.id=a.mst_id and a.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by  a.from_prod_id,c.from_order_id";// $result_grey_trans=sql_select( $sql_grey_trans );
		$sql_grey_trans="select c.from_order_id,a.from_prod_id, (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in, (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out, (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt, (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6)";
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$from_prodId_array[$row[csf('from_prod_id')]]=$row[csf('from_prod_id')];
		}
		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 3, $from_prodId_array, $empty_arr);//Prod ID Ref from=3
		disconnect($con);
		$avg_rate_array=return_library_array( "select b.id, b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18", "id", "avg_rate_per_unit"  );

		foreach ($result_grey_trans as $row)
		{
			//$grey_fab_trans_array['gtt'][$row[csf('yarn_lot')]]+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			$from_order_id.=$row[csf('from_order_id')].',';
			$grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			//$grey_fab_trans_amt_acl+=($row[csf('grey_in')]-$row[csf('grey_out')])*$avg_rate;
			$grey_fab_trans_amt_acl+=($row[csf('grey_in_amt')]-$row[csf('grey_out_amt')]);
		}
		//echo $grey_fab_trans_qty_acl.'='.$grey_fab_trans_amt_acl;
		$from_order_id=rtrim($from_order_id,',');
		$from_order_ids=array_unique(explode(",",$from_order_id));

		// $subconOutBillData="select b.order_id,
		// sum(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		// sum(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		// from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id in(".implode(",",$poIdArr).") group by b.order_id";
		$subconOutBillData="select b.order_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g  where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
			//$subconCostArray[$subRow[csf('order_id')]]['dye_finish_bill']+=$subRow[csf('dye_finish_bill')]/$g_exchange_rate;
		}
		//echo $knit_grey_amt.'='.$tot_knit_charge.'='.$knit_grey_qty;
		//$grey_fab_cost=$knit_grey_amt+$tot_knit_charge;
		//$tot_grey_fab_cost_acl=($grey_fab_cost/$knit_grey_qty)*$grey_fab_trans_qty_acl;


		// Transfer Fin Actual
				$fin_fab_trans_array=array();
				//  $sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, sum(b.quantity) as qnty,
				// 	sum(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
				// 	sum(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
				//  c.from_order_id
				//   from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by b.trans_type, b.po_breakdown_id,c.from_order_id,b.prod_id";
				$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
				(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
				(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
			 c.from_order_id
			  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) ";
				$result_fin_trans=sql_select( $sql_fin_trans );
				$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
				foreach ($result_fin_trans as $row)
				{
					$fin_from_order_id.=$row[csf('from_order_id')].',';
					$avg_rate=$avg_rate_array[$row[csf('prod_id')]];

						$fin_in_qnty+=$row[csf('in_qty')];
						$fin_out_qnty+=$row[csf('out_qty')];

						$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
						$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;

					//echo $fin_in_qnty.'='.$fin_out_qnty.',';
					//$fin_fab_trans_qty+=$in_qnty-$out_qnty;
					//$fin_fab_trans_amt+=($in_qnty-$out_qnty)*$avg_rate;
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}

				$po_ids=implode(",",$poIdArr);
				unset($result_fin_trans);
				$fin_from_order_id=rtrim($fin_from_order_id,',');
				$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

				$fin_trans_in_qty=$fin_in_qnty;
				$fin_trans_out_qty=$fin_out_qnty;

				$fin_trans_in_amt=$fin_in_amt;
				$fin_trans_out_amt=$fin_out_amt;

			//	echo $fin_trans_in_amt.'AA'.$fin_trans_out_amt;

				$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
				$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

				$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
				$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;
				if($from_order_id!="") //Grey Transfer
				{
					 $knit_cost=$knit_qty=0;
					 foreach($from_order_ids as $po_id)
					 {
						$knit_cost+=array_sum($conversion_costing_arr_process[$po_id][1]);
						 $knit_qty+=array_sum($conversion_costing_arr_process_qty[$po_id][1]);
					 }
				}
				if($fin_from_order_id!="") //Finish Transfer
				{
					$condition2= new condition();
					$condition2->po_id("in($fin_from_order_id)");
					$condition2->init();
					$conversion2= new conversion($condition2);
					//echo $conversion2->getQuery(); die;
					$fin_conversion_costing_arr_process=$conversion2->getAmountArray_by_orderAndProcess();
					//print_r($fin_conversion_costing_arr_process);
					$conversion2= new conversion($condition2);
					$fin_conversion_costing_arr_process_qty=$conversion2->getQtyArray_by_orderAndProcess();
					 foreach($fin_from_order_ids as $po_id)
					 {
						 $tot_dye_finish_cost_pre=0;$tot_dye_finish_cost_pre_qty=0;
						foreach($conversion_cost_head_array as $process_id=>$val)
						{
							if($process_id!=30 && $process_id!=1 && $process_id!=35) //Yarn Dyeing,Knitting,Aop
							{
								$tot_dye_finish_cost_pre+=array_sum($fin_conversion_costing_arr_process[$po_id][$process_id]);

								$tot_dye_finish_cost_pre_qty+=array_sum($fin_conversion_costing_arr_process_qty[$po_id][$process_id]);
							}
						}
					 }
				}
				$knit_charge=$knit_cost/$knit_qty;

		if($quotationId){
			 $pq_conv_yarn_data="select a.composition,b.quotation_id,b.cost_head,b.charge_unit,
				(CASE WHEN b.cons_type=30 THEN b.amount END) AS yarn_dyeing_cost,
				(CASE WHEN b.cons_type=30 THEN  b.req_qnty END) AS req_qnty
				from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.id=b.cost_head and b.quotation_id =".$quotationId." and b.cons_type=30 and b.status_active=1  and b.is_deleted=0";
				$result_price_conv_yarn=sql_select($pq_conv_yarn_data);
				foreach($result_price_conv_yarn as $p_row)
				{
					$pri_yarnrate=$p_row[csf("charge_unit")];
					$index="".$p_row[csf("composition")]."";
					$mktcons=($p_row[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$amount=$mktcons*$pri_yarnrate;
					$conv_yarn_arr[$index]['mkt']['amount']+=$amount;
					$conv_yarn_arr[$index]['mkt']['qty']+=$mktcons;
				}
			}

		//print_r($YarnData);
		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
		$fabPurArr=array();
		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		if($quotationId){
			$totMktcons=0; $totMktAmt=0;
			$sql = "select id, item_number_id, body_part_id, fab_nature_id, color_type_id, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pri_quo_fabric_cost_dtls where quotation_id='".$quotationId."' and fabric_source=2";
			$data_fabPur=sql_select($sql);
			foreach($data_fabPur as $fabPur_row){
			//$mktcons=($fabPur_row[csf('avg_cons')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($fabPur_row[csf('avg_cons')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$fabPur_row[csf('rate')];
				if($fabPur_row[csf('fab_nature_id')]==2){
					$fabPurArr['mkt']['knit']['qty']+=$mktcons;
					$fabPurArr['mkt']['knit']['amount']+=$mktamt;
				}
				if($fabPur_row[csf('fab_nature_id')]==3){
					$fabPurArr['mkt']['woven']['qty']+=$mktcons;
					$fabPurArr['mkt']['woven']['amount']+=$mktamt;
				}
			}
		}

		// $sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=1 and a.fabric_source=2 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=1 and a.fabric_source=2  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('item_category')]==2){
				$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
				if($fabPur_row[csf('grey_fab_qnty')]>0){
					$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
				}
			}
			if($fabPur_row[csf('item_category')]==3){
				$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
				if($fabPur_row[csf('grey_fab_qnty')]>0){
					$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
				}
			}
		}

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		//$knitData=array();
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		 $sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description  and a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				//echo $knitQtyArr[$row_knit[csf('po_id')]][$row_knit[csf('cons_process')]].'=';
				$knitData[$index]['pre']['qty']+=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']+=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}

		}
		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type=1";
			$data_knit=sql_select($sql);
			foreach($data_knit as $row_knit){
				$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
				if($row_knit[csf('cons_type')]==1){
				//$mktcons=($row_knit[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
					$mktcons=($row_knit[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$row_knit[csf('charge_unit')];
					$knitData[$index]['mkt']['qty']+=$mktcons;
					$knitData[$index]['mkt']['amount']+=$mktamt;
				}
			}
		}

		// $sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and   b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=14 and g.entry_form=18 and a.process_id=2 and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}

		// $sql = "select  b.delivery_qty,b.rate,b.amount,c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.delivery_qty,b.rate,b.amount,c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id  b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=14 and g.entry_form=18 and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('delivery_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$finishData=array();
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process not in(1,2,30,35)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
		}
		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type not in(1,2,30,35)";
			$data_finish=sql_select($sql);
			foreach($data_finish as $row_finish){
				$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
				//$mktcons=($row_finish[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row_finish[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row_finish[csf('charge_unit')];
				$finishData[$index]['mkt']['qty']+=$mktcons;
				$finishData[$index]['mkt']['amount']+=$mktamt;
			}
		}
		// $sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=4 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=4  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$aopData=array();
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$finishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$finishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}

		}

		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type=35";
			$data_aop=sql_select($sql);
			foreach($data_aop as $row_aop){
				$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
				if($row_aop[csf('cons_type')]==35){
				//$mktcons=($row_aop[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
					$mktcons=($row_aop[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$row_aop[csf('charge_unit')];
					$finishData[$index]['mkt']['qty']+=$mktcons;
					$finishData[$index]['mkt']['amount']+=$mktamt;
				}
			}
		}

		/*$sql = "select  b.batch_issue_qty, b.rate, b.amount, b.currency_id, b.exchange_rate,b.process_id from inv_receive_mas_batchroll a, pro_grey_batch_dtls b where a.id=b.mst_id and b.process_id=35 and b.job_no ='".$jobNumber."' and  b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			if($row_aop[csf('process_id')]==35){
				$exchange_rate=$row_aop[csf('batch_issue_qty')];
				if(!$exchange_rate){
					$exchange_rate=1;
				}
				$aopData['acl']['qty']+=$row_aop[csf('batch_issue_qty')];
				$aopData['acl']['amount']+=$row_aop[csf('amount')]/$exchange_rate;
			}
		}*/

		// $sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id  and a.process_id=4 and b.sub_process_id in(31,35) and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=4 and b.sub_process_id in(31,35)  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			//$index=$row_aop[csf('product_name_details')];
			//$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('febric_description_id')]."'";
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
		}

		// Fabric AOP  End============================



		// Trim Cost ============================

		//$trim_group=return_library_array( "select item_name,id from  lib_item_group", "id", "item_name" );
		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group  ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}
		//print_r($trim_groupArr);
		$trimData=array();
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();

		$trim= new trims($condition);
		//$trimAmtArr=$trim->getAmountArray_by_jobAndItemid();
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$jobNumber][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$jobNumber][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		if($quotationId){
			$sql = "select id,  trim_group, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active from wo_pri_quo_trim_cost_dtls  where quotation_id='".$quotationId."' and status_active=1";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$trimData[$row[csf('trim_group')]]['mkt']['qty']+=$mktcons;
				$trimData[$row[csf('trim_group')]]['mkt']['amount']+=$mktamt;
				$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
			}
		}
		$trimsRecArr=array();
		// $receive_qty_data=sql_select("select b.po_breakdown_id, d.item_group_id, b.id as prop_id, b.quantity as quantity, a.order_rate as rate, a.cons_rate, a.payment_over_recv
		// from inv_receive_master c, product_details_master d, inv_transaction a, order_wise_pro_details b
		// where a.mst_id=c.id and a.id=b.trans_id and a.prod_id=d.id and a.transaction_type=1 and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ");
		$receive_qty_data=sql_select("select b.po_breakdown_id, d.item_group_id, b.id as prop_id, b.quantity as quantity, a.order_rate as rate, a.cons_rate, a.payment_over_recv  
		from inv_receive_master c, product_details_master d, inv_transaction a, order_wise_pro_details b,gbl_temp_engine g 
		where a.mst_id=c.id and a.id=b.trans_id and a.prod_id=d.id and d.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.transaction_type=1 and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ");
		foreach($receive_qty_data as $row){
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['rate']=$row[csf('rate')];
			//$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			$trimsRecArr[$row[csf('item_group_id')]]['cons_uom']=$trim_groupArr[$row[csf('item_group_id')]]['cons_uom'];
			if($row[csf('payment_over_recv')] !=1)
			{
				$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			}
		}
		//print_r($trimsRecArr);
		$trimsRecReArr=array();
		// $receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d  where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  d.po_breakdown_id in(".implode(",",$poIdArr).")");
		$receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d,gbl_temp_engine g   where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and d.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0");
		foreach($receive_rtn_qty_data as $row){
			$trimsRecReArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecReArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];//$trimsRecArr[$row[csf('item_group_id')]]['rate'];
		}
		// $sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		// (CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		// (CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		// (CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		// (CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		// c.from_order_id
		// from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.dtls_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") ";
		$sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		(CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		(CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		c.from_order_id
		from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.dtls_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6)  ";
		$result_trim_trans=sql_select( $sql_trim_trans );
		$trim_in_qnty=$trim_out_qnty=$trim_in_amt=$trim_out_amt=0;
		foreach ($result_trim_trans as $row)
		{
		$trim_from_order_id.=$row[csf('from_order_id')].',';
		$rate=$row[csf('rate')];
		$con_factor=$trim_groupArr[$row[csf('item_group')]]['con_factor'];
		$trimsRecArr[$row[csf('item_group')]]['in_qty']+=$row[csf('in_qty')]*$con_factor;
		$trimsRecArr[$row[csf('item_group')]]['out_qty']+=$row[csf('out_qty')]*$con_factor;
		$trimsRecArr[$row[csf('item_group')]]['in_amt']+=$row[csf('in_qty')]*$con_factor*$rate;
		$trimsRecArr[$row[csf('item_group')]]['out_amt']+=$row[csf('out_qty')]*$con_factor*$rate;

		}

		foreach($trimsRecArr as $ind=>$value){
			$trimData[$ind]['acl']['qty']+=($trimsRecArr[$ind]['qty']+$trimsRecArr[$ind]['in_qty'])-($trimsRecReArr[$ind]['qty']+$trimsRecArr[$ind]['out_qty']);
			$trimData[$ind]['acl']['amount']+=($trimsRecArr[$ind]['amount']+$trimsRecArr[$ind]['in_amt'])-($trimsRecReArr[$ind]['amount']+$trimsRecArr[$ind]['out_amt']);
			$trimData[$ind]['cons_uom']=$trimsRecArr[$ind]['cons_uom'];
		}

		//print_r($trimData);

		// Trim Cost End============================
		// Embl Cost ============================
		$embData=array();
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and emb_name !=3";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['pre']['qty']+=$embQtyArr[$jobNumber][$row[csf('id')]];
			$embData['pre']['amount']+=$embAmtArr[$jobNumber][$row[csf('id')]];
		}
		//print_r($embData);
		if($quotationId){
			$sql = "select id, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pri_quo_embe_cost_dtls where quotation_id='".$quotationId."' and emb_name !=3";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$embData['mkt']['qty']+=$mktcons;
				$embData['mkt']['amount']+=$mktamt;
			}
		}
		// $sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=6 and b.emblishment_name !=3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g  where a.booking_no=b.booking_no and  b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and b.emblishment_name !=3  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];

		}
		// Embl Cost End ============================
		// Wash Cost ============================
		$washData=array();
		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and emb_name =3";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['pre']['qty']+=$washQtyArr[$jobNumber][$row[csf('id')]];
			$washData['pre']['amount']+=$washAmtArr[$jobNumber][$row[csf('id')]];
		}
		if($quotationId){
			$sql = "select id, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pri_quo_embe_cost_dtls where quotation_id='".$quotationId."' and emb_name =3";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$washData['mkt']['qty']+=$mktcons;
				$washData['mkt']['amount']+=$mktamt;
			}
		}
		// $sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=6 and b.emblishment_name =3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and b.emblishment_name =3  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}
		// Wash Cost End ============================
		// Commision Cost  ============================
		$commiData=array();
		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		if($quotationId){
			$sql = "select id,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pri_quo_commiss_cost_dtls  where quotation_id='".$quotationId."'";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktamt=($row[csf('commission_amount')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktamt=($row[csf('commission_amount')]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['qty']=$quaOfferQnty;
				$commiData['mkt']['amount']+=$mktamt;
				$commiData['mkt']['rate']+=$mktamt/$quaOfferQnty;
			}
		}
		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}

				$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;

			//echo $commaAmtArr[$jobNumber][$row[csf('id')]].'/'.$exfactory_qty;
		}
		if($quotationId){
			$sql = "select id, item_id, rate, amount, status_active from  wo_pri_quo_comarcial_cost_dtls where quotation_id=".$quotationId."";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktamt=($row[csf('amount')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktamt=($row[csf('amount')]/$quaCostingPerQty)*($quaOfferQnty);
				$commaData['mkt']['qty']=$quaOfferQnty;
				$commaData['mkt']['amount']+=$mktamt;
				$commaData['mkt']['rate']+=$mktamt/$quaOfferQnty;
			}
		}
		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$otherData=array();
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id ,lab_test ,inspection  ,cm_cost ,freight ,currier_pre_cost ,certificate_pre_cost ,common_oh ,depr_amor_pre_cost,design_cost  from  wo_pre_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['design_cost']['qty']=$jobQty;
			$otherData['pre']['design_cost']['amount']=$other_cost[$jobNumber]['design_cost'];
			$otherData['pre']['design_cost']['rate']=$other_cost[$jobNumber]['design_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}
		if($quotationId){
			$sql = "select id ,lab_test ,inspection  ,cm_cost ,freight ,currier_pre_cost ,certificate_pre_cost ,common_oh,design_pre_cost as design_cost ,depr_amor_pre_cost  from  wo_price_quotation_costing_mst where quotation_id='".$quotationId."'";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
				$freightAmt=($row[csf('freight')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['qty']=$quaOfferQnty;
				$otherData['mkt']['freight']['amount']=$freightAmt;
				$otherData['mkt']['freight']['rate']=$freightAmt/$quaOfferQnty;

				$labTestAmt=($row[csf('lab_test')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['qty']=$quaOfferQnty;
				$otherData['mkt']['lab_test']['amount']=$labTestAmt;
				$otherData['mkt']['lab_test']['rate']=$labTestAmt/$quaOfferQnty;

				$inspectionAmt=($row[csf('inspection')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['inspection']['qty']=$quaOfferQnty;
				$otherData['mkt']['inspection']['amount']=$inspectionAmt;
				$otherData['mkt']['inspection']['rate']=$inspectionAmt/$quaOfferQnty;

				$design_costAmt=($row[csf('design_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['design_cost']['qty']=$quaOfferQnty;
				$otherData['mkt']['design_cost']['amount']=$design_costAmt;
				$otherData['mkt']['design_cost']['rate']=$design_costAmt/$quaOfferQnty;

				$currierPreCostAmt=($row[csf('currier_pre_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['currier_pre_cost']['qty']=$quaOfferQnty;

				$otherData['mkt']['currier_pre_cost']['amount']=$currierPreCostAmt;
				$otherData['mkt']['currier_pre_cost']['rate']=$currierPreCostAmt/$quaOfferQnty;

				$cmCostAmt=($row[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['qty']=$quaOfferQnty;
				$otherData['mkt']['cm_cost']['amount']=$cmCostAmt;
				$otherData['mkt']['cm_cost']['rate']=$cmCostAmt/$quaOfferQnty;
			}
		}
		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0  order by id desc");
			foreach($sql_std_para as $row )
			{
				$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
				$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
				$diff=datediff('d',$applying_period_date,$applying_period_to_date);
				for($j=0;$j<$diff;$j++)
				{
					//$newDate=add_date(str_replace("'","",$applying_period_date),$j);
					$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);

					$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
					//$asking_profit_arr[$newDate]['max_profit']=$ask_row[csf('max_profit')];
				}
			}

	 $sql_cm_cost="select  jobNo, available_min,production_date from production_logicsoft where  jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			//$production_date=date("d-m-Y", strtotime($row[csf('production_date')]));

			$production_date=change_date_format($row[csf('production_date')],'','',1);

			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		//  $sql="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where po_id in(".implode(",",$poIdArr).")";
		$sql="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  ";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['freight']['rate']=$row[csf('freight')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['lab_test']['rate']=$row[csf('lab_test')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['inspection']['rate']=$row[csf('inspection')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['currier_pre_cost']['rate']=$row[csf('currier_pre_cost')];
			}
			if($row[csf('cost_head')]==7){
				$otherData['acl']['design_cost']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['cm_cost']['rate']=$row[csf('cm_cost')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
		//$commaData['acl']['cm_cost']['rate']=$row[csf('cm_cost')];
			}

		}
		// Other Cost End ============================
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."   and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);

		ob_start();
		?>
		<div style="width:1202px; margin:0 auto">
			<div style="width:1200px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1200px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="5" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td> <td><p><? echo $team_leaders;?></p></td>
					<td>Dealing Marchant</td><td><p><? echo $dealing_marchants;?> </p></td>
					<td>Unit Price</td>
					<td align="right"><? echo number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="3"><? echo implode(",",$gmtsItemArr); ?></td>
                    <td>Efficiency : <? echo $sew_efficency; ?></td>
                    <td>SMV : <? echo $sew_smv; ?></td>
					<td>Ship Qty</td>
					<td align="right"> <? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right"><? echo number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>
			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr align="center" style="font-weight:bold">
					<td width="200">Item Description</td>
					<td width="60">UOM</td>
					<td width="100">Marketing Qty</td>
					<td width="100">Marketing Price</td>
					<td width="100">Marketing Value</td>
					<td width="100">Pre-Cost Qty</td>
					<td width="100">Pre-Cost Price</td>
					<td width="100">Pre-Cost Value</td>
					<td width="100">Actual Qty</td>
					<td width="100">Actual Price</td>
					<td width="100">Actual Value</td>
				</tr>
				<tr style="font-weight:bold" class="yarn">
					<td colspan="12">Yarn including yarn dyed</td>
				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0;

				$yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0;

				$totalMktValue=0; $totalPreValue=0; $totalAclValue=0;

				$totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];

					$totalMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="200"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$y++;
				}

				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row ){
					$totalMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					$totalAclQty+=number_format($yarn_acl_qty,4,".","");
					?>

				 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="200" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($yarn_acl_qty,4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
				<?
				$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Yarn Total</td>
					<td width="60"></td>
					<td width="100" align="right">
						<?
						echo number_format($totalMktQty,4);
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo number_format($totalMktValue,4);
						$yarnTrimMktValue+=number_format($totalMktValue,4,".","");
						$GrandTotalMktValue+=number_format($totalMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<?
						echo number_format($totalPreQty,4);
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalPreValue>$totalMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalPreValue,4);
						$yarnTrimPreValue+=number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','1')"><? echo number_format($totalAclQty,4); ?></A>
					</td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalAclValue>$totalPreValue){echo "red";} else{echo "";}?>">
						<?
						echo number_format($totalAclValue,4);
						$yarnTrimAclValue+=number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=number_format($totalAclValue,4,".","");
						?>
					</td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="200" >Fabric Purchase Cost (Knit)</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['knit']['amount']/$fabPurArr['mkt']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="200" >Fabric Purchase Cost (Woven)</td>
					<td width="60">Yds</td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						$fabPurMkt= number_format($fabPurArr['mkt']['woven']['amount'],4,".","")+number_format($fabPurArr['mkt']['knit']['amount'],4,".","");
						echo  number_format($fabPurMkt,4);
						$GrandTotalMktValue+=number_format($fabPurMkt,4,".","");
						$fabPurPre= number_format($fabPurArr['pre']['woven']['amount'],4,".","")+number_format($fabPurArr['pre']['knit']['amount'],4,".","");
						$fabPurAcl= number_format($fabPurArr['acl']['woven']['amount'],4,".","")+number_format($fabPurArr['acl']['knit']['amount'],4,".","");

						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<?
						echo  number_format($fabPurPre,4);
						$GrandTotalPreValue+=number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  number_format($fabPurAcl,4);
						$GrandTotalAclValue+=number_format($fabPurAcl,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="12">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0;
				$totalKnitPreValue=0;
				$totalKnitAclValue=0;

				$totalKniMktQty=0;
				$totalKnitPreQty=0;
				$totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=number_format($row['acl']['qty'],4,".","");
				//$knitDesArr[$index]=$body_part[$row_knit[csf('body_part_id')]].", ".$color_type[$row_knit[csf('color_type_id')]].", ".$row_knit[csf('fabric_description')].", ".$row_knit[csf('gsm_weight')];
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="200"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="60"></td>
					<td width="100" align="right">
						<? echo number_format($totalKniMktQty,4);?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<? echo number_format($totalKniMktValue,4);
						$GrandTotalMktValue+=number_format($totalKniMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo number_format($totalKnitPreQty,4);?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo number_format($totalKnitAclQty,4);?></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=number_format($totalKnitAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="dyfi">
					<td colspan="12">Dye , Fin & Aop Cost</td>
				</tr>
				<?
				$totalFinMktValue=0;
				$totalFinPreValue=0;
				$totalFinAclValue=0;

				$totalFinMktQty=0;
				$totalFinPreQty=0;
				$totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="dyfi" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="200"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish & AOP Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">
						<? echo number_format($totalFinMktQty,4);?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" >
						<?
						echo number_format($totalFinMktValue,4);
						$GrandTotalMktValue+=number_format($totalFinMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo number_format($totalFinPreQty,4);?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"  bgcolor=" <? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo number_format($totalFinAclQty,4);?></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=number_format($totalFinAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="200" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo number_format($aopData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($aopData['mkt']['amount']/$aopData['mkt']['qty'],4)?></td>
					<td width="100" align="right"><? echo number_format($aopData['mkt']['amount'],4); //$GrandTotalMktValue+=number_format($aopData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($aopData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($aopData['pre']['amount'],4,".","")>number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($aopData['pre']['amount'],4); //$GrandTotalPreValue+=number_format($aopData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($aopData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($aopData['acl']['amount'],4,".","")>number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($aopData['acl']['amount'],4); //$GrandTotalAclValue+=number_format($aopData['acl']['amount'],4,".","");?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="12">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;//$tot_grey_fab_cost=($grey_fab_cost/$knit_grey_qty)*$grey_fab_trans_qty;;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="200">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? //echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><? echo number_format($tot_grey_fab_cost_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo number_format($tot_grey_fab_cost_acl,4); ?></A><? //echo number_format($tot_grey_fab_cost_acl,4); ?></td>
					</tr>

				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="200">Finished Fabric Cost</td>
						<td width="60">Kg</td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"><? echo number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><? echo number_format($tot_fin_fab_transfer_cost/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo number_format($tot_fin_fab_transfer_cost,4); ?></A><? //echo number_format($tot_fin_fab_transfer_cost,4); ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">

					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" >

					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">

					</td>
					<td width="100" align="right"><? echo number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="100"  align="right"><? echo number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="100" align="right">
						<?
						echo number_format($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl,4);
						$total_grey_fin_fab_transfer_actl_cost=$tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl;
						$GrandTotalAclValue+=number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
				</tr>

				<tr>
					<td colspan="12" style="font-weight:bold">Trims Cost</td>
				</tr>
				<?
				$t=1;
				$totalTrimMktValue=0;
				$totalTrimPreValue=0;
				$totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					$item_descrition = $trim_groupArr[$index]['item_name'];
					$totalTrimMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalTrimPreValue+=number_format($row['pre']['amount'],4,".","");
					$totalTrimAclValue+=number_format($row['acl']['amount'],4,".","");
					if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
						<td width="200"><? echo $item_descrition ?></td>
						<td width="60"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"  bgcolor=" <? if(number_format($row['pre']['amount'],4,'.','')>number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(number_format($row['acl']['amount'],4,".","")>number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$t++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" >Trims Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=number_format($totalTrimMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if(number_format($totalTrimPreValue,4,".","")>number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalTrimAclValue,4);
						$yarnTrimAclValue+=number_format($totalTrimAclValue,4,".","");
						$GrandTotalAclValue+=number_format($totalTrimAclValue,4,".","");
						?>
					</td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="200" >Embellishment Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=number_format($embData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($embData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($embData['pre']['amount'],4,".","")>number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($embData['pre']['amount'],4); $totalOtherPreValue+=number_format($embData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($embData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($embData['acl']['amount'],4,".","")>number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($embData['acl']['amount'],4); $totalOtherAclValue+=number_format($embData['acl']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="200" >Wash Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($washData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($washData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($washData['mkt']['amount'],4); $totalOtherMktValue+=number_format($washData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($washData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($washData['pre']['amount'],4,".","")>number_format($washData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($washData['pre']['amount'],4);$totalOtherPreValue+=number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($washData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($washData['acl']['amount'],4,".","")>number_format($washData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($washData['acl']['amount'],4);$totalOtherAclValue+=number_format($washData['acl']['amount'],4,".",""); ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="200" >Commission Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=number_format($commiData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($commiData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($commiData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($commiData['pre']['amount'],4,".","")>number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right">
						<?
			//$aclCommiAmt=($commiData['pre']['rate']/($costPerQty*$totalSetQnty))*$exfactoryQty;
						$aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty;
			//echo "(".$commiData['pre']['rate']."/(".$costPerQty*$totalSetQnty."))*".$exfactoryQty;
						echo number_format($aclCommiAmt/$exfactoryQty,4);

						?>
					</td>
					<td width="100" align="right" bgcolor="<? if(number_format($aclCommiAmt,4,".","")>number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>">
						<?
						echo number_format($aclCommiAmt,4);
						$totalOtherAclValue+=$aclCommiAmt;
						?>
					</td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="200" >Commercial Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=number_format($commaData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($commaData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($commaData['pre']['amount'],4,".","")>number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? echo  number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($exfactoryQty*$commaData['pre']['rate'],4,".","")>number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($exfactoryQty*$commaData['pre']['rate'],4); $totalOtherAclValue+=number_format($exfactoryQty*$commaData['pre']['rate'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="200" >Freight Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=number_format($otherData['mkt']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['pre']['freight']['amount'],4,".","")>number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($otherData['acl']['freight']['amount'],4,".","")>number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['freight']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="200" >Testing Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['pre']['lab_test']['amount'],4,".","")>number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['lab_test']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['acl']['lab_test']['amount'],4,".","")>number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['lab_test']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['lab_test']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="200" >Inspection Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['pre']['inspection']['amount'],4,".","")>number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['acl']['inspection']['amount'],4,".","")>number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['inspection']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="200" >Courier Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['currier_pre_cost']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
				</tr>
                <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trdc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trdc_<? echo $embl; ?>">
					<td width="200" >Design Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['design_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['design_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['design_cost']['amount'],4);$totalOtherMktValue+=number_format($otherData['mkt']['design_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['design_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['design_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($otherData['pre']['design_cost']['amount'],4,".","")>number_format($otherData['mkt']['design_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['design_cost']['amount'],4);$totalOtherPreValue+=number_format($otherData['pre']['design_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['design_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['acl']['design_cost']['amount'],4,".","")>number_format($otherData['pre']['design_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['design_cost']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['design_cost']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="200" >Making Cost (CM)</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['pre']['cm_cost']['amount'],4,".","")>number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<?
					if(number_format($otherData['acl']['cm_cost']['amount'],4,".","")>number_format($otherData['pre']['cm_cost']['amount'],4,".",""))
					{
						$font_color="white";
					}
					else
					{
						$font_color="black";
					}
					?>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['cm_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($otherData['acl']['cm_cost']['amount'],4,".","")>number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=number_format($otherData['acl']['cm_cost']['amount'],4,".","");?><A href="#report_details" style="color:<? echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"><? echo number_format($otherData['acl']['cm_cost']['amount'],4); ?></A></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" >Others Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo number_format($totalOtherMktValue,4);
						$GrandTotalMktValue+=number_format($totalOtherMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalOtherPreValue,4);
						$GrandTotalPreValue+=number_format($totalOtherPreValue,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<?
						echo number_format($totalOtherAclValue,4);
						$GrandTotalAclValue+=number_format($totalOtherAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="200" >Grand Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"><? echo number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo number_format($GrandTotalPreValue,4);?></td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo number_format($GrandTotalAclValue,4);?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="200" >Shipment Value</td>
					<td width="60"></td>
					<td width="100" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="100" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="100" align="right">
						<?
						$quaOfferValue=$quaOfferQnty *$quaPriceWithCommnPcs;
						echo number_format($quaOfferValue,4)
						?>
					</td>
					<td width="100" align="right"><? echo $jobQty ?></td>
					<td width="100" align="right" title="<? echo $unitPrice;?>"><? echo number_format($unitPrice,4) ?></td>
					<td width="100" align="right"><? echo number_format($jobValue,4) ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="100" align="right"><? echo number_format($exfactoryValue,4) ?></td>
				</tr>
			</table>
			<strong>Profit Summary </strong>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right"><? echo number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="200" align="right"><? echo number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}
	else if(str_replace("'","",$cbo_costcontrol_source)==1 || str_replace("'","",$cbo_costcontrol_source)==3)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		$control_source_id=str_replace("'","",$cbo_costcontrol_source);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("select a.job_no from wo_po_details_master a,production_logicsoft d,wo_pre_cost_mst f where  a.job_no=d.jobNo and  a.job_no=f.job_no  and  f.job_no=d.jobNo  and a.company_name=$company_name and f.entry_from=$entry_from and d.is_self_order=1 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row)
		{
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
			$sql="select a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();

		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."   and ENTRY_FORM=18");
		oci_commit($con);
		
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//PO ID Ref from=1
		disconnect($con);

		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")"; else $po_cond_for_in="";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
		//$quotationId=1;

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		if($costPerQty>1){
			$costPerUom=($costPerQty/12)." Dzn";
		}else{
			$costPerUom=($costPerQty/1)." Pcs";
		}
		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
		// Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array(); $washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
		//print_r($yarn_data_array);
		$sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/*echo "<pre>";
		print_r($YarnData); die;*/

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group  ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}
		$qc_entry_form="";
		if($control_source_id==3){
			$qc_entry_form="and a.entry_from=458";
		}
		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			$sqlQc="select a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.qc_no =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 $qc_entry_form";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
			}
			unset($dataQc);
		//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$quotationId." order by id asc";
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1)
				{
					if($rowConsRate[csf("rate_data")]!="")
					{
						$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];
						//echo $edata[3].'='.$edata[7].'='.$edata[11].'='.$rowConsRate[csf("tot_cons")].'='.$quaOfferQnty.'<br>';
						if($rowConsRate[csf("rate_data")]!="")
						{
							$qYarnData[$index]['mkt']['qty']+=$consQnty;
							$qYarnData[$index]['mkt']['amount']+=$amount;
						}

						/*$index=""; $mktcons=$mktamt=0;
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;*/

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[14];
						$knitData[$index]['mkt']['qty']+=$mktcons;
						$knitData[$index]['mkt']['amount']+=$mktamt;

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$rate=0;
						$rate=$edata[15]+$edata[16]+$edata[17];
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rate;
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;

						/*$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[16];
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;*/
					}
					else
					{
						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						//echo $mktcons.'-'.$mktamt.'-'.$rowConsRate[csf('tot_cons')].'-'.$quaCostingPerQty.'-'.$quaOfferQnty.'<br>';
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;
					}
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$washData['mkt']['qty']+=$mktcons;
					$washData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]!=3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['qty']+=$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['amount']+=$mktamt;
					$trimData[$rowConsRate[csf('particular_type_id')]]['cons_uom']=$rowConsRate[csf('cons_uom')];
				}
			}
			//echo "<pre>";
			//print_r($trimData);
			//die;

			$sql_item_summ="select mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$quotationId." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}

	 	//print_r($qYarnData);
	 	$yarn_recv =sql_select("select b.job_no,b.cons_amount,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a,inv_transaction b,product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
		foreach ($yarn_recv as $row)
		{
			$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
			$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
		}
		//print_r($conv_yarn_arr);

		// $issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,d.booking_no,c.receive_basis from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id and a.trans_type in(4,5,6) and a.entry_form in(9,11) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1");
		$issue_return=sql_select("select a.quantity as quantity,a.issue_purpose,a.returnable_qnty, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.trans_type in(4,5,6) and a.entry_form in(9,11)   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1");
		$YarnIssueReturn = $booking_req_return = array();
		foreach ($issue_return as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
			$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
		}
		$YarnIssue=array();
		//print_r($YarnIssueReturn);
		// $issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3  and d.entry_form=3 and a.po_breakdown_id in(".implode(",",$poIdArr).") and d.issue_purpose not in(2,8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");
		$issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g  where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.trans_type=2 and a.entry_form=3  and d.entry_form=3  and d.issue_purpose not in(2,8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");

		$issue_arr = $booking_req = array();
		foreach ($issue_details as $row)
		{
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}

		foreach($YarnIssue as $ind=>$value){
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
		}
		//echo "<pre>";
		//print_r($YarnData); die;

		$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();

		//  $sql_conv_yarn="select b.id as po_id, c.job_no, c.id as conv_id, d.composition from wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d  where  b.job_no_mst=c.job_no and c.job_no=d.job_no  and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(30) and b.is_deleted=0 and b.id in(".implode(",",$poIdArr).") and c.amount>0 ";
		$sql_conv_yarn="select b.id as po_id, c.job_no, c.id as conv_id, d.composition from wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d,gbl_temp_engine g  where  b.job_id=c.job_id and c.job_id=d.job_id  and c.fabric_description=d.id  and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.status_active=1 and c.cons_process in(30) and b.is_deleted=0 and c.amount>0 ";
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$index="".$row[csf("composition")]."";
			$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
			$conv_yarn_arr[$index]['acl']['qty']=$recv_yarn_arr[$row[csf("job_no")]]['qty'];
			$conv_yarn_arr[$index]['acl']['amount']=$recv_yarn_arr[$row[csf("job_no")]]['amt'];
		}
		//print_r($conv_yarn_arr);

		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		//echo $lot_tmp;
		$grey_fab_array=array();  //Knitting Cost actual
		// $sql_knit_prod="select c.yarn_lot,
		//  sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		//   from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.") and b.po_breakdown_id in(".implode(",",$poIdArr).") group by c.yarn_lot";
		$sql_knit_prod="select c.yarn_lot,
		 sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g where a.id=c.mst_id and c.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.")  group by c.yarn_lot";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
		//$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
		// $sql_grey_trans="select c.from_order_id,a.from_prod_id,
		//  sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		//  sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		//   sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		//   sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		//   from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b where c.id=a.mst_id and a.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by  a.from_prod_id,c.from_order_id";//
		$sql_grey_trans="select c.from_order_id,a.from_prod_id,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		  from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g  where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) ";
		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_idArr[$row[csf('from_prod_id')]]=$row[csf('from_prod_id')];
			
		}
		$con = connect();
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 3, $from_prod_idArr, $empty_arr);//Prod ID Ref from=3
		disconnect($con);
		 
		 $avg_rate_array=return_library_array( "select b.id, b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18", "id", "avg_rate_per_unit"  );

		$result_grey_trans=sql_select( $sql_grey_trans );
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			$from_order_id.=$row[csf('from_order_id')].',';
			$grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$grey_fab_trans_amt_acl+=($row[csf('grey_in_amt')]-$row[csf('grey_out_amt')]);
		}
		$from_order_id=rtrim($from_order_id,',');
		$from_order_ids=array_unique(explode(",",$from_order_id));

		// $subconOutBillData="select b.order_id,
		// sum(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		// sum(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		// from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id in(".implode(",",$poIdArr).") group by b.order_id";
		$subconOutBillData="select b.order_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g  where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
		}

		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		// $sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, sum(b.quantity) as qnty,
		// 	sum(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		// 	sum(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		//  c.from_order_id
		//   from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by b.trans_type, b.po_breakdown_id,c.from_order_id,b.prod_id";
		$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
			(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
			(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		 c.from_order_id
		  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) ";
		$result_fin_trans=sql_select( $sql_fin_trans );
		$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
		foreach ($result_fin_trans as $row)
		{
			$fin_from_order_id.=$row[csf('from_order_id')].',';
			$avg_rate=$avg_rate_array[$row[csf('prod_id')]];

			$fin_in_qnty+=$row[csf('in_qty')];
			$fin_out_qnty+=$row[csf('out_qty')];

			$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
			$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;
		}

		$po_ids=implode(",",$poIdArr);
		unset($result_fin_trans);
		$fin_from_order_id=rtrim($fin_from_order_id,',');
		$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

		$fin_trans_in_qty=$fin_in_qnty;
		$fin_trans_out_qty=$fin_out_qnty;

		$fin_trans_in_amt=$fin_in_amt;
		$fin_trans_out_amt=$fin_out_amt;

		//	echo $fin_trans_in_amt.'AA'.$fin_trans_out_amt;

		$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
		$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

		$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
		$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;
		if($from_order_id!="") //Grey Transfer
		{
			 $knit_cost=$knit_qty=0;
			 foreach($from_order_ids as $po_id)
			 {
				$knit_cost+=array_sum($conversion_costing_arr_process[$po_id][1]);
				 $knit_qty+=array_sum($conversion_costing_arr_process_qty[$po_id][1]);
			 }
		}
		if($fin_from_order_id!="") //Finish Transfer
		{
			$condition2= new condition();
			$condition2->po_id("in($fin_from_order_id)");
			$condition2->init();
			$conversion2= new conversion($condition2);
			//echo $conversion2->getQuery(); die;
			$fin_conversion_costing_arr_process=$conversion2->getAmountArray_by_orderAndProcess();
			//print_r($fin_conversion_costing_arr_process);
			$conversion2= new conversion($condition2);
			$fin_conversion_costing_arr_process_qty=$conversion2->getQtyArray_by_orderAndProcess();
			 foreach($fin_from_order_ids as $po_id)
			 {
				$tot_dye_finish_cost_pre=0;$tot_dye_finish_cost_pre_qty=0;
				foreach($conversion_cost_head_array as $process_id=>$val)
				{
					if($process_id!=30 && $process_id!=1 && $process_id!=35) //Yarn Dyeing,Knitting,Aop
					{
						$tot_dye_finish_cost_pre+=array_sum($fin_conversion_costing_arr_process[$po_id][$process_id]);

						$tot_dye_finish_cost_pre_qty+=array_sum($fin_conversion_costing_arr_process_qty[$po_id][$process_id]);
					}
				}
			 }
		}
		$knit_charge=$knit_cost/$knit_qty;



		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		// $sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=1 and a.fabric_source=2 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.booking_type=1 and a.fabric_source=2  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$data_fabPur=sql_select($sql);
			foreach($data_fabPur as $fabPur_row){
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				$knitData[$index]['pre']['qty']=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}
		}

		// $sql = "select b.receive_qty, b.rate, b.amount, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select b.receive_qty, b.rate, b.amount, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and   b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}

		// $sql = "select  b.delivery_qty, b.rate, b.amount, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.delivery_qty, b.rate, b.amount, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g  where a.id=b.mst_id and b.item_id=c.id  and   b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=2  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('delivery_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_no='".$jobNumber."' and b.cons_process not in(1,2,30,35)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
		}

		// $sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=4 and b.order_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and  b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=4 and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$finishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$finishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}
		}


		// $sql = "select  b.batch_issue_qty, b.rate, b.amount, b.currency_id, b.exchange_rate,b.process_id from inv_receive_mas_batchroll a, pro_grey_batch_dtls b where a.id=b.mst_id and b.process_id=35 and b.job_no ='".$jobNumber."' and  b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.batch_issue_qty, b.rate, b.amount, b.currency_id, b.exchange_rate,b.process_id from inv_receive_mas_batchroll a, pro_grey_batch_dtls b,gbl_temp_engine g  where a.id=b.mst_id and   b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.process_id=35 and b.job_no ='".$jobNumber."' and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			if($row_aop[csf('process_id')]==35){
				$exchange_rate=$row_aop[csf('batch_issue_qty')];
				if(!$exchange_rate) $exchange_rate=1;
				$aopData['acl']['qty']+=$row_aop[csf('batch_issue_qty')];
				$aopData['acl']['amount']+=$row_aop[csf('amount')]/$exchange_rate;

			}
		}

		// $sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id  and a.process_id=4 and b.sub_process_id in(31,35) and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id  b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=4 and b.sub_process_id in(31,35)   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
		}

		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		//print_r($trimData);

		$trimsRecArr=array();
		// $receive_qty_data=sql_select("select b.po_breakdown_id, a.item_group_id,b.quantity as quantity,b.order_rate as rate,a.cons_rate  from  inv_receive_master c,product_details_master d,inv_trims_entry_dtls a , order_wise_pro_details b where a.mst_id=c.id and a.trans_id=b.trans_id and a.prod_id=d.id and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ");
		$receive_qty_data=sql_select("select b.po_breakdown_id, a.item_group_id,b.quantity as quantity,b.order_rate as rate,a.cons_rate  from  inv_receive_master c,product_details_master d,inv_trims_entry_dtls a , order_wise_pro_details b,gbl_temp_engine g where a.mst_id=c.id and a.trans_id=b.trans_id and a.prod_id=d.id and   b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  ");
		foreach($receive_qty_data as $row){
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['rate']=$row[csf('rate')];
			$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			$trimsRecArr[$row[csf('item_group_id')]]['cons_uom']=$trim_groupArr[$row[csf('item_group_id')]]['cons_uom'];
		}
		//print_r($trimsRecArr);
		$trimsRecReArr=array();
		// $receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d  where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  d.po_breakdown_id in(".implode(",",$poIdArr).")");
		$receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d,gbl_temp_engine g  where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and   d.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ");
		foreach($receive_rtn_qty_data as $row){
			$trimsRecReArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecReArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
		}
		// $sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		// (CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		// (CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		// (CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		// (CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		// c.from_order_id
		// from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.dtls_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") ";
		$sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		(CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		(CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		c.from_order_id
		from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.dtls_id and c.id=a.mst_id and   b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6) ";
		$result_trim_trans=sql_select( $sql_trim_trans );
		$trim_in_qnty=$trim_out_qnty=$trim_in_amt=$trim_out_amt=0;
		foreach ($result_trim_trans as $row)
		{
			$trim_from_order_id.=$row[csf('from_order_id')].',';
			$rate=$row[csf('rate')];
			$con_factor=$trim_groupArr[$row[csf('item_group')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group')]]['in_qty']+=$row[csf('in_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['out_qty']+=$row[csf('out_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['in_amt']+=$row[csf('in_qty')]*$con_factor*$rate;
			$trimsRecArr[$row[csf('item_group')]]['out_amt']+=$row[csf('out_qty')]*$con_factor*$rate;
		}

		foreach($trimsRecArr as $ind=>$value){
			$trimData[$ind]['acl']['qty']+=($trimsRecArr[$ind]['qty']+$trimsRecArr[$ind]['in_qty'])-($trimsRecReArr[$ind]['qty']+$trimsRecArr[$ind]['out_qty']);
			$trimData[$ind]['acl']['amount']+=($trimsRecArr[$ind]['amount']+$trimsRecArr[$ind]['in_amt'])-($trimsRecReArr[$ind]['amount']+$trimsRecArr[$ind]['out_amt']);
			$trimData[$ind]['cons_uom']=$trimsRecArr[$ind]['cons_uom'];
		}

		//print_r($trimData);

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();

		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){

			if($row[csf('emb_name')]==3)
			{
				$washData['pre']['qty']+=$washQtyArr[$jobNumber][$row[csf('id')]];
				$washData['pre']['amount']+=$washAmtArr[$jobNumber][$row[csf('id')]];
			}
			else
			{
				$embData['pre']['qty']+=$embQtyArr[$jobNumber][$row[csf('id')]];
				$embData['pre']['amount']+=$embAmtArr[$jobNumber][$row[csf('id')]];
			}
		}
		//print_r($embData);

		// $sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=6 and b.emblishment_name!=3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and b.emblishment_name!=3 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];
		}
		// Embl Cost End ============================
		// Wash Cost ============================

		// $sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=6 and b.emblishment_name =3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and b.emblishment_name =3  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}
		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}

	 $sql_cm_cost="select jobNo, available_min, production_date from production_logicsoft where jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			$production_date=change_date_format($row[csf('production_date')],'','',1);
			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		// $sql="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where po_id in(".implode(",",$poIdArr).")";
		$sql="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  ";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		// Other Cost End ============================
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."  and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con); 

		ob_start();
		?>
		<div style="width:1202px; margin:0 auto">
			<div style="width:1200px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1200px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="5" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td>
                    <td style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td>Dealing Marchant</td>
                    <td style="word-break:break-all;"><? echo $dealing_marchants;?></td>
					<td>Unit Price</td>
					<td align="right"><? echo number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="5" style="word-break:break-all;"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"><? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right"><? echo number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>
			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr align="center" style="font-weight:bold">
					<td width="200">Item Description</td>
					<td width="60">UOM</td>
					<td width="100">Marketing Qty</td>
					<td width="100">Marketing Price</td>
					<td width="100">Marketing Value</td>
					<td width="100">Pre-Cost Qty</td>
					<td width="100">Pre-Cost Price</td>
					<td width="100">Pre-Cost Value</td>
					<td width="100">Actual Qty</td>
					<td width="100">Actual Price</td>
					<td width="100">Actual Value</td>
				</tr>
				<tr style="font-weight:bold" class="yarn">
					<td colspan="12">Yarn including yarn dyed</td>
				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					if($row['preCost']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['mkt']['qty']>0)
					{
						$item_descrition =$index;
					}

					$totalMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="200" title="<?=$index; ?>"><?=$item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$y++;
				}
				foreach($qYarnData as $index=>$row ){

					$totalMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="200" title="QC"><?=$index; ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$y++;
				}

				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row )
				{
					$totalMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					?>

				 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="200" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($yarn_acl_qty,4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
				<?
				$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Yarn Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right"><? echo number_format($totalMktQty,4); ?></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo number_format($totalMktValue,4);
						$yarnTrimMktValue+=number_format($totalMktValue,4,".","");
						$GrandTotalMktValue+=number_format($totalMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo number_format($totalPreQty,4); ?></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalPreValue>$totalMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalPreValue,4);
						$yarnTrimPreValue+=number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','1')"><? echo number_format($totalAclQty,4); ?></A>
					</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalAclValue>$totalPreValue){echo "red";} else{echo "";}?>">
						<?
						echo number_format($totalAclValue,4);
						$yarnTrimAclValue+=number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=number_format($totalAclValue,4,".","");
						?>
					</td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="200" >Fabric Purchase Cost (Knit)</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['knit']['amount']/$fabPurArr['mkt']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="200" >Fabric Purchase Cost (Woven)</td>
					<td width="60">Yds</td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">
						<?
						$fabPurMkt= number_format($fabPurArr['mkt']['woven']['amount'],4,".","")+number_format($fabPurArr['mkt']['knit']['amount'],4,".","");
						echo number_format($fabPurMkt,4);
						$GrandTotalMktValue+=number_format($fabPurMkt,4,".","");
						$fabPurPre= number_format($fabPurArr['pre']['woven']['amount'],4,".","")+number_format($fabPurArr['pre']['knit']['amount'],4,".","");
						$fabPurAcl= number_format($fabPurArr['acl']['woven']['amount'],4,".","")+number_format($fabPurArr['acl']['knit']['amount'],4,".","");
						?>
					</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor="<? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<? echo  number_format($fabPurPre,4);
						$GrandTotalPreValue+=number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  number_format($fabPurAcl,4);
						$GrandTotalAclValue+=number_format($fabPurAcl,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="12">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0; $totalKnitPreValue=0; $totalKnitAclValue=0; $totalKniMktQty=0; $totalKnitPreQty=0; $totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=number_format($row['acl']['qty'],4,".","");
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="200"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right"><? echo number_format($totalKniMktQty,4);?></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo number_format($totalKniMktValue,4); $GrandTotalMktValue+=number_format($totalKniMktValue,4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($totalKnitPreQty,4);?></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor="<? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo number_format($totalKnitAclQty,4);?></td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=number_format($totalKnitAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="dyfi">
					<td colspan="12">Dye , Fin & Aop Cost</td>
				</tr>
				<?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="dyfi" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="200"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish & AOP Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo number_format($totalFinMktQty,4);?></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo number_format($totalFinMktValue,4); $GrandTotalMktValue+=number_format($totalFinMktValue,4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($totalFinPreQty,4);?></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor="<? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo number_format($totalFinAclQty,4);?></td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=number_format($totalFinAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="200" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo number_format($aopData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($aopData['mkt']['amount']/$aopData['mkt']['qty'],4)?></td>
					<td width="100" align="right"><? echo number_format($aopData['mkt']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($aopData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($aopData['pre']['amount'],4,".","")>number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($aopData['pre']['amount'],4); ?></td>
					<td width="100" align="right"><? echo number_format($aopData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($aopData['acl']['amount'],4,".","")>number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($aopData['acl']['amount'],4); ?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="12">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="200">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right">&nbsp;<? //echo number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><? echo number_format($tot_grey_fab_cost_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo number_format($tot_grey_fab_cost_acl,4); ?></A>&nbsp;<? //echo number_format($tot_grey_fab_cost_acl,4); ?></td>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="200">Finished Fabric Cost</td>
						<td width="60">Kg</td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"><? echo number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><? echo number_format($tot_fin_fab_transfer_cost/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo number_format($tot_fin_fab_transfer_cost,4); ?></A><? //echo number_format($tot_fin_fab_transfer_cost,4); ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="100" align="right"><? echo number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="100" align="right">
						<?
						echo number_format($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl,4);
						$total_grey_fin_fab_transfer_actl_cost=$tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl;
						$GrandTotalAclValue+=number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
				</tr>
				<tr>
					<td colspan="12" style="font-weight:bold" class="trims">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					if($index>0)
					{
						$item_descrition = $trim_groupArr[$index]['item_name'];
						$totalTrimMktValue+=number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="200"><? echo $item_descrition ?></td>
							<td width="60"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="100" align="right"><? echo number_format($row['mkt']['qty'],4); ?></td>
							<td width="100" align="right"><? echo number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
							<td width="100" align="right"><? echo number_format($row['mkt']['amount'],4); ?></td>
							<td width="100" align="right"><? echo number_format($row['pre']['qty'],4); ?></td>
							<td width="100" align="right"><? echo number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="100" align="right"  bgcolor=" <? if(number_format($row['pre']['amount'],4,'.','')>number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo number_format($row['pre']['amount'],4); ?></td>
							<td width="100" align="right"><? echo number_format($row['acl']['qty'],4); ?></td>
							<td width="100" align="right"><? echo number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="100" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(number_format($row['acl']['amount'],4,".","")>number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo number_format($row['acl']['amount'],4); ?></td>
						</tr>
						<?
						$t++;
					}
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200"><span id="trimstotal" class="adl-signs" onClick="yarnT(this.id,'.trims')">+</span>&nbsp;&nbspTrims Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">
						<?
						echo number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=number_format($totalTrimMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if(number_format($totalTrimPreValue,4,".","")>number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						echo number_format($totalTrimAclValue,4);
						$yarnTrimAclValue+=number_format($totalTrimAclValue,4,".","");
						$GrandTotalAclValue+=number_format($totalTrimAclValue,4,".","");
						?>
					</td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="200" >Embellishment Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=number_format($embData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($embData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($embData['pre']['amount'],4,".","")>number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($embData['pre']['amount'],4); $totalOtherPreValue+=number_format($embData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($embData['acl']['qty'],4); ?></td>

					<td width="100" align="right"><? echo number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($embData['acl']['amount'],4,".","")>number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($embData['acl']['amount'],4); $totalOtherAclValue+=number_format($embData['acl']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="200" >Wash Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($washData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($washData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($washData['mkt']['amount'],4); $totalOtherMktValue+=number_format($washData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($washData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($washData['pre']['amount'],4,".","")>number_format($washData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($washData['pre']['amount'],4);$totalOtherPreValue+=number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($washData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($washData['acl']['amount'],4,".","")>number_format($washData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($washData['acl']['amount'],4);$totalOtherAclValue+=number_format($washData['acl']['amount'],4,".",""); ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="200" >Commission Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=number_format($commiData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($commiData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($commiData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($commiData['pre']['amount'],4,".","")>number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? $aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty; echo number_format($aclCommiAmt/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($aclCommiAmt,4,".","")>number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($aclCommiAmt,4); $totalOtherAclValue+=$aclCommiAmt; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="200" >Commercial Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=number_format($commaData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($commaData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($commaData['pre']['amount'],4,".","")>number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? echo  number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($exfactoryQty*$commaData['pre']['rate'],4,".","")>number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($exfactoryQty*$commaData['pre']['rate'],4); $totalOtherAclValue+=number_format($exfactoryQty*$commaData['pre']['rate'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="200" >Freight Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=number_format($otherData['mkt']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['pre']['freight']['amount'],4,".","")>number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($otherData['acl']['freight']['amount'],4,".","")>number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['freight']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="200" >Testing Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['pre']['lab_test']['amount'],4,".","")>number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['lab_test']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['acl']['lab_test']['amount'],4,".","")>number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['lab_test']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['lab_test']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="200" >Inspection Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['pre']['inspection']['amount'],4,".","")>number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['acl']['inspection']['amount'],4,".","")>number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['inspection']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="200" >Courier Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo number_format($otherData['acl']['currier_pre_cost']['amount'],4); $totalOtherAclValue+=number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="200" >Making Cost (CM)</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(number_format($otherData['pre']['cm_cost']['amount'],4,".","")>number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<?
					if(number_format($otherData['acl']['cm_cost']['amount'],4,".","")>number_format($otherData['pre']['cm_cost']['amount'],4,".","")) $font_color="white";
					else $font_color="black";
					?>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo number_format($otherData['acl']['cm_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(number_format($otherData['acl']['cm_cost']['amount'],4,".","")>number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=number_format($otherData['acl']['cm_cost']['amount'],4,".","");?><A href="#report_details" style="color:<? echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"><? echo number_format($otherData['acl']['cm_cost']['amount'],4); ?></A></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="200" >Others Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo number_format($totalOtherMktValue,4); $GrandTotalMktValue+=number_format($totalOtherMktValue,4,".",""); ?></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<? echo number_format($totalOtherPreValue,4); $GrandTotalPreValue+=number_format($totalOtherPreValue,4,".",""); ?>
					</td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<? echo number_format($totalOtherAclValue,4); $GrandTotalAclValue+=number_format($totalOtherAclValue,4,".",""); ?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="200" >Grand Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo number_format($GrandTotalPreValue,4);?></td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo number_format($GrandTotalAclValue,4);?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="200" >Shipment Value</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="100" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="100" align="right"><? $quaOfferValue=$quaOfferQnty*$quaPriceWithCommnPcs; echo number_format($quaOfferValue,4) ?></td>
					<td width="100" align="right"><? echo $jobQty ?></td>
					<td width="100" align="right" title="<? echo $unitPrice;?>"><? echo number_format($unitPrice,4) ?></td>
					<td width="100" align="right"><? echo number_format($jobValue,4) ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="100" align="right"><? echo number_format($exfactoryValue,4) ?></td>
				</tr>
			</table>
			<strong>Profit Summary </strong>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right"><? echo number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="200" align="right"><? echo number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}
	foreach (glob("../../../../ext_resource/tmp_report/$user_name*.xls") as $filename){
		if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
	}

	$html=ob_get_contents();
	$name=time();
	$filename="../../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,$html);
	$filename="../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	echo "$total_data****$filename";
	exit();
}
if($action=="report_generate3")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if($cbo_company_name=="") $company_name=''; else $company_name=" and a.company_name=".$cbo_company_name."";
	$cbo_year=str_replace("'","",$cbo_year);
	$year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

	$buyer_arr=return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
	$season_nameArr=return_library_array( "select id, season_name from lib_buyer_season where status_active=1 and is_deleted=0", "id", "season_name");
	$comp=return_library_array( "select id, company_name from lib_company",'id','company_name');

	$main_sql=sql_select("SELECT a.id as job_id, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.gmts_item_id, a.order_uom, a.avg_unit_price, a.job_quantity, b.id, b.po_number, b.pub_shipment_date, c.country_id, c.item_number_id, c.color_number_id, c.size_number_id, c.order_quantity, c.plan_cut_qnty, c.pack_qty, b.details_remarks, a.season_buyer_wise, a.season_year, a.quotation_id,a.set_smv,a.total_set_qnty,b.shiping_status from wo_po_details_master a join wo_po_break_down b on a.id=b.job_id join wo_po_color_size_breakdown c on b.job_id=c.job_id and b.id=c.po_break_down_id join wo_pre_cost_mst d on a.id=d.job_id where a.status_active=1 and a.is_deleted =0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and d.entry_from=520 and  a.job_no_prefix_num like $txt_job_no $year_cond order by c.size_order ASC");
	$poQtyPcs=0;
	$packQty=0;
	$smv=0;
	$total_set_qnty=0;
	$fob_pack=0;
	$full_delivery = 0;
	$full_pending = 0;
	$total_status = 0;
	$plan_cut_qnty = 0;
	foreach ($main_sql as $row)
	{
		$job_no=$row[csf('job_no')];
		$buyerid=$row[csf('buyer_name')];
		$style_ref_no=$row[csf('style_ref_no')];
		$poArr[$row[csf("id")]]=$row[csf("po_number")];
		$po_id_arr[$row[csf("id")]]=$row[csf("id")];
		$poQtyPcs+=$row[csf("order_quantity")];
		$plan_cut_qnty+=$row[csf("plan_cut_qnty")];
		$packQty = $row[csf("job_quantity")];
		$total_set_qnty = $row[csf("total_set_qnty")];
		$smv = $row[csf("set_smv")];
		$fob_pack = $row[csf("avg_unit_price")];
		$quotation_id=$row[csf("quotation_id")];
		$job_id=$row[csf("job_id")];
		$company_name=$row[csf("company_name")];
		$season_buyer_wise=$season_nameArr[$row[csf("season_buyer_wise")]].'; Year: '.$row[csf("season_year")];
		if($row[csf("shiping_status")] == 1) $full_pending++;
		else if($row[csf("shiping_status")] == 1) $full_delivery++;
		$total_status++;
	}
	if($total_status == $full_pending) $job_status = "Full Pending";
	else if($total_status == $full_delivery) $job_status = "Full Delivery/Closed";
	else  $job_status = "Partial Delivery";

	$sql_smv = sql_select("select avg(a.total_smv) as smv from ppl_gsd_entry_mst a where  a.po_job_no = '".$job_no."' and a.bulletin_type = 4 and a.is_deleted = 0 group by a.po_job_no ");

	$smv = $sql_smv[0][csf('smv')];

	$condition= new condition();
	if(str_replace("'","",$job_no) !=''){
		$condition->job_no("='$job_no'");
	}
	$budget_trims = 0;
	$budget_fabric = 0;
	$budget_fab = 0;
	$budget_yarn = 0;
	$budget_conv = 0;
	$condition->init();

	$trim= new trims($condition);
	$totalamountarray_arr=$trim->getAmountArray_by_jobAndPrecostdtlsid();
	$totalqtyarray_arr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
	$response=array();
	foreach($totalqtyarray_arr as $job=>$PrecostdtlsidArr){
		foreach($PrecostdtlsidArr as $Precostdtlsid=> $value){
			$budget_trims+=fn_number_format($totalamountarray_arr[$job][$Precostdtlsid],2,".","");
		}
	}


	$fabric= new fabric($condition);
	//echo $trim->getQuery();
	$fabric_qty_arr=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
	$fabric_amount_arr=$fabric->getAmountArray_by_Fabriccostid_knitAndwoven_greyAndfinish();



	foreach($fabric_qty_arr['knit']['grey'] as $precostdtls_id=>$uomval)
	{
		foreach($uomval as $uom=>$value)
		{
			$budget_fabric+=fn_number_format($fabric_amount_arr['knit']['grey'][$precostdtls_id][$uom],2,".","");
			$budget_fab+=fn_number_format($fabric_amount_arr['knit']['grey'][$precostdtls_id][$uom],2,".","");
		}

	}
	foreach($fabric_qty_arr['woven']['grey'] as $precostdtls_id=>$uomval)
	{
		foreach($uomval as $uom=>$value)
		{
			$budget_fabric+=fn_number_format($fabric_amount_arr['woven']['grey'][$precostdtls_id][$uom],2,".","");
			$budget_fab+=fn_number_format($fabric_amount_arr['woven']['grey'][$precostdtls_id][$uom],2,".","");
		}
	}
	$po_id_str=implode(",",$po_id_arr);
	$sql_cutlay="SELECT a.entry_form,b.order_id as po_id,b.color_id,c.order_id,c.size_id,sum(c.size_qty ) as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$company_name and c.order_id in($po_id_str)  group by a.entry_form,b.order_id,c.order_id,b.color_id,c.size_id";
	//echo $sql_cutlay; die;
	$sql_res=sql_select($sql_cutlay);
	foreach($sql_res as $vals)
	{
		$cutting_lay_qnty+=$vals[csf('qty')];
	}


	$yarn= new yarn($condition);
	//echo $yarn->getQuery();
	$yarn_qty_arr=$yarn->get_By_Precostdtlsid_YarnQtyArray();
	$yarnamount_arr=$yarn->get_By_Precostdtlsid_YarnAmountArray();

	//print_r($yarn_qty_arr);
	$response=array();

	foreach($yarn_qty_arr as $Precostdtlsid=> $value)
	{
		$budget_fabric+=fn_number_format($yarnamount_arr[$Precostdtlsid],2,".","");
		$budget_yarn+=fn_number_format($yarnamount_arr[$Precostdtlsid],2,".","");
	}


	$conversion= new conversion($condition);
	$conv_amount_arr=$conversion->getAmountArray_by_conversionid();
	$conv_qty_arr=$conversion->getQtyArray_by_conversionid();
	foreach($conv_qty_arr as $Precostdtlsid=> $uomval)
	{
		foreach($uomval as $uom=>$value)
		{
			$budget_fabric+=fn_number_format($conv_amount_arr[$Precostdtlsid][$uom],2,".","");
			$budget_conv+=fn_number_format($conv_amount_arr[$Precostdtlsid][$uom],2,".","");
		}
	}

	// echo "<pre>budget_fabric=$budget_fabric</pre>";
	// echo "<pre>budget_trims=$budget_trims</pre>";
	// echo "<pre>budget_fab=$budget_fab</pre>";
	// echo "<pre>budget_yarn=$budget_yarn</pre>";
	// echo "<pre>budget_conv=$budget_conv</pre>";

	$gmtsitem_ratio_array=array();
	$grmnt_items = "";
    $grmts_sql = sql_select("select job_no,gmts_item_id, set_item_ratio from wo_po_details_mas_set_details where job_no='$job_no'");
	foreach($grmts_sql as $key=>$val)
	{
		$grmnt_items .=$garments_item[$val[csf("gmts_item_id")]].'::'.$val[csf("set_item_ratio")].",";
		$gmtsitem_ratio_array[$val[csf('job_no')]][$val[csf('gmts_item_id')]]=$val[csf('set_item_ratio')];
	}
	$grmnt_items = rtrim($grmnt_items,",");

	$item_descrition_arr=array(0=>'FOB',1=>'Fabric', 2=>'Accessories', 3=>'Embilshment', 4=>'Wash', 5=>'CM ($/Pack', 6=>'Frieght Cost($/Pack)', 7=>'Lab - Test($/Pack)', 9=>'Other Cost($/Pack)', 10=>'Comml.($/Pack)' ,11=>'Com($/Pack)',12=>'Margin',13=>'Admin Cost',14=>'Marketing',15=>'Financial Expenses',16=>'Depreciation',17=>'NetProfit/-Loss');
	//8=>'Opt. Exp.'
	$current_invoice_value=return_field_value("sum(a.current_invoice_value) as current_invoice_value","com_export_invoice_ship_dtls a, com_export_invoice_ship_mst b , wo_po_break_down d","a.mst_id=b.id and a.status_active=1 and a.is_deleted=0 and d.is_deleted=0 and a.po_breakdown_id = d.id and d.job_no_mst='".$job_no."'","current_invoice_value");
	$current_invoice_qnty=return_field_value("sum(a.current_invoice_qnty) as current_invoice_qnty","com_export_invoice_ship_dtls a, com_export_invoice_ship_mst b , wo_po_break_down d","a.mst_id=b.id and a.status_active=1 and a.is_deleted=0 and d.is_deleted=0 and a.po_breakdown_id = d.id and d.job_no_mst='".$job_no."'","current_invoice_qnty");

	$labTestValue=return_field_value("sum(wo_with_vat_value) as value","wo_labtest_dtls","status_active = 1 AND is_deleted = 0 AND entry_form = 79 and job_no='".$job_no."'","value");

	$actual_data[0] = $current_invoice_value  /  $current_invoice_qnty;

	$sql_summ_quo=sql_select("SELECT buyer_agent_id, location_id, no_of_pack, is_confirm, is_cm_calculative, mis_lumsum_cost, commision_per, tot_fab_cost, tot_sp_operation_cost, tot_wash_cost, tot_accessories_cost, tot_cm_cost, tot_fright_cost, tot_lab_test_cost, tot_miscellaneous_cost, tot_other_cost, tot_commission_cost, tot_cost, tot_fob_cost, tot_rmg_ratio, commercial_per, commercial_cost, operating_exp from qc_tot_cost_summary where mst_id='$quotation_id' and status_active=1 and is_deleted=0");

	$quo_attributes=array(0=>'tot_fob_cost',1=>'tot_fab_cost',2=>'tot_accessories_cost', 3=>'tot_sp_operation_cost', 4=>'tot_wash_cost', 5=>'tot_cm_cost', 6=>'tot_fright_cost', 7=>'tot_lab_test_cost', 8=>'operating_exp', 9=>'tot_other_cost', 10=>'commercial_cost', 11=>'tot_commission_cost');
	$q_margin = 0;
	$tot_fob_cost = 0;
	foreach ($sql_summ_quo as $row) {
		foreach ($quo_attributes as $qid => $qattr) {
			$quotation_data[$qid]=$row[csf($qattr)];
			$total_quotation_summ+=$row[csf($qattr)];
			if($qid == 0 ) $tot_fob_cost+=$row[csf($qattr)];
		}
	}
	$q_margin = $tot_fob_cost - ($total_quotation_summ - $tot_fob_cost);
	$quotation_data[12] = $q_margin ;
	$total_quotation_summ+=$q_margin;

	$fabric_cost = 0;

	$data_array_budget=sql_select("SELECT fabric_cost,trims_cost, embel_cost, wash_cost, lab_test, inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, design_cost, studio_cost, common_oh, cm_cost, comm_cost, commission, inspection, currier_pre_cost, certificate_pre_cost, interest_cost, deffdlc_cost, design_cost, studio_cost,total_cost,margin_pcs_bom,margin_dzn,margin_pcs_set from wo_pre_cost_dtls where job_id=$job_id and status_active=1 and is_deleted=0");

	$budget_attributes=array( 3=>'embel_cost', 4=>'wash_cost', 5=>'cm_cost', 6=>'freight',7=>'lab_test',8=>'common_oh', 10=>'comm_cost', 11=>'commission', 12=>'margin_pcs_bom');//1=>'fabric_cost', 2=>'trims_cost',
	$other_cost_attr=array('inspection', 'currier_pre_cost', 'certificate_pre_cost', 'interest_cost', 'deffdlc_cost', 'design_cost', 'studio_cost');
	foreach ($data_array_budget as $row) {
		foreach ($budget_attributes as $bid => $battr) {
			$budget_data[$bid]=$row[csf($battr)];
			$total_budget_summ+=$row[csf($battr)];
		}
		foreach ($other_cost_attr as $attr) {
			$budget_data[9]+=$row[csf($attr)];
			$total_budget_summ+=$row[csf($attr)];
		}
		$fabric_cost = $row[csf('fabric_cost')];
	}

	$sql_recv = " SELECT
						SUM(case when d.entry_form in (7,37,66,68) then d.quantity else 0 end) as receive_qnty,
						SUM(case when d.entry_form in (52,126) then d.quantity else 0 end) as issue_rtn_qnty,
						SUM(case when d.entry_form in (14,15,134,306) and d.trans_type=5 then d.quantity else 0 end) as trans_in_qnty,
						SUM(case when d.entry_form in (46) then d.quantity else 0 end) as issue_rcv_rtn_qnty,
						SUM(case when d.entry_form in(14,15,134,306) and d.trans_type=6 then d.quantity else 0 end) as trns_out_qnty
						from wo_po_details_master a, wo_po_break_down b, inv_transaction c, order_wise_pro_details d
						where a.id=b.job_id and d.po_breakdown_id=b.id and c.id = d.trans_id and d.entry_form in (7,14,15,18,37,46,52,66,68,71,126,134,306)
						and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1
						and d.is_deleted=0  and a.job_no= '".$job_no."'";
	//echo $sql_recv;die;
	$sql_recv = sql_select($sql_recv);
	$fabric_cost_with_recv = 0;
	foreach($sql_recv as $row)
	{
		$fabric_cost_with_recv = ( $row[csf('receive_qnty')] * $fabric_cost)  + $row[csf('trans_in_qnty')] - $row[csf('trns_out_qnty')];
		//echo "<pre>".$fabric_cost_with_recv ."= (". $row[csf('receive_qnty')] ."*". $fabric_cost .")  + ". $row[csf('trans_in_qnty')] ."-". $row[csf('trns_out_qnty')]."</pre>";
	}




	$budget_data[1] = fn_number_format(($budget_fabric / $packQty) ,6,".","" );
	$total_budget_summ+= fn_number_format(($budget_fabric / $packQty) ,6,".","");
	$budget_data[2] = fn_number_format(($budget_trims / $packQty) ,6,".","");
	$total_budget_summ+= fn_number_format(($budget_trims / $packQty) ,6,".","");



	$budget_data[0]=$fob_pack;
	$budget_data[12]= $fob_pack - $total_budget_summ;
	//echo "<pre>".$budget_data[12]." =" .$fob_pack ."-". $total_budget_summ ."</pre>";
	$total_budget_summ+=$fob_pack;
	$total_budget_summ+=$budget_data[12];

	$sql_prod =sql_select("SELECT sum(c.ex_factory_qnty) as ex_factory_qnty from wo_po_break_down b join pro_ex_factory_mst c on b.id = c.po_break_down_id and c.status_active=1 and c.is_deleted=0 where b.job_no_mst='".$job_no."' and b.is_deleted = 0");
	$shipped_qty_pc = $sql_prod[0][csf('ex_factory_qnty')];
	$pack_ratio = $poQtyPcs / $packQty;

	$sqlSmv="select sum(smv) as smv, avg(efficiency) as efficiency, avg(cpm) as cpm from qc_item_cost_summary where mst_id='$quotation_id' and status_active =1 and is_deleted=0";
	//echo $sqlSmv;
	$sqlSmvRes=sql_select($sqlSmv);
	$costet_efficiency=$sqlSmvRes[0][csf('efficiency')];
	$cpm=$sqlSmvRes[0][csf('cpm')];
	if($db_type==0)
	{
		$prod_sql="SELECT
			IFNULL(sum(CASE WHEN c.production_type ='1' and d.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
			IFNULL(sum(CASE WHEN c.production_type ='5' and d.production_type ='5' THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty
		from
			pro_garments_production_mst c,pro_garments_production_dtls d , wo_po_break_down b
		where
			c.id=d.mst_id and b.id = c.po_break_down_id and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0  and c.company_id=$company_name and  b.job_no_mst='".$job_no."' and b.is_deleted = 0 ";
	}
	else
	{
		$prod_sql= "SELECT
			NVL(sum(CASE WHEN c.production_type ='1' and d.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
			NVL(sum(CASE WHEN c.production_type ='5' and d.production_type ='5' THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty
		from
			pro_garments_production_mst c,pro_garments_production_dtls d , wo_po_break_down b
		where
			c.id=d.mst_id and b.id = c.po_break_down_id and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and c.company_id=$company_name and  b.job_no_mst='".$job_no."' and b.is_deleted = 0 ";
	}
	//echo $prod_sql;
	$res_gmtsData=sql_select($prod_sql);
	$cutting_qnty = 0;
	foreach($res_gmtsData as $gmtsRow)
	{
		$cutting_qnty = $gmtsRow[csf('cutting_qnty')];
	}
	$shipped_qty_pack = $shipped_qty_pc * $pack_ratio;
	$plan_cut_pack = $plan_cut_qnty * $pack_ratio;

	$prod_resource_array=array();
	$sql="SELECT b.man_power, b.target_per_hour,b.working_hour
     	FROM prod_resource_dtls_mast b,prod_resource_color_size c,wo_po_break_down d
 		WHERE     B.ID = c.dtls_id AND c.po_id = d.id AND b.is_deleted = 0 AND c.is_deleted = 0
        AND d.is_deleted=0 AND d.JOB_NO_MST = '".$job_no."'";
	//echo $sql;//die();
	$dataArray = sql_select($sql);
	$actual_efficiency = 0;
	foreach($dataArray as $val)
	{
		$actual_efficiency+=(($shipped_qty_pc*$smv) / ($val[csf('man_power')] * $val[csf('working_hour')] * 60));
		//echo "<pre>".$actual_efficiency."+=((".$shipped_qty_pc."*".$smv.") / (".$val[csf('man_power')] ."*". $val[csf('working_hour')] ."* 60))</pre>";
	}

	$exes_cut_avg=return_field_value("avg(excess_cut_perc) as excess_cut_perc","wo_po_color_size_breakdown","job_no_mst='".$job_no."'  and is_deleted=0","excess_cut_perc");


	$sql_actual = sql_select("SELECT
						SUM ( CASE WHEN COST_HEAD =5 THEN AMOUNT_USD ELSE 0 END) AS a5,
						SUM ( CASE WHEN COST_HEAD =2 THEN AMOUNT_USD ELSE 0 END) AS a6,
						SUM ( CASE WHEN COST_HEAD =8 THEN AMOUNT_USD ELSE 0 END) AS a8,
						SUM ( CASE WHEN COST_HEAD =9 THEN AMOUNT_USD ELSE 0 END) AS a9,
						SUM ( CASE WHEN COST_HEAD =6 THEN AMOUNT_USD ELSE 0 END) AS a10,
						SUM ( CASE WHEN COST_HEAD =10 THEN AMOUNT_USD ELSE 0 END) AS a11,
						SUM ( CASE WHEN COST_HEAD =11 THEN AMOUNT_USD ELSE 0 END) AS a13,
						SUM ( CASE WHEN COST_HEAD =12 THEN AMOUNT_USD ELSE 0 END) AS a14,
						SUM ( CASE WHEN COST_HEAD =13 THEN AMOUNT_USD ELSE 0 END) AS a15,
						SUM ( CASE WHEN COST_HEAD =14 THEN AMOUNT_USD ELSE 0 END) AS a16
						 FROM wo_actual_cost_entry
						 WHERE job_no = '".$job_no."' AND status_active = 1 AND is_deleted = 0");
	$str_rep=array("A", "a");

	foreach($sql_actual as $row)
	{
		$actual_data[5] = ($row[csf('a5')] / $current_invoice_qnty ) ;
		$actual_data[6] = ($row[csf('a6')] / $current_invoice_qnty ) ;
		$actual_data[8] = ($row[csf('a8')] / $current_invoice_qnty ) ;
		$actual_data[9] = ($row[csf('a9')] / $current_invoice_qnty ) ;
		$actual_data[10] = ($row[csf('a10')] / $current_invoice_qnty ) ;
		$actual_data[11] = ($row[csf('a11')] / $current_invoice_qnty ) ;
		$actual_data[13] = ($row[csf('a13')] / $current_invoice_qnty ) ;
		$actual_data[14] = ($row[csf('a14')] / $current_invoice_qnty ) ;
		$actual_data[15] = ($row[csf('a15')] / $current_invoice_qnty ) ;
		$actual_data[16] = ($row[csf('a16')] / $current_invoice_qnty ) ;

	}

	$actual_data[1] = ($fabric_cost_with_recv  / $current_invoice_qnty ) ;
	$actual_data[7] = ($labTestValue  / $current_invoice_qnty ) ;
	//echo "<pre>".$actual_data[1]." = (".$fabric_cost_with_recv  ."/". $current_invoice_qnty .")</pre>";

	//$actual_data[0] = (($shipped_qty_pc * $fob_pack ) /  $packQty);

	//echo "<pre>".$actual_data[0]." = ((".$current_invoice_value ."/". $shipped_qty_pack .") /".  $packQty.")</pre>";

	$wo_efficiency=return_field_value("AVG (b.efficiency) AS efficiency","ppl_gsd_entry_mst a, ppl_balancing_mst_entry b","a.id = b.gsd_mst_id  AND b.balancing_page = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0   AND a.bulletin_type = 4 AND a.po_job_no ='".$job_no."'","efficiency");



	$actual_data[5] = $smv * (($poQtyPcs/$packQty) * $cpm) / $wo_efficiency;
	//echo $actual_data[5] ."=". $smv ."* ((".$poQtyPcs."/".$packQty.") * ".$cpm.") /". $wo_efficiency;


	$trims_recv_sql ="SELECT c.receive_basis,   c.booking_without_order AS without_order,   a.item_group_id,   a.item_description,c.store_id,  a.order_uom,  a.item_color,  a.item_size,  a.cons_rate,  b.po_breakdown_id AS po_id,  a.gmts_color_id,  b.quantity,  b.order_amount AS amount,  b.trans_type  FROM inv_receive_master c,   inv_trims_entry_dtls a,   order_wise_pro_details b,   product_details_master d,   wo_po_break_down e WHERE     a.id = b.dtls_id   AND a.trans_id = b.trans_id   AND a.prod_id = d.id   AND c.id = a.mst_id   AND b.trans_type = 1  AND b.entry_form = 24   AND a.status_active = 1   AND a.is_deleted = 0   AND b.status_active = 1   AND b.is_deleted = 0   AND d.status_active = 1   AND b.po_breakdown_id = e.id   AND e.job_no_mst = '".$job_no."' UNION ALL SELECT 0 AS receive_basis,   0 AS without_order,   a.item_group_id,   a.item_description,   c.store_id,   0 AS order_uom,   a.item_color,   a.item_size,   c.cons_rate,   b.po_breakdown_id AS po_id,   a.color AS gmts_color_id,   b.quantity,   b.order_amount AS amount,   b.trans_type  FROM product_details_master a,   order_wise_pro_details b,   inv_transaction c,   wo_po_break_down d WHERE     a.id = b.prod_id   AND b.trans_id = c.id   AND a.item_category_id = 4   AND a.entry_form = 24   AND b.entry_form IN (78, 112)   AND b.trans_type IN (5)   AND c.transaction_type IN (5)   AND a.status_active = 1   AND b.is_deleted = 0   AND b.status_active = 1   AND b.is_deleted = 0   AND c.status_active = 1   AND c.is_deleted = 0   AND b.po_breakdown_id = d.id   AND d.job_no_mst = '".$job_no."' ";
	//echo $trims_recv_sql;
	$trims_recv_sql = sql_select($trims_recv_sql);

	$trims_recv_rate_arr = array();
	foreach($trims_recv_sql as $row)
	{
		if($row[csf('item_size')] == '') $row[csf('item_size')] = 0;
		$trims_recv_rate_arr[$row[csf('po_id')]][$row[csf('item_group_id')]][$row[csf('item_size')]]['wo_qnty']+=$row[csf('quantity')];
		$trims_recv_rate_arr[$row[csf('po_id')]][$row[csf('item_group_id')]][$row[csf('item_size')]]['amount']+=$row[csf('amount')];
		//echo "<pre>".$row[csf('amount')]/$row[csf('quantity')]."</pre>";
		//echo "<pre>".$row[csf('po_id')]."=>".$row[csf('item_group_id')]."=>".$row[csf('item_color')]."=>".$row[csf('item_size')]."</pre>";
	}
	$trims_issue = 0;
	$issue_qty_sql_result =sql_select("select sum(a.amount) as amount from wo_booking_dtls a where a.booking_type = 2 and a.is_short = 2 and a.is_deleted = 0 and a.job_no = '".$job_no."'");
	foreach($issue_qty_sql_result as $row)
	{

		$trims_issue+=$row[csf('amount')] ;
	}
	$actual_data[2] = ($trims_issue / $current_invoice_qnty);
	//echo "<pre>".$actual_data[2] ."= (" . $trims_issue ." /". $packQty.")</pre>";

	// echo "<pre>";
	// print_r($actual_data);

	$sql_emb = sql_select("SELECT SUM (CASE WHEN b.emb_name = 3 THEN a.AMOUNT ELSE 0 END) AS wash, SUM (CASE WHEN b.emb_name != 3 THEN a.AMOUNT ELSE 0 END) AS special_operation FROM   wo_booking_dtls a, wo_pre_cost_embe_cost_dtls b WHERE      a.is_deleted = 0    AND a.booking_type = 6   AND a.pre_cost_fabric_cost_dtls_id = b.id   AND a.job_no =  '".$job_no."' ");
	$actual_data[3] = ($sql_emb[0][csf('special_operation')] / $current_invoice_qnty);

	$actual_data[4] = ($sql_emb[0][csf('wash')] / $current_invoice_qnty);
	foreach ($item_descrition_arr as $itemid => $value)
	{
		$total_actual_summ+=$actual_data[$itemid];
	}
	$actual_data[12] = $actual_data[0] - $total_actual_summ;
	$total_actual_summ+=$actual_data[12];





	ob_start();
	?>
	<div style="width:1180px; margin:0 auto">
        <div style="width:1180px; font-size:20px; font-weight:bold" align="center"><?=$comp[str_replace("'","",$cbo_company_name)]; ?></div>
        <div style="width:1180px; font-size:18px; font-weight:bold" align="center">Style wise Cost Comparison</div>

        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:1180px" rules="all">
            <tr>
            	<td width="80px">Buyer:</td>
                <td width="120px" style="word-break:break-all"><b><?=$buyer_arr[$buyerid]; ?></b></td>
                <td width="100px"></td>
                <td width="80px">Style:</td>
                <td width="120px"><b><?=$style_ref_no; ?></b></td>
                <td width="80px">Job No:</td>
                <td width="100px"><b><?= $job_no; ?></b></td>
                <td width="80px">Garments Item:</td>
                <td width="200px" colspan="2" style="word-break:break-all"><b><?=$grmnt_items; ?></b></td>
                <td width="80px">Status:</td>
                <td width="100px"><b><?=$job_status; ?></b></td>
            </tr>
            <tr>
            	<td >PO No:</td>
                <td colspan="11" style="word-break:break-all"><b><?= implode(",", $poArr); ?></b></td>
            </tr>
            <tr>
                <td>PO Qty.:</td>
                <td><b><?=fn_number_format($poQtyPcs,0);?>-[PCS]</b></td>
                <td ><b><?=fn_number_format($packQty,0).'-[Pack]'; ?></b></td>
                <td></td>
                <td>Shipped Qty</td>
                <td colspan="3"><b><?=fn_number_format($shipped_qty_pc,0);?>-[PCS]</b></td>

                <td>Excess/-Short</td>
                <td><b><?=fn_number_format($poQtyPcs-$shipped_qty_pc,0);?></b></td>
                <td ><b><?=fn_number_format($packQty-$shipped_qty_pack,0); ?></b></td>
                <td></td>
            </tr>
            <tr>
				<td>Plan Cut Qty</td>
                <td><b><?=fn_number_format($plan_cut_qnty,0);?>-[PCS]</b></td>                
                <td>Excess Cut %</td>
                <td><b><?=fn_number_format($exes_cut_avg,2);?>%</b></td>
				<td>Cutting Qty</td>
				<td><b><?= $cutting_lay_qnty ?></b></td>
				<td>Order to Cutting %</td>
				<td><b><? $percent = ($cutting_lay_qnty/$poQtyPcs)*100; echo number_format($percent,2); ?>%</b></td>
                <td>Order to Ship</td>
                <td><b>1:<?=fn_number_format($shipped_qty_pc/$poQtyPcs,2);?></b></td>                
                <td>Cut to Ship</td>
                <td><b>1:<?=fn_number_format(($shipped_qty_pc/$cutting_qnty),2);?></b></td> 
            </tr>
            <tr>
	            <td>Costed Efficiency</td>
	            <td><b><?=fn_number_format($costet_efficiency,4); ?></b></td>
	            <td></td>
	            <td>Actual Efficiency</td>
	            <td><b><?=fn_number_format($actual_efficiency*100,4); ?>%</b></td>
	            <td>CPM</td>
	            <td><b><?=fn_number_format($cpm,4); ?></b></td>
	            <td></td>
	            <td>FOB/Pack</td>
	            <td><b><?=fn_number_format($fob_pack,2); ?></b></td>
	            <td>SMV</td>
	            <td><b><?=fn_number_format($smv,2); ?></b></td>
	        </tr>
        </table>
        <table class="rpt_table" border="1" cellpadding="1" cellspacing="1" style="width:970px; margin-top: 10px" rules="all">
        	<tr>
        		<td rowspan="2" width="100" align="center" valign="middle"><strong>Item Description</strong></td>
        		<td colspan="3" align="center"><strong>Buyer Costing</strong></td>
        		<td colspan="3" align="center"><strong>Booking Costing</strong></td>
        		<td rowspan="2" valign="middle">MKT Vs BOM Cost</td>
        		<td colspan="3" align="center"><strong>Actual Costing</strong></td>
        		<td rowspan="2" valign="middle">BOM Vs Actual Coat</td>
        	</tr>
        	<tr>


        		<td width="90" align="center"><strong>Pack wise Cost Summary $/Pack </strong></td>
        		<td width="90" align="center"><strong>Buyer Cost Value</strong></td>
        		<td width="90" align="center"><strong>Cont. % On FOB Value</strong></td>

        		<td width="90" align="center"><strong>Pack wise Cost Summary $/Pack</strong></td>
        		<td width="90" align="center"><strong>Booking Costing Value</strong></td>
        		<td width="90" align="center"><strong>Cont. % On FOB Value</strong></td>

        		<td width="90" align="center"><strong>Pack wise Cost Summary $/Pack</strong></td>
        		<td width="90" align="center"><strong>Total Value </strong></td>
        		<td width="90" align="center"><strong>Cont. % On FOB Value</strong></td>

        	</tr>
        	<?
        	$perc_arr = array();
			$total_budget = 0 ;
			$total_quotation = 0 ;
			$total_actual = 0 ;
			foreach ($item_descrition_arr as $itemid => $value)
			{
				if($itemid != 0 && $itemid != 12)
				{
					$total_budget+= $budget_data[$itemid];
					$total_quotation+= $quotation_data[$itemid];

					if($itemid == 5)
					{
						$total_actual+=($actual_data[0]*$shipped_qty_pc) / $current_invoice_qnty;
					}
					else{
						$total_actual+= $actual_data[$itemid];
					}

				}
			}

			$budget_data[12]=$budget_data[0]-$total_budget;
			$quotation_data[12]=$quotation_data[0]-$total_quotation;
			$actual_data[12]=$actual_data[0]-$total_actual;

			foreach ($item_descrition_arr as $itemid => $value)
			{

				if($itemid != 0)
				{
					$perc_arr['budget'][$itemid] = fn_number_format(((($budget_data[$itemid]*$packQty) / ($quotation_data[0]*$packQty))*100),20,".","");
					$perc_arr['quotation'][$itemid] =fn_number_format(((($quotation_data[$itemid]*$packQty) / ($quotation_data[0]*$packQty)) * 100),20,".","");

					if($itemid > 0 && $itemid <=4)
					{
						$perc_arr['actual'][$itemid] = fn_number_format(((($actual_data[$itemid]*$packQty) / ($quotation_data[0]*$packQty)) * 100),20,".","");
					}
					else
					{
						$perc_arr['actual'][$itemid] = fn_number_format(((($actual_data[$itemid]*$packQty) / ($actual_data[0]*$packQty)) * 100),20,".","");
					}
				}
			}


			foreach ($item_descrition_arr as $itemid => $value)
			{
				if($itemid != 0)
				{
					$perc_arr['budget'][0]+=fn_number_format($perc_arr['budget'][$itemid],6,".","");
					$perc_arr['quotation'][0]+=fn_number_format($perc_arr['quotation'][$itemid],6,".","");
					$perc_arr['actual'][0]+=fn_number_format($perc_arr['actual'][$itemid],6,".","");
				}

			}


			// echo "<pre>";
			// print_r($perc_arr);
			// echo "</pre>";
        	foreach ($item_descrition_arr as $itemid => $value)
			{
				?>
				<tr>
					<td width="100"><?= $value; ?></td>

					<td width="90" align="right"><?= fn_number_format($quotation_data[$itemid],4) ?></td>
					<td width="90" align="right"><?= fn_number_format($quotation_data[$itemid]*$packQty,2);  ?></td>
					<td width="90" align="right"><?= fn_number_format($perc_arr['quotation'][$itemid],2) ?></td>


					<td width="90" align="right"><?= fn_number_format($budget_data[$itemid],4) ?></td>
					<td width="90" align="right"><?= fn_number_format($budget_data[$itemid]*$packQty,2);  ?></td>
					<td width="90" align="right"><?= fn_number_format($perc_arr['budget'][$itemid],2) ?></td>


					<td width="90" align="right"><?= fn_number_format($quotation_data[$itemid]*$packQty-$budget_data[$itemid]*$packQty,2);  ?></td>


					<td width="90" align="right" title="<?=$actual_data[$itemid];?>"><?= fn_number_format($actual_data[$itemid],4) ?></td>
					<?
						$acttual_val = 0 ;
							if($itemid == 5)
							{
								$acttual_val = $actual_data[0]*$shipped_qty_pc;
							}
							else $acttual_val = $actual_data[$itemid]*$current_invoice_qnty;
					?>
					<td width="90" align="right" title="<?=$acttual_val;?>">
						<?=fn_number_format($acttual_val,2);?>
					</td>
					<td width="90" align="right" title="<?=$perc_arr['actual'][$itemid];?>"><?=fn_number_format($perc_arr['actual'][$itemid],2) ?></td>


					<td width="90" align="right"><?= fn_number_format($quotation_data[$itemid]*$packQty-$actual_data[$itemid]*$current_invoice_qnty,2);  ?></td>
				</tr>
				<?
					$gtotal_quotation_summ+=$quotation_data[$itemid];
					$gtotal_buyercost_value+=$quotation_data[$itemid]*$packQty;
					$gtotal_buyercost_percent+=($quotation_data[$itemid]/$total_quotation_summ)*100;

					$gtotal_budget_summ+=$budget_data[$itemid];
					$gtotal_budgetcost_value+=$budget_data[$itemid]*$packQty;
					$gtotal_budgetcost_percent+=($budget_data[$itemid]/$total_budget_summ)*100;

					$gtotal_actual_summ+=$actual_data[$itemid];
					$gtotal_actualcost_value+=$actual_data[$itemid]*$current_invoice_qnty;
					$gtotal_actualcost_percent+=($actual_data[$itemid]/$total_actual_summ)*100;
        	}
        	/*
        	 ?>
        	<tr>
        		<td width="100" align="center"><strong>Total</strong></td>

        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_quotation_summ,4) ?></strong></td>
        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_buyercost_value,2) ?></strong></td>
        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_buyercost_percent,2) ?></strong></td>

        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_budget_summ,4) ?></strong></td>
        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_budgetcost_value,2) ?></strong></td>
        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_budgetcost_percent,2) ?></strong></td>

        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_buyercost_value-$gtotal_budgetcost_value,2) ?></strong></td>


        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_actual_summ,4) ?></strong></td>
        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_actualcost_value,2) ?></strong></td>
        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_actualcost_percent,2) ?></strong></td>

        		<td width="90" align="right"><strong><?= fn_number_format($gtotal_buyercost_value-$gtotal_actualcost_value,2) ?></strong></td>
        	</tr>
        	<? */?>
    </table>
    </div>

	<?
	foreach (glob("$user_name*.xls") as $filename){
		if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
	}

	$html=ob_get_contents();
	$name=time();
	$filename=$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,$html);
	$filename=$user_name."_".$name.".xls";
	echo "$total_data****$filename";
}
if($action=="report_generate5")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	//echo str_replace("'","",$cbo_costcontrol_source);die;
	$budget_version=str_replace("'","",$cbo_budget_version);
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	$dealing_merchant_array = return_library_array("select id, team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$team_leader_library=return_library_array( "select id, team_leader_name from lib_marketing_team", "id", "team_leader_name");
	//echo $budget_version; die;
	if($budget_version==1){
		$entry_from=111;
	}
	else if($budget_version==2){
		$entry_from=158;
	}
	else if($budget_version==3){
		$entry_from=520;
	}
	else{
		$entry_from=237;
	}
	if(str_replace("'","",$cbo_costcontrol_source)==3)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("select a.job_no from wo_po_details_master a,wo_pre_cost_mst f where a.job_no=f.job_no and a.company_name=$company_name and f.entry_from=158 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row) {
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
			$sql="SELECT a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, a.avg_unit_price, a.total_price, a.working_company_id, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c, d.sew_smv, d.sew_effi_percent from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c, wo_pre_cost_mst d where a.id=b.job_id and  a.id=c.job_id and a.id=d.job_id and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			//echo $sql;
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus=""; $ref_no="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();
		$job_no_arr=array();
		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$sew_effi_percent=$row[csf('sew_effi_percent')];
			$sew_smv=$row[csf('sew_smv')];
			$styleRefno=$row[csf('style_ref_no')];
			$avg_unit_price=$row[csf('avg_unit_price')];
			$total_price=$row[csf('total_price')];
			$working_company_id=$row[csf('working_company_id')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[date("d-m-Y",strtotime($row[csf('shipment_date')]))]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';	$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
			//array_push($job_no_arr, $row[csf('job_no')]);
			$job_no_arr[$row[csf('job_no')]]=$row[csf('job_no')];
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));
		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id." a  and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//PO ID Ref from=1
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 2, $jobIdArr, $empty_arr);//Job ID Ref from=2

		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("SELECT b.PO_BREAK_DOWN_ID, (CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY, (CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		//echo $costPerQty.'m';die;
		if ($costPerQty>1) $costPerUom=($costPerQty/12)." Dzn";
		else $costPerUom=($costPerQty/1)." Pcs";

		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array();
		$washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/*echo "<pre>";
		print_r($YarnData); die;*/

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group where status_active=1 and is_deleted=0 ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}

		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			$sqlQc="select a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.qc_no =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
			}
			unset($dataQc);
			//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$quotationId." order by id asc";
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1)
				{
					if($rowConsRate[csf("rate_data")]!="")
					{
						$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];
						//echo $edata[3].'='.$edata[7].'='.$edata[11].'='.$rowConsRate[csf("tot_cons")].'='.$quaOfferQnty.'<br>';
						if($rowConsRate[csf("rate_data")]!="")
						{
							$qYarnData[$index]['mkt']['qty']+=$consQnty;
							$qYarnData[$index]['mkt']['amount']+=$amount;
						}
						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[14];
						$knitData[$index]['mkt']['qty']+=$mktcons;
						$knitData[$index]['mkt']['amount']+=$mktamt;

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$rate=0;
						$rate=$edata[15]+$edata[16]+$edata[17];
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rate;
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;
					}
					else
					{
						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;
					}
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$washData['mkt']['qty']+=$mktcons;
					$washData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]!=3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['qty']+=$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['amount']+=$mktamt;
					$trimData[$rowConsRate[csf('particular_type_id')]]['cons_uom']=$rowConsRate[csf('cons_uom')];
				}
			}

			$sql_item_summ="SELECT mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$quotationId." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}



	 	//print_r($qYarnData);
		//and a.receive_purpose in(7,12,15,38,46,50,51)
		$yarn_recv="SELECT a.id as receive_id, a.booking_no,a.currency_id,a.receive_purpose,b.job_no,b.cons_amount,b.dye_charge,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a, inv_transaction b, product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1   and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
	 	$yarn_recv_res =sql_select($yarn_recv);

		$yarn_typeArr=array(7,12,15,38,46,50,51);
		foreach ($yarn_recv_res as $row)
		{
			$receive_purpose_id=$row[csf("receive_purpose")];
			$currency_id=$row[csf("currency_id")];
			$dye_charge=$row[csf("dye_charge")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			if($receive_purpose_id ==2)
			{
				$YarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
				$YarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
				$YarnRecv_arr[$index]['currency_id']=$currency_id;
				$dyedYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
			}
			else
			{
				if(in_array($receive_purpose_id,$yarn_typeArr))
				{
					$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
					$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
					if($row[csf("dye_charge")]>0)
					{
						$recv_yarn_rate_arr[$row[csf("job_no")]]['rate']=$dye_charge;
					}

					$SYarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
					$SYarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
					$SYarnRecv_arr[$index]['currency_id']=$currency_id;
					$SYarnRecv_arr[$index]['dye_charge']=$dye_charge;
					$serviceYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
				}
			}
		}
		$Dyarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d,gbl_temp_engine g
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  and c.transaction_type in(3) and c.item_category=1   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Dyarn_recv_return_res=sql_select($Dyarn_recv_return);

		$DYarnReceiveReturn_arr = array();
		foreach ($Dyarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$DYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$DYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}
		$Syarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d,gbl_temp_engine g where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=4 and g.entry_form=18 and c.transaction_type in(3) and c.item_category=1  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Syarn_recv_return_res=sql_select($Syarn_recv_return);

		$SYarnReceiveReturn_arr = array();
		foreach ($Syarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$SYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$SYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}


		$YarnIssue=array();
	    //print_r($YarnIssueReturn);
		$issue_details = sql_select("SELECT e.po_job_no,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no,d.id as issue_id from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d, fabric_sales_order_mst e  where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and e.id=a.po_breakdown_id and a.trans_type=2 and a.entry_form=3  and d.entry_form=3 and e.po_job_no = '".$jobNumber."' and d.issue_purpose not in(8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");

		$issue_arr = $booking_req=$DYarnIssue = array();
		foreach ($issue_details as $row)
		{
			$issue_id_str.=$row[csf("issue_id")].",";
			$dyed_type=$row[csf("dyed_type")];
			$issue_purpose_id=$row[csf("issue_purpose")];
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if($issue_purpose_id==2) //Gery Yarn- for Dyed Yarn
			{
				$DYarnIssue[$row[csf('po_job_no')]]['qty']+=$row[csf("quantity")];
				$DYarnIssue[$row[csf('po_job_no')]]['amount']+=$row[csf("cons_amount_issue")];
			}
			else if(($issue_purpose_id==1 || $issue_purpose_id==4) && $dyed_type!=1) //Grey for knitting,Sample with
			{
				$YarnIssue[$index]['qty']+=$row[csf("quantity")];
				$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			}
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}

		 $issue_ids = chop($issue_id_str,",");
		//$issue_id_string=where_con_using_array(array_unique(explode(",",$issue_ids)),0,"c.issue_id");
		$issue_idsArr=array_unique(explode(",",$issue_ids));
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 5, $issue_idsArr, $empty_arr);//Issue ID Ref from=5

		//$issue_id_string = implode(",",array_unique(explode(",",$issue_ids)));

		//echo '<pre>';print_r($YarnIssue);die;

		if($issue_ids !="")
		{
			$issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,c.receive_basis, b.dyed_type from order_wise_pro_details a, product_details_master b,inv_transaction c,fabric_sales_order_mst e where a.prod_id=b.id and a.trans_id=c.id and e.id=a.po_breakdown_id  and a.trans_type in(4) and a.entry_form in(9) and e.po_job_no = '".$jobNumber."'  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and e.is_deleted=0 and e.status_active=1   ");
			 
			$YarnIssueReturn = $booking_req_return = array();
			foreach ($issue_return as $row)
			{
				$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
				if ($row[csf("dyed_type")] != 1){
					$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
					$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
				}
			}
		}

	    // print_r($YarnIssueReturn);
		foreach($YarnIssue as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'A';
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
		}

		foreach($YarnRecv_arr as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'b';
			$currency_id=$value['currency_id'];
			$DYarnData[$ind]['acl']['qty']+=($value['qty']-$DYarnReceiveReturn_arr[$ind]['qty']);
			if($currency_id==1) //TK
			{
				$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt'])/$g_exchange_rate;
			}
			else
			{
			 	$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt']);
			}
		}

		$job_no_cond=where_con_using_array(array_unique($job_no_arr),1,"c.po_job_no");

		
		$sql_dy="SELECT b.dyeing_charge, b.yarn_wo_qty as qnty, e.yarn_count_id, e.yarn_comp_type1st, e.yarn_comp_percent1st, e.yarn_type, (b.yarn_wo_qty*b.dyeing_charge) as amt,a.currency from wo_yarn_dyeing_mst a , wo_yarn_dyeing_dtls b,product_details_master e,fabric_sales_order_mst c where  a.id=b.mst_id and b.product_id=e.id and c.id=b.job_no_id and a.entry_form=135   and a.status_active = 1 and a.is_deleted = 0 and b.status_active = 1 and b.is_deleted = 0 and c.status_active = 1 and c.is_deleted = 0  $job_no_cond"; 
	    //echo $sql_dy; die;
	    $res_dy=sql_select($sql_dy);
	    $data_dried_yarn=array();

		foreach ($res_dy as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$data_dried_yarn[$index]['qty']+=$row[csf("qnty")];
			if($row[csf('currency')]==1) //Tk
			{
				$data_dried_yarn[$index]['amt']+=$row[csf("amt")]/$g_exchange_rate;
			}
			else{
				$data_dried_yarn[$index]['amt']+=$row[csf("amt")];
			}

		}
		$dried_yarn_data_arr=array();
		foreach ($data_dried_yarn as $index => $value) {
			$dried_yarn_data_arr[$index]['acl']['qty']+=$value['qty'];
			$dried_yarn_data_arr[$index]['acl']['amount']+=$value['amt'];

		}

		$issue_details_yarn_service = sql_select("select d.id as prod_id,e.currency,f.cons_quantity as cons_quantity,c.dyeing_charge as dye_charge,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(c.amount) as service_amount,d.booking_no from inv_transaction f,product_details_master b,wo_yarn_dyeing_dtls c,inv_receive_master d,wo_yarn_dyeing_mst e where f.prod_id=b.id  and f.mst_id=d.id  and e.id=c.mst_id and d.booking_id=e.id and d.entry_form=1  and  c.job_no ='".$jobNumber."' and d.receive_purpose in(7,12,15,38,46,50,51)   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1 order by b.id");

		$yarn_service_arr = array();
		foreach ($issue_details_yarn_service as $row)
		{
			$dyed_type=$row[csf("dyed_type")];
			$currency=$row[csf("currency")];
			$yarn_service_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			//	$recv_yarn_rate=$recv_yarn_rate_arr[$jobNumber]['rate'];
			$ServiceYarnIssue[$index]['qty']+=$row[csf("cons_quantity")];
			if($currency==1) //Tk
			{
				$ServiceYarnIssue[$index]['amount']+=($row[csf("cons_quantity")]*$row[csf("dye_charge")])/$g_exchange_rate;
			}
			else
			{
				$ServiceYarnIssue[$index]['amount']+=$row[csf("cons_quantity")]*$row[csf("dye_charge")];

			}
		}

	    //	print_r($SYarnRecv_arr);die;
		foreach($SYarnRecv_arr as $ind=>$value){
			$currency_id=$value['currency_id'];
			$SYarnData[$ind]['acl']['qty']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty']);
			if( $currency_id==1)
			{
				$SYarnData[$ind]['acl']['amount']+=(($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"])/$g_exchange_rate;
			}
			else
			{
				$SYarnData[$ind]['acl']['amount']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"];

			}
		}

		/*echo "<pre>";
		print_r($SYarnData); */
		$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();

		$sql_yarn_pre="select a.count_id,b.id as po_id, c.job_no, c.id as conv_id,c.cons_process,d.id as pre_fab_id, d.fabric_description,d.composition from wo_pre_cost_fab_yarn_cost_dtls a,wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d, gbl_temp_engine g  where  b.job_id=c.job_id and c.job_id=d.job_id  and c.fabric_description=d.id and a.fabric_cost_dtls_id=d.id and a.fabric_cost_dtls_id=c.fabric_description  and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and c.cons_process in(153,134,30) and b.is_deleted=0  and c.amount>0 ";
		$result_result_yarn=sql_select($sql_yarn_pre);
		foreach($result_result_yarn as $row)
		{
			if($row[csf("count_id")])
			{
				$countArr[$row[csf("pre_fab_id")]]=$lib_yarn_count[$row[csf("count_id")]];
			}
			
		}

		$sql_conv_yarn="select b.id as po_id, c.job_no, c.id as conv_id,c.cons_process, d.fabric_description,d.composition from wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d, gbl_temp_engine g  where  b.job_id=c.job_id and c.job_id=d.job_id  and c.fabric_description=d.id   and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and c.cons_process in(153,134,30) and b.is_deleted=0  and c.amount>0 "; 
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$cons_process=$row[csf("cons_process")];
			$index="".$row[csf("composition")]."";
			$desc="".$row[csf("fabric_description")]."";
			$countname=$countArr[$row[csf("pre_fab_id")]];
			if($cons_process==30)
			{
				$index="".$row[csf("fabric_description")].','.$countname."";
				$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
				if($job_No_chkArr[$row[csf("job_no")]]=='')
				{
					$job_No_chkArr[$row[csf("job_no")]]=$row[csf("job_no")];
				}
			}
			else
			{
				$ServiceYarnConv[$desc]['amount']+=array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$ServiceYarnConv[$desc]['qty']+=array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			}
		}
		/* echo '<pre>';
		print_r($conv_yarn_arr); die; */

		foreach($ServiceYarnConv as $ind=>$value) {
			$SYarnData[$ind]['pre']['qty']+=$value['qty'];
			$SYarnData[$ind]['pre']['amount']+=$value['amount'];
		}
		//print_r($SYarnData);

		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}
		$grey_fab_array=array();  //Knitting Cost actual
		$sql_knit_prod="select c.yarn_lot,
		sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		 from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g where a.id=c.mst_id and c.id=b.dtls_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.")   group by c.yarn_lot";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
		$grey_fab_trans_array=array();
		$sql_grey_trans="select c.from_order_id as FROM_ORDER_ID,a.from_prod_id as FROM_PROD_ID, (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS GREY_IN, (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS GREY_OUT, (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_IN_AMT, (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS GREY_OUT_AMT from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) ";
		  $result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_id_array[$row[('FROM_PROD_ID')]]=$row[('FROM_PROD_ID')];
		}
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 6, $from_prod_idArr, $empty_arr);//Prod ID Ref from=5
		$sql_prod=sql_select("select B.ID, B.AVG_RATE_PER_UNIT,B.PRODUCT_NAME_DETAILS from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=6 and g.entry_form=18");
		foreach($sql_prod as $row){
			$avg_rate_array[$row[("ID")]]=$row[("AVG_RATE_PER_UNIT")];
			$desc_array[$row[("ID")]]=$row[("PRODUCT_NAME_DETAILS")];
		}
		

		$result_grey_trans=sql_select( $sql_grey_trans );
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			$grey_in_amt=$row[csf('grey_in')]*$avg_rate;
			$grey_out_amt=$row[csf('grey_out')]*$avg_rate;
			$from_order_id.=$row[csf('from_order_id')].',';
			$grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$grey_fab_trans_amt_acl+=$grey_in_amt-$grey_out_amt;

		}
		$from_order_id=rtrim($from_order_id,',');
		//$transferIn_order_ids=implode(',',array_flip(array_flip(explode(",",rtrim($transferIn_order_id,',')))));
		$from_order_ids=array_unique(explode(",",$from_order_id));
		$subconOutBillData="select b.order_id,b.currency_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			if($subRow[csf('knit_bill')]>0 && $subRow[csf('currency_id')]==1)
			{
				$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
			}
			else
			{
				$tot_knit_charge+=$subRow[csf('knit_bill')];
			}
		}
		//echo __LINE__; die;
		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty, c.from_order_id
	  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) ";

		$result_fin_trans=sql_select( $sql_fin_trans );
		$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
		foreach ($result_fin_trans as $row)
		{
			$fin_from_order_id.=$row[csf('from_order_id')].',';

			$avg_rate=$avg_rate_array[$row[csf('prod_id')]];
			$fin_in_qnty+=$row[csf('in_qty')];
			$fin_out_qnty+=$row[csf('out_qty')];

			$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
			$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;
		}

		$po_ids=implode(",",$poIdArr);
		unset($result_fin_trans);
		$fin_from_order_id=rtrim($fin_from_order_id,',');
		$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

		$fin_trans_in_qty=$fin_in_qnty;
		$fin_trans_out_qty=$fin_out_qnty;

		$fin_trans_in_amt=$fin_in_amt;
		$fin_trans_out_amt=$fin_out_amt;

	    //	echo $fin_trans_in_amt.'AA'.$fin_trans_out_amt;

		$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
		$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

		$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
		$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;

		$job=str_replace("'","",$job);
		$jobWise_yarn_qty=0;
		$jobWise_yarn_amt=0;
		$sql_jobWise_yarn=sql_select("select JOB_NO, CONS_QNTY, AMOUNT from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_yarn as $val) {
			$jobWise_yarn_qty += $val['CONS_QNTY'];
			$jobWise_yarn_amt += $val['AMOUNT'];
		}
		$per_kg_yarn=$jobWise_yarn_amt/$jobWise_yarn_qty;

		$gray_conversion_costing_process_qty=0;
		$gray_conversion_costing_process_amt=0;
		$finish_conversion_costing_process_qty=0;
		$finish_conversion_costing_process_amt=0;

		$sql_jobWise_conversion=sql_select("select JOB_NO, CONS_PROCESS, REQ_QNTY, AMOUNT from wo_pre_cost_fab_conv_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_conversion as $val) {
			if ($val['CONS_PROCESS']==1){
				$gray_conversion_costing_process_qty += $val['REQ_QNTY'];
				$gray_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if($val['CONS_PROCESS'] !=30 && $val['CONS_PROCESS'] !=1  && $val['CONS_PROCESS'] !=35 && $val['CONS_PROCESS'] !=134) {
				$finish_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if ($val['CONS_PROCESS'] ==31) $finish_conversion_costing_process_qty += $val['REQ_QNTY'];
		}
		$gray_charge_unit = $gray_conversion_costing_process_amt/$gray_conversion_costing_process_qty;
		$finish_charge_unit = $finish_conversion_costing_process_amt/$finish_conversion_costing_process_qty;
		//echo $gray_conversion_costing_process_qty.'**'.$gray_conversion_costing_process_amt.'**'.$finish_conversion_costing_process_qty.'**'.$finish_conversion_costing_process_amt.'**'.$jobWise_yarn_qty.'**'.$jobWise_yarn_amt;
		$gray_transfer_amount=$grey_fab_trans_qty_acl*$per_kg_yarn+$grey_fab_trans_qty_acl*$gray_charge_unit;

		$finish_transfer_amount=$tot_fin_fab_transfer_qty*$per_kg_yarn+$tot_fin_fab_transfer_qty*$gray_charge_unit+$tot_fin_fab_transfer_qty*$finish_charge_unit;
		//echo $gray_transfer_amount.'**'.$finish_transfer_amount;


		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}
		$sql = "select a.item_category, a.exchange_rate, a.fabric_source,b.uom as cons_uom,b.trim_group,b.grey_fab_qnty,b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.booking_type in(1,2)   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		//echo $sql;  die;
		$data_fabPur=sql_select($sql);//and a.booking_type=1 and a.fabric_source=2
		foreach($data_fabPur as $fabPur_row){
			$booking_type=$fabPur_row[csf('booking_type')];$fabric_source=$fabPur_row[csf('fabric_source')];
			if($booking_type==1 && $fabric_source==2) //Purchase and Fabric
			{
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}
			else //Trims
			{
				if($fabPur_row[csf('item_category')]==4){
					$rate=$fabPur_row[csf('rate')];
					$con_factor=$trim_groupArr[$fabPur_row[csf('trim_group')]]['con_factor'];
				}

			}
		}
		// echo '<pre>';print_r($trimsRecArr);die;
		//===Trim Recv==================
		$receive_qty_data=sql_select("select b.po_breakdown_id, d.item_group_id, b.id as prop_id, b.quantity as quantity, a.order_rate as rate, a.cons_rate, a.payment_over_recv
		from inv_receive_master c, product_details_master d, inv_transaction a, order_wise_pro_details b,gbl_temp_engine g  
		where a.mst_id=c.id and a.id=b.trans_id and a.prod_id=d.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.transaction_type=1 and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ");
		foreach($receive_qty_data as $row)
		{
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['rate']=$row[csf('rate')];
			if($row[csf('payment_over_recv')] !=1)
			{
				$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			}
		}
		//print_r($trimsRecArr);
		$trimsRecReArr=array();
		$receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d,gbl_temp_engine g    where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and d.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  d.po_breakdown_id in(".implode(",",$poIdArr).")");
		foreach($receive_rtn_qty_data as $row){
			$trimsRecReArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecReArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];//$trimsRecArr[$row[csf('item_group_id')]]['rate'];
		}
		$sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		(CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		(CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		c.from_order_id
		from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.dtls_id and c.id=a.mst_id and d.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and b.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6)  ";
		$result_trim_trans=sql_select( $sql_trim_trans );
		$trim_in_qnty=$trim_out_qnty=$trim_in_amt=$trim_out_amt=0;
		foreach ($result_trim_trans as $row)
		{
			$trim_from_order_id.=$row[csf('from_order_id')].',';
			$rate=$row[csf('rate')];
			$con_factor=$trim_groupArr[$row[csf('item_group')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group')]]['in_qty']+=$row[csf('in_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['out_qty']+=$row[csf('out_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['in_amt']+=$row[csf('in_qty')]*$con_factor*$rate;
			$trimsRecArr[$row[csf('item_group')]]['out_amt']+=$row[csf('out_qty')]*$con_factor*$rate;
		}

		foreach($trimsRecArr as $ind=>$value){
			$trimData[$ind]['acl']['qty']+=($trimsRecArr[$ind]['qty']+$trimsRecArr[$ind]['in_qty'])-($trimsRecReArr[$ind]['qty']+$trimsRecArr[$ind]['out_qty']);
			$trimData[$ind]['acl']['amount']+=($trimsRecArr[$ind]['amount']+$trimsRecArr[$ind]['in_amt'])-($trimsRecReArr[$ind]['amount']+$trimsRecArr[$ind]['out_amt']);
			$trimData[$ind]['cons_uom']=$trimsRecArr[$ind]['cons_uom'];
		}

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();

		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_id=b.job_id and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				$knitData[$index]['pre']['qty']+=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']+=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}
		}
		$sql = "select b.receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and   b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=2  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];

			}
		}
		$sql_in = "select b.delivery_qty as receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g  where a.id=b.mst_id and b.item_id=c.id and   b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=2 and a.party_source=1  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		 //echo $sql_in; die;
		$data_knit_in=sql_select($sql_in);
		foreach($data_knit_in as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];
			}
		}
		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "SELECT a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_no='".$jobNumber."' and b.cons_process not in(1,2,134,30,35,153)";
		//echo $sql; die;
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index=$row_finish[csf('cons_process')];
			if($row_finish[csf('cons_process')]==31 || $row_finish[csf('cons_process')]==158){
				$dyeingData[$index]['pre']['qty']+=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
				$dyeingData[$index]['pre']['amount']+=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
				$dyeingData[$index]['pre']['process_name'].=$conversion_cost_head_array[$row_finish[csf('cons_process')]].',';
			}
			else{
				$finishData[$index]['pre']['qty']+=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
				$finishData[$index]['pre']['amount']+=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
				$finishData[$index]['pre']['process_name'].=$conversion_cost_head_array[$row_finish[csf('cons_process')]].',';
			}

		}
		$sql_fin_in = "select  b.delivery_qty as receive_qty,b.rate,b.amount,b.currency_id,c.product_name_details, a.process_id from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and   b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=4  and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish_in=sql_select($sql_fin_in);
		foreach($data_finish_in as $row_finish){
			$currency_id=$row_finish[csf('currency_id')];
			//$index=$row_finish[csf('product_name_details')];
			$index=$row_finish[csf('process_id')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
			}
			else//usd
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')];
			}
			//$finishData[$index]['process_name'].=$conversion_cost_head_array[$row_finish[csf('process_id')]].',';
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$AopfinishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}
		}

		// $sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id  and a.process_id=4  and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id  and a.process_id=4  and  b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop)
		{
			$sub_process_id=$row_aop[csf('sub_process_id')];
			$currency_id=$row_aop[csf('currency_id')];
			//$index="'".$row_aop[csf('body_part_id')]."'";
			$index=$row_aop[csf('sub_process_id')];
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
			}
			else
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')];
			}
		}

		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		$sql_issue_mrr = "select a.id as trid, a.transaction_type, a.cons_uom, b.issue_number, b.issue_purpose, a.order_id, a.cons_quantity, a.cons_amount, c.item_group_id, c.item_description from inv_transaction a, inv_issue_master b, product_details_master c,gbl_temp_engine g
		where a.mst_id=b.id and c.id=a.prod_id  and  b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.transaction_type in (2) and a.item_category=4 ";
		$result_trim_trans=sql_select( $sql_issue_mrr );
		$trimsRecArr_new=array();

		foreach ($result_trim_trans as $row)
		{
			$index= $row[csf('item_description')]."***".$row[csf('item_group_id')];
			$trimsRecArr_new[$index]['qty']+=$row[csf('cons_quantity')];
			$trimsRecArr_new[$index]['amt']+=$row[csf('cons_amount')]/$g_exchange_rate;
			$trimsRecArr_new[$index]['cons_uom']=$row[csf('cons_uom')];
			$trimsRecArr_new[$index]['item_description']=$row[csf('item_description')];
		}
		$trimData_new=array();
		foreach($trimsRecArr_new as $ind=>$value){
			//echo $value['amt'].',';
			$trimData_new[$ind]['acl']['qty']+=$value['qty'];
			$trimData_new[$ind]['acl']['amount']+=$value['amt'];
			$trimData_new[$ind]['cons_uom']=$value['cons_uom'];
			$trimData_new[$ind]['item_description']=$value['item_description'];
		}

		//echo '<pre>';print_r($trimData);die;

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		//print_r($washAmtArr);die;
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$job_no=$row[csf('job_no')];
			if($row[csf('emb_name')]==3)
			{
				$washData['pre']['qty']+=$washQtyArr[$job_no][$row[csf('id')]];
				$washData['pre']['amount']+=$washAmtArr[$job_no][$row[csf('id')]];
			}
			else
			{
				$embData[$row[csf('emb_name')]]['pre']['qty']+=$embQtyArr[$job_no][$row[csf('id')]];
				$embData[$row[csf('emb_name')]]['pre']['amount']+=$embAmtArr[$job_no][$row[csf('id')]];
			}
		}
			
		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount, c.emb_name from wo_booking_mst a, wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and c.emb_name!=3  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1  and c.is_deleted=0 and c.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData[$row[csf('emb_name')]]['acl']['qty']+=$row[csf('wo_qnty')];
			$embData[$row[csf('emb_name')]]['acl']['amount']+=$row[csf('amount')];
		}
		// Embl Cost End ============================
		// Wash Cost ============================
		 $sql_wash = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6  and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and  c.emb_name=3   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_wash=sql_select($sql_wash);
		foreach($data_array_wash as $row) {
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}
		$sql_aop = "SELECT a.id,a.currency_id, b.job_no,c.item_number_id, c.body_part_id, c.fab_nature_id, c.color_type_id, c.fabric_description, c.gsm_weight, d.cons_process,b.wo_qnty,b.amount from wo_booking_mst a, wo_booking_dtls b ,wo_pre_cost_fabric_cost_dtls c, wo_pre_cost_fab_conv_cost_dtls d where a.booking_no=b.booking_no   and c.job_no=b.job_no  and d.id=b.pre_cost_fabric_cost_dtls_id  and d.fabric_description=c.id  and a.booking_type=3 and a.process=35 and  a.item_category=12 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.job_no='".$jobNumber."' and d.cons_process=35";

		$data_array_aop=sql_select($sql_aop);
		foreach($data_array_aop as $row_aop){
			$desc=$row_aop[csf("fabric_description")];
			$index="'".$row_aop[csf('body_part_id')]."_".$desc."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['acl']['qty']+=$row_aop[csf('wo_qnty')];
				$currency_id=$row_aop[csf('currency_id')];
				if($currency_id==1)
				{
					$AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
				}
				else
				{
				    $AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')];

				}

			}
		//}

		}
		//print_r($AopfinishData);

		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'  and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost, incentives_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;

			$otherData['pre']['incentives_cost']['qty']=$jobQty;
			$otherData['pre']['incentives_cost']['amount']=$other_cost[$jobNumber]['incentives_cost'];
			$otherData['pre']['incentives_cost']['rate']=$other_cost[$jobNumber]['incentives_cost']/$jobQty;
		}

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}

		$sql_cm_cost="select jobNo, available_min, production_date from production_logicsoft where jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			$production_date=change_date_format($row[csf('production_date')],'','',1);
			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		// $sql_c="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where po_id in(".implode(",",$poIdArr).")";
		$sql_c="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  ";
		

		$data_array=sql_select($sql_c);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==10){
				$commiaData['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		//commer_act_cost
		//echo '<pre>';print_r($otherData);
		// Other Cost End ============================
		$cutting_quantity_data=sql_select("Select sum(b.qc_pass_qty) as qc_pass from pro_gmts_cutting_qc_mst a join pro_gmts_cutting_qc_dtls b on a.id=b.mst_id where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_no = '".$jobNumber."'");
		foreach($cutting_quantity_data as $row){
			$cutting_quantity=$row[csf('qc_pass')];
		}
		$production_qnty_data=sql_select("SELECT sum(b.production_qnty) as production_qnty, b.production_type from gbl_temp_engine g join pro_garments_production_mst a on g.ref_val=a.po_break_down_id  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  join pro_garments_production_dtls b on a.id=b.mst_id where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and b.production_type  in (5,8) group by b.production_type");
		$sewingquantity=0; $finishingquantity=0;
		foreach($production_qnty_data as $row){
			if($row[csf('production_type')]==5){
				$sewingquantity=$row[csf('production_qnty')];
			}
			if($row[csf('production_type')]==8){
				$finishingquantity=$row[csf('production_qnty')];
			}
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."  and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1100px" rules="all">
				<tr>
					<td width="100"><b>Job Number</b></td>
					<td width="100"><? echo $jobNumber; ?></td>
					<td width="100"><b>Team Leader</b></td>
                    <td width="100" style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td width="100"><b>Cutting Quantity</b></td>
					<td width="100" title="QC Quantity"><?= $cutting_quantity ?></td>
					<td width="100"><b>Ship Date</b></td>
					<td width="100" style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td> 

				</tr>
				<tr>
					<td><b>Buyer</b></td>
					<td><? echo $buyer_arr[$buyerName]; ?></td>
					<td><b>Dealing Marchant</b></td>
                    <td style="word-break:break-all;"><? echo $dealing_marchants;?></td>
					<td><b>Sewing Quantity</b></td>
					<td><?= $sewingquantity ?></td>
					<td><b>Ship Qty</b></td>
					<td align="right"><? echo $exfactoryQty ?></td>
				</tr>
				<tr>
					<td><b>Style</b></td>
					<td colspan="3"><? echo $styleRefno; ?></td>
					<td><b>Finishing Quantity</b></td>
					<td><?= $finishingquantity ?></td>
					<td><b>Unit Price</b></td>
					<td align="right"><? echo $avg_unit_price ?></td>
				</tr>
				<tr>
					<td><b>Garments Item</b></td>
					<td colspan="3"><? echo implode(",",$gmtsItemArr); ?></td>
					<td><b>Pre-Cost Efficiency</b></td>
					<td><?= $sew_effi_percent  ?></td>
					<td><b>Shipment Value</b></td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
				</tr>
				<tr>
					<td><b>Order Qty (Pcs)</b></td>
					<td align="right"><? echo $jobQty ?></td>
					<td><b>PO NO.</b></td>
					<td><? echo implode(",",$poNumberArr); ?></td>
					<td><b>Post-cost Efficiency</b></td>
					<td title="Sewing Quantity*100/Cutting Quantity"><? echo fn_number_format($sewingquantity*100/$cutting_quantity); ?></td>
					<td><b>Short/Excess Qty</b></td>
					<td align="right"><? echo $shortExcessQty ?></td>
				</tr>
				<tr>
					<td><b>Unit Price</b></td>
					<td align="right"><? echo $avg_unit_price ?></td>
					<td><b>Ship. Status</b></td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
					<td><b>Pre-cost SMV</b></td>
					<td><?= fn_number_format($sew_smv,2) ?></td>
					<td><b>Short/Excess Value</b></td>
					<td align="right"><? echo fn_number_format($shortExcessValue,4); ?></td>
				</tr>
				<tr>
					<td><b>Unit Price(Pcs)</b></td>
					<td align="right"><? echo fn_number_format($total_price/$jobQty,4) ?></td>
					<td><b>Pre-cost SMV(Pcs)</b></td>
					<td title="Sew SMV(<?=$sew_smv;?>)/Set Ratio(<?=$totalSetQnty;?>)"><? echo fn_number_format($sew_smv/$totalSetQnty,2); ?></td>
					<td><b>Post-cost SMV(Pcs)</b></td>
					<td title="Sew SMV(<?=$sew_smv;?>)/Set Ratio(<?=$totalSetQnty;?>)"><? echo fn_number_format($sew_smv/$totalSetQnty,2); ?></td>
					<td></td>
					<td></td>
				</tr>
				<tr>
					<td><b>Total Value</b></td>
					<td align="right"><? echo fn_number_format($total_price,4) ?></td>
					<td><b>Execution Factory</b></td>
					<td align="left"><? echo $company_arr[str_replace("'","",$company_name)]; ?></td>
					<td><b>Post-cost SMV</b></td>
					<td><?= fn_number_format($sew_smv,2) ?></td>
					<td><b>CPM Cost</b></td>
					<td></td>
				</tr>

			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1100px; margin-top:10px; float: left" rules="all">
				<thead>
					<tr align="center" style="font-weight:bold">
						<td width="300"></td>
						<td width="30"></td>
						<td colspan="5">Pre Cost/Budget Cost</td>
						<td colspan="5">Post Cost/Actual Cost</td>
						<td colspan="4">Variance</td>
					</tr>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="30">UOM</td>
						<td width="80">Quantity</td>
						<td width="80">Avg. Rate</td>
						<td width="80">Value</td>
						<td width="80">Cost Per Pcs</td>
						<td width="80">% on FOB Value</td>
						<td width="80">Quantity</td>
						<td width="80">Avg. Rate</td>
						<td width="80">Value</td>
						<td width="80">Cost Per Pcs</td>
						<td width="80">% on FOB Value</td>
						<td width="80">Quantity</td>
						<td width="80">Value</td>
						<td width="80">Cost Per Pcs</td>
						<td width="80">% on FOB Value</td>
					</tr>
				</thead>
				<tr style="font-weight:bold">
					<td colspan="10" title="including yarn dyed">Yarn Cost/Grey Yarn</td>
				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					if($row['preCost']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['acl']['qty']>0)
					{
						$item_descrition =$lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4);else echo "0"; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty']-$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']-$row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
						<? $value_trim_variance=$row['preCost']['amount']-$row['acl']['amount']; ?>
						<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$row['preCost']['amount']),2).'%'; ?></td>

					</tr>
					<?
					$y++;
				}
				foreach($qYarnData as $index=>$row ){

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="QC"><?=$index; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo " "; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo '0'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty']-$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']-$row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
						<? $value_trim_variance=$row['preCost']['amount']-$row['acl']['amount']; ?>
						<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$row['preCost']['amount']),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs"></span>Yarn Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalPreQty,4); $GrandTotalPreQty+=$totalPreQty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalPreValue/$totalPreQty,4); ?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><? echo fn_number_format(($totalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalAclQty,4); ?></td>
					<td width="80"><? echo fn_number_format($totalAclValue/$totalAclQty,4); ?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><? echo fn_number_format(($totalAclValue*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($totalPreQty-$totalAclQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalPreValue-$totalAclValue,4); ?></td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><? echo fn_number_format((($totalPreValue-$totalAclValue)*100/$totalPreValue),2).'%'; ?></td>
				</tr>
                <tr style="font-weight:bold">
					<td colspan="10" title="yarn dyed">Dyed Yarn Cost</td>
				</tr>
                <?
				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row )
				{
					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$total_yd_PreValue+=fn_number_format($row['preCost']['amount'],4,".","");

					$total_yd_PreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");


					$total_yd_AclValue+=fn_number_format($row['acl']['amount'],4,".","");
					$total_yd_AclQty+=fn_number_format($row['acl']['qty'],4,".","");

					//$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					?>

				    <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty']-$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']-$row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
						<? $value_trim_variance=$row['preCost']['amount']-$row['acl']['amount']; ?>
						<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$row['preCost']['amount']),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				foreach($dried_yarn_data_arr as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['preCost']['qty']>0)
					{
						$item_descrition =$index;
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$total_yd_PreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$total_yd_AclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$total_yd_PreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$total_yd_AclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right" title="From Yarn Dyeing Wo Sales"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo '0'; ?></td>
						<td width="80" align="right" title="From Yarn Dyeing Wo Sales"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty']-$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']-$row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
						<? $value_trim_variance=$row['preCost']['amount']-$row['acl']['amount']; ?>
						<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$row['preCost']['amount']),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				//Dyed End
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs"></span>Yarn Dyeing Cost Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($total_yd_PreQty,4); $GrandTotalPreQty+=$total_yd_PreQty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($total_yd_PreValue/$total_yd_PreQty,4); ?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($total_yd_PreValue,4);
						$yarnTrimPreValue+=fn_number_format($total_yd_PreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($total_yd_PreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><? echo fn_number_format(($total_yd_PreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($total_yd_AclQty,4); ?></td>
					<td width="80"><? echo fn_number_format($total_yd_AclValue/$total_yd_AclQty,4); ?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($total_yd_AclValue,4);
						$yarnTrimAclValue+=fn_number_format($total_yd_AclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($total_yd_AclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><? echo fn_number_format(($total_yd_AclValue*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($total_yd_PreQty-$total_yd_AclQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($total_yd_PreValue-$total_yd_AclValue,4); ?></td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><? echo fn_number_format((($total_yd_PreValue-$total_yd_AclValue)*100/$total_yd_PreValue),2).'%'; ?></td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="300" >Fabric Purchase Cost (Knit)</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['knit']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty']-$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']-$fabPurArr['acl']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$jobQty-$fabPurArr['acl']['knit']['amount']/$jobQty,4); ?></td>
					<? $value_trim_variance=$fabPurArr['pre']['knit']['amount']-$row['acl']['knit']['amount']; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$fabPurArr['pre']['knit']['amount']),2).'%'; ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="30">Yds</td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['woven']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty']-$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']-$fabPurArr['acl']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$jobQty-$fabPurArr['acl']['woven']['amount']/$jobQty,4); ?></td>
					<? $value_variance=$fabPurArr['pre']['woven']['amount']-$fabPurArr['acl']['woven']['amount']; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$fabPurArr['pre']['woven']['amount']),2).'%'; ?></td>
				</tr>
				<?
					$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['mkt']['knit']['amount'],4,".","");
					//echo  fn_number_format($fabPurMkt,4);
					$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
					$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['pre']['knit']['amount'],4,".","");
					$fabPurPre_qty= fn_number_format($fabPurArr['pre']['woven']['qty'],4,".","")+fn_number_format($fabPurArr['pre']['knit']['qty'],4,".","");
					$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['acl']['knit']['amount'],4,".","");
					$fabPurAcl_qty= fn_number_format($fabPurArr['acl']['woven']['qty'],4,".","")+fn_number_format($fabPurArr['acl']['knit']['qty'],4,".","");
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs"></span>Fabric Purchase Cost Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($fabPurPre_qty,4); $GrandTotalPreQty+=$fabPurPre_qty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurPre_qty/$fabPurPre,4); ?></td>
					<td width="80" align="right">
						<? echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurPre*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo  fn_number_format($fabPurAcl_qty,4); ?></td>
					<td width="80" align="right"><? echo  fn_number_format($fabPurAcl_qty/$fabPurAcl,4); ?></td>
					<td width="80" align="right">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurAcl*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo  fn_number_format($fabPurPre_qty-$fabPurAcl_qty,4); ?></td>
					<td width="80" align="right"><? echo  fn_number_format($fabPurPre-$fabPurAcl,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format((($fabPurPre-$fabPurAcl)*100/$fabPurPre),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold">
					<td colspan="10">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0; $totalKnitPreValue=0; $totalKnitAclValue=0; $totalKniMktQty=0; $totalKnitPreQty=0; $totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=fn_number_format($row['acl']['qty'],4,".","");
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty']-$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']-$row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
						<?
							$knit_qty_vari=$row['pre']['qty']-$row['acl']['qty'];
							$knit_value_variance=$row['pre']['amount']-$row['acl']['amount'];
							$knitting_value_variance+=$knit_value_variance;
							$knitting_qty_variance+=$knit_qty_vari;
						?>
						<td width="80" align="right"><? echo fn_number_format(($knit_value_variance*100/$row['pre']['amount']),2).'%'; ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="knittotal"  class="adl-signs" ></span>&nbsp;&nbsp;Kniting Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitPreQty,4); $GrandTotalPreQty+=$totalKnitPreQty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitPreQty/$totalKnitPreValue,4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitAclQty,4);?></td>
					<td width="80"><? echo fn_number_format($totalKnitAclQty/$totalKnitAclValue,4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalKnitAclValue,4,".","");
						?>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitAclValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($knitting_qty_variance,4);?></td>
					<td width="80" align="right"><? echo fn_number_format($knitting_value_variance,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($knitting_value_variance*100/$totalKnitPreValue,4).'%'?></td>
				</tr>
				<tr style="font-weight:bold">
					<td colspan="10">Dyeing Cost</td>
				</tr>
				<?
				$totalDyePreValue=0; $totalDyeAclValue=0; $totalDyePreQty=0; $totalDyeAclQty=0;
				$d=1;
				foreach($dyeingData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$process_names='';
					if ($row['pre']['qty'] != 0){
						$process_names="(".rtrim($row['pre']['process_name'],',').")";
					}
					$totalDyePreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalDyeAclValue+=fn_number_format($row['acl']['amount'],4,".","");


					$totalDyePreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalDyeAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? echo $conversion_cost_head_array[$index]; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty']-$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']-$row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
						<?
						$dye_qty_vari=$row['pre']['qty']-$row['acl']['qty'];
						$dye_value_variance=$row['pre']['amount']-$row['acl']['amount'];
						$total_dye_qty_vari+=$finish_qty_vari;
						$total_dye_value_vari+=$finish_value_variance;
						 ?>
						<td width="80" align="right"><? echo fn_number_format(($dye_value_variance*100/$row['pre']['amount']),2).'%'; ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="dyfitotal"  class="adl-signs"></span>&nbspDyeing Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($totalDyePreQty,4); $GrandTotalPreQty+=$totalDyePreQty;?></td>
					<td width="80" align="right"><? echo fn_number_format($totalDyePreQty/$totalDyePreValue,4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalDyePreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalDyePreValue,4,".","");
						?>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalDyePreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalDyeAclQty,4);?></td>
					<td width="80"><? echo fn_number_format($totalDyeAclQty/$totalDyeAclValue,4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalDyeAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalDyeAclValue,4,".","");
						?>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalDyeAclValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($total_dye_qty_vari,4);?></td>
					<td width="80" align="right"><? echo fn_number_format($total_dye_value_vari,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($total_dye_value_vari*100/$totalDyePreValue,4).'%';?></td>
				</tr>
				<tr style="font-weight:bold">
					<td colspan="10">Finish Cost</td>
				</tr>
				<?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$process_names='';
					if ($row['pre']['qty'] != 0){
						$process_names="(".rtrim($row['pre']['process_name'],',').")";
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? echo $conversion_cost_head_array[$index]; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty']-$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']-$row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
						<?
						$finish_qty_vari=$row['pre']['qty']-$row['acl']['qty'];
						$finish_value_variance=$row['pre']['amount']-$row['acl']['amount'];
						$total_finish_qty_vari+=$finish_qty_vari;
						$total_finish_value_vari+=$finish_value_variance;
						 ?>
						<td width="80" align="right"><? echo fn_number_format(($finish_value_variance*100/$row['pre']['amount']),2).'%'; ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="dyfitotal"  class="adl-signs"></span>&nbspFinish Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4); $GrandTotalPreQty+=$totalFinPreQty;?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty/$totalFinPreValue,4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80"><? echo fn_number_format($totalFinAclQty/$totalFinAclValue,4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($total_finish_qty_vari,4);?></td>
					<td width="80" align="right"><? echo fn_number_format($total_finish_value_vari,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($total_finish_value_vari*100/$totalFinPreValue,4).'%';?></td>
				</tr>
                <tr style="font-weight:bold" class="aop">
					<td colspan="10">AOP Cost</td>
				</tr>
                <?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$a=1;
				foreach($AopfinishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($a%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('traop_<? echo $a; ?>','<? echo $bgcolor;?>')" id="traop_<? echo $a; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty']-$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']-$row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
						<? $value_variance=$row['pre']['amount']-$row['acl']['amount']; ?>
						<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$row['pre']['amount']),2).'%'; ?></td>
					</tr>
					<?
					$a++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="aoptotal"  class="adl-signs" ></span>&nbsp  AOP Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4); $GrandTotalPreQty+=$totalFinPreQty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty/$totalFinPreValue,4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80"><? echo fn_number_format($totalFinAclQty/$totalFinAclValue,4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty-$totalFinAclQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreValue-$totalFinAclValue,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreValue-$totalFinAclValue*100/$totalFinPreValue,4).'%';?></td>
				</tr>

				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="300" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['amount']/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['amount'],4); ?></td>
					<td width="80" align="right" ><? echo fn_number_format($aopData['acl']['amount']/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['acl']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($aopData['preCost']['qty']-$aopData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['preCost']['amount']-$aopData['acl']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['preCost']['amount']/$jobQty-$aopData['acl']['amount']/$jobQty,4); ?></td>
					<? $value_trim_variance=$aopData['preCost']['amount']-$aopData['acl']['amount']; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$aopData['preCost']['amount']),2).'%'; ?></td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				foreach($embData as $embid=>$embdtls){
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" ><?= $emblishment_name_array[$embid] ?></td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['pre']['qty'],4); $totalOtherPreqty+=fn_number_format($embdtls['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['pre']['amount']/$embdtls['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embdtls['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['pre']['amount']/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($embdtls['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['acl']['qty'],4); $totalOtherAclqty+=fn_number_format($embdtls['acl']['qty'],4); ?></td>

					<td width="80" align="right"><? echo fn_number_format($embdtls['acl']['amount']/$embdtls['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embdtls['acl']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['acl']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($embdtls['acl']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($embdtls['pre']['qty']-$embdtls['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['pre']['amount']-$embdtls['acl']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embdtls['pre']['amount']/$jobQty-$embdtls['acl']['amount']/$jobQty,4); ?></td>
					<? $value_variance=$embdtls['pre']['amount']-$embdtls['acl']['amount']; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$embdtls['pre']['amount']),2).'%'; ?></td>
				</tr>
				<? } ?>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" >Wash Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['qty'],4); $totalOtherPreqty+=fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount'],4);$totalOtherPreValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['qty'],4); $totalOtherAclqty+=fn_number_format($washData['acl']['qty'],4);  ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['amount'],4);$totalOtherAclValue+=fn_number_format($washData['acl']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['acl']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($washData['pre']['qty']-$washData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']-$washData['acl']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']/$jobQty-$washData['acl']['amount']/$jobQty,4); ?></td>
					<? $value_variance=$washData['pre']['amount']-$washData['acl']['amount']; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$washData['pre']['amount']),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); $totalOtherPreqty+=fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; $totalOtherAclqty+=$exfactoryQty;  ?></td>
					<td width="80" align="right"><? $aclCommiAmt=$commiaData['acl']['amount']; echo fn_number_format($aclCommiAmt/$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aclCommiAmt,4); $totalOtherAclValue+=$aclCommiAmt; ?></td>
					<td width="80" align="right"><? echo fn_number_format($aclCommiAmt/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($aclCommiAmt*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['qty']-$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['amount']-$aclCommiAmt,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['amount']/$jobQty-$aclCommiAmt/$jobQty,4); ?></td>
					<? $value_variance=$commiData['pre']['amount']-$aclCommiAmt; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$commiData['pre']['amount']),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); $totalOtherPreqty+=fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount']/$commaData['pre']['qty'],4);  ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($commaData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right" title="From Ex Factorty" ><? echo $exfactoryQty; $totalOtherAclqty+=$exfactoryQty;
					$commer_act_cost=$commaData['acl']['amount'];//($unitPrice*$exfactoryQty)*(0.5/100);   ?></td> 
					<td width="80" align="right"><? echo  fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right" title="From Actual Entry"  bgcolor="<? if(fn_number_format($commer_act_cost)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?
					echo fn_number_format($commer_act_cost,4);
					 $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".","");?></td>
					 <td width="80" align="right"><? echo fn_number_format($commer_act_cost/$jobQty,4);?></td>
					 <td width="80" align="right"><? echo fn_number_format(($commer_act_cost*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['qty']-$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount']-$commer_act_cost,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount']/$jobQty-$commer_act_cost/$jobQty,4); ?></td>
					<? $valu_variance=$commaData['pre']['amount']-$commer_act_cost; ?>
					<td width="80" align="right"><? echo fn_number_format(($valu_variance*100/$commaData['pre']['amount']),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); $totalOtherPreqty+=fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['freight']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"  title="From Ex Factorty"><? echo $exfactoryQty; $totalOtherAclqty+=$exfactoryQty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($freight_acl_cost/$exfactoryQty,4);
					$freight_acl_cost=$otherData['acl']['freight']['amount'];
					?></td>
					<td width="80" align="right"><? echo fn_number_format($freight_acl_cost,4); $totalOtherAclValue+=fn_number_format($freight_acl_cost,4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format($freight_acl_cost/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($freight_acl_cost*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty']-$exfactoryQty,4); ?></td>

					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['amount']-$otherData['acl']['freight']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['amount']/$jobQty-$otherData['acl']['freight']['amount']/$jobQty,4); ?></td>
					<? $value_variance=$otherData['pre']['freight']['amount']-$otherData['acl']['freight']['amount']; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$otherData['pre']['freight']['amount']),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); $totalOtherPreqty+=fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['amount']/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['lab_test']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right" title="From Ex Factorty"><? echo $exfactoryQty; $totalOtherAclqty+=$exfactoryQty;  ?></td>
					<td width="80" align="right"><?
					$test_act_cost=$otherData['acl']['lab_test']['amount'];//$unitPrice*$exfactoryQty*(0.5/100);
					echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right" title="From Actual"><? echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($test_act_cost/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($test_act_cost*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty']-$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['amount']-$test_act_cost,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['amount']/$jobQty-$test_act_cost/$jobQty,4); ?></td>
					<? $value_variance=$otherData['pre']['lab_test']['amount']-$test_act_cost; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$otherData['pre']['lab_test']['amount']),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); $totalOtherPreqty+=fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; $totalOtherAclqty+=$exfactoryQty;  ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount']/$jobQty,4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty']-$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['amount']-$otherData['acl']['inspection']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['amount']/$jobQty-$otherData['acl']['inspection']['amount']/$jobQty,4); ?></td>
					<? $value_variance=$otherData['pre']['inspection']['amount']-$otherData['acl']['inspection']['amount']; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$otherData['pre']['inspection']['amount']),2).'%'; ?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); $totalOtherPreqty+=fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; $totalOtherAclqty+=$exfactoryQty;  ?></td>
					<td width="80" align="right"><?
					//$courier_cost_act=$otherData['pre']['currier_pre_cost']['rate']*$exfactoryQty*(80/100);
					echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
					<td width="80" align="right" ><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$jobQty,4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty']-$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount']-$otherData['acl']['currier_pre_cost']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount']/$jobQty-$otherData['acl']['currier_pre_cost']['amount']/$jobQty,4); ?></td>
					<? $value_trim_variance=$otherData['pre']['currier_pre_cost']['amount']-$otherData['acl']['currier_pre_cost']['amount']; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$otherData['pre']['currier_pre_cost']['amount']),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); $totalOtherPreqty+=fn_number_format($otherData['pre']['cm_cost']['qty'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; $totalOtherAclqty+=$exfactoryQty; ?></td>
					<td width="80" align="right"><?
					$making_cost_act=$otherData['acl']['cm_cost']['amount'];//$otherData['pre']['cm_cost']['rate']*$exfactoryQty*(80/100);
					echo fn_number_format($making_cost_act/$exfactoryQty,4); ?></td>
					<td width="80" title="CM From Actual Cost"  align="right"><?  $totalOtherAclValue+=fn_number_format($making_cost_act,4,".",""); echo fn_number_format($making_cost_act,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($making_cost_act/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty']-$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['amount']-$making_cost_act,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['amount']/$jobQty-$making_cost_act/$jobQty,4); ?></td>
					<? $value_trim_variance=$otherData['pre']['cm_cost']['amount']-$making_cost_act; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$otherData['pre']['cm_cost']['amount']),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Incentives Missing Cost</td>
					<td width="30"><? echo 'Pcs'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['incentives_cost']['qty'],0); $totalOtherPreqty+=fn_number_format($otherData['pre']['incentives_cost']['qty'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['incentives_cost']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['incentives_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['incentives_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['incentives_cost']['amount']/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['incentives_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $otherData['pre']['incentives_cost']['qty']; $totalOtherAclqty+=$otherData['pre']['incentives_cost']['qty']; ?></td>
					<td width="80" align="right"><?
					$making_cost_act=$otherData['pre']['incentives_cost']['amount'];
					echo fn_number_format($making_cost_act/$otherData['pre']['incentives_cost']['qty'],4); ?></td>
					<td width="80" title="CM From Actual Cost"  align="right"><?  $totalOtherAclValue+=fn_number_format($making_cost_act,4,".",""); echo fn_number_format($making_cost_act,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($making_cost_act/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['incentives_cost']['qty']-$otherData['pre']['incentives_cost']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['incentives_cost']['amount']-$making_cost_act,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['incentives_cost']['amount']/$jobQty-$making_cost_act/$jobQty,4); ?></td>
					<? $value_trim_variance=$otherData['pre']['incentives_cost']['amount']-$making_cost_act; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$otherData['pre']['incentives_cost']['amount']),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalOtherPreqty,4); $GrandTotalPreQty+=$totalOtherPreqty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalOtherPreValue/$totalOtherPreqty,4);?></td>
					<td width="80" align="right">
						<? echo fn_number_format($totalOtherPreValue,4); $GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format($totalOtherPreValue/$jobQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalOtherAclqty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right">
						<? echo fn_number_format($totalOtherAclValue,4); $GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".",""); ?>
					</td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherAclValue*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($totalOtherPreqty-$totalOtherAclqty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalOtherPreValue-$totalOtherAclValue,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalOtherPreValue/$jobQty-$totalOtherAclValue/$jobQty,4); ?></td>
					<? $value_other_variance=$totalOtherPreValue-$totalOtherAclValue; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_other_variance*100/$totalOtherPreValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td colspan="16">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					if($index>0)
					{
						$item_descrition = $trim_groupArr[$index]['item_name'].' '.$row['item_description'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimPreqty+=fn_number_format($row['pre']['qty'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						$totalTrimAclqty+=fn_number_format($row['acl']['qty'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty,4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="From Trim Recv" ><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>

							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty']-$row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']-$row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
							<? $value_variance=$row['pre']['amount']-$row['acl']['amount']; ?>
							<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$row['pre']['amount']),2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				foreach($trimData_new as $index=>$row ){
					if($index>0)
					{
						$explode=explode("***", $index);
						$item_group_ids=$explode[1];
						$item_descrition = $trim_groupArr[$item_group_ids]['item_name'].' '.$row['item_description'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						$totalTrimAclqty+=fn_number_format($row['acl']['qty'],4,".","");
						$totalTrimPreqty+=fn_number_format($row['pre']['qty'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'] ,4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty,4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$jobQty,4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']*100/$jobValue,2).'%'; ?></td>

							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty']-$row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']-$row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$jobQty-$row['acl']['amount']/$jobQty,4); ?></td>
							<? $value_variance=$row['pre']['amount']-$row['acl']['amount']; ?>
							<td width="80" align="right"><? echo fn_number_format(($value_variance*100/$row['pre']['amount']),2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="trimstotal" class="adl-signs"></span>Trims Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalTrimPreqty,4); $GrandTotalPreQty+=$totalTrimPreqty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalTrimPreqty/$totalTrimPreValue,4) ?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80"><? echo fn_number_format($totalTrimAclqty,4) ?></td>
					<td width="80"><? echo fn_number_format($totalTrimAclqty/$totalTrimAclValue,4) ?></td>
					<td width="80" align="right">
						<?
						//if($sqlResult[0][csf('over_rcv_payment')]==1){

							echo fn_number_format($totalTrimAclValue,4);
							$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
							$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						//}
						?>
					</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimAclValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalTrimPreqty-$totalTrimAclqty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalTrimPreValue-$totalTrimAclValue,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimPreValue-$totalTrimAclValue)*100/$totalTrimPreValue,4).'%'; ?></td>



				</tr>

				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalPreQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalPreValue/$GrandTotalPreQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalPreValue/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalAclValue/$jobQty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalAclValue*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"></td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalPreQty-$GrandTotalAclValue,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalPreQty/$jobQty-$GrandTotalAclValue/$jobQty,4); ?></td>
					<? $value_trim_variance=$GrandTotalPreQty-$GrandTotalAclValue; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$GrandTotalPreQty),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo $jobQty ?></td>
					<td width="80" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($jobValue/$jobQty,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($exfactoryValue/$jobQty,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($exfactoryValue*100/$jobValue),2).'%'; ?></td>

					<td width="80" align="right"><? echo fn_number_format($jobQty-$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($jobValue-$exfactoryValue,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($jobValue/$jobQty-$exfactoryValue/$jobQty,4); ?></td>
					<? $value_trim_variance=$jobValue-$exfactoryValue; ?>
					<td width="80" align="right"><? echo fn_number_format(($value_trim_variance*100/$jobValue),2).'%'; ?></td>
				</tr>
			</table>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:620px; margin-top:5px;" rules="all">
				<tr><td colspan="8"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="100" >Type</td>
					<td width="110">Total P.O/Ex-Fact. Value</td>
					<td width="110">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="100">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td>Pre Costing</td>
					<td align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td align="right"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td align="right"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td align="right"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td>Actual Costing</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td align="right"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td align="right"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td align="right"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>
					<td width="120">
                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>
						    <div style="float:left;width:120px" >
							<?
							foreach($nameArray_img AS $inf) {
								?>
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='100' width='100' />
							    <?
							}
							?>
							</div>
						<?
					}
					else echo ""; ?>
                    </td>
				</tr>
            </table>
			<? echo signature_table(289, $cbo_company_name, "860px"); ?>
		</div>
		<?
	}

	$html = ob_get_contents();
    ob_clean();
    foreach (glob("*.xls") as $filename) {
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_name."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');
    $is_created = fwrite($create_new_doc, $html);
    echo "$html****$filename";

	exit();
}
if($action=='get_report_id'){
	$print_report_format=return_field_value("format_id","lib_report_template","template_name ='".$data."' and module_id=11 and report_id=229 and is_deleted=0 and status_active=1");
	echo $print_report_format; die;
}
if($action=="report_generate6")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	//echo str_replace("'","",$cbo_costcontrol_source);die;
	$budget_version=str_replace("'","",$cbo_budget_version);
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	$dealing_merchant_array = return_library_array("select id, team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$team_leader_library=return_library_array( "select id, team_leader_name from lib_marketing_team", "id", "team_leader_name");
	//echo $budget_version; die;
	if($budget_version==1){
		$entry_from=111;
	}
	else if($budget_version==2){
		$entry_from=158;
	}
	else if($budget_version==3){
		$entry_from=520;
	}
	else{
		$entry_from=237;
	}

	if(str_replace("'","",$cbo_costcontrol_source)==3)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";
		$check_data=sql_select("select a.job_no from wo_po_details_master a,wo_pre_cost_mst f where a.job_no=f.job_no and a.company_name=$company_name and f.entry_from=158 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row) {
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
			$sql="select a.id as job_id, a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.id=b.job_id and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			//echo $sql; die;
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus=""; $ref_no="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();
		$job_no_arr=array();
		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';	$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
			array_push($job_no_arr, $row[csf('job_no')]);
			$job_id_arr[$row[csf('job_id')]]=$row[csf('job_id')];
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}

		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select po_break_down_id,
			sum(CASE WHEN entry_form!=85 THEN ex_factory_qnty ELSE 0 END) as ex_factory_qnty,
			sum(CASE WHEN entry_form=85 THEN ex_factory_qnty ELSE 0 END) as ex_factory_return_qnty
			from pro_ex_factory_mst  where 1=1 $po_cond_for_in and status_active=1 and is_deleted=0 group by po_break_down_id");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[csf('po_break_down_id')]]=$exfatory_row[csf('ex_factory_qnty')]-$exfatory_row[csf('ex_factory_return_qnty')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
		if(count($poIdArr)>0) $po_cond_for_examount=" and  po_id  in(".implode(",",$poIdArr).")";
		$exfactory_amount=sql_select("SELECT amount, cost_head from wo_actual_cost_entry where status_active=1 and is_deleted=0 $po_cond_for_examount");
		$exfactory_amount_arr=array();
		foreach($exfactory_amount as $row){
			$exfactory_amount_arr[$row[csf('cost_head')]]+=$row[csf('amount')]/$g_exchange_rate;
		}

	    //$quotationId=1;

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		//echo $costPerQty.'m';die;
		if ($costPerQty>1) $costPerUom=($costPerQty/12)." Dzn";
		else $costPerUom=($costPerQty/1)." Pcs";

		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array();
		$washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";

		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/* echo "<pre>";
		print_r($YarnData); die; */

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group where status_active=1 and is_deleted=0 ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}

		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			$sqlQc="select a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.qc_no =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
			}
			unset($dataQc);
			//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$quotationId." order by id asc";
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1)
				{
					if($rowConsRate[csf("rate_data")]!="")
					{
						$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];
						//echo $edata[3].'='.$edata[7].'='.$edata[11].'='.$rowConsRate[csf("tot_cons")].'='.$quaOfferQnty.'<br>';
						if($rowConsRate[csf("rate_data")]!="")
						{
							$qYarnData[$index]['mkt']['qty']+=$consQnty;
							$qYarnData[$index]['mkt']['amount']+=$amount;
						}

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[14];
						$knitData[$index]['mkt']['qty']+=$mktcons;
						$knitData[$index]['mkt']['amount']+=$mktamt;

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$rate=0;
						$rate=$edata[15]+$edata[16]+$edata[17];
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rate;
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;
					}
					else
					{
						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						//echo $mktcons.'-'.$mktamt.'-'.$rowConsRate[csf('tot_cons')].'-'.$quaCostingPerQty.'-'.$quaOfferQnty.'<br>';
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;
					}
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$washData['mkt']['qty']+=$mktcons;
					$washData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]!=3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
				}
			}
			/*echo "<pre>";
			print_r($trimData);
			die;*/

			$sql_item_summ="select mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$quotationId." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}



	 	//print_r($qYarnData);
		//and a.receive_purpose in(7,12,15,38,46,50,51)
		$yarn_recv="select a.id as receive_id, a.booking_no,a.currency_id,a.receive_purpose,b.job_no,b.cons_amount,b.dye_charge,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a, inv_transaction b, product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1   and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
	 	$yarn_recv_res =sql_select($yarn_recv);

		$yarn_typeArr=array(7,12,15,38,46,50,51);
		foreach ($yarn_recv_res as $row)
		{
			$receive_purpose_id=$row[csf("receive_purpose")];
			$currency_id=$row[csf("currency_id")];
			$dye_charge=$row[csf("dye_charge")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			if($receive_purpose_id ==2)
			{
				$YarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
				$YarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
				$YarnRecv_arr[$index]['currency_id']=$currency_id;
				$dyedYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
			}
			else
			{
				if(in_array($receive_purpose_id,$yarn_typeArr))
				{
					$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
					$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
					if($row[csf("dye_charge")]>0)
					{
						$recv_yarn_rate_arr[$row[csf("job_no")]]['rate']=$dye_charge;
					}

					$SYarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
					$SYarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
					$SYarnRecv_arr[$index]['currency_id']=$currency_id;
					$SYarnRecv_arr[$index]['dye_charge']=$dye_charge;
					$serviceYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
				}
			}
		}
	    //echo '<pre>';print_r($serviceYarnRecv_arr);die;

	    // DYarn receive return
		$Dyarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id and c.transaction_type in(3) and c.item_category=1 and a.id in(".implode(",",$dyedYarnRecv_arr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Dyarn_recv_return_res=sql_select($Dyarn_recv_return);

		$DYarnReceiveReturn_arr = array();
		foreach ($Dyarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$DYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$DYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}
		//echo '<pre>';print_r($DYarnReceiveReturn_arr);die;

		// SYarn receive return
		$Syarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id and c.transaction_type in(3) and c.item_category=1 and a.id in(".implode(",",$serviceYarnRecv_arr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Syarn_recv_return_res=sql_select($Syarn_recv_return);

		$SYarnReceiveReturn_arr = array();
		foreach ($Syarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$SYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$SYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}


			$YarnIssue=array();
	    //print_r($YarnIssueReturn);
		$issue_details = sql_select("SELECT a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no,d.id as issue_id, b.color from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3  and d.entry_form=3 and a.po_breakdown_id in(".implode(",",$poIdArr).") and d.issue_purpose not in(8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");

		$yarn_dyed_wo_arr=sql_select("SELECT product_id, sum(yarn_wo_qty) as yarn_wo_qty, sum(amount) as amount from wo_yarn_dyeing_dtls where status_active=1 and is_deleted=0 and job_no ='".$jobNumber."' group by product_id");
		$dayed_yarn_rate_arr=array();
		foreach($yarn_dyed_wo_arr as $data){
			$dayed_yarn_rate_arr[$data[csf('product_id')]]=$data[csf('amount')]/$data[csf('yarn_wo_qty')];
		}

		$issue_arr = $booking_req=$DYarnIssue = array();
		foreach ($issue_details as $row)
		{
			$issue_id_str.=$row[csf("issue_id")].",";
			$dyed_type=$row[csf("dyed_type")];
			$issue_purpose_id=$row[csf("issue_purpose")];
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if(($issue_purpose_id==2 || $issue_purpose_id==15 || $issue_purpose_id==38) && $row[csf("color")]==93) //Gery Yarn- for Dyed Yarn
			{
				$DYarnIssue[$index]['qty']+=$row[csf("quantity")];
				$DYarnIssue[$index]['amount']+=$row[csf("quantity")]*$dayed_yarn_rate_arr[$row[csf("prod_id")]];
			}
			if(($issue_purpose_id==1 || $issue_purpose_id==2 || $issue_purpose_id==4 || $issue_purpose_id==15 || $issue_purpose_id==38) && $row[csf("color")]==93) //Grey for knitting,Sample with
			{
				$YarnIssue[$index]['qty']+=$row[csf("quantity")];
				$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			}
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}
		/* echo '<pre>';
		print_r($YarnIssue); */

		$issue_ids = chop($issue_id_str,",");
		$issue_id_string=where_con_using_array(array_unique(explode(",",$issue_ids)),0,"c.issue_id");


		$job_no_cond=where_con_using_array(array_unique($job_no_arr),1,"b.job_no");
		$job_id_cond=where_con_using_array($job_id_arr,0,"b.job_no_id");

		$sql_dy="SELECT b.dyeing_charge, d.cons_quantity as qnty, e.yarn_count_id, e.yarn_comp_type1st, e.yarn_comp_percent1st, e.yarn_type, (d.cons_quantity*b.dyeing_charge) as amt,a.currency from wo_yarn_dyeing_mst a join wo_yarn_dyeing_dtls b on a.id=b.mst_id join inv_issue_master c on a.id=c.booking_id join inv_transaction d on c.id=d.mst_id and b.yarn_color=d.dyeing_color_id join product_details_master e on d.prod_id=e.id where a.is_short=2 and a.entry_form=41 and d.transaction_type = 2 and a.status_active = 1 and a.is_deleted = 0 and b.status_active = 1 and b.is_deleted = 0 and c.status_active = 1 and c.is_deleted = 0 and d.status_active = 1 and d.is_deleted = 0 $job_id_cond group by b.dyeing_charge, d.cons_quantity , e.yarn_count_id, e.yarn_comp_type1st, e.yarn_comp_percent1st, e.yarn_type,a.currency";
	    //echo $sql_dy; die;
	    $res_dy=sql_select($sql_dy);

	    $data_dried_yarn=array();

		foreach ($res_dy as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$data_dried_yarn[$index]['qty']+=$row[csf("qnty")];
			if($row[csf('currency')]==1) //Tk
			{
				$data_dried_yarn[$index]['amt']+=$row[csf("amt")]/$g_exchange_rate;
			}
			else{
				$data_dried_yarn[$index]['amt']+=$row[csf("amt")];
			}

		}


		if($issue_id_string !="")
		{
			$issue_return=sql_select("SELECT a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.reject_qty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,c.order_amount,c.issue_id,c.receive_basis, b.dyed_type, b.color from order_wise_pro_details a, product_details_master b,inv_transaction c where a.prod_id=b.id and a.trans_id=c.id and a.trans_type in(4) and a.entry_form in(9) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 $issue_id_string ");
			$YarnIssueReturn = $booking_req_return = array();
			foreach ($issue_return as $row)
			{
				$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
				$issue_purpose_id=$row[csf("issue_purpose")];
				if(($issue_purpose_id==2 || $issue_purpose_id==15 || $issue_purpose_id==38) && $row[csf("color")]==93) //Gery Yarn- for Dyed Yarn
				{
					$total_reject_qty=$row[csf("quantity")];
					$DYarnIssueReturn[$index]['qty'] += $total_reject_qty;
					$data_dried_yarnReturn[$index]['amount']+=$total_reject_qty*$dayed_yarn_rate_arr[$row[csf("prod_id")]];
				}
				if(($issue_purpose_id==1 || $issue_purpose_id==2 || $issue_purpose_id==4 || $issue_purpose_id==15 || $issue_purpose_id==38) && $row[csf("color")]==93) //Grey for knitting,Sample with
				{
					$total_reject_qty=$row[csf("quantity")];
					$YarnIssueReturn[$index]['qty'] += $total_reject_qty;
					$YarnIssueReturn[$index]['amount']+=$total_reject_qty*$row[csf('cons_rate')];
				}
			}
		}

		$dried_yarn_data_arr=array();
		foreach($DYarnIssue as $index => $value){
			$dried_yarn_data_arr[$index]['acl']['qty']+=$value['qty']-$DYarnIssueReturn[$index]['qty'];
		}
		foreach ($data_dried_yarn as $index => $value) {
			//$dried_yarn_data_arr[$index]['acl']['qty']+=$value['qty'];
			$dried_yarn_data_arr[$index]['acl']['amount']+=$value['amt']-$data_dried_yarnReturn[$index]['amount'];

		}

		foreach($YarnIssue as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'A';
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
		}
		foreach($YarnRecv_arr as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'b';
			$currency_id=$value['currency_id'];
			$DYarnData[$ind]['acl']['qty']+=($value['qty']-$DYarnReceiveReturn_arr[$ind]['qty']);
			if($currency_id==1) //TK
			{
				$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt'])/$g_exchange_rate;
			}
			else
			{
			 	$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt']);
			}
		}

		$issue_details_yarn_service = sql_select("SELECT d.id as prod_id,e.currency,f.cons_quantity as cons_quantity,c.dyeing_charge as dye_charge,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(c.amount) as service_amount,d.booking_no from inv_transaction f,product_details_master b,wo_yarn_dyeing_dtls c,inv_receive_master d,wo_yarn_dyeing_mst e where f.prod_id=b.id  and f.mst_id=d.id  and e.id=c.mst_id and d.booking_id=e.id and d.entry_form=1  and  c.job_no ='".$jobNumber."' and d.receive_purpose in(7,12,15,38,46,50,51) and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1 order by b.id");

		$yarn_service_arr = array();
		foreach ($issue_details_yarn_service as $row)
		{
			$dyed_type=$row[csf("dyed_type")];
			$currency=$row[csf("currency")];
			$yarn_service_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			//	$recv_yarn_rate=$recv_yarn_rate_arr[$jobNumber]['rate'];
			$ServiceYarnIssue[$index]['qty']+=$row[csf("cons_quantity")];
			if($currency==1) //Tk
			{
				$ServiceYarnIssue[$index]['amount']+=($row[csf("cons_quantity")]*$row[csf("dye_charge")])/$g_exchange_rate;
			}
			else
			{
				$ServiceYarnIssue[$index]['amount']+=$row[csf("cons_quantity")]*$row[csf("dye_charge")];

			}
		}

	    //	print_r($SYarnRecv_arr);die;
		foreach($SYarnRecv_arr as $ind=>$value){
			$currency_id=$value['currency_id'];
			$SYarnData[$ind]['acl']['qty']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty']);
			if( $currency_id==1)
			{
				$SYarnData[$ind]['acl']['amount']+=(($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"])/$g_exchange_rate;
			}
			else
			{
				$SYarnData[$ind]['acl']['amount']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"];

			}
		}

		/*echo "<pre>";
		print_r($SYarnData); */

		$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();

		$sql_conv_yarn="select b.id as po_id, c.job_no, c.id as conv_id,c.cons_process, d.fabric_description,d.composition from wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d  where  b.job_no_mst=c.job_no and c.job_no=d.job_no  and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(153,134,30) and b.is_deleted=0 and b.id in(".implode(",",$poIdArr).") and c.amount>0 ";
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$cons_process=$row[csf("cons_process")];
			$index="".$row[csf("composition")]."";
			$desc="".$row[csf("fabric_description")]."";
			if($cons_process==30)
			{
				$index="".$row[csf("fabric_description")]."";
				$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
				$conv_yarn_arr[$index]['acl']['qty']=$YarnRecv_arr[$row[csf("job_no")]]['qty'];
				$conv_yarn_arr[$index]['acl']['amount']=$YarnRecv_arr[$row[csf("job_no")]]['amt'];
			}
			else
			{
				$ServiceYarnConv[$desc]['amount']+=array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$ServiceYarnConv[$desc]['qty']+=array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			}
		}

		foreach($ServiceYarnConv as $ind=>$value) {
			$SYarnData[$ind]['pre']['qty']+=$value['qty'];
			$SYarnData[$ind]['pre']['amount']+=$value['amount'];
		}
		//print_r($SYarnData);

		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		//echo $lot_tmp;
		$grey_fab_array=array();  //Knitting Cost actual
		$sql_knit_prod="select c.yarn_lot,
		 sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.") and b.po_breakdown_id in(".implode(",",$poIdArr).") group by c.yarn_lot";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}

		/*
			
			1. For trans in need search TO PO and get (FROM PO and PROD)-> BIL (inhouse & outbound)  ( + )
			2. For trans out need search FROM PO and get (FROM PO and PROD)-> BIL (inhouse & outbound) ( - )
		*/
		
		$transfer_ref_in_sql= sql_select("SELECT b.from_order_id, b.from_prod_id, c.qnty, c.barcode_no
		from inv_item_transfer_dtls b, pro_roll_details c
		where b.id=c.dtls_id and c.entry_form in (82) and c.booking_without_order=0 and c.po_breakdown_id in(".implode(",",$poIdArr).") 
		and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");

		foreach ($transfer_ref_in_sql as $row) 
		{
			$grey_fab_trans_qty_acl +=$row[csf('qnty')];
			$from_order_id_arr[$row[csf('from_order_id')]]=$row[csf('from_order_id')];

			$trans_in_barcode_no[$row[csf('barcode_no')]]=$row[csf('qnty')];
			$all_barcode_no[$row[csf('barcode_no')]]=$row[csf('barcode_no')];
			$grey_prod_order_in_ref_arr[$row[csf('from_order_id')]][$row[csf('from_prod_id')]] +=$row[csf('qnty')];
		}


		$transfer_ref_out_sql= sql_select("SELECT d.po_breakdown_id, d.prod_id, c.qnty, c.barcode_no
		from inv_item_transfer_dtls b, pro_roll_details c, order_wise_pro_details d 
		where b.id=c.dtls_id and b.id=d.dtls_id and c.entry_form in (82,110) and d.entry_form in (82,110) and d.trans_type=6 and d.po_breakdown_id in(".implode(",",$poIdArr).") 
		and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0");

		foreach ($transfer_ref_out_sql as $row) 
		{
			$grey_fab_trans_qty_acl -=$row[csf('qnty')];
			$from_order_id_arr[$row[csf('po_breakdown_id')]]=$row[csf('po_breakdown_id')];

			$trans_out_barcode_no[$row[csf('barcode_no')]]=$row[csf('qnty')];
			$all_barcode_no[$row[csf('barcode_no')]]=$row[csf('barcode_no')];
			$grey_prod_order_out_ref_arr[$row[csf('po_breakdown_id')]][$row[csf('prod_id')]] +=$row[csf('qnty')];
		}

		$_trans_from_order_cond=where_con_using_array($from_order_id_arr,0,"order_id");
		$trans_bill_sql=sql_select("select delivery_qty,rate, amount, order_id, item_id, currency_id from subcon_inbound_bill_dtls where process_id=2 and status_active=1 and is_deleted=0 $_trans_from_order_cond order by challan_no ASC");
		$order_wise_bill_arr=array();
		foreach($trans_bill_sql as $row){
			$order_wise_bill_arr[$row[csf('order_id')]][$row[csf('item_id')]]['qty']+=$row[csf('delivery_qty')];
			if($row[csf('currency_id')]==1){
				$rate=$row[csf('rate')]/$g_exchange_rate;
				$order_wise_bill_arr[$row[csf('order_id')]][$row[csf('item_id')]]['amt']+=$row[csf('delivery_qty')]*$rate;
			}
			else{
				$order_wise_bill_arr[$row[csf('order_id')]][$row[csf('item_id')]]['amt']+=$row[csf('delivery_qty')]*$row[csf('rate')];
			}

		}

		$out_trans_from_order_cond=where_con_using_array($from_order_id_arr,0,"b.order_id");

		$subconOutBillData="SELECT b.order_id,b.currency_id, b.rate, b.item_id, sum(case when a.process_id=2 then b.receive_qty end) as rcv_qty, sum(case when a.process_id=2 then b.amount end) as knit_bill from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) $out_trans_from_order_cond $out_trans_from_prod_cond group by b.currency_id,b.order_id, b.rate, b.item_id";
		//echo $subconOutBillData; die;
		$subconOutBillDataArray=sql_select($subconOutBillData);
		 
		foreach($subconOutBillDataArray as $row){
			$order_wise_bill_arr[$row[csf('order_id')]][$row[csf('item_id')]]['qty']+=$row[csf('rcv_qty')];
			if($row[csf('currency_id')]==1){
				$rate=$row[csf('rate')]/$g_exchange_rate;
				$order_wise_bill_arr[$row[csf('order_id')]][$row[csf('item_id')]]['amt']+=$row[csf('rcv_qty')]*$rate;
			}
			else{
				$order_wise_bill_arr[$row[csf('order_id')]][$row[csf('item_id')]]['amt']+=$row[csf('rcv_qty')]*$row[csf('rate')];
			}

		}

		$barcode_cond=where_con_using_array($all_barcode_no,0,"barcode_no");
		$yarn_sql = sql_select("SELECT c.po_breakdown_id, b.prod_id as grey_prod_id, c.barcode_no, ((c.qnty*yarn_percentage)/100) as grey_qnty, ((c.qnty*yarn_percentage)/100)*a.rate as yarn_amount from pro_material_used_dtls a, pro_grey_prod_entry_dtls b, pro_roll_details c where a.dtls_id=b.id and b.id=c.dtls_id and c.entry_form=2 and a.status_active=1 and b.status_active=1 and c.status_active=1 $barcode_cond ");

		foreach ($yarn_sql as $row) 
		{
			$yarn_barcode_arr[$row[csf('barcode_no')]]['amt'] += $row[csf('yarn_amount')];
			$yarn_barcode_arr[$row[csf('barcode_no')]]['qnty'] += $row[csf('grey_qnty')];
		}

		foreach($trans_out_barcode_no as $barcode=>$value)
		{
			$grey_fab_trans_amt_acl  -= $yarn_barcode_arr[$barcode]['amt']/$g_exchange_rate;
		}

		foreach($trans_in_barcode_no as $barcode=>$value)
		{
			$grey_fab_trans_amt_acl  += $yarn_barcode_arr[$barcode]['amt']/$g_exchange_rate;
		}

		foreach($grey_prod_order_in_ref_arr as $order_id=>$orderdata)
		{
			foreach($orderdata as $prod_id=>$value)
			{
				$bill_amount = $order_wise_bill_arr[$order_id][$prod_id]['amt'];
				$bill_qnty = $order_wise_bill_arr[$order_id][$prod_id]['qty'];
				$bill_rate =$bill_amount/$bill_qnty;

				$grey_fab_trans_amt_acl+=$bill_rate*$value;
				//$tr_bill_in +=$bill_rate*$value;
			}
		}

		foreach($grey_prod_order_out_ref_arr as $order_id=>$orderdata)
		{
			foreach($orderdata as $prod_id=>$value)
			{
				$bill_amount = $order_wise_bill_arr[$order_id][$prod_id]['amt'];
				$bill_qnty = $order_wise_bill_arr[$order_id][$prod_id]['qty'];
				$bill_rate =$bill_amount/$bill_qnty;

				$grey_fab_trans_amt_acl -=$bill_rate*$value;

				//echo $bill_amount ."/". $bill_qnty ."=" . $bill_rate."*".$value."<br> <".$prod_id.">";
				//$tr_bill_out +=$bill_rate*$value;

			}
		}
			
		//echo $grey_fab_trans_amt_acl;die;
		//echo '$yarn_out = '.$yarn_out.', $yarn_in = '.$yarn_in.', $tr_bill_in = '.$tr_bill_in.', $tr_bill_out = '.$tr_bill_out;die;

		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		$sql_fin_trans="SELECT b.trans_type, b.po_breakdown_id, b.prod_id, b.color_id, sum(b.quantity) as qnty, sum(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty, sum(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty, d.from_order_id from inv_transaction a, order_wise_pro_details b, inv_item_transfer_mst c, inv_item_transfer_dtls d where a.id=b.trans_id and c.id=a.mst_id and c.id=d.mst_id and d.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and c.transfer_criteria!=2 and b.is_deleted=0 and b.ENTRY_FORM in(15,14,306,134) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by b.trans_type, b.po_breakdown_id,d.from_order_id,b.prod_id, b.color_id";
		//echo $sql_fin_trans; die;

		$result_fin_trans=sql_select( $sql_fin_trans );
		$total_fin_qty=0;  $order_wise_fin_qty=array(); $fin_from_order_arr=array();
		foreach ($result_fin_trans as $row)
		{
			$total_fin_qty+=$row[csf('in_qty')]-$row[csf('out_qty')];
			$fin_from_order_arr[$row[csf('from_order_id')]]=$row[csf('from_order_id')];
			$fin_from_prod_arr[$row[csf('prod_id')]]=$row[csf('prod_id')];
			if($row[csf('trans_type')]==5){
				$order_wise_fin_qty[$row[csf('from_order_id')]][$row[csf('color_id')]]+=$row[csf('in_qty')];
			}
			if($row[csf('trans_type')]==6){
				$order_wise_fin_qty[$row[csf('from_order_id')]][$row[csf('color_id')]]+=$row[csf('out_qty')];
			}
		}
		$fin_trans_from_prod_cond=where_con_using_array($fin_from_prod_arr,0,"b.item_id");
		$inbound_bill_sql=sql_select("SELECT  b.receive_qty, b.rate, b.amount, a.currency_id, b.order_id, b.color_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.process_id=4 and b.order_id in(".implode(",",$fin_from_order_arr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1 $fin_trans_from_prod_cond");


		foreach($inbound_bill_sql as $row){
			$order_wise_inoutbill_arr[$row[csf('order_id')]][$row[csf('color_id')]]['qty']+=$row[csf('receive_qty')];
			if($row[csf('currency_id')]==1){
				$rate=$row[csf('rate')]/$g_exchange_rate;
				$order_wise_inoutbill_arr[$row[csf('order_id')]][$row[csf('color_id')]]['amt']+=$row[csf('receive_qty')]*$rate;
			}
			else{
				$order_wise_inoutbill_arr[$row[csf('order_id')]][$row[csf('color_id')]]['amt']+=$row[csf('receive_qty')]*$row[csf('rate')];
			}
		}
		$outbound_bill_sql=sql_select("SELECT  b.delivery_qty,b.rate,b.amount, a.currency_id, b.order_id, b.color_id from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b where a.id=b.mst_id and a.process_id=4 and b.order_id in(".implode(",",$fin_from_order_arr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1 $fin_trans_from_prod_cond");

		foreach($outbound_bill_sql as $row){
			$order_wise_inoutbill_arr[$row[csf('order_id')]][$row[csf('color_id')]]['qty']+=$row[csf('delivery_qty')];
			if($row[csf('currency_id')]==1){
				$rate=$row[csf('rate')]/$g_exchange_rate;
				$order_wise_inoutbill_arr[$row[csf('order_id')]][$row[csf('color_id')]]['amt']+=$row[csf('delivery_qty')]*$rate;
			}
			else{
				$order_wise_inoutbill_arr[$row[csf('order_id')]][$row[csf('color_id')]]['amt']+=$row[csf('delivery_qty')]*$row[csf('rate')];
			}
		}

		foreach($order_wise_inoutbill_arr as $orderid=>$colordata){
			foreach($colordata as $color_id=>$data){
				$order_wise_inout_bill_rate[$orderid][$color_id]=$order_wise_inoutbill_arr[$orderid][$color_id]['amt']/$order_wise_inoutbill_arr[$orderid][$color_id]['qty'];
			}
		}

		foreach($order_wise_fin_qty as $order_id=>$color_data){
			foreach($color_data as $colorid=>$value){
				$fin_fab_trans_amt_acl+=$order_wise_inout_bill_rate[$order_id][$colorid]*$value;
			}
		}



		$job=str_replace("'","",$job);
		$jobWise_yarn_qty=0;
		$jobWise_yarn_amt=0;
		$sql_jobWise_yarn=sql_select("select JOB_NO, CONS_QNTY, AMOUNT from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_yarn as $val) {
			$jobWise_yarn_qty += $val['CONS_QNTY'];
			$jobWise_yarn_amt += $val['AMOUNT'];
		}
		$per_kg_yarn=$jobWise_yarn_amt/$jobWise_yarn_qty;

		$gray_conversion_costing_process_qty=0;
		$gray_conversion_costing_process_amt=0;
		$finish_conversion_costing_process_qty=0;
		$finish_conversion_costing_process_amt=0;

		$sql_jobWise_conversion=sql_select("select JOB_NO, CONS_PROCESS, REQ_QNTY, AMOUNT from wo_pre_cost_fab_conv_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_conversion as $val) {
			if ($val['CONS_PROCESS']==1){
				$gray_conversion_costing_process_qty += $val['REQ_QNTY'];
				$gray_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if($val['CONS_PROCESS'] !=30 && $val['CONS_PROCESS'] !=1  && $val['CONS_PROCESS'] !=35 && $val['CONS_PROCESS'] !=134) {
				$finish_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if ($val['CONS_PROCESS'] ==31) $finish_conversion_costing_process_qty += $val['REQ_QNTY'];
		}
		$gray_charge_unit = $gray_conversion_costing_process_amt/$gray_conversion_costing_process_qty;
		$finish_charge_unit = $finish_conversion_costing_process_amt/$finish_conversion_costing_process_qty;
		$gray_transfer_amount=$grey_fab_trans_qty_acl*$per_kg_yarn+$grey_fab_trans_qty_acl*$gray_charge_unit;

		$finish_transfer_amount=$tot_fin_fab_transfer_qty*$per_kg_yarn+$tot_fin_fab_transfer_qty*$gray_charge_unit+$tot_fin_fab_transfer_qty*$finish_charge_unit;
		//echo $gray_transfer_amount.'**'.$finish_transfer_amount;


		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		$sql = "select a.item_category, a.booking_type, a.exchange_rate,a.fabric_source, b.trim_group,b.wo_qnty,b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount, b.uom as cons_uom from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no  and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_fabPur=sql_select($sql);//and a.booking_type=1 and a.fabric_source=2
		foreach($data_fabPur as $fabPur_row){
			$booking_type=$fabPur_row[csf('booking_type')];$fabric_source=$fabPur_row[csf('fabric_source')];
			if($booking_type==1 && $fabric_source==2) //Purchase and Fabric
			{
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('fin_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('fin_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}
			else //Trims
			{
				if($fabPur_row[csf('item_category')]==4){
					$rate=$fabPur_row[csf('rate')];
					$con_factor=$trim_groupArr[$fabPur_row[csf('trim_group')]]['con_factor'];
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['qty']+=$fabPur_row[csf('wo_qnty')]*$con_factor;
					//$trimsRecArr[$row[csf('trim_group')]]['out_qty']+=$row[csf('wo_qnty')]*$con_factor;
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['amt']+=$fabPur_row[csf('wo_qnty')]*$con_factor*$rate;
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['cons_uom']=$fabPur_row[csf('cons_uom')];
					//	$trimsRecArr[$row[csf('trim_group')]]['out_amt']+=$row[csf('wo_qnty')]*$con_factor*$rate;
				}

			}
		}
		//echo '<pre>';print_r($trimsRecArr);die;

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				$knitData[$index]['pre']['qty']+=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']+=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}
		}

		$sql = "select b.receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];

			}
		}
		//
		 $sql_in = "select b.delivery_qty as receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and a.party_source=1 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit_in=sql_select($sql_in);
		foreach($data_knit_in as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];
			}
		}

		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_no='".$jobNumber."' and b.cons_process not in(1,2,134,30,35,153)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']+=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']+=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['process_name'].=$conversion_cost_head_array[$row_finish[csf('cons_process')]].',';
		}

		$sql_fin_in = "select  b.delivery_qty as receive_qty,b.rate,b.amount,b.currency_id,c.product_name_details, a.process_id from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=4 and b.order_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish_in=sql_select($sql_fin_in);
		foreach($data_finish_in as $row_finish){
			$currency_id=$row_finish[csf('currency_id')];
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
			}
			else//usd
			{
				$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')];
			}
			//$finishData[$index]['process_name'].=$conversion_cost_head_array[$row_finish[csf('process_id')]].',';
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);


		foreach($data_aop as $row_aop){
			if($row_aop[csf('cons_process')]==35){
				$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
				$AopfinishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$AopfinishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}
		}
		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id  and a.process_id=4  and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop)
		{
			$sub_process_id=$row_aop[csf('sub_process_id')];
			$currency_id=$row_aop[csf('currency_id')];
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
			}
			else
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')];
			}
		}

		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		//$result_trim_trans=sql_select( $trims_rcv_sql );
		$receive_rtn_qty_data=sql_select("SELECT d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d  where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and  d.po_breakdown_id in(".implode(",",$poIdArr).")");
		$trimsRecReArr=array();
		foreach($receive_rtn_qty_data as $row){
			$trimsRecReArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')];
			$trimsRecReArr[$row[csf('item_group_id')]]['amount']+=$row[csf('quantity')]*$row[csf('rate')];
		}
		$trims_rcv_sql=sql_select("SELECT sum(b.quantity) as qty, a.rate, a.item_group_id from inv_receive_master c,product_details_master d,inv_trims_entry_dtls a , order_wise_pro_details b where a.mst_id=c.id and a.trans_id=b.trans_id and a.id=b.dtls_id and a.prod_id=d.id and b.trans_type=1 and b.entry_form=24 and d.item_category_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and d.status_active=1 and d.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") group by a.rate, a.item_group_id order by a.item_group_id");

		foreach($trims_rcv_sql as $row){
			$AcltrimData[$row[csf('item_group_id')]]['qty']+=$row[csf('qty')];
			$AcltrimData[$row[csf('item_group_id')]]['amount']+=$row[csf('qty')]*$row[csf('rate')];
		}

		foreach($AcltrimData as $group_id=>$data){
			$trimData[$group_id]['acl']['qty']+=$data['qty']-$trimsRecReArr[$group_id]['qty'];
			$trimData[$group_id]['acl']['amount']+=$data['amount']-$trimsRecReArr[$group_id]['amount'];
		}

		/* echo '<pre>';print_r($trimData); die; */

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		//print_r($washAmtArr);die;
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$job_no=$row[csf('job_no')];
			if($row[csf('emb_name')]==3)
			{
				$washData['pre']['qty']+=$washQtyArr[$job_no][$row[csf('id')]];
				$washData['pre']['amount']+=$washAmtArr[$job_no][$row[csf('id')]];
			}
			else
			{
				$embData[$row[csf('emb_name')]]['pre']['qty']+=$embQtyArr[$job_no][$row[csf('id')]];
				$embData[$row[csf('emb_name')]]['pre']['amount']+=$embAmtArr[$job_no][$row[csf('id')]];
				$emb_rate_arr[$row[csf('emb_name')]][$row[csf('emb_type')]]=$row[csf('rate')];
			}
		}

		$emb_rcv_arr=sql_select("SELECT a.embel_name, a.embel_type, sum(b.production_qnty) as wo_qnty from pro_garments_production_mst a join pro_garments_production_dtls b on a.id=b.mst_id where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.po_break_down_id in (".implode(",",$poIdArr).") and b.production_type=3 and a.embel_name!=3 group by a.embel_name, a.embel_type");
		foreach($emb_rcv_arr as $row){
			$rate=$emb_rate_arr[$row[csf('embel_name')]][$row[csf('embel_type')]];
			$amount=$row[csf('wo_qnty')]/$costPerQty*$rate;
			$embData[$row[csf('embel_name')]]['acl']['qty']+=$row[csf('wo_qnty')]/$costPerQty;
			//$embData[$row[csf('embel_name')]]['acl']['amount']+=$amount;
		}
		// Embl Cost End ============================
		// Wash Cost ============================

	 	$sql_wash = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and  c.emb_name=3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_wash=sql_select($sql_wash);
		foreach($data_array_wash as $row) {
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}


		$sql_aop = "SELECT a.process as cons_process, a.currency_id, c.fabric_description, c.body_part_id, c.gsm_weight, d.batch_issue_qty as wo_qnty, (b.rate*d.batch_issue_qty) as amount, c.color_type_id from wo_booking_mst a join wo_booking_dtls b on a.booking_no=b.booking_no join wo_pre_cost_fab_conv_cost_dtls e on b.pre_cost_fabric_cost_dtls_id=e.id join wo_pre_cost_fabric_cost_dtls c on e.fabric_description=c.id join pro_grey_batch_dtls d on a.booking_no=d.booking_no and b.gmts_color_id=d.color_id join inv_receive_mas_batchroll f on f.id=d.mst_id where f.entry_form=91 and d.process_id=35 and d.booking_dtls_id=b.id  and a.booking_type=3 and a.process=35 and a.is_short=2 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and b.po_break_down_id in(".implode(",",$poIdArr).") ";
		//echo $sql_aop; die;
		$data_array_aop=sql_select($sql_aop);
		foreach($data_array_aop as $row_aop){
			$desc=$row_aop[csf("fabric_description")];
			//$index="'".$row_aop[csf('body_part_id')]."_".$desc."_".$row_aop[csf('gsm_weight')]."'";
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['acl']['qty']+=$row_aop[csf('wo_qnty')];
				$currency_id=$row_aop[csf('currency_id')];
				if($currency_id==1)
				{
					$AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
				}
				else
				{
				    $AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')];

				}

			}
		//}

		}
		/* echo '<pre>';
		print_r($AopfinishData); die; */

		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'  and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}
		//========Actual Cost Head///
		  $sql_c="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where status_active=1 and is_deleted=0 and  po_id in(".implode(",",$poIdArr).") ";
		$data_array=sql_select($sql_c);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==15){
				$embData[1]['acl']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==16){
				$embData[2]['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		//***********General Item Issue for Print/Embro Cost************//
		 	$gen_issue_print_data=sql_select("SELECT a.id,a.issue_number,a.issue_purpose, b.id as bid, b.cons_quantity, b.prod_id,c.item_category_id, c.item_group_id, b.order_id,c.avg_rate_per_unit
			from inv_issue_master a, inv_transaction b, product_details_master c where   a.id=b.mst_id and b.prod_id=c.id   and  c.item_category_id in(22) and  a.entry_form=21   and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.order_id in(".implode(",",$poIdArr).") ");
		foreach($gen_issue_print_data as $row)
		{
			$category_id=$row[csf("item_category_id")];
			if($category_id==22) //Print
			{
			$emb_type=1;
			}
			$embData[$emb_type]['acl']['amount']+=($row[csf("cons_quantity")]*$row[csf("avg_rate_per_unit")])/$g_exchange_rate;
		}
		unset($gen_issue_print_data);
		$emb_issue_qty=sql_select("SELECT a.id,a.issue_number,b.id as bid, c.item_description, c.item_category_id, c.item_group_id,b.item_return_qty, b.cons_quantity, b.cons_uom, b.order_id,c.avg_rate_per_unit from inv_issue_master a,inv_transaction b, product_details_master c where b.prod_id=c.id and b.transaction_type=2 and b.item_category=57 and a.id=b.mst_id  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.order_id in(".implode(",",$poIdArr).")");
		foreach($emb_issue_qty as $row){
		$category_id=$row[csf("item_category_id")];
		 
		if($category_id==57) //Embro
		{
		$emb_type=2;
		}
		$embData[$emb_type]['acl']['amount']+=($row[csf("cons_quantity")]*$row[csf("avg_rate_per_unit")])/$g_exchange_rate;
		}
		unset($emb_issue_qty);
		
	if(count($gen_issue_print_data)<=0)
	{
		$issue_print_data=sql_select("SELECT a.id,a.issue_number,a.issue_purpose, b.id as bid, d.quantity as cons_quantity, b.prod_id,c.item_category_id, c.item_group_id, b.order_id,c.avg_rate_per_unit
			from inv_issue_master a, inv_transaction b, product_details_master c,order_wise_general_details d where   a.id=b.mst_id and d.trans_id=b.id and b.prod_id=c.id and  d.prod_id=c.id and  d.prod_id=b.prod_id  and  c.item_category_id in(22,57) and  a.entry_form=21 and d.trans_type=2 and d.entry_form=21 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.po_breakdown_id in(".implode(",",$poIdArr).") ");
		foreach($issue_print_data as $row)
		{
				$category_id=$row[csf("item_category_id")];
				if($category_id==22) //Print
				{
				$emb_type=1;
				}
				if($category_id==57) //Embro
				{
				$emb_type=2;
				}
				$embData[$emb_type]['acl']['amount']+=($row[csf("cons_quantity")]*$row[csf("avg_rate_per_unit")])/$g_exchange_rate;
		}
		unset($issue_print_data);
	}
		//print_r($embData);
		$sweing_output_arr=sql_select("SELECT a.production_type, sum(b.production_qnty) as sewingoutput from pro_garments_production_mst a join pro_garments_production_dtls b on a.id=b.mst_id where a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.po_break_down_id in (".implode(",",$poIdArr).") and b.production_type=5 group by a.production_type");
		foreach($sweing_output_arr as $row){
			$otherData['acl']['cm_cost']['qty']+=$row[csf('sewingoutput')];
		}
		unset($sweing_output_arr);

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}
		unset($sql_std_para);
		//echo '<pre>';print_r($otherData);
		// Other Cost End ============================
		//==========******************Batch Costing********************===========
		$batch_poid_cond=where_con_using_array($poIdArr,0,"po_id");
		$sql_batch=sql_select("select mst_id as batch_id from pro_batch_create_dtls  where   status_active=1 and is_deleted=0 $batch_poid_cond");
	//	 echo "select mst_id as batch_id from pro_batch_create_dtls  where   status_active=1 and is_deleted=0 $batch_poid_cond";
		foreach($sql_batch as $row)
		{
			$batch_idArr[$row[csf('batch_id')]]=$row[csf('batch_id')];
		}
		$batch_id_cond=where_con_using_array($batch_idArr,0,"a.batch_id");
		$sql_req = "SELECT a.ID,b.mst_id as REQ_ID,a.batch_id as BATCH_ID,a.BATCH_QTY,a.NEW_BATCH_WEIGHT,a.ENTRY_FORM,c.batch_id as RE_BATCH_ID from pro_recipe_entry_mst a, dyes_chem_requ_recipe_att b,dyes_chem_issue_requ_mst c where b.recipe_id=a.id  and c.id=b.mst_id $batch_id_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 ";
	//  echo $sql_req;die;
	$result_req = sql_select($sql_req);
	foreach($result_req as $val)
	{
		$req_id_array[$val['REQ_ID']] = $val['REQ_ID'];
	}
	if(count($req_id_array))
	{
		$requisition_id_cond=where_con_using_array($req_id_array,0,"a.requisition_no");
	}
	$issue_sql = sql_select("SELECT a.MST_ID ,a.REQUISITION_NO,b.BATCH_NO,a.ITEM_CATEGORY,a.PROD_ID,a.CONS_QUANTITY,a.CONS_AMOUNT from inv_transaction a,inv_issue_master b where a.mst_id=b.id and b.entry_form=5 and b.is_deleted=0 and b.status_active=1 and a.status_active=1 and a.transaction_type=2 and a.item_category in (5,6,7)    ");
	//echo "SELECT a.MST_ID ,a.REQUISITION_NO,b.BATCH_NO,a.ITEM_CATEGORY,a.PROD_ID,a.CONS_QUANTITY,a.CONS_AMOUNT from inv_transaction a,inv_issue_master b where a.mst_id=b.id and b.entry_form=5 and b.is_deleted=0 and b.status_active=1 and a.status_active=1 and a.transaction_type=2 and a.item_category in (5,6,7)  $requisition_id_cond   ";

	/*
		 $sql_dyes_cost =sql_select("select a.batch_no,b.item_category,(b.cons_amount) as dyes_chemical_cost
		from inv_issue_master a, inv_transaction b
		where a.id=b.mst_id and b.transaction_type=2 and a.entry_form=5 and a.batch_no  is not null  and   b.item_category in (5,6,7) "); */
		//$dyes_chemical_arr=array();
	//	print_r($batch_idArr);
		//echo "ASSS";
		//die;
		$issue_MstIdArr=array();
	   $acl_dyes_chemical_qty=0;$acl_dyes_chemical_cost=0;
		foreach($issue_sql as $val)
		{
			$batchId=$val["BATCH_NO"];
			foreach($batch_idArr as $bid)
			{
				if($bid==$batchId)
				{
					$acl_dyes_chemical_cost+=$val["CONS_AMOUNT"];
					$acl_dyes_chemical_qty+=$val["CONS_QUANTITY"];
					$issue_MstIdArr[$val["MST_ID"]]=$val["MST_ID"];
				}
			}

		}
		//echo $acl_dyes_chemical_cost.'=AAD';die;


//==========******End******************Batch Costing********************===========
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td>
                    <td style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td>Dealing Marchant</td>
                    <td colspan="3" style="word-break:break-all;"><? echo $dealing_marchants;?></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"><? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right" colspan="2"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>

			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1100px; margin-top:10px; float: left" rules="all">
				<thead>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="30">UOM</td>
						<td width="80">Pre-Cost Qty</td>
						<td width="80">Pre-Cost Price</td>
						<td width="80">Pre-Cost Value</td>
						<td width="80">Cont. % On FOB Value</td>
						<td width="80">Actual Qty</td>
						<td width="80">Actual Price</td>
						<td width="80">Actual Value</td>
						<td width="80">Cont. % On FOB Value</td>
					</tr>
				</thead>
				<tr style="font-weight:bold" class="gray_yarn">
					<td colspan="10" title="including yarn dyed">Grey Yarn Cost</td>
				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					if($row['preCost']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['acl']['qty']>0)
					{
						$item_descrition =$lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					$totalGyPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalGyAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					$totalGyPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalGyAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="gray_yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				foreach($qYarnData as $index=>$row ){

					$totalGyPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalGyAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalGyPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalGyAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="gray_yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="QC"><?=$index; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo " "; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="grayyarntotal" class="adl-signs" onClick="yarnT(this.id,'.gray_yarn')">+</span>&nbsp;&nbsp;Grey Yarn Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalGyPreQty,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalGyPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalGyPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalGyPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalGyPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','4')"><? echo fn_number_format($totalGyAclQty,4); ?></A>
						<? //echo fn_number_format($totalGyAclQty,4); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format($totalGyAclValue/$totalGyAclQty,4); ?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalGyAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalGyAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalGyAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalGyAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
                <tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="yarn dyed">Dyed Yarn Cost</td>
				</tr>
                <?
				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row )
				{
					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					?>

				    <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right" title="yarn Recv Actual"><? echo fn_number_format($yarn_acl_qty,4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}

				foreach($dried_yarn_data_arr as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['preCost']['qty']>0)
					{
						$item_descrition =$index;
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				//Dyed End
				if(count($SYarnData)>0){
				?>

                 <tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="yarn dyed">Service Yarn Cost</td>
				</tr>
                <?
				}
                  foreach($SYarnData as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['pre']['qty']>0)
					{
						$item_descrition =$index;
					}
					//$item_descrition =$index;

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['pre']['amount']>0) echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Dyed Yarn Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalPreQty,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','4')"><? echo fn_number_format($totalAclQty,4); ?></A>
						<? //echo fn_number_format($totalAclQty,4); ?>
					</td>
					<td width="80" align="right"><?	echo fn_number_format($totalAclValue/$totalAclQty,4); ?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="300" >Fabric Purchase Cost (Knit)</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="30">Yds</td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<? echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurPre*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurAcl*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="10">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0; $totalKnitPreValue=0; $totalKnitAclValue=0; $totalKniMktQty=0; $totalKnitPreQty=0; $totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=fn_number_format($row['acl']['qty'],4,".","");
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalKnitAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold; display:none" class="dyfiX">
					<td colspan="10">Dye & Fin  Cost</td>
				</tr>
				<?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$process_names='';
					if ($row['pre']['qty'] != 0){
						$process_names="(".rtrim($row['pre']['process_name'],',').")";
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					//$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					//$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<!--<tr style="display:none" class="dyfi" bgcolor="<? //echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? //echo $item_descrition.' '.$process_names; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>-->
					<?
					$d++;
				}///$g_exchange_rate
				$totalFinAclValue=fn_number_format($acl_dyes_chemical_cost/$g_exchange_rate,4,".","");
				$totalFinAclQty=fn_number_format($acl_dyes_chemical_qty,4,".","");
				?>
				<tr style="font-weight:bold;background-color:#CCC" >
					<td width="300" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish  Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? //echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						//batch_idArr //req_id_array
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? //echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80" align="right"><? //echo fn_number_format($totalFinAclValue/$totalFinAclQty,4);?></td>
					<td width="80" align="right" title="Tk=<?=$acl_dyes_chemical_cost;?>" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						 <A href="##"  onClick="fn_batch_cost_popup('<? echo implode(",",$batch_idArr); ?>','batch_cost_dtls_popup','<? echo implode(",",$issue_MstIdArr); ?>',1)"> <? echo fn_number_format($totalFinAclValue,4); ?> </A><?

						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
                <tr style="font-weight:bold" class="aop">
					<td colspan="10">AOP Cost</td>
				</tr>
                <?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$a=1;
				foreach($AopfinishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($a%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="aop" bgcolor="<? echo $bgcolor;?>" onClick="change_color('traop_<? echo $a; ?>','<? echo $bgcolor;?>')" id="traop_<? echo $a; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$a++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="aoptotal"  class="adl-signs" onClick="yarnT(this.id,'.aop')">+</span>&nbsp;&nbsp  AOP Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>

				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="300" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? echo fn_number_format($aopData['mkt']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['mkt']['amount']/$aopData['mkt']['qty'],4)?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['mkt']['amount'],4); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aopData['pre']['amount'],4,".","")>fn_number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($aopData['pre']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aopData['acl']['amount'],4,".","")>fn_number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aopData['acl']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="10">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_amt_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<!-- <td width="80" align="right"><a href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($grey_fab_trans_amt_acl,4); ?></a>&nbsp;<? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_amt_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($grey_fab_trans_amt_acl*100/$jobValue),2).'%'; ?></td>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="30">Kg</td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"><? echo fn_number_format($total_fin_qty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($fin_fab_trans_amt_acl/$total_fin_qty,4); ?></td>
						<!-- <td width="80" align="right"><a href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($finish_transfer_amount,4); ?></a><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($fin_fab_trans_amt_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($fin_fab_trans_amt_acl*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="30">Kg</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($gray_transfer_amount/$grey_fab_trans_qty_acl)+($finish_transfer_amount/$tot_fin_fab_transfer_qty),4);//echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($grey_fab_trans_amt_acl+$finish_transfer_amount,4);
						$total_grey_fin_fab_transfer_actl_cost=$grey_fab_trans_amt_acl+$finish_transfer_amount;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format((($grey_fab_trans_amt_acl+$finish_transfer_amount)*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr>
					<td colspan="10" style="font-weight:bold" class="trims">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						$totalTrimAclQty+=fn_number_format($row['acl']['qty'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $trim_groupArr[$index]['item_name'] ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" ><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
						</tr>
						<?
						$t++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="trimstotal" class="adl-signs" onClick="yarnT(this.id,'.trims')">+</span>&nbsp;&nbsp;Trims Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalTrimAclQty,2) ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalTrimAclValue/$totalTrimAclQty,3) ?></td>

					<td width="80" align="right">
						<?	echo fn_number_format($totalTrimAclValue,4);
							$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
							$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimAclValue*100/$jobValue),2).'%'; ?></td>


				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$totalEmblPreQty=0; $totalEmblAclQty=0;$totalEmblPreValue=0; $totalEmblAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
                <tr>
					<td colspan="10" style="font-weight:bold" class="embell">Embellishment Cost</td>
				</tr>
                <? 	$em=1;
                foreach($embData as $index=>$row )
				{
						if($em%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" class="embell" onClick="change_color('emblish_<? echo $em; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $em; ?>">
					<td width="300" ><? echo $emblishment_name_array[$index]; ?></td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($row['pre']['amount'],4,".","")>fn_number_format($row['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($row['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($row['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>

					<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($row['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($row['acl']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
                <?
				$totalEmblPreQty+=$row['pre']['qty'];
				$totalEmblPreValue+=$row['pre']['amount'];
				$totalEmblAclQty+=$row['acl']['qty'];
				$totalEmblAclValue+=$row['acl']['amount'];
				 $em++;
					}
				?>
                <tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="embelltotal" class="adl-signs" onClick="yarnT(this.id,'.embell')">+</span>&nbsp;&nbsp;Embellishment Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalEmblPreQty,2); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? //if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						 echo fn_number_format($totalEmblPreValue,4);
						//$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						//$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalEmblPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalEmblAclQty,2) ?></td>
					<td width="80" align="right"><? // echo fn_number_format($totalTrimAclValue/$totalTrimAclQty,3) ?></td>

					<td width="80" align="right">
						<?	echo fn_number_format($totalEmblAclValue,4);
							//$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
							//$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalEmblAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
                
                
                
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" >Wash Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount'],4);$totalOtherPreValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount'],4); $totalOtherAclValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherAclValue+=$commiData['pre']['amount']; ?></td>
					<td width="80" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount']/$commaData['pre']['qty'],4);  ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($commaData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; $commer_act_cost=$exfactory_amount_arr[6]; ?></td>
					<td width="80" align="right"><? //echo fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commer_act_cost,4);
					 $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".","");?></td>
					 <td width="80" align="right"><? echo fn_number_format(($commer_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['lab_test']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['lab_test']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherAclValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><?  $totalOtherAclValue+=fn_number_format($exfactory_amount_arr[5],4,".",""); echo fn_number_format($exfactory_amount_arr[5],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>
				</tr>
                <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtaopyd_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtaopyd_<? echo $embl; ?>">
					<td width="300" >Trims+AOP+Y/D Cost(10%)</td>
					<td width="30"><? echo 'Pcs';//$costPerUom;
					$total_Pre_trim_aop_yd_cost=(($totalTrimPreValue+$totalFinPreValue+$totalPreValue)*10)/100;
					 ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($total_Pre_trim_aop_yd_cost,4,'.','');
					 $totalOtherPreValue+=fn_number_format($total_Pre_trim_aop_yd_cost,4,".","");?></td>
					<td width="80" align="right"><? //echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? //echo $exfactoryQty ?></td>
					<td width="80" align="right"></td>
					<td width="80" align="right"><?  //$totalOtherAclValue+=fn_number_format($exfactory_amount_arr[5],4,".",""); echo fn_number_format($exfactory_amount_arr[5],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>
				</tr>
                
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<? echo fn_number_format($totalOtherPreValue,4); $GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right">
						<? echo fn_number_format($totalOtherAclValue,4); $GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right"><? echo $jobQty ?></td>
					<td width="80" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($exfactoryValue*100/$jobValue),2).'%'; ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>
					<td width="120">
                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>
						    <div style="float:left;width:120px" >
							<?
							foreach($nameArray_img AS $inf) {
								?>
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
							    <?
							}
							?>
							</div>
						<?
					}
					else echo ""; ?>
                    </td>
				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px;" rules="all">
				<tr><td colspan="8"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<!-- <tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr> -->
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}

	$html = ob_get_contents();
    ob_clean();
    foreach (glob("*.xls") as $filename) {
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_name."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');
    $is_created = fwrite($create_new_doc, $html);
    echo "$html****$filename";

	exit();
}

if($action=="report_generate7")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	//echo str_replace("'","",$cbo_costcontrol_source);die;

	$budget_version=str_replace("'","",$cbo_budget_version);
	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');

	$buyer_arr=return_library_array( "select id, short_name from lib_buyer", "id", "short_name"  );
	$lib_yarn_count=return_library_array( "select yarn_count,id from lib_yarn_count", "id", "yarn_count");
	$dealing_merchant_array = return_library_array("select id, team_member_name from lib_mkt_team_member_info","id","team_member_name");
	$team_leader_library=return_library_array( "select id, team_leader_name from lib_marketing_team", "id", "team_leader_name");

	//echo $budget_version; die;
	if($budget_version==1){
		$entry_from=111;
	}
	else if($budget_version==2){
		$entry_from=158;
	}
	else if($budget_version==3){
		$entry_from=520;
	}
	else{
		$entry_from=237;
	}


	if(str_replace("'","",$cbo_costcontrol_source)==1 || str_replace("'","",$cbo_costcontrol_source)==4)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("SELECT a.job_no from wo_po_details_master a,wo_pre_cost_mst f where  a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=$entry_from and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");
		//echo "SELECT a.job_no from wo_po_details_master a,wo_pre_cost_mst f where  a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=$entry_from and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no"; die;

		$chk_job_nos='';
		foreach($check_data as $row)
		{
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
			 $sql="SELECT a.id as job_id,a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id,a.inquiry_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}
		 $ref_no="";
		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();
		$shipArry=array(0,1,2);
		$shiping_status=1;$shiping_status_id="";
		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('inquiry_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$JobIdArr[$row[csf('job_id')]]=$row[csf('job_id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$ShipDateArrall[date("d-m-Y",strtotime($row[csf('shipment_date')]))]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			if($row[csf('shiping_status')]==3) //Full
			{
			 $shiping_status=2;
			}
			//echo $shiping_status.'D';
			$shipingStatus=$shiping_status;
			$shiping_status_id.=$row[csf('shiping_status')].',';
			$po_ids.=$row[csf('id')].',';$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
		}
		 //print_r($ShipDateArrall);
		$shiping_status_id=rtrim($shiping_status_id,',');

		$shiping_status_idAll=array_unique(explode(",",$shiping_status_id));
		//print_r($shiping_status_idAll);
		$shiping_status=3;
		foreach($shiping_status_idAll as $sid)
		{
			//echo $sid."D,";
			if(in_array($sid,$shipArry))
			{
				$shiping_status=2;
			}
		}
		//echo $shiping_status;
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."  and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);

		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//PO ID Ref from=1
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 2, $JobIdArr, $empty_arr);//Job ID Ref from=2

		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")"; else $po_cond_for_in="";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		if($costPerQty>1){
			$costPerUom=($costPerQty/12)." Dzn";
		}else{
			$costPerUom=($costPerQty/1)." Pcs";
		}
		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array(); $washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		 $sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/*echo "<pre>";
		print_r($YarnData); die;*/
		//production_logicsoft

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group  ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}

		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			  $sqlQc="select a.qc_no,a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.inquery_id =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$jobQty;//$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$qc_no=$qcrow[csf('qc_no')];
				$quaCostingPerQty=0;
				//if($quaCostingPer==1)
				$quaCostingPerQty=1;
			}
			unset($dataQc);
			//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$qc_no." order by id asc";
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1) //Fabric
				{
					if(($rowConsRate[csf("rate")]*1)>0)
					{
						//$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";

						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
						//echo $mktcons.'-'.$mktamt.'-'.$rowConsRate[csf('tot_cons')].'-'.$quaCostingPerQty.'-'.$quaOfferQnty.'<br>';
						$fabPurArr['mkt']['woven']['qty']+=$mktcons;
						$fabPurArr['mkt']['woven']['amount']+=$ConsRate*$mktcons;
					}

				}
				if($rowConsRate[csf("type")]==3 ) //Wash
				{
					$index="'".$emblishment_wash_type_arr[$rowConsRate[csf("particular_type_id")]]."'";

					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					if($rowConsRate[csf('rate')]>0)
					{
					$washData[$index]['mkt']['qty']+=$mktcons;
					$washData[$index]['mkt']['amount']+=$ConsRate*$mktcons;
					}
				}
				if($rowConsRate[csf("type")]==2)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$ConsRate*$mktcons;
				}
				if($rowConsRate[csf("type")]==4) //Acceoosries
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$ConsRate=$rowConsRate[csf('value')]/$rowConsRate[csf('tot_cons')];
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['qty']+=$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['amount']+=$ConsRate*$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['cons_uom']=$rowConsRate[csf('cons_uom')];
				}
			}
			//echo "<pre>";
			//print_r($washData);
			//die;

			$sql_item_summ="select mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$qc_no." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}

		//$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
		 $sql_grey_trans="select c.from_order_id,a.from_prod_id,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		 (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		  (CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		  from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6)";//
		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_idarr[$row[csf('from_prod_id')]]=$row[csf('from_prod_id')];
		}
		 
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 9, $from_prod_idarr, $empty_arr);//Prod ID Ref from=6
		 
		$sql_prod=sql_select("select b.id, b.product_name_details,b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=9 and g.entry_form=18");
		foreach($sql_prod as $row){
			$avg_rate_array[$row[csf("id")]]=$row[csf("avg_rate_per_unit")];
			$desc_array[$row[csf("id")]]=$row[csf("product_name_details")];
		}

		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			$from_order_id.=$row[csf('from_order_id')].',';
			$grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$grey_fab_trans_amt_acl+=($row[csf('grey_in_amt')]-$row[csf('grey_out_amt')]);
		}
		$from_order_id=rtrim($from_order_id,',');
		$from_order_ids=array_unique(explode(",",$from_order_id));

		$subconOutBillData="select b.order_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
		}

		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, sum(b.quantity) as qnty,
			(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
			(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		 c.from_order_id
		  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g  where a.id=b.trans_id and c.id=a.mst_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6)";
		$result_fin_trans=sql_select( $sql_fin_trans );
		$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
		foreach ($result_fin_trans as $row)
		{
			$fin_from_order_id.=$row[csf('from_order_id')].',';
			$avg_rate=$avg_rate_array[$row[csf('prod_id')]];

			$fin_in_qnty+=$row[csf('in_qty')];
			$fin_out_qnty+=$row[csf('out_qty')];

			$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
			$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;
		}

		$po_ids=implode(",",$poIdArr);
		unset($result_fin_trans);
		$fin_from_order_id=rtrim($fin_from_order_id,',');
		$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

		$fin_trans_in_qty=$fin_in_qnty;
		$fin_trans_out_qty=$fin_out_qnty;

		$fin_trans_in_amt=$fin_in_amt;
		$fin_trans_out_amt=$fin_out_amt;



		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row)
		{
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=1 and a.fabric_source=2   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$data_fabPur=sql_select($sql);
			foreach($data_fabPur as $fabPur_row)
			{
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}



		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		//print_r($trimData);

		$trimsRecArr=array();


		 $sql_trim_wo = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.trim_group from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_trim_cost_dtls c wher,gbl_temp_engine g e a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=2  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_wo=sql_select($sql_trim_wo);
		foreach($data_array_wo as $row){
			$index=$row[csf('trim_group')];
			$trimData[$index]['acl']['qty']+=$row[csf('wo_qnty')];
			$trimData[$index]['acl']['amount']+=$row[csf('amount')];

		}
		unset($data_array_wo);

	/*	echo $general_item_issue_sql="SELECT d.buyer_name, d.season_buyer_wise, d.job_no, d.style_ref_no, d.total_set_qnty, c.id as po_id, c.po_number, c.file_no, c.grouping as int_ref_no, c.po_quantity, a.item_group_id as trim_group, a.unit_of_measure as uom, a.item_description as description, b.store_id, a.id as prod_id,e.QUANTITY as cons_quantity, e.AMOUNT as cons_amount
			from product_details_master a, inv_transaction b, order_wise_general_details e, wo_po_break_down c, wo_po_details_master d
			where a.id=b.prod_id and b.id=e.TRANS_ID and e.PO_BREAKDOWN_ID=c.id and c.job_no_mst=d.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form<>24 and b.transaction_type in(2,3,6)  and c.id in(".implode(",",$poIdArr).")";die;*/


		//print_r($trimData);

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();

		 $sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row)
		{
			$index="'".$emblishment_wash_type_arr[$row[csf("emb_type")]]."'";
			if($row[csf('emb_name')]==3)
			{
				$washData[$index]['pre']['qty']+=$washQtyArr[$row[csf("job_no")]][$row[csf('id')]];
				$washData[$index]['pre']['amount']+=$washAmtArr[$row[csf("job_no")]][$row[csf('id')]];
			}
			else
			{
				$embData['pre']['qty']+=$embQtyArr[$jobNumber][$row[csf('id')]];
				$embData['pre']['amount']+=$embAmtArr[$jobNumber][$row[csf('id')]];
			}
		}
		//print_r($washData);
		 $sql_emb = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.emb_name, c.emb_type from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and c.emb_name!=3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array_emb=sql_select($sql_emb);
		foreach($data_array_emb as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];
		}
		// Embl Cost End ============================
		// Wash Cost ============================


		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount,c.emb_name, c.emb_type from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id  and   b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18    and a.booking_type=6 and c.emb_name =3   and a.is_deleted=0 and a.status_active=1   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$index="'".$emblishment_wash_type_arr[$row[csf("emb_type")]]."'";
			$washData[$index]['acl']['qty']+=$row[csf('wo_qnty')];
			$washData[$index]['acl']['amount']+=$row[csf('amount')];

		}

		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}

		 $sql_cm_cost="select jobNo, available_min, production_date from production_logicsoft where jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			$production_date=change_date_format($row[csf('production_date')],'','',1);
			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		$sql="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where po_id in(".implode(",",$poIdArr).")";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		// Other Cost End ============================
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."  and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);

		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><?
					 echo implode(",",$ShipDateArrall);
					 ?></td>
					<td>Team Leader</td>
                    <td style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td>Dealing Marchant</td>
                    <td style="word-break:break-all;" colspan="3"><? echo $dealing_marchants;?></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"><? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right" colspan="3"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>
			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px; margin-top:10px" rules="all">
				<thead>
                	<tr>
                    <td> </td>
                    <td> </td>
                     <td colspan="3" align="center"> <b>Buyer Cost</b></td>
                     <td colspan="4" align="center"> <b>Booking Cost</b></td>
                     <td colspan="4" align="center"> <b>Post Cost</b></td>
                    </tr>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="60">UOM</td>
						<td width="100">Marketing Qty</td>
						<td width="100">Marketing Price</td>
						<td width="100">Marketing Value</td>

						<td width="100">Pre-Cost Qty</td>
						<td width="100">Pre-Cost Price</td>
						<td width="100">Pre-Cost Value</td>
                        <td width="100">Cont. % On FOB Value</td>

						<td width="100">Actual Qty</td>
						<td width="100">Actual Price</td>
						<td width="100">Actual Value</td>
                        <td width="100">Cont. % On FOB Value</td>
					</tr>
				</thead>

				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;

				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";

				?>

				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="60">Yds</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($fabPurArr['pre']['woven']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($fabPurArr['acl']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">
						<?
						$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","");
						echo fn_number_format($fabPurMkt,4);
						$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
						$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","");
						$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","");
						?>
					</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor="<? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<? echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
                      <td width="100" align="right"><? echo fn_number_format(($fabPurPre*100/$jobValue),2).'%'; ?></td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
                     <td width="100" align="right"><? echo fn_number_format(($fabPurAcl*100/$jobValue),2).'%'; ?></td>
				</tr>


				 <tr style="font-weight:bold" class="transc">
					<td colspan="12">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Trims Cost<? //echo $item_descrition ?></td>
						<td width="60"></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount'],4); ?></td>

						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
                        <td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
                        <td width="100" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>


						<td width="100" align="right"><? //echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($tot_grey_fab_cost_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($tot_grey_fab_cost_acl,4); ?></A>&nbsp;<? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
                       <td width="100" align="right"><? echo fn_number_format(($tot_grey_fab_cost_acl*100/$jobValue),2).'%'; ?></td>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="60">Yds</td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>

						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
                        <td width="100" align="right"></td>

						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_cost/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
                         <td width="100" align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>

					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
                    <td width="100" align="right"><? //echo fn_number_format(($tot_fin_fab_transfer_cost*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl,4);
						$total_grey_fin_fab_transfer_actl_cost=$tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format((($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr>
					<td colspan="12" style="font-weight:bold" class="trims">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					if($index>0)
					{
						$item_descrition = $trim_groupArr[$index]['item_name'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="60"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>

							<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="100" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
                             <td width="100" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>

							<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="100" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
                            <td width="100" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="trimstotal" class="adl-signs" onClick="yarnT(this.id,'.trims')">+</span>&nbsp;&nbspTrims Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
                     <td width="100" align="right"><? echo fn_number_format(($totalTrimPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format(($totalTrimAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>

				  <?
				$w=1;$total_mkt_qty=$total_mkt_amt=$total_pre_qty=$total_pre_amt=$total_acl_qty=$total_acl_amt=0;
                foreach($washData as $index=>$row ){
					$index=str_replace("'","",$index);
					$item_des=explode("_",$index);
					$item_des=implode(",",$item_des);
					/*$item_descrition = $trim_groupArr[$index]['item_name'];
					$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");*/
					if($w%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				?>
				<tr  class="wash" bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" ><? echo  $item_des;	?></td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); $GrandTotalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");?></td>

					<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($row['pre']['amount'],4,".","")>fn_number_format($row['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($row['pre']['amount'],4);$GrandTotalPreValue+=fn_number_format($row['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($row['pre']['amount']/$jobValue)*100,4); ?></td>
                     <td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($row['acl']['amount'],4);$GrandTotalAclValue+=fn_number_format($row['acl']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($row['acl']['amount']/$jobValue)*100,4); ?></td>
				</tr>
                <?
				$w++;
				$total_mkt_qty+=$row['mkt']['qty'];
				$total_mkt_amt+=$row['mkt']['amount'];
				$total_pre_qty+=$row['pre']['qty'];
				$total_pre_amt+=$row['pre']['amount'];
				$total_acl_qty+=$row['acl']['qty'];
				$total_acl_amt+=$row['acl']['amount'];
				}
				?>
                 <tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="washtotal"  class="adl-signs" onClick="yarnT(this.id,'.wash')">+</span>&nbsp;&nbsp;Wash Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_amt/$total_mkt_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_mkt_amt,4); //$totalOtherMktValue+=fn_number_format($total_mkt_amt,4,".","");?></td>


					<td width="100" align="right"><? echo fn_number_format($total_pre_qty,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($total_pre_amt/$total_pre_qty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($total_pre_amt,4,".","")>fn_number_format($total_pre_amt,4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($total_pre_amt,4);//$totalOtherPreValue+=fn_number_format($total_pre_amt,4,".",""); ?></td>
                      <td width="100" align="right"><? echo fn_number_format(($total_pre_amt/$jobValue)*100,4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($total_acl_qty,4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($total_acl_amt/$total_acl_qty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($total_acl_amt,4,".","")>fn_number_format($total_acl_amt,4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($total_acl_amt,4);//$totalOtherAclValue+=fn_number_format($total_acl_amt,4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($total_acl_amt/$jobValue)*100,4); ?></td>
				</tr>
                <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($embData['mkt']['amount'],4,".","");?></td>


					<td width="100" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? echo fn_number_format(($embData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>

					<td width="100" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? echo fn_number_format(($embData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>



				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commiData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //$aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty; echo fn_number_format($aclCommiAmt/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($aclCommiAmt,4); $totalOtherAclValue+=$aclCommiAmt; ?></td>
                    <td width="100" align="right"><? //echo fn_number_format(($aclCommiAmt*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commaData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($commaData['pre']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="100" align="right"><? //echo  fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>

					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? //if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($commer_act_cost,4); $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".",""); ?></td>
                    <td width="100" align="right"><? //echo fn_number_format(($commer_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? //if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['freight']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['acl']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['ore']['freight']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><?
					//$test_act_cost=$unitPrice*$exfactoryQty*(0.05/100);
					//echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.05/100)" bgcolor="<? //if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($test_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? //echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['inspection']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
                     <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><?// echo $exfactoryQty ?></td>
					<td width="100" align="right"><? //echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? //if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
                     <td width="100" align="right"><? //echo fn_number_format(($otherData['acl']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
                    <td width="100" align="right"><? echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>

					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")) $font_color="white";
					else $font_color="black";
					?>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['cm_cost']['amount']/$exfactoryQty,4); ?></td>
					<!--<td width="100" align="right"  bgcolor="<? //if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?
						$making_cost_act=$otherData['pre']['cm_cost']['rate']*$exfactoryQty*(80/100);
					//$totalOtherAclValue+=fn_number_format($otherData['acl']['cm_cost']['amount'],4,".",""); //echo fn_number_format($otherData['acl']['cm_cost']['amount'],4);?></td>-->

					<!-- <a href="#report_details" style="color:<? //echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? //echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"></a> -->

					<td width="100" title="(Pre Cost Rate*Ex Fact Qty*80)/100)"  align="right"  bgcolor="<? if(fn_number_format($making_cost_act,4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=fn_number_format($making_cost_act,4,".",""); echo fn_number_format($making_cost_act,4); ?>
                    </td>
                     <td width="100" align="right"><? echo fn_number_format(($making_cost_act*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo fn_number_format($totalOtherMktValue,4); $GrandTotalMktValue+=fn_number_format($totalOtherMktValue,4,".",""); ?></td>

                    <td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherPreValue,4); $GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".",""); ?>
					</td>
                   <td width="100" align="right"><? echo fn_number_format(($totalOtherPreValue*100/$jobValue),2).'%'; ?></td>

					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherAclValue,4); $GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".",""); ?>
					</td>
                    <td width="100" align="right"><? echo fn_number_format(($totalOtherAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>

					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
                     <td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue*100/$jobValue),2).'%'; ?></td>

					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
                    <td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue*100/$jobValue),2).'%'; ?></td>

				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="60">&nbsp;</td>
					<td width="100" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="100" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo fn_number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="100" align="right"><? $quaOfferValue=$quaOfferQnty*$quaPriceWithCommnPcs; echo fn_number_format($quaOfferValue,4) ?></td>

                    <td width="100" align="right"><? echo $jobQty ?></td>
					<td width="100" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($jobValue,4) ?></td>
                    <td width="100" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>

					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
                      <td width="100" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>

                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>


							<?
							foreach($nameArray_img AS $inf) {
								?>
                                 <td width="120">
                                <div style="float:left;width:120px" >
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
                                 </td>
                               </div>
							    <?
							}
							?>

						<?
					}
					else echo ""; ?>

				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr><td colspan="10"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Trims</td>
					<td width="100">Trims %</td>
                    <td width="150">Wash</td>
					<td width="100">Wash %</td>

					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"  title="TotalMktValue/OfferValue*100"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right" title="Total Expand/OfferValue*100"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
                    <td width="150" align="right"><? echo fn_number_format($total_mkt_amt,4) ?></td>
					<td width="100" align="right" title="Total Mkt Wash/OfferValue*100"><? echo fn_number_format(($total_mkt_amt/$quaOfferValue)*100,4); ?></td>

					<td width="200" align="right" title="Offer Value-GrandTotal Mkt Value"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right" title="Offer Value-GrandTotal Mkt Value/OfferValue*100"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right" title="TotalPreValue/JobValue*100"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right" title="Total Trims/Job Value*100"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
                     <td width="150" align="right"><? echo fn_number_format($total_pre_amt,4) ?></td>
					<td width="100" align="right" title="Total Pre Wash/JobValue*100"><? echo fn_number_format(($total_pre_amt/$jobValue)*100,4); ?></td>

					<td width="200" align="right" title="Job Value-GrandTotal Pre Value"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right" title="Job Value-GrandTotal Pre Value/PreValue*100"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right" title="TotalActualValue/Ex-FactValue*100"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right" title="Total TrimsAcl/Ex-fact Value*100"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
                     <td width="150" align="right"><? echo fn_number_format($total_acl_amt,4) ?></td>
					<td width="100" align="right" title="Total Wash Acl/Ex-FactValue*100"><? echo fn_number_format(($total_acl_amt/$exfactoryValue)*100,4); ?></td>

					<td width="200" align="right" title="Ex-Fact Value-GrandTotal Acl Value"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right" title="Ex-fact Value-GrandTotal Ex Value/AclValue*100"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}
	if(str_replace("'","",$cbo_costcontrol_source)==2)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("select a.job_no from wo_po_details_master a,wo_pre_cost_mst f where a.job_no=f.job_no  and a.company_name=$company_name and f.entry_from=158 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row)
		{
			$chk_job_nos=$row[csf('job_no')];
		}
		if($chk_job_nos!='')
		{
			$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $ref_no="";$uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();

		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$jobIdArr[$row[csf('job_id')]]=$row[csf('job_id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}
		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."   and ENTRY_FORM=18");
		oci_commit($con);
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//PO ID Ref from=1
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 2, $jobIdArr, $empty_arr);//Job ID Ref from=2
		disconnect($con);

		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")"; else $po_cond_for_in="";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;
		if($quotationId){
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;
			$sqlQua="select a.offer_qnty,a.costing_per,b.confirm_price,b.confirm_price_dzn,b.price_with_commn_pcs from wo_price_quotation a, wo_price_quotation_costing_mst b where a.id=b.quotation_id and a.id =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQua=sql_select($sqlQua);
			foreach($dataQua as $rowQua){
				$quaOfferQnty=$rowQua[csf('offer_qnty')];
				$quaConfirmPrice=$rowQua[csf('confirm_price')];
				$quaConfirmPriceDzn=$rowQua[csf('confirm_price_dzn')];
				$quaPriceWithCommnPcs=$rowQua[csf('price_with_commn_pcs')];
				$quaCostingPer=$rowQua[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
				if($quaCostingPer==2) $quaCostingPerQty=1;
				if($quaCostingPer==3) $quaCostingPerQty=24;
				if($quaCostingPer==4) $quaCostingPerQty=36;
				if($quaCostingPer==5) $quaCostingPerQty=48;
			}
		}

		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		if($costPerQty>1){
			$costPerUom=($costPerQty/12)." Dzn";
		}else{
			$costPerUom=($costPerQty/1)." Pcs";
		}
		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$YarnData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id,copm_one_id,percent_one,type_id   from wo_pre_cost_fab_yarn_cost_dtls f where     f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id,copm_one_id,percent_one,type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row){
		//$yarnrate=$yarn_row[csf("rate")];
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		if($quotationId){
			$sql_yarn_pri="select f.id as yarn_id,f.cons_ratio,f.cons_qnty,f.rate,f.amount,count_id,copm_one_id,percent_one,type_id   from wo_pri_quo_fab_yarn_cost_dtls f where     f.quotation_id =".$quotationId." and f.is_deleted=0 and f.status_active=1  order by f.id";
			$data_arr_yarn_pri=sql_select($sql_yarn_pri);
			foreach($data_arr_yarn_pri as $yarn_row_pri){
				$yarnrate=$yarn_row_pri[csf("rate")];
		//$consQnty=($sql_yarn_pri[csf("cons_qnty")]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$consQnty=($yarn_row_pri[csf("cons_qnty")]/$quaCostingPerQty)*($quaOfferQnty);
		//echo "(".$sql_yarn_pri[csf("cons_qnty")]."/".$quaCostingPerQty.")*(".$quaOfferQnty.")";
				$amount=$consQnty*$yarnrate;
				$index="'".$yarn_row_pri[csf("count_id")]."_".$yarn_row_pri[csf("copm_one_id")]."_".$yarn_row_pri[csf("percent_one")]."_".$yarn_row_pri[csf("type_id")]."'";

				$YarnData[$index]['mkt']['qty']+=$consQnty;
				$YarnData[$index]['mkt']['amount']+=$amount;
			}
		}
	    //print_r($YarnData);
	    $yarn_recv =sql_select("select b.job_no,b.cons_amount,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a,inv_transaction b,product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");
		foreach ($yarn_recv as $row) {
		//$index="'".$composition[$row[csf("yarn_comp_type1st")]]." ".$row[csf("yarn_comp_percent1st")].'%'."'";
			$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
			$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
		}
		//print_r($conv_yarn_arr);


		  $issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,d.booking_no,c.receive_basis from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.issue_id=d.id and a.po_breakdown_id=g.ref_val   and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.trans_type in(4,5,6) and a.entry_form in(9,11)  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1");
		 
		 
		$YarnIssueReturn = $booking_req_return = array();
		foreach ($issue_return as $row) {
		$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if($row[csf("receive_basis")] == 1){
				//$YarnIssueReturn[$index]["qty"] += $row[csf("quantity")];
			}else{
				//$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
				//$booking_req_return[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			}
			$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
			$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
		}
		$YarnIssue=array();
	    //print_r($YarnIssueReturn);
		$issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id  and a.po_breakdown_id=g.ref_val   and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.trans_type=2 and a.entry_form=3  and d.entry_form=3   and d.issue_purpose not in(2,8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");
		//echo "select a.po_breakdown_id,a.prod_id,a.quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3 and a.po_breakdown_id in(".implode(",",$poIdArr).") and d.issue_purpose!=2 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id";die;


		$issue_arr = $booking_req = array();
		foreach ($issue_details as $row) {
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			if($row[csf("receive_basis")] == 1){
				//$issue_arr[$row[csf("booking_no")]]["issue_qnty"] += $row[csf("quantity")];
			}else{
			//	$issue_arr[$row[csf("requisition_no")]]['req_qnty'] += $row[csf("quantity")];
				//$booking_req[$requisition_arr[$row[csf("requisition_no")]]] = $row[csf("requisition_no")];
			}
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}


		foreach($YarnIssue as $ind=>$value){
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
			//echo $value['amount'].'-'.$YarnIssueReturn[$ind]['amount'].'/'.$g_exchange_rate.'<br>';
		}

		$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		//echo $conversion1->getQuery(); die;
		//$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndProcess();
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion1= new conversion($condition1);
		//$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndProcess();
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid();

		 $sql_conv_yarn="select b.id as po_id,c.job_no,c.id as conv_id, d.composition  from   wo_po_break_down b,wo_pre_cost_fab_conv_cost_dtls c,wo_pre_cost_fabric_cost_dtls d  where  b.job_no_mst=c.job_no and c.job_no=d.job_no  and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(30) and b.is_deleted=0 and b.id in(".implode(",",$poIdArr).") and c.amount>0 ";
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$index="".$row[csf("composition")]."";
			$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
			$conv_yarn_arr[$index]['acl']['qty']=$recv_yarn_arr[$row[csf("job_no")]]['qty'];
			$conv_yarn_arr[$index]['acl']['amount']=$recv_yarn_arr[$row[csf("job_no")]]['amt'];
		}
		//print_r($conv_yarn_arr);

		/* $sql="select x.*,(x.quantity*x.cons_rate) cons_amount from ( select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id, a.quantity,a.issue_purpose,a.returnable_qnty,a.is_sales,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type, c.cons_rate,d.issue_basis,d.booking_no,b.lot from order_wise_pro_details a, product_details_master b,inv_transaction c,inv_issue_master d,wo_booking_mst e where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and d.booking_no=e.booking_no and a.trans_type in(2) and a.entry_form in(3) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and e.booking_type in(1,4) )x";
		$data_Yac=sql_select($sql);
		foreach($data_Yac as $row){
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$YarnIssue[$index]['qty']+=$row[csf("quantity")];
			$YarnIssue[$index]['amount']+=$row[csf("cons_amount")];
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}*/
		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		//echo $lot_tmp;
		$grey_fab_array=array();  //Knitting Cost actual
		// $sql_knit_prod="select c.yarn_lot,
		//  sum(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		//   from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c where a.id=c.mst_id and c.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.") and b.po_breakdown_id in(".implode(",",$poIdArr).") group by c.yarn_lot";
		$sql_knit_prod="select c.yarn_lot,
		(CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		 from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g where a.id=c.mst_id and c.id=b.dtls_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.")  ";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			//$grey_fab_array[$row[csf("yarn_lot")]]['knit_grey_qty']+=$row[csf("grey_qnty")];
			//$grey_fab_array[$row[csf("yarn_lot")]]['knit_grey_amt']+=$row[csf("grey_qnty")]*$avg_rate;
			//echo $row[csf("grey_qnty")].'='.$avg_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
		$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
	    // $sql_grey_trans="select c.from_order_id,a.from_prod_id,
		//  sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		//  sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		//   sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		//   sum(CASE WHEN b.entry_form in(83,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		//   from  inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b where c.id=a.mst_id and a.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,13) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by  a.from_prod_id,c.from_order_id";//
		$sql_grey_trans="select c.from_order_id, a.from_prod_id, 
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		from inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,82,183,110,13) and b.trans_type in(5,6)";
		$result_grey_trans=sql_select( $sql_grey_trans );
		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_idarr[$row[csf('from_prod_id')]]=$row[csf('from_prod_id')];
		}
		 
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 3, $from_prod_idarr, $empty_arr);//PO ID Ref from=3

		$sql_prod=sql_select("select b.id, b.product_name_details,b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18");
		foreach($sql_prod as $row){
			$avg_rate_array[$row[csf("id")]]=$row[csf("avg_rate_per_unit")];
			$desc_array[$row[csf("id")]]=$row[csf("product_name_details")];
		}
		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			//$grey_fab_trans_array['gtt'][$row[csf('yarn_lot')]]+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			$from_order_id.=$row[csf('from_order_id')].',';
			$grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			//$grey_fab_trans_amt_acl+=($row[csf('grey_in')]-$row[csf('grey_out')])*$avg_rate;
			$grey_fab_trans_amt_acl+=($row[csf('grey_in_amt')]-$row[csf('grey_out_amt')]);
		}
		//echo $grey_fab_trans_qty_acl.'='.$grey_fab_trans_amt_acl;
		$from_order_id=rtrim($from_order_id,',');
		$from_order_ids=array_unique(explode(",",$from_order_id));

		// $subconOutBillData="select b.order_id,
		// sum(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		// sum(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		// from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id in(".implode(",",$poIdArr).") group by b.order_id";
		$subconOutBillData="select b.order_id,b.currency_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4)  ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
			//$subconCostArray[$subRow[csf('order_id')]]['dye_finish_bill']+=$subRow[csf('dye_finish_bill')]/$g_exchange_rate;
		}
		//echo $knit_grey_amt.'='.$tot_knit_charge.'='.$knit_grey_qty;
		//$grey_fab_cost=$knit_grey_amt+$tot_knit_charge;
		//$tot_grey_fab_cost_acl=($grey_fab_cost/$knit_grey_qty)*$grey_fab_trans_qty_acl;


		// Transfer Fin Actual
				$fin_fab_trans_array=array();
				//  $sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, sum(b.quantity) as qnty,
				// 	sum(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
				// 	sum(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
				//  c.from_order_id
				//   from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(15) and a.item_category=2 and c.transfer_criteria!=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by b.trans_type, b.po_breakdown_id,c.from_order_id,b.prod_id";
				$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
				(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
				(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
			 c.from_order_id
			  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and c.transfer_criteria!=2 and b.is_deleted=0 and b.entry_form in(15,14,306) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6)";
				$result_fin_trans=sql_select( $sql_fin_trans );
				$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
				foreach ($result_fin_trans as $row)
				{
					$fin_from_order_id.=$row[csf('from_order_id')].',';
					$avg_rate=$avg_rate_array[$row[csf('prod_id')]];

						$fin_in_qnty+=$row[csf('in_qty')];
						$fin_out_qnty+=$row[csf('out_qty')];

						$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
						$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;

					//echo $fin_in_qnty.'='.$fin_out_qnty.',';
					//$fin_fab_trans_qty+=$in_qnty-$out_qnty;
					//$fin_fab_trans_amt+=($in_qnty-$out_qnty)*$avg_rate;
					//$product_id_arr[$row[csf('po_breakdown_id')]].=$row[csf('prod_id')].",";
				}

				$po_ids=implode(",",$poIdArr);
				unset($result_fin_trans);
				$fin_from_order_id=rtrim($fin_from_order_id,',');
				$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

				$fin_trans_in_qty=$fin_in_qnty;
				$fin_trans_out_qty=$fin_out_qnty;

				$fin_trans_in_amt=$fin_in_amt;
				$fin_trans_out_amt=$fin_out_amt;

			//	echo $fin_trans_in_amt.'AA'.$fin_trans_out_amt;

				$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
				$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

				$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
				$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;
				if($from_order_id!="") //Grey Transfer
				{
					 $knit_cost=$knit_qty=0;
					 foreach($from_order_ids as $po_id)
					 {
						$knit_cost+=array_sum($conversion_costing_arr_process[$po_id][1]);
						 $knit_qty+=array_sum($conversion_costing_arr_process_qty[$po_id][1]);
					 }
				}
				if($fin_from_order_id!="") //Finish Transfer
				{
					$condition2= new condition();
					$condition2->po_id("in($fin_from_order_id)");
					$condition2->init();
					$conversion2= new conversion($condition2);
					//echo $conversion2->getQuery(); die;
					$fin_conversion_costing_arr_process=$conversion2->getAmountArray_by_orderAndProcess();
					//print_r($fin_conversion_costing_arr_process);
					$conversion2= new conversion($condition2);
					$fin_conversion_costing_arr_process_qty=$conversion2->getQtyArray_by_orderAndProcess();
					 foreach($fin_from_order_ids as $po_id)
					 {
						 $tot_dye_finish_cost_pre=0;$tot_dye_finish_cost_pre_qty=0;
						foreach($conversion_cost_head_array as $process_id=>$val)
						{
							if($process_id!=30 && $process_id!=1 && $process_id!=35) //Yarn Dyeing,Knitting,Aop
							{
								$tot_dye_finish_cost_pre+=array_sum($fin_conversion_costing_arr_process[$po_id][$process_id]);

								$tot_dye_finish_cost_pre_qty+=array_sum($fin_conversion_costing_arr_process_qty[$po_id][$process_id]);
							}
						}
					 }
				}
				$knit_charge=$knit_cost/$knit_qty;

		if($quotationId){
			 $pq_conv_yarn_data="select a.composition,b.quotation_id,b.cost_head,b.charge_unit,
				(CASE WHEN b.cons_type=30 THEN b.amount END) AS yarn_dyeing_cost,
				(CASE WHEN b.cons_type=30 THEN  b.req_qnty END) AS req_qnty
				from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.id=b.cost_head and b.quotation_id =".$quotationId." and b.cons_type=30 and b.status_active=1  and b.is_deleted=0";
				$result_price_conv_yarn=sql_select($pq_conv_yarn_data);
				foreach($result_price_conv_yarn as $p_row)
				{
					$pri_yarnrate=$p_row[csf("charge_unit")];
					$index="".$p_row[csf("composition")]."";
					$mktcons=($p_row[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$amount=$mktcons*$pri_yarnrate;
					$conv_yarn_arr[$index]['mkt']['amount']+=$amount;
					$conv_yarn_arr[$index]['mkt']['qty']+=$mktcons;
				}
			}

		//print_r($YarnData);
		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();
		$fabPurArr=array();
		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		if($quotationId){
			$totMktcons=0; $totMktAmt=0;
			$sql = "select id, item_number_id, body_part_id, fab_nature_id, color_type_id, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pri_quo_fabric_cost_dtls where quotation_id='".$quotationId."' and fabric_source=2";
			$data_fabPur=sql_select($sql);
			foreach($data_fabPur as $fabPur_row){
			//$mktcons=($fabPur_row[csf('avg_cons')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($fabPur_row[csf('avg_cons')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$fabPur_row[csf('rate')];
				if($fabPur_row[csf('fab_nature_id')]==2){
					$fabPurArr['mkt']['knit']['qty']+=$mktcons;
					$fabPurArr['mkt']['knit']['amount']+=$mktamt;
				}
				if($fabPur_row[csf('fab_nature_id')]==3){
					$fabPurArr['mkt']['woven']['qty']+=$mktcons;
					$fabPurArr['mkt']['woven']['amount']+=$mktamt;
				}
			}
		}

		// $sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b where a.booking_no=b.booking_no and a.booking_type=1 and a.fabric_source=2 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category, a.booking_type, a.exchange_rate,a.fabric_source, b.trim_group,b.wo_qnty,b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount, b.uom as cons_uom from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no  and a.booking_type=1  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('item_category')]==2){
				$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
				if($fabPur_row[csf('grey_fab_qnty')]>0){
					$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
				}
			}
			if($fabPur_row[csf('item_category')]==3){
				$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('grey_fab_qnty')];
				if($fabPur_row[csf('grey_fab_qnty')]>0){
					$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
				}
			}
		}

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		//$knitData=array();
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		//$knitDesArr=array();
		// $sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process,c.id as po_id from wo_po_break_down c, wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  c.job_no_mst=a.job_no  and c.job_no_mst=b.job_no  and a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1";
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				//echo $knitQtyArr[$row_knit[csf('po_id')]][$row_knit[csf('cons_process')]].'=';
				$knitData[$index]['pre']['qty']+=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']+=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}

		}
		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type=1";
			$data_knit=sql_select($sql);
			foreach($data_knit as $row_knit){
				$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
				if($row_knit[csf('cons_type')]==1){
				//$mktcons=($row_knit[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
					$mktcons=($row_knit[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$row_knit[csf('charge_unit')];
					$knitData[$index]['mkt']['qty']+=$mktcons;
					$knitData[$index]['mkt']['amount']+=$mktamt;
				}
			}
		}

		// $sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select b.receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}

		// $sql = "select  b.delivery_qty,b.rate,b.amount,c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql_in = "select b.delivery_qty as receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=2 and a.party_source=1  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('delivery_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$finishData=array();
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_id=b.job_id and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process not in(1,2,30,35)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
		}
		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type not in(1,2,30,35)";
			$data_finish=sql_select($sql);
			foreach($data_finish as $row_finish){
				$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
				//$mktcons=($row_finish[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row_finish[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row_finish[csf('charge_unit')];
				$finishData[$index]['mkt']['qty']+=$mktcons;
				$finishData[$index]['mkt']['amount']+=$mktamt;
			}
		}
		$sql = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=4   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index=$row_finish[csf('product_name_details')];
			$finishData[$index]['acl']['qty']+=$row_finish[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_finish[csf('amount')]/$g_exchange_rate;
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$aopData=array();
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, a.rate, a.amount,a.avg_finish_cons,a.status_active,b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_id=b.job_id and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$finishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$finishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}

		}

		if($quotationId){
			$sql = "select a.id, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight,a.avg_cons, a.fabric_source, b.cons_type,b.req_qnty,b.charge_unit from wo_pri_quo_fabric_cost_dtls a, wo_pri_quo_fab_conv_cost_dtls b where a.quotation_id=b.quotation_id and a.id=b.cost_head and  a.quotation_id='".$quotationId."' and b.cons_type=35";
			$data_aop=sql_select($sql);
			foreach($data_aop as $row_aop){
				$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
				if($row_aop[csf('cons_type')]==35){
				//$mktcons=($row_aop[csf('req_qnty')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
					$mktcons=($row_aop[csf('req_qnty')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$row_aop[csf('charge_unit')];
					$finishData[$index]['mkt']['qty']+=$mktcons;
					$finishData[$index]['mkt']['amount']+=$mktamt;
				}
			}
		}

		/*$sql = "select  b.batch_issue_qty, b.rate, b.amount, b.currency_id, b.exchange_rate,b.process_id from inv_receive_mas_batchroll a, pro_grey_batch_dtls b where a.id=b.mst_id and b.process_id=35 and b.job_no ='".$jobNumber."' and  b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			if($row_aop[csf('process_id')]==35){
				$exchange_rate=$row_aop[csf('batch_issue_qty')];
				if(!$exchange_rate){
					$exchange_rate=1;
				}
				$aopData['acl']['qty']+=$row_aop[csf('batch_issue_qty')];
				$aopData['acl']['amount']+=$row_aop[csf('amount')]/$exchange_rate;
			}
		}*/

		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=4 and b.sub_process_id in(31,35)   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			//$index=$row_aop[csf('product_name_details')];
			//$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('febric_description_id')]."'";
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
		}

		// Fabric AOP  End============================



		// Trim Cost ============================

		//$trim_group=return_library_array( "select item_name,id from  lib_item_group", "id", "item_name" );
		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group  ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}
		//print_r($trim_groupArr);
		$trimData=array();
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();

		$trim= new trims($condition);
		//$trimAmtArr=$trim->getAmountArray_by_jobAndItemid();
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$jobNumber][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$jobNumber][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		if($quotationId){
			$sql = "select id,  trim_group, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp,status_active from wo_pri_quo_trim_cost_dtls  where quotation_id='".$quotationId."' and status_active=1";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$trimData[$row[csf('trim_group')]]['mkt']['qty']+=$mktcons;
				$trimData[$row[csf('trim_group')]]['mkt']['amount']+=$mktamt;
				$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
			}
		}
		$trimsRecArr=array();
		//echo "select b.po_breakdown_id, a.item_group_id,b.quantity as quantity,a.rate,a.cons_rate  from  inv_receive_master c,product_details_master d,inv_trims_entry_dtls a , order_wise_pro_details b where a.mst_id=c.id and a.trans_id=b.trans_id and a.prod_id=d.id and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ";
		/*$receive_qty_data=sql_select("select b.po_breakdown_id, a.item_group_id,b.quantity as quantity, a.rate, a.cons_rate
		from inv_receive_master c, product_details_master d, inv_trims_entry_dtls a, order_wise_pro_details b
		where a.mst_id=c.id and a.trans_id=b.trans_id and a.prod_id=d.id and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.po_breakdown_id in(".implode(",",$poIdArr).") ");*/
		$receive_qty_data=sql_select("select b.po_breakdown_id, d.item_group_id, b.id as prop_id, b.quantity as quantity, a.order_rate as rate, a.cons_rate, a.payment_over_recv
		from inv_receive_master c, product_details_master d, inv_transaction a, order_wise_pro_details b,gbl_temp_engine g
		where a.mst_id=c.id and a.id=b.trans_id and a.prod_id=d.id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.transaction_type=1 and b.trans_type=1 and b.entry_form=24 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  ");
		foreach($receive_qty_data as $row)
		{
			$trimsRecArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group_id')]]['rate']=$row[csf('rate')];
			if($row[csf('payment_over_recv')] !=1)
			{
				$trimsRecArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];
			}
		}
		//print_r($trimsRecArr);
		$trimsRecReArr=array();
		$receive_rtn_qty_data=sql_select("select d.po_breakdown_id, c.item_group_id,d.quantity as quantity,d.order_rate as rate   from  inv_issue_master a,inv_transaction b, product_details_master c, order_wise_pro_details d,gbl_temp_engine g  where a.id=b.mst_id and b.prod_id=c.id and b.id=d.trans_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and b.transaction_type=3 and a.entry_form=49 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 ");
		foreach($receive_rtn_qty_data as $row){
			$trimsRecReArr[$row[csf('item_group_id')]]['qty']+=$row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'];
			$trimsRecReArr[$row[csf('item_group_id')]]['amount']+=($row[csf('quantity')]*$trim_groupArr[$row[csf('item_group_id')]]['con_factor'])*$row[csf('rate')];//$trimsRecArr[$row[csf('item_group_id')]]['rate'];
		}
		$sql_trim_trans="select a.item_group,b.order_rate as rate,b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		(CASE WHEN b.trans_type=5 THEN a.rate*b.quantity END) AS in_amt,
		(CASE WHEN b.trans_type=6 THEN a.rate*b.quantity END) AS out_amt,
		c.from_order_id
		from inv_item_transfer_dtls a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g  where a.id=b.dtls_id and c.id=a.mst_id  and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(78) and b.trans_type in(5,6)  ";
		$result_trim_trans=sql_select( $sql_trim_trans );
		$trim_in_qnty=$trim_out_qnty=$trim_in_amt=$trim_out_amt=0;
		foreach ($result_trim_trans as $row)
		{
			$trim_from_order_id.=$row[csf('from_order_id')].',';
			$rate=$row[csf('rate')];
			$con_factor=$trim_groupArr[$row[csf('item_group')]]['con_factor'];
			$trimsRecArr[$row[csf('item_group')]]['in_qty']+=$row[csf('in_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['out_qty']+=$row[csf('out_qty')]*$con_factor;
			$trimsRecArr[$row[csf('item_group')]]['in_amt']+=$row[csf('in_qty')]*$con_factor*$rate;
			$trimsRecArr[$row[csf('item_group')]]['out_amt']+=$row[csf('out_qty')]*$con_factor*$rate;
		}

		foreach($trimsRecArr as $ind=>$value){
			$trimData[$ind]['acl']['qty']+=($trimsRecArr[$ind]['qty']+$trimsRecArr[$ind]['in_qty'])-($trimsRecReArr[$ind]['qty']+$trimsRecArr[$ind]['out_qty']);
			$trimData[$ind]['acl']['amount']+=($trimsRecArr[$ind]['amount']+$trimsRecArr[$ind]['in_amt'])-($trimsRecReArr[$ind]['amount']+$trimsRecArr[$ind]['out_amt']);
			$trimData[$ind]['cons_uom']=$trimsRecArr[$ind]['cons_uom'];
		}

		//print_r($trimData);

		// Trim Cost End============================
		// Embl Cost ============================
		$embData=array();
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and emb_name !=3";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['pre']['qty']+=$embQtyArr[$jobNumber][$row[csf('id')]];
			$embData['pre']['amount']+=$embAmtArr[$jobNumber][$row[csf('id')]];
		}
		//print_r($embData);
		if($quotationId){
			$sql = "select id, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pri_quo_embe_cost_dtls where quotation_id='".$quotationId."' and emb_name !=3";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$embData['mkt']['qty']+=$mktcons;
				$embData['mkt']['amount']+=$mktamt;
			}
		}
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and b.emblishment_name !=3   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];

		}
		// Embl Cost End ============================
		// Wash Cost ============================
		$washData=array();
		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and emb_name =3";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['pre']['qty']+=$washQtyArr[$jobNumber][$row[csf('id')]];
			$washData['pre']['amount']+=$washAmtArr[$jobNumber][$row[csf('id')]];
		}
		if($quotationId){
			$sql = "select id, emb_name, emb_type, cons_dzn_gmts, rate, amount,status_active from wo_pri_quo_embe_cost_dtls where quotation_id='".$quotationId."' and emb_name =3";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktcons=($row[csf('cons_dzn_gmts')]/$costPerQty)*($jobPcutQty/$totalSetQnty);
				$mktcons=($row[csf('cons_dzn_gmts')]/$quaCostingPerQty)*($quaOfferQnty);
				$mktamt=$mktcons*$row[csf('rate')];
				$washData['mkt']['qty']+=$mktcons;
				$washData['mkt']['amount']+=$mktamt;
			}
		}
		$sql = "select a.item_category,a.exchange_rate,b.grey_fab_qnty,b.wo_qnty,b.fin_fab_qnty,b.po_break_down_id,b.rate,b.amount from wo_booking_mst a,wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.booking_type=6 and b.emblishment_name =3  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}
		// Wash Cost End ============================
		// Commision Cost  ============================
		$commiData=array();
		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id,job_no,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		if($quotationId){
			$sql = "select id,particulars_id,commission_base_id,commision_rate,commission_amount, status_active from  wo_pri_quo_commiss_cost_dtls  where quotation_id='".$quotationId."'";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktamt=($row[csf('commission_amount')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktamt=($row[csf('commission_amount')]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['qty']=$quaOfferQnty;
				$commiData['mkt']['amount']+=$mktamt;
				$commiData['mkt']['rate']+=$mktamt/$quaOfferQnty;
			}
		}
		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}

				$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;

			//echo $commaAmtArr[$jobNumber][$row[csf('id')]].'/'.$exfactory_qty;
		}
		if($quotationId){
			$sql = "select id, item_id, rate, amount, status_active from  wo_pri_quo_comarcial_cost_dtls where quotation_id=".$quotationId."";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
		//$mktamt=($row[csf('amount')]/$costPerQty)*($jobQty/$totalSetQnty);
				$mktamt=($row[csf('amount')]/$quaCostingPerQty)*($quaOfferQnty);
				$commaData['mkt']['qty']=$quaOfferQnty;
				$commaData['mkt']['amount']+=$mktamt;
				$commaData['mkt']['rate']+=$mktamt/$quaOfferQnty;
			}
		}
		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$otherData=array();
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id ,lab_test ,inspection  ,cm_cost ,freight ,currier_pre_cost ,certificate_pre_cost ,common_oh ,depr_amor_pre_cost  from  wo_pre_cost_dtls where job_no='".$jobNumber."'";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}
		if($quotationId){
			$sql = "select id ,lab_test ,inspection  ,cm_cost ,freight ,currier_pre_cost ,certificate_pre_cost ,common_oh ,depr_amor_pre_cost  from  wo_price_quotation_costing_mst where quotation_id='".$quotationId."'";
			$data_array=sql_select($sql);
			foreach($data_array as $row){
				$freightAmt=($row[csf('freight')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['qty']=$quaOfferQnty;
				$otherData['mkt']['freight']['amount']=$freightAmt;
				$otherData['mkt']['freight']['rate']=$freightAmt/$quaOfferQnty;

				$labTestAmt=($row[csf('lab_test')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['qty']=$quaOfferQnty;
				$otherData['mkt']['lab_test']['amount']=$labTestAmt;
				$otherData['mkt']['lab_test']['rate']=$labTestAmt/$quaOfferQnty;

				$inspectionAmt=($row[csf('inspection')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['inspection']['qty']=$quaOfferQnty;
				$otherData['mkt']['inspection']['amount']=$inspectionAmt;
				$otherData['mkt']['inspection']['rate']=$inspectionAmt/$quaOfferQnty;

				$currierPreCostAmt=($row[csf('currier_pre_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['currier_pre_cost']['qty']=$quaOfferQnty;

				$otherData['mkt']['currier_pre_cost']['amount']=$currierPreCostAmt;
				$otherData['mkt']['currier_pre_cost']['rate']=$currierPreCostAmt/$quaOfferQnty;

				$cmCostAmt=($row[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['qty']=$quaOfferQnty;
				$otherData['mkt']['cm_cost']['amount']=$cmCostAmt;
				$otherData['mkt']['cm_cost']['rate']=$cmCostAmt/$quaOfferQnty;
			}
		}
		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0  order by id desc");
			foreach($sql_std_para as $row )
			{
				$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
				$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
				$diff=datediff('d',$applying_period_date,$applying_period_to_date);
				for($j=0;$j<$diff;$j++)
				{
					//$newDate=add_date(str_replace("'","",$applying_period_date),$j);
					$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);

					$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
					//$asking_profit_arr[$newDate]['max_profit']=$ask_row[csf('max_profit')];
				}
			}

	 $sql_cm_cost="select  jobNo, available_min,production_date from production_logicsoft where  jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			//$production_date=date("d-m-Y", strtotime($row[csf('production_date')]));

			$production_date=change_date_format($row[csf('production_date')],'','',1);

			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		//$sql="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where po_id in(".implode(",",$poIdArr).")";
		$sql_c="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  ";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['freight']['rate']=$row[csf('freight')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['lab_test']['rate']=$row[csf('lab_test')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['inspection']['rate']=$row[csf('inspection')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['currier_pre_cost']['rate']=$row[csf('currier_pre_cost')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
		//$otherData['acl']['cm_cost']['rate']=$row[csf('cm_cost')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
		//$commaData['acl']['cm_cost']['rate']=$row[csf('cm_cost')];
			}
		}
		// Other Cost End ============================
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."   and ENTRY_FORM=18");
		oci_commit($con);
		 
		disconnect($con);
		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td> <td><p><? echo $team_leaders;?></p></td>
					<td>Dealing Marchant</td><td  colspan="2"><p><? echo $dealing_marchants;?> </p></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"> <? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right"  colspan="2"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>
			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px; margin-top:10px" rules="all">
				<thead>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="60">UOM</td>
						<td width="100">Marketing Qty</td>
						<td width="100">Marketing Price</td>
						<td width="100">Marketing Value</td>
						<td width="100">Pre-Cost Qty</td>
						<td width="100">Pre-Cost Price</td>
						<td width="100">Pre-Cost Value</td>
						<td width="100">Actual Qty</td>
						<td width="100">Actual Price</td>
						<td width="100">Actual Value</td>
					</tr>
				</thead>
				<tr style="font-weight:bold" class="yarn">
					<td colspan="12">Yarn including yarn dyed</td>
				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0;

				$yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0;

				$totalMktValue=0; $totalPreValue=0; $totalAclValue=0;

				$totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$y++;
				}

				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row ){
					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					$totalAclQty+=fn_number_format($yarn_acl_qty,4,".","");
					?>

				 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($yarn_acl_qty,4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
				<?
				$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Yarn Total</td>
					<td width="60"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalMktQty,4);
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalPreQty,4);
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalPreValue>$totalMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','1')"><? echo fn_number_format($totalAclQty,4); ?></A>
					</td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalAclValue>$totalPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalAclValue,4,".","");
						?>
					</td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="300" >Fabric Purchase Cost (Knit)</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['amount']/$fabPurArr['mkt']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="60">Yds</td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['mkt']['knit']['amount'],4,".","");
						echo  fn_number_format($fabPurMkt,4);
						$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
						$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['pre']['knit']['amount'],4,".","");
						$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['acl']['knit']['amount'],4,".","");

						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="12">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0;
				$totalKnitPreValue=0;
				$totalKnitAclValue=0;

				$totalKniMktQty=0;
				$totalKnitPreQty=0;
				$totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=fn_number_format($row['acl']['qty'],4,".","");
				//$knitDesArr[$index]=$body_part[$row_knit[csf('body_part_id')]].", ".$color_type[$row_knit[csf('color_type_id')]].", ".$row_knit[csf('fabric_description')].", ".$row_knit[csf('gsm_weight')];
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="60"></td>
					<td width="100" align="right">
						<? echo fn_number_format($totalKniMktQty,4);?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<? echo fn_number_format($totalKniMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalKniMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalKnitPreQty,4);?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalKnitAclQty,4);?></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalKnitAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold" class="dyfi">
					<td colspan="12">Dye , Fin & Aop Cost</td>
				</tr>
				<?
				$totalFinMktValue=0;
				$totalFinPreValue=0;
				$totalFinAclValue=0;

				$totalFinMktQty=0;
				$totalFinPreQty=0;
				$totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="dyfi" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish & AOP Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">
						<? echo fn_number_format($totalFinMktQty,4);?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" >
						<?
						echo fn_number_format($totalFinMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalFinMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"  bgcolor=" <? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="100" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="300" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="60">Kg</td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['amount']/$aopData['mkt']['qty'],4)?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['mkt']['amount'],4); //$GrandTotalMktValue+=fn_number_format($aopData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aopData['pre']['amount'],4,".","")>fn_number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($aopData['pre']['amount'],4); //$GrandTotalPreValue+=fn_number_format($aopData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aopData['acl']['amount'],4,".","")>fn_number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aopData['acl']['amount'],4); //$GrandTotalAclValue+=fn_number_format($aopData['acl']['amount'],4,".","");?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="12">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;//$tot_grey_fab_cost=($grey_fab_cost/$knit_grey_qty)*$grey_fab_trans_qty;;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="60">Kg</td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? //echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_grey_fab_cost_acl/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($tot_grey_fab_cost_acl,4); ?></A><? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
					</tr>

				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="60">Kg</td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($tot_fin_fab_transfer_cost/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="100" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="60">Kg</td>
					<td width="100" align="right">

					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right" >

					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">

					</td>
					<td width="100" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="100"  align="right"><? echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl,4);
						$total_grey_fin_fab_transfer_actl_cost=$tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
				</tr>

				<tr>
					<td colspan="12" style="font-weight:bold">Trims Cost</td>
				</tr>
				<?
				$t=1;
				$totalTrimMktValue=0;
				$totalTrimPreValue=0;
				$totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					$item_descrition = $trim_groupArr[$index]['item_name'];
					$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="60"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="100" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="100" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="100" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
					</tr>
					<?
					$t++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Trims Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						?>
					</td>
				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($embData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" >Wash Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['amount']/$embData['mkt']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($washData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($washData['pre']['amount'],4,".","")>fn_number_format($washData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($washData['pre']['amount'],4);$totalOtherPreValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['acl']['qty'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($washData['acl']['amount'],4,".","")>fn_number_format($washData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($washData['acl']['amount'],4);$totalOtherAclValue+=fn_number_format($washData['acl']['amount'],4,".",""); ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="60"><? echo $costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commiData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right">
						<?
			//$aclCommiAmt=($commiData['pre']['rate']/($costPerQty*$totalSetQnty))*$exfactoryQty;
						$aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty;
			//echo "(".$commiData['pre']['rate']."/(".$costPerQty*$totalSetQnty."))*".$exfactoryQty;
						echo fn_number_format($aclCommiAmt/$exfactoryQty,4);

						?>
					</td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>">
						<?
						echo fn_number_format($aclCommiAmt,4);
						$totalOtherAclValue+=$aclCommiAmt;
						?>
					</td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['mkt']['amount'],4); $totalOtherMktValue+=fn_number_format($commaData['mkt']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commaData['pre']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="100" align="right"><? echo fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($commer_act_cost,4); $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['freight']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['lab_test']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><?
					$test_act_cost=$unitPrice*$exfactoryQty*(0.05/100);
					echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="100" align="right" title="Unit Price*Ex Fact Qty*(0.05/100)" bgcolor="<? if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['inspection']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="60"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['mkt']['cm_cost']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","");?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="100" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".",""))
					{
						$font_color="white";
					}
					else
					{
						$font_color="black";
					}
					?>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right"><? echo fn_number_format($otherData['acl']['cm_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="100" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><?  $totalOtherAclValue+=fn_number_format($otherData['acl']['cm_cost']['amount'],4,".",""); echo fn_number_format($otherData['acl']['cm_cost']['amount'],4);?></td>
					<!-- <a href="#report_details" style="color:<? //echo $font_color;?>" onClick="openmypage_mkt_cm_popup('<? //echo $jobNumber; ?>','mkt_cm_cost_popup','Making CM Cost Details','2','1000px')"></a> -->
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right">
						<?
						echo fn_number_format($totalOtherMktValue,4);
						$GrandTotalMktValue+=fn_number_format($totalOtherMktValue,4,".","");
						?>
					</td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalOtherPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".","");
						?>
					</td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalOtherAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".","");
						?>
					</td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="60"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"></td>
					<td width="100" align="right"></td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100"></td>
					<td width="100"></td>
					<td width="100" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="60"></td>
					<td width="100" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="100" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo fn_number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="100" align="right">
						<?
						$quaOfferValue=$quaOfferQnty *$quaPriceWithCommnPcs;
						echo fn_number_format($quaOfferValue,4)
						?>
					</td>
					<td width="100" align="right"><? echo $jobQty ?></td>
					<td width="100" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="100" align="right"><? echo $exfactoryQty ?></td>
					<td width="100" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>
					<td width="120">
                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>
						    <div style="float:left;width:120px" >
							<?
							foreach($nameArray_img AS $inf) {
								?>
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
							    <?
							}
							?>
							</div>
						<?
					}
					else echo ""; ?>
                    </td>
				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px" rules="all">
				<tr><td colspan="8"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr>
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}

	else if(str_replace("'","",$cbo_costcontrol_source)==3)
	{
		$company_name=str_replace("'","",$cbo_company_name);
		$job_no=str_replace("'","",$txt_job_no);
		$cbo_year=str_replace("'","",$cbo_year);
		$g_exchange_rate=str_replace("'","",$g_exchange_rate);
		if($company_name==0){ echo "Select Company"; die; }
		if($job_no==''){ echo "Select Job"; die; }
		if($cbo_year==0){ echo "Select Year"; die; }

		if($db_type==0) $year_cond=" and YEAR(a.insert_date)=$cbo_year";
		if($db_type==2) $year_cond=" and to_char(a.insert_date,'YYYY')=$cbo_year";

		$check_data=sql_select("select a.job_no from wo_po_details_master a,wo_pre_cost_mst f where a.id=f.job_id and a.company_name=$company_name and f.entry_from=158 and a.job_no_prefix_num like '$job_no' $year_cond group by a.job_no");

		$chk_job_nos='';
		foreach($check_data as $row) {
			$chk_job_nos=$row[csf('job_no')];
		}
		//$chk_job_nos=$job_no;
		if($chk_job_nos!='')
		{
			$sql="select a.id as job_id,a.job_no_prefix_num, a.job_no, a.company_name, a.buyer_name, a.style_ref_no, a.order_uom, a.gmts_item_id, a.total_set_qnty as ratio, a.set_smv,a.currency_id, a.quotation_id, a.team_leader, a.dealing_marchant, b.id, b.po_number, b.grouping, b.file_no, b.shipment_date, b.po_quantity, b.plan_cut, b.unit_price, b.po_total_price, b.shiping_status, c.item_number_id, c.order_quantity, c.order_rate, c.order_total, c.plan_cut_qnty, c.shiping_status  as shiping_status_c from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c where a.job_no=b.job_no_mst and  a.job_no=c.job_no_mst and b.id=c.po_break_down_id  and a.company_name='$company_name' and a.job_no_prefix_num like '$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $year_cond order by  b.id";
			$result=sql_select($sql);
		}

		$jobNumber=""; $po_ids=""; $buyerName=""; $styleRefno=""; $uom=""; $totalSetQnty=""; $currencyId=""; $quotationId=""; $shipingStatus=""; $ref_no="";$all_po_id="";
		$poNumberArr=array(); $poIdArr=array(); $poQtyArr=array(); $poPcutQtyArr=array(); $poValueArr=array(); $ShipDateArr=array(); $gmtsItemArr=array();
		$job_no_arr=array();
		foreach($result as $row){
			$jobNumber=$row[csf('job_no')];
			$buyerName=$row[csf('buyer_name')];
			$styleRefno=$row[csf('style_ref_no')];
			$uom=$row[csf('order_uom')];
			$totalSetQnty=$row[csf('ratio')];
			$currencyId=$row[csf('currency_id')];
			$quotationId=$row[csf('quotation_id')];
			$poNumberArr[$row[csf('id')]]=$row[csf('po_number')];
			$poIdArr[$row[csf('id')]]=$row[csf('id')];
			$jobIdArr[$row[csf('job_id')]]=$row[csf('job_id')];
			$poQtyArr[$row[csf('id')]]+=$row[csf('order_quantity')];
			$poPcutQtyArr[$row[csf('id')]]+=$row[csf('plan_cut_qnty')];
			$poValueArr[$row[csf('id')]]+=$row[csf('order_total')];
			$ShipDateArr[$row[csf('id')]]=date("d-m-Y",strtotime($row[csf('shipment_date')]));
			$gmtsItemArr[$row[csf('item_number_id')]]=$garments_item [$row[csf('item_number_id')]];
			$shipingStatus=$row[csf('shiping_status')];
			$po_ids.=$row[csf('id')].',';	$ref_no.=$row[csf('grouping')].',';
			$team_leaders.=$team_leader_library[$row[csf('team_leader')]].',';
			$all_po_id.=$row[csf('id')].',';
			$dealing_marchants.=$dealing_merchant_array[$row[csf('dealing_marchant')]].',';
			array_push($job_no_arr, $row[csf('job_no')]);
		}
		$team_leaders=rtrim($team_leaders,',');
		$team_leaders=implode(",",array_unique(explode(",",$team_leaders)));
		$all_po_id=rtrim($all_po_id,',');
		$all_po_id=implode(",",array_unique(explode(",",$all_po_id)));
		$dealing_marchants=rtrim($dealing_marchants,',');
		$dealing_marchants=implode(",",array_unique(explode(",",$dealing_marchants)));

		//////////////=======================booking no==============================

		$booking_sql="select a.booking_no from wo_booking_dtls a,wo_po_details_master b where a.job_no=b.job_no and b.job_no_prefix_num like '$job_no' and a.po_break_down_id in ($all_po_id) and a.status_active=1 and b.status_active=1 ";
		$booking_data=sql_select($booking_sql);
		foreach( $booking_data as $row ){		
			$booking_no[$row[csf("job_no")]]=$row[csf("booking_no")];	
		}
		unset($booking_data);

		///////=========================end  booking no================================

		if($jobNumber=="")
		{
			echo "<div style='width:1000px;font-size:larger'; align='center'><font color='#FF0000'>No Data Found</font></div>"; die;
		}

		$jobPcutQty=array_sum($poPcutQtyArr);
		$jobQty=array_sum($poQtyArr);
		$jobValue=array_sum($poValueArr);
		$unitPrice=$jobValue/$jobQty;
		$po_cond_for_in="";
		if(count($poIdArr)>0) $po_cond_for_in=" and  po_break_down_id  in(".implode(",",$poIdArr).")";
		$exfactoryQtyArr=array();
		$exfactory_data=sql_select("select b.PO_BREAK_DOWN_ID,
			(CASE WHEN b.entry_form!=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_QNTY,
			(CASE WHEN b.entry_form=85 THEN b.ex_factory_qnty ELSE 0 END) as EX_FACTORY_RETURN_QNTY
			from pro_ex_factory_mst b,gbl_temp_engine g where 1=1 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and b.status_active=1 and b.is_deleted=0 ");
		foreach($exfactory_data as $exfatory_row){
			$exfactoryQtyArr[$exfatory_row[('PO_BREAK_DOWN_ID')]]+=$exfatory_row[('EX_FACTORY_QNTY')]-$exfatory_row[('EX_FACTORY_RETURN_QNTY')];
		}
		$exfactoryQty=array_sum($exfactoryQtyArr);
		$exfactoryValue=array_sum($exfactoryQtyArr)*($unitPrice);
		$shortExcessQty=array_sum($poQtyArr)-$exfactoryQty;
		$shortExcessValue=$shortExcessQty*($unitPrice);
	    //$quotationId=1;

		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."   and ENTRY_FORM=18");
		oci_commit($con);
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 1, $poIdArr, $empty_arr);//PO ID Ref from=1
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 2, $jobIdArr, $empty_arr);//Job ID Ref from=2
		disconnect($con);


		$job="'".$jobNumber."'";
		$condition= new condition();
		if(str_replace("'","",$job) !=''){
			$condition->job_no("=$job");
		}

		$condition->init();
		$costPerArr=$condition->getCostingPerArr();
		$costPerQty=$costPerArr[$jobNumber];
		//echo $costPerQty.'m';die;
		if ($costPerQty>1) $costPerUom=($costPerQty/12)." Dzn";
		else $costPerUom=($costPerQty/1)." Pcs";

		$fabric= new fabric($condition);
		$yarn= new yarn($condition);

		$conversion= new conversion($condition);
		$trim= new trims($condition);
		$emblishment= new emblishment($condition);
		$wash= new wash($condition);
		$commercial= new commercial($condition);
		$commision= new commision($condition);
		$other= new other($condition);
	    // Yarn ============================
		$totYarn=0;
		$fabPurArr=array(); $YarnData=array(); $qYarnData=array(); $knitData=array(); $finishData=array();
		$washData=array(); $embData=array(); $trimData=array(); $commiData=array(); $otherData=array();
		$yarn_data_array=$yarn->getJobCountCompositionPercentAndTypeWiseYarnQtyAndAmountArray();
	    //print_r($yarn_data_array);
		$sql_yarn="select count_id, copm_one_id, percent_one, type_id from wo_pre_cost_fab_yarn_cost_dtls f where f.job_no ='".$jobNumber."' and f.is_deleted=0 and f.status_active=1  group by count_id, copm_one_id, percent_one, type_id";
		$data_arr_yarn=sql_select($sql_yarn);
		foreach($data_arr_yarn as $yarn_row)
		{
			$index="'".$yarn_row[csf("count_id")]."_".$yarn_row[csf("copm_one_id")]."_".$yarn_row[csf("percent_one")]."_".$yarn_row[csf("type_id")]."'";
			$YarnData[$index]['preCost']['qty']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['qty'];
			$YarnData[$index]['preCost']['amount']+=$yarn_data_array[$jobNumber][$yarn_row[csf("count_id")]][$yarn_row[csf("copm_one_id")]][$yarn_row[csf("percent_one")]][$yarn_row[csf("type_id")]]['amount'];
		}
		unset($data_arr_yarn);
		/*echo "<pre>";
		print_r($YarnData); die;*/

		$trim_groupArr=array();
		$conversion_factor=sql_select("select id,item_name,trim_uom,conversion_factor from  lib_item_group where status_active=1 and is_deleted=0 ");
		foreach($conversion_factor as $row_f){
			$trim_groupArr[$row_f[csf('id')]]['con_factor']=$row_f[csf('conversion_factor')];
			$trim_groupArr[$row_f[csf('id')]]['cons_uom']=$row_f[csf('trim_uom')];
			$trim_groupArr[$row_f[csf('id')]]['item_name']=$row_f[csf('item_name')];
		}

		if($quotationId)
		{
			$quaOfferQnty=0; $quaConfirmPrice=0; $quaConfirmPriceDzn=0; $quaPriceWithCommnPcs=0; $quaCostingPer=0; $quaCostingPerQty=0;

			$sqlQc="select a.offer_qty, 1 as costing_per, b.confirm_fob from qc_mst a, qc_confirm_mst b where a.qc_no=b.cost_sheet_id and a.qc_no =".$quotationId." and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			$dataQc=sql_select($sqlQc);
			//print_r($dataQc);
			foreach($dataQc as $qcrow)
			{
				//echo $qcrow[csf('offer_qty')].'=';
				$quaOfferQnty=$qcrow[csf('offer_qty')];
				$quaConfirmPrice=$qcrow[csf('confirm_fob')];
				$quaConfirmPriceDzn=$qcrow[csf('confirm_fob')];
				$quaPriceWithCommnPcs=$qcrow[csf('confirm_fob')];
				$quaCostingPer=$qcrow[csf('costing_per')];
				$quaCostingPerQty=0;
				if($quaCostingPer==1) $quaCostingPerQty=12;
			}
			unset($dataQc);
			//echo $quaOfferQnty; die;

			$sql_cons_rate="select id, mst_id, item_id, type, particular_type_id, consumption, ex_percent, tot_cons, unit, is_calculation, rate, rate_data, value from qc_cons_rate_dtls where status_active=1 and is_deleted=0 and mst_id =".$quotationId." order by id asc";
			//echo $sql_cons_rate; die;
			$sql_result_cons_rate=sql_select($sql_cons_rate);
			foreach ($sql_result_cons_rate as $rowConsRate)
			{
				if($rowConsRate[csf("type")]==1)
				{
					if($rowConsRate[csf("rate_data")]!="")
					{
						$edata=explode("~~",$rowConsRate[csf("rate_data")]);

						$yarnrate=$edata[3]+$edata[7]+$edata[11];
						$consQnty=($rowConsRate[csf("tot_cons")]/12)*($quaOfferQnty);
						$amount=$consQnty*$yarnrate;
						$index="";
						$index=$edata[0].','.$edata[4].','.$edata[8];
						//echo $edata[3].'='.$edata[7].'='.$edata[11].'='.$rowConsRate[csf("tot_cons")].'='.$quaOfferQnty.'<br>';
						if($rowConsRate[csf("rate_data")]!="")
						{
							$qYarnData[$index]['mkt']['qty']+=$consQnty;
							$qYarnData[$index]['mkt']['amount']+=$amount;
						}

						/*$index=""; $mktcons=$mktamt=0;
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;*/

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[14];
						$knitData[$index]['mkt']['qty']+=$mktcons;
						$knitData[$index]['mkt']['amount']+=$mktamt;

						$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$rate=0;
						$rate=$edata[15]+$edata[16]+$edata[17];
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rate;
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;

						/*$index=""; $mktcons=$mktamt=0;
						$index="'".$rowConsRate[csf('particular_type_id')]."'";
						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$edata[16];
						$finishData[$index]['mkt']['qty']+=$mktcons;
						$finishData[$index]['mkt']['amount']+=$mktamt;*/
					}
					else
					{
						$mktcons=$mktamt=0;

						$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
						$mktamt=$mktcons*$rowConsRate[csf('rate')];
						//echo $mktcons.'-'.$mktamt.'-'.$rowConsRate[csf('tot_cons')].'-'.$quaCostingPerQty.'-'.$quaOfferQnty.'<br>';
						$fabPurArr['mkt']['knit']['qty']+=$mktcons;
						$fabPurArr['mkt']['knit']['amount']+=$mktamt;
					}
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$washData['mkt']['qty']+=$mktcons;
					$washData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==2 && $rowConsRate[csf("particular_type_id")]!=3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$embData['mkt']['qty']+=$mktcons;
					$embData['mkt']['amount']+=$mktamt;
				}
				if($rowConsRate[csf("type")]==3)
				{
					$mktcons=$mktamt=0;
					$mktcons=($rowConsRate[csf('tot_cons')]/$quaCostingPerQty)*($quaOfferQnty);
					$mktamt=$mktcons*$rowConsRate[csf('rate')];
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['qty']+=$mktcons;
					$trimData[$rowConsRate[csf('particular_type_id')]]['mkt']['amount']+=$mktamt;
					$trimData[$rowConsRate[csf('particular_type_id')]]['cons_uom']=$rowConsRate[csf('cons_uom')];
				}
			}
			/*echo "<pre>";
			print_r($trimData);
			die;*/

			$sql_item_summ="select mst_id, item_id, fabric_cost, sp_operation_cost, accessories_cost, smv, efficiency, cm_cost, frieght_cost, lab_test_cost, miscellaneous_cost, other_cost, commission_cost, fob_pcs from qc_item_cost_summary where mst_id =".$quotationId." and status_active=1 and is_deleted=0";
			$sql_result_item_summ=sql_select($sql_item_summ);
			foreach($sql_result_item_summ as $rowItemSumm)
			{
				$consQnty=$amount=$mktamt=0;
				$mktamt=($rowItemSumm[csf("commission_cost")]/$quaCostingPerQty)*($quaOfferQnty);
				$commiData['mkt']['amount']+=$mktamt;
				$freightAmt=($rowItemSumm[csf('frieght_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['freight']['amount']+=$freightAmt;
				$labTestAmt=($rowItemSumm[csf('lab_test_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['lab_test']['amount']+=$labTestAmt;
				$cmCostAmt=($rowItemSumm[csf('cm_cost')]/$quaCostingPerQty)*($quaOfferQnty);
				$otherData['mkt']['cm_cost']['amount']+=$cmCostAmt;
			}
		}



	 	//print_r($qYarnData);
		//and a.receive_purpose in(7,12,15,38,46,50,51)
		$yarn_recv="select a.id as receive_id, a.booking_no,a.currency_id,a.receive_purpose,b.job_no,b.cons_amount,b.dye_charge,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a, inv_transaction b, product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.=1 and a.is_deleted=0 and b.status_active=1   and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0"; 
		
	 	$yarn_recv_res =sql_select($yarn_recv);

		$yarn_typeArr=array(7,12,15,38,46,50,51);
		foreach ($yarn_recv_res as $row)
		{
			$receive_purpose_id=$row[csf("receive_purpose")];
			$currency_id=$row[csf("currency_id")];
			$dye_charge=$row[csf("dye_charge")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			if($receive_purpose_id ==2)
			{
				$YarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
				$YarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
				$YarnRecv_arr[$index]['currency_id']=$currency_id;
				$dyedYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
			}
			else
			{
				if(in_array($receive_purpose_id,$yarn_typeArr))
				{
					$recv_yarn_arr[$row[csf("job_no")]]['qty']+=$row[csf("cons_quantity")];
					$recv_yarn_arr[$row[csf("job_no")]]['amt']+=$row[csf("cons_amount")];
					if($row[csf("dye_charge")]>0)
					{
						$recv_yarn_rate_arr[$row[csf("job_no")]]['rate']=$dye_charge;
					}

					$SYarnRecv_arr[$index]['qty']+=$row[csf("cons_quantity")];
					$SYarnRecv_arr[$index]['amt']+=$row[csf("cons_amount")];
					$SYarnRecv_arr[$index]['currency_id']=$currency_id;
					$SYarnRecv_arr[$index]['dye_charge']=$dye_charge;
					$serviceYarnRecv_arr[$row[csf("receive_id")]]=$row[csf("receive_id")];
				}
			}
		}
	    //echo '<pre>';print_r($serviceYarnRecv_arr);die;
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 3, $dyedYarnRecv_arr, $empty_arr);//Recv ID Ref from=3
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 4, $serviceYarnRecv_arr, $empty_arr);//Service Recv ID Ref from=4

	    // DYarn receive return
		// $Dyarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		// from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d
		// where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id and c.transaction_type in(3) and c.item_category=1 and a.id in(".implode(",",$dyedYarnRecv_arr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Dyarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d,gbl_temp_engine g
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=3 and g.entry_form=18  and c.transaction_type in(3) and c.item_category=1   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";


		$Dyarn_recv_return_res=sql_select($Dyarn_recv_return);

		$DYarnReceiveReturn_arr = array();
		foreach ($Dyarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$DYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$DYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}
		//echo '<pre>';print_r($DYarnReceiveReturn_arr);die;

		// SYarn receive return
		// $Syarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		// from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d
		// where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id and c.transaction_type in(3) and c.item_category=1 and a.id in(".implode(",",$serviceYarnRecv_arr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Syarn_recv_return="SELECT d.yarn_count_id, d.yarn_comp_type1st, d.yarn_comp_percent1st, d.yarn_type, c.cons_rate, c.cons_quantity as quantity, (c.cons_quantity*c.cons_rate) as cons_amount
		from inv_receive_master a, inv_issue_master b, inv_transaction c, product_details_master d,gbl_temp_engine g
		where a.id=b.received_id and b.id=c.mst_id and c.prod_id=d.id  and a.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=4 and g.entry_form=18   and c.transaction_type in(3) and c.item_category=1  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$Syarn_recv_return_res=sql_select($Syarn_recv_return);

		$SYarnReceiveReturn_arr = array();
		foreach ($Syarn_recv_return_res as $row)
		{
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			$SYarnReceiveReturn_arr[$index]['qty'] += $row[csf("quantity")];
			$SYarnReceiveReturn_arr[$index]['amt']+=$row[csf("cons_amount")];
		}

			$YarnIssue=array();
	    //print_r($YarnIssueReturn);
		// $issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no,d.id as issue_id from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id and a.trans_type=2 and a.entry_form=3  and d.entry_form=3 and a.po_breakdown_id in(".implode(",",$poIdArr).") and d.issue_purpose not in(8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");
		$issue_details = sql_select("select a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(a.quantity*c.cons_rate) as cons_amount_issue,c.cons_amount,c.receive_basis,d.booking_no, c.requisition_no,d.id as issue_id from order_wise_pro_details a,product_details_master b,inv_transaction c,inv_issue_master d,gbl_temp_engine g where a.prod_id=b.id and a.trans_id=c.id and c.mst_id=d.id  and a.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.trans_type=2 and a.entry_form=3  and d.entry_form=3   and d.issue_purpose not in(8) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 order by a.prod_id");
		$issue_arr = $booking_req=$DYarnIssue = array();
		foreach ($issue_details as $row)
		{
			$issue_id_str.=$row[csf("issue_id")].",";
			$dyed_type=$row[csf("dyed_type")];
			$issue_purpose_id=$row[csf("issue_purpose")];
			$issue_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			if($issue_purpose_id==2) //Gery Yarn- for Dyed Yarn
			{
				$DYarnIssue[$index]['qty']+=$row[csf("quantity")];
				$DYarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			}
			else if(($issue_purpose_id==1 || $issue_purpose_id==4) && $dyed_type!=1) //Grey for knitting,Sample with
			{
				$YarnIssue[$index]['qty']+=$row[csf("quantity")];
				$YarnIssue[$index]['amount']+=$row[csf("cons_amount_issue")];
			}
			$YarnIssue_avg_rate[$row[csf("lot")]]['avg_rate']+=$row[csf("cons_amount_issue")]/$row[csf("quantity")];
			$yarn_lots.=$row[csf("lot")].',';
		}

		$issue_ids = chop($issue_id_str,",");
		$issue_idsArr=array_unique(explode(",",$issue_ids));
		$issue_id_string=where_con_using_array(array_unique(explode(",",$issue_ids)),0,"c.issue_id");
		//$issue_id_string = implode(",",array_unique(explode(",",$issue_ids)));

		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 5, $issue_idsArr, $empty_arr);//Issue ID Ref from=10

		//echo '<pre>';print_r($DYarnReceiveReturn_arr);die;
	
		if($issue_ids !="")
		{
			// $issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,c.receive_basis, b.dyed_type from order_wise_pro_details a, product_details_master b,inv_transaction c where a.prod_id=b.id and a.trans_id=c.id and a.trans_type in(4) and a.entry_form in(9) and a.po_breakdown_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 $issue_id_string ");
			$issue_return=sql_select("select a.id,a.trans_id,a.trans_type,a.entry_form,a.po_breakdown_id,a.prod_id,a.quantity as quantity,a.issue_purpose,a.returnable_qnty, a.is_sales, b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,c.cons_rate,(a.quantity*c.cons_rate) as cons_amount,c.order_amount,c.issue_id,c.receive_basis, b.dyed_type from order_wise_pro_details a, product_details_master b,inv_transaction c,gbl_temp_engine g,gbl_temp_engine gg where a.prod_id=b.id and a.trans_id=c.id  and a.po_breakdown_id=g.ref_val  and c.issue_id=gg.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and gg.user_id = ".$user_id." and gg.ref_from=5 and gg.entry_form=18  and a.trans_type in(4) and a.entry_form in(9)   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1  ");
			$YarnIssueReturn = $booking_req_return = array();
			foreach ($issue_return as $row)
			{
				$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
				if ($row[csf("dyed_type")] != 1){
					$YarnIssueReturn[$index]['qty'] += $row[csf("quantity")];
					$YarnIssueReturn[$index]['amount']+=$row[csf("cons_amount")];
				}
			}
		}

	    //print_r($DYarnIssue);
		foreach($YarnIssue as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'A';
			$YarnData[$ind]['acl']['qty']+=$value['qty']-$YarnIssueReturn[$ind]['qty'];
			$YarnData[$ind]['acl']['amount']+=($value['amount']-$YarnIssueReturn[$ind]['amount'])/$g_exchange_rate;
		}
		foreach($YarnRecv_arr as $ind=>$value){
			//echo $YarnIssueReturn[$ind]['qty'].'b';
			$currency_id=$value['currency_id'];
			$DYarnData[$ind]['acl']['qty']+=($value['qty']-$DYarnReceiveReturn_arr[$ind]['qty']);
			if($currency_id==1) //TK
			{
				$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt'])/$g_exchange_rate;
			}
			else
			{
			 	$DYarnData[$ind]['acl']['amount']+=($value['amt']-$DYarnReceiveReturn_arr[$ind]['amt']);
			}
		}

		//$job_no_cond=where_con_using_array(array_unique($job_no_arr),1,"b.job_no");
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 2, $jobIdArr, $empty_arr);//Job id Ref from=6

		$sql_dy="SELECT
				       a.qnty,
				       c.yarn_count_id,
				       c.yarn_comp_type1st,
				       c.yarn_comp_percent1st,
				       c.yarn_type,
				       (a.qnty*c.avg_rate_per_unit) as amt
				  FROM inv_material_allocation_mst a,
				       wo_po_details_master b,
				       product_details_master c,
				       wo_booking_mst d,gbl_temp_engine g
				 WHERE a.job_no = b.job_no
				 	   and a.booking_no = d.booking_no
						and b.id=g.ref_val   and g.user_id = ".$user_id." and g.ref_from =2 and g.entry_form=18
				       and a.item_id = c.id
				       and a.is_dyied_yarn = 1
				       and a.qnty > 0
				       and a.status_active = 1
				       and a.is_deleted = 0
				       and b.status_active = 1
				       and b.is_deleted = 0
				       and c.status_active = 1
				       and c.is_deleted = 0
				       and a.entry_form in (0,1)
				       ";
	    //echo $sql_dy;die;
	    $res_dy=sql_select($sql_dy);

	    $data_dried_yarn=array();

		foreach ($res_dy as $row)
		{


			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";

			$data_dried_yarn[$index]['qty']+=$row[csf("qnty")];
			$data_dried_yarn[$index]['amt']+=$row[csf("amt")];
		}
		$dried_yarn_data_arr=array();
		foreach ($data_dried_yarn as $index => $value) {
			$dried_yarn_data_arr[$index]['acl']['qty']+=$value['qty'];
			$dried_yarn_data_arr[$index]['acl']['amount']+=($value['amt'])/$g_exchange_rate;

		}

		//print_r($DYarnData);
						//print_r($qYarnData);
	 	//	$yarn_recv =sql_select("select a.booking_no,b.job_no,b.cons_amount,b.dye_charge,b.cons_quantity,c.yarn_count_id,c.yarn_comp_type1st, c.yarn_comp_percent1st,c.yarn_type from inv_receive_master a,inv_transaction b,product_details_master c where a.id=b.mst_id and b.prod_id=c.id and  b.job_no ='".$jobNumber."' and a.entry_form=1 and a.receive_basis=2 and b.transaction_type=1 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0");

		$issue_details_yarn_service = sql_select("select d.id as prod_id,e.currency,f.cons_quantity as cons_quantity,c.dyeing_charge as dye_charge,b.product_name_details,b.yarn_count_id,b.yarn_comp_type1st, b.yarn_comp_percent1st,b.yarn_type,b.dyed_type,b.lot,(c.amount) as service_amount,d.booking_no from inv_transaction f,product_details_master b,wo_yarn_dyeing_dtls c,inv_receive_master d,wo_yarn_dyeing_mst e where f.prod_id=b.id  and f.mst_id=d.id  and e.id=c.mst_id
		 and d.booking_id=e.id and d.entry_form=1  and  c.job_no ='".$jobNumber."' and d.receive_purpose in(7,12,15,38,46,50,51)   and c.is_deleted=0 and c.status_active=1 and b.is_deleted=0 and b.status_active=1 order by b.id");

		$yarn_service_arr = array();
		foreach ($issue_details_yarn_service as $row)
		{
			$dyed_type=$row[csf("dyed_type")];
			$currency=$row[csf("currency")];
			$yarn_service_arr[$row[csf("booking_no")]]["prod_id"] = $row[csf("product_name_details")];
			$index="'".$row[csf("yarn_count_id")]."_".$row[csf("yarn_comp_type1st")]."_".$row[csf("yarn_comp_percent1st")]."_".$row[csf("yarn_type")]."'";
			//	$recv_yarn_rate=$recv_yarn_rate_arr[$jobNumber]['rate'];
			$ServiceYarnIssue[$index]['qty']+=$row[csf("cons_quantity")];
			if($currency==1) //Tk
			{
				$ServiceYarnIssue[$index]['amount']+=($row[csf("cons_quantity")]*$row[csf("dye_charge")])/$g_exchange_rate;
			}
			else
			{
				$ServiceYarnIssue[$index]['amount']+=$row[csf("cons_quantity")]*$row[csf("dye_charge")];

			}
		}

	    	//print_r($SYarnRecv_arr);die;
		 foreach($SYarnRecv_arr as $ind=>$value){
			$currency_id=$value['currency_id'];
			$SYarnData[$ind]['acl']['qty']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty']);
			if( $currency_id==1)
			{
				$SYarnData[$ind]['acl']['amount']+=(($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"])/$g_exchange_rate;
			}
			else
			{
				$SYarnData[$ind]['acl']['amount']+=($value['qty']-$SYarnReceiveReturn_arr[$ind]['qty'])*$value["dye_charge"];

			}
		} 


	/* 	$condition1= new condition();
		$condition1->po_id("in(".implode(",",$poIdArr).")");
		$condition1->init();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process=$conversion1->getAmountArray_by_orderAndConversionid();
		$conversion1= new conversion($condition1);
		$conversion_costing_arr_process_qty=$conversion1->getQtyArray_by_orderAndConversionid(); */
	
		/* $sql_conv_yarn="select b.id as po_id, c.job_no, c.id as conv_id,c.cons_process, d.fabric_description,d.composition from wo_po_break_down b, wo_pre_cost_fab_conv_cost_dtls c, wo_pre_cost_fabric_cost_dtls d  where  b.job_no_mst=c.job_no and c.job_no=d.job_no  and c.fabric_description=d.id  and b.status_active=1 and c.cons_process in(153,134,30) and b.is_deleted=0 and b.id in(".implode(",",$poIdArr).") and c.amount>0 ";
		echo "fffffffff";die; */
		//echo "fffffffff";die;
		$result_conv_yarn=sql_select($sql_conv_yarn);
		$conv_yarn_arr=array();
		foreach($result_conv_yarn as $row){
			$cons_process=$row[csf("cons_process")];
			$index="".$row[csf("composition")]."";
			$desc="".$row[csf("fabric_description")]."";
			if($cons_process==30)
			{
				$index="".$row[csf("fabric_description")]."";
				$conv_yarn_arr[$index]['preCost']['amount']+= array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['qty']+= array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$conv_yarn_arr[$index]['preCost']['amount']+=$row[csf("cons_amount")];
				$conv_yarn_arr[$index]['acl']['qty']=$YarnRecv_arr[$row[csf("job_no")]]['qty'];
				$conv_yarn_arr[$index]['acl']['amount']=$YarnRecv_arr[$row[csf("job_no")]]['amt'];
			}
			else
			{
				//echo $index="".$row[csf("composition")]."";
				//$SYarnData[$ind]['pre']['qty']+=$value['qty'];
				$ServiceYarnConv[$desc]['amount']+=array_sum($conversion_costing_arr_process[$row[csf("po_id")]][$row[csf("conv_id")]]);
				$ServiceYarnConv[$desc]['qty']+=array_sum($conversion_costing_arr_process_qty[$row[csf("po_id")]][$row[csf("conv_id")]]);
			}
		}

		foreach($ServiceYarnConv as $ind=>$value) {
			$SYarnData[$ind]['pre']['qty']+=$value['qty'];
			$SYarnData[$ind]['pre']['amount']+=$value['amount'];
		}
		//print_r($SYarnData);
		
		$yarn_lots=rtrim($yarn_lots,',');
		$yarn_lots=array_unique(explode(",",$yarn_lots));
		$lot_tmp='';
		foreach($yarn_lots as $lot)
		{
			if($lot_tmp=='') $lot_tmp="'".$lot."'";else $lot_tmp.=","."'".$lot."'";
		}

		//echo $lot_tmp;
		$grey_fab_array=array();  //Knitting Cost actual
		$sql_knit_prod="select c.yarn_lot,
		  (CASE WHEN b.entry_form =2 and b.trans_type in(1) and a.item_category=13  THEN  b.quantity ELSE 0 END) AS grey_qnty
		  from inv_receive_master a, order_wise_pro_details b,pro_grey_prod_entry_dtls c,gbl_temp_engine g where a.id=c.mst_id and c.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(2) and a.item_category in(13)  and b.trans_type in(1) and c.yarn_lot in(".$lot_tmp.") ";
		$result_knit=sql_select( $sql_knit_prod );
		$knit_grey_qty=$knit_grey_amt=0;
		foreach($result_knit as $row){
			$avg_rate=$YarnIssue_avg_rate[$row[csf("yarn_lot")]]['avg_rate']/$g_exchange_rate;
			$knit_grey_qty+=$row[csf("grey_qnty")];
			$knit_grey_amt+=$row[csf("grey_qnty")]*$avg_rate;
		}
		//$avg_rate_array=return_library_array( "select id, avg_rate_per_unit from product_details_master", "id", "avg_rate_per_unit"  );
		// $sql_prod=sql_select("select id, avg_rate_per_unit,product_name_details from product_details_master");
		// foreach($sql_prod as $row){
		// 	$avg_rate_array[$row[csf("id")]]=$row[csf("avg_rate_per_unit")];
		// 	$desc_array[$row[csf("id")]]=$row[csf("product_name_details")];
		// }

		//echo $lot_tmp;
		//echo $knit_grey_amt; // and a.yarn_lot in(".$lot_tmp.")
		$grey_fab_trans_array=array();
		// $sql_grey_trans="select c.from_order_id, a.from_prod_id,
		// sum(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		// sum(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		// sum(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		// sum(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		// from inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b where c.id=a.mst_id and a.id=b.dtls_id and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,82,183,110,13) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by  a.from_prod_id,c.from_order_id";//
		$sql_grey_trans="select c.from_order_id, a.from_prod_id, 
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity ELSE 0 END) AS grey_in,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity ELSE 0 END) AS grey_out,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(5) THEN  b.quantity*a.rate ELSE 0 END) AS grey_in_amt,
		(CASE WHEN b.entry_form in(83,82,183,110,13) and b.trans_type in(6) THEN  b.quantity*a.rate ELSE 0 END) AS grey_out_amt
		from inv_item_transfer_mst c, inv_item_transfer_dtls a, order_wise_pro_details b,gbl_temp_engine g where c.id=a.mst_id and a.id=b.dtls_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and c.transfer_criteria!=2 and b.status_active=1 and b.is_deleted=0 and b.entry_form in(83,82,183,110,13) and b.trans_type in(5,6)";//

		


		$result_grey_trans=sql_select( $sql_grey_trans );
		foreach ($result_grey_trans as $row)
		{
			$from_prod_idarr[$row[csf('from_prod_id')]]=$row[csf('from_prod_id')];
		}
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 18, 6, $from_prod_idarr, $empty_arr);//Prod ID Ref from=6

		$sql_prod=sql_select("select b.id, b.product_name_details,b.avg_rate_per_unit from product_details_master b,gbl_temp_engine g where  1=1 and b.id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=6 and g.entry_form=18");
		foreach($sql_prod as $row){
			$avg_rate_array[$row[csf("id")]]=$row[csf("avg_rate_per_unit")];
			$desc_array[$row[csf("id")]]=$row[csf("product_name_details")];
		}
		

		$grey_fab_trans_qty_acl=$grey_fab_trans_amt_acl=0;$from_order_id='';
		foreach ($result_grey_trans as $row)
		{
			$avg_rate=$avg_rate_array[$row[csf('from_prod_id')]];
			$grey_in_amt=$row[csf('grey_in')]*$avg_rate;
			$grey_out_amt=$row[csf('grey_out')]*$avg_rate;
			$from_order_id.=$row[csf('from_order_id')].',';
			$grey_fab_trans_qty_acl+=$row[csf('grey_in')]-$row[csf('grey_out')];
			$grey_fab_trans_amt_acl+=$grey_in_amt-$grey_out_amt;

		}
		$from_order_id=rtrim($from_order_id,',');

		$from_order_ids=array_unique(explode(",",$from_order_id));


		//  $subconOutBillData="select b.order_id,b.currency_id,
		// sum(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		// sum(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		// from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4) and b.order_id in(".implode(",",$poIdArr).") group by b.currency_id,b.order_id";
		 $subconOutBillData="select b.order_id,b.currency_id,
		(CASE WHEN a.process_id=2 THEN b.amount END) AS knit_bill,
		(CASE WHEN a.process_id=4 THEN b.amount END) AS dye_finish_bill
		from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.process_id in(2,4)  ";
		$subconOutBillDataArray=sql_select($subconOutBillData);
		$tot_knit_charge=0;
		foreach($subconOutBillDataArray as $subRow)
		{
			if($subRow[csf('knit_bill')]>0 && $subRow[csf('currency_id')]==1)
			{
				$tot_knit_charge+=$subRow[csf('knit_bill')]/$g_exchange_rate;
			}
			else
			{
				$tot_knit_charge+=$subRow[csf('knit_bill')];
			}
		}

		// Transfer Fin Actual
		$fin_fab_trans_array=array();
		// $sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, sum(b.quantity) as qnty,
		// 	sum(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		// 	sum(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
		//  c.from_order_id
		//   from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c where a.id=b.trans_id and c.id=a.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and c.transfer_criteria!=2 and b.is_deleted=0 and b.entry_form in(15,14,306) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6) and b.po_breakdown_id in(".implode(",",$poIdArr).") group by b.trans_type, b.po_breakdown_id,c.from_order_id,b.prod_id";
		$sql_fin_trans="select b.trans_type, b.po_breakdown_id,b.prod_id, (b.quantity) as qnty,
		(CASE WHEN b.trans_type=5 THEN b.quantity END) AS in_qty,
		(CASE WHEN b.trans_type=6 THEN b.quantity END) AS out_qty,
	 c.from_order_id
	  from inv_transaction a, order_wise_pro_details b,inv_item_transfer_mst c,gbl_temp_engine g where a.id=b.trans_id and c.id=a.mst_id and b.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and c.transfer_criteria!=2 and b.is_deleted=0 and b.entry_form in(15,14,306) and a.item_category=2 and a.transaction_type in(5,6) and b.trans_type in(5,6)";

		$result_fin_trans=sql_select( $sql_fin_trans );
		$fin_from_order_id='';$fin_fab_trans_qty=$fin_fab_trans_amt=$fin_in_qnty=$fin_out_qnty=$fin_in_amt=$fin_out_amt=0;
		foreach ($result_fin_trans as $row)
		{
			$fin_from_order_id.=$row[csf('from_order_id')].',';

			$avg_rate=$avg_rate_array[$row[csf('prod_id')]];
			$fin_in_qnty+=$row[csf('in_qty')];
			$fin_out_qnty+=$row[csf('out_qty')];

			$fin_in_amt+=$row[csf('in_qty')]*$avg_rate;
			$fin_out_amt+=$row[csf('out_qty')]*$avg_rate;
		}

		$po_ids=implode(",",$poIdArr);
		unset($result_fin_trans);
		$fin_from_order_id=rtrim($fin_from_order_id,',');
		$fin_from_order_ids=array_unique(explode(",",$fin_from_order_id));

		$fin_trans_in_qty=$fin_in_qnty;
		$fin_trans_out_qty=$fin_out_qnty;

		$fin_trans_in_amt=$fin_in_amt;
		$fin_trans_out_amt=$fin_out_amt;

	    //	echo $fin_trans_in_amt.'AA'.$fin_trans_out_amt;

		$tot_fin_fab_transfer_qty=$fin_trans_in_qty-$fin_trans_out_qty;
		$tot_fin_fab_transfer_amt=$fin_trans_in_amt-$fin_trans_out_amt;

		$tot_fin_fab_transfer_cost=$tot_fin_fab_transfer_amt/$g_exchange_rate;
		$tot_grey_fab_cost_acl=$grey_fab_trans_amt_acl/$g_exchange_rate;
		$job=str_replace("'","",$job);
		$jobWise_yarn_qty=0;
		$jobWise_yarn_amt=0;
		$sql_jobWise_yarn=sql_select("select JOB_NO, CONS_QNTY, AMOUNT from wo_pre_cost_fab_yarn_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_yarn as $val) {
			$jobWise_yarn_qty += $val['CONS_QNTY'];
			$jobWise_yarn_amt += $val['AMOUNT'];
		}
		$per_kg_yarn=$jobWise_yarn_amt/$jobWise_yarn_qty;

		$gray_conversion_costing_process_qty=0;
		$gray_conversion_costing_process_amt=0;
		$finish_conversion_costing_process_qty=0;
		$finish_conversion_costing_process_amt=0;

		$sql_jobWise_conversion=sql_select("select JOB_NO, CONS_PROCESS, REQ_QNTY, AMOUNT from wo_pre_cost_fab_conv_cost_dtls where job_no='$job' and status_active=1 and is_deleted=0");
		foreach ($sql_jobWise_conversion as $val) {
			if ($val['CONS_PROCESS']==1){
				$gray_conversion_costing_process_qty += $val['REQ_QNTY'];
				$gray_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if($val['CONS_PROCESS'] !=30 && $val['CONS_PROCESS'] !=1  && $val['CONS_PROCESS'] !=35 && $val['CONS_PROCESS'] !=134) {
				$finish_conversion_costing_process_amt += $val['AMOUNT'];
			}
			if ($val['CONS_PROCESS'] ==31) $finish_conversion_costing_process_qty += $val['REQ_QNTY'];
		}
		$gray_charge_unit = $gray_conversion_costing_process_amt/$gray_conversion_costing_process_qty;
		$finish_charge_unit = $finish_conversion_costing_process_amt/$finish_conversion_costing_process_qty;
		//echo $gray_conversion_costing_process_qty.'**'.$gray_conversion_costing_process_amt.'**'.$finish_conversion_costing_process_qty.'**'.$finish_conversion_costing_process_amt.'**'.$jobWise_yarn_qty.'**'.$jobWise_yarn_amt;
		$gray_transfer_amount=$grey_fab_trans_qty_acl*$per_kg_yarn+$grey_fab_trans_qty_acl*$gray_charge_unit;

		$finish_transfer_amount=$tot_fin_fab_transfer_qty*$per_kg_yarn+$tot_fin_fab_transfer_qty*$gray_charge_unit+$tot_fin_fab_transfer_qty*$finish_charge_unit;
		//echo $gray_transfer_amount.'**'.$finish_transfer_amount;


		// Yarn End============================
		// Fabric Purch ============================
		$totPrecons=0; $totPreAmt=0;
		$fabPur=$fabric->getQtyArray_by_Fabriccostid_knitAndwoven_greyAndfinish();

		//print_r($fabPur);
		 $sql = "select id, job_no,item_number_id,uom, body_part_id, fab_nature_id, color_type_id, fabric_description, avg_cons, fabric_source, rate, amount,avg_finish_cons,status_active from wo_pre_cost_fabric_cost_dtls where job_no='".$jobNumber."' and fabric_source=2 and status_active=1 and is_deleted=0";
		$data_fabPur=sql_select($sql);
		foreach($data_fabPur as $fabPur_row){
			if($fabPur_row[csf('fab_nature_id')]==2){
				$Precons=$fabPur['knit']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				//echo $Precons.', ';
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['knit']['qty']+=$Precons;
				$fabPurArr['pre']['knit']['amount']+=$Preamt;
			}
			if($fabPur_row[csf('fab_nature_id')]==3){
				$Precons=$fabPur['woven']['grey'][$fabPur_row[csf('id')]][$fabPur_row[csf('uom')]];
				$Preamt=$Precons*$fabPur_row[csf('rate')];
				$fabPurArr['pre']['woven']['qty']+=$Precons;
				$fabPurArr['pre']['woven']['amount']+=$Preamt;
			}
		}

		// $sql = "select a.item_category, a.booking_type, a.exchange_rate,a.fabric_source, b.trim_group,b.wo_qnty,b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount, b.uom as cons_uom from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no  and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$sql = "select a.item_category, a.booking_type, a.exchange_rate,a.fabric_source, b.trim_group,b.wo_qnty,b.grey_fab_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount, b.uom as cons_uom from wo_booking_mst a, wo_booking_dtls b,gbl_temp_engine g where a.booking_no=b.booking_no   and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		$data_fabPur=sql_select($sql);//and a.booking_type=1 and a.fabric_source=2
		foreach($data_fabPur as $fabPur_row){
			$booking_type=$fabPur_row[csf('booking_type')];$fabric_source=$fabPur_row[csf('fabric_source')];
			if($booking_type==1 && $fabric_source==2) //Purchase and Fabric
			{
				if($fabPur_row[csf('item_category')]==2){
					$fabPurArr['acl']['knit']['qty']+=$fabPur_row[csf('fin_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['knit']['amount']+=$fabPur_row[csf('amount')];
					}
				}
				if($fabPur_row[csf('item_category')]==3){
					$fabPurArr['acl']['woven']['qty']+=$fabPur_row[csf('fin_fab_qnty')];
					if($fabPur_row[csf('grey_fab_qnty')]>0){
						$fabPurArr['acl']['woven']['amount']+=$fabPur_row[csf('amount')];
					}
				}
			}
			else //Trims
			{
				if($fabPur_row[csf('item_category')]==4){
					$rate=$fabPur_row[csf('rate')];
					$con_factor=$trim_groupArr[$fabPur_row[csf('trim_group')]]['con_factor'];
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['qty']+=$fabPur_row[csf('wo_qnty')]*$con_factor;
					//$trimsRecArr[$row[csf('trim_group')]]['out_qty']+=$row[csf('wo_qnty')]*$con_factor;
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['amt']+=$fabPur_row[csf('wo_qnty')]*$con_factor*$rate;
					$trimsRecArr[$fabPur_row[csf('trim_group')]]['cons_uom']=$fabPur_row[csf('cons_uom')];
					//	$trimsRecArr[$row[csf('trim_group')]]['out_amt']+=$row[csf('wo_qnty')]*$con_factor*$rate;
				}

			}
		}
		//echo '<pre>';print_r($trimsRecArr);die;

		// Fabric Purch End ============================
		// Fabric Kniting  ==============================
		$conversion= new conversion($condition);
		//$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$knitQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess(); 
		$conversion= new conversion($condition);
		$knitAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//print_r($knitQtyArr);
		  $sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from  wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_id=b.job_id and a.id=b.fabric_description and  a.job_no='".$jobNumber."' and b.cons_process=1 and a.status_active=1 and b.status_active=1";
		$data_knit=sql_select($sql);
		foreach($data_knit as $row_knit){
			$index="'".$row_knit[csf('body_part_id')]."_".$row_knit[csf('color_type_id')]."_".$row_knit[csf('fabric_description')]."_".$row_knit[csf('gsm_weight')]."'";
			if($row_knit[csf('cons_process')]==1){
				$knitData[$index]['pre']['qty']=array_sum($knitQtyArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
				$knitData[$index]['pre']['amount']=array_sum($knitAmtArr[$jobNumber][$row_knit[csf('id')]][$row_knit[csf('cons_process')]]);
			}
		}

		//
		//  $sql_in = "select  b.receive_qty as receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c where a.id=b.mst_id and b.item_id=c.id and a.process_id=2 and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql_in = "select b.delivery_qty as receive_qty, b.rate, b.amount,b.currency_id, c.product_name_details from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=2 and a.party_source=1  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit_in=sql_select($sql_in);
		foreach($data_knit_in as $row_knit){
			$currency_id=$row_knit[csf('currency_id')];
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			if($currency_id==1)
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
				$knitData[$index]['acl']['rate']+=$row_knit[csf('rate')]/$g_exchange_rate;
			}
			else //USD
			{
				$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')];
				$knitData[$index]['acl']['rate']+=$row_knit[csf('rate')];
			}
		}
		//print_r($knitData);
		// Fabric Kniting  End============================
		// Fabric Dye Finish  ==============================
		$conversion= new conversion($condition);
		$finishQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$finishAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$finishDesArr=array();
		$sql = "select a.id, a.job_no, a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.job_no='".$jobNumber."' and b.cons_process not in(1,2,134,30,35,153)";
		$data_finish=sql_select($sql);
		foreach($data_finish as $row_finish){
			$index="'".$row_finish[csf('body_part_id')]."_".$row_finish[csf('color_type_id')]."_".$row_finish[csf('fabric_description')]."_".$row_finish[csf('gsm_weight')]."'";
			$finishData[$index]['pre']['qty']+=array_sum($finishQtyArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['amount']+=array_sum($finishAmtArr[$jobNumber][$row_finish[csf('id')]][$row_finish[csf('cons_process')]]);
			$finishData[$index]['pre']['process_name'].=$conversion_cost_head_array[$row_finish[csf('cons_process')]].',';
		}
		$sql_out = "select  b.receive_qty,b.rate,b.amount,c.product_name_details from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18 and a.process_id=2   and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_knit=sql_select($sql_out);
		foreach($data_knit as $row_knit){
			$index=$row_knit[csf('product_name_details')];
			$knitData[$index]['acl']['qty']+=$row_knit[csf('receive_qty')];
			$knitData[$index]['acl']['amount']+=$row_knit[csf('amount')]/$g_exchange_rate;
		}


		// $sql_in = "select a.discount,b.order_id,b.rate,b.amount,b.delivery_qty  from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b where a.id=b.mst_id and b.order_id in(".implode(",",$poIdArr).") and a.process_id=4 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";
	 	$sql_fin_in = "select  b.delivery_qty as receive_qty,b.rate,b.amount,b.currency_id,c.product_name_details, a.process_id from subcon_inbound_bill_mst a, subcon_inbound_bill_dtls b, product_details_master c,gbl_temp_engine g where a.id=b.mst_id and b.item_id=c.id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.process_id=4   and a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";

		$data_dye_fin=sql_select($sql_fin_in);
		foreach($data_dye_fin as $data_dye)
		{
			$sub_process_id=$data_dye[csf('sub_process_id')];
			$currency_id=$data_dye[csf('currency_id')];
			$discount=$data_dye[csf('discount')];
			$index="'".$data_dye[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$data_dye[csf('delivery_qty')];
			if($currency_id==1 && $discount>0)
			{
				$finishData[$index]['acl']['amount']+=($data_dye[csf('amount')]-$discount)/$g_exchange_rate;
				$finishData[$index]['acl']['rate']+=$data_dye[csf('rate')]/$g_exchange_rate;
			}
			else
			{
				$finishData[$index]['acl']['amount']+=$data_dye[csf('amount')];
				$finishData[$index]['acl']['rate']+=$data_dye[csf('rate')];
			}
		}

		// $sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b where a.id=b.mst_id  and a.process_id=4  and b.order_id in(".implode(",",$poIdArr).") and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$sql = "select  b.body_part_id,b.receive_qty,b.rate,b.amount,b.currency_id,b.sub_process_id from subcon_outbound_bill_mst a, subcon_outbound_bill_dtls b,gbl_temp_engine g where a.id=b.mst_id  and b.order_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.process_id=4  and  a.is_deleted=0 and a.status_active=1 and  b.is_deleted=0 and b.status_active=1";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop)
		{
			$sub_process_id=$row_aop[csf('sub_process_id')];
			$currency_id=$row_aop[csf('currency_id')];
			$index="'".$row_aop[csf('body_part_id')]."'";
			$finishData[$index]['acl']['qty']+=$row_aop[csf('receive_qty')];
			if($currency_id==1)
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
				$finishData[$index]['acl']['rate']+=$row_aop[csf('rate')];
			}
			else
			{
				$finishData[$index]['acl']['amount']+=$row_aop[csf('amount')];
				$finishData[$index]['acl']['rate']+=$row_aop[csf('rate')];
			}
		}
		// Fabric Dye Finish  End============================
		// Fabric AOP  ==============================
		$conversion= new conversion($condition);
		$aopQtyArr=$conversion->getQtyArray_by_jobFabricAndProcess();
		$conversion= new conversion($condition);
		$aopAmtArr=$conversion->getAmountArray_by_jobFabricAndProcess();
		//$aopDesArr=array();
		$sql = "select a.id, a.job_no,a.item_number_id, a.body_part_id, a.fab_nature_id, a.color_type_id, a.fabric_description, a.gsm_weight, a.avg_cons, a.fabric_source, a.rate, a.amount, a.avg_finish_cons, a.status_active, b.cons_process from wo_pre_cost_fabric_cost_dtls a, wo_pre_cost_fab_conv_cost_dtls b where a.job_no=b.job_no and a.id=b.fabric_description and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and a.job_no='".$jobNumber."' and b.cons_process=35";
		$data_aop=sql_select($sql);
		foreach($data_aop as $row_aop){
			$index="'".$row_aop[csf('body_part_id')]."_".$row_aop[csf('color_type_id')]."_".$row_aop[csf('fabric_description')]."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['pre']['qty']+=array_sum($aopQtyArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
				$AopfinishData[$index]['pre']['amount']+=array_sum($aopAmtArr[$jobNumber][$row_aop[csf('id')]][$row_aop[csf('cons_process')]]);
			}
		}


		// Fabric AOP  End============================
		// Trim Cost ============================
		//$trimQtyArr=$trim->getQtyArray_by_jobAndItemid();
		$trimQtyArr=$trim->getQtyArray_by_jobAndPrecostdtlsid();
		$trim= new trims($condition);
		$trimAmtArr=$trim->getAmountArray_by_jobAndPrecostdtlsid();

		$sql = "select id, job_no, trim_group, description, brand_sup_ref, cons_uom, cons_dzn_gmts, rate, amount, apvl_req, nominated_supp, status_active from wo_pre_cost_trim_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$trimData[$row[csf('trim_group')]]['pre']['qty']+=$trimQtyArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['pre']['amount']+=$trimAmtArr[$row[csf('job_no')]][$row[csf('id')]];
			$trimData[$row[csf('trim_group')]]['cons_uom']=$row[csf('cons_uom')];
		}
		foreach($trimsRecArr as $ind=>$value){
			//echo $value['amt'].',';
			$trimData[$ind]['acl']['qty']+=$value['qty'];
			$trimData[$ind]['acl']['amount']+=$value['amt'];
			$trimData[$ind]['cons_uom']=$value['cons_uom'];
			$trimData[$ind]['item_description']=$value['item_description'];
		}
		// $sql_issue_mrr = "select a.id as trid, a.transaction_type, a.cons_uom, b.issue_number, b.issue_purpose, a.order_id, a.cons_quantity, a.cons_amount, c.item_group_id, c.item_description from inv_transaction a, inv_issue_master b, product_details_master c
		// where a.mst_id=b.id and c.id=a.prod_id  and a.transaction_type in (2) and a.item_category=4 and a.order_id in(".implode(",",$poIdArr).")";
		$sql_issue_mrr = "select a.id as trid, a.transaction_type, a.cons_uom, a.order_id, a.cons_quantity, a.cons_amount, c.item_group_id, c.item_description from  product_details_master c,inv_transaction a,gbl_temp_engine g
		where   c.id=a.prod_id  and a.order_id=g.ref_val and  a.order_id>0  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18   and a.transaction_type=2 and a.item_category=4 ";
		$result_trim_trans=sql_select( $sql_issue_mrr );
		$trimsRecArr_new=array();

		foreach ($result_trim_trans as $row)
		{
			$index= $row[csf('item_description')]."***".$row[csf('item_group_id')];
			$trimsRecArr_new[$index]['qty']+=$row[csf('cons_quantity')];
			$trimsRecArr_new[$index]['amt']+=$row[csf('cons_amount')]/$g_exchange_rate;
			$trimsRecArr_new[$index]['cons_uom']=$row[csf('cons_uom')];
			$trimsRecArr_new[$index]['item_description']=$row[csf('item_description')];
		}
		$trimData_new=array();
		foreach($trimsRecArr_new as $ind=>$value){
			//echo $value['amt'].',';
			$trimData_new[$ind]['acl']['qty']+=$value['qty'];
			$trimData_new[$ind]['acl']['amount']+=$value['amt'];
			$trimData_new[$ind]['cons_uom']=$value['cons_uom'];
			$trimData_new[$ind]['item_description']=$value['item_description'];
		}


			// $general_item_issue_sql="SELECT d.buyer_name,c.id as po_id, a.item_group_id as item_group_id, a.unit_of_measure as uom, a.item_description as description, b.store_id, a.id as prod_id, e.QUANTITY as cons_quantity, e.AMOUNT as cons_amount
			// from product_details_master a, inv_transaction b, order_wise_general_details e, wo_po_break_down c, wo_po_details_master d
			// where a.id=b.prod_id and b.id=e.TRANS_ID and e.PO_BREAKDOWN_ID=c.id and c.job_no_mst=d.job_no and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form<>24 and b.transaction_type in(2,3,6) and c.id in(".implode(",",$poIdArr).")";
			$general_item_issue_sql="SELECT e.po_breakdown_id as po_id, a.item_group_id as item_group_id, a.unit_of_measure as uom, a.item_description as description, b.store_id, a.id as prod_id, e.QUANTITY as cons_quantity, e.AMOUNT as cons_amount
			from product_details_master a, inv_transaction b, order_wise_general_details e, gbl_temp_engine g 
			where a.id=b.prod_id and b.id=e.trans_id  and a.id=e.prod_id and b.prod_id=e.prod_id   and e.po_breakdown_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.entry_form<>24 and b.transaction_type in(2,3,6)";
		$result_general_item_issue_sql=sql_select( $general_item_issue_sql );
	//	$trimsRecArr_new=array();

		foreach ($result_general_item_issue_sql as $row)
		{
			$index= $row[csf('description')]."***".$row[csf('item_group_id')];
			$trimsRecArr_new[$index]['qty']+=$row[csf('cons_quantity')];
			$trimsRecArr_new[$index]['amt']+=$row[csf('cons_amount')]/$g_exchange_rate;
			$trimsRecArr_new[$index]['cons_uom']=$row[csf('cons_uom')];
			$trimsRecArr_new[$index]['item_description']=$row[csf('description')];
		}
		//$trimData_new=array();
		foreach($trimsRecArr_new as $ind=>$value){
			//echo $value['amt'].',';
			$trimData_new[$ind]['acl']['qty']+=$value['qty'];
			$trimData_new[$ind]['acl']['amount']+=$value['amt'];
			$trimData_new[$ind]['cons_uom']=$value['cons_uom'];
			$trimData_new[$ind]['item_description']=$value['item_description'];
		}

		// Trim Cost End============================
		// Embl Cost ============================
		$embQtyArr=$emblishment->getQtyArray_by_jobAndEmblishmentid();
		$emblishment= new emblishment($condition);
		$embAmtArr=$emblishment->getAmountArray_by_jobAndEmblishmentid();

		$washQtyArr=$wash->getQtyArray_by_jobAndEmblishmentid();
		$wash= new wash($condition);
		$washAmtArr=$wash->getAmountArray_by_jobAndEmblishmentid();
		//print_r($washAmtArr);die;
		$sql = "select id, job_no, emb_name, emb_type, cons_dzn_gmts, rate, amount, status_active from wo_pre_cost_embe_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$job_no=$row[csf('job_no')];
			if($row[csf('emb_name')]==3)
			{
				$washData['pre']['qty']+=$washQtyArr[$job_no][$row[csf('id')]];
				$washData['pre']['amount']+=$washAmtArr[$job_no][$row[csf('id')]];
			}
			else
			{
				$embData['pre']['qty']+=$embQtyArr[$job_no][$row[csf('id')]];
				$embData['pre']['amount']+=$embAmtArr[$job_no][$row[csf('id')]];
			}
		}
		//print_r($embData);

		// $sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and c.emb_name!=3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1  and c.is_deleted=0 and c.status_active=1";
		
		$sql = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a, wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g  where a.booking_no=b.booking_no and c.job_no=b.job_no and c.id=b.pre_cost_fabric_cost_dtls_id  and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18  and a.booking_type=6 and c.emb_name!=3  and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1  and c.is_deleted=0 and c.status_active=1";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$embData['acl']['qty']+=$row[csf('wo_qnty')];
			$embData['acl']['amount']+=$row[csf('amount')];
		}
		// Embl Cost End ============================
		// Wash Cost ============================

	 	// $sql_wash = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and  c.emb_name=3 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		// $data_array_wash=sql_select($sql_wash);
		$sql_wash = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c,gbl_temp_engine g where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=6 and  c.emb_name=3 and b.po_break_down_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=5 and g.entry_form=18   and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
		foreach($data_array_wash as $row) {
			$washData['acl']['qty']+=$row[csf('wo_qnty')];
			$washData['acl']['amount']+=$row[csf('amount')];

		}
		$sql_cm_cost = "select amount,production_qty, po_id from wo_actual_cost_entry where cost_head=5 and po_id in(".implode(",",$poIdArr).") and status_active=1 and is_deleted=0";
		$sql_cm_cost_data=sql_select($sql_cm_cost);
		foreach($sql_cm_cost_data as $row) {
			$otherCmData['acl']['cm_cost']['qty']+=$row[csf('production_qty')];
			$otherCmData['acl']['cm_cost']['amount']+=$row[csf('amount')];
			$otherCmData['acl']['cm_cost']['rate']=$row[csf('amount')]/$row[csf('production_qty')];

		}
		//echo $sql_aop = "select a.item_category, a.exchange_rate, b.grey_fab_qnty, b.wo_qnty, b.fin_fab_qnty, b.po_break_down_id, b.rate, b.amount from wo_booking_mst a,wo_booking_dtls b,wo_pre_cost_embe_cost_dtls c where a.booking_no=b.booking_no and c.job_no=b.job_no  and c.id=b.pre_cost_fabric_cost_dtls_id and a.booking_type=3 and a.process=35 and  a.item_category=12 and b.po_break_down_id in(".implode(",",$poIdArr).") and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";

		$sql_aop = "select a.id,a.currency_id, b.job_no,c.item_number_id, c.body_part_id, c.fab_nature_id, c.color_type_id, c.fabric_description, c.gsm_weight, d.cons_process,b.wo_qnty,b.amount from wo_booking_mst a,wo_booking_dtls b ,wo_pre_cost_fabric_cost_dtls c, wo_pre_cost_fab_conv_cost_dtls d where a.booking_no=b.booking_no   and c.job_no=b.job_no  and d.id=b.pre_cost_fabric_cost_dtls_id  and d.fabric_description=c.id  and a.booking_type=3 and a.process=35 and  a.item_category=12 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.job_no='".$jobNumber."' and d.cons_process=35";

		$data_array_aop=sql_select($sql_aop);
		foreach($data_array_aop as $row_aop){
			$desc=$row_aop[csf("fabric_description")];
			$index="'".$row_aop[csf('body_part_id')]."_".$desc."_".$row_aop[csf('gsm_weight')]."'";
			if($row_aop[csf('cons_process')]==35){
				$AopfinishData[$index]['acl']['qty']+=$row_aop[csf('wo_qnty')];
				$currency_id=$row_aop[csf('currency_id')];
				if($currency_id==1)
				{
					$AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')]/$g_exchange_rate;
				}
				else
				{
				    $AopfinishData[$index]['acl']['amount']+=$row_aop[csf('amount')];

				}

			}
		//}

		}
		//print_r($AopfinishData);

		// Wash Cost End ============================
		// Commision Cost  ============================

		$commiAmtArr=$commision->getAmountArray_by_jobAndPrecostdtlsid();
		$sql = "select id, job_no, particulars_id, commission_base_id, commision_rate, commission_amount, status_active from  wo_pre_cost_commiss_cost_dtls  where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$commiData['pre']['qty']=$jobQty;
			$commiData['pre']['amount']+=$commiAmtArr[$jobNumber][$row[csf('id')]];
			$commiData['pre']['rate']+=$commiAmtArr[$jobNumber][$row[csf('id')]]/$jobQty;
		}

		// Commision Cost  End ============================

		// Commarcial Cost  ============================
		$commaData=array();
		$commaAmtArr=$commercial->getAmountArray_by_jobAndPrecostdtlsid();
		//print_r($commaAmtArr);
		$sql = "select id, job_no, item_id, rate, amount, status_active from  wo_pre_cost_comarci_cost_dtls where job_no='".$jobNumber."'  and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		$po_ids=rtrim($po_ids,',');
		$poIds=array_unique(explode(',',$po_ids));
		foreach($data_array as $row){
			$commaData['pre']['qty']=$jobQty;
			$commaData['pre']['amount']+=$commaAmtArr[$jobNumber][$row[csf('id')]];
			$exfactory_qty=0;
			foreach($poIds as $pid)
			{
				$exfactory_qty+=$exfactoryQtyArr[$pid];
			}
			$commaData['pre']['rate']+=$commaAmtArr[$jobNumber][$row[csf('id')]]/$exfactory_qty;
		}

		// Commarcial Cost  End ============================
		// Other Cost  ============================
		$other_cost=$other->getAmountArray_by_job();
		$sql = "select id, lab_test,  inspection, cm_cost, freight, currier_pre_cost, certificate_pre_cost, common_oh, depr_amor_pre_cost from  wo_pre_cost_dtls where job_no='".$jobNumber."' and status_active=1 and is_deleted=0";
		$data_array=sql_select($sql);
		foreach($data_array as $row){
			$otherData['pre']['freight']['qty']=$jobQty;
			$otherData['pre']['freight']['amount']=$other_cost[$jobNumber]['freight'];
			$otherData['pre']['freight']['rate']=$other_cost[$jobNumber]['freight']/$jobQty;

			$otherData['pre']['lab_test']['qty']=$jobQty;
			$otherData['pre']['lab_test']['amount']=$other_cost[$jobNumber]['lab_test'];
			$otherData['pre']['lab_test']['rate']=$other_cost[$jobNumber]['lab_test']/$jobQty;

			$otherData['pre']['inspection']['qty']=$jobQty;
			$otherData['pre']['inspection']['amount']=$other_cost[$jobNumber]['inspection'];
			$otherData['pre']['inspection']['rate']=$other_cost[$jobNumber]['inspection']/$jobQty;

			$otherData['pre']['currier_pre_cost']['qty']=$jobQty;
			$otherData['pre']['currier_pre_cost']['amount']=$other_cost[$jobNumber]['currier_pre_cost'];
			$otherData['pre']['currier_pre_cost']['rate']=$other_cost[$jobNumber]['currier_pre_cost']/$jobQty;

			$otherData['pre']['cm_cost']['qty']=$jobQty;
			$otherData['pre']['cm_cost']['amount']=$other_cost[$jobNumber]['cm_cost'];
			$otherData['pre']['cm_cost']['rate']=$other_cost[$jobNumber]['cm_cost']/$jobQty;
		}

		$financial_para=array();
		$sql_std_para=sql_select("select cost_per_minute,applying_period_date, applying_period_to_date from lib_standard_cm_entry where company_id=$company_name and status_active=1 and is_deleted=0 order by id desc");
		foreach($sql_std_para as $row )
		{
			$applying_period_date=change_date_format($row[csf('applying_period_date')],'','',1);
			$applying_period_to_date=change_date_format($row[csf('applying_period_to_date')],'','',1);
			$diff=datediff('d',$applying_period_date,$applying_period_to_date);
			for($j=0;$j<$diff;$j++)
			{
				$newdate =change_date_format(add_date(str_replace("'","",$applying_period_date),$j),'','',1);
				$financial_para[$newdate]['cost_per_minute']=$row[csf('cost_per_minute')];
			}
		}

		$sql_cm_cost="select jobNo, available_min, production_date from production_logicsoft where jobNo='".$jobNumber."' and is_self_order=1";
		$cm_data_array=sql_select($sql_cm_cost);
		foreach($cm_data_array as $row)
		{
			$production_date=change_date_format($row[csf('production_date')],'','',1);
			$cost_per_minute=$financial_para[$production_date]['cost_per_minute'];
			$otherData['acl']['cm_cost']['amount']+=($row[csf('available_min')]*$cost_per_minute)/$g_exchange_rate;
		}

		$sql_booking="select a.booking_no from wo_booking_dtls a,wo_po_break_down b where a.job_no=b.job_no_mst and a.po_break_down_id=b.id and a.po_break_down_id in(".implode(",",$poIdArr).") and a.booking_type=1 and a.status_active=1 and b.status_active=1";
		$sql_booking_array=sql_select($sql_booking);
		foreach($sql_booking_array as $row)
		{
			$bookking_no.=$row[csf('booking_no')].',';
		}
		$bookking_no=rtrim($bookking_no,',');
		$bookking_no=implode(",",array_unique(explode(",",$bookking_no)));
		// $sql_c="select id, company_id, cost_head, exchange_rate, incurred_date, incurred_date_to, applying_period_date, applying_period_to_date, based_on, po_id, job_no, gmts_item_id, item_smv, production_qty, smv_produced, amount, amount_usd from wo_actual_cost_entry where po_id in(".implode(",",$poIdArr).")";
		$sql_c="select b.id, b.company_id, b.cost_head, b.exchange_rate,b.incurred_date, b.incurred_date_to, b.applying_period_date, b.applying_period_to_date, b.based_on, b.po_id, b.job_no, b.gmts_item_id, b.item_smv, b.production_qty, b.smv_produced, b.amount, b.amount_usd from wo_actual_cost_entry b,gbl_temp_engine g where  b.po_id=g.ref_val  and g.user_id = ".$user_id." and g.ref_from=1 and g.entry_form=18  ";
		$data_array=sql_select($sql_c);
		foreach($data_array as $row){
			if($row[csf('cost_head')]==2){
				$otherData['acl']['freight']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==1){
				$otherData['acl']['lab_test']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==3){
				$otherData['acl']['inspection']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==4){
				$otherData['acl']['currier_pre_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==5){
				//$otherData['acl']['cm_cost']['amount']+=$row[csf('amount_usd')];
			}
			if($row[csf('cost_head')]==6){
				$commaData['acl']['amount']+=$row[csf('amount_usd')];
			}
		}
		//echo '<pre>';print_r($otherData);
		// Other Cost End ============================
		$con = connect();
		execute_query("DELETE FROM GBL_TEMP_ENGINE WHERE USER_ID = ".$user_id."   and ENTRY_FORM=18");
		oci_commit($con);
		disconnect($con);

		ob_start();
		?>
		<div style="width:1302px; margin:0 auto">
			<div style="width:1300px; font-size:20px; font-weight:bold" align="center"><? echo $company_arr[str_replace("'","",$company_name)]; ?></div>
			<div style="width:1300px; font-size:14px; font-weight:bold" align="center">Style wise Cost Comparison</div>
			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1300px" rules="all">
				<tr>
					<td width="100">Job Number</td>
					<td width="200"><? echo $jobNumber; ?></td>
					<td width="100">Buyer</td>
					<td width="200"><? echo $buyer_arr[$buyerName]; ?></td>
                    <td width="100">Internal Ref. No</td>
					<td width="100"><? $ref_nos=rtrim($ref_no,',');echo implode(",",array_unique(explode(",",$ref_nos))); ?></td>
					<td width="100">Style Ref. No</td>
					<td width="200"><? echo $styleRefno; ?></td>
					<td width="100">Job Qty</td>
					<td align="right"><? echo $jobQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Order Number</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$poNumberArr); ?></td>
					<td>Total Value</td>
					<td align="right"><? echo fn_number_format($jobValue,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Ship Date</td>
					<td style="word-break:break-all;"><? echo implode(",",$ShipDateArr); ?></td>
					<td>Team Leader</td>
                    <td style="word-break:break-all;"><? echo $team_leaders;?></td>
					<td>Dealing Marchant</td>
                    <td style="word-break:break-all;"><? echo $dealing_marchants;?></td>
					<td>Booking No</td>
                    <td style="word-break:break-all;"><? echo $bookking_no;?></td>
					<td>Unit Price</td>
					<td align="right"><? echo fn_number_format($unitPrice,4)." ".$currency[$currencyId]; ?></td>
				</tr>
				<tr>
					<td>Garments Item</td>
					<td colspan="7" style="word-break:break-all;"><? echo implode(",",$gmtsItemArr); ?></td>
					<td>Ship Qty</td>
					<td align="right"><? echo $exfactoryQty." Pcs"//.$unit_of_measurement[$uom]; ?></td>
				</tr>
				<tr>
					<td>Shipment Value</td>
					<td align="right"><? echo fn_number_format($exfactoryValue,4); ?></td>
					<td>Short/Excess Qty</td>
					<td align="right"><? echo $shortExcessQty." Pcs"//.$unit_of_measurement[$uom];; ?></td>
					<td>Short/Excess Value</td>
					<td align="right" colspan="2"><? echo fn_number_format($shortExcessValue,4); ?></td>
					<td>Ship. Status</td>
					<td><? echo $shipment_status[$shipingStatus]; ?></td>
				</tr>

			</table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1100px; margin-top:10px; float: left" rules="all">
				<thead>
					<tr align="center" style="font-weight:bold">
						<td width="300">Item Description</td>
						<td width="30">UOM</td>
						<!-- <td width="80">Marketing Qty</td>
						<td width="80">Marketing Value</td> -->
						<td width="80">Pre-Cost Qty</td>
						<td width="80">Pre-Cost Price</td>
						<td width="80">Pre-Cost Value</td>
						<td width="80">Cont. % On FOB Value</td>
						<td width="80">Actual Qty</td>
						<td width="80">Actual Price</td>
						<td width="80">Actual Value</td>
						<td width="80">Cont. % On FOB Value</td>
					</tr>
				</thead>
				<tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="including yarn dyed">Yarn Cost<br>Grey Yarn</td>

				</tr>
				<?
				$GrandTotalMktValue=0; $GrandTotalPreValue=0; $GrandTotalAclValue=0; $yarnTrimMktValue=0; $yarnTrimPreValue=0; $yarnTrimAclValue=0; $totalMktValue=0; $totalPreValue=0; $totalAclValue=0; $totalMktQty=0; $totalPreQty=0; $totalAclQty=0;
				$y=1;
				foreach($YarnData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					if($row['preCost']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['acl']['qty']>0)
					{
						$item_descrition =$lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition ?></td>
						<td width="60">Kg</td>
						<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['mkt']['amount']>0) echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4);else echo " "; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				foreach($qYarnData as $index=>$row ){

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="QC"><?=$index; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo " "; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}

				?>
                <tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="yarn dyed">Dyed Yarn Cost</td>
				</tr>
                <?
				$z=1;$yarn_recv_check_array=array();
				foreach($conv_yarn_arr as $index=>$row )
				{
					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");

					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");

					//$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");
					if (!in_array($jobNumber,$yarn_recv_check_array))
					{
						$z++;
						$yarn_recv_check_array[]=$jobNumber;
						$yarn_acl_qty=$row['acl']['qty'];
					}
					else $yarn_acl_qty=0;
					?>

				    <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="Yarn Dyeing"><? echo $index ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']>0) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right" title="yarn Recv Actual"><? echo fn_number_format($yarn_acl_qty,4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				foreach($dried_yarn_data_arr as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['preCost']['qty']>0)
					{
						$item_descrition =$index;
					}

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['preCost']['amount']) echo fn_number_format($row['preCost']['amount']/$row['preCost']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['preCost']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['preCost']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				//Dyed End
				?>

                 <tr style="font-weight:bold" class="yarn">
					<td colspan="10" title="yarn dyed">Service Yarn Cost</td>
				</tr>
                <?
                  foreach($SYarnData as $index=>$row ){

					$des=explode("_",str_replace("'","",$index));
					if($row['acl']['qty']>0)
					{
						$item_descrition = $lib_yarn_count[$des[0]]." ".$composition[$des[1]]." ".$des[2]."% ".$yarn_type[$des[3]];
					}
					if($row['pre']['qty']>0)
					{
						$item_descrition =$index;
					}
					//$item_descrition =$index;

					$totalMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalPreValue+=fn_number_format($row['preCost']['amount'],4,".","");
					$totalAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalPreQty+=fn_number_format($row['preCost']['qty'],4,".","");
					$totalAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					if($y%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="yarn" bgcolor="<? echo $bgcolor;?>" onClick="change_color('tryarn_<? echo $y; ?>','<? echo $bgcolor;?>')" id="tryarn_<? echo $y; ?>">
						<td width="300" title="<?=$index; ?>"><?=$item_descrition; ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? if($row['pre']['amount']>0) echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4);else echo ""; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? if ($row['acl']['amount']) echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); else echo ''; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$y++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="yarntotal" class="adl-signs" onClick="yarnT(this.id,'.yarn')">+</span>&nbsp;&nbsp;Yarn Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right"><? echo fn_number_format($totalMktQty,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($totalMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalMktValue,4,".","");
						?>
					</td> -->
					<td width="80" align="right"><? echo fn_number_format($totalPreQty,4); ?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalPreValue>$totalMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right">
						<A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','1')"><? echo fn_number_format($totalAclQty,4); ?></A>
					</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalAclValue>$totalPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalAclValue,4);
						$yarnTrimAclValue+=fn_number_format($totalAclValue,4,".","");
						$GrandTotalAclValue+=fn_number_format($totalAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				 <?
				  $fab_bgcolor1="#E9F3FF"; $fab_bgcolor2="#FFFFFF";
				  $f=1;
				?>
				<tr class="fbpur" bgcolor="<? echo $fab_bgcolor1;?>" onClick="change_color('trfab_<? echo $f; ?>','<? echo $fab_bgcolor1;?>')" id="trfab_<? echo $f; ?>">
					<td width="300" >Fabric Purchase Cost (Knit)</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><?// echo fn_number_format($fabPurArr['mkt']['knit']['amount']/$fabPurArr['mkt']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['knit']['amount'],4); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount']/$fabPurArr['pre']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount']/$fabPurArr['acl']['knit']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['knit']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['knit']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<?
				  $f1=2;
				?>
				 <tr class="fbpur" bgcolor="<? echo $fab_bgcolor2;?>" onClick="change_color('trfab_<? echo $f1; ?>','<? echo $fab_bgcolor2;?>')" id="trfab_<? echo $f1; ?>">
					<td width="300" >Fabric Purchase Cost (Woven)</td>
					<td width="30">Yds</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['woven']['amount']/$fabPurArr['mkt']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($fabPurArr['mkt']['woven']['amount'],4); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount']/$fabPurArr['pre']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['pre']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['pre']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['qty'],4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount']/$fabPurArr['acl']['woven']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($fabPurArr['acl']['woven']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurArr['acl']['woven']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="fbpurtotal"  class="adl-signs" onClick="yarnT(this.id,'.fbpur')">+</span>&nbsp;&nbsp;Fabric Purchase Cost Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<?
						$fabPurMkt= fn_number_format($fabPurArr['mkt']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['mkt']['knit']['amount'],4,".","");
						echo fn_number_format($fabPurMkt,4);
						$GrandTotalMktValue+=fn_number_format($fabPurMkt,4,".","");
						$fabPurPre= fn_number_format($fabPurArr['pre']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['pre']['knit']['amount'],4,".","");
						$fabPurAcl= fn_number_format($fabPurArr['acl']['woven']['amount'],4,".","")+fn_number_format($fabPurArr['acl']['knit']['amount'],4,".","");
						?>
					</td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($fabPurPre>$fabPurMkt){echo "yellow";} else{echo "";}?>">
						<? echo  fn_number_format($fabPurPre,4);
						$GrandTotalPreValue+=fn_number_format($fabPurPre,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurPre*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($fabPurAcl>$fabPurPre){echo "red";} else{echo "";}?>">
						<?
						echo  fn_number_format($fabPurAcl,4);
						$GrandTotalAclValue+=fn_number_format($fabPurAcl,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($fabPurAcl*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold" class="knit">
					<td colspan="10">Knitting Cost</td>
				</tr>
				<?
				$totalKniMktValue=0; $totalKnitPreValue=0; $totalKnitAclValue=0; $totalKniMktQty=0; $totalKnitPreQty=0; $totalKnitAclQty=0;
				$k=1;
				foreach($knitData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalKniMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalKnitPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalKnitAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalKniMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalKnitPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalKnitAclQty+=fn_number_format($row['acl']['qty'],4,".","");
				 if($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					 <tr class="knit" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trknit_<? echo $k; ?>','<? echo $bgcolor;?>')" id="trknit_<? echo $k; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['rate'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$k++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="knittotal"  class="adl-signs" onClick="yarnT(this.id,'.knit')">+</span>&nbsp;&nbsp;Kniting Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($totalKniMktQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? //echo fn_number_format($totalKniMktValue,4); $GrandTotalMktValue+=fn_number_format($totalKniMktValue,4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($totalKnitPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalKnitPreValue>$totalKniMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalKnitPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalKnitAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalKnitAclValue>$totalKnitPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalKnitAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalKnitAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalKnitAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold" class="dyfi">
					<td colspan="10">Dye & Fin  Cost</td>
				</tr>
				<?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$d=1;
				foreach($finishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$process_names='';
					if ($row['pre']['qty'] != 0){
						$process_names="(".rtrim($row['pre']['process_name'],',').")";
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="dyfi" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trdye_<? echo $d; ?>','<? echo $bgcolor;?>')" id="trdye_<? echo $d; ?>">
						<td width="300"><? echo $item_descrition.' '.$process_names; ?></td>
						<td width="30">Kg</td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['rate'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$d++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="dyfitotal"  class="adl-signs" onClick="yarnT(this.id,'.dyfi')">+</span>&nbsp;&nbspDyeing, Finish  Cost Total</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($totalFinMktQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? //echo fn_number_format($totalFinMktValue,4); $GrandTotalMktValue+=fn_number_format($totalFinMktValue,4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
                <tr style="font-weight:bold" class="aop">
					<td colspan="10">AOP Cost</td>
				</tr>
                <?
				$totalFinMktValue=0; $totalFinPreValue=0; $totalFinAclValue=0; $totalFinMktQty=0; $totalFinPreQty=0; $totalFinAclQty=0;
				$a=1;
				foreach($AopfinishData as $index=>$row ){
					$des=explode("_",str_replace("'","",$index));
					$item_descrition = $body_part[$des[0]]." ".$color_type[$des[1]]." ".$des[2]." ".$yarn_type[$des[3]];
					if(!trim($item_descrition)){
						$item_descrition=$index;
					}
					$totalFinMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
					$totalFinPreValue+=fn_number_format($row['pre']['amount'],4,".","");
					$totalFinAclValue+=fn_number_format($row['acl']['amount'],4,".","");

					$totalFinMktQty+=fn_number_format($row['mkt']['qty'],4,".","");
					$totalFinPreQty+=fn_number_format($row['pre']['qty'],4,".","");
					$totalFinAclQty+=fn_number_format($row['acl']['qty'],4,".","");
					  if($a%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					?>
					<tr class="aop" bgcolor="<? echo $bgcolor;?>" onClick="change_color('traop_<? echo $a; ?>','<? echo $bgcolor;?>')" id="traop_<? echo $a; ?>">
						<td width="300"><? echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?
					$a++;
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" > <span id="aoptotal"  class="adl-signs" onClick="yarnT(this.id,'.aop')">+</span>&nbsp;&nbsp  AOP Cost Total</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($totalFinMktQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? //echo fn_number_format($totalFinMktValue,4); $GrandTotalMktValue+=fn_number_format($totalFinMktValue,4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($totalFinPreQty,4);?></td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor="<? if($totalFinPreValue>$totalFinMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinPreValue,4);
						$GrandTotalPreValue+=fn_number_format($totalFinPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($totalFinAclQty,4);?></td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalFinAclValue>$totalFinPreValue){echo "red";} else{echo "";}?>">
						<?
						echo fn_number_format($totalFinAclValue,4);
						$GrandTotalAclValue+=fn_number_format($totalFinAclValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalFinAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>

				<tr style="font-weight:bold;background-color:#CCC;display:none">
					<td width="300" >&nbsp;&nbsp;&nbsp;AOP & Others Cost</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right"><? echo fn_number_format($aopData['mkt']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['mkt']['amount']/$aopData['mkt']['qty'],4)?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['mkt']['amount'],4); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['pre']['amount']/$aopData['pre']['qty'],4)?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aopData['pre']['amount'],4,".","")>fn_number_format($aopData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($aopData['pre']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($aopData['acl']['amount']/$aopData['acl']['qty'],4)?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aopData['acl']['amount'],4,".","")>fn_number_format($aopData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aopData['acl']['amount'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aopData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>

				 <tr style="font-weight:bold" class="transc">
					<td colspan="10">Transfer Cost</td>
				</tr>
			  <?

				  $trans_bgcolor1="#E9F3FF"; $trans_bgcolor2="#FFFFFF";
				  $tt=1;
				?>
				 <tr class="transc" bgcolor="<? echo $trans_bgcolor1;?>" onClick="change_color('trtrans_<? echo $tt; ?>','<? echo $trans_bgcolor1;?>')" id="trtrans_<? echo $tt; ?>">
						<td width="300">Grey Fabric Cost<? //echo $item_descrition ?></td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format($row['pre']['amount'],4); ?></td>
						<td width="80" align="right">&nbsp;<? //echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
						<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($gray_transfer_amount/$grey_fab_trans_qty_acl,4); ?></td>
						<td width="80" title="Transfer Qty*Avg Yarn Rate + Transfer Qty*Avg Knitting Charge" align="right"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','2')"><? echo fn_number_format($gray_transfer_amount,4); ?></A>&nbsp;<? //echo fn_number_format($tot_grey_fab_cost_acl,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($gray_transfer_amount*100/$jobValue),2).'%'; ?></td>
					</tr>
				<?
				 $tt2=1;
				?>
				<tr class="transc" bgcolor="<? echo $trans_bgcolor2;?>" onClick="change_color('trtrans2_<? echo $tt2; ?>','<? echo $trans_bgcolor2;?>')" id="trtrans2_<? echo $tt2; ?>">
						<td width="300">Finished Fabric Cost</td>
						<td width="30">Kg</td>
						<!-- <td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td> -->
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"></td>
						<td width="80" align="right"><? echo fn_number_format($tot_fin_fab_transfer_qty,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format($finish_transfer_amount/$tot_fin_fab_transfer_qty,4); ?></td>
						<td width="80" align="right"  title="Transfer Qty*Avg Yarn Rate + Transfer Qty*Avg Knitting Charge + Transfer Qty*Avg Finishing Charge"><A href='##' onClick="openmypage_issue('<? echo implode("_",array_keys($poNumberArr)); ?>','3')"><? echo fn_number_format($finish_transfer_amount,4); ?></A><? //echo fn_number_format($tot_fin_fab_transfer_cost,4); ?></td>
						<td width="80" align="right"><? echo fn_number_format(($finish_transfer_amount*100/$jobValue),2).'%'; ?></td>
					</tr>
					<?

				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" ><span id="transtotal"  class="adl-signs" onClick="yarnT(this.id,'.transc')">+</span>&nbsp;&nbsp;Transfer Cost Total</td>
					<td width="30">Kg</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($grey_fab_trans_qty_acl+$tot_fin_fab_transfer_qty,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($gray_transfer_amount/$grey_fab_trans_qty_acl)+($finish_transfer_amount/$tot_fin_fab_transfer_qty),4);//echo fn_number_format(($tot_fin_fab_transfer_cost+$tot_grey_fab_cost_acl)/($tot_fin_fab_transfer_qty+$grey_fab_trans_qty_acl),4);?></td>
					<td width="80" align="right">
						<?
						echo fn_number_format($gray_transfer_amount+$finish_transfer_amount,4);
						$total_grey_fin_fab_transfer_actl_cost=$gray_transfer_amount+$finish_transfer_amount;
						$GrandTotalAclValue+=fn_number_format($total_grey_fin_fab_transfer_actl_cost,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format((($gray_transfer_amount+$finish_transfer_amount)*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr>
					<td colspan="10" style="font-weight:bold" class="trims">Trims Cost</td>
				</tr>
				<?
				$t=1; $totalTrimMktValue=0; $totalTrimPreValue=0; $totalTrimAclValue=0;
				foreach($trimData as $index=>$row ){
					if($index>0)
					{
						$item_descrition = $trim_groupArr[$index]['item_name'].' '.$row['item_description'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'],4); ?></td>
							<td width="80" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['acl']['amount']*100/$jobValue),2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				//print_r($trimData_new);
				foreach($trimData_new as $index=>$row ){
					if($index!="")
					{
						$explode=explode("***", $index);
						$item_group_ids=$explode[1];
						$item_descrition = $trim_groupArr[$item_group_ids]['item_name'].' '.$row['item_description'];
						$totalTrimMktValue+=fn_number_format($row['mkt']['amount'],4,".","");
						$totalTrimPreValue+=fn_number_format($row['pre']['amount'],4,".","");
						$totalTrimAclValue+=fn_number_format($row['acl']['amount'],4,".","");
						if($t%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr class="trims" bgcolor="<? echo $bgcolor;?>" onClick="change_color('trtrims_<? echo $t; ?>','<? echo $bgcolor;?>')" id="trtrims_<? echo $t; ?>">
							<td width="300"><? echo $item_descrition ?></td>
							<td width="30"><? echo $unit_of_measurement[$row['cons_uom']];?></td>
							<!-- <td width="80" align="right"><? echo fn_number_format($row['mkt']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount']/$row['mkt']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['mkt']['amount'],4); ?></td> -->
							<td width="80" align="right"><? echo fn_number_format($row['pre']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['pre']['amount']/$row['pre']['qty'] ,4); ?></td>
							<td width="80" align="right"  bgcolor=" <? if(fn_number_format($row['pre']['amount'],4,'.','')>fn_number_format($row['mkt']['amount'],4,'.','')){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($row['pre']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format(($row['pre']['amount']*100/$jobValue),2).'%'; ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['qty'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']/$row['acl']['qty'],4); ?></td>
							<td width="80" align="right" title="<? echo 'Act='.$row['acl']['amount'].', Pre='.$row['pre']['amount'];?>" bgcolor=" <? if(fn_number_format($row['acl']['amount'],4,".","")>fn_number_format($row['pre']['amount'],4,".","")){echo "red";}  else{echo " ";}?>"><? echo fn_number_format($row['acl']['amount'],4); ?></td>
							<td width="80" align="right"><? echo fn_number_format($row['acl']['amount']*100/$jobValue,2).'%'; ?></td>
						</tr>
						<?
						$t++;
					}
				}
				?>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300"><span id="trimstotal" class="adl-signs" onClick="yarnT(this.id,'.trims')">+</span>&nbsp;&nbsp;Trims Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">
						<?
						echo fn_number_format($totalTrimMktValue,4);
						$yarnTrimMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						$GrandTotalMktValue+=fn_number_format($totalTrimMktValue,4,".","");
						?>
					</td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalTrimPreValue>$totalTrimMktValue){echo "yellow";} else{echo "";}?>">
						<?
						echo fn_number_format($totalTrimPreValue,4);
						$yarnTrimPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						$GrandTotalPreValue+=fn_number_format($totalTrimPreValue,4,".","");
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>

					<?php
						//$sqlResult= sql_select("select category,over_rcv_status,over_rcv_percent,over_rcv_payment from variable_inv_ile_standard where company_name='$company_name' and variable_list=23 and category=4 order by id");


					 ?>

					<td width="80" align="right" bgcolor=" <? if(fn_number_format($totalTrimPreValue,4,".","")>fn_number_format($totalTrimMktValue,4,".","")){echo "yellow";} else{echo "";}?>">
						<?
						//if($sqlResult[0][csf('over_rcv_payment')]==1){

							echo fn_number_format($totalTrimAclValue,4);
							$yarnTrimAclValue+=fn_number_format($totalTrimAclValue,4,".","");
							$GrandTotalAclValue+=fn_number_format($totalTrimAclValue,4,".","");
						//}
						?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalTrimAclValue*100/$jobValue),2).'%'; ?></td>


				</tr>
				<?
				$totalOtherMktValue=0; $totalOtherPreValue=0; $totalOtherAclValue=0;
				$other_bgcolor="#E9F3FF"; $emb_bgcolor2="#FFFFFF";
				$embl=1;$w=1;$comi=1;$comm=1;$fc=1;$tc=1;
				?>
				 <tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('emblish_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="emblish_<? echo $embl; ?>">
					<td width="300" >Embellishment Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($embData['pre']['amount'],4,".","")>fn_number_format($embData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($embData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($embData['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($embData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($embData['acl']['qty'],4); ?></td>

					<td width="80" align="right"><? echo fn_number_format($embData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($embData['acl']['amount'],4,".","")>fn_number_format($embData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($embData['acl']['amount'],4); $totalOtherAclValue+=fn_number_format($embData['acl']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($embData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('wash_<? echo $w; ?>','<? echo $other_bgcolor;?>')" id="wash_<? echo $w; ?>">
					<td width="300" >Wash Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['pre']['amount']/$embData['pre']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($washData['pre']['amount'],4,".","")>fn_number_format($washData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($washData['pre']['amount'],4);$totalOtherPreValue+=fn_number_format($washData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['qty'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($washData['acl']['amount']/$embData['acl']['qty'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($washData['acl']['amount'],4,".","")>fn_number_format($washData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($washData['acl']['amount'],4);$totalOtherAclValue+=fn_number_format($washData['acl']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($washData['acl']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commi_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commi_<? echo $embl; ?>">
					<td width="300" >Commission Cost</td>
					<td width="30"><? echo $costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commiData['pre']['rate'],4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($commiData['pre']['amount'],4,".","")>fn_number_format($commiData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commiData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commiData['pre']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($commiData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; ?></td>
					<td width="80" align="right"><? $aclCommiAmt=($commiData['pre']['rate'])*$exfactoryQty; echo fn_number_format($aclCommiAmt/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($aclCommiAmt,4,".","")>fn_number_format($commiData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($aclCommiAmt,4); $totalOtherAclValue+=$aclCommiAmt; ?></td>
					<td width="80" align="right"><? echo fn_number_format(($aclCommiAmt*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('commer_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="commer_<? echo $embl; ?>">
					<td width="300" >Commercial Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($commaData['pre']['amount']/$commaData['pre']['qty'],4);  ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($commaData['pre']['amount'],4,".","")>fn_number_format($commaData['mkt']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($commaData['pre']['amount'],4); $totalOtherPreValue+=fn_number_format($commaData['pre']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($commaData['pre']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; $commer_act_cost=($unitPrice*$exfactoryQty)*(0.5/100); ?></td>
					<td width="80" align="right"><? echo  fn_number_format($commer_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)"  bgcolor="<? if(fn_number_format($exfactoryQty*$unitPrice)>fn_number_format($commaData['pre']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? //($exfactoryQty*$commaData['pre']['rate'])*80/100; $unitPrice
					echo fn_number_format($commer_act_cost,4);//fn_number_format($exfactoryQty*$commaData['pre']['rate'],4);
					 $totalOtherAclValue+=fn_number_format($commer_act_cost,4,".","");?></td>
					 <td width="80" align="right"><? echo fn_number_format(($commer_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trfc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trfc_<? echo $embl; ?>">
					<td width="300" >Freight Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<!-- <td width="80" align="right"><? echo fn_number_format($otherData['mkt']['freight']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['mkt']['freight']['rate'],4); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['mkt']['freight']['amount'],4); $totalOtherMktValue+=fn_number_format($otherData['mkt']['freight']['amount'],4,".","");?></td> -->
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['freight']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['freight']['amount'],4,".","")>fn_number_format($otherData['mkt']['freight']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['freight']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['freight']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['freight']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['freight']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($otherData['acl']['freight']['amount'],4,".","")>fn_number_format($otherData['pre']['freight']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['freight']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['freight']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['freight']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trtc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trtc_<? echo $embl; ?>">
					<td width="300" >Testing Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['lab_test']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")>fn_number_format($otherData['mkt']['lab_test']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['lab_test']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['lab_test']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['lab_test']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><?
					$test_act_cost=$unitPrice*$exfactoryQty*(0.5/100);
					echo fn_number_format($test_act_cost/$exfactoryQty,4); ?></td>
					<td width="80" align="right" title="Unit Price*Ex Fact Qty*(0.5/100)" bgcolor="<? if(fn_number_format($test_act_cost,4,".","")>fn_number_format($otherData['pre']['lab_test']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($test_act_cost,4); $totalOtherAclValue+=fn_number_format($test_act_cost,4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($test_act_cost*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('tric_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="tric_<? echo $embl; ?>">
					<td width="300" >Inspection Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<!-- <td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['qty'],0); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['rate'],4); ?></td>
					<td width="80" align="right"><? //echo fn_number_format($otherData['mkt']['inspection']['amount'],4);$totalOtherMktValue+=fn_number_format($otherData['mkt']['inspection']['amount'],4,".",""); ?></td> -->
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['inspection']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['inspection']['amount'],4,".","")>fn_number_format($otherData['mkt']['inspection']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['inspection']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['inspection']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['acl']['inspection']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['inspection']['amount'],4,".","")>fn_number_format($otherData['pre']['inspection']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['inspection']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['inspection']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['inspection']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trcc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trcc_<? echo $embl; ?>">
					<td width="300" >Courier Cost</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['rate'],4); ?></td>
					<td width="80" align="right"  bgcolor="<? if(fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['currier_pre_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4);$totalOtherPreValue+=fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".",""); ?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right"><?
					//$courier_cost_act=$otherData['pre']['currier_pre_cost']['rate']*$exfactoryQty*(80/100);
					echo fn_number_format($otherData['acl']['currier_pre_cost']['amount']/$exfactoryQty,4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['currier_pre_cost']['amount'],4,".","")){echo "red";}else{ echo "";} ?>"><? echo fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".",""); $totalOtherAclValue+=fn_number_format($otherData['acl']['currier_pre_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['acl']['currier_pre_cost']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trmc_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trmc_<? echo $embl; ?>">
					<td width="300" >Making Cost (CM)</td>
					<td width="30"><? echo 'Pcs';//$costPerUom; ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['qty'],0); ?></td>
					<td width="80" align="right"><? echo fn_number_format($otherData['pre']['cm_cost']['rate'],4); ?></td>
					<td width="80" align="right" bgcolor="<? if(fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['mkt']['cm_cost']['amount'],4,".","")){echo "yellow";}else{ echo "";} ?>"><? echo fn_number_format($otherData['pre']['cm_cost']['amount'],4); $totalOtherPreValue+=fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","");?></td>
					<td width="80" align="right"><? echo fn_number_format(($otherData['pre']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>
					<?
					if(fn_number_format($otherData['acl']['cm_cost']['amount'],4,".","")>fn_number_format($otherData['pre']['cm_cost']['amount'],4,".","")) $font_color="white";
					else $font_color="black";
					?>
					<td width="80" align="right" title="From Actual Cost Entry Quantity"><? echo fn_number_format($otherCmData['acl']['cm_cost']['qty'],0); ?></td>
					<td width="80" align="right" title="Amount/Rate"><? echo fn_number_format($otherCmData['acl']['cm_cost']['rate'],0); ?></td>
					<td width="80" align="right" title="From Actual Cost Entry Amount"><? echo fn_number_format($otherCmData['acl']['cm_cost']['amount'],0); ?></td>
					<td width="80" align="right" title="Amount*100/total Job"><? echo fn_number_format(($otherCmData['acl']['cm_cost']['amount']*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#CCC">
					<td width="300" >Others Total</td>
					<td width="30">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalOtherPreValue>$totalOtherMktValue){echo "yellow";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherPreValue,4); $GrandTotalPreValue+=fn_number_format($totalOtherPreValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($totalOtherAclValue>$totalOtherPreValue){echo "red";} else{echo "";}?>">
						<? echo fn_number_format($totalOtherAclValue,4); $GrandTotalAclValue+=fn_number_format($totalOtherAclValue,4,".",""); ?>
					</td>
					<td width="80" align="right"><? echo fn_number_format(($totalOtherAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr style="font-weight:bold;background-color:#C60">
					<td width="300" >Grand Total</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td> -->
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($GrandTotalPreValue>$GrandTotalMktValue){echo "yellow";} else{echo "";}?>"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalPreValue*100/$jobValue),2).'%'; ?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right" bgcolor=" <? if($GrandTotalAclValue>$GrandTotalPreValue){echo "red";} else{echo "";}?>"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="80" align="right"><? echo fn_number_format(($GrandTotalAclValue*100/$jobValue),2).'%'; ?></td>
				</tr>
				<tr  bgcolor="<? echo $other_bgcolor;?>" onClick="change_color('trsv_<? echo $embl; ?>','<? echo $other_bgcolor;?>')" id="trsv_<? echo $embl; ?>">
					<td width="300" >Shipment Value</td>
					<td width="30">&nbsp;</td>
					<!-- <td width="80" align="right"><? echo $quaOfferQnty; ?></td>
					<td width="80" align="right" title="<? echo $quaPriceWithCommnPcs;?>"><? echo fn_number_format($quaPriceWithCommnPcs,4) ?></td>
					<td width="80" align="right"><? $quaOfferValue=$quaOfferQnty*$quaPriceWithCommnPcs; echo fn_number_format($quaOfferValue,4) ?></td> -->
					<td width="80" align="right"><? echo $jobQty ?></td>
					<td width="80" align="right" title="<? echo $unitPrice;?>"><? echo fn_number_format($unitPrice,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($jobValue*100/$jobValue),2).'%'; ?></td>
					<td width="80" align="right"><? echo $exfactoryQty ?></td>
					<td width="80" align="right" title="<? echo $exfactoryValue/$exfactoryQty;?>"><? echo fn_number_format($exfactoryValue/$exfactoryQty,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="80" align="right"><? echo fn_number_format(($exfactoryValue*100/$jobValue),2).'%'; ?></td>
				</tr>
			</table>
			<table style="width:120px;float: left; margin-left: 5px; margin-top: 10px;">
				<tr>
					<td width="120">
                    <?
                    $nameArray_img =sql_select("SELECT image_location FROM common_photo_library where master_tble_id in('$jobNumber') and form_name='knit_order_entry' and file_type=1");
					if(count( $nameArray_img)>0)
					{
					    ?>
						    <div style="float:left;width:120px" >
							<?
							foreach($nameArray_img AS $inf) {
								?>
								<img  src='../../../<? echo $inf[csf("image_location")]; ?>' height='75' width='95' />
							    <?
							}
							?>
							</div>
						<?
					}
					else echo ""; ?>
                    </td>
				</tr>
            </table>

			<table class="rpt_table" border="1" cellpadding="2" cellspacing="2" style="width:1200px; margin-top:5px;" rules="all">
				<tr><td colspan="8"><p style="font-weight: bold;">Profit Summary</p></td></tr>
				<tr align="center" style="font-weight:bold">
					<td width="200" >Type</td>
					<td width="160">Total P.O/Ex-Fact. Value</td>
					<td width="150">Total Expenditure</td>
					<td width="100">Expend %</td>
					<td width="150">Yarn & Trims</td>
					<td width="100">Yarn & Trims %</td>
					<td width="200">Profit Margin</td>
					<td width="100">Profit Margin %</td>
				</tr>
				<!-- <tr>
					<td width="200" >Marketing Cost</td>
					<td width="160" align="right"><? echo fn_number_format($quaOfferValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimMktValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimMktValue/$quaOfferValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($quaOfferValue-$GrandTotalMktValue,4); ?></td>
					<td width="100" align="right"><? echo fn_number_format((($quaOfferValue-$GrandTotalMktValue)/$quaOfferValue)*100,4); ?></td>
				</tr> -->
				<tr>
					<td width="200" >Pre Costing</td>
					<td width="160" align="right"><? echo fn_number_format($jobValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalPreValue/$jobValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimPreValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimPreValue/$jobValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($jobValue-$GrandTotalPreValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($jobValue-$GrandTotalPreValue)/$jobValue)*100,4);?></td>
				</tr>
				<tr>
					<td width="200" >Actual Costing</td>
					<td width="160" align="right"><? echo fn_number_format($exfactoryValue,4) ?></td>
					<td width="150" align="right"><? echo fn_number_format($GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format(($GrandTotalAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="150" align="right"><? echo fn_number_format($yarnTrimAclValue,4) ?></td>
					<td width="100" align="right"><? echo fn_number_format(($yarnTrimAclValue/$exfactoryValue)*100,4); ?></td>
					<td width="200" align="right"><? echo fn_number_format($exfactoryValue-$GrandTotalAclValue,4);?></td>
					<td width="100" align="right"><? echo fn_number_format((($exfactoryValue-$GrandTotalAclValue)/$exfactoryValue)*100,4);?></td>
				</tr>
			</table>
		</div>
		<?
	}


	/*foreach (glob("../../../../ext_resource/tmp_report/$user_name*.xls") as $filename){
		if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
	}

	$html=ob_get_contents();
	$name=time();
	$filename="../../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,$html);
	$filename="../../../../ext_resource/tmp_report/".$user_name."_".$name.".xls";
	echo "$total_data****$filename";*/
	$html = ob_get_contents();
    ob_clean();
    foreach (glob("*.xls") as $filename) {
    @unlink($filename);
    }
    //---------end------------//
    $name=time();
    $filename=$user_name."_".$name.".xls";
    $create_new_doc = fopen($filename, 'w');
    $is_created = fwrite($create_new_doc, $html);
    echo "$html****$filename";

	exit();
}

if($action=="batch_cost_dtls_popup") //
{
	echo load_html_head_contents("Batch Details", "../../../../", 1, 1,$unicode,'','');
	extract($_REQUEST);
	//echo $batch_id;die;
	//$batch_non_redyeing_id=return_field_value("id","pro_batch_create_mst","batch_against<>2 and status_active=1 and id in($batch_id)","id");
	//if($batch_non_redyeing_id=="")die;

	//if($batch_id!="") $batch_cond=" and a.batch_no like '$batch_non_redyeing_id'";
	//==========******************Batch Costing********************===========
		$batch_poid_cond=where_con_using_array($poIdArr,0,"b.po_id");
		$sql_batch=sql_select("select b.mst_id as batch_id, a.batch_no from pro_batch_create_dtls b,pro_batch_create_mst a where   a.id=b.mst_id and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and b.mst_id in($batch_id)");
	//	echo "select b.mst_id as batch_id, a.batch_no from pro_batch_create_dtls b,pro_batch_create_mst a where   a.id=b.mst_id and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and b.mst_id in($batch_id)";
		//echo "select mst_id as batch_id from pro_batch_create_dtls  where   status_active=1 and is_deleted=0 $batch_poid_cond";

		foreach($sql_batch as $row)
		{
			$batch_idArr[$row[csf('batch_id')]]=$row[csf('batch_id')];
			$batch_noArr[$row[csf('batch_id')]]=$row[csf('batch_no')];
		}
		$batch_id_cond=where_con_using_array($batch_idArr,0,"a.batch_id");
		$sql_req = "SELECT a.ID,b.mst_id as REQ_ID,a.batch_id as BATCH_ID,a.BATCH_QTY,a.NEW_BATCH_WEIGHT,a.ENTRY_FORM,c.batch_id as RE_BATCH_ID from pro_recipe_entry_mst a, dyes_chem_requ_recipe_att b,dyes_chem_issue_requ_mst c where b.recipe_id=a.id  and c.id=b.mst_id $batch_id_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 ";
	//  echo $sql_req;die;
	$result_req = sql_select($sql_req);
	foreach($result_req as $val)
	{
		$req_id_array[$val['REQ_ID']] = $val['REQ_ID'];
	}
	if(count($req_id_array))
	{
		$requisition_id_cond=where_con_using_array($req_id_array,0,"a.requisition_no");
	}
	$issue_sql = sql_select("SELECT a.MST_ID ,a.REQUISITION_NO,b.BATCH_NO,a.ITEM_CATEGORY,a.PROD_ID,a.CONS_QUANTITY,a.CONS_AMOUNT,c.PRODUCT_NAME_DETAILS,c.UNIT_OF_MEASURE from inv_transaction a,inv_issue_master b,product_details_master c where a.mst_id=b.id and c.id=a.prod_id and b.entry_form=5 and b.is_deleted=0 and b.status_active=1 and a.status_active=1 and a.transaction_type=2 and a.item_category in (5,6,7) and b.id in($req_id)   ");


	/*
		 $sql_dyes_cost =sql_select("select a.batch_no,b.item_category,(b.cons_amount) as dyes_chemical_cost
		from inv_issue_master a, inv_transaction b
		where a.id=b.mst_id and b.transaction_type=2 and a.entry_form=5 and a.batch_no  is not null  and   b.item_category in (5,6,7) "); */
		//$dyes_chemical_arr=array();
	  $acl_dyes_chemical_cost=0;$acl_dyes_chemical_cost=0;
		foreach($issue_sql as $val)
		{ //g_exchange_rate
			$acl_dyes_chemical_cost+=$val["CONS_AMOUNT"];
			$acl_dyes_chemical_qty+=$val["CONS_QUANTITY"];
			//5 ,7 Chemical
			if($val["ITEM_CATEGORY"]==5 || $val["ITEM_CATEGORY"]==7)
			{
				$prod_wiseChemicalArr[$val["BATCH_NO"]][$val["PROD_ID"]]['qty']+=$val["CONS_QUANTITY"];
				$prod_wiseChemicalArr[$val["BATCH_NO"]][$val["PROD_ID"]]['amt']+=$val["CONS_AMOUNT"];
				$prod_wiseChemicalArr[$val["BATCH_NO"]][$val["PROD_ID"]]['desc']=$val["PRODUCT_NAME_DETAILS"];
				$prod_wiseChemicalArr[$val["BATCH_NO"]][$val["PROD_ID"]]['uom']=$val["UNIT_OF_MEASURE"];
			}
			else
			{
				$prod_wiseDyesArr[$val["BATCH_NO"]][$val["PROD_ID"]]['qty']+=$val["CONS_QUANTITY"];
				$prod_wiseDyesArr[$val["BATCH_NO"]][$val["PROD_ID"]]['amt']+=$val["CONS_AMOUNT"];
				$prod_wiseDyesArr[$val["BATCH_NO"]][$val["PROD_ID"]]['desc']=$val["PRODUCT_NAME_DETAILS"];
				$prod_wiseDyesArr[$val["BATCH_NO"]][$val["PROD_ID"]]['uom']=$val["UNIT_OF_MEASURE"];
			}
		}


	/*$sql_dtls_dyes = "select c.id as prod_id, c.product_name_details, c.unit_of_measure, c.avg_rate_per_unit, sum(b.cons_quantity) as qnty,sum(b.cons_amount) as cons_amount
	from inv_issue_master a,inv_transaction b, product_details_master c
	where a.id=b.mst_id and b.prod_id=c.id and b.transaction_type=2 and a.entry_form=5 and a.batch_no  is not null and b.item_category in (6) and b.status_active=1 $batch_cond group by c.id, c.product_name_details, c.unit_of_measure, c.avg_rate_per_unit";
	// echo $sql_dtls_dyes;die;
	$sql_result_dyes= sql_select($sql_dtls_dyes);

	$sql_dtls_chemical = "select c.id as prod_id, c.product_name_details, c.unit_of_measure, c.avg_rate_per_unit, sum(b.cons_quantity) as qnty,sum(b.cons_amount) as cons_amount
	from inv_issue_master a,inv_transaction b, product_details_master c
	where a.id=b.mst_id and b.prod_id=c.id and b.transaction_type=2 and a.entry_form=5 and a.batch_no  is not null  and b.item_category in (5,7)  and b.status_active=1 $batch_cond group by c.id, c.product_name_details, c.unit_of_measure, c.avg_rate_per_unit";
	//echo $sql_dtls;die;
	$sql_result_chemical= sql_select($sql_dtls_chemical);*/
	?>
    <script>
		function print_window()
		{
			var w = window.open("Surprise", "#");
			var d = w.document.open();
			d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTsD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
			'<html><head><link rel="stylesheet" href="../../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_div').innerHTML+'</body</html>');
			d.close();
		}
	</script>
	<div style="width:870px; margin-left:30px" id="report_div">
     <!--<div style="width:870px;" align="center"><input  type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/></div>-->
    <div style="width:870px; font-family:'Arial Narrow'; font-size:14px;"> <b>Dyes </b></div>
    <table align="center" cellspacing="0" width="870" border="1" rules="all" class="rpt_table" >
        <thead align="center">
    	   <tr>
                <th width="50">SL</th>
                <th width="100">Batch No</th>
                <th width="50">Product Id</th>
                <th width="250">Item Description</th>
                <th width="100">UOM</th>
                <th width="100">Quantity</th>
                <th width="100">Avg. Rate</th>
                <th>Amount(BDT)</th>
           </tr>
		</thead>
		<?
		$i=1;
		foreach($prod_wiseDyesArr as $batch_key=>$batchData)
		{
			foreach($batchData as $prod_key=>$row)
			{

			if ($i%2==0)
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				$usd_amount=0;
				$usd_amount=$row["amt"]/$g_exchange_rate;
			?>
			<tbody>
				<tr bgcolor="<? echo $bgcolor; ?>">
					<td align="center"><? echo $i; ?></td>
					<td align="center"><? echo $batch_noArr[$batch_key]; ?></td>
                    <td align="center"><? echo $prod_key; ?></td>
					<td><? echo $row["desc"]; ?></td>
					<td align="center"><? echo $unit_of_measurement[$row["uom"]]; ?></td>

					<td align="right"><? echo number_format($row["qty"],4,'.',''); $total_dyeing_qnty+=$row["qty"]; ?></td>
					<td align="right"><? echo number_format($row["amt"]/$row["qty"],4,'.',''); ?></td>
					<td align="right" title="TK=<?=$row["amt"];?>"><?  $usd_amount;
					echo  number_format($usd_amount,6,'.',''); $total_dyeing_amount+=$usd_amount; ?>
                    </td>
				</tr>
			</tbody>
			<?
			$i++;
			}

		}
		?>
        <tfoot>
        	<tr>
                <th colspan="5" align="right">Total:</th>
                <th align="right"><? echo number_format($total_dyeing_qnty,2,'.',''); ?></th>
                <th></th>
                <th align="right"><? echo number_format($total_dyeing_amount,2,'.',''); ?></th>
            </tr>
        </tfoot>
      </table>

      <div style="width:870px; font-family:'Arial Narrow'; font-size:14px;"><b>Chemical </b></div>
    <table align="center" cellspacing="0" width="870" border="1" rules="all" class="rpt_table" >
        <thead align="center">
    	   <tr>
                <th width="50">SL</th>
                <th width="100">Batch No</th>
                <th width="50">Product Id</th>
                <th width="250">Item Description</th>
                <th width="100">UOM</th>
                <th width="100">Quantity</th>
                <th width="100">Avg. Rate</th>
                <th>Amount(BDT)</th>
           </tr>
		</thead>
		<?
		$i=1;
		foreach($prod_wiseChemicalArr as $batch_key=>$batchData)
		{
			foreach($batchData as $prod_key=>$row)
			{
			if ($i%2==0)
				$bgcolor="#E9F3FF";
			else
				$bgcolor="#FFFFFF";
				$chm_usd_amount=0;
				$chm_usd_amount=$row["amt"]/$g_exchange_rate;
			?>
			<tbody>
				<tr bgcolor="<? echo $bgcolor; ?>">
					<td align="center"><? echo $i; ?></td>
					<td align="center"><? echo $batch_noArr[$batch_key]; ?></td>
                    <td align="center"><? echo $prod_key; ?></td>
					<td><? echo $row["desc"]; ?></td>
					<td align="center"><? echo $unit_of_measurement[$row["uom"]]; ?></td>
					<td align="right"><? echo number_format($row["qty"],4,'.',''); $total_chemical_qnty+=$row["qty"]; ?></td>
					<td align="right"><? echo number_format($row["amt"]/$row["qty"],4,'.',''); ?></td>
					<td align="right" title="TK=<?=$row["amt"];?>"><?  $usd_amount;
					echo  number_format($chm_usd_amount,6,'.',''); $total_chemical_amount+=$chm_usd_amount; ?>
                    </td>
				</tr>
			</tbody>
			<?
			$i++;
			}
		}
		?>
        <tfoot>
        	<tr>
                <th colspan="5" align="right">Total:</th>
                <th align="right"><? echo number_format($total_chemical_qnty,2,'.',''); ?></th>
                <th></th>
                <th align="right"><? echo number_format($total_chemical_amount,2,'.',''); ?></th>
            </tr>
        </tfoot>
      </table>
    </div>
    <?
	exit();
}


?>