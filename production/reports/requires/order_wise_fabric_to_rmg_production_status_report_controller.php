<?php


ini_set('error_reporting', E_ALL);
ini_set('display_errors', true);

header('Content-type:text/html; charset=utf-8');
session_start();
if( $_SESSION['logic_erp']['user_id'] == "" ) header("location:login.php");

require_once('../../../includes/common.php');

$data=$_REQUEST['data'];
$action=$_REQUEST['action'];
$user_id=$_SESSION['logic_erp']['user_id'];


function get_order_info($po_id)
{
	$buyerArr=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
	$itemArray = return_library_array("select id,item_name from  lib_garment_item where status_active=1 and is_deleted=0 order by item_name", "id", "item_name");
	$orderResult = sql_select("SELECT A.ID, A.BUYER_NAME, A.JOB_NO, A.STYLE_REF_NO, B.PO_NUMBER, B.GROUPING, B.SHIPMENT_DATE, C.ITEM_NUMBER_ID,B.PO_QUANTITY
		FROM
			wo_po_details_master 		a,
			wo_po_break_down 			b,
			wo_po_color_size_breakdown 	c
		WHERE a.id=b.job_id and b.id=$po_id and
			a.id=c.job_id and b.id=c.po_break_down_id and
			a.status_active=1 and a.is_deleted=0 and
			b.status_active=1 and b.is_deleted=0 AND
			c.status_active=1 and c.is_deleted=0
			");
	$orderDataArray = array();
	foreach($orderResult as $ord){
		$orderDataArray[$ord['ID']]['BUYER_NAME']		= $ord['BUYER_NAME'];
		$orderDataArray[$ord['ID']]['JOB_NO']			= $ord['JOB_NO'];
		$orderDataArray[$ord['ID']]['STYLE_REF_NO']		= $ord['STYLE_REF_NO'];
		$orderDataArray[$ord['ID']]['PO_NUMBER']		= $ord['PO_NUMBER'];
		$orderDataArray[$ord['ID']]['GROUPING']			= $ord['GROUPING'];
		$orderDataArray[$ord['ID']]['SHIPMENT_DATE']	= $ord['SHIPMENT_DATE'];
		$orderDataArray[$ord['ID']]['ITEM_NUMBER_ID']	= $ord['ITEM_NUMBER_ID'];
		$orderDataArray[$ord['ID']]['PO_QUANTITY']		= $ord['PO_QUANTITY'];
	}
	$table ="<table cellpadding='0' cellspacing='0' border='1' class='rpt_table' rules='all' width='800'>
				<thead>
					<tr>
						<th width='100' >Buyer </th>
						<th width='100' >Job Number</th>
						<th width='100' >Style Name</th>
						<th width='100' >Order Number</th>
						<th width='100' >Internal Ref.</th>
						<th width='100' >Ship Date</th>
						<th width='100' >Item Name</th>
						<th width='100' >Order Qty</th>
					</tr>
				</thead>
				<tbody>";
	foreach($orderDataArray as $ordData){
		$table .= "<tr>
					<td width='100' >".$buyerArr[$ordData['BUYER_NAME']]."</td>
					<td width='100' >".$ordData['JOB_NO']."</td>
					<td width='100' >".$ordData['STYLE_REF_NO']."</td>
					<td width='100' >".$ordData['PO_NUMBER']."</td>
					<td width='100' >".$ordData['GROUPING']."</td>
					<td width='100' >".$ordData['SHIPMENT_DATE']."</td>
					<td width='100' >".$itemArray[$ordData['ITEM_NUMBER_ID']]."</td>
					<td width='100' >".$ordData['PO_QUANTITY']."</td>
				</tr>";
	}

	$table .="</tbody>
			</table>";

	return $table;
}
//--------------------------------------------------------------------------------------------------------------------
/* if($action=="load_report_format")
{
	$print_report_format=return_field_value("format_id","lib_report_template","template_name ='".$data."' and module_id=7 and report_id in(40) and is_deleted=0 and status_active=1");
		//echo "document.getElementById('report_ids').value = '".$print_report_format."';\n";
		//echo "print_report_button_setting('".$print_report_format."');\n";
	echo trim($print_report_format);
	exit();

} */

if ($action=="load_drop_down_location")
{
	$data=str_replace("'", "",$data);
	echo create_drop_down( "cbo_location", 120, "SELECT id,location_name from lib_location where status_active =1 and is_deleted=0 and company_id in($data) group by id,location_name order by location_name","id,location_name", 1, "-- All --", $selected, "",0 );
	exit();
}

if ($action=="load_drop_down_buyer")
{
	$data=str_replace("'", "",$data);
	echo create_drop_down( "cbo_buyer_name", 100, "SELECT buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company in($data) $buyer_cond and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) group by buy.id,buy.buyer_name  order by buyer_name","id,buyer_name", 1, "-- All --", $selected, "" );
	exit();
}

//style search------------------------------//
if($action=="style_refarence_surch")
{
	extract($_REQUEST);
	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode);
	//echo $style_id;die;

	?>
    <script>

		var selected_id = new Array;
		var selected_name = new Array;
		var selected_no = new Array;
		var selected_style_num = new Array;
    	function check_all_data()
		{
			var tbl_row_count = document.getElementById( 'list_view' ).rows.length;
			tbl_row_count = tbl_row_count - 0;
			for( var i = 1; i <= tbl_row_count; i++ )
			{
				var onclickString = $('#tr_' + i).attr('onclick');
				var paramArr = onclickString.split("'");
				var functionParam = paramArr[1];
				js_set_value( functionParam );

			}
		}

		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function js_set_value( strCon )
		{
			//alert(strCon);
				var splitSTR = strCon.split("_");
				var str = splitSTR[0];
				var selectID = splitSTR[1];
				var selectDESC = splitSTR[2];
				var selectStyle = splitSTR[3];
				//$('#txt_individual_id' + str).val(splitSTR[1]);
				//$('#txt_individual' + str).val('"'+splitSTR[2]+'"');

				toggle( document.getElementById( 'tr_' + str), '#FFFFCC' );

				if( jQuery.inArray( selectID, selected_id ) == -1 ) {
					selected_id.push( selectID );
					selected_name.push( selectDESC );
					selected_style_num.push( selectStyle );
					selected_no.push( str );
				}
				else {
					for( var i = 0; i < selected_id.length; i++ ) {
						if( selected_id[i] == selectID ) break;
					}
					selected_id.splice( i, 1 );
					selected_name.splice( i, 1 );
					selected_style_num.splice( i, 1 );
					selected_no.splice( i, 1 );
				}
				var id = ''; var name = ''; var job = ''; var num=''; var style_num='';
				for( var i = 0; i < selected_id.length; i++ ) {
					id += selected_id[i] + ',';
					name += selected_name[i] + ',';
					style_num += selected_style_num[i] + ',';
					num += selected_no[i] + ',';
				}
				id 		= id.substr( 0, id.length - 1 );
				name 	= name.substr( 0, name.length - 1 );
				style_num 	= style_num.substr( 0, style_num.length - 1 );
				num 	= num.substr( 0, num.length - 1 );
				//alert(num);
				$('#txt_selected_id').val( id );
				$('#txt_selected').val( name );
				$('#txt_selected_style_number_no').val( style_num );
				$('#txt_selected_no').val( num );
		}

		/*function js_set_value( str ) { //alert(str);
		toggle( document.getElementById( 'search' + str ), '#FFFFCC' );

		if( jQuery.inArray( $('#txt_serial_id' + str).val(), selected_id ) == -1 ) {
			selected_id.push( $('#txt_serial_id' + str).val() );
			selected_no.push( $('#txt_serial_no' + str).val() );
 		}




		else {
			for( var i = 0; i < selected_id.length; i++ ) {
				if( selected_id[i] == $('#txt_serial_id' + str).val() ) break;
			}
			selected_id.splice( i, 1 );
			selected_no.splice( i, 1 );
		}
		var id = '';	var no = '';
		for( var i = 0; i < selected_id.length; i++ ) {
			id += selected_id[i] + ',';
			no += selected_no[i] + ',';
		}
		id = id.substr( 0, id.length - 1 );
		no = no.substr( 0, no.length - 1 );
  		$('#txt_string_id').val( id );
		$('#txt_string_no').val( no );
	}

	function fn_onClosed()
	{
		var txt_string = $('#txt_string').val();
		if(txt_string==""){ alert("Please Select The Serial"); return;}
		parent.emailwindow.hide();
	}*/

    </script>
    <?
	$buyer=str_replace("'","",$buyer);
	$company=str_replace("'","",$company);
	$job_year=str_replace("'","",$job_year);
	if($buyer!=0) $buyer_cond=" and a.buyer_name=$buyer"; else $buyer_cond="";
	if($db_type==0)
	{
		if($job_year!=0) $job_year_cond=" and year(a.insert_date)=$job_year"; else $job_year_cond="";
		$select_date=" year(a.insert_date)";
	}
	else if($db_type==2)
	{
		if($job_year!=0) $job_year_cond=" and to_char(a.insert_date,'YYYY')=$job_year"; else $job_year_cond="";
		$select_date=" to_char(a.insert_date,'YYYY')";
	}

	$sql = "select a.id,a.style_ref_no,a.job_no,a.job_no_prefix_num,$select_date as year from wo_po_details_master a where a.company_name in($company) $buyer_cond  $job_year_cond and is_deleted=0 order by job_no_prefix_num";
	//echo $sql; die;
	echo create_list_view("list_view", "Style Ref No,Job No,Year","160,90,100","400","310",0, $sql , "js_set_value", "id,job_no_prefix_num,style_ref_no", "", 1, "0", $arr, "style_ref_no,job_no_prefix_num,year", "","setFilterGrid('list_view',-1)","0","",1) ;
	echo "<input type='hidden' id='txt_selected_id' />";
	echo "<input type='hidden' id='txt_selected' />";
	echo "<input type='hidden' id='txt_selected_no' />";
	echo "<input type='hidden' id='txt_selected_style_number_no' />";

	?>
    <script language="javascript" type="text/javascript">
	var style_no='<? echo $txt_style_ref_no;?>';
	var style_id='<? echo $txt_style_ref_id;?>';
	var style_des='<? echo $txt_style_ref;?>';
	var style_ref_num='<? echo $txt_style_ref_number;?>';
	//alert(style_id);
	if(style_no!="")
	{
		style_no_arr=style_no.split(",");
		style_id_arr=style_id.split(",");
		style_des_arr=style_des.split(",");
		style_ref_num_arr=style_ref_num.split(",");
		var str_ref="";
		for(var k=0;k<style_no_arr.length; k++)
		{
			str_ref=style_no_arr[k]+'_'+style_id_arr[k]+'_'+style_des_arr[k]+'_'+style_ref_num_arr[k];
			js_set_value(str_ref);
		}
	}
	</script>

    <?

	exit();
}


//order search------------------------------//
if($action=="order_surch")
{
	extract($_REQUEST);
	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode);
	?>
    <script>

		var selected_id = new Array;
		var selected_name = new Array;
		var selected_no = new Array;
    	function check_all_data() {
			var tbl_row_count = document.getElementById( 'list_view' ).rows.length;
			tbl_row_count = tbl_row_count - 0;
			for( var i = 1; i <= tbl_row_count; i++ ) {
				var onclickString = $('#tr_' + i).attr('onclick');
				var paramArr = onclickString.split("'");
				var functionParam = paramArr[1];
				js_set_value( functionParam );

			}
		}

		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function js_set_value( strCon )
		{
			//alert(strCon);
				var splitSTR = strCon.split("_");
				var str_or = splitSTR[0];
				var selectID = splitSTR[1];
				var selectDESC = splitSTR[2];
				//$('#txt_individual_id' + str).val(splitSTR[1]);
				//$('#txt_individual' + str).val('"'+splitSTR[2]+'"');

				toggle( document.getElementById( 'tr_' + str_or ), '#FFFFCC' );

				if( jQuery.inArray( selectID, selected_id ) == -1 ) {
					selected_id.push( selectID );
					selected_name.push( selectDESC );
					selected_no.push( str_or );
				}
				else {
					for( var i = 0; i < selected_id.length; i++ ) {
						if( selected_id[i] == selectID ) break;
					}
					selected_id.splice( i, 1 );
					selected_name.splice( i, 1 );
					selected_no.splice( i, 1 );
				}
				var id = ''; var name = ''; var job = ''; var num='';
				for( var i = 0; i < selected_id.length; i++ ) {
					id += selected_id[i] + ',';
					name += selected_name[i] + ',';
					num += selected_no[i] + ',';
				}
				id 		= id.substr( 0, id.length - 1 );
				name 	= name.substr( 0, name.length - 1 );
				num 	= num.substr( 0, num.length - 1 );
				//alert(num);
				$('#txt_selected_id').val( id );
				$('#txt_selected').val( name );
				$('#txt_selected_no').val( num );
		}
    </script>
    <?
	$buyer=str_replace("'","",$buyer);
	$company=str_replace("'","",$company);
	$job_year=str_replace("'","",$job_year);
	$txt_style_ref_id=str_replace("'","",$txt_style_ref_id);

	if($buyer!=0) $buyer_cond="and b.buyer_name=$buyer"; else $buyer_cond="";
	if($db_type==0)
	{
		if($job_year!=0) $job_year_cond=" and year(b.insert_date)=$job_year"; else $job_year_cond="";
		$select_date=" year(b.insert_date)";
	}
	else if($db_type==2)
	{
		if($job_year!=0) $job_year_cond=" and to_char(b.insert_date,'YYYY')=$job_year"; else $job_year_cond="";
		$select_date=" to_char(b.insert_date,'YYYY')";
	}
	if($txt_style_ref_id!="") $style_cond=" and b.id in($txt_style_ref_id)"; else $style_cond="";
	$sql = "select a.id,a.po_number,a.job_no_mst,b.style_ref_no,b.job_no_prefix_num,$select_date as year from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and b.company_name in($company) $buyer_cond $job_year_cond  $style_cond and a.status_active in(1,2,3) and b.status_active=1";
	//echo $sql; die;
	echo create_list_view("list_view", "Order NO,Job No,Year,Style Ref No","150,80,70,150","500","310",0, $sql , "js_set_value", "id,po_number", "", 1, "0", $arr, "po_number,job_no_prefix_num,year,style_ref_no", "","setFilterGrid('list_view',-1)","0","",1) ;
	echo "<input type='hidden' id='txt_selected_id' />";
	echo "<input type='hidden' id='txt_selected' />";
	echo "<input type='hidden' id='txt_selected_no' />";

	?>
    <script language="javascript" type="text/javascript">
	var style_no='<? echo $txt_order_id_no;?>';
	var style_id='<? echo $txt_order_id;?>';
	var style_des='<? echo $txt_order;?>';
	//alert(style_id);
	if(style_no!="")
	{
		style_no_arr=style_no.split(",");
		style_id_arr=style_id.split(",");
		style_des_arr=style_des.split(",");
		var str_ref="";
		for(var k=0;k<style_no_arr.length; k++)
		{
			str_ref=style_no_arr[k]+'_'+style_id_arr[k]+'_'+style_des_arr[k];
			js_set_value(str_ref);
		}
	}
	</script>

    <?
	exit();
}

$color_Arr_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" );
$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name"  );
$buyer_short_library=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
$buyerArr=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name"  );
$dealing_merchant_library=return_library_array( "select id,team_member_name from lib_mkt_team_member_info", "id", "team_member_name"  );
$floor_arr = return_library_array("select id,floor_name from lib_prod_floor", 'id', 'floor_name');
$line_library = return_library_array("select id,line_name from lib_sewing_line", "id", "line_name");
$resource_alocate_line = return_library_array("select id, line_number from prod_resource_mst", "id", "line_number");
//$po_no_library=return_library_array( "select id,po_number from wo_po_break_down", "id", "po_number"  );

if($action=="report_generate")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_buyer_name=str_replace("'","",$cbo_buyer_name);
	$cbo_location=str_replace("'","",$cbo_location);
	$cbo_floor=str_replace("'","",$cbo_floor);
	$txt_date_from=str_replace("'","",$txt_date_from);
	$txt_date_to=str_replace("'","",$txt_date_to);
	$cbo_job_year=str_replace("'","",$cbo_job_year);
	$txt_style_ref=str_replace("'","",$txt_style_ref);
	$txt_style_ref_id=str_replace("'","",$txt_style_ref_id);
	$txt_order_no=str_replace("'","",$txt_order);
	$txt_order_id=str_replace("'","",$txt_order_id);
	$shipping_status=str_replace("'","",$shipping_status);
	$orderStatus=str_replace("'","",$orderStatus);
	$txt_style_ref_number=str_replace("'","",$txt_style_ref_number);
	$active_status=str_replace("'", "", $active_status);
	$cbo_date_type = str_replace("'","",$cbo_date_type);
	//echo $cbo_company_name;die;

	$print_report_format=0;
	$print_report_format=return_field_value("format_id","lib_report_template","template_name in($cbo_company_name) and module_id=2 and report_id=1 and is_deleted=0 and status_active=1");
	$print_report_format_budget_booking=return_field_value("format_id","lib_report_template","template_name in($cbo_company_name) and module_id=2 and report_id=1 and is_deleted=0 and status_active=1");
	$print_report_format_sample=return_field_value("format_id","lib_report_template","template_name in($cbo_company_name) and module_id=2 and report_id=3 and is_deleted=0 and status_active=1");
	$reportFormatSample=explode(",",$print_report_format_sample);
	$reportFormatSample=$reportFormatSample[0];
	$report_format_sample_arr=array(16=>"show_fabric_booking_report_print_booking_3",38=>"show_fabric_booking_report",39=>"show_fabric_booking_report2",64=>"show_fabric_booking_report3");

	$report_format_arr=array(1=>"show_fabric_booking_report_gr",2=>"show_fabric_booking_report",3=>"show_fabric_booking_report3",4=>"show_fabric_booking_report1",5=>"show_fabric_booking_report2",6=>"show_fabric_booking_report4",7=>"show_fabric_booking_report5",8=>"show_fabric_booking_report",9=>"show_fabric_booking_report3",10=>"show_fabric_booking_report4",28=>"show_fabric_booking_report_akh",45=>"show_fabric_booking_report_urmi",53=>"show_fabric_booking_report_jk",73=>"show_fabric_booking_report_mf",93=>"show_fabric_booking_report_libas",719=>"show_fabric_booking_report16");//,78=>"Print",84=>"Print2",85=>"Print3"

	$shipment_status_arr=array(1=>"Full Pending",2=>"Partial Shipment",3=>"Full Shipment");

	$booking_print_arr=array();

	$booking_print_sql=sql_select("select report_id, format_id from lib_report_template where template_name in($cbo_company_name) and module_id=2 and report_id in (1,2,3) and is_deleted=0 and status_active=1");
	foreach($booking_print_sql as $print_id)
	{
		$booking_print_arr[$print_id[csf('report_id')]]=(int) $print_id[csf('format_id')];
	}
	unset($booking_print_sql);
	//print_r($booking_print_arr); die;

	$nameArray = sql_select("select id, auto_update from variable_settings_production where company_name in($cbo_company_name) and variable_list=23 and status_active=1 and is_deleted=0");
    $prod_reso_allocation = $nameArray[0][csf('auto_update')];

	$date_caption = "";
	if($cbo_date_type==0 || $cbo_date_type==1)
	{
		$date_caption ="Pub. Shipment Date";
	}
	elseif($cbo_date_type==2)
	{
		$date_caption ="Org. Shipment Date";
	}
	elseif($cbo_date_type==3)
	{
		$date_caption ="PO Receive Date";
	}
	elseif($cbo_date_type==4)
	{
		$date_caption ="PO Insert Date";
	}


	$active_cond="";
	$active_cond_c="";
	$active_cond_a_d="";
	$active_cond_d="";
	$active_cond_b="";
	$active_cond_e_f="";
	$order_status_cond="";

	if($active_status == 0) $active_cond 		= " and b.status_active=1 and c.status_active=1 ";
	if($active_status == 0) $active_cond_a_d 	= " and a.status_active=1 and d.status_active=1 ";
	if($active_status == 0) $active_cond_e_f 	= " and e.status_active=1 and f.status_active=1 ";
	if($active_status == 0) $active_cond_c 		= "  and c.status_active=1 ";
	if($active_status == 0) $active_cond_d 		= "  and d.status_active=1 ";
	if($active_status == 0) $active_cond_b 		= "  and b.status_active=1 ";
	if($orderStatus)  $order_status_cond 	= "  and b.is_confirmed=$orderStatus ";

	$txt_order_number=str_replace("'","",$txt_order);
	$txt_order_number=trim($txt_order_number);
	$txt_order_number = "'".implode("','", explode(",", $txt_order_number))."'";

	if($txt_order_id=="")
	{
		$txt_order_number_expl=explode(",",$txt_order_number);
		$poDatas="";
		foreach($txt_order_number_expl as $poData)
		{
			$poDatas.=$poData.",";
		}
		$poNumbers=chop($poDatas,",");

		if($txt_order_number!="")
		{
			$str_poNumbers_cond =" and b.po_number in($poNumbers)";
		}
		else
		{
			$str_poNumbers_cond = "";
		}

	}

	$country_id=str_replace("'","",$country_id);//******/ come from capacity and order booking report  //******/

	/* if ($txt_style_ref_number!="")
	{
		$txt_style_ref_number_cond="and a.style_ref_no like '%$txt_style_ref_number%'";
	}
	else
	{
		$txt_style_ref_number_cond="";
	} */

    if($type==1) //  order wise
	{
		//echo $type.'Sayed'; die;
		$str_po_cond="";

		if($cbo_company_name!=0) $str_po_cond.=" and a.company_name in($cbo_company_name)";
		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}

		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				//$str_po_cond .=" and b.shiping_status in(1,2)";
				$str_po_cond .=" and b.shiping_status in(2,3)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}

		// if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";

		if($txt_date_from!="" && $txt_date_to!="")
		{
			if($db_type==0)
			{
				$start_date = date('Y-m-d H:i:s',strtotime($txt_date_from));
				$end_date = date("Y-m-d",strtotime($txt_date_to));

				if($cbo_date_type==0 || $cbo_date_type==1)
				{
					$start_date = date('Y-m-d',strtotime($txt_date_from));
					$str_po_cond .=" and b.pub_shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==2)
				{
					$str_po_cond .=" and b.shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==3)
				{
					$start_date = date('Y-m-d',strtotime($txt_date_from));
					$str_po_cond .=" and b.po_received_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==4)
				{
					$str_po_cond .=" and b.insert_date between '".$start_date."' and '".$end_date." 23:59:59'";
				}
			}
			else
			{
				$start_date = change_date_format(date("Y-m-d H:i:s",strtotime($txt_date_from)),'','',1);
				$end_date = change_date_format(date("Y-m-d H:i:s",strtotime($txt_date_to)),'','',1);

				if($cbo_date_type==0 || $cbo_date_type==1)
				{
					$str_po_cond .=" and b.pub_shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==2)
				{
					$str_po_cond .=" and b.shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==3)
				{
					$str_po_cond .=" and b.po_received_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==4)
				{
					$str_po_cond.=" and b.insert_date between '".$start_date."' and '".$end_date." 11:59:59 PM'";
				}
			}
		}

		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";

		$order_sql="SELECT a.id as job_id,b.id, a.job_no_prefix_num,a.job_no, $select_job_year, b.po_number, b.po_quantity, b.unit_price, b.po_total_price, b.job_no_mst, b.pub_shipment_date, b.shipment_date, b.po_received_date, b.insert_date, b.is_confirmed, b.shiping_status, b.excess_cut, b.plan_cut, a.company_name, a.style_owner, a.buyer_name, a.set_break_down, a.style_ref_no,a.client_id,a.total_set_qnty,b.pack_handover_date, a.dealing_marchant
		from wo_po_details_master a, wo_po_break_down b
		where b.job_id=a.id and a.status_active=1 and a.is_deleted=0 $active_cond_b and b.is_deleted=0 $str_po_cond $txt_style_ref_number_cond $order_status_cond
		order by a.id";
		//echo $order_sql;die;
		$sql_po_result=sql_select($order_sql);
		if(count($sql_po_result)<1)
		{
			echo "<div style='color:red;text-align:center;font-weight:bold;'>Data not found!</div>";
			die;
		}

		$all_po_id=""; $all_po_id_arr=array();
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("id")].",";
			$all_po_id_arr[$row[csf("id")]]=$row[csf("id")];
		}
	    $all_po_id=chop($all_po_id,",");
		$all_dtl_mst_id=chop($all_dtl_mst_id,",");

	    $all_po_ids=implode(",", $all_po_id_arr);

		//=================================== Delete Order Id From TEMP ENGINE ====================================
		$con = connect();
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 138 and ref_from in(7)");
		oci_commit($con);
		//=================================== Insert order_id into TEMP ENGINE ====================================
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 138, 7,$all_po_id_arr, $empty_arr);
		oci_commit($con);


 		// ================================= FINISH FABRIC RECEIVE =====================================
		/* $fin_rcv_sql = "SELECT a.item_id,a.fin_receive_qnty,a.po_break_down_id as po_id from gmt_finishing_receive_dtls a,gbl_temp_engine tmp where a.po_break_down_id=tmp.ref_val and a.status_active=1 and a.is_deleted=0 and tmp.entry_form=138 and tmp.ref_from=7 and tmp.user_id=$user_id";
		//echo $fin_rcv_sql; die;
		$fin_rcv_sql_res=sql_select($fin_rcv_sql);
		$finishing_rcv_arr = array();
		$po_wise_fin_rcv_arr = array();
		foreach($fin_rcv_sql_res as $v)
		{
			$finishing_rcv_arr[$v["PO_ID"]][$v["ITEM_ID"]]['receive_qnty'] += $v['FIN_RECEIVE_QNTY'];
			$po_wise_fin_rcv_arr [$v["PO_ID"]] += $v['FIN_RECEIVE_QNTY'];
		} */
		// echo "<pre>"; print_r($po_wise_fin_rcv_arr); die;

 		// ================================= GETTING ORDER QTY (ITEM WISE) =====================================
 		$order_qty_sql="SELECT b.id,c.item_number_id as item_id, SUM(c.order_quantity) as order_quantity
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where b.job_id=a.id and b.id=c.po_break_down_id and a.id=c.job_id and a.status_active=1 and a.is_deleted=0 $active_cond_b and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $order_status_cond $str_po_cond $txt_style_ref_number_cond group by b.id,c.item_number_id";
		//echo $order_qty_sql;
		$order_qty_sql_res = sql_select($order_qty_sql);
		$order_qty_array = array();
		foreach ($order_qty_sql_res as $val)
		{
			$order_qty_array[$val[csf('id')]][$val[csf('item_id')]] = $val[csf('order_quantity')];
		}

		// ================================= GETTING ORDER COLOR (ITEM WISE) =====================================

		$order_color_sql="SELECT a.po_break_down_id,a.item_number_id as item_id,a.color_number_id
		from wo_po_color_size_breakdown a, gbl_temp_engine tmp
		where a.po_break_down_id=tmp.ref_val and a.status_active=1 and a.is_deleted=0 and tmp.entry_form=138 and tmp.ref_from=7 and tmp.user_id=$user_id group by a.po_break_down_id,a.item_number_id,a.color_number_id order by a.color_number_id";
		//echo $order_color_sql;die;
		$order_color_sql_res = sql_select($order_color_sql);
		$order_color_array = array();
		foreach ($order_color_sql_res as $val)
		{
			$order_color_array[$val[csf('po_break_down_id')]][$val[csf('item_id')]] .= $color_Arr_library[$val[csf('color_number_id')]].',';

		}
		//echo "<pre>";print_r($order_color_array);die;
		// ================================ end order COLOR ===============================================


 		$template_id_arr=return_library_array("SELECT a.po_number_id, a.template_id from tna_process_mst a,GBL_TEMP_ENGINE b where a.po_number_id =b.ref_val and b.entry_form=138 and b.ref_from=7 and b.user_id=$user_id group by a.po_number_id, a.template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and c.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(array_unique(explode(",",$all_po_id)),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (c.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or c.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}
			}
		}

		$ex_factory_arr=array();

		$ex_fac_level=sql_select("SELECT ex_factory  from variable_settings_production where company_name in($cbo_company_name) and variable_list=1 and status_active=1");

        $ex_factory_data=sql_select("SELECT c.po_break_down_id , c.item_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
        sum(CASE WHEN c.entry_form!=85 THEN c.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN c.ex_factory_qnty ELSE 0 END) as ex_factory_qnty
        from pro_ex_factory_mst c, GBL_TEMP_ENGINE d where c.po_break_down_id =d.ref_val and d.entry_form=138 and d.ref_from=7 and d.user_id=$user_id and c.status_active=1 and c.is_deleted=0  group by c.po_break_down_id, c.item_number_id");

        foreach($ex_factory_data as $exRow)
        {
            $ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['date']=$exRow[csf('ex_factory_date')];
            $ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['qty']=$exRow[csf('ex_factory_qnty')];
            $ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

        }

		unset($ex_factory_data);

		if($db_type==0)
		{

			$prod_sql="SELECT c.po_break_down_id, c.item_number_id,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				IFNULL(sum(CASE WHEN d.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,


				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,


				IFNULL(sum(CASE WHEN d.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='5' THEN d.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty,

				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='11' THEN d.production_qnty ELSE 0 END),0) AS poly_qty,
				IFNULL(sum(CASE WHEN d.production_type in (1,2,4,3,5,7,8,11) and c.production_type in (1,2,4,3,5,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=1 then c.carton_qty ELSE 0 END),0) as carton_qty_no_inhouse,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=3 then c.carton_qty ELSE 0 END),0) as carton_qty_no_outbound,
				IFNULL(sum(CASE When d.production_type ='8' and c.production_type ='8' then c.carton_qty ELSE 0 END),0) as carton_total_qty

			from
				pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e,GBL_TEMP_ENGINE b
			where  c.id=d.mst_id  and c.po_break_down_id=a.po_break_down_id and a.job_id=e.id  and a.id=d.color_size_break_down_id and c.status_active=1 and   c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and e.status_active=1 and e.is_deleted=0 $active_cond_a_d and c.po_break_down_id =b.ref_val and b.entry_form=138 and b.ref_from=7 and b.user_id=$user_id  group by c.po_break_down_id, c.item_number_id";

			$sql_carton_qty=sql_select("SELECT c.po_break_down_id,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=1 then c.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=3 then c.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when c.production_type ='8' then c.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst c,GBL_TEMP_ENGINE b where c.status_active=1 and c.is_deleted=0 and c.po_break_down_id =b.ref_val and b.entry_form=138 and b.ref_from=7 and b.user_id=$user_id group by c.po_break_down_id");
		}
		else
		{
			$producttion_cond =" and c.po_break_down_id in($po_id)";
			$prod_sql= "SELECT c.po_break_down_id, c.item_number_id,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.replace_qty ELSE 0 END),0) AS replace_qty,

				NVL(sum(CASE WHEN d.production_type ='2'  and c.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				NVL(sum(CASE WHEN c.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				NVL(sum(CASE WHEN d.production_type ='3'  and c.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5'  THEN d.replace_qty ELSE 0 END),0) AS sew_replace_qty,

				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,

				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and d.is_rescan=0 THEN d.reject_qty ELSE 0 END)-sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and d.is_rescan!=0 THEN d.production_qnty ELSE 0 END) AS sewingout_rej_qnty,

				sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and d.is_rescan=0 THEN d.reject_qty ELSE 0 END)-sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and d.is_rescan!=0 THEN d.production_qnty ELSE 0 END)-sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' THEN d.replace_qty ELSE 0 END) AS sewingout_rej_qnty_old,

				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' THEN d.reject_qty ELSE 0 END),0) AS poly_rej_qnty,

				NVL(sum(CASE WHEN d.production_type in (1,3,7,8,11) and c.production_type in (1,3,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				NVL(sum(CASE WHEN d.production_type ='11' and c.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,

				NVL(sum(CASE WHEN c.production_type ='11' and d.production_type ='11'  THEN d.production_qnty ELSE 0 END),0) AS poly_qty

			from
				pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e, GBL_TEMP_ENGINE b
			where  c.id=d.mst_id  AND a.job_id = e.id  and a.id=d.color_size_break_down_id and c.po_break_down_id=a.po_break_down_id and
				c.status_active=1 and c.is_deleted=0 and d.status_active=1 and e.status_active=1 $active_cond_a_d and d.is_deleted=0  and e.status_active=1 and e.is_deleted=0 and c.po_break_down_id =b.ref_val and b.entry_form=138 and b.ref_from=7 and b.user_id=$user_id group by c.po_break_down_id, c.item_number_id";


			$sql_carton_qty=sql_select("SELECT c.po_break_down_id,
			NVL(sum(case when c.production_type ='8' and c.production_source=1 then c.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			NVL(sum(case when c.production_type ='8' and c.production_source=3 then c.carton_qty else 0 end),0) as carton_qty_no_outbound,
			NVL(sum(case when c.production_type ='8' then c.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst c,GBL_TEMP_ENGINE b where c.status_active=1 and c.is_deleted=0and c.po_break_down_id =b.ref_val and b.entry_form=138 and b.ref_from=7 and b.user_id=$user_id group by c.po_break_down_id");

		}
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		}
		//echo $prod_sql; die;

		$sql_cutlay="SELECT a.entry_form,a.entry_date,a.end_date,b.order_id as po_id,b.gmt_item_id as gmts,c.order_id,sum(c.size_qty ) as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,GBL_TEMP_ENGINE d where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id =d.ref_val and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id in($cbo_company_name) and d.entry_form=138 and d.ref_from=7 and d.user_id=$user_id group by a.entry_form,a.entry_date,a.end_date,b.order_id,b.gmt_item_id,c.order_id";
		//echo $sql_cutlay;die;
		$sql_res=sql_select($sql_cutlay);
		$cut_lay_arrs = array();
		foreach($sql_res as $row)
		{
			$cut_lay_arrs[$row[csf("order_id")]][$row[csf("gmts")]]+=$row[csf("qty")];
			$cut_lay_arrs[$row[csf("order_id")]]["entry_date"]=$row[csf("entry_date")];
			$cut_lay_arrs[$row[csf("order_id")]]["end_date"]=$row[csf("end_date")];
		}
		unset($sql_res);

		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['cQty']=$gmtsRow[csf('cutting_qnty')];//+$gmtsRow[csf('replace_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['rQty']=$gmtsRow[csf('replace_qty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['pQty']=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print']=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb']=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['washiss']=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['special']=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['prQty']=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print']=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['embr']=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['washrec']=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['special']=$gmtsRow[csf('specialr')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['spc_qty']=$gmtsRow[csf('issue_spc_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['issue_wash']=$gmtsRow[csf('issue_wash_qty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print_issue_inhouse']=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print_issue_subcon']=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print_rcv_inhouse']=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print_rcv_subcon']=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb_issue_inhouse']=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb_issue_subcon']=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb_rcv_inhouse']=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb_rcv_subcon']=$gmtsRow[csf('emb_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['sQty']=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['soQty']=$gmtsRow[csf('sewingout_qnty_in')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['subcon_sewingin']=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['subcon_sewingout']=$gmtsRow[csf('sewingout_qnty_out')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['all_sewingout']=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['sew_replace_qty']=$gmtsRow[csf('sew_replace_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['iQty']=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['riQty']=$gmtsRow[csf('re_iron_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['finish_qnty_inhouse']=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['finish_qnty_outbound']=$gmtsRow[csf('finish_qnty_outbound')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['crQty']=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['sorQty']=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['frQty']=$gmtsRow[csf('finish_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['polyRej']=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['rej_qnty']=$gmtsRow[csf('rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['polyInQty']=$gmtsRow[csf('poly_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['polyOutQty']=$gmtsRow[csf('poly_outbound')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['polyQty']=$gmtsRow[csf('poly_qty')];
		}
		//echo "<pre>";print_r($gmts_prod_arr);die;
		unset($res_gmtsData);

		$sql_wo="SELECT b.po_break_down_id, a.id, a.booking_no, a.insert_date, a.item_category, a.fabric_source, a.company_id, a.booking_type, a.booking_no_prefix_num, a.job_no, a.is_short, a.is_approved, a.po_break_down_id as wo_po_id,a.entry_form, b.fabric_color_id, sum(b.fin_fab_qnty) as fin_req_qnty, sum(b.grey_fab_qnty) as grey_req_qnty from wo_booking_mst a, wo_booking_dtls b, gbl_temp_engine d where a.booking_no=b.booking_no and a.item_category in(2,3,13) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.po_break_down_id=d.ref_val and d.user_id = ".$user_id." and d.entry_form=138 and d.ref_from=7 group by b.po_break_down_id, a.id, a.booking_no, a.insert_date, a.item_category, a.fabric_source, a.company_id, a.booking_type, a.booking_no_prefix_num, a.job_no, a.is_short, a.is_approved, a.po_break_down_id,a.entry_form, b.fabric_color_id";
		//echo $sql_wo;die;
		$resultWo=sql_select($sql_wo);

		$dataArrayWo=array(); $fab_source_arr=array(); $bookingEntryFromArr=array();
		foreach($resultWo as $woRow)
		{
			$dataArrayWo[$woRow[csf('po_break_down_id')]].=$woRow[csf('id')]."**".$woRow[csf('booking_no')]."**".$woRow[csf('insert_date')]."**".$woRow[csf('item_category')]."**".$woRow[csf('fabric_source')]."**".$woRow[csf('company_id')]."**".$woRow[csf('booking_type')]."**".$woRow[csf('booking_no_prefix_num')]."**".$woRow[csf('job_no')]."**".$woRow[csf('is_short')]."**".$woRow[csf('is_approved')]."**".$woRow[csf('fabric_color_id')]."**".$woRow[csf('fin_req_qnty')]."**".$woRow[csf('grey_req_qnty')]."**".$woRow[csf('wo_po_id')]."__";

			$fab_source_arr[$woRow[csf('po_break_down_id')]].=$woRow[csf('fabric_source')].',';
			$bookingEntryFromArr[$woRow[csf('booking_no')]]=$woRow[csf('entry_form')];
		}
		//echo "<pre>";print_r($booking_info_arr);//die;
		unset($resultWo);

		// $grey_rcv_sql = "SELECT a.id, b.order_id, b.grey_receive_qnty FROM inv_receive_master a, pro_grey_prod_entry_dtls b, gbl_temp_engine c WHERE a.id = b.mst_id AND a.entry_form = 58 AND a.status_active = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0 AND b.order_id = cast(c.ref_val as varchar(4000)) AND c.user_id = ".$user_id." and c.entry_form=138 and c.ref_from=7";

		$grey_fin_rcv_sql = "SELECT a.po_breakdown_id, a.entry_form, a.quantity FROM order_wise_pro_details a, gbl_temp_engine b WHERE a.entry_form in(18,22,37,58,68,71,225) AND a.status_active = 1 AND a.is_deleted = 0 AND a.po_breakdown_id = b.ref_val AND b.user_id = ".$user_id." and b.entry_form=138 and b.ref_from=7";

		//echo $grey_fin_rcv_sql;die;
		$resultGreyFinRcv=sql_select($grey_fin_rcv_sql);
		$grey_rcv_info_arr=array();
		$fin_rcv_info_arr=array();
		$fin_issue_info_arr=array();
		foreach($resultGreyFinRcv as $row)
		{

			if($row[csf('entry_form')]==58 || $row[csf('entry_form')]==22)
			{
				$grey_rcv_info_arr[$row[csf('po_breakdown_id')]]['grey_receive_qnty'] += $row[csf('quantity')];
			}
			else if($row[csf('entry_form')]==37 || $row[csf('entry_form')]==68 || $row[csf('entry_form')]==225)
			{
				$fin_rcv_info_arr[$row[csf('po_breakdown_id')]]['finish_receive_qnty'] += $row[csf('quantity')];
			}
			else if($row[csf('entry_form')]==18 || $row[csf('entry_form')]==71)
			{
				$fin_issue_info_arr[$row[csf('po_breakdown_id')]]['finish_issue_qnty'] += $row[csf('quantity')];
			}

		}
		//echo "<pre>";print_r($fin_issue_info_arr);die;
		unset($resultGreyFinRcv);

		$sql_finish_return = "SELECT b.po_breakdown_id, b.quantity FROM inv_transaction a, order_wise_pro_details b, gbl_temp_engine c WHERE a.id = b.trans_id AND b.entry_form IN (46, 52) AND a.transaction_type IN (3, 4) AND a.status_active = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0 AND b.po_breakdown_id = c.ref_val AND c.user_id = ".$user_id." and c.entry_form=138 and c.ref_from=7";

		//echo $sql_finish_return;die;
		$resultGreyFinRtn=sql_select($sql_finish_return);

		$fin_rtn_info_arr=array();
		foreach($resultGreyFinRtn as $row)
		{
			$fin_rtn_info_arr[$row[csf('po_breakdown_id')]]['fin_rtn_qnty'] += $row[csf('quantity')];
		}
		//echo "<pre>";print_r($fin_rtn_info_arr);die;
		unset($resultGreyFinRtn);



		$b_swing_sql = "SELECT a.id, a.floor_id,a.sewing_line,b.item_number_id,c.po_number, c.id as po_id from pro_gmts_delivery_mst a,pro_garments_production_mst b, wo_po_break_down c,pro_garments_production_dtls d, gbl_temp_engine e where b.po_break_down_id=c.id and a.id=b.delivery_mst_id and b.id=d.mst_id and a.production_type=4 and b.production_type=4 and a.status_active=1 and a.is_deleted=0 and a.company_id in($cbo_company_name) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.id = e.ref_val and e.user_id = ".$user_id." and e.entry_form=138 and e.ref_from=7 group by a.id, a.floor_id,a.sewing_line,b.item_number_id,c.po_number,c.id";
		//echo $b_swing_sql;die;
		$resultBSwing=sql_select($b_swing_sql);

		$bundleSwingArr = array();
		foreach($resultBSwing as $row)
		{
			$bundleSwingArr[$row[csf('po_id')]][$row[csf('item_number_id')]]['floor_id'] = $row[csf('floor_id')];
			$bundleSwingArr[$row[csf('po_id')]][$row[csf('item_number_id')]]['sewing_line'] = $row[csf('sewing_line')];
		}
		// "<pre>";print_r($bundleSwingArr);die;
		unset($resultBSwing);

		$sql = "SELECT a.PO_BREAK_DOWN_ID,a.ITEM_NUMBER_ID,b.PRODUCTION_QNTY,b.TRANS_TYPE from pro_garments_production_mst a,pro_garments_production_dtls b,GBL_TEMP_ENGINE c where a.id=b.mst_id and a.po_break_down_id=c.ref_val and a.status_active=1 and b.status_active=1 and b.TRANS_TYPE in(5,6) and c.entry_form=138 and c.ref_from=7 and c.user_id=$user_id";
		// echo $sql;
		$res = sql_select($sql);
		$po_transfer_arr = array();
		foreach ($res as $val)
		{
			$po_transfer_arr[$val['PO_BREAK_DOWN_ID']][$val['ITEM_NUMBER_ID']][$val['TRANS_TYPE']] += $val['PRODUCTION_QNTY']	;
		}
		unset($res);

		$sql_tna = "SELECT a.job_no, b.po_number, p.po_number_id, p.task_number, MIN ( CASE WHEN p.task_start_date IS NOT NULL THEN p.task_start_date END) AS task_start_date, MAX (p.task_finish_date) AS task_finish_date FROM tna_process_mst p, wo_po_details_master a, wo_po_break_down b, gbl_temp_engine c WHERE p.po_number_id = b.id AND b.job_no_mst = a.job_no and p.task_number IN (12,60,61,84) AND b.id = c.ref_val AND c.user_id = ".$user_id." and c.entry_form=138 and c.ref_from=7 GROUP BY a.job_no, b.po_number, p.po_number_id, p.task_number";

		//echo $sql_tna;die;
		$sql_tna_res = sql_select($sql_tna);
		$tna_info_arr = array();
		foreach ($sql_tna_res as $row)
		{
			$tna_info_arr[$row[csf('task_number')]][$row[csf('po_number_id')]]['task_start_date'] = $row[csf('task_start_date')];
			$tna_info_arr[$row[csf('task_number')]][$row[csf('po_number_id')]]['task_finish_date'] = $row[csf('task_finish_date')];
		}
		//echo "<pre>";print_r($tna_info_arr);
		unset($sql_tna_res);



		$fromDate = change_date_format( str_replace("'","",trim($txt_date_from)) );
		$toDate = change_date_format( str_replace("'","",trim($txt_date_to)) );


		//=================================== Delete Order Id From TEMP ENGINE ====================================
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 138 and ref_from in(7)");
		oci_commit($con);
		disconnect($con);

		ob_start();

  		?>
		<div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						<? echo "Order Wise Fabric to RMG Production Status Report"; ?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						<!-- Company Name : <? echo $company_library[str_replace("'","",$cbo_company_name)]; ?> -->
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">
						<?
							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								echo "From $fromDate To $toDate";
							}
						?>
					</td>
				</tr>
			</table>


			<!-- ============================================================================/
			/									Details part								 /
			/ ============================================================================ -->
			<table width="4545" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1">
				<thead>
					<tr>
						<th width="30">SL</th>
                        <th width="100">Order Status</th>
                        <th width="100">Main Fabric Booking No</th>
						<th width="130">Style</th>
						<th width="100">Buyer</th>
                        <th width="80">Job No</th>
						<th width="60">File Rcv. Date</th>
						<th width="80"><? echo $date_caption;?></th>
                        <th width="100">Lead Time</th>
                        <th width="80">PP App date</th>
						<th width="120">Order No.</th>
						<th width="130">Item Name</th>
						<th width="70">Order Qty</th>
						<th width="80">Fabric Booking Date</th>
						<th width="80">Knitting Start Date</th>
						<th width="80">Knitting End Date</th>
						<th width="80">Grey Fabric req.</th>
						<th width="100">Grey Fabric Received</th>
						<th width="80">Balance</th>
                        <th width="80">Colour</th>
                        <th width="80">Dye.Star date</th>
                        <th width="80">Dye.End date</th>
						<th width="80">Finish Fabric Booking</th>
						<th width="80">Finish Fabric Received</th>
						<th width="80">Finish Fabric Balance</th>
						<th width="80">Fabrics Issue to Cut.</th>
                        <th width="80">Plan Cut Qty</th>
                        <th width="80">Cutting Start Date</th>
						<th width="80">Cutting End Date</th>
						<th width="80">Cutting Lay Qty</th>
						<th width="80">Cutting QC</th>
						<th width="80">Cutting Balance</th>
						<th  width="80">Print send</th>
						<th width="80">Print Received</th>
						<th width="80">Ballance</th>
						<th width="80">EMB. Send</th>
						<th width="80">EMB. Received</th>
						<th width="80">Ballance</th>
						<th width="80">Sewing Input Qty</th>
						<th width="80">Sewing Output Qty</th>
						<th width="80">Sewing WIP</th>
						<th width="80">Sewing Balance</th>
						<th width="80">Poly</th>
						<th width="80">Poly Balance</th>
                        <th width="80">Total Ex-Factory</th>
                        <th width="80">Shortage Qty.</th>
						<th width="80">Excess Qty.</th>
						<th width="80">Balance Qty</th>
						<th width="80">Running Floor</th>
						<th width="80">Line No.</th>
						<th width="80">Accessories Status</th>
						<th width="80">Concern Person</th>
						<th width="100">Shiping Status</th>
						<th>Remarks</th>
					 </tr>
				</thead>
			</table>
			<div style="max-height:425px; overflow-y:scroll; width:4565px" id="scroll_body">
				<table border="1" class="rpt_table" width="4545" rules="all" id="table_body">
				<?
				$buyer_array=array();
				$result=sql_select($order_sql);
				$i=0; $k=0; $date=date("Y-m-d");
				$days_in_hand="";
				// echo "<pre>";print_r($result);die;
				$sub_po_qty=$sub_grey_req_qnty=$sub_grey_rcv_qnty=$sub_grey_balance_qnty=$sub_fin_req_qnty=$sub_finish_rcv_qnty=$sub_finish_balance_qnty=$sub_finish_issue_qnty=$sub_plan_cut_qty=$sub_cut_lay_qty=$sub_cutting_qc_qty=$sub_cutting_balance=$sub_print_issue_inhouse=$sub_print_rcv_inhouse=$sub_print_balance=$sub_emb_issue_inhouse=$sub_emb_rcv_inhouse=$sub_emb_balance=$sub_ttl_sewingin_qnty=$sub_ttl_sewingout_qnty=$sub_ttl_sewing_balance=$sub_poly_qnty=$sub_poly_balance=$sub_ex_factory_qnty=$sub_ex_factory_carton_qnty=$sub_shortage=$sub_excess=$sub_balance=$sub_swing_balance=0;


				$gt_po_qty=$gt_grey_req_qnty=$gt_grey_rcv_qnty=$gt_grey_balance_qnty=$gt_fin_req_qnty=$gt_finish_rcv_qnty=$gt_finish_balance_qnty=$gt_finish_issue_qnty=$gt_plan_cut_qty=$gt_cut_lay_qty=$gt_cutting_qc_qty=$gt_cutting_balance=$gt_print_issue_inhouse=$gt_print_rcv_inhouse=$gt_print_balance=$gt_emb_issue_inhouse=$gt_emb_rcv_inhouse=$gt_emb_balance=$gt_ttl_sewingin_qnty=$gt_ttl_sewingout_qnty=$gt_ttl_sewing_balance=$gt_poly_qnty=$gt_poly_balance=$gt_ex_factory_qnty=$gt_ex_factory_carton_qnty=$gt_shortage=$gt_excess=$gt_balance=$gt_swing_balance=0;

				$date_title = "";

				foreach($result as $orderRes)
				{
				   $i++;
				   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				   $setArr = explode("__",$orderRes[csf("set_break_down")] );
				   $countArr = count($setArr);

				   if($countArr==0) $countArr=1;
				   for($j=0;$j<$countArr;$j++)
				   {
					   $setItemArr = explode("_",$setArr[$j]);
					   $item_id=$setItemArr[0];
					   $set_qnty=$setItemArr[1];
					   $main_booking = "";
					   if($item_id>0)
					   {
							   $k++;
							   // $po_quantity_in_pcs = $orderRes[csf("po_quantity")]*$set_qnty;

							$main_booking='';$booking_array=array();$fin_req_qnty=$grey_req_qnty=0;
							$dataArray=array_filter(explode("__",$dataArrayWo[$orderRes[csf("id")]]));
							if(count($dataArray)>0)
							{
								foreach($dataArray as $woRow)
								{
									$woRow=explode("**",$woRow);
									$id=$woRow[0];
									$booking_no=$woRow[1];
									$insert_date=$woRow[2];
									$item_category=$woRow[3];
									$fabric_source=$woRow[4];
									$company_id=$woRow[5];
									$booking_type=$woRow[6];
									$booking_no_prefix_num=$woRow[7];
									$job_no=$woRow[8];
									$is_short=$woRow[9];
									$is_approved=$woRow[10];
									$fabric_color_id=$woRow[11];
									$fin_req_qnty+=$woRow[12];
									$grey_req_qnty+=$woRow[13];
									$wo_po_id=$woRow[14];
									$book_prefix_no = $woRow[7];

									if(!in_array($id,$booking_array))
									{
										if($bookingEntryFromArr[$booking_no]==86)
										{
											$entryForm=$bookingEntryFromArr[$booking_no];
											$reportFormat=explode(",",$print_report_format_budget_booking[0]);
											$reportFormat=$reportFormat[0];
											$action_namez=$report_format_arr[$reportFormat];
										}
										$system_date=date('d-M-Y', strtotime($insert_date));
										$wo_color = "";
										if ($fabric_source == 2) $wo_color = "color:#000"; else $wo_color = "";

										if($booking_type==4)
										{
											if($entryForm==86)
											{
												$action_name=$action_namez;
											}
											else{
												//$action_name='show_fabric_booking_report';
												$action_name=$report_format_sample_arr[$reportFormatSample];
											}

											$main_booking.="<a href='##' style='color:#000' onclick=\"generate_order_report('3','".$booking_no."','".$company_id."','".$wo_po_id."','".$item_category."','".$fabric_source."','".$job_no."','".$is_approved."','".$action_name."','".$print_report_format."','".$entryForm."')\"><font style='font-weight:bold' color='$wo_color;'>".$booking_no."</font></a><br>";
										}
										else
										{
											$all_book_prefix_no .= $book_prefix_no . ",";
											if($is_short==1)
											{
												$pre="S";
												$action_name=$report_format_arr[$booking_print_arr[2]];
											}
											else
											{
												$pre="M";
												$action_name=$report_format_arr[$booking_print_arr[1]];
											}
											if($entryForm==86)
											{
												//$action_name=$action_namez;
											}
											else if ($action_name=='') {
												$action_name='show_fabric_booking_report';
											}
											//if($is_short==1) $pre="S"; else $pre="M";

											$main_booking.="<a href='##' style='color:#000' onclick=\"generate_order_report('".$is_short."','".$booking_no."','".$company_id."','".$wo_po_id."','".$item_category."','".$fabric_source."','".$job_no."','".$is_approved."','".$action_name."','".$print_report_format."')\"><font style='font-weight:bold' color='$wo_color;'>".$booking_no.$pre."</font></a><br>";

										}

										$booking_array[]=$id;
									}
								}
							}


							$grey_rcv_qnty = $grey_rcv_info_arr[$orderRes[csf("id")]]['grey_receive_qnty'];
							$grey_balance_qnty = $grey_req_qnty-$grey_rcv_qnty;
							$finish_rcv_qnty = $fin_rcv_info_arr[$orderRes[csf("id")]]['finish_receive_qnty'];
							$finish_balance_qnty = $fin_req_qnty-$finish_rcv_qnty;
							$finish_iss_qnty = $fin_issue_info_arr[$orderRes[csf("id")]]['finish_issue_qnty'];
							$finish_rtn_qnty = $fin_rtn_info_arr[$orderRes[csf("id")]]['fin_rtn_qnty'];

							$finish_issue_qnty = $finish_iss_qnty-$finish_rtn_qnty;

							$ord_color = $order_color_array[$orderRes[csf("id")]][$item_id];
							$po_qty = $order_qty_array[$orderRes[csf("id")]][$item_id];
							$po_quantity_in_pcs = $po_qty;//*$set_qnty;
							$unit_price2=$orderRes[csf("unit_price")]/$orderRes[csf("total_set_qnty")];
							$unit_price=$orderRes[csf("unit_price")]/$set_qnty;
							$ex_factory_date=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['date'];
							$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['qty'];
							$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['ex_fac_carton_qty'];

							$color=""; $days_remian="";
							if($orderRes[csf("shiping_status")]==1 || $orderRes[csf("shiping_status")]==2)
							{
								$days_remian=datediff("d",$date,$orderRes[csf("pub_shipment_date")]);
								$days_in_hand=datediff("d",$date,$orderRes[csf("pub_shipment_date")]);
								if($orderRes[csf("pub_shipment_date")] > $date)
								{
									$color="";
								}
								else if($orderRes[csf("pub_shipment_date")] < $date)
								{
									$color="red";
								}
								else if($orderRes[csf("pub_shipment_date")] >= $date && $days_remian<=5 )
								{
									$color="orange";
								}
							}
							else if($orderRes[csf("shiping_status")]==3)
							{
								$days_remian=datediff("d",$ex_factory_date,$orderRes[csf("pub_shipment_date")]);
								if($orderRes[csf("pub_shipment_date")] >= $ex_factory_date)
								{
									$color="green";
								}
								else if($orderRes[csf("pub_shipment_date")] < $ex_factory_date)
								{
									$color="#2A9FFF";
								}
								$days_in_hand="";

							}//end if condition
							//if($days_in_hand<0) $days_in_hand=abs($days_in_hand)." Days Pass";
							//print_r($gmts_prod_arr[$orderRes[csf("id")]]);
							$cutting_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['cQty'];
							$cut_replace_qty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['rQty'];
							$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['prQty'];
							$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sQty'];
							$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['soQty'];
							$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['subcon_sewingin'];
							$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['subcon_sewingout'];
							$sewing_floor_id = $bundleSwingArr[$orderRes[csf("id")]][$item_id]['floor_id'];
							$b_sewing_line = $bundleSwingArr[$orderRes[csf("id")]][$item_id]['sewing_line'];
							$iron_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['iQty'];
							$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['riQty'];
							$polyInQnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['polyInQty'];
							$polyOutQnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['polyOutQty'];
							$poly_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['polyQty'];
							$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['finish_qnty_inhouse'];
							$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['finish_qnty_outbound'];

							$replace_qty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sew_replace_qty'];

							$cartonInQnty=$carton_arr[$orderRes[csf("id")]]['carton_qty_no_inhouse'];
							$cartonOutQnty=$carton_arr[$orderRes[csf("id")]]['carton_qty_no_outbound'];
							$cartonTotal_qnty=$carton_arr[$orderRes[csf("id")]]['carton_total_qty'];

							$finish_qnty_transferIn=$po_transfer_arr[$orderRes[csf("id")]][$item_id][5];
							$finish_qnty_transferOut=$po_transfer_arr[$orderRes[csf("id")]][$item_id][6];

							$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print_issue_inhouse'];
							$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print_issue_subcon'];
							$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print_rcv_inhouse'];
							$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print_rcv_subcon'];

							$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb_issue_inhouse'];
							$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb_issue_subcon'];
							$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb_rcv_inhouse'];
							$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb_rcv_subcon'];

							$print_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print'];
							$cut_lays=$cut_lay_arrs[$orderRes[csf("id")]][$item_id];
							$cutting_start_date = $cut_lay_arrs[$orderRes[csf("id")]]["entry_date"];
							$cutting_end_date = $cut_lay_arrs[$orderRes[csf("id")]]["end_date"];

							$embl_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb'];
							$wash_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['washiss'];
							$spwork_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['special'];

							$spc_qty_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['spc_qty'];
							$wash_qty_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['issue_wash'];

							$print_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print'];
							$emb_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb'];
							$wash_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['washrec'];
							$spcial_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['special'];
							$buyer_array[$orderRes[csf("buyer_name")]]['client_id']=$orderRes[csf("client_id")];
							// $buyer_array[$orderRes[csf("buyer_name")]]['id']=$orderRes[csf("id")];
							$buyer_array[$orderRes[csf("buyer_name")]]['receive_qnty']+=$po_wise_fin_rcv_arr[$orderRes[csf("id")]];
							$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
							$buyer_array[$orderRes[csf("buyer_name")]]['cut_lays']+=$cut_lays;
							$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
							$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
							$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
							$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
							$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
							$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
							$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
							$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$po_quantity_in_pcs;
							$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$po_quantity_in_pcs*$unit_price;
							$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
							$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
							$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
							$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
							$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
							$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
							$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
							$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
							$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
							$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound;
							$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$finish_qnty_transferIn-$finish_qnty_transferOut;
							// echo $finish_qnty_inhouse."+".$finish_qnty_outbound."+".$finish_qnty_transferIn."-".$finish_qnty_transferOut."<br>";
							$actual_exces_cut = $gmts_prod_arr[$orderRes[csf("id")]][$item_id]['cQty'];
							$buyer_array[$orderRes[csf("buyer_name")]]['polyQty']+=$poly_qnty;
							if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

							$plan_cut_qnty=$orderRes[csf("plan_cut")]*$set_qnty;
							$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
							$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);
							$cutting_balance = $plan_cut_qnty-$cutting_qnty;
							//$rej_value=$proRes[csf("finish_rej_qnty")]+$proRes[csf("sewingout_rej_qnty")];
							$rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['rej_qnty'];
							$cut_rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['crQty'];
							//$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['crQty']+$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sorQty']+$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['frQty']+$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['polyRej'];
							$sewing_rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sorQty'];

							$poly_status = $poly_qnty*100/$po_quantity_in_pcs;
							$finish_status = $total_finish_qnty*100/$po_quantity_in_pcs;
							if($j==0)
							{
								$display_font_color="";
								$font_end="";
							}
							else
							{
								$display_font_color="&nbsp;<font style='display:none'>";
								$font_end="</font>";
							}

							$company_name=$orderRes[csf("company_name")];
							$po_id=$orderRes[csf("id")];
							if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);
							if($orderRes[csf("shiping_status")]==3) $days_remian=$days_remian; else $days_remian="---";
							if(round($actual_exces_cut) > round($orderRes[csf("excess_cut")])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
							$total_rej_value+=$rej_value;
							$template_id=$template_id_arr[$orderRes[csf('id')]];
							   $html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$k','$bgcolor') id=tr_2nd$k>";
							$shortage = 0; $excess = 0; $balance = 0;
							if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
							{
								$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

								if($shortage<0)
								{
									//$shortage = "".ltrim($shortage,"-")."";
								}
							}
							else
							{
								//$shortage = "-";
							}

							if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
							{
								$excess = $ex_factory_qnty-$po_quantity_in_pcs;
							}
							else
							{
								$excess = 0;
							}



							$today= change_date_format($orderRes[csf("pub_shipment_date")],'','',1);
							$daysOnHand = datediff("d",change_date_format($orderRes[csf("po_received_date")],'','',1),$today);

							$sewing_line_no = "";
							if($prod_reso_allocation == 1)
							{
								$sewing_line = $resource_alocate_line[$b_sewing_line];
								$sewing_line_arr = explode(",", $sewing_line);
								$sewing_line_name = "";
								foreach ($sewing_line_arr as $line_id)
								{
									$sewing_line_name .= $line_library[$line_id] . ",";
								}
								$sewing_line_name = chop($sewing_line_name, ",");
								$sewing_line_no = $sewing_line_name;
							}
							else
							{
								$sewing_line_no = $line_library[$b_sewing_line];
							}

							$balance = $ex_factory_qnty-$po_quantity_in_pcs;


							$gt_po_qty	+=$po_quantity_in_pcs;
							$gt_grey_req_qnty +=$grey_req_qnty;
							$gt_grey_rcv_qnty +=$grey_rcv_qnty;
							$gt_grey_balance_qnty +=$grey_balance_qnty;
							$gt_fin_req_qnty +=$fin_req_qnty;
							$gt_finish_rcv_qnty +=$finish_rcv_qnty;
							$gt_finish_balance_qnty +=$finish_balance_qnty;
							$gt_finish_issue_qnty +=$finish_issue_qnty;
							$gt_plan_cut_qty += $plan_cut_qnty;
							$gt_cut_lay_qty +=($cut_lay_arrs[$orderRes[csf("id")]][$item_id]);
							$gt_cutting_qc_qty += $cutting_qnty;
							$gt_cutting_balance += $cutting_balance;
							$gt_print_issue_inhouse   += ($print_issue_inhouse+$print_issue_subcon);
							$gt_print_rcv_inhouse	 += ($print_rcv_inhouse+$print_rcv_subcon);
							$gt_print_balance +=($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon);
							$gt_emb_issue_inhouse +=($emb_issue_inhouse+$emb_issue_subcon);
							$gt_emb_rcv_inhouse       += ($emb_rcv_inhouse+$emb_rcv_subcon);
							$gt_emb_balance +=($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon);
							$gt_ttl_sewingin_qnty +=$sewingin_qnty+$sewingin_subcon;
							$gt_ttl_sewingout_qnty += ($sewingout_qnty+$sewingout_subcon);
							$gt_ttl_sewing_balance +=($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty);
							$gt_poly_qnty				+= $poly_qnty;
							$gt_poly_balance +=($sewingout_subcon+$sewingout_qnty)-$poly_qnty;
							$gt_ex_factory_qnty			+=	$ex_factory_qnty;
							$gt_ex_factory_carton_qnty		+= $ex_factory_carton_qnty;
							$gt_shortage				+=	$shortage;
							$gt_excess					+= $excess;
							$gt_balance					+= $balance;
							$gt_swing_balance			+= ($sewingout_subcon+$sewingout_qnty)-$po_quantity_in_pcs;

							if($cbo_date_type==0 || $cbo_date_type==1)
							{
								$date_title=$orderRes[csf("pub_shipment_date")];
							}
							else if($cbo_date_type==2)
							{
								$date_title=$orderRes[csf("shipment_date")];
							}
							else if($cbo_date_type==3)
							{
								$date_title=$orderRes[csf("po_received_date")];
							}
							else if($cbo_date_type==4)
							{
								$date_title=$orderRes[csf("insert_date")];
							}

							$check_string = $orderRes[csf("job_no")];

							if (!in_array($check_string, $checkArr))
							{
								$checkArr[$i] = $check_string;
								if ($i > 1)
								{
									?>
									<tr bgcolor="#CCCCCC" style="font-weight:bold">
										<td width="30">&nbsp;</td>
										<td width="100">&nbsp;</td>
										<td width="100">&nbsp;</td>
										<td width="130">&nbsp;</td>
										<td width="100">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="60">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="100">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="120">&nbsp;</td>
										<td width="130" align="right"><b>Job Wise Sub Total:</b></td>
										<td width="70" align="right"><?=number_format($sub_po_qty, 2, '.', '');?></td>
										<td width="80">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="80" align="right"><?=number_format($sub_grey_req_qnty, 2, '.', '');?></td>
										<td width="100" align="right"><?=number_format($sub_grey_rcv_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_grey_balance_qnty, 2, '.', '');?></td>
										<td width="80">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="80" align="right"><?=number_format($sub_fin_req_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_finish_rcv_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_finish_balance_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_finish_issue_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_plan_cut_qty, 2, '.', '');?></td>
										<td width="80">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="80" align="right"><?=number_format($sub_cut_lay_qty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_cutting_qc_qty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_cutting_balance, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_print_issue_inhouse, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_print_rcv_inhouse, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_print_balance, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_emb_issue_inhouse, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_emb_rcv_inhouse, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_emb_balance, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_ttl_sewingin_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_ttl_sewingout_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_ttl_sewing_balance, 2, '.', '');?></td>
										<td width="80" align="right"> <?=number_format($sub_swing_balance, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_poly_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_poly_balance, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_ex_factory_qnty, 2, '.', '').'<br> ctn:'.number_format($sub_ex_factory_carton_qnty, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_shortage, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_excess, 2, '.', '');?></td>
										<td width="80" align="right"><?=number_format($sub_balance, 2, '.', '');?></td>
										<td width="80">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="80">&nbsp;</td>
										<td width="100">&nbsp;</td>
										<td>&nbsp;</td>
									</tr>
									<?
									$sub_po_qty = 0;
									$sub_po_qty	= 0;
									$sub_grey_req_qnty = 0;
									$sub_grey_rcv_qnty = 0;
									$sub_grey_balance_qnty = 0;
									$sub_fin_req_qnty = 0;
									$sub_finish_rcv_qnty = 0;
									$sub_finish_balance_qnty = 0;
									$sub_finish_issue_qnty = 0;
									$sub_plan_cut_qty = 0;
									$sub_cut_lay_qty = 0;
									$sub_cutting_qc_qty = 0;
									$sub_cutting_balance = 0;
									$sub_print_issue_inhouse  = 0;
									$sub_print_rcv_inhouse	= 0;
									$sub_print_balance = 0;
									$sub_emb_issue_inhouse = 0;
									$sub_emb_rcv_inhouse  = 0;
									$sub_emb_balance = 0;
									$sub_ttl_sewingin_qnty = 0;
									$sub_ttl_sewingout_qnty = 0;
									$sub_ttl_sewing_balance = 0;
									$sub_poly_qnty	= 0;
									$sub_poly_balance = 0;
									$sub_ex_factory_qnty = 0;
									$sub_ex_factory_carton_qnty	= 0;
									$sub_shortage	= 0;
									$sub_excess = 0;
									$sub_balance = 0;
									$sub_swing_balance = 0;;
								}
							}

							?>

							<tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_2nd<? echo $k; ?>', '<? echo $bgcolor; ?>')" id="tr_2nd<? echo $k; ?>">
							<td width="30" align="center" title="<?= $item_id;?>"><?= $i;?></td>
							<td width="100" align="center"><?= $order_status[$orderRes[csf("is_confirmed")]];?></td>
							<td width="100" align="center"><?= $main_booking;?></td>
							<td width="130" align="center"><?= $orderRes[csf("style_ref_no")];?></td>
							<td width="100" align="center"><?= $buyerArr[$orderRes[csf("buyer_name")]];?></td>
							<td width="80" align="center"><p><?= $orderRes[csf("job_no")];?></p></td>
							<td width="60" align="center"><p><?= $buyer_short_library[$orderRes[csf("buyer_name_chk")]];?></p></td>
							<td width="80" align="center"><p><?= change_date_format($date_title)?></p></td>
							<td width="100" align="center"><p><?= $daysOnHand.$font_end;?></p></td>
							<td width="80" align="center"><p><?= change_date_format($tna_info_arr[12][$orderRes[csf("id")]]['task_start_date'])?></p></td>
							<td width="120" align="center" title="<?= $orderRes[csf("id")];?>"><p><?= $orderRes[csf("po_number")];?></p></td>
							<td width="130" align="center"><p><?= $garments_item[$item_id];?></p></td>
							<?
							echo '<td width="70" align="right"><a href="##" onclick="openmypage_order('.$po_id.",".$company_name.",".$item_id.",0,'OrderPopup'".')">'.number_format($po_quantity_in_pcs, 2, '.', '').'</a></td>';
							?>
							<td width="80" align="center"><p><?= change_date_format($system_date)?></p></td>
							<td width="80" align="center"><p><?= change_date_format($tna_info_arr[60][$orderRes[csf("id")]]['task_start_date'])?></p></td>
							<td width="80" align="center"><p><?= change_date_format($tna_info_arr[60][$orderRes[csf("id")]]['task_finish_date'])?></p></td>

							<td width="80" align="right"><p><?= number_format($grey_req_qnty, 2, '.', '');?></p></td>
							<?
							echo '<td width="100" align="right"><a href="##" onclick="openmypage_finrcv_popup('.$po_id.",".$company_name.",".$item_id.",0,0,'greyRcvPopup'".')">'.number_format($grey_rcv_qnty, 2, '.', '').'</a></td>';
							?>
							<td width="80" align="right"><p><?= number_format($grey_balance_qnty, 2, '.', '');?></p></td>
							<td width="80" align="center"><p><?= chop($ord_color,',');?></p></td>
							<td width="80" align="center"><p><?= change_date_format($tna_info_arr[61][$orderRes[csf("id")]]['task_start_date']);?></p></td>
							<td width="80" align="center"><p><?= change_date_format($tna_info_arr[61][$orderRes[csf("id")]]['task_finish_date']);?></p></td>
							<td width="80" align="right"><p><?= number_format($fin_req_qnty, 2, '.', '');?></p></td>
							<?
							echo '<td width="80" align="right"><a href="##" onclick="openmypage_finrcv_popup('.$po_id.",".$company_name.",".$item_id.",0,0,'finishRcvPopup'".')">'.number_format($finish_rcv_qnty, 2, '.', '').'</a></td>';
							?>
							<td width="80" align="right"><p><?= number_format($finish_balance_qnty, 2, '.', '');?></p></td>
							<?
							echo '<td width="80" align="right"><a href="##" onclick="openmypage_finissue_popup('.$po_id.",".$company_name.",".$item_id.",0,0,'finishissuePopup'".')">'.number_format($finish_issue_qnty, 2, '.', '').'</a></td>';
							?>
							<td width="80" align="right"><p><?= number_format($plan_cut_qnty, 2, '.', '');?></p></td>
							<td width="80" align="center"><p><?= change_date_format($tna_info_arr[84][$orderRes[csf("id")]]['task_start_date']);?></p></td>
							<td width="80" align="center"><p><?= change_date_format($tna_info_arr[84][$orderRes[csf("id")]]['task_finish_date']);?></p></td>
							<?
							echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','17','1','product_popup'".')">'.number_format($cut_lay_arrs[$orderRes[csf("id")]][$item_id], 2, '.', '').'</a></p></td>

							<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','1','0','product_popup'".')">'.number_format($cutting_qnty, 2, '.', '').'</a></p></td>';
							?>
							<td width="80" align="right"><p><?= $cutting_balance;?></p></td>
							<?
							echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','1*1','product_popup'".')">'.number_format($print_issue_inhouse+$print_issue_subcon, 2, '.', '').'</a></p></td>
							<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','1*1','product_popup'".')">'.number_format($print_rcv_inhouse+$print_rcv_subcon, 2, '.', '').'</a></p></td>';
							?>
							<td width="80" align="right"><p><?= number_format(($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon), 2, '.', '');?></p></td>
							<?
							echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','1*2','product_popup'".')">'.number_format($emb_issue_inhouse+$emb_issue_subcon, 2, '.', '').'</a></p></td>

							<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','1*2','product_popup'".')">'.number_format($emb_rcv_inhouse+$emb_rcv_subcon, 2, '.', '').'</a></p></td>';
							?>
							<td width="80" align="right"><p><?= number_format(($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon), 2, '.', '');?></p></td>
							<?
							echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','4','1','product_popup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon), 2, '.', '').'</a></p></td>
							<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','5','1','product_popup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty), 2, '.', '').'</a></p></td>';
							?>
							<td width="80" align="right"><p><?= number_format(($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty), 2, '.', '');?></p></td>
							<td width="80" align="right"><p><?= number_format(($sewingout_subcon+$sewingout_qnty)-$po_quantity_in_pcs, 2, '.', '');?></p></td>
							<td width="80" align="right"><p><?= number_format($poly_qnty, 2, '.', '');?></p></td>
							<td width="80" align="right"><p><?= number_format(($sewingout_subcon+$sewingout_qnty)-$poly_qnty, 2, '.', '');?></p></td>
							<?
							echo '<td width="80" align="right"><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','10','1','product_popup'".')">'.number_format($ex_factory_qnty, 2, '.', '').' </a> <br>  Ctn: '.number_format($ex_factory_carton_qnty, 2, '.', '').'</td>';
							?>
							<td width="80" align="right"><?= $shortage;?></td>
							<td width="80" align="right"><p><?= $excess;?></p></td>
							<td width="80" align="right"><?= number_format($balance, 2, '.', '');?></td>
							<td width="80" align="right"><p><?= $floor_arr[$sewing_floor_id];?></p></td>
							<td width="80" align="right"><p><?= $sewing_line_no;?></p></td>
							<?
							echo '<td width="80" align="right"><a href="##" onclick="openmypage_trims_popup('.$po_id.",".$company_name.",".$item_id.",0,'trimsPopup'".')">Trims Status</a></td>
							<td width="80" align="center">'.$dealing_merchant_library[$orderRes[csf("dealing_marchant")]].'</td>
							<td width="100" align="center">'.$shipment_status_arr[$orderRes[csf("shiping_status")]].'</td>
							<td align="center">&nbsp;<a href="##" onclick="openmypage_color_countyr_remark('.$po_id.",'".$item_id."','0','','product_all_remarks'".')">Remarks</a></td>';
							?>
							</tr>
							<?

							//=============Start For Sub Total==========================
							$sub_po_qty	+=$po_quantity_in_pcs;
							$sub_grey_req_qnty +=$grey_req_qnty;
							$sub_grey_rcv_qnty +=$grey_rcv_qnty;
							$sub_grey_balance_qnty +=$grey_balance_qnty;
							$sub_fin_req_qnty +=$fin_req_qnty;
							$sub_finish_rcv_qnty +=$finish_rcv_qnty;
							$sub_finish_balance_qnty +=$finish_balance_qnty;
							$sub_finish_issue_qnty +=$finish_issue_qnty;
							$sub_plan_cut_qty += $plan_cut_qnty;
							$sub_cut_lay_qty +=($cut_lay_arrs[$orderRes[csf("id")]][$item_id]);
							$sub_cutting_qc_qty += $cutting_qnty;
							$sub_cutting_balance += $cutting_balance;
							$sub_print_issue_inhouse   += ($print_issue_inhouse+$print_issue_subcon);
							$sub_print_rcv_inhouse	 += ($print_rcv_inhouse+$print_rcv_subcon);
							$sub_print_balance +=($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon);
							$sub_emb_issue_inhouse +=($emb_issue_inhouse+$emb_issue_subcon);
							$sub_emb_rcv_inhouse       += ($emb_rcv_inhouse+$emb_rcv_subcon);
							$sub_emb_balance +=($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon);
							$sub_ttl_sewingin_qnty +=$sewingin_qnty+$sewingin_subcon;
							$sub_ttl_sewingout_qnty += ($sewingout_qnty+$sewingout_subcon);
							$sub_ttl_sewing_balance +=($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty);
							$sub_poly_qnty				+= $poly_qnty;
							$sub_poly_balance +=($sewingout_subcon+$sewingout_qnty)-$poly_qnty;
							$sub_ex_factory_qnty			+=	$ex_factory_qnty;
							$sub_ex_factory_carton_qnty		+= $ex_factory_carton_qnty;
							$sub_shortage				+=	$shortage;
							$sub_excess					+= $excess;
							$sub_balance				+= $balance;
							$sub_swing_balance			+= ($sewingout_subcon+$sewingout_qnty)-$po_quantity_in_pcs;

							//=============End For Sub Total==========================

						}
					} //end for loop
				}// end main foreach  exfactory

				?>
				<tr bgcolor="#CCCCCC" style="font-weight:bold">
					<td width="30">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="130">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="60">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="120">&nbsp;</td>
					<td width="130" align="right"><b>Job Wise Sub Total:</b></td>
					<td width="70" align="right"><?=number_format($sub_po_qty, 2, '.', '');?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><?=number_format($sub_grey_req_qnty, 2, '.', '');?></td>
					<td width="100" align="right"><?=number_format($sub_grey_rcv_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_grey_balance_qnty, 2, '.', '');?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><?=number_format($sub_fin_req_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_finish_rcv_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_finish_balance_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_finish_issue_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_plan_cut_qty, 2, '.', '');?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><?=number_format($sub_cut_lay_qty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_cutting_qc_qty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_cutting_balance, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_print_issue_inhouse, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_print_rcv_inhouse, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_print_balance, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_emb_issue_inhouse, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_emb_rcv_inhouse, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_emb_balance, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_ttl_sewingin_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_ttl_sewingout_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_ttl_sewing_balance, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_swing_balance, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_poly_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_poly_balance, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_ex_factory_qnty, 2, '.', '').'<br> ctn:'.number_format($sub_ex_factory_carton_qnty, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_shortage, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_excess, 2, '.', '');?></td>
					<td width="80" align="right"><?=number_format($sub_balance, 2, '.', '');?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
				</table>
				<table border="1" class="tbl_bottom" width="4545" rules="all" id="report_table_footer" ><!-- 4150 -->

					<tr style="font-weight:bold;">
                        <td width="30">&nbsp;</td>
                        <td width="100">&nbsp;</td>
                        <td width="100">&nbsp;</td>
						<td width="130">&nbsp;</td>
						<td width="100">&nbsp;</td>
                        <td width="80">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="80">&nbsp;</td>
                        <td width="100">&nbsp;</td>
                        <td width="80">&nbsp;</td>
						<td width="120">&nbsp;</td>
						<td width="130" align="right"><b>Grand Total:</b></td>
						<td width="70" align="right"><?=number_format($gt_po_qty, 2, '.', '');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_grey_req_qnty, 2, '.', '');?></td>
						<td width="100"><?=number_format($gt_grey_rcv_qnty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_grey_balance_qnty, 2, '.', '');?></td>
                        <td width="80">&nbsp;</td>
                        <td width="80">&nbsp;</td>
                        <td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_fin_req_qnty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_finish_rcv_qnty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_finish_balance_qnty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_finish_issue_qnty, 2, '.', '');?></td>
                        <td width="80"><?=number_format($gt_plan_cut_qty, 2, '.', '');?></td>
                        <td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_cut_lay_qty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_cutting_qc_qty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_cutting_balance, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_print_issue_inhouse, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_print_rcv_inhouse, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_print_balance, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_emb_issue_inhouse, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_emb_rcv_inhouse, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_emb_balance, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_ttl_sewingin_qnty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_ttl_sewingout_qnty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_ttl_sewing_balance, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_swing_balance, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_poly_qnty, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_poly_balance, 2, '.', '');?></td>
                        <td width="80"><?=number_format($gt_ex_factory_qnty, 2, '.', '').'<br> ctn:'.number_format($gt_ex_factory_carton_qnty, 2, '.', '');?></td>
                        <td width="80"><?=number_format($gt_shortage, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_excess, 2, '.', '');?></td>
						<td width="80"><?=number_format($gt_balance, 2, '.', '');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</div>
		 </div>
		<?
	}
	else if($type==2) //color wise
	{
		$str_po_cond="";

		if($cbo_company_name!=0) $str_po_cond.=" and a.company_name in($cbo_company_name)";

		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";

		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				//$str_po_cond .=" and b.shiping_status in(1,2)";
				$str_po_cond .=" and b.shiping_status in(2,3)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		// if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";

		if($txt_date_from!="" && $txt_date_to!="")
		{
			if($db_type==0)
			{
				$start_date = date('Y-m-d H:i:s',strtotime($txt_date_from));
				$end_date = date("Y-m-d",strtotime($txt_date_to));

				if($cbo_date_type==1){
					$start_date = date('Y-m-d',strtotime($txt_date_from));
					$str_po_cond .=" and b.pub_shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==2)
				{
					$str_po_cond .=" and b.shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==3)
				{
					$start_date = date('Y-m-d',strtotime($txt_date_from));
					$str_po_cond .=" and b.po_received_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==4)
				{
					$str_po_cond .=" and b.insert_date between '".$start_date."' and '".$end_date." 23:59:59'";
				}
			}
			else
			{
				$start_date = change_date_format(date("Y-m-d H:i:s",strtotime($txt_date_from)),'','',1);
				$end_date = change_date_format(date("Y-m-d H:i:s",strtotime($txt_date_to)),'','',1);

				if(str_replace("'","",$cbo_date_type)==1)
				{
					$str_po_cond .=" and b.pub_shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif(str_replace("'","",$cbo_date_type)==2)
				{
					$str_po_cond .=" and b.shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif(str_replace("'","",$cbo_date_type)==3)
				{
					$str_po_cond .=" and b.po_received_date between '".$start_date."' and '".$end_date."'";
				}
				elseif(str_replace("'","",$cbo_date_type)==4)
				{
					$str_po_cond.=" and b.insert_date between '".$start_date."' and '".$end_date." 11:59:59 PM'";
				}
			}
		}

		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";

		$order_sql="SELECT a.id as job_id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.id as po_id, b.po_number, b.pub_shipment_date, b.shipment_date, b.po_received_date, b.insert_date, b.excess_cut,  b.is_confirmed,b.pack_handover_date, b.grouping, c.item_number_id as item_number_id, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total, max(b.shiping_status) as shiping_status, sum(c.plan_cut_qnty) as plan_cut_qnty,a.dealing_marchant
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active in(1,2,3) and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $active_cond $order_status_cond $str_po_cond $txt_style_ref_number_cond
		group by a.id,a.job_no_prefix_num,a.job_no,a.insert_date,a.company_name,a.buyer_name,a.style_ref_no,b.id,b.po_number, b.pub_shipment_date, b.shipment_date, b.po_received_date, b.insert_date, b.excess_cut, b.is_confirmed,b.pack_handover_date, b.grouping, c.item_number_id, c.color_number_id, a.dealing_marchant
		order by a.id, c.item_number_id,c.color_number_id";
		//echo $order_sql;die;
		$po_id_arr = array();$all_po_id_arr=array();
		$sql_po_result=sql_select($order_sql);
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("po_id")].",";
			$all_po_id_arr[$row[csf("po_id")]]=$row[csf("po_id")];

			$po_id_arr[$row[csf("po_id")]] = $row[csf("po_id")];
		}

		//echo "<pre>";print_r($booking_no_arr);die;

		//=================================== Delete Order Id From TEMP ENGINE ====================================
		$con = connect();
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 138 and ref_from in(2)");
		oci_commit($con);
		//=================================== Insert order_id into TEMP ENGINE ====================================
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 138, 2,$all_po_id_arr, $empty_arr);
		oci_commit($con);



		//echo count(explode(",",$all_po_id));die;
		$template_id_arr=return_library_array("SELECT a.po_number_id, a.template_id from tna_process_mst a,GBL_TEMP_ENGINE b where a.po_number_id =b.ref_val and b.entry_form=138 and b.ref_from=2 and b.user_id=$user_id group by a.po_number_id, a.template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and a.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(explode(",",$all_po_id),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (a.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or a.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}

			}
		}


		if($po_product_cond=="")
		{
			echo '<div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">No Data Found.</div>'; die;
		}

		// echo $po_product_cond;die();
		// ========================================== cut and lay data =================================

		$sql_cutlay="SELECT a.entry_form,a.entry_date,a.end_date,b.gmt_item_id as gmts,b.color_id,c.order_id,sum(c.size_qty ) as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,GBL_TEMP_ENGINE d where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id =d.ref_val and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id in($cbo_company_name) and d.entry_form=138 and d.ref_from=2 and d.user_id=$user_id group by a.entry_form,a.entry_date,a.end_date,b.gmt_item_id,b.color_id,c.order_id"; //b.order_id,
		//echo $sql_cutlay;die();

		$sql_res=sql_select($sql_cutlay);
		$cut_lay_arrs = array();
		$cut_lay_date_arrs = array();
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];

			if($entry_form!=76)
			{
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
				$cut_lay_date_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]["entry_date"]=$vals[csf("entry_date")];
				$cut_lay_date_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]["end_date"]=$vals[csf("end_date")];
			}
			else
			{
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
				$cut_lay_date_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]["entry_date"]=$vals[csf("entry_date")];
				$cut_lay_date_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]["end_date"]=$vals[csf("end_date")];
			}


			$po_id_arr[$vals[csf("order_id")]] =$vals[csf("order_id")];
		}
		//echo "<pre>";print_r($cut_lay_date_arrs);

		$color_id_arr=return_library_array("SELECT a.id,a.color_number_id from wo_po_color_size_breakdown a, GBL_TEMP_ENGINE b where a.po_break_down_id=b.ref_val and b.entry_form=138 and b.ref_from=2 and b.user_id=$user_id and a.color_number_id>0  ", "id", "color_number_id");

		$ex_factory_data=sql_select("SELECT a.po_break_down_id, a.item_number_id, b.color_size_break_down_id, MAX(a.ex_factory_date) AS ex_factory_date,
		sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as ex_factory_qnty,a.total_carton_qnty
		from pro_ex_factory_mst a, pro_ex_factory_dtls b , wo_po_color_size_breakdown e, GBL_TEMP_ENGINE d
		where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and e.po_break_down_id=a.po_break_down_id and e.id=b.color_size_break_down_id and e.status_active=1 and e.is_deleted=0 and a.po_break_down_id =d.ref_val and d.entry_form=138 and d.ref_from=2 and d.user_id=$user_id
		group by a.po_break_down_id, a.item_number_id, b.color_size_break_down_id,a.total_carton_qnty");

		$ex_factory_arr=array();
		foreach($ex_factory_data as $exRow)
		{
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['date']=$exRow[csf('ex_factory_date')];
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['qty']+=$exRow[csf('ex_factory_qnty')];
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['ex_fac_carton_qty']=$exRow[csf('total_carton_qnty')];
            $po_id_arr[$exRow[csf('po_break_down_id')]] = $exRow[csf('po_break_down_id')] ;
		}
		// echo "<pre>";
		// print_r($ex_factory_arr);
		unset($ex_factory_data);
		if($db_type==0)
		{
			$prod_sql="SELECT a.po_break_down_id, a.item_number_id, b.color_size_break_down_id , max(a.re_production_qty) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3'  and b.production_type='3' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN a.production_type ='3'  and b.production_type='3' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN a.production_type ='2'  and b.production_type='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='2'  and b.production_type='2' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

				IFNULL(sum(CASE WHEN a.production_type ='4'  and b.production_type='4' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='4'  and b.production_type='4' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='5'  and b.production_type='5' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type=5 THEN b.production_qnty ELSE 0 END),0) AS trans_in_qty,
				IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type=6 THEN b.production_qnty ELSE 0 END),0) AS trans_out_qty,


				IFNULL(sum(CASE WHEN a.production_type ='11' and b.production_type='11'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS poly_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='11'  and b.production_type='11' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS poly_qnty_out,



				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='8'  and b.production_type='8' and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN a.production_type ='1'  and b.production_type='1'  THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3'  and b.production_type='3'  THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8'  and b.production_type='8'  THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  THEN b.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c,GBL_TEMP_ENGINE d
			where
				a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  and b.color_size_break_down_id>0 $active_cond_c and a.po_break_down_id =d.ref_val and d.entry_form=138 and d.ref_from=2 and d.user_id=$user_id
			group by a.po_break_down_id, a.item_number_id,b.color_size_break_down_id";

			$sql_carton_qty=sql_select("SELECT a.po_break_down_id,b.color_size_break_down_id,
			IFNULL(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a, pro_garments_production_dtls b,GBL_TEMP_ENGINE d
			where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.carton_qty>0 and a.po_break_down_id =d.ref_val and d.entry_form=138 and d.ref_from=2 and d.user_id=$user_id
			group by a.po_break_down_id,b.color_size_break_down_id");
		}
		else
		{
			$prod_sql= "SELECT a.po_break_down_id, a.item_number_id, b.color_size_break_down_id , max(a.re_production_qty) AS re_iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='3'  and b.production_type='3' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN a.production_type ='2'  and b.production_type='2'and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=5 THEN b.production_qnty ELSE 0 END),0) AS trans_in_qty,
				NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=6 THEN b.production_qnty ELSE 0 END),0) AS trans_out_qty,


				NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS poly_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS poly_qnty_out,


				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type='7' THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8'  and b.production_type='8' THEN b.production_qnty ELSE 0 END),0) AS finish_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan=0 THEN b.reject_qty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan!=0 THEN b.production_qnty ELSE 0 END),0) AS sewingout_rej_qnty,

				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan=0 THEN b.reject_qty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan!=0 THEN b.production_qnty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' THEN b.replace_qty ELSE 0 END),0) AS sewingout_rej_qnty_old
			from
				pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c,GBL_TEMP_ENGINE d
			where
				a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  and b.color_size_break_down_id>0 $active_cond_c $str_cond_product and a.po_break_down_id =d.ref_val and d.entry_form=138 and d.ref_from=2 and d.user_id=$user_id
			group by a.po_break_down_id, a.item_number_id, b.color_size_break_down_id";


			$sql_carton_qty=sql_select("SELECT a.po_break_down_id,b.color_size_break_down_id,
				nvl(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
				nvl(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
				nvl(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
				from pro_garments_production_mst a, pro_garments_production_dtls b,GBL_TEMP_ENGINE d
				where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.carton_qty>0 and a.po_break_down_id =d.ref_val and d.entry_form=138 and d.ref_from=2 and d.user_id=$user_id
				group by a.po_break_down_id,b.color_size_break_down_id");
			//$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject;
		}

		//sql test
		//echo $prod_sql;die;
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		  $po_id_arr[$crtn[csf("po_break_down_id")]]=$crtn[csf("po_break_down_id")];
		}

		//print_r($carton_arr);
		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_qnty']+=$gmtsRow[csf('cutting_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printing_qnty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['wash']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printreceived_qnty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printr']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['embr']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['washr']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['specialr']+=$gmtsRow[csf('specialr')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];


			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_qnty_in']+=$gmtsRow[csf('poly_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_qnty_out']+=$gmtsRow[csf('poly_qnty_out')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_in']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_in']+=$gmtsRow[csf('sewingout_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_out']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			//$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_qnty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['re_iron_qnty']+=$gmtsRow[csf('re_iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_rej_qnty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rej_qnty']+=$gmtsRow[csf('emb_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_rej_qnty']+=$gmtsRow[csf('iron_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_rej_qnty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_rej_qnty']+=$gmtsRow[csf('finish_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_rej_qnty']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewing_input_rej_qnty']+=$gmtsRow[csf('sewing_input_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_rej_qnty']+=$gmtsRow[csf('emb_issue_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_in_qty']+=$gmtsRow[csf('trans_in_qty')];

			//$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];

			$po_id_arr[$gmtsRow[csf('po_break_down_id')]]=$gmtsRow[csf('po_break_down_id')];
		}
		//$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject;

		//echo "<pre>";print_r($gmtsRow[csf('po_break_down_id')]);die;

		unset($res_gmtsData);

		$sql_wo="SELECT b.po_break_down_id, a.id, a.booking_no, a.insert_date, a.item_category, a.fabric_source, a.company_id, a.booking_type, a.booking_no_prefix_num, a.job_no, a.is_short, a.is_approved, a.po_break_down_id as wo_po_id,a.entry_form, b.fabric_color_id, sum(b.fin_fab_qnty) as fin_req_qnty, sum(b.grey_fab_qnty) as grey_req_qnty,b.gmts_color_id from wo_booking_mst a, wo_booking_dtls b, gbl_temp_engine d where a.booking_no=b.booking_no and a.item_category in(2,3,13) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.po_break_down_id=d.ref_val and d.user_id = ".$user_id." and d.entry_form=138 and d.ref_from=2 group by b.po_break_down_id, a.id, a.booking_no, a.insert_date, a.item_category, a.fabric_source, a.company_id, a.booking_type, a.booking_no_prefix_num, a.job_no, a.is_short, a.is_approved, a.po_break_down_id,a.entry_form, b.fabric_color_id, b.gmts_color_id";
		//echo $sql_wo;die;
		$resultWo=sql_select($sql_wo);

		$dataArrayWo=array(); $fab_source_arr=array(); $bookingEntryFromArr=array();
		foreach($resultWo as $woRow)
		{
			$dataArrayWo[$woRow[csf('po_break_down_id')]][$woRow[csf('gmts_color_id')]].=$woRow[csf('id')]."**".$woRow[csf('booking_no')]."**".$woRow[csf('insert_date')]."**".$woRow[csf('item_category')]."**".$woRow[csf('fabric_source')]."**".$woRow[csf('company_id')]."**".$woRow[csf('booking_type')]."**".$woRow[csf('booking_no_prefix_num')]."**".$woRow[csf('job_no')]."**".$woRow[csf('is_short')]."**".$woRow[csf('is_approved')]."**".$woRow[csf('fabric_color_id')]."**".$woRow[csf('fin_req_qnty')]."**".$woRow[csf('grey_req_qnty')]."**".$woRow[csf('wo_po_id')]."__";

			$fab_source_arr[$woRow[csf('po_break_down_id')]].=$woRow[csf('fabric_source')].',';
			$bookingEntryFromArr[$woRow[csf('booking_no')]]=$woRow[csf('entry_form')];
		}
		//echo "<pre>";print_r($dataArrayWo);die;
		unset($resultWo);

		$grey_fin_rcv_sql = "SELECT a.po_breakdown_id, a.entry_form, a.quantity, a.color_id FROM order_wise_pro_details a, gbl_temp_engine b WHERE a.entry_form in(18,22,37,58,68,71,225) AND a.status_active = 1 AND a.is_deleted = 0 AND a.po_breakdown_id = b.ref_val AND b.user_id = ".$user_id." and b.entry_form=138 and b.ref_from=2";

		//echo $grey_fin_rcv_sql;die;
		$resultGreyFinRcv=sql_select($grey_fin_rcv_sql);
		$grey_rcv_info_arr=array();
		$fin_rcv_info_arr=array();
		$fin_issue_info_arr=array();
		foreach($resultGreyFinRcv as $row)
		{
			if($row[csf('entry_form')]==58 || $row[csf('entry_form')]==22)
			{
				$grey_rcv_info_arr[$row[csf('po_breakdown_id')]]['grey_receive_qnty'] += $row[csf('quantity')];
			}
			else if($row[csf('entry_form')]==37 || $row[csf('entry_form')]==68 || $row[csf('entry_form')]==225)
			{
				$fin_rcv_info_arr[$row[csf('po_breakdown_id')]][$row[csf('color_id')]]['finish_receive_qnty'] += $row[csf('quantity')];
			}
			else if($row[csf('entry_form')]==18 || $row[csf('entry_form')]==71)
			{
				$fin_issue_info_arr[$row[csf('po_breakdown_id')]][$row[csf('color_id')]]['finish_issue_qnty'] += $row[csf('quantity')];
			}

		}
		//echo "<pre>";print_r($fin_rcv_info_arr);die;
		unset($resultGreyFinRcv);

		$sql_finish_return = "SELECT b.po_breakdown_id, b.quantity, b.color_id FROM inv_transaction a, order_wise_pro_details b,  gbl_temp_engine c WHERE a.id = b.trans_id AND b.entry_form IN (46, 52) AND a.transaction_type IN (3, 4) AND a.status_active = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0 AND b.po_breakdown_id = c.ref_val AND c.user_id = ".$user_id." and c.entry_form=138 and c.ref_from=2";

		//echo $sql_finish_return;die;
		$resultGreyFinRtn=sql_select($sql_finish_return);

		$fin_rtn_info_arr=array();
		foreach($resultGreyFinRtn as $row)
		{
			$fin_rtn_info_arr[$row[csf('po_breakdown_id')]][$row[csf('color_id')]]['fin_rtn_qnty'] += $row[csf('quantity')];
		}
		//echo "<pre>";print_r($fin_rtn_info_arr);die;
		unset($resultGreyFinRtn);

		$b_swing_sql = "SELECT a.id, a.floor_id,a.sewing_line,b.item_number_id,c.po_number, c.id as po_id, f.color_number_id from pro_gmts_delivery_mst a,pro_garments_production_mst b, wo_po_break_down c,pro_garments_production_dtls d, wo_po_color_size_breakdown f, gbl_temp_engine e where  b.po_break_down_id=c.id and a.id=b.delivery_mst_id and b.id=d.mst_id and d.color_size_break_down_id=f.id and a.production_type=4 and b.production_type=4 and a.status_active=1 and a.is_deleted=0 and a.company_id in($cbo_company_name) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.id = e.ref_val and e.user_id = ".$user_id." and e.entry_form=138 and e.ref_from=2 group by a.id, a.floor_id,a.sewing_line,b.item_number_id,c.po_number,c.id, f.color_number_id";
		//echo $b_swing_sql;die;
		$resultBSwing=sql_select($b_swing_sql);

		$bundleSwingArr = array();
		foreach($resultBSwing as $row)
		{
			$bundleSwingArr[$row[csf('po_id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]]['floor_id'] = $row[csf('floor_id')];
			$bundleSwingArr[$row[csf('po_id')]][$row[csf('item_number_id')]][$row[csf('color_number_id')]]['sewing_line'] = $row[csf('sewing_line')];
		}
		//echo "<pre>";print_r($bundleSwingArr);die;
		unset($resultBSwing);

		$sql_tna = "SELECT a.job_no, b.po_number, p.po_number_id, p.task_number, MIN ( CASE WHEN p.task_start_date IS NOT NULL THEN p.task_start_date END) AS task_start_date, MAX (p.task_finish_date) AS task_finish_date, d.color_id  FROM tna_process_mst p, wo_po_details_master a, wo_po_break_down b, order_wise_pro_details d, gbl_temp_engine c WHERE p.po_number_id = b.id AND b.job_no_mst = a.job_no AND b.id=d.po_breakdown_id AND d.color_id>0 AND p.task_number IN (12,60,61,84) AND b.id = c.ref_val AND c.user_id = ".$user_id." AND c.entry_form=138 AND c.ref_from=2 GROUP BY a.job_no, b.po_number, p.po_number_id, p.task_number, d.color_id";

		//echo $sql_tna;die;
		$sql_tna_res = sql_select($sql_tna);
		$tna_info_arr = array();
		foreach ($sql_tna_res as $row)
		{
			$tna_info_arr[$row[csf('task_number')]][$row[csf('po_number_id')]][$row[csf('color_id')]]['task_start_date'] = $row[csf('task_start_date')];
			$tna_info_arr[$row[csf('task_number')]][$row[csf('po_number_id')]][$row[csf('color_id')]]['task_finish_date'] = $row[csf('task_finish_date')];
		}
		//echo "<pre>";print_r($tna_info_arr);
		unset($sql_tna_res);


		$fromDate = change_date_format( str_replace("'","",trim($txt_date_from)) );
		$toDate = change_date_format( str_replace("'","",trim($txt_date_to)) );

		execute_query("delete from gbl_temp_engine where user_id = ".$user_id." and ref_from =2 and entry_form=138");
		oci_commit($con);
		disconnect($con);

		ob_start();

		?>
        <div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						<?
							echo "Order Wise Fabric to RMG Production Status Report";

						?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						<!-- Company Name : <? echo $company_library[str_replace("'","",$cbo_company_name)]; ?> -->
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">
						<?
							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								echo "From $fromDate To $toDate";
							}
						?>
					</td>
				</tr>
			</table>

			</div>

			<div style="clear:both"></div>
			<table width="4545" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1">
				<thead>
					<tr>
						<th width="30">SL</th>
                        <th width="100">Order Status</th>
                        <th width="100">Main Fabric Booking No</th>
						<th width="130">Style</th>
						<th width="100">Buyer</th>
                        <th width="80">Job No</th>
						<th width="60">File Rcv. Date</th>
						<th width="80"><? echo $date_caption;?></th>
                        <th width="100">Lead Time</th>
                        <th width="80">PP App date</th>
						<th width="120">Order No.</th>
						<th width="130">Item Name</th>
						<th width="70">Order Qty</th>
						<th width="80">Fabric Booking Date</th>
						<th width="80">Knitting Start Date</th>
						<th width="80">Knitting End Date</th>
						<th width="80">Grey Fabric req.</th>
						<th width="100">Grey Fabric Received</th>
						<th width="80">Balance</th>
                        <th width="80">Colour</th>
                        <th width="80">Dye.Star date</th>
                        <th width="80">Dye.End date</th>
						<th width="80">Finish Fabric Booking</th>
						<th width="80">Finish Fabric Received</th>
						<th width="80">Finish Fabric Balance</th>
						<th width="80">Fabrics Issue to Cut.</th>
                        <th width="80">Plan Cut Qty</th>
                        <th width="80">Cutting Start Date</th>
						<th width="80">Cutting End Date</th>
						<th width="80">Cutting Lay Qty</th>
						<th width="80">Cutting QC</th>
						<th width="80">Cutting Balance</th>
						<th  width="80">Print send</th>
						<th width="80">Print Received</th>
						<th width="80">Ballance</th>
						<th width="80">EMB. Send</th>
						<th width="80">EMB. Received</th>
						<th width="80">Ballance</th>
						<th width="80">Sewing Input Qty</th>
						<th width="80">Sewing Output Qty</th>
						<th width="80">Sewing WIP</th>
						<th width="80">Sewing Balance</th>
						<th width="80">Poly</th>
						<th width="80">Poly Balance</th>
                        <th width="80">Total Ex-Factory</th>
                        <th width="80">Shortage Qty.</th>
						<th width="80">Excess Qty.</th>
						<th width="80">Balance Qty</th>
						<th width="80">Running Floor</th>
						<th width="80">Line No.</th>
						<th width="80">Accessories Status</th>
						<th width="80">Concern Person</th>
						<th width="100">Shiping Status</th>
						<th>Remarks</th>
					 </tr>
				</thead>
			</table>
			<div style="max-height:425px; overflow-y:scroll; width:4565px" id="scroll_body">
				<table border="1" class="rpt_table" width="4545" rules="all" id="table_body">
				<?
				$result=sql_select($order_sql);
				$i=0; $k=0; $date=date("Y-m-d");
				$days_in_hand="";
				$date_title= "";

				$sub_po_qty = $sub_grey_req_qnty = $sub_grey_rcv_qnty = $sub_grey_balance_qnty = $sub_fin_req_qnty = $sub_finish_rcv_qnty = $sub_finish_balance_qnty = $sub_finish_issue_qnty = $sub_plan_cut_qty = $sub_cut_lay_qty = $sub_cutting_qc_qty = $sub_cutting_balance = $sub_print_issue_inhouse = $sub_print_rcv_inhouse = $sub_print_balance = $sub_emb_issue_inhouse = $sub_emb_rcv_inhouse = $sub_emb_balance = $sub_ttl_sewingin_qnty = $sub_ttl_sewingout_qnty = $sub_ttl_sewing_balance = $sub_poly_qnty = $sub_poly_balance = $sub_ex_factory_qnty = $sub_ex_factory_carton_qnty = $sub_shortage = $sub_excess = $sub_balance = $sub_sewing_balance	= 0;

				$gt_po_qty=$gt_grey_req_qnty=$gt_grey_rcv_qnty=$gt_grey_balance_qnty=$gt_fin_req_qnty=$gt_finish_rcv_qnty=$gt_finish_balance_qnty=$gt_finish_issue_qnty=$gt_plan_cut_qty=$gt_cut_lay_qty=$gt_cutting_qc_qty=$gt_cutting_balance=$gt_print_issue_inhouse=$gt_print_rcv_inhouse=$gt_print_balance=$gt_emb_issue_inhouse=$gt_emb_rcv_inhouse=$gt_emb_balance=$gt_ttl_sewingin_qnty=$gt_ttl_sewingout_qnty=$gt_ttl_sewing_balance=$gt_poly_qnty=$gt_poly_balance=$gt_ex_factory_qnty=$gt_ex_factory_carton_qnty=$gt_shortage=$gt_excess=$gt_balance=$gt_sewing_balance	= 0;

				foreach($result as $orderRes)
				{
				   $i++;
				   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

					$k++;

					$lay_qty = $cut_lay_arrs[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]];
					$cutting_start_date = $cut_lay_date_arrs[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]["entry_date"];
					$cutting_end_date = $cut_lay_date_arrs[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]["end_date"];

					$ex_factory_date=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['date'];
					$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['qty'];
					$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['ex_fac_carton_qty'];

					$color=""; $days_remian="";
					$days_remian=datediff("d",$date,$orderRes[csf("shipment_date")]);
					$days_in_hand=datediff("d",$date,$orderRes[csf("shipment_date")]);
					if($orderRes[csf("shipment_date")] > $date)
					{
						$color="";
					}
					else if($orderRes[csf("shipment_date")] < $date)
					{
						$color="red";
					}
					else if($orderRes[csf("shipment_date")] >= $date && $days_remian<=5 )
					{
						$color="orange";
					}

					$cutting_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['cutting_qnty'];
					$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['printreceived_qnty'];
					$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_in'];
					$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_in'];
					$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_out'];
					$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_out'];
					$iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['iron_qnty'];
					$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['re_iron_qnty'];
					//$finish_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty'];
					$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_inhouse'];
					$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_outbound'];

					$poly_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_qnty_in'];
					$poly_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_qnty_out'];
					$poly_qnty=$poly_qnty_inhouse+$poly_qnty_outbound;

					$print_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print'];
					$embl_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb'];
					$wash_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['wash'];
					$spwork_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['special'];
					$print_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['printr'];
					$emb_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['embr'];
					$wash_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['washr'];

					$spcial_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['specialr'];

					$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_issue_inhouse'];
					$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_issue_subcon'];
					$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_rcv_inhouse'];
					$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_rcv_subcon'];

					$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_inhouse'];
					$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_subcon'];
					$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_inhouse'];
					$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_subcon'];

					$cutting_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['cutting_rej_qnty'];
					$emb_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rej_qnty'];
					$iron_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['iron_rej_qnty'];
					$sewing_out_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_rej_qnty'];
					$finish_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_rej_qnty'];

					$poly_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_rej_qnty'];
					$sewing_input_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewing_input_rej_qnty'];
					$emb_issue_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_rej_qnty'];

					$trans_in_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['trans_in_qty'];
					$trans_out_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['trans_out_qty'];

					$cartonInQnty=$carton_arr[$orderRes[csf("po_id")]]['carton_qty_no_inhouse'];
					$cartonOutQnty=$carton_arr[$orderRes[csf("po_id")]]['carton_qty_no_outbound'];
					$cartonTotal_qnty=$carton_arr[$orderRes[csf("po_id")]]['carton_total_qty'];

					$po_id_arr[$orderRes[csf("po_id")]]=$orderRes[csf("po_id")];

					$sewing_floor_id = $bundleSwingArr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['floor_id'];
					$b_sewing_line = $bundleSwingArr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewing_line'];

					$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$orderRes[csf("order_quantity")];
					$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$orderRes[csf("order_total")];
					$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['cutQty']+=$lay_qty;
					$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
					$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
					$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
					$actual_exces_cut = $cutting_qnty;
					$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
					$total_poly_qnty=$poly_qnty_inhouse+$poly_qnty_outbound;
					if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

					$po_quantity_in_pcs=$orderRes[csf("order_quantity")];
					$plan_cut_qnty=$orderRes[csf("plan_cut_qnty")];
					$cutting_balance = $plan_cut_qnty-$cutting_qnty;
					//$actual_exces_cut = $cutting_qnty;
					$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
					$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);
					$excess_cut_percent=$short_excess_cut_percent-$orderRes[csf("excess_cut")];
					$embl_recv_qty=$print_rec+$emb_rec+$wash_rec+$spcial_rec;
					$rej_value=$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject+$poly_rej_qnty+$sewing_input_rej_qnty+$emb_issue_rej_qnty;

					$finish_status = $total_finish_qnty*100/$po_quantity_in_pcs;
					$poly_status = $total_poly_qnty*100/$po_quantity_in_pcs;

					$company_name=$orderRes[csf("company_name")];
					$po_id=$orderRes[csf("po_id")];
					$item_id=$orderRes[csf("item_number_id")];

					if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);

					if(($orderRes[csf("pack_handover_date")]=="" || $orderRes[csf("pack_handover_date")]=="0000-00-00")) $pack_handover_date="&nbsp;"; else $pack_handover_date=change_date_format($orderRes[csf("pack_handover_date")]);

					//if($orderRes[csf("shiping_status")]==3) $days_remian=$days_remian; else $days_remian="---";
					//if(round($actual_exces_cut) > round($orderRes[csf("excess_cut")])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
					$total_rej_value+=$rej_value;
					$template_id=$template_id_arr[$orderRes[csf("po_id")]];
					/// for order popup define leter
					//<a href="##" onclick="openmypage_order('.$po_id.",".$company_name.",".$item_id.",0,'OrderPopup'".')"></a>

					$shortage = 0; $excess = 0; $balance = 0;
					if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
					{
						$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

						if($shortage<0)
						{
							//$shortage = "".ltrim($shortage,"-")."";
						}
					}
					else
					{
						//$shortage="(".ltrim($shortage,"-").")";
						//$shortage = "-";
					}

					if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
					{
						$excess = $ex_factory_qnty-$po_quantity_in_pcs;
					}
					else
					{
						$excess = 0;
					}

					//echo  $gmtsRow['PO_BREAK_DOWN_ID'];
					//	echo "<pre>"

					$today= change_date_format($orderRes[csf("pub_shipment_date")],'','',1);
					$daysOnHand = datediff("d",change_date_format($orderRes[csf("po_received_date")],'','',1),$today);

					$main_booking='';$booking_array=array();$fin_req_qnty=$grey_req_qnty=0;

					$dataArray=array_filter(explode("__",$dataArrayWo[$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]));
					//echo "<pre>";print_r($dataArray);
					if(count($dataArray)>0)
					{
						foreach($dataArray as $woRow)
						{
							$woRow=explode("**",$woRow);
							$id=$woRow[0];
							$booking_no=$woRow[1];
							$insert_date=$woRow[2];
							$item_category=$woRow[3];
							$fabric_source=$woRow[4];
							$company_id=$woRow[5];
							$booking_type=$woRow[6];
							$booking_no_prefix_num=$woRow[7];
							$job_no=$woRow[8];
							$is_short=$woRow[9];
							$is_approved=$woRow[10];
							$fabric_color_id=$woRow[11];
							$fin_req_qnty+=$woRow[12];
							$grey_req_qnty+=$woRow[13];
							$wo_po_id=$woRow[14];
							$book_prefix_no = $woRow[7];

							if(!in_array($id,$booking_array))
							{
								if($bookingEntryFromArr[$booking_no]==86)
								{
									$entryForm=$bookingEntryFromArr[$booking_no];
									$reportFormat=explode(",",$print_report_format_budget_booking[0]);
									$reportFormat=$reportFormat[0];
									$action_namez=$report_format_arr[$reportFormat];
								}
								$system_date=date('d-M-Y', strtotime($insert_date));
								$wo_color = "";
								if ($fabric_source == 2) $wo_color = "color:#000"; else $wo_color = "";

								if($booking_type==4)
								{
									if($entryForm==86)
									{
										$action_name=$action_namez;
									}
									else{
										//$action_name='show_fabric_booking_report';
										$action_name=$report_format_sample_arr[$reportFormatSample];
									}

									$main_booking.="<a href='##' style='color:#000' onclick=\"generate_order_report('3','".$booking_no."','".$company_id."','".$wo_po_id."','".$item_category."','".$fabric_source."','".$job_no."','".$is_approved."','".$action_name."','".$print_report_format."','".$entryForm."')\"><font style='font-weight:bold' color='$wo_color;'>".$booking_no."</font></a><br>";
								}
								else
								{
									$all_book_prefix_no .= $book_prefix_no . ",";
									if($is_short==1)
									{
										$pre="S";
										$action_name=$report_format_arr[$booking_print_arr[2]];
									}
									else
									{
										$pre="M";
										$action_name=$report_format_arr[$booking_print_arr[1]];
									}
									if($entryForm==86)
									{
										//$action_name=$action_namez;
									}
									else if ($action_name=='') {
										$action_name='show_fabric_booking_report';
									}
									//if($is_short==1) $pre="S"; else $pre="M";

									$main_booking.="<a href='##' style='color:#000' onclick=\"generate_order_report('".$is_short."','".$booking_no."','".$company_id."','".$wo_po_id."','".$item_category."','".$fabric_source."','".$job_no."','".$is_approved."','".$action_name."','".$print_report_format."')\"><font style='font-weight:bold' color='$wo_color;'>".$booking_no.$pre."</font></a><br>";

								}

								$booking_array[]=$id;
							}
						}
					}

					$grey_rcv_qnty = $grey_rcv_info_arr[$orderRes[csf("po_id")]]['grey_receive_qnty'];
					$grey_balance_qnty = $grey_req_qnty-$grey_rcv_qnty;
					$finish_rcv_qnty = $fin_rcv_info_arr[$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['finish_receive_qnty'];
					$finish_balance_qnty = $fin_req_qnty-$finish_rcv_qnty;

					$finish_iss_qnty = $fin_issue_info_arr[$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['finish_issue_qnty'];
					$finish_rtn_qnty = $fin_rtn_info_arr[$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['fin_rtn_qnty'];
					$finish_issue_qnty=$finish_iss_qnty-$finish_rtn_qnty;
					$sewing_line_no = "";
					if ($prod_reso_allocation == 1)
					{
						$sewing_line = $resource_alocate_line[$b_sewing_line];
						$sewing_line_arr = explode(",", $sewing_line);
						$sewing_line_name = "";
						foreach ($sewing_line_arr as $line_id)
						{
							$sewing_line_name .= $line_library[$line_id] . ",";
						}
						$sewing_line_name = chop($sewing_line_name, ",");
						$sewing_line_no = $sewing_line_name;
					}
					else
					{
						$sewing_line_no = $line_library[$b_sewing_line];
					}


					$balance = $ex_factory_qnty-$po_quantity_in_pcs;

					$gt_po_qty	+=$po_quantity_in_pcs;
					$gt_grey_req_qnty +=$grey_req_qnty;
					$gt_grey_rcv_qnty +=$grey_rcv_qnty;
					$gt_grey_balance_qnty +=$grey_balance_qnty;
					$gt_fin_req_qnty +=$fin_req_qnty;
					$gt_finish_rcv_qnty +=$finish_rcv_qnty;
					$gt_finish_balance_qnty +=$finish_balance_qnty;
					$gt_finish_issue_qnty +=$finish_issue_qnty;
					$gt_plan_cut_qty += $plan_cut_qnty;
					$gt_cut_lay_qty +=$lay_qty;
					$gt_cutting_qc_qty += $cutting_qnty;
					$gt_cutting_balance += $cutting_balance;
					$gt_print_issue_inhouse   += ($print_issue_inhouse+$print_issue_subcon);
					$gt_print_rcv_inhouse	 += ($print_rcv_inhouse+$print_rcv_subcon);
					$gt_print_balance +=($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon);
					$gt_emb_issue_inhouse +=($emb_issue_inhouse+$emb_issue_subcon);
					$gt_emb_rcv_inhouse       += ($emb_rcv_inhouse+$emb_rcv_subcon);
					$gt_emb_balance +=($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon);
					$gt_ttl_sewingin_qnty +=$sewingin_qnty+$sewingin_subcon;
					$gt_ttl_sewingout_qnty += ($sewingout_qnty+$sewingout_subcon);
					$gt_ttl_sewing_balance +=($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty);
					$gt_poly_qnty				+= $poly_qnty;
					$gt_poly_balance +=($sewingout_subcon+$sewingout_qnty)-$poly_qnty;
					$gt_ex_factory_qnty			+=	$ex_factory_qnty;
					$gt_ex_factory_carton_qnty		+= $ex_factory_carton_qnty;
					$gt_shortage				+=	$shortage;
					$gt_excess					+= $excess;
					$gt_balance					+= $balance;
					$gt_sewing_balance	+=($sewingin_qnty+$sewingin_subcon)-$po_quantity_in_pcs;

					if($cbo_date_type==0 || $cbo_date_type==1)
					{
						$date_title=$orderRes[csf("pub_shipment_date")];
					}
					else if($cbo_date_type==2)
					{
						$date_title=$orderRes[csf("shipment_date")];
					}
					else if($cbo_date_type==3)
					{
						$date_title=$orderRes[csf("po_received_date")];
					}
					else if($cbo_date_type==4)
					{
						$date_title=$orderRes[csf("insert_date")];
					}

					$check_string = $orderRes[csf("job_no")];

					if (!in_array($check_string, $checkArr))
					{
						$checkArr[$i] = $check_string;
						if ($i > 1)
						{
							?>
							<tr bgcolor="#CCCCCC" style="font-weight:bold">
								<td width="30">&nbsp;</td>
								<td width="100">&nbsp;</td>
								<td width="100">&nbsp;</td>
								<td width="130">&nbsp;</td>
								<td width="100">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="60">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="100">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="120">&nbsp;</td>
								<td width="130" align="right"><b>Job Wise Sub Total:</b></td>
								<td width="70" align="right"><?=number_format($sub_po_qty,2,'.','');?></td>
								<td width="80">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="80" align="right"><?=number_format($sub_grey_req_qnty,2,'.','');?></td>
								<td width="100" align="right"><?=number_format($sub_grey_rcv_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_grey_balance_qnty,2,'.','');?></td>
								<td width="80">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="80" align="right"><?=number_format($sub_fin_req_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_finish_rcv_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_finish_balance_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_finish_issue_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_plan_cut_qty,2,'.','');?></td>
								<td width="80">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="80" align="right"><?=number_format($sub_cut_lay_qty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_cutting_qc_qty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_cutting_balance,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_print_issue_inhouse,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_print_rcv_inhouse,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_print_balance,2,'.','');?>,2,'.',''</td>
								<td width="80" align="right"><?=number_format($sub_emb_issue_inhouse,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_emb_rcv_inhouse,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_emb_balance,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_ttl_sewingin_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_ttl_sewingout_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_ttl_sewing_balance,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_sewing_balance,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_poly_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_poly_balance,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_ex_factory_qnty,2,'.','').'<br> ctn:'.number_format($sub_ex_factory_carton_qnty,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_shortage,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_excess,2,'.','');?></td>
								<td width="80" align="right"><?=number_format($sub_balance,2,'.','');?></td>
								<td width="80">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="80">&nbsp;</td>
								<td width="100">&nbsp;</td>
								<td>&nbsp;</td>
							</tr>
							<?

							$sub_po_qty = 0;
							$sub_grey_req_qnty = 0;
							$sub_grey_rcv_qnty = 0;
							$sub_grey_balance_qnty = 0;
							$sub_fin_req_qnty = 0;
							$sub_finish_rcv_qnty = 0;
							$sub_finish_balance_qnty = 0;
							$sub_finish_issue_qnty = 0;
							$sub_plan_cut_qty = 0;
							$sub_cut_lay_qty = 0;
							$sub_cutting_qc_qty = 0;
							$sub_cutting_balance = 0;
							$sub_print_issue_inhouse = 0;
							$sub_print_rcv_inhouse = 0;
							$sub_print_balance = 0;
							$sub_emb_issue_inhouse = 0;
							$sub_emb_rcv_inhouse = 0;
							$sub_emb_balance = 0;
							$sub_ttl_sewingin_qnty = 0;
							$sub_ttl_sewingout_qnty = 0;
							$sub_ttl_sewing_balance = 0;
							$sub_poly_qnty = 0;
							$sub_poly_balance = 0;
							$sub_ex_factory_qnty = 0;
							$sub_ex_factory_carton_qnty = 0;
							$sub_shortage = 0;
							$sub_excess = 0;
							$sub_balance = 0;
							$sub_sewing_balance	=0;

						}
					}

					?>

					<tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_2nd<? echo $k; ?>', '<? echo $bgcolor; ?>')" id="tr_2nd<? echo $k; ?>">
						<td width="30" align="center" title="<?= $item_id;?>"><?= $i;?></td>
						<td width="100" align="center"><?= $order_status[$orderRes[csf("is_confirmed")]];?></td>
						<td width="100" align="center"><?= $main_booking;?></td>
						<td width="130" align="center"><?= $orderRes[csf("style_ref_no")]?></td>
						<td width="100" align="center"><?= $buyerArr[$orderRes[csf("buyer_name")]]?></td>
						<td width="80" align="center"><p><?= $orderRes[csf("job_no")];?></p></td>
						<td width="60" align="center"><p><?= $buyer_short_library[$orderRes[csf("buyer_name_chk")]];?></p></td>
						<td width="80" align="center"><p><?= change_date_format($date_title);?></p></td>
						<td width="100" align="center"><p><?= $daysOnHand?></p></td>
						<td width="80" align="center"><p><?= change_date_format($tna_info_arr[12][$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['task_start_date'])?></p></td>
						<td width="120" align="center" title="<?= $orderRes[csf("po_id")]?>"><p><?= $orderRes[csf("po_number")]?></p></td>
						<td width="130" align="center"><p><?= $garments_item[$item_id]?></p></td>
						<?
						echo '<td width="70" align="right"><p><a href="##" onclick="openmypage_order_country('.$po_id.",".$company_name.",".$item_id.",'0',".$orderRes[csf("color_number_id")].",'OrderPopup_country'".')">'.number_format($po_quantity_in_pcs,2,'.','').'</a></p></td>';
						?>
						<td width="80" align="center"><p><?= change_date_format($system_date)?></p></td>
						<td width="80" align="center"><p><?= change_date_format($tna_info_arr[60][$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['task_start_date'])?></p></td>
						<td width="80" align="center"><p><?= change_date_format($tna_info_arr[60][$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['task_finish_date'])?></p></td>
						<td width="80" align="right"><p><?= number_format($grey_req_qnty,2,'.','')?></p></td>
						<?
						echo '<td width="100" align="right"><a href="##" onclick="openmypage_finrcv_popup('.$po_id.",".$company_name.",".$item_id.",0,".$orderRes[csf("color_number_id")].",'greyRcvPopup'".')">'.number_format($grey_rcv_qnty,2,'.','').'</a></td>';
						?>
						<td width="80" align="right"><p><?= number_format($grey_balance_qnty,2,'.','')?></p></td>
						<td width="80" align="center"><p><?= $color_Arr_library[$orderRes[csf("color_number_id")]];?></p></td>
						<td width="80" align="center"><p><?= change_date_format($tna_info_arr[61][$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['task_start_date'])?></p></td>
						<td width="80" align="right"><p><?= change_date_format($tna_info_arr[61][$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['task_finish_date'])?></p></td>
						<td width="80" align="right"><p><?= number_format($fin_req_qnty,2,'.','')?></p></td>
						<?
						echo '<td width="80" align="right"><a href="##" onclick="openmypage_finrcv_popup('.$po_id.",".$company_name.",".$item_id.",0,".$orderRes[csf("color_number_id")].",'finishRcvPopup'".')">'.number_format($finish_rcv_qnty,2,'.','').'</a></td>';
						?>
						<td width="80" align="right"><p><?= number_format($finish_balance_qnty,2,'.','')?></p></td>
						<?
						echo '<td width="80" align="right"><a href="##" onclick="openmypage_finissue_popup('.$po_id.",".$company_name.",".$item_id.",0,".$orderRes[csf("color_number_id")].",'finishissuePopup'".')">'.number_format($finish_issue_qnty,2,'.','').'</a></td>';
						?>
						<td width="80" align="right"><p><?= number_format($plan_cut_qnty,2,'.','')?></p></td>
						<td width="80" align="center"><p><?= change_date_format($tna_info_arr[84][$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['task_start_date'])?></p></td>
						<td width="80" align="center"><p><?= change_date_format($tna_info_arr[84][$orderRes[csf("po_id")]][$orderRes[csf("color_number_id")]]['task_finish_date']);?></p></td>

						<?
						echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','17','1','product_popup'".')">'.number_format($lay_qty,2,'.','').'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','1','1','product_popup'".')">'.number_format($cutting_qnty,2,'.','').'</a></p></td>';
						?>
						<td width="80" align="right" title="(Plan Cut Qty - Cutting QC)"><p><?= $cutting_balance;?></p></td>
						<?
						echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','1*1','product_popup'".')">'.number_format($print_issue_inhouse+$print_issue_subcon,2,'.','').'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','3','1*1','product_popup'".')">'.number_format($print_rcv_inhouse+$print_rcv_subcon,2,'.','').'</a></p></td>';
						?>
						<td width="80" align="right"><p><?= number_format(($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon),2,'.','')?></p></td>
						<?
						echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','1*2','product_popup'".')">'.number_format($emb_issue_inhouse+$emb_issue_subcon,2,'.','').'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','3','1*2','product_popup'".')">'.number_format($emb_rcv_inhouse+$emb_rcv_subcon,2,'.','').'</a></p></td>';
						?>
						<td width="80" align="right"><p><?= number_format(($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon),2,'.','')?></p></td>
						<?
						echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','4','1','product_popup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon),2,'.','').'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','5','1','product_popup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),2,'.','').'</a></p></td>';
						?>
						<td width="80" align="right"><p><?= number_format(($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty),2,'.','')?></p></td>
						<td width="80" align="right"><p><?= number_format(($sewingin_qnty+$sewingin_subcon)-$po_quantity_in_pcs,2,'.','')?></p></td>
						<td width="80" align="right"><p><?= number_format($poly_qnty,2,'.','')?></p></td>
						<td width="80" align="right"><p><?= number_format(($sewingout_subcon+$sewingout_qnty)-$poly_qnty,2,'.','')?></p></td>
						<?
						echo '<td width="80" align="right"><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','10','1','product_popup'".')">'.number_format($ex_factory_qnty,2,'.','').' </a> <br>  Ctn: '.number_format($ex_factory_carton_qnty,2,'.','').'</td>';
						?>
						<td width="80" align="right"><?= $shortage;?></td>
						<td width="80" align="right"><p><?= $excess;?></p></td>
						<td width="80" align="right"><?= number_format($balance,2,'.','');?></td>
						<td width="80" align="right"><p><?= $floor_arr[$sewing_floor_id];?></p></td>
						<td width="80" align="right"><p><?= $sewing_line_no;?></p></td>
						<?
						echo '<td width="80" align="right"><a href="##" onclick="openmypage_trims_popup('.$po_id.",".$company_name.",".$item_id.",0,'trimsPopup'".')">Trims Status</a></td>';
						?>
						<td width="80" align="right"><?= $dealing_merchant_library[$orderRes[csf("dealing_marchant")]]?></td>
						<td width="100" align="center"><?= $shipment_status_arr[$orderRes[csf("shiping_status")]]?></td>
						<?
						echo '<td>&nbsp;<a href="##" onclick="openmypage_color_countyr_remark('.$po_id.",'".$item_id."','0','".$orderRes[csf("color_number_id")]."','product_all_remarks'".')">Remarks</a></td>';
						?>
					</tr>
					<?

					$sub_po_qty	+=$po_quantity_in_pcs;
					$sub_grey_req_qnty +=$grey_req_qnty;
					$sub_grey_rcv_qnty +=$grey_rcv_qnty;
					$sub_grey_balance_qnty +=$grey_balance_qnty;
					$sub_fin_req_qnty +=$fin_req_qnty;
					$sub_finish_rcv_qnty +=$finish_rcv_qnty;
					$sub_finish_balance_qnty +=$finish_balance_qnty;
					$sub_finish_issue_qnty +=$finish_issue_qnty;
					$sub_plan_cut_qty += $plan_cut_qnty;
					$sub_cut_lay_qty +=$lay_qty;
					$sub_cutting_qc_qty += $cutting_qnty;
					$sub_cutting_balance += $cutting_balance;
					$sub_print_issue_inhouse   += ($print_issue_inhouse+$print_issue_subcon);
					$sub_print_rcv_inhouse	 += ($print_rcv_inhouse+$print_rcv_subcon);
					$sub_print_balance +=($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon);
					$sub_emb_issue_inhouse +=($emb_issue_inhouse+$emb_issue_subcon);
					$sub_emb_rcv_inhouse       += ($emb_rcv_inhouse+$emb_rcv_subcon);
					$sub_emb_balance +=($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon);
					$sub_ttl_sewingin_qnty +=$sewingin_qnty+$sewingin_subcon;
					$sub_ttl_sewingout_qnty += ($sewingout_qnty+$sewingout_subcon);
					$sub_ttl_sewing_balance +=($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty);
					$sub_poly_qnty				+= $poly_qnty;
					$sub_poly_balance +=($sewingout_subcon+$sewingout_qnty)-$poly_qnty;
					$sub_ex_factory_qnty			+=	$ex_factory_qnty;
					$sub_ex_factory_carton_qnty		+= $ex_factory_carton_qnty;
					$sub_shortage		+=	$shortage;
					$sub_excess			+= $excess;
					$sub_balance		+= $balance;
					$sub_sewing_balance	+=($sewingin_qnty+$sewingin_subcon)-$po_quantity_in_pcs;

				}// end main foreach  exfactory

				?>

					<tr bgcolor="#CCCCCC" style="font-weight:bold">
						<td width="30">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="130">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="120">&nbsp;</td>
						<td width="130" align="right"><b>Job Wise Sub Total:</b></td>
						<td width="70" align="right"><?=number_format($sub_po_qty,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80" align="right"><?=number_format($sub_grey_req_qnty,2,'.','');?></td>
						<td width="100" align="right"><?=number_format($sub_grey_rcv_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_grey_balance_qnty,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80" align="right"><?=number_format($sub_fin_req_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_finish_rcv_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_finish_balance_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_finish_issue_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_plan_cut_qty,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80" align="right"><?=number_format($sub_cut_lay_qty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_cutting_qc_qty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_cutting_balance,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_print_issue_inhouse,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_print_rcv_inhouse,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_print_balance,2,'.','');?>,2,'.',''</td>
						<td width="80" align="right"><?=number_format($sub_emb_issue_inhouse,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_emb_rcv_inhouse,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_emb_balance,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_ttl_sewingin_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_ttl_sewingout_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_ttl_sewing_balance,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_sewing_balance,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_poly_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_poly_balance,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_ex_factory_qnty,2,'.','').'<br> ctn:'.number_format($sub_ex_factory_carton_qnty,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_shortage,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_excess,2,'.','');?></td>
						<td width="80" align="right"><?=number_format($sub_balance,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td>&nbsp;</td>
					</tr>

				</table>
				<table border="1" class="tbl_bottom" width="4545" rules="all" id="report_table_footer" ><!-- 4150 -->
					<tr>
					<tr>
                        <td width="30">&nbsp;</td>
                        <td width="100">&nbsp;</td>
                        <td width="100">&nbsp;</td>
						<td width="130">&nbsp;</td>
						<td width="100">&nbsp;</td>
                        <td width="80">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="80">&nbsp;</td>
                        <td width="100">&nbsp;</td>
                        <td width="80">&nbsp;</td>
						<td width="120">&nbsp;</td>
						<td width="130"><b>Grand Total:</b></td>
						<td width="70"><?=number_format($gt_po_qty,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_grey_req_qnty,2,'.','');?></td>
						<td width="100"><?=number_format($gt_grey_rcv_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_grey_balance_qnty,2,'.','');?></td>
                        <td width="80">&nbsp;</td>
                        <td width="80">&nbsp;</td>
                        <td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_fin_req_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_finish_rcv_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_finish_balance_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_finish_issue_qnty,2,'.','');?></td>
                        <td width="80"><?=number_format($gt_plan_cut_qty,2,'.','');?></td>
                        <td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_cut_lay_qty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_cutting_qc_qty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_cutting_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_print_issue_inhouse,2,'.','');?></td>
						<td width="80"><?=number_format($gt_print_rcv_inhouse,2,'.','');?></td>
						<td width="80"><?=number_format($gt_print_balance,2,'.','');?>,2,'.',''</td>
						<td width="80"><?=number_format($gt_emb_issue_inhouse,2,'.','');?></td>
						<td width="80"><?=number_format($gt_emb_rcv_inhouse,2,'.','');?></td>
						<td width="80"><?=number_format($gt_emb_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_ttl_sewingin_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_ttl_sewingout_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_ttl_sewing_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_sewing_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_poly_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_poly_balance,2,'.','');?></td>
                        <td width="80"><?=number_format($gt_ex_factory_qnty,2,'.','').'<br> ctn:'.number_format($gt_ex_factory_carton_qnty,2,'.','');?></td>
                        <td width="80"><?=number_format($gt_shortage,2,'.','');?></td>
						<td width="80"><?=number_format($gt_excess,2,'.','');?></td>
						<td width="80"><?=number_format($gt_balance,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</div>
		 </div>
        <?
	}
	else if($type==3) // job and color wise
	{
		$str_po_cond="";

		if($cbo_company_name!=0) $str_po_cond.=" and a.company_name in($cbo_company_name)";
		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}

		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				//$str_po_cond .=" and b.shiping_status in(1,2)";
				$str_po_cond .=" and b.shiping_status in(2,3)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}


		/* if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'"; */

		if($txt_date_from!="" && $txt_date_to!="")
		{
			if($db_type==0)
			{
				$start_date = date('Y-m-d H:i:s',strtotime($txt_date_from));
				$end_date = date("Y-m-d",strtotime($txt_date_to));

				if($cbo_date_type==1){
					$start_date = date('Y-m-d',strtotime($txt_date_from));
					$str_po_cond .=" and b.pub_shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==2)
				{
					$str_po_cond .=" and b.shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==3)
				{
					$start_date = date('Y-m-d',strtotime($txt_date_from));
					$str_po_cond .=" and b.po_received_date between '".$start_date."' and '".$end_date."'";
				}
				elseif($cbo_date_type==4)
				{
					$str_po_cond .=" and b.insert_date between '".$start_date."' and '".$end_date." 23:59:59'";
				}
			}
			else
			{
				$start_date = change_date_format(date("Y-m-d H:i:s",strtotime($txt_date_from)),'','',1);
				$end_date = change_date_format(date("Y-m-d H:i:s",strtotime($txt_date_to)),'','',1);

				if(str_replace("'","",$cbo_date_type)==1)
				{
					$str_po_cond .=" and b.pub_shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif(str_replace("'","",$cbo_date_type)==2)
				{
					$str_po_cond .=" and b.shipment_date between '".$start_date."' and '".$end_date."'";
				}
				elseif(str_replace("'","",$cbo_date_type)==3)
				{
					$str_po_cond .=" and b.po_received_date between '".$start_date."' and '".$end_date."'";
				}
				elseif(str_replace("'","",$cbo_date_type)==4)
				{
					$str_po_cond.=" and b.insert_date between '".$start_date."' and '".$end_date." 11:59:59 PM'";
				}
			}
		}

		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";

		// ========================================== MAIN QUERY ==================================================


		$order_sql="SELECT a.id as job_id,b.id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.po_number, b.pub_shipment_date, b.shipment_date, b.po_received_date, b.insert_date, b.excess_cut,  b.is_confirmed, c.item_number_id as item_number_id, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total ,max(c.shiping_status) as shiping_status,sum(c.plan_cut_qnty) as plan_cut_qnty, a.dealing_marchant
		from wo_po_details_master a,wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active in(1,2,3) and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $active_cond $order_status_cond $str_po_cond $txt_style_ref_number_cond
		group by a.id,a.job_no_prefix_num,a.job_no,a.insert_date,a.company_name,a.buyer_name,a.style_ref_no,b.id,b.po_number,b.pub_shipment_date, b.shipment_date, b.po_received_date, b.insert_date, b.excess_cut, b.is_confirmed, c.item_number_id, c.color_number_id, a.dealing_marchant
		order by a.id, c.item_number_id,c.color_number_id";

		$sql_po_result=sql_select($order_sql);
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("id")].",";
			$all_po_id_arr[$row[csf("id")]]=$row[csf("id")];
		}
		//=================================== Delete Order Id From TEMP ENGINE ====================================
		$con = connect();
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 138 and ref_from=6");
		oci_commit($con);
		//=================================== Insert order_id into TEMP ENGINE ====================================
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 138, 6,$all_po_id_arr, $empty_arr);

	    $all_po_id=chop($all_po_id,",");

	    $all_po_ids=implode(",", $all_po_id_arr);

		$template_sql = "select a.po_number_id, a.template_id from tna_process_mst a ,GBL_TEMP_ENGINE b where a.po_number_id=b.ref_val and b.entry_form=138 and b.ref_from=6 and b.user_id=$user_id group by a.po_number_id, a.template_id";
		$template_id_arr=return_library_array($template_sql ,"po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and c.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(array_unique(explode(",",$all_po_id)),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (c.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or c.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}
			}
		}
		// ======================= FOR EXFACTORY  ===========================
		$ex_factory_arr=array();
		$ex_fac_level=sql_select("select ex_factory  from variable_settings_production where company_name=$cbo_company_name and variable_list=1 and status_active=1");
		if($ex_fac_level[0][csf("ex_factory")]==1)
		{
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , c.item_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN c.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN c.ex_factory_qnty ELSE 0 END) as ex_factory_qnty
			from GBL_TEMP_ENGINE b,pro_ex_factory_mst c where c.po_break_down_id=b.ref_val and b.entry_form=138 and b.ref_from=6 and b.user_id=$user_id and c.status_active=1 and c.is_deleted=0  group by c.po_break_down_id, c.item_number_id");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];
			}
		}
		else
		{
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , f.color_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN d.production_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN d.production_qnty ELSE 0 END) as ex_factory_qnty, e.job_no_mst as job_no
			from  GBL_TEMP_ENGINE b,pro_ex_factory_mst c ,pro_ex_factory_dtls d,wo_po_break_down e ,wo_po_color_size_breakdown f
			where c.po_break_down_id=b.ref_val and c.id=d.mst_id and c.po_break_down_id=e.id and e.id=f.po_break_down_id and f.id=d.color_size_break_down_id and
         	c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and e.status_active in(1,2,3) and e.is_deleted=0 and f.status_active in(1,2,3) and b.entry_form=138 and b.ref_from=6 and b.user_id=$user_id
         	group by c.po_break_down_id, f.color_number_id,e.job_no_mst");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		}

		unset($ex_factory_data);

		// ============================ FOR PRODUCTION DATA =================================
		if($db_type==0)
		{

			$prod_sql="SELECT c.po_break_down_id, c.item_number_id,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				IFNULL(sum(CASE WHEN d.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				IFNULL(sum(CASE WHEN c.production_type ='10' and c.trans_type=5 THEN d.production_qnty ELSE 0 END),0) AS trans_in_qty,
				IFNULL(sum(CASE WHEN c.production_type ='10' and c.trans_type=6 THEN d.production_qnty ELSE 0 END),0) AS trans_out_qty,

				IFNULL(sum(CASE WHEN d.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='5' THEN d.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='11' THEN d.production_qnty ELSE 0 END),0) AS poly_qty,
				IFNULL(sum(CASE WHEN d.production_type in (1,2,4,3,5,7,8,11) and c.production_type in (1,2,4,3,5,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=1 then c.carton_qty ELSE 0 END),0) as carton_qty_no_inhouse,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=3 then c.carton_qty ELSE 0 END),0) as carton_qty_no_outbound,
				IFNULL(sum(CASE When d.production_type ='8' and c.production_type ='8' then c.carton_qty ELSE 0 END),0) as carton_total_qty

			from
			GBL_TEMP_ENGINE b,pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e
			where c.po_break_down_id=b.ref_val and c.id=d.mst_id  and c.po_break_down_id=a.po_break_down_id and a.job_no_mst=e.job_no  and a.id=d.color_size_break_down_id and b.entry_form=138 and b.ref_from=6 and b.user_id=$user_id and c.status_active=1 and   c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and e.status_active=1 and e.is_deleted=0 $active_cond_a_d group by c.po_break_down_id, c.item_number_id";

			$sql_carton_qty=sql_select("SELECT c.po_break_down_id,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=1 then c.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=3 then c.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when c.production_type ='8' then c.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst c,gbl_temp_engine d where c.status_active=1 and c.is_deleted=0 and a.po_break_down_id =d.ref_val and d.entry_form=138 and d.ref_from=6 and d.user_id=$user_id group by c.po_break_down_id");
		}
		else
		{
			$producttion_cond =" and c.po_break_down_id in($po_id)";
			$prod_sql= "SELECT c.po_break_down_id, a.color_number_id,e.job_no,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.replace_qty ELSE 0 END),0) AS replace_qty,

				NVL(sum(CASE WHEN d.production_type ='2'  and c.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				NVL(sum(CASE WHEN c.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				NVL(sum(CASE WHEN d.production_type ='3'  and c.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,

				NVL(sum(CASE WHEN c.production_type ='10' and c.trans_type=5 THEN d.production_qnty ELSE 0 END),0) AS trans_in_qty,
				NVL(sum(CASE WHEN c.production_type ='10' and c.trans_type=6 THEN d.production_qnty ELSE 0 END),0) AS trans_out_qty,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,

				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' THEN d.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' THEN d.reject_qty ELSE 0 END),0) AS poly_rej_qnty,

				NVL(sum(CASE WHEN d.production_type in (1,3,5,7,8,11) and c.production_type in (1,3,5,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				NVL(sum(CASE WHEN d.production_type ='11' and c.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,

				NVL(sum(CASE WHEN c.production_type ='11' and d.production_type ='11'  THEN d.production_qnty ELSE 0 END),0) AS poly_qty

			from
				gbl_temp_engine b,pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e
			where  c.po_break_down_id=b.ref_val and c.id=d.mst_id     and a.job_id=e.id  and a.id=d.color_size_break_down_id and b.entry_form=138 and b.ref_from=6 and b.user_id=$user_id  and
				c.status_active=1 and c.is_deleted=0 and d.status_active=1 and a.status_active=1  $active_cond_a_d and d.is_deleted=0  and e.status_active=1 and e.is_deleted=0
			group by c.po_break_down_id, a.color_number_id,e.job_no";

			// =============================== for carton quantity =======================================


			$sql_carton_qty=sql_select("SELECT d.po_break_down_id,a.job_no,c.color_number_id,
			NVL(sum(case when d.production_type ='8' and d.production_source=1 then d.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			NVL(sum(case when d.production_type ='8' and d.production_source=3 then d.carton_qty else 0 end),0) as carton_qty_no_outbound,
			NVL(sum(case when d.production_type ='8' then d.carton_qty else 0 end),0) as carton_total_qty
			FROM wo_po_details_master a,wo_po_break_down b, wo_po_color_size_breakdown c,pro_garments_production_mst d,gbl_temp_engine e
			WHERE a.id=b.job_id and a.id=c.job_id and b.job_id=c.job_id and b.id=c.po_break_down_id and b.id=d.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and c.po_break_down_id =e.ref_val and e.entry_form=138 and d.ref_from=6 and e.user_id=$user_id  $active_cond
			GROUP BY d.po_break_down_id,a.job_no,c.color_number_id");

		}

		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		}
		// print_r($carton_arr);
		// ===================== sub contract query start here ===========================
		$str_po_cond_subcon="";
		$str_po_cond_subcon2="";
		if($txt_datefrom!="" &&  $txt_dateto!="") { $str_po_cond_subcon .=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'"; $str_po_cond_subcon2.=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'";}
		if(str_replace("'", "",$cbo_company_name)!=0)
		{
			$str_po_cond_subcon.=" and b.company_id=$cbo_company_name";
			$str_po_cond_subcon2.=" and a.company_id=$cbo_company_name";
		}
		if(str_replace("'", "",$cbo_buyer_name)!=0) $str_po_cond_subcon.=" and b.party_id=$cbo_buyer_name";
		if(str_replace("'", "",$cbo_location)!=0) $str_po_cond_subcon.=" and b.location_id=$cbo_location";
		if(str_replace("'", "",$txt_style_ref)!="") $str_po_cond_subcon.=" and b.job_no_prefix_num=$txt_style_ref";
		if(str_replace("'", "",$txt_order)!="") $str_po_cond_subcon.=" and c.order_no=$txt_order";
		if($db_type==0) $select_job_year_subcon="year(b.insert_date) as job_year"; else $select_job_year_subcon="to_char(b.insert_date,'YYYY') as job_year";


		$sql_cutlay="SELECT a.job_no,a.entry_form,a.entry_date,a.end_date,b.order_id as po_id,b.gmt_item_id as gmts,c.order_id,sum(c.size_qty ) as qty,b.color_id  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,GBL_TEMP_ENGINE d  where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id =d.ref_val and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name and d.entry_form=138 and d.ref_from=6 and d.user_id=$user_id group by a.entry_form,a.entry_date,a.end_date,b.order_id,b.gmt_item_id,c.order_id,b.color_id,a.job_no";
		//echo $sql_cutlay;die;
		$sql_res=sql_select($sql_cutlay);
		$cutQntyArr=array();
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			if($entry_form!=76)
			{
				//$cut_lay_arrs[$vals[csf("job_no")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
				$cut_lay_date_arrs[$vals[csf("job_no")]][$vals[csf("color_id")]]["entry_date"]=$vals[csf("entry_date")];
				$cut_lay_date_arrs[$vals[csf("job_no")]][$vals[csf("color_id")]]["end_date"]=$vals[csf("end_date")];
			}
			else
			{
				//$cut_lay_arrs[$vals[csf("job_no")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
				$cut_lay_date_arrs[$vals[csf("job_no")]][$vals[csf("color_id")]]["entry_date"]=$vals[csf("entry_date")];
				$cut_lay_date_arrs[$vals[csf("job_no")]][$vals[csf("color_id")]]["end_date"]=$vals[csf("end_date")];
			}
			$cutQntyArr[$vals[csf("job_no")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
		}
		unset($sql_res);
		//echo "<pre>"; print_r($cut_lay_date_arrs); //die;
		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['cQty']+=$gmtsRow[csf('cutting_qnty')];//+$gmtsRow[csf('replace_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['pQty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['washiss']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['prQty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['washrec']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['special']+=$gmtsRow[csf('specialr')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['spc_qty']+=$gmtsRow[csf('issue_spc_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['issue_wash']+=$gmtsRow[csf('issue_wash_qty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['sQty']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['soQty']+=$gmtsRow[csf('sewingout_qnty_in')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['subcon_sewingin']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['subcon_sewingout']+=$gmtsRow[csf('sewingout_qnty_out')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['all_sewingout']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['iQty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['riQty']+=$gmtsRow[csf('re_iron_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['crQty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['sorQty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['frQty']+=$gmtsRow[csf('finish_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyRej']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['rej_qnty']+=$gmtsRow[csf('rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyInQty']+=$gmtsRow[csf('poly_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyOutQty']+=$gmtsRow[csf('poly_outbound')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyQty']+=$gmtsRow[csf('poly_qty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['trans_in_qty']+=$gmtsRow[csf('trans_in_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];
		}
		// echo "<pre>";print_r($gmts_prod_arr);die;
		unset($res_gmtsData);

		$sql_wo="SELECT b.po_break_down_id, a.id, a.booking_no, a.insert_date, a.item_category, a.fabric_source, a.company_id, a.booking_type, a.booking_no_prefix_num, a.job_no, a.is_short, a.is_approved, a.po_break_down_id as wo_po_id,a.entry_form, b.fabric_color_id, sum(b.fin_fab_qnty) as fin_req_qnty, sum(b.grey_fab_qnty) as grey_req_qnty,b.gmts_color_id from wo_booking_mst a, wo_booking_dtls b, gbl_temp_engine d where a.booking_no=b.booking_no and a.item_category in(2,3,13) and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.po_break_down_id=d.ref_val and d.user_id = ".$user_id." and d.entry_form=138 and d.ref_from=6 group by b.po_break_down_id, a.id, a.booking_no, a.insert_date, a.item_category, a.fabric_source, a.company_id, a.booking_type, a.booking_no_prefix_num, a.job_no, a.is_short, a.is_approved, a.po_break_down_id,a.entry_form, b.fabric_color_id, b.gmts_color_id";
		//echo $sql_wo;die;
		$resultWo=sql_select($sql_wo);

		$dataArrayWo=array(); $fab_source_arr=array(); $bookingEntryFromArr=array();
		foreach($resultWo as $woRow)
		{
			$dataArrayWo[$woRow[csf('job_no')]][$woRow[csf('gmts_color_id')]].=$woRow[csf('id')]."**".$woRow[csf('booking_no')]."**".$woRow[csf('insert_date')]."**".$woRow[csf('item_category')]."**".$woRow[csf('fabric_source')]."**".$woRow[csf('company_id')]."**".$woRow[csf('booking_type')]."**".$woRow[csf('booking_no_prefix_num')]."**".$woRow[csf('job_no')]."**".$woRow[csf('is_short')]."**".$woRow[csf('is_approved')]."**".$woRow[csf('fabric_color_id')]."**".$woRow[csf('fin_req_qnty')]."**".$woRow[csf('grey_req_qnty')]."**".$woRow[csf('wo_po_id')]."__";

			$fab_source_arr[$woRow[csf('job_no')]].=$woRow[csf('fabric_source')].',';
			$bookingEntryFromArr[$woRow[csf('booking_no')]]=$woRow[csf('entry_form')];
		}
		//echo "<pre>";print_r($dataArrayWo);die;
		unset($resultWo);

		$grey_fin_rcv_sql = "SELECT a.po_breakdown_id, a.entry_form, a.quantity, a.color_id, c.job_no_mst FROM order_wise_pro_details a, wo_po_break_down c, gbl_temp_engine b WHERE c.id=a.po_breakdown_id and a.entry_form in(18,22,37,58,68,71,225) AND a.status_active = 1 AND a.is_deleted = 0 AND a.po_breakdown_id = b.ref_val AND b.user_id = ".$user_id." and b.entry_form=138 and b.ref_from=6";

		//echo $grey_fin_rcv_sql;die;
		$resultGreyFinRcv=sql_select($grey_fin_rcv_sql);
		$grey_rcv_info_arr=array();
		$fin_rcv_info_arr=array();
		$fin_issue_info_arr=array();
		foreach($resultGreyFinRcv as $row)
		{
			if($row[csf('entry_form')]==58 || $row[csf('entry_form')]==22)
			{
				$grey_rcv_info_arr[$row[csf('job_no_mst')]]['grey_receive_qnty'] += $row[csf('quantity')];
			}
			else if($row[csf('entry_form')]==37 || $row[csf('entry_form')]==68 || $row[csf('entry_form')]==225)
			{
				$fin_rcv_info_arr[$row[csf('job_no_mst')]][$row[csf('color_id')]]['finish_receive_qnty'] += $row[csf('quantity')];
			}
			else if($row[csf('entry_form')]==18 || $row[csf('entry_form')]==71)
			{
				$fin_issue_info_arr[$row[csf('job_no_mst')]][$row[csf('color_id')]]['finish_issue_qnty'] += $row[csf('quantity')];
			}

		}
		//echo "<pre>";print_r($fin_rcv_info_arr);die;
		unset($resultGreyFinRcv);

		$sql_finish_return = "SELECT b.po_breakdown_id, b.quantity, b.color_id, d.job_no_mst FROM inv_transaction a, order_wise_pro_details b, wo_po_break_down d,  gbl_temp_engine c WHERE  a.id = b.trans_id AND d.id=b.po_breakdown_id AND b.entry_form IN (46, 52) AND a.transaction_type IN (3, 4) AND a.status_active = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0 AND b.po_breakdown_id = c.ref_val AND c.user_id = ".$user_id." and c.entry_form=138 and c.ref_from=6";

		//echo $sql_finish_return;die;
		$resultGreyFinRtn=sql_select($sql_finish_return);

		$fin_rtn_info_arr=array();
		foreach($resultGreyFinRtn as $row)
		{
			$fin_rtn_info_arr[$row[csf('job_no_mst')]][$row[csf('color_id')]]['fin_rtn_qnty'] += $row[csf('quantity')];
		}
		//echo "<pre>";print_r($fin_rtn_info_arr);die;
		unset($resultGreyFinRtn);

		$sql_tna = "SELECT a.job_no, b.po_number, p.po_number_id, p.task_number, MIN ( CASE WHEN p.task_start_date IS NOT NULL THEN p.task_start_date END) AS task_start_date, MAX (p.task_finish_date) AS task_finish_date, d.color_id  FROM tna_process_mst p, wo_po_details_master a, wo_po_break_down b, order_wise_pro_details d, gbl_temp_engine c WHERE p.po_number_id = b.id AND b.job_no_mst = a.job_no AND b.id=d.po_breakdown_id AND d.color_id>0 AND p.task_number IN (12,60,61,84) AND b.id = c.ref_val AND c.user_id = ".$user_id." AND c.entry_form=138 AND c.ref_from=6 GROUP BY a.job_no, b.po_number, p.po_number_id, p.task_number, d.color_id";

		//echo $sql_tna;die;
		$sql_tna_res = sql_select($sql_tna);
		$tna_info_arr = array();
		foreach ($sql_tna_res as $row)
		{
			$tna_info_arr[$row[csf('task_number')]][$row[csf('job_no')]][$row[csf('color_id')]]['task_start_date'] = $row[csf('task_start_date')];
			$tna_info_arr[$row[csf('task_number')]][$row[csf('job_no')]][$row[csf('color_id')]]['task_finish_date'] = $row[csf('task_finish_date')];
		}
		//echo "<pre>";print_r($tna_info_arr);
		unset($sql_tna_res);


		$b_swing_sql = "SELECT a.id, a.floor_id,a.sewing_line,b.item_number_id,c.po_number, c.id as po_id,c.job_no_mst as job_no, f.color_number_id from pro_gmts_delivery_mst a,pro_garments_production_mst b, wo_po_break_down c,pro_garments_production_dtls d, wo_po_color_size_breakdown f, gbl_temp_engine e where  b.po_break_down_id=c.id and a.id=b.delivery_mst_id and b.id=d.mst_id and d.color_size_break_down_id=f.id and a.production_type=4 and b.production_type=4 and a.status_active=1 and a.is_deleted=0 and a.company_id in($cbo_company_name) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and c.id = e.ref_val and e.user_id = ".$user_id." and e.entry_form=138 and e.ref_from=6 group by a.id, a.floor_id,a.sewing_line,b.item_number_id,c.po_number,c.id,c.job_no_mst, f.color_number_id";
		//echo $b_swing_sql;die;
		$resultBSwing=sql_select($b_swing_sql);

		$bundleSwingArr = array();
		foreach($resultBSwing as $row)
		{
			$bundleSwingArr[$row[csf('job_no')]][$row[csf('color_number_id')]]['floor_id'] = $row[csf('floor_id')];
			$bundleSwingArr[$row[csf('job_no')]][$row[csf('color_number_id')]]['sewing_line'] = $row[csf('sewing_line')];
		}
		//echo "<pre>";print_r($bundleSwingArr);die;
		unset($resultBSwing);


		$fromDate = change_date_format( str_replace("'","",trim($txt_date_from)) );
		$toDate = change_date_format( str_replace("'","",trim($txt_date_to)) );

		$result=sql_select($order_sql);
		$data_arr = array();
		$check_order = array();

		foreach ($result as $key => $val)
		{
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['job_num'] = $val[csf('job_no_prefix_num')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['job_no'] = $val[csf('job_no')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['style_ref_no'] = $val[csf('style_ref_no')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['buyer_name'] = $val[csf('buyer_name')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['style_qty'] += $val[csf('order_quantity')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['plan_cut'] += $val[csf('plan_cut_qnty')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['excess_cut'] += $val[csf('excess_cut')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['shiping_status'] = $val[csf('shiping_status')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['company_name'] = $val[csf('company_name')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['item_number_id'] = $val[csf('item_number_id')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['id'] = $val[csf('id')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['is_confirmed'] = $val[csf('is_confirmed')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['pub_shipment_date'] = $val[csf('pub_shipment_date')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['shipment_date'] = $val[csf('shipment_date')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['po_received_date'] = $val[csf('po_received_date')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['insert_date'] = $val[csf('insert_date')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['dealing_marchant'] = $val[csf('dealing_marchant')];
			// echo $val[csf('id')];
			if($check_order[$val[csf('job_no')]][$val[csf('color_number_id')]][$val[csf('id')]] != $val[csf('id')])
			{
				$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['order_no'] .= $val[csf('po_number')].",";
				$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['po_no'] .= $val[csf('id')].",";
				$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['po_id'] .= $val[csf('id')].",";
				$check_order[$val[csf('job_no')]][$val[csf('color_number_id')]][$val[csf('id')]] = $val[csf('id')];
			}
		}
		// unset($check_order);
		// print_r($check_order);
		// echo "<pre>";
		// print_r($data_arr);


		//=================================== Delete Order Id From TEMP ENGINE ====================================
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 138 and ref_from=6");
		oci_commit($con);
		disconnect($con);

		ob_start();

  		?>
		<div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						<? echo "Order Wise Fabric to RMG Production Status Report"; ?>
					</td>
				</tr>
				<tr style="border:none; ">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						<!-- Company Name : <? echo $company_library[str_replace("'","",$cbo_company_name)]; ?> -->
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">
						<?
							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								echo "From $fromDate To $toDate";
							}
						?>
					</td>
				</tr>
			</table>

			<div style="clear:both"></div>
			<table width="4545" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1">
				<thead>
					<tr>
						<th width="30">SL</th>
                        <th width="100">Order Status</th>
                        <th width="100">Main Fabric Booking No</th>
						<th width="130">Style</th>
						<th width="100">Buyer</th>
                        <th width="80">Job No</th>
						<th width="60">File Rcv. Date</th>
						<th width="80"><? echo $date_caption;?></th>
                        <th width="100">Lead Time</th>
                        <th width="80">PP App date</th>
						<th width="120">Order No.</th>
						<th width="130">Item Name</th>
						<th width="70">Order Qty</th>
						<th width="80">Fabric Booking Date</th>
						<th width="80">Knitting Start Date</th>
						<th width="80">Knitting End Date</th>
						<th width="80">Grey Fabric req.</th>
						<th width="100">Grey Fabric Received</th>
						<th width="80">Balance</th>
                        <th width="80">Colour</th>
                        <th width="80">Dye.Star date</th>
                        <th width="80">Dye.End date</th>
						<th width="80">Finish Fabric Booking</th>
						<th width="80">Finish Fabric Received</th>
						<th width="80">Finish Fabric Balance</th>
						<th width="80">Fabrics Issue to Cut.</th>
                        <th width="80">Plan Cut Qty</th>
                        <th width="80">Cutting Start Date</th>
						<th width="80">Cutting End Date</th>
						<th width="80">Cutting Lay Qty</th>
						<th width="80">Cutting QC</th>
						<th width="80">Cutting Balance</th>
						<th  width="80">Print send</th>
						<th width="80">Print Received</th>
						<th width="80">Ballance</th>
						<th width="80">EMB. Send</th>
						<th width="80">EMB. Received</th>
						<th width="80">Ballance</th>
						<th width="80">Sewing Input Qty</th>
						<th width="80">Sewing Output Qty</th>
						<th width="80">Sewing WIP</th>
						<th width="80">Sewing Balance</th>
						<th width="80">Poly</th>
						<th width="80">Poly Balance</th>
                        <th width="80">Total Ex-Factory</th>
                        <th width="80">Shortage Qty.</th>
						<th width="80">Excess Qty.</th>
						<th width="80">Balance Qty</th>
						<th width="80">Running Floor</th>
						<th width="80">Line No.</th>
						<th width="80">Accessories Status</th>
						<th width="80">Concern Person</th>
						<th width="100">Shiping Status</th>
						<th>Remarks</th>
					 </tr>
				</thead>
			</table>
			<div style="max-height:425px; overflow-y:scroll; width:4565px" id="scroll_body">
				<table border="1" class="rpt_table" width="4545" rules="all" id="table_body">
				<?
				$buyer_array=array();
				$i=0; $k=0;
				$days_in_hand="";
				$sub_po_qty=$sub_grey_req_qnty=$sub_grey_rcv_qnty=$sub_grey_balance_qnty=$sub_fin_req_qnty=$sub_finish_rcv_qnty=$sub_finish_balance_qnty=$sub_finish_issue_qnty=$sub_plan_cut_qty=$sub_cut_lay_qty=$sub_cutting_qc_qty=$sub_cutting_balance=$sub_print_issue_inhouse=$sub_print_rcv_inhouse=$sub_print_balance=$sub_emb_issue_inhouse=$sub_emb_rcv_inhouse=$sub_emb_balance=$sub_ttl_sewingin_qnty=$sub_ttl_sewingout_qnty=$sub_ttl_sewing_balance=$sub_poly_qnty=$sub_poly_balance=$sub_ex_factory_qnty=$sub_ex_factory_carton_qnty=$sub_shortage=$sub_excess=$sub_balance=0;

				$gt_po_qty=$gt_grey_req_qnty=$gt_grey_rcv_qnty=$gt_grey_balance_qnty=$gt_fin_req_qnty=$gt_finish_rcv_qnty=$gt_finish_balance_qnty=$gt_finish_issue_qnty=$gt_plan_cut_qty=$gt_cut_lay_qty=$gt_cutting_qc_qty=$gt_cutting_balance=$gt_print_issue_inhouse=$gt_print_rcv_inhouse=$gt_print_balance=$gt_emb_issue_inhouse=$gt_emb_rcv_inhouse=$gt_emb_balance=$gt_ttl_sewingin_qnty=$gt_ttl_sewingout_qnty=$gt_ttl_sewing_balance=$gt_poly_qnty=$gt_poly_balance=$gt_ex_factory_qnty=$gt_ex_factory_carton_qnty=$gt_shortage=$gt_excess=$gt_balance=0;

				foreach($data_arr as $job_no=>$job_data)
				{
					foreach ($job_data as $color_id => $orderRes)
					{
						$i++;
						if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

						$k++;

						$po_quantity_in_pcs=$orderRes["style_qty"];

						$cutting_start_date = $cut_lay_date_arrs[$job_no][$color_id]["entry_date"];
						$cutting_end_date = $cut_lay_date_arrs[$job_no][$color_id]["end_date"];

						$ex_factory_date=$ex_factory_arr[$job_no][$color_id]['date'];
						$ex_factory_qnty=$ex_factory_arr[$job_no][$color_id]['qty'];
						$ex_factory_carton_qnty=$ex_factory_arr[$job_no][$color_id]['ex_fac_carton_qty'];

						$cutting_qnty=$gmts_prod_arr[$job_no][$color_id]['cQty'];
						$embl_recv_qnty=$gmts_prod_arr[$job_no][$color_id]['prQty'];
						$sewingin_qnty=$gmts_prod_arr[$job_no][$color_id]['sQty'];
						$sewingout_qnty=$gmts_prod_arr[$job_no][$color_id]['soQty'];
						$sewingin_subcon=$gmts_prod_arr[$job_no][$color_id]['subcon_sewingin'];
						$sewingout_subcon=$gmts_prod_arr[$job_no][$color_id]['subcon_sewingout'];
						$iron_qnty=$gmts_prod_arr[$job_no][$color_id]['iQty'];
						$re_iron_qnty=$gmts_prod_arr[$job_no][$color_id]['riQty'];
						$polyInQnty=$gmts_prod_arr[$job_no][$color_id]['polyInQty'];
						$polyOutQnty=$gmts_prod_arr[$job_no][$color_id]['polyOutQty'];
						$poly_qnty=$gmts_prod_arr[$job_no][$color_id]['polyQty'];
						$finish_qnty_inhouse=$gmts_prod_arr[$job_no][$color_id]['finish_qnty_inhouse'];
						$finish_qnty_outbound=$gmts_prod_arr[$job_no][$color_id]['finish_qnty_outbound'];

						$trans_in_qty=$gmts_prod_arr[$job_no][$color_id]['trans_in_qty'];
						$trans_out_qty=$gmts_prod_arr[$job_no][$color_id]['trans_out_qty'];

						$cartonInQnty=$carton_arr[$job_no][$color_id]['carton_qty_no_inhouse'];
						$cartonOutQnty=$carton_arr[$job_no][$color_id]['carton_qty_no_outbound'];
						$cartonTotal_qnty=$carton_arr[$job_no][$color_id]['carton_total_qty'];

						$finish_qnty_transferIn=$po_transfer_in_arr[$job_no][$color_id];
						$finish_qnty_transferOut=$po_transfer_out_arr[$job_no][$color_id];

						$print_issue_inhouse=$gmts_prod_arr[$job_no][$color_id]['print_issue_inhouse'];
						$print_issue_subcon=$gmts_prod_arr[$job_no][$color_id]['print_issue_subcon'];
						$print_rcv_inhouse=$gmts_prod_arr[$job_no][$color_id]['print_rcv_inhouse'];
						$print_rcv_subcon=$gmts_prod_arr[$job_no][$color_id]['print_rcv_subcon'];

						$emb_issue_inhouse=$gmts_prod_arr[$job_no][$color_id]['emb_issue_inhouse'];
						$emb_issue_subcon=$gmts_prod_arr[$job_no][$color_id]['emb_issue_subcon'];
						$emb_rcv_inhouse=$gmts_prod_arr[$job_no][$color_id]['emb_rcv_inhouse'];
						$emb_rcv_subcon=$gmts_prod_arr[$job_no][$color_id]['emb_rcv_subcon'];

						$print_issue=$gmts_prod_arr[$job_no][$color_id]['print'];
						$cut_lays=$cutQntyArr[$job_no][$color_id] ;
						$embl_issue=$gmts_prod_arr[$job_no][$color_id]['emb'];
						$wash_issue=$gmts_prod_arr[$job_no][$color_id]['washiss'];
						$spwork_issue=$gmts_prod_arr[$job_no][$color_id]['special'];

						$spc_qty_issue=$gmts_prod_arr[$job_no][$color_id]['spc_qty'];
						$wash_qty_issue=$gmts_prod_arr[$job_no][$color_id]['issue_wash'];

						$print_rec=$gmts_prod_arr[$job_no][$color_id]['print'];
						$emb_rec=$gmts_prod_arr[$job_no][$color_id]['emb'];
						$wash_rec=$gmts_prod_arr[$job_no][$color_id]['washrec'];
						$spcial_rec=$gmts_prod_arr[$job_no][$color_id]['special'];

						$sewing_floor_id = $bundleSwingArr[$job_no][$color_id]['floor_id'];
						$b_sewing_line = $bundleSwingArr[$job_no][$color_id]['sewing_line'];

						$buyer_array[$orderRes["buyer_name"]]['print']+=$print_issue;
							$buyer_array[$orderRes["buyer_name"]]['cut_lays']+=$cut_lays;
						$buyer_array[$orderRes["buyer_name"]]['emb']+=$embl_issue;
						$buyer_array[$orderRes["buyer_name"]]['wash']+=$wash_issue;
						$buyer_array[$orderRes["buyer_name"]]['spwork']+=$spwork_issue;
						$buyer_array[$orderRes["buyer_name"]]['print_rec']+=$print_rec;
						$buyer_array[$orderRes["buyer_name"]]['emb_rec']+=$emb_rec;
						$buyer_array[$orderRes["buyer_name"]]['wash_rec']+=$wash_rec;
						$buyer_array[$orderRes["buyer_name"]]['spwork_rec']+=$spcial_rec;
						$buyer_array[$orderRes["buyer_name"]]['poQty']+=$po_quantity_in_pcs;
						$buyer_array[$orderRes["buyer_name"]]['poVal']+=$po_quantity_in_pcs*$unit_price;
						$buyer_array[$orderRes["buyer_name"]]['ex']+=$ex_factory_qnty;
						$buyer_array[$orderRes["buyer_name"]]['cQty']+=$cutting_qnty;
						$buyer_array[$orderRes["buyer_name"]]['prQty']+=$embl_recv_qnty;
						$buyer_array[$orderRes["buyer_name"]]['sQty']+=$sewingin_qnty;
						$buyer_array[$orderRes["buyer_name"]]['soQty']+=$sewingout_qnty;
						$buyer_array[$orderRes["buyer_name"]]['subcon_sewing']+=$sewingin_subcon;
						$buyer_array[$orderRes["buyer_name"]]['subcon_sewout']+=$sewingout_subcon;
						$buyer_array[$orderRes["buyer_name"]]['iQty']+=$iron_qnty;
						$buyer_array[$orderRes["buyer_name"]]['reiQty']+=$re_iron_qnty;
						$buyer_array[$orderRes["buyer_name"]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
						$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
						$actual_exces_cut = $gmts_prod_arr[$job_no][$color_id]['cQty'];
						$buyer_array[$orderRes["buyer_name"]]['polyQty']+=$poly_qnty;
						if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

						$plan_cut_qnty=$orderRes["plan_cut"];
						$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
						$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);

						$cutting_balance = $plan_cut_qnty-$cutting_qnty;

						//$rej_value=$proRes["finish_rej_qnty")]+$proRes["sewingout_rej_qnty")];
						$rej_value=$gmts_prod_arr[$job_no][$color_id]['rej_qnty'];
						$cut_rej_value=$gmts_prod_arr[$job_no][$color_id]['crQty'];
						//$gmts_prod_arr[$orderRes["id")]][$item_id]['crQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['sorQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['frQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['polyRej'];
						$shortage = 0; $excess = 0; $balance = 0;
						if($orderRes["shiping_status"]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
						{
							$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

							if($shortage<0)
							{
								//$shortage = "".ltrim($shortage,"-")."";
							}
						}
						else
						{
							//$shortage="(".ltrim($shortage,"-").")";
							//$shortage = "-";
						}

						if($orderRes["shiping_status"]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
						{
							$excess = $ex_factory_qnty-$po_quantity_in_pcs;
						}
						else
						{
							$excess = 0;
						}

						$today= change_date_format($orderRes["pub_shipment_date"],'','',1);
						$daysOnHand = datediff("d",change_date_format($orderRes["po_received_date"],'','',1),$today);

						$main_booking='';$booking_array=array();$fin_req_qnty=$grey_req_qnty=0;


						$poly_status = $poly_qnty*100/$po_quantity_in_pcs;
						$finish_status = ($total_finish_qnty*100)/$po_quantity_in_pcs;
						if($j==0)
						{
							$display_font_color="";
							$font_end="";
						}
						else
						{
							$display_font_color="&nbsp;<font style='display:none'>";
							$font_end="</font>";
						}

						$company_name=$orderRes["company_name"];
						$po_id=$job_no;

						$item_id=$orderRes["item_number_id"];
						if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);
						if($orderRes["shiping_status"]==3) $days_remian=$days_remian; else $days_remian="---";
						if(round($actual_exces_cut) > round($orderRes["excess_cut"])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
						$total_rej_value+=$rej_value;
						$template_id=$template_id_arr[$orderRes['id']];
						$cutlay=$cutQntyArr[$job_no][$color_id] ;

						$dataArray=array_filter(explode("__",$dataArrayWo[$job_no][$color_id]));
						//echo "<pre>";print_r($dataArray);
						if(count($dataArray)>0)
						{
							foreach($dataArray as $woRow)
							{
								$woRow=explode("**",$woRow);
								$id=$woRow[0];
								$booking_no=$woRow[1];
								$insert_date=$woRow[2];
								$item_category=$woRow[3];
								$fabric_source=$woRow[4];
								$company_id=$woRow[5];
								$booking_type=$woRow[6];
								$booking_no_prefix_num=$woRow[7];
								$job_nos=$woRow[8];
								$is_short=$woRow[9];
								$is_approved=$woRow[10];
								$fabric_color_id=$woRow[11];
								$fin_req_qnty+=$woRow[12];
								$grey_req_qnty+=$woRow[13];
								$wo_po_id=$woRow[14];
								$book_prefix_no = $woRow[7];

								if(!in_array($id,$booking_array))
								{
									if($bookingEntryFromArr[$booking_no]==86)
									{
										$entryForm=$bookingEntryFromArr[$booking_no];
										$reportFormat=explode(",",$print_report_format_budget_booking[0]);
										$reportFormat=$reportFormat[0];
										$action_namez=$report_format_arr[$reportFormat];
									}
									$system_date=date('d-M-Y', strtotime($insert_date));
									$wo_color = "";
									if ($fabric_source == 2) $wo_color = "color:#000"; else $wo_color = "";

									if($booking_type==4)
									{
										if($entryForm==86)
										{
											$action_name=$action_namez;
										}
										else{
											//$action_name='show_fabric_booking_report';
											$action_name=$report_format_sample_arr[$reportFormatSample];
										}

										$main_booking.="<a href='##' style='color:#000' onclick=\"generate_order_report('3','".$booking_no."','".$company_id."','".$wo_po_id."','".$item_category."','".$fabric_source."','".$job_nos."','".$is_approved."','".$action_name."','".$print_report_format."','".$entryForm."')\"><font style='font-weight:bold' color='$wo_color;'>".$booking_no."</font></a><br>";
									}
									else
									{
										$all_book_prefix_no .= $book_prefix_no . ",";
										if($is_short==1)
										{
											$pre="S";
											$action_name=$report_format_arr[$booking_print_arr[2]];
										}
										else
										{
											$pre="M";
											$action_name=$report_format_arr[$booking_print_arr[1]];
										}
										if($entryForm==86)
										{
											//$action_name=$action_namez;
										}
										else if ($action_name=='') {
											$action_name='show_fabric_booking_report';
										}
										//if($is_short==1) $pre="S"; else $pre="M";

										$main_booking.="<a href='##' style='color:#000' onclick=\"generate_order_report('".$is_short."','".$booking_no."','".$company_id."','".$wo_po_id."','".$item_category."','".$fabric_source."','".$job_nos."','".$is_approved."','".$action_name."','".$print_report_format."')\"><font style='font-weight:bold' color='$wo_color;'>".$booking_no.$pre."</font></a><br>";

									}

									$booking_array[]=$id;
								}
							}
						}

						$grey_rcv_qnty = $grey_rcv_info_arr[$job_no]['grey_receive_qnty'];
						$grey_balance_qnty = $grey_req_qnty-$grey_rcv_qnty;
						$finish_rcv_qnty = $fin_rcv_info_arr[$job_no][$color_id]['finish_receive_qnty'];
						$finish_balance_qnty = $fin_req_qnty-$finish_rcv_qnty;
						$finish_iss_qnty = $fin_issue_info_arr[$job_no][$color_id]['finish_issue_qnty'];
						$finish_rtn_qnty = $fin_rtn_info_arr[$job_no][$color_id]['fin_rtn_qnty'];
						$finish_issue_qnty=$finish_iss_qnty-$finish_rtn_qnty;
						$sewing_line_no = "";
						if($prod_reso_allocation == 1)
						{
							$sewing_line = $resource_alocate_line[$b_sewing_line];
							$sewing_line_arr = explode(",", $sewing_line);
							$sewing_line_name = "";
							foreach ($sewing_line_arr as $line_id)
							{
								$sewing_line_name .= $line_library[$line_id] . ",";
							}

							$sewing_line_name = chop($sewing_line_name, ",");
							$sewing_line_no = $sewing_line_name;
						}
						else
						{
							$sewing_line_no = $line_library[$b_sewing_line];
						}

						$balance = $ex_factory_qnty-$po_quantity_in_pcs;
						$gt_po_qty	+=$po_quantity_in_pcs;
						$gt_grey_req_qnty +=$grey_req_qnty;
						$gt_grey_rcv_qnty +=$grey_rcv_qnty;
						$gt_grey_balance_qnty +=$grey_balance_qnty;
						$gt_fin_req_qnty +=$fin_req_qnty;
						$gt_finish_rcv_qnty +=$finish_rcv_qnty;
						$gt_finish_balance_qnty +=$finish_balance_qnty;
						$gt_finish_issue_qnty +=$finish_issue_qnty;
						$gt_plan_cut_qty += $plan_cut_qnty;
						$gt_cut_lay_qty +=$cutlay;
						$gt_cutting_qc_qty += $cutting_qnty;
						$gt_cutting_balance += $cutting_balance;
						$gt_print_issue_inhouse   += ($print_issue_inhouse+$print_issue_subcon);
						$gt_print_rcv_inhouse	 += ($print_rcv_inhouse+$print_rcv_subcon);
						$gt_print_balance +=($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon);
						$gt_emb_issue_inhouse +=($emb_issue_inhouse+$emb_issue_subcon);
						$gt_emb_rcv_inhouse       += ($emb_rcv_inhouse+$emb_rcv_subcon);
						$gt_emb_balance +=($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon);
						$gt_ttl_sewingin_qnty +=$sewingin_qnty+$sewingin_subcon;
						$gt_ttl_sewingout_qnty += ($sewingout_qnty+$sewingout_subcon);
						$gt_ttl_sewing_balance +=($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty);
						$gt_poly_qnty				+= $poly_qnty;
						$gt_poly_balance +=($sewingout_subcon+$sewingout_qnty)-$poly_qnty;
						$gt_ex_factory_qnty			+=	$ex_factory_qnty;
						$gt_ex_factory_carton_qnty		+= $ex_factory_carton_qnty;
						$gt_shortage				+=	$shortage;
						$gt_excess					+= $excess;
						$gt_balance					+= $balance;
						$gt_sewing_balance			+= ($sewingout_subcon+$sewingout_qnty)-$orderRes["style_qty"];

						if($cbo_date_type==0 || $cbo_date_type==1)
						{
							$date_title=$orderRes["pub_shipment_date"];
						}
						else if($cbo_date_type==2)
						{
							$date_title=$orderRes["shipment_date"];
						}
						else if($cbo_date_type==3)
						{
							$date_title=$orderRes["po_received_date"];
						}
						else if($cbo_date_type==4)
						{
							$date_title=$orderRes["insert_date"];
						}

						$check_string = $orderRes["job_no"];
						if (!in_array($check_string, $checkArr))
						{
							$checkArr[$i] = $check_string;
							if ($i > 1)
							{
								?>
								<tr bgcolor="#CCCCCC" style="font-weight:bold">
									<td width="30">&nbsp;</td>
									<td width="100">&nbsp;</td>
									<td width="100">&nbsp;</td>
									<td width="130">&nbsp;</td>
									<td width="100">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="60">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="100">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="120">&nbsp;</td>
									<td width="130" align="right"><b>Job Wise Sub Total:</b></td>
									<td width="70" align="right"><?=number_format($sub_po_qty,2,'.','');?></td>
									<td width="80">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="80" align="right"><?=number_format($sub_grey_req_qnty,2,'.','');?></td>
									<td width="100" align="right"><?=number_format($sub_grey_rcv_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_grey_balance_qnty,2,'.','');?></td>
									<td width="80">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="80" align="right"><?=number_format($sub_fin_req_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_finish_rcv_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_finish_balance_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_finish_issue_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_plan_cut_qty,2,'.','');?></td>
									<td width="80">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="80" align="right"><?=number_format($sub_cut_lay_qty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_cutting_qc_qty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_cutting_balance,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_print_issue_inhouse,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_print_rcv_inhouse,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_print_balance,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_emb_issue_inhouse,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_emb_rcv_inhouse,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_emb_balance,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_ttl_sewingin_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_ttl_sewingout_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_ttl_sewing_balance,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_sewing_balance,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_poly_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_poly_balance,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_ex_factory_qnty,2,'.','').'<br> ctn:'.number_format($sub_ex_factory_carton_qnty,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_shortage,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_excess,2,'.','');?></td>
									<td width="80" align="right"><?=number_format($sub_balance,2,'.','');?></td>
									<td width="80">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="80">&nbsp;</td>
									<td width="100">&nbsp;</td>
									<td>&nbsp;</td>
								</tr>
								<?
								$sub_po_qty=$sub_grey_req_qnty=$sub_grey_rcv_qnty=$sub_grey_balance_qnty=$sub_fin_req_qnty=$sub_finish_rcv_qnty=$sub_finish_balance_qnty=$sub_finish_issue_qnty=$sub_plan_cut_qty=$sub_cut_lay_qty=$sub_cutting_qc_qty=$sub_cutting_balance=$sub_print_issue_inhouse=$sub_print_rcv_inhouse=$sub_print_balance=$sub_emb_issue_inhouse=$sub_emb_rcv_inhouse=$sub_emb_balance=$sub_ttl_sewingin_qnty=$sub_ttl_sewingout_qnty=$sub_ttl_sewing_balance=$sub_poly_qnty=$sub_poly_balance=$sub_ex_factory_qnty=$sub_ex_factory_carton_qnty=$sub_shortage=$sub_excess=$sub_balance=0;
							}
						}

						?>
						<tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_2nd<? echo $k; ?>', '<? echo $bgcolor; ?>')" id="tr_2nd<? echo $k; ?>">
							<td width="30" align="center" title="<?$item_id?>"><?= $display_font_color.$i.$font_end?></td>
							<td width="100" align="center"><?= $display_font_color.$order_status[$orderRes["is_confirmed"]].$font_end?></td>
							<td width="100" align="center"><?= $display_font_color.$main_booking.$font_end?></td>
							<td width="130" align="center"><?= $display_font_color.$orderRes["style_ref_no"].$font_end?></td>
							<td width="100" align="center"><?= $display_font_color.$buyerArr[$orderRes["buyer_name"]].$font_end?></td>
							<td width="80" align="center"><p><?= $display_font_color.$orderRes["job_no"].$font_end?></p></td>
							<td width="60" align="center"><p><?=$display_font_color.$buyer_short_library[$orderRes["buyer_name_chk"]].$font_end?></p></td>
							<td width="80" align="center"><p><?= change_date_format($date_title)?></p></td>
							<td width="100" align="center"><p><?= $display_font_color.$daysOnHand.$font_end;?></p></td>
							<td width="80" align="center"><p><?= change_date_format($tna_info_arr[12][$orderRes["job_no"]][$color_id]['task_start_date'])?></p></td>
							<td width="120" align="center" ><p><?= $display_font_color.chop($orderRes["order_no"],",").$font_end?></p></td>
							<td width="130" align="center"><p><?= $garments_item[$item_id]?></p></td>
							<?
							echo '<td style="word-wrap: break-word;word-break: break-all;" width="70" align="right"><a href="##" onclick="openmypage_job_color_order('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'JobColorOrderPopup'".')">'.number_format($orderRes["style_qty"],2,'.','').'</a></td>';
							?>
							<td width="80" align="center"><p><?= change_date_format($system_date)?></p></td>
							<td width="80" align="right"><p><?= change_date_format($tna_info_arr[60][$orderRes["job_no"]][$color_id]['task_start_date'])?></p></td>
							<td width="80" align="right"><p><?= change_date_format($tna_info_arr[60][$orderRes["job_no"]][$color_id]['task_finish_date'])?></p></td>

							<td width="80" align="right"><p><?= number_format($grey_req_qnty,2,'.','')?></p></td>
							<?
							echo '<td width="100" align="right"><a href="##" onclick="openmypage_finrcv_popup('."'".chop($orderRes['po_no'],',')."',".$company_name.",".$item_id.",0,".$color_id.",'greyRcvPopup'".')">'.number_format($grey_rcv_qnty,2,'.','').'</a></td>';
							?>
							<td width="80" align="right"><p><?= number_format($grey_balance_qnty,2,'.','')?></p></td>
							<td width="80" align="right"><p><?= $color_Arr_library[$color_id]?></p></td>
							<td width="80" align="right"><p><?= change_date_format($tna_info_arr[61][$orderRes["job_no"]][$color_id]['task_start_date'])?></p></td>

							<td width="80" align="right"><p><?= change_date_format($tna_info_arr[61][$orderRes["job_no"]][$color_id]['task_finish_date'])?></p></td>
							<td width="80" align="right"><p><?= number_format($fin_req_qnty,2,'.','')?></p></td>
							<?
							echo '<td width="80" align="right"><a href="##" onclick="openmypage_finrcv_popup('."'".chop($orderRes['po_no'],',')."',".$company_name.",".$item_id.",0,".$color_id.",'finishRcvPopup'".')">'.number_format($finish_rcv_qnty,2,'.','').'</a></td>';
							?>
							<td width="80" align="right"><p><?= number_format($finish_balance_qnty,2,'.','')?></p></td>
							<?
							echo '<td width="80" align="right"><a href="##" onclick="openmypage_finissue_popup('."'".chop($orderRes['po_no'],',')."',".$company_name.",".$item_id.",0,".$color_id.",'finishissuePopup'".')">'.number_format($finish_issue_qnty,2,'.','').'</a></td>';
							?>
							<td width="80" align="right"><p><?=number_format($plan_cut_qnty,2,'.','')?></p></td>
							<td width="80" align="center"><p><?=change_date_format(change_date_format($tna_info_arr[84][$orderRes["job_no"]][$color_id]['task_start_date']))?></p></td>
							<td width="80" align="center"><p><?=change_date_format(change_date_format($tna_info_arr[84][$orderRes["job_no"]][$color_id]['task_finish_date']))?></p></td>
							<?
							echo '<td width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'17','1','JobColorProdPopup'".')">'.$display_font_color.number_format($cutlay,2,'.','').$font_end.'</a></td>

							<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'1','1','JobColorProdPopup'".')">'.number_format($cutting_qnty,2,'.','').'</a></td>';
							?>
							<td width="80" align="right" title="(Plan Cut Qty - Cutting QC)"><p><?=$cutting_balance?></p></td>
							<?
							echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','1*1','JobColorProdPopup'".')">'.number_format($print_issue_inhouse+$print_issue_subcon,2,'.','').'</a></p></td>

							<td width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','1*1','JobColorProdPopup'".')">'.number_format($print_rcv_inhouse+$print_rcv_subcon,2,'.','').'</a></p></td>';
							?>
							<td width="80" align="right"><p><?=number_format(($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon),2,'.','')?></p></td>
							<?
							echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','1*2','JobColorProdPopup'".')">'.number_format($emb_issue_inhouse+$emb_issue_subcon,2,'.','').'</a></p></td>

							<td width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','1*2','JobColorProdPopup'".')">'.number_format($emb_rcv_inhouse+$emb_rcv_subcon,2,'.','').'</a></p></td>';
							?>
							<td width="80" align="right"><p><?=number_format(($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon),2,'.','')?></p></td>
							<?
							echo '<td width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'4','','JobColorProdPopup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon),2,'.','').'</a></p></td>
							<td width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'5','','JobColorProdPopup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),2,'.','').'</a></p></td>';
							?>
							<td width="80" align="right"><p><?=number_format(($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty),2,'.','');?></p></td>
							<td width="80" align="right" title="(Sewing Out Qty-Order Qty)"><p><?=number_format(($sewingout_subcon+$sewingout_qnty)-$orderRes["style_qty"],2,'.','');?></p></td>
							<td width="80" align="right"><p><?=number_format($poly_qnty,2,'.','');?></p></td>
							<td width="80" align="right"><p><?=number_format(($sewingout_subcon+$sewingout_qnty)-$poly_qnty,2,'.','');?></p></td>
							<?
							echo '<td width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'10','1','JobColorProdPopup'".')">'.number_format($ex_factory_qnty,2,'.','').' </a> <br>  Ctn: '.number_format($ex_factory_carton_qnty,2,'.','').'</td>';
							?>
							<td width="80" align="right"><?=$shortage;?></td>
							<td width="80" align="right"><p><?=$excess;?></p></td>
							<td width="80" align="right"><?=number_format($balance,2,'.','');?></td>
							<td width="80" align="right"><p><?=$floor_arr[$sewing_floor_id];?></p></td>
							<td width="80" align="right"><p><?=$sewing_line_no;?></p></td>
							<?
							echo '<td width="80" align="center"><a href="##" onclick="openmypage_trims_popup('."'".chop($orderRes['po_id'],',')."',".$company_name.",0,0,'jobColorTrimsPopup'".')">Trims Status</a></td>';
							?>
							<td width="80" align="center"><?=$dealing_merchant_library[$orderRes["dealing_marchant"]];?></td>
							<td width="100" align="center"><?=$shipment_status_arr[$orderRes["shiping_status"]];?></td>
							<?
							echo '<td>&nbsp;<a href="##" onclick="openmypage_color_countyr_remark('."'".chop($orderRes['po_id'],',')."',0,'0','".$color_id."','product_all_remarks'".')">Remarks</a></td>';
							?>
						</tr>

						<?
						$sub_po_qty	+=$po_quantity_in_pcs;
						$sub_grey_req_qnty +=$grey_req_qnty;
						$sub_grey_rcv_qnty +=$grey_rcv_qnty;
						$sub_grey_balance_qnty +=$grey_balance_qnty;
						$sub_fin_req_qnty +=$fin_req_qnty;
						$sub_finish_rcv_qnty +=$finish_rcv_qnty;
						$sub_finish_balance_qnty +=$finish_balance_qnty;
						$sub_finish_issue_qnty +=$finish_issue_qnty;
						$sub_plan_cut_qty += $plan_cut_qnty;
						$sub_cut_lay_qty +=$cutlay;
						$sub_cutting_qc_qty += $cutting_qnty;
						$sub_cutting_balance += $cutting_balance;
						$sub_print_issue_inhouse   += ($print_issue_inhouse+$print_issue_subcon);
						$sub_print_rcv_inhouse	 += ($print_rcv_inhouse+$print_rcv_subcon);
						$sub_print_balance +=($print_issue_inhouse+$print_issue_subcon)-($print_rcv_inhouse+$print_rcv_subcon);
						$sub_emb_issue_inhouse +=($emb_issue_inhouse+$emb_issue_subcon);
						$sub_emb_rcv_inhouse       += ($emb_rcv_inhouse+$emb_rcv_subcon);
						$sub_emb_balance +=($emb_issue_inhouse+$emb_issue_subcon)-($emb_rcv_inhouse+$emb_rcv_subcon);
						$sub_ttl_sewingin_qnty +=$sewingin_qnty+$sewingin_subcon;
						$sub_ttl_sewingout_qnty += ($sewingout_qnty+$sewingout_subcon);
						$sub_ttl_sewing_balance +=($sewingin_qnty+$sewingin_subcon)-($sewingout_subcon+$sewingout_qnty);
						$sub_poly_qnty				+= $poly_qnty;
						$sub_poly_balance +=($sewingout_subcon+$sewingout_qnty)-$poly_qnty;
						$sub_ex_factory_qnty			+=	$ex_factory_qnty;
						$sub_ex_factory_carton_qnty		+= $ex_factory_carton_qnty;
						$sub_shortage				+=	$shortage;
						$sub_excess					+= $excess;
						$sub_balance				+= $balance;
						$sub_sewing_balance			+= ($sewingout_subcon+$sewingout_qnty)-$orderRes["style_qty"];

					}
				}
				 ?>
				<tr bgcolor="#CCCCCC" style="font-weight:bold">
					<td width="30">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="130">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="60">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="120">&nbsp;</td>
					<td width="130" align="right"><b>Job Wise Sub Total:</b></td>
					<td width="70" align="right"><?=number_format($sub_po_qty,2,'.','');?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><?=number_format($sub_grey_req_qnty,2,'.','');?></td>
					<td width="100" align="right"><?=number_format($sub_grey_rcv_qnty,2,'.','');?></td>
					<td width="80"><?=number_format($sub_grey_balance_qnty,2,'.','');?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><?=number_format($sub_fin_req_qnty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_finish_rcv_qnty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_finish_balance_qnty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_finish_issue_qnty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_plan_cut_qty,2,'.','');?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80" align="right"><?=number_format($sub_cut_lay_qty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_cutting_qc_qty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_cutting_balance,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_print_issue_inhouse,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_print_rcv_inhouse,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_print_balance,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_emb_issue_inhouse,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_emb_rcv_inhouse,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_emb_balance,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_ttl_sewingin_qnty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_ttl_sewingout_qnty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_ttl_sewing_balance,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_sewing_balance,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_poly_qnty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_poly_balance,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_ex_factory_qnty,2,'.','').'<br> ctn:'.number_format($sub_ex_factory_carton_qnty,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_shortage,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_excess,2,'.','');?></td>
					<td width="80" align="right"><?=number_format($sub_balance,2,'.','');?></td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="80">&nbsp;</td>
					<td width="100">&nbsp;</td>
					<td>&nbsp;</td>
				</tr>
				</table>
				<table border="1" class="tbl_bottom" width="4545" rules="all" id="report_table_footer_1" >
					<tr>
						<td width="30">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="130">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="120">&nbsp;</td>
						<td width="130"><b>Grand Total:</b></td>
						<td width="70"><?=number_format($gt_po_qty,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_grey_req_qnty,2,'.','');?></td>
						<td width="100"><?=number_format($gt_grey_rcv_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_grey_balance_qnty,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_fin_req_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_finish_rcv_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_finish_balance_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_finish_issue_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_plan_cut_qty,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80"><?=number_format($gt_cut_lay_qty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_cutting_qc_qty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_cutting_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_print_issue_inhouse,2,'.','');?></td>
						<td width="80"><?=number_format($gt_print_rcv_inhouse,2,'.','');?></td>
						<td width="80"><?=number_format($gt_print_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_emb_issue_inhouse,2,'.','');?></td>
						<td width="80"><?=number_format($gt_emb_rcv_inhouse,2,'.','');?></td>
						<td width="80"><?=number_format($gt_emb_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_ttl_sewingin_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_ttl_sewingout_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_ttl_sewing_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_sewing_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_poly_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_poly_balance,2,'.','');?></td>
						<td width="80"><?=number_format($gt_ex_factory_qnty,2,'.','').'<br> ctn:'.number_format($gt_ex_factory_carton_qnty,2,'.','');?></td>
						<td width="80"><?=number_format($gt_shortage,2,'.','');?></td>
						<td width="80"><?=number_format($gt_excess,2,'.','');?></td>
						<td width="80"><?=number_format($gt_balance,2,'.','');?></td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="100">&nbsp;</td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</div>
		 </div>
		<?
	}

	$total_data=ob_get_contents();
	$xlHtml=$total_data;
	ob_clean();

	// if($type<1){
	// 	$xlHtml=  strip_tags($xlHtml, '<table></table><thead></thead><tbody></tbody><tfoot></tfoot><tr></tr><th></th><td></td><br>');
	// }

	foreach (glob("$user_id*.xls") as $filename)
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$name=time();
	$filename=$user_id."_".$name.".xls";
	$create_new_doc = fopen($filename,'w');
	$is_created = fwrite($create_new_doc,$xlHtml);
	echo "$total_data####$filename####$type";
	exit();
}
//-------------------------------------------END Show Date Wise------------------------

if($action=="update_tna_progress_comment")
{
	//echo load_html_head_contents("TNA Info","../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);

	if($db_type==0) $blank_date="0000-00-00"; else $blank_date="";

	$tna_task_arr=return_library_array( "select task_name, task_short_name from lib_tna_task",'task_name','task_short_name');

	$tna_task_id=array(); $plan_start_array=array(); $plan_finish_array=array();
	$actual_start_array=array();
	$actual_finish_array=array();

	$notice_start_array=array();
	$notice_finish_array=array();

	$task_sql= sql_select("select a.task_number,a.task_start_date,a.task_finish_date,a.actual_start_date,a.actual_finish_date,a.notice_date_start,a.notice_date_end from tna_process_mst a, lib_tna_task b where a.task_number=b.task_name and a.template_id=$template_id and a.po_number_id=$po_id order by b.task_sequence_no asc");
	foreach ($task_sql as $row_task)
	{
		$tna_task_id[]=$row_task[csf("task_number")];

		$plan_start_array[$row_task[csf("task_number")]] =$row_task[csf("task_start_date")];
		$plan_finish_array[$row_task[csf("task_number")]]=$row_task[csf("task_finish_date")];

		$actual_start_array[$row_task[csf("task_number")]] =$row_task[csf("actual_start_date")];
		$actual_finish_array[$row_task[csf("task_number")]]=$row_task[csf("actual_finish_date")];

		$notice_start_array[$row_task[csf("task_number")]] =$row_task[csf("notice_date_start")];
		$notice_finish_array[$row_task[csf("task_number")]]=$row_task[csf("notice_date_end")];
	}



	$comments_array=array(); $responsible_array=array();
	$res_comm_sql= sql_select("select task_id, comments, responsible from tna_progress_comments where tamplate_id=$template_id and order_id=$po_id");
	foreach ($res_comm_sql as $row_res_comm)
	{
		$comments_array[$row_res_comm[csf("task_id")]] =$row_res_comm[csf("comments")];
		$responsible_array[$row_res_comm[csf("task_id")]]=$row_res_comm[csf("responsible")];
	}

	$execution_time_array=array();
	$execution_time_sql= sql_select("select tna_task_id, execution_days from tna_task_template_details where task_template_id=$template_id");
	foreach ($execution_time_sql as $row_execution_time)
	{
		$execution_time_array[$row_execution_time[csf("tna_task_id")]] =$row_execution_time[csf("execution_days")];
	}

	$lead_time=return_library_array("select task_template_id,lead_time from tna_task_template_details group by task_template_id,lead_time","task_template_id","lead_time");
	$company_library=return_library_array( "select id,company_short_name from lib_company", "id", "company_short_name"  );
    $buyer_short_library=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
	?>


	<fieldset style="width:1010px">
        <div class="form_caption" align="center"><strong>TNA Progress Comment</strong></div>
        <table style="margin-top:10px" width="1000" border="1" rules="all" class="rpt_table">
            <?
			$sql ="select b.company_name,b.buyer_name,a.po_number,b.job_no,b.style_ref_no,b.gmts_item_id,a.po_received_date,a.shipment_date from wo_po_break_down a,wo_po_details_master b where a.id=$po_id and a.job_id=b.id";
			//echo $sql;die;
			$result=sql_select($sql);
            foreach($result as $row)
            {
            ?>
            	<thead>
                    <tr bgcolor="#E9F3FF">
                        <th width="130">Company</th>
                        <td width="196" style="padding-left:5px"><? echo $company_library[$row[csf('company_name')]];  ?></td>
                        <th width="130">Buyer</th>
                        <td width="186" style="padding-left:5px"><? echo $buyer_short_library[$row[csf('buyer_name')]];  ?></td>
                        <th width="130">Order No</th>
                        <td width="186" style="padding-left:5px"><p><? echo $row[csf('po_number')]; ?></p></td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <th>Style Ref.</th>
                        <td style="padding-left:5px"><p><? echo $row[csf('style_ref_no')]; ?></p></td>
                        <th>RMG Item</th>
                        <td style="padding-left:5px"><p><? echo $garments_item[$row[csf('gmts_item_id')]]; ?></p></td>
                        <th>Order Recv. Date</th>
                        <td style="padding-left:5px"><? echo change_date_format($row[csf('po_received_date')]); ?></td>
                    </tr>
                    <tr bgcolor="#E9F3FF">
                        <th>Ship Date</th>
                        <td style="padding-left:5px"><? echo change_date_format($row[csf('shipment_date')]); ?></td>
                        <th>Lead Time</th>
                        <td style="padding-left:5px">
                            <?
								$template_id=str_replace("'","",$template_id);

								if($tna_process_type==1)
								{
									$lead_timee=$lead_time[$template_id];
								}
								else
								{
									$lead_timee=$template_id;
								}
								//echo $lead_time=return_field_value("lead_time","tna_task_template_details", "task_template_id='$template_id' and status_active=1 and is_deleted=0");
								echo $lead_timee;
							?>
                        </td>
                        <th>Job Number</th>
                        <td style="padding-left:5px">
							<? echo $row[csf('job_no')];   ?>
                        </td>
                    </tr>
                </thead>
            <?
            }
            ?>
        </table>
        <table style="margin-top:5px" cellpadding="0" width="1000" class="rpt_table" rules="all" border="1">
            <thead>
                <th width="50">Task No</th>
                <th width="150">Task Name</th>
                <th width="60">Allowed Days</th>
                <th width="80">Plan Start Date</th>
                <th width="80">Plan Finish Date</th>
                <th width="80">Actual Start Date</th>
                <th width="80">Actual Finish Date</th>
                <th width="80">Start Delay/ Early By</th>
                <th width="80">Finish Delay/ Early By</th>
                <th width="100">Responsible</th>
                <th>Comments</th>
            </thead>
        </table>



            <table cellpadding="0" width="1000" cellspacing="0" border="1" rules="all" class="rpt_table">
                <?


				$i=1;
                foreach($tna_task_id as $key)
                {
                    if($i%2==0) $trcolor="#E9F3FF"; else $trcolor="#FFFFFF";

					$bgcolor1=""; $bgcolor="";

					if ($plan_start_array[$key]!=$blank_date)
					{
						if (strtotime($notice_start_array[$key])<=strtotime(date("Y-m-d",time())) && strtotime(date("Y-m-d",time()))<=strtotime($plan_start_array[$key]))  $bgcolor="#FFFF00";
						else if (strtotime($plan_start_array[$key])<strtotime(date("Y-m-d",time())))  $bgcolor="#FF0000";
						else $bgcolor="";

					}

					if ($plan_finish_array[$key]!=$blank_date) {
						if (strtotime($notice_finish_array[$key])<=strtotime(date("Y-m-d",time())) && strtotime(date("Y-m-d",time()))<=strtotime($plan_finish_array[$key]))  $bgcolor1="#FFFF00";
						else if (strtotime($plan_finish_array[$key])<strtotime(date("Y-m-d",time())))  $bgcolor1="#FF0000"; else $bgcolor1="";
					}

					if ($actual_start_array[$key]!=$blank_date) $bgcolor="";
					if ($actual_finish_array[$key]!=$blank_date) $bgcolor1="";

					// Delay / Early............

					$bgcolor5=""; $bgcolor6="";
					$delay=""; $early="";

					if($actual_start_array[$key]!=$blank_date)
					{
						$start_diff1 = datediff( "d", $actual_start_array[$key], $plan_start_array[$key]);
						$finish_diff1 = datediff( "d", $actual_finish_array[$key], $plan_finish_array[$key]);

						$start_diff=$start_diff1-1;
						$finish_diff=$finish_diff1-1;

						if($start_diff<0)
						{
							$bgcolor5="#2A9FFF";	//Blue
							$start="(Delay)";
						}
						if($start_diff>0)
						{
							$bgcolor5="";
							$start="(Early)";

						}
						if($finish_diff<0)
						{
							$bgcolor6="#2A9FFF";
							$finish="(Delay)";
						}
						if($finish_diff>0)
						{
							$bgcolor6="";
							$finish="(Early)";
						}


					}
					else
					{
						if(date("Y-m-d")>$plan_start_array[$key])
						{
							$start_diff1 = datediff( "d", $plan_start_array[$key], date("Y-m-d"));
							$start_diff=$start_diff1-1;
							$bgcolor5="#FF0000";		//Red
							$start="(Delay)";
						}
						if(date("Y-m-d")>$plan_finish_array[$key])
						{
							$finish_diff1 = datediff( "d", $plan_finish_array[$key], date("Y-m-d"));
							$finish_diff=$finish_diff1-1;
							$bgcolor6="#FF0000";
							$finish="(Delay)";
						}
						if(date("Y-m-d")<=$plan_start_array[$key])
						{
							$start_diff = "";
							$bgcolor5="";
							$start="(Ac. Start Dt. Not Found)";
						}
						if(date("Y-m-d")<=$plan_finish_array[$key])
						{
							$finish_diff = "";
							$bgcolor6="";
							$finish="(Ac. Finish Dt. Not Found)";

						}
					}

                    ?>
                    <tr bgcolor="<? echo $trcolor; ?>" id="tr_<? echo $i; ?>" onclick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')">
                        <td align="center" width="50"><? echo $i; ?></td>
                        <td width="150"><? echo $tna_task_arr[$key]; ?></td>
                        <td align="center" width="60"><? echo datediff( "d", $plan_start_array[$key],$plan_finish_array[$key]);//$execution_time_array[$key]; ?></td>
                        <td align="center" width="80"><? echo change_date_format($plan_start_array[$key]); ?>&nbsp;</td>
                        <td align="center" width="80"><? echo change_date_format($plan_finish_array[$key]); ?>&nbsp;</td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor;  ?>">
                            <?
                                if($actual_start_array[$key]=="0000-00-00" || $actual_start_array[$key]=="") echo "&nbsp;";
                                else echo change_date_format($actual_start_array[$key]);
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor1;  ?>">
                            <?
                                 if($actual_finish_array[$key]=="0000-00-00" || $actual_finish_array[$key]=="") echo "&nbsp;";
                                 else echo change_date_format($actual_finish_array[$key]);
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor5;  ?>">
							<?
                                echo $start_diff." ".$start;
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor6;  ?>">
                            <?
                                echo $finish_diff." ".$finish;
                            ?>
                        </td>

                        <td width="100"><p><? echo $responsible_array[$key]; ?>&nbsp;</p></td>
                        <td><p><? echo $comments_array[$key]; ?>&nbsp;</p></td>
                    </tr>
              	<?
                    $i++;
                }
                ?>
            </table>
    </fieldset>
	<?
	exit();
}

if($action=='OrderPopup')
{
	echo load_html_head_contents("Order Wise Production Report", "../../../", 1, 1,$unicode,'','');

	$po_break_down_id=$_REQUEST['po_break_down_id'];
	$item_id=$_REQUEST['item_id'];
	$company_name=str_replace("'","",$_REQUEST['company_name']);
	$color_variable_setting=return_field_value("ex_factory","variable_settings_production","company_name='$company_name' and variable_list=1 and status_active=1 and is_deleted=0","ex_factory");
	$color_variable_setting = ($color_variable_setting==0) ? 3 : $color_variable_setting;
	$ex_fact_qty_arr=array();
	if($color_variable_setting==2 || $color_variable_setting==3)
	{
		$sql_exfect="SELECT c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_break_down_id) and a.item_number_id=$item_id and a.status_active=1 and a.is_deleted=0 group by  c.color_number_id, c.size_number_id";
		//echo $sql_exfect."<br>";
		$sql_result_exfact=sql_select($sql_exfect);
		foreach($sql_result_exfact as $row)
		{
			$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("size_number_id")]]=$row[csf("production_qnty")];
		}
	}

	//var_dump($color_variable_setting);die;
	//echo "select a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where a.status_active=1 and a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.")";die;
	$color_size_sql=sql_select( "SELECT a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.status_active=1 and a.is_deleted=0 and a.po_break_down_id in (".$po_break_down_id.") order by a.color_order,a.size_order");
	$color_size_data=array();
	foreach($color_size_sql as $row)
	{
		//$test_data[]=$row[csf("color_number_id")];

		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
		$color_library[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$size_library[$row[csf("size_number_id")]]=$row[csf("size_number_id")];

	}

	//var_dump($color_size_data);die;

	//echo "<pre>";print_r($color_library);
	//echo "<pre>";print_r($size_library);die;

	//$color_library=sql_select("select distinct(color_number_id) as color_number_id from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and color_mst_id!=0 and status_active=1 ");
	//$size_library=sql_select("select distinct(size_number_id) as size_number_id from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and size_mst_id!=0 and status_active=1");

	if($db_type==0)
	{
		$prod_sql= sql_select("SELECT a.po_break_down_id, c.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='11' THEN c.production_qnty ELSE 0 END),0) AS poly_qty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.po_break_down_id in (".$po_break_down_id.") and a.item_number_id=$item_id and c.status_active=1 and a.status_active=1
			group by a.po_break_down_id,c.color_size_break_down_id");
				/*IFNULL(sum(CASE WHEN c.production_type ='2' THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='3' THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty, */
	}
	else
	{
		$prod_sql=sql_select("SELECT a.po_break_down_id, c.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				NVL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty,
				NVL(sum(CASE WHEN a.production_type ='11' THEN c.production_qnty ELSE 0 END),0) AS poly_qty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.po_break_down_id in (".$po_break_down_id.") and a.item_number_id=$item_id and c.status_active=1 and a.status_active=1
			group by a.po_break_down_id,c.color_size_break_down_id");
				/*NVL(sum(CASE WHEN c.production_type ='2' THEN  c.production_qnty  ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN c.production_type ='3' THEN  c.production_qnty  ELSE 0 END),0) AS printreceived_qnty, */
	}
	$prod_color_size_data=array();
	foreach($prod_sql as $row)
	{
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["cutting_qnty"]+=$row[csf("cutting_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printing_qnty"]+=$row[csf("printing_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printreceived_qnty"]+=$row[csf("printreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["emb_qnty"]+=$row[csf("emb_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["embreceived_qnty"]+=$row[csf("embreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["wash_qnty"]+=$row[csf("wash_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["washreceived_qnty"]+=$row[csf("washreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sp_qnty"]+=$row[csf("sp_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["spreceived_qnty"]+=$row[csf("spreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingin_qnty"]+=$row[csf("sewingin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingout_qnty"]+=$row[csf("sewingout_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finishin_qnty"]+=$row[csf("finishin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["iron_qnty"]+=$row[csf("iron_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finish_qnty"]+=$row[csf("finish_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qty"]+=$row[csf("poly_qty")];
	}
	//echo "<pre>";
	//print_r($prod_color_size_data);die;


	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:700px" align="center" id="details_reports">
	  	<legend>Color And Size Wise Summary</legend>
	    <table id="tbl_id" class="rpt_table" width="" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="100">Buyer</th>
	                <th width="100">Job Number</th>
	                <th width="100">Style Name</th>
	                <th width="300">Order Number</th>
	                <th width="100">Ship Date</th>
	                <th width="100">Item Name</th>
	                <th width="100">Order Qty.</th>
	            </tr>
	        </thead>
	       	<?
	        	$buyer_short_library=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
				if($db_type==0)
				{
	 				$sql = "SELECT a.job_no_mst,group_concat(distinct(d.order_quantity)) as po_number,a.pub_shipment_date, sum(a.po_quantity) as po_quantity,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,c.set_item_ratio,c.gmts_item_id,d.item_number_id
						from wo_po_break_down a, wo_po_details_master b, wo_po_details_mas_set_details c,wo_po_color_size_breakdown d
						where a.job_id=b.id and b.id=c.job_id and a.id in ($po_break_down_id) and c.gmts_item_id=$item_id and d.item_number_id=$item_id and a.id=d.po_break_down_id and b.id=d.job_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.status_active=1 and d.is_deleted=0";
				}
				else
				{
					$sql = "SELECT a.job_no_mst, LISTAGG(a.po_number, ',') WITHIN GROUP (ORDER BY a.id) as po_number,max(a.pub_shipment_date) as pub_shipment_date, sum(d.order_quantity) as po_quantity,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,c.set_item_ratio,c.gmts_item_id,d.item_number_id
						from wo_po_break_down a, wo_po_details_master b, wo_po_details_mas_set_details c,wo_po_color_size_breakdown d
						where a.job_id=b.id and b.job_no=c.job_no and a.id in ($po_break_down_id) and c.gmts_item_id=$item_id and d.item_number_id=$item_id and a.id=d.po_break_down_id and b.id=d.job_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.status_active=1 and d.is_deleted=0 group by a.job_no_mst, a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,c.set_item_ratio,c.gmts_item_id,d.item_number_id";
				}
				//echo $sql;die;
				$resultRow=sql_select($sql);

				$cons_embr=return_field_value("sum(cons_dzn_gmts) as cons_dzn_gmts","wo_pre_cost_embe_cost_dtls","job_no='".$resultRow[0][csf("job_no_mst")]."' and status_active=1 and is_deleted=0","cons_dzn_gmts");

	 		?>
	        <tr>
	        	<td><? echo $buyer_short_library[$resultRow[0][csf("buyer_name")]]; ?></td>
	            <td><p><? echo $resultRow[0][csf("job_no_mst")]; ?></p></td>
	            <td><p><? echo $resultRow[0][csf("style_ref_no")]; ?></p></td>
	            <td><p><? echo implode(",",array_unique(explode(",",$resultRow[0][csf("po_number")]))); ?></p></td>
	            <td><? echo change_date_format($resultRow[0][csf("pub_shipment_date")]); ?></td>
	            <td><? echo $garments_item[$item_id]; ?></td>
	            <td align="right"><? echo number_format($resultRow[0][csf("po_quantity")]*$resultRow[0][csf("set_item_ratio")],2,'.',''); ?></td>
	        </tr>
	         <?
	         $prod_sewing_sql=sql_select("SELECT sum(alter_qnty) as alter_qnty, sum(reject_qnty) as reject_qnty from pro_garments_production_mst where production_type=5 and po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and is_deleted=0 and status_active=1");
			 foreach($prod_sewing_sql as $sewingRow);
			?>
	        <tr>
	        	<td colspan="2">Total Alter Sewing Qty : <b><? echo $sewingRow[csf("alter_qnty")]; ?></b></td>
	        	<td colspan="2">Total Reject Sewing Qty : <b><? echo $sewingRow[csf("reject_qnty")]; ?></b></td>
	            <td colspan="2">Pack Assortment: <b><? echo $packing[$resultRow[csf("packing")]]; ?></b></td>
	        </tr>
	    </table>
	    <?

		  $size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
		  $count = count($size_library);
		  $width= $count*70+350;

		?>
	    <table id="tblDtls_id" class="rpt_table" width="<? echo $width; ?>" border="1" rules="all" >
		 	<thead>
	        	<tr>
	            	<th width="100">Color Name</th>
	                <th width="170">Production Type</th>
	 				<?
					foreach($size_library as $sizeRes)
					{
					 	?><th width="80"><? echo $size_Arr_library[$sizeRes]; ?></th><?
					}
					?>
	     		    <th width="60">Total</th>
	           </tr>
	        </thead>
	        <?
			  //var_dump($color_library);
	       		$cut_lay_sqls="select b.color_id,c.size_id,sum(c.size_qty) as qty from  ppl_cut_lay_mst a,  ppl_cut_lay_dtls b, ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id in($po_break_down_id) and b.gmt_item_id=$item_id group by b.color_id,c.size_id";
				foreach(sql_select($cut_lay_sqls) as $k=>$vl)
				{
					$cut_lay_arr[$vl[csf("color_id")]][$vl[csf("size_id")]]=$vl[csf("qty")];
					$cut_lay_total[$vl[csf("color_id")]]+=$vl[csf("qty")];
				}
				// ==============================================
				$sql_avg = "SELECT AVG (excess_cut_perc) AS avg_excess_cut_perc,color_number_id FROM wo_po_color_size_breakdown where po_break_down_id in($po_break_down_id) and item_number_id =$item_id and status_active=1 AND is_deleted = 0 group by color_number_id";
				// echo $sql_avg;
				$avg_res = sql_select($sql_avg);
				$color_avg_arr = array();
				foreach ($avg_res as $val)
				{
					$color_avg_arr[$val['COLOR_NUMBER_ID']] = $val['AVG_EXCESS_CUT_PERC'];
				}
				// =========================================================
			  foreach($color_library as $colorRes)
			  {
				  if($color_variable_setting==2 || $color_variable_setting==3) $row_span=18; else $row_span=17;
				?>
				<tr>
					<td rowspan="<? echo $row_span; ?>"><? echo $color_Arr_library[$colorRes]; ?></td>

	 			<?
	            	  $i=0;$j=0;$sqlPart="";
					  foreach($size_library as $sizeRes)
					  {
						  $i++;$j++;
						  if($i>1) $sqlPart .=",";
						  $sqlPart .= 'SUM( CASE WHEN color_number_id='.$colorRes.' and size_number_id='.$sizeRes.' THEN order_quantity ELSE 0 END ) as '."col".$i;
						  $sqlPart .= ',SUM( CASE WHEN color_number_id='.$colorRes.' and size_number_id='.$sizeRes.' THEN plan_cut_qnty ELSE 0 END ) as '."pcut".$i;
						  $sqlPart .= ',SUM( CASE WHEN color_number_id='.$colorRes.' and size_number_id='.$sizeRes.' THEN excess_cut_perc ELSE 0 END ) as '."excess_cut".$i;
					  }
					  if($j>1)
					  {
						 $sqlPart .=',SUM( CASE WHEN color_number_id='.$colorRes.' THEN order_quantity ELSE 0 END ) as totalorderqnty';
						 $sqlPart .=',SUM( CASE WHEN color_number_id='.$colorRes.' THEN plan_cut_qnty ELSE 0 END ) as totalplancutqnty';
					  }
					$sql = sql_select("select avg(excess_cut_perc) as avg_excess_cut_perc,max(excess_cut_perc) as excess_cut_perc,". $sqlPart ." from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and status_active=1  and is_deleted=0");
					//echo $sql;die;
					foreach($sql as $resRow);
	 					$bgcolor1="#E9F3FF";
						$bgcolor2="#FFFFFF";

					?>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>">
							<td><b>Order Quantity</b></td>
	                        <? for($k=1;$k<=$i;$k++) {	$col = 'col'.$k; ?>
	                         	<td><? echo $resRow[csf($col)]; ?></td>
							<? } ?>
	                         <td><? echo $resRow[csf("totalorderqnty")]; ?></td>
						</tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Plan To Cut (AVG <? echo number_format($color_avg_arr[$colorRes],2); ?>)% </b></td>
	                        <? for($k=1;$k<=$i;$k++){ $col = 'pcut'.$k;$excess_cut = 'excess_cut'.$k;	?>
	                         	<td title="Excess Cut <? echo $resRow[csf($excess_cut)]; ?>%"><? echo $resRow[csf($col)]; ?></td>
							<? } ?>
	                         <td><? echo $resRow[csf("totalplancutqnty")]; ?></td>
	                    </tr>

	                    <tr bgcolor="<? echo $bgcolor1; ?>">
							<td><b>Cut and Lay</b></td>
	                        <? foreach($size_library as $size_id=>$size_val){?>
	                         	<td><? echo $cut_lay_arr[$colorRes][$size_id]; ?></td>
							<? } ?>
	                         <td><? echo $cut_lay_total[$colorRes]; ?></td>
						</tr>



	                <?
	 				$total_cutting=0;$total_sew_in=0;$total_sew_out=0;$total_fin_in=0;$total_fin_out=0;$total_iron_out=0; $total_exfact_qnty=0;
					$total_print_issue=0;$total_print_rcv=0;$total_embro_issue=0;$total_embro_rcv=0; $total_sp_issue=0;$total_sp_rcv=0; $total_wash_issue=0; $total_wash_rcv=0; $total_poly=0;
					$cutting_html='';$sewin_html='';$sewout_html=''; $poly_html=''; $finisin_html='';$finisout_html='';$iron_html=''; $exfact_html='';
					$printiss_html=''; $printrcv_html=''; $embroiss_html=''; $embrorcv_html=''; $spiss_html=''; $sprcv_html=''; $washiss_html=''; $washrcv_html='';
					$k=0;
					foreach($size_library as $sizeRes)
					{
						$k++;

						/*if($db_type==0)
						{
							$prod_sql= sql_select("SELECT
									IFNULL(sum(CASE WHEN c.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
								from
									pro_garments_production_mst a, pro_garments_production_dtls c,wo_po_color_size_breakdown d
								where
									a.id=c.mst_id and d.po_break_down_id in (".$po_break_down_id.") and d.item_number_id='$item_id' and d.color_number_id=".$colorRes[csf("color_number_id")]." and d.size_number_id=".$sizeRes[csf("size_number_id")]." and c.color_size_break_down_id=d.id and c.status_active=1 $location $floor ");
						}
						else
						{
							$prod_sql=sql_select("SELECT
									NVL(sum(CASE WHEN c.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
									NVL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
									NVL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
									NVL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
									NVL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
									NVL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
									NVL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
									NVL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
									NVL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
									NVL(sum(CASE WHEN c.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
									NVL(sum(CASE WHEN c.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
									NVL(sum(CASE WHEN c.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
									NVL(sum(CASE WHEN c.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
									NVL(sum(CASE WHEN c.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
								from
									pro_garments_production_mst a, pro_garments_production_dtls c, wo_po_color_size_breakdown d
								where
									a.id=c.mst_id and d.po_break_down_id in (".$po_break_down_id.") and d.item_number_id='$item_id' and d.color_number_id=".$colorRes[csf("color_number_id")]." and d.size_number_id=".$sizeRes[csf("size_number_id")]." and c.color_size_break_down_id=d.id and c.status_active=1 $location $floor ");
						}*/
						//echo $prod_sql;$prod_sql; $prod_color_size_data[$row[csf("color_number_id")]][$row[csf("size_number_id")]]["cutting_qnty"]
						//foreach($prod_sql as $prodRow);

						$col = 'col'.$k;
	                    if($prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						$cutting_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"].'</td>';
	                    $total_cutting+=$prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $printiss_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"].'</td>';
	                    $total_print_issue+=$prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $printrcv_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"].'</td>';
	                    $total_print_rcv+=$prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $embroiss_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"].'</td>';
	                    $total_embro_issue+=$prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $embrorcv_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"].'</td>';
	                    $total_embro_rcv+=$prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $spiss_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"].'</td>';
	                    $total_sp_issue+=$prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $sprcv_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"].'</td>';
	                    $total_sp_rcv+=$prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $washiss_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"].'</td>';
	                    $total_wash_issue+=$prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"]>= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $washrcv_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"].'</td>';
	                    $total_wash_rcv+=$prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"];

						if($prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewin_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"].'</td>';
	                    $total_sew_in+=$prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"];

						if($prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewout_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"].'</td>';
	                    $total_sew_out+=$prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"];

						/*if($prodRow[csf("finishin_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						else if($prodRow[csf("finishin_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prodRow[csf("finishin_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisin_html .='<td '.$bgCol.'>'.$prodRow[csf("finishin_qnty")].'</td>';
	                    $total_fin_in+=$prodRow[csf("finishin_qnty")];*/

						if($prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisout_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"].'</td>';
	                    $total_fin_out+=$prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"];

						if($prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $iron_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"].'</td>';
	                    $total_iron_out+=$prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"];

						//if($prodRow[csf("iron_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						//else if($prodRow[csf("iron_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						//else if($prodRow[csf("iron_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							$bgCol=="bgcolor='#FFFFFF'";
							$exfact_html.='<td>'.$ex_fact_qty_arr[$colorRes][$sizeRes].'&nbsp;</td>';

							$total_exfact_qnty+=$ex_fact_qty_arr[$colorRes][$sizeRes];
						}

						if($prod_color_size_data[$colorRes][$sizeRes]["poly_qty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["poly_qty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["poly_qty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $poly_html.='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["poly_qty"].'</td>';
	                    $total_poly+=$prod_color_size_data[$colorRes][$sizeRes]["poly_qty"];


					}// end size foreach loop

					?>
						<tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Cutting</b></td>
	                        <? echo $cutting_html; ?>
	                        <td><? echo $total_cutting; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Print Issue</b></td>
	                        <? echo $printiss_html; ?>
	                        <td><? echo $total_print_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Print Received</b></td>
	                        <? echo $printrcv_html; ?>
	                        <td><? echo $total_print_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Embro Issue</b></td>
	                        <? echo $embroiss_html; ?>
	                        <td><? echo $total_embro_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Embro Received</b></td>
	                        <? echo $embrorcv_html; ?>
	                        <td><? echo $total_embro_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Special Works</b></td>
	                        <? echo $spiss_html; ?>
	                        <td><? echo $total_sp_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Special Works</b></td>
	                        <? echo $sprcv_html; ?>
	                        <td><? echo $total_sp_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Sewing Input</b></td>
	                       <? echo $sewin_html; ?>
	                        <td><? echo $total_sew_in; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Sewing Output</b></td>
	                        <? echo $sewout_html; ?>
	                        <td><? echo $total_sew_out; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Wash</b></td>
	                        <? echo $washiss_html; ?>
	                        <td><? echo $total_wash_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Wash</b></td>
	                        <? echo $washrcv_html; ?>
	                        <td><? echo $total_wash_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Iron Output</b></td>
	                        <? echo $iron_html; ?>
	                        <td><? echo $total_iron_out; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Poly Qty.</b></td>
	                       <? echo $poly_html; ?>
	                        <td><? echo $total_poly; ?></td>
	                    </tr>
	                   <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Finishing Output</b></td>
	                       <? echo $finisout_html; ?>
	                        <td><? echo $total_fin_out; ?></td>
	                    </tr>
	                    <?
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							?>
							<tr>
								<td colspan="2" align="center"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ex-Factory Qty.</b></td>
								 <? echo $exfact_html; ?>
								<td><? echo $total_exfact_qnty; ?>&nbsp;</td>
							</tr>
							<?
						}
						?>
				<?
				}// end color foreach loop
				?>


	 </table>
	</div>


	<?
	exit();

}

if($action=='greyRcvPopup')
{
	echo load_html_head_contents("Order Wise Finish Receive Report", "../../../", 1, 1,$unicode,'','');

	$po_break_down_id=$_REQUEST['po_break_down_id'];
	$item_id=$_REQUEST['item_id'];
	$color_id=$_REQUEST['color_id'];
	//echo "<pre>";print_r($color_id);
	$company_name=str_replace("'","",$_REQUEST['company_name']);

	if($color_id>0)
	{
		$color_id_cond = " and a.color_id='$color_id'";

		$grey_recv_arr = sql_select("SELECT a.order_id FROM pro_grey_prod_entry_dtls a WHERE a.status_active = 1 AND a.is_deleted = 0 AND a.order_id in($po_break_down_id) $color_id_cond group by a.order_id");
		$allPoIdArr = array();
		foreach ($grey_recv_arr as $row) {
			array_push($allPoIdArr,$row[csf('order_id')]);
		}
		$poIdCond = '';
		if(!empty($allPoIdArr)){
			$poIdCond = "".where_con_using_array($allPoIdArr,0,'c.po_breakdown_id')."";
		}
	}

	$fabric_desc_arr=return_library_array("select id, item_description from product_details_master where item_category_id=2","id","item_description");
	$composition_arr=array();
	$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id order by b.id asc";
	$data_array=sql_select($sql_deter);
	if(count($data_array)>0)
	{
		foreach( $data_array as $row )
		{
			if(array_key_exists($row[csf('id')],$composition_arr))
			{
				$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
			}
			else
			{
				$composition_arr[$row[csf('id')]]=$row[csf('construction')].", ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
			}
		}
	}

	$sql="SELECT a.recv_number, a.receive_date, a.receive_basis, a.booking_id, a.booking_no, a.knitting_source, a.challan_no, a.knitting_company, b.prod_id, c.quantity as quantity,c.po_breakdown_id, b.febric_description_id, b.gsm, b.width from inv_receive_master a, pro_grey_prod_entry_dtls b, order_wise_pro_details c where a.id=b.mst_id and b.id=c.dtls_id and a.entry_form in (22,58) and c.entry_form in (22,58) and c.po_breakdown_id in($po_break_down_id) $poIdCond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id in ($company_name) group by b.id, a.recv_number, a.receive_date, a.receive_basis, a.booking_id, a.booking_no, a.knitting_source, a.challan_no, a.knitting_company, b.prod_id,c.po_breakdown_id,c.quantity,b.febric_description_id, b.gsm, b.width";

	//echo $sql;
	$result = sql_select($sql);
	$main_data_array = array();
	foreach ($result as $row)
	{
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["recv_number"]      = $row[csf("recv_number")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["prod_id"]	= $row[csf("prod_id")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["knitting_source"] 	= $row[csf("knitting_source")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["knitting_company"] = $row[csf("knitting_company")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["receive_date"] 	= $row[csf("receive_date")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["gsm"] 	= $row[csf("gsm")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["dia"] 	= $row[csf("width")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["quantity"] += $row[csf("quantity")];

		if($row[csf('febric_description_id')]==0 || $row[csf('febric_description_id')]=="")
		{
			$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["fabric_description"] .=$fabric_desc_arr[$row[csf('prod_id')]].'**';
		}
		else
		{
			$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["fabric_description"] .=$composition_arr[$row[csf('febric_description_id')]].'**';
		}
	}

	//echo "<pre>"; print_r($main_data_array);

	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$supllier_arr=return_library_array( "select id, supplier_name from lib_supplier",'id','supplier_name');

	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:840px" align="center" id="details_reports">
	  	<legend>Grey Fabric Receive Info</legend>
	    <table id="tbl_id" class="rpt_table" width="840" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="40">SL</th>
	            	<th width="140">System Id</th>
	                <th width="80">Rec. Date</th>
	                <th width="100">Product Id</th>
	                <th width="50">GSM</th>
	                <th width="50">Dia</th>
	                <th width="100">Knitting Company</th>
	                <th width="70">Receive Qnty</th>
	                <th>Fabric Description</th>
	            </tr>
	        </thead>
	       	<?
			$i=1;
			$total_grey_rcv = 0;
			foreach ($main_data_array as $rcv_no=>$rcv_no_data)
			{
				foreach ($rcv_no_data as $row)
				{
					//echo "<pre>"; print_r($row);

					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

					if($row["knitting_source"]==1)
						$dye_comp=$company_arr[$row["knitting_company"]];
					else
						$dye_comp=$supllier_arr[$row["knitting_company"]];

					?>
					<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" >
						<td align="center"><? echo $i; ?></td>
						<td align="center"><? echo $row["recv_number"]; ?></td>
						<td align="center"><? echo change_date_format($row["receive_date"]); ?></td>
						<td align="center"><? echo $row["prod_id"]; ?></td>
						<td align="center"><? echo $row["gsm"]; ?></td>
						<td align="center"><? echo $row["dia"]; ?></td>
						<td align="center"><? echo $dye_comp; ?></td>
						<td align="right"><? echo number_format($row["quantity"],2,'.',''); ?></td>
						<td align="center"><? echo implode(",",array_unique(explode("**",chop($row["fabric_description"],'**')))); ?></td>
					</tr>
					<?
					$i++;
					$total_grey_rcv += $row["quantity"];
				}
			}
			?>
			<tr>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="right"><b>Total:</b></td>
				<td align="right"><? echo number_format($total_grey_rcv,2,'.',''); ?></td>
				<td align="center">&nbsp;</td>
			</tr>
	    </table>

	</div>


	<?
	exit();

}

if($action=='finishRcvPopup')
{
	echo load_html_head_contents("Order Wise Finish Receive Report", "../../../", 1, 1,$unicode,'','');

	$po_break_down_id=$_REQUEST['po_break_down_id'];
	$item_id=$_REQUEST['item_id'];
	$color_id=$_REQUEST['color_id'];
	//echo "<pre>";print_r($color_id);
	$company_name=str_replace("'","",$_REQUEST['company_name']);

	if($color_id>0)
	{
		$color_id_cond = " and d.color_id=$color_id";
	}
	else
	{
		$color_id_cond = "";
	}

	$fabric_desc_arr=return_library_array("select id, item_description from product_details_master where item_category_id=2","id","item_description");
	$composition_arr=array();
	$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id order by b.id asc";
	$data_array=sql_select($sql_deter);
	if(count($data_array)>0)
	{
		foreach( $data_array as $row )
		{
			if(array_key_exists($row[csf('id')],$composition_arr))
			{
				$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
			}
			else
			{
				$composition_arr[$row[csf('id')]]=$row[csf('construction')].", ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
			}
		}
	}

	$sql ="SELECT a.id, a.recv_number, a.receive_basis, a.knitting_source, a.knitting_company, a.receive_date, c.batch_no, b.batch_id, b.id AS dtls_id, b.fabric_description_id, b.prod_id, d.quantity from inv_receive_master a, pro_finish_fabric_rcv_dtls b, pro_batch_create_mst c, order_wise_pro_details d where a.id=b.mst_id and b.batch_id=c.id and b.id=d.dtls_id  and d.po_breakdown_id in($po_break_down_id) $color_id_cond and d.entry_form in(37,68,225) and d.status_active=1  and a.entry_form in(37,68,225) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.company_id in($company_name) group by a.id, a.recv_number, a.receive_basis, a.knitting_source, a.knitting_company, a.receive_date, c.batch_no, b.batch_id, b.id, b.fabric_description_id, b.prod_id, d.quantity";

	//echo $sql;
	$result = sql_select($sql);
	$main_data_array = array();
	foreach ($result as $row)
	{
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["recv_number"]      = $row[csf("recv_number")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["receive_basis"]	= $row[csf("receive_basis")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["knitting_source"] 	= $row[csf("knitting_source")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["knitting_company"] = $row[csf("knitting_company")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["receive_date"] 	= $row[csf("receive_date")];
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["batch_no"] 		.= $row[csf("batch_no")].",";
		$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["quantity"] += $row[csf("quantity")];

		if($row[csf('fabric_description_id')]==0 || $row[csf('fabric_description_id')]=="")
		{
			$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["fabric_description"] .=$fabric_desc_arr[$row[csf('prod_id')]].'**';
		}
		else
		{
			$main_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["fabric_description"] .=$composition_arr[$row[csf('fabric_description_id')]].'**';
		}
	}

	//echo "<pre>";print_r($main_data_array);


	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$supllier_arr=return_library_array( "select id, supplier_name from lib_supplier",'id','supplier_name');

	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:840px" align="center" id="details_reports">
	  	<legend>Finish Fabric Receive Info</legend>
	    <table id="tbl_id" class="rpt_table" width="840" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="40">SL</th>
	            	<th width="100">System Id</th>
	                <th width="80">Rec. Date</th>
	                <th width="100">Rec. Basis</th>
	                <th width="80">Batch No</th>
	                <th width="100">Dyeing Source</th>
	                <th width="100">Dyeing Company</th>
	                <th width="70">Receive Qnty</th>
	                <th>Fabric Description</th>
	            </tr>
	        </thead>
	       	<?
			$i=1;
			$total_finish_rcv = 0;
			foreach ($main_data_array as $rcv_num=>$rcv_num_data)
			{
				foreach ($rcv_num_data as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

					if($row["knitting_source"]==1)
						$dye_comp=$company_arr[$row["knitting_company"]];
					else
						$dye_comp=$supllier_arr[$row["knitting_company"]];

					?>
					<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" >
						<td align="center"><? echo $i; ?></td>
						<td><? echo $row["recv_number"]; ?></td>
						<td><? echo change_date_format($row["receive_date"]); ?></td>
						<td><? echo $receive_basis_arr[$row["receive_basis"]]; ?></td>
						<td><? echo implode(",",array_unique(explode(",",chop($row["batch_no"],',')))); ?></td>
						<td><? echo $knitting_source[$row["knitting_source"]]; ?></td>
						<td><? echo $dye_comp; ?></td>
						<td align="right"><? echo number_format($row["quantity"],2,'.',''); ?></td>
						<td><? echo implode(",",array_unique(explode("**",chop($row["fabric_description"],'**')))); ?></td>
					</tr>
					<?
					$i++;
					$total_finish_rcv += $row["quantity"];
				}
			}
			?>

			<tr>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="center">&nbsp;</td>
				<td align="right"><b>Total:</b></td>
				<td align="right"><? echo number_format($total_finish_rcv,2,'.',''); ?></td>
				<td align="center">&nbsp;</td>
			</tr>

	    </table>

	</div>


	<?
	exit();

}

if($action=='finishissuePopup')
{
	echo load_html_head_contents("Order Wise Fabrics Issue  To Cutting Report", "../../../", 1, 1,$unicode,'','');

	$po_break_down_id=$_REQUEST['po_break_down_id'];
	$item_id=$_REQUEST['item_id'];
	$color_id=$_REQUEST['color_id'];
	$company_name=str_replace("'","",$_REQUEST['company_name']);

	if($color_id>0)
	{
		$color_id_cond = " and d.color_id=$color_id";
		$color_id_cond1 = " and c.color_id=$color_id";
	}
	else
	{
		$color_id_cond = "";
		$color_id_cond1 = "";
	}

	/* $fabric_desc_arr=return_library_array("select id, item_description from product_details_master where item_category_id=2","id","item_description");

	$composition_arr=array();
	$sql_deter="select a.id, a.construction, b.copmposition_id, b.percent from lib_yarn_count_determina_mst a, lib_yarn_count_determina_dtls b where a.id=b.mst_id order by b.id asc";
	$data_array=sql_select($sql_deter);
	if(count($data_array)>0)
	{
		foreach( $data_array as $row )
		{
			if(array_key_exists($row[csf('id')],$composition_arr))
			{
				$composition_arr[$row[csf('id')]]=$composition_arr[$row[csf('id')]]." ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
			}
			else
			{
				$composition_arr[$row[csf('id')]]=$row[csf('construction')].", ".$composition[$row[csf('copmposition_id')]]." ".$row[csf('percent')]."%";
			}
		}
	} */



	$sql ="SELECT a.id, a.issue_number, a.challan_no, a.issue_date, c.batch_no, b.prod_id, g.product_name_details, d.quantity from inv_issue_master a, inv_finish_fabric_issue_dtls b, pro_batch_create_mst c, order_wise_pro_details d, wo_po_break_down e, wo_po_details_master f, product_details_master g where a.id=b.mst_id and b.batch_id=c.id and b.id=d.dtls_id and d.po_breakdown_id=e.id and e.job_id=f.id and b.prod_id=g.id and e.id in($po_break_down_id) $color_id_cond and d.entry_form in(18,71) and d.status_active=1  and a.entry_form in(18,71) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.company_id in($company_name)";

	//echo $sql;
	$result = sql_select($sql);
	$main_data_array = array();
	foreach($result as $row)
	{
		$main_data_array[$row[csf("issue_number")]][$row[csf("prod_id")]]["issue_number"] = $row[csf("issue_number")];
		$main_data_array[$row[csf("issue_number")]][$row[csf("prod_id")]]["challan_no"] 	= $row[csf("challan_no")];
		$main_data_array[$row[csf("issue_number")]][$row[csf("prod_id")]]["issue_date"] 	= $row[csf("issue_date")];
		$main_data_array[$row[csf("issue_number")]][$row[csf("prod_id")]]["prod_id"] 	    = $row[csf("prod_id")];
		$main_data_array[$row[csf("issue_number")]][$row[csf("prod_id")]]["batch_no"] 	.= $row[csf("batch_no")].",";
		$main_data_array[$row[csf("issue_number")]][$row[csf("prod_id")]]["product_name_details"] = $row[csf("product_name_details")];
		$main_data_array[$row[csf("issue_number")]][$row[csf("prod_id")]]["quantity"] += $row[csf("quantity")];
	}

	//echo "<pre>";print_r($main_data_array);

	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$supllier_arr=return_library_array( "select id, supplier_name from lib_supplier",'id','supplier_name');

	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:640px" align="center" id="details_reports">
	  	<legend>Issue Info</legend>
	    <table id="tbl_id" class="rpt_table" width="640" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="40">SL</th>
	            	<th width="100">Issue No</th>
	                <th width="80">Challan No</th>
	                <th width="100">Issue Date</th>
	                <th width="80">Batch No</th>
	                <th width="70">Issue Qnty</th>
	                <th>Fabric Description</th>
	            </tr>
	        </thead>
	       	<?
			$i=1;
			$total_finish_issue = 0;
			foreach ($main_data_array as $iss_num=>$iss_num_data)
			{
				foreach ($iss_num_data as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

					?>
					<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" >
						<td align="center"><? echo $i; ?></td>
						<td lign="center"><? echo $row["issue_number"]; ?></td>
						<td lign="center"><? echo $row["challan_no"]; ?></td>
						<td lign="center"><? echo change_date_format($row["issue_date"]); ?></td>
						<td lign="center"><? echo implode(",",array_unique(explode(",",chop($row["batch_no"],',')))); ?></td>
						<td align="right"><? echo number_format($row["quantity"],2,'.',''); ?></td>
						<td lign="center"><p><? echo $row["product_name_details"]; ?></p></td>
					</tr>
					<?
					$i++;
					$total_finish_issue += $row["quantity"];
				}
			}
			?>
			<tr>
				<td align="right" colspan="5"><b>Total Issue : </b></td>
				<td align="right"><? echo number_format($total_finish_issue,2,'.',''); ?></td>
				<td align="center">&nbsp;</td>
			</tr>

	    </table>

		<legend>Issue Return Info</legend>
	    <table id="tbl_id" class="rpt_table" width="640" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="40">SL</th>
	            	<th width="100">Issue No</th>
	                <th width="80">Challan No</th>
	                <th width="100">Issue Date</th>
	                <th width="80">Batch No</th>
	                <th width="70">Issue Qnty</th>
	                <th>Fabric Description</th>
	            </tr>
	        </thead>
	       	<?

			$sql_ret = "SELECT a.recv_number, a.receive_date, b.batch_id_from_fissuertn, b.prod_id, c.quantity, a.challan_no, d.batch_no, e.product_name_details FROM inv_receive_master a, inv_transaction b, order_wise_pro_details c, pro_batch_create_mst d, product_details_master e WHERE a.id = b.mst_id AND b.id = c.trans_id and b.batch_id_from_fissuertn=d.id and b.prod_id=e.id
			AND a.entry_form IN (46, 52) AND c.entry_form IN (46, 52) AND b.transaction_type IN (3, 4) AND c.po_breakdown_id IN ($po_break_down_id) $color_id_cond1 AND a.status_active = 1 AND a.is_deleted = 0 AND b.status_active = 1 AND b.is_deleted = 0 AND c.status_active = 1 AND c.is_deleted = 0 GROUP BY b.id, a.recv_number, a.receive_date, a.challan_no, b.batch_id_from_fissuertn, b.prod_id, d.batch_no, e.product_name_details,c.quantity";

			//echo $sql_ret;
			$sql_ret_result = sql_select($sql_ret);
			$main_data_array = array();
			foreach($sql_ret_result as $row)
			{
				$main_rtn_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["recv_number"] = $row[csf("recv_number")];
				$main_rtn_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["challan_no"] 	= $row[csf("challan_no")];
				$main_rtn_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["receive_date"] 	= $row[csf("receive_date")];
				$main_rtn_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["prod_id"] 	    = $row[csf("prod_id")];
				$main_rtn_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["batch_no"] .= $row[csf("batch_no")].",";
				$main_rtn_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["quantity"] += $row[csf("quantity")];
				$main_rtn_data_array[$row[csf("recv_number")]][$row[csf("prod_id")]]["product_name_details"] = $row[csf("product_name_details")];
			}

			//echo "<pre>";print_r($main_rtn_data_array);

			$j=1; $total_ret_qnty=0;
			$total_finish_issue_rtn = 0;
			foreach ($main_rtn_data_array as $rtn_num=>$rtn_num_data)
			{
				foreach ($rtn_num_data as $row)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

					?>
					<tr bgcolor="<? echo $bgcolor; ?>" style="text-decoration:none; cursor:pointer" >
						<td align="center"><? echo $i; ?></td>
						<td lign="center"><? echo $row["recv_number"]; ?></td>
						<td lign="center"><? echo $row["challan_no"]; ?></td>
						<td lign="center"><? echo change_date_format($row["receive_date"]); ?></td>
						<td lign="center"><? echo implode(",",array_unique(explode(",",chop($row["batch_no"],',')))); ?></td>
						<td align="right"><? echo number_format($row["quantity"],2,'.',''); ?></td>
						<td lign="center"><p><? echo $row["product_name_details"]; ?></p></td>
					</tr>
					<?
					$i++;
					$total_finish_issue_rtn += $row["quantity"];
				}
			}
			?>
			<tr>
				<td align="right" colspan="5"><b>Total Issue Return : </b></td>
				<td align="right"><? echo number_format($total_finish_issue_rtn,2,'.',''); ?></td>
				<td align="center">&nbsp;</td>
			</tr>
			<tr>
				<th colspan="5" align="right">Total Issue to Cut : </th>
				<th align="right"><? $tot_iss_to_cut=$total_finish_issue-$total_finish_issue_rtn; echo number_format($tot_iss_to_cut,2); ?></th>
				<th>&nbsp;</th>
			</tr>

	    </table>

	</div>



	<?
	exit();

}

if($action=='trimsPopup')
{
	echo load_html_head_contents("Trims Info Details", "../../../", 1, 1,$unicode,'','');
	require_once('../../../includes/class4/class.conditions.php');
	require_once('../../../includes/class4/class.reports.php');
	require_once('../../../includes/class4/class.trims.php');

	$po_break_down_id=$_REQUEST['po_break_down_id'];
	//var_dump($po_break_down_id);

	$item_id=$_REQUEST['item_id'];
	$company_name=str_replace("'","",$_REQUEST['company_name']);

	$condition= new condition();
	$condition->company_name("=$company_name");
	if($po_break_down_id!='')
	{
		$condition->po_id("in(".$po_break_down_id.")");
	}

	$condition->init();

	$trims= new trims($condition);
	//echo $trims->getQuery();die;
	$trims_costing_arr=$trims->getQtyArray_by_orderAndItemid();

	function chop_last_string($str,$trim_str)
	{
		//alert("hello");
		$main_str_len=strlen($str);
		$trim_str_len=strlen($trim_str);
		$str2='';
		$str2=substr($str, $main_str_len-$trim_str_len, $trim_str_len);
		if ($trim_str==$str2) return substr($str,0,$main_str_len-$trim_str_len);
		else return $str;
	}


	$null_val=" a.item_color as item_color, a.item_size as item_size";

	$sql_bookingqty ="SELECT d.buyer_name, d.season_buyer_wise, d.job_no, d.style_ref_no, d.total_set_qnty, c.id as po_id, c.po_number, c.file_no, c.grouping as int_ref_no, c.po_quantity, b.trim_group, b.booking_no, b.uom, a.description, $null_val, a.cons, a.amount, p.currency_id,d.id as job_id
	from  wo_booking_mst p, wo_trim_book_con_dtls a, wo_booking_dtls b, wo_po_break_down c, wo_po_details_master d
	where p.booking_no=a.booking_no and p.booking_no=b.booking_no and a.wo_trim_booking_dtls_id=b.id and b.po_break_down_id=c.id and c.job_id=d.id and d.company_name in($company_name) and b.booking_type=2 and a.cons>0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.id in($po_break_down_id) order by d.job_no";

	//echo $sql_bookingqty;
	$rslt_bookingqty = sql_select($sql_bookingqty);
	$chkJobId = array();
	$jobIdArr = array();
	foreach($rslt_bookingqty as $row)
	{
		if($chkJobId[$row[csf("job_id")]]=="")
		{
			$chkJobId[$row[csf("job_id")]] = $row[csf("job_id")];
			$jobIdArr[$row[csf("job_id")]] = $row[csf("job_id")];
		}
	}

	$issue_qty_sql="SELECT b.po_breakdown_id, a.item_color as item_color_id, a.item_size, a.item_group_id, a.item_description, b.quantity, c.cons_rate as rate, b.entry_form, b.trans_type, c.store_id, b.reject_qty
	from product_details_master a, order_wise_pro_details b, inv_transaction c where a.id=b.prod_id and b.trans_id=c.id and item_category_id=4  and b.entry_form in(24,25,49,73) and b.trans_type in(1,2,3,4) and c.transaction_type in(1,2,3,4) and b.po_breakdown_id in($po_break_down_id) and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
	//echo $issue_qty_sql;
	$issue_qty_sql_result=sql_select($issue_qty_sql);
	$issue_data_arr=array();
	foreach($issue_qty_sql_result as $row)
	{
		if($row[csf('item_size')]=="") $item_size_id=0; else $item_size_id=$row[csf('item_size')];

		$item_description=trim($row[csf("item_description")]);
		$trim_str=", [BS]";
		$item_desc=chop_last_string($item_description,$trim_str);

		if($row[csf('entry_form')]==24 && $row[csf('trans_type')]==1)
		{
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["rcv_quantity"]+=$row[csf('quantity')];
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["rcv_amt"]+=$row[csf('quantity')]*$row[csf('rate')];
		}
		if($row[csf('entry_form')]==49 && $row[csf('trans_type')]==3)
		{
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["rcv_rtn_quantity"]+=$row[csf('quantity')];
		}
		if($row[csf('entry_form')]==25 && $row[csf('trans_type')]==2)
		{
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["issue_quantity"]+=$row[csf('quantity')];
		}
		if($row[csf('entry_form')]==73 && $row[csf('trans_type')]==4)
		{
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["issue_rtn_quantity"]+=$row[csf('quantity')];
		}
	}
	//echo "<pre>";print_r($issue_data_arr);

	$trans_qty_sql="SELECT b.po_breakdown_id, a.item_color as item_color_id, a.item_size, a.item_group_id, a.item_description, b.quantity, c.cons_rate as rate, b.entry_form, b.trans_type, c.store_id, d.job_no_mst as job_no
	from product_details_master a, order_wise_pro_details b, inv_transaction c ,wo_po_break_down d
	where a.id=b.prod_id and b.trans_id=c.id and d.id=b.po_breakdown_id and d.id=c.order_id and item_category_id=4 and b.po_breakdown_id in($po_break_down_id)  and b.entry_form in(78,112) and b.trans_type in(5,6) and c.transaction_type in(5,6) and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";

	//echo $trans_qty_sql;
	$trans_qty_sql_result=sql_select($trans_qty_sql);
	$transfer_data_arr=array();
	//$chk_all_order_id=array_unique(explode(",",$all_order_id));
	foreach($trans_qty_sql_result as $row)
	{
		if($row[csf('item_size')]=="") $item_size_id=0; else $item_size_id=$row[csf('item_size')];

		$item_description=trim($row[csf("item_description")]);
		$trim_str=", [BS]";
		$item_desc=chop_last_string($item_description,$trim_str);

		if(($row[csf('entry_form')]==78 || $row[csf('entry_form')]==112) && $row[csf('trans_type')]==5)
		{
			$transfer_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["transfer_in_quantity"]+=$row[csf('quantity')];
			$transfer_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["transfer_in_amt"]+=$row[csf('quantity')]*$row[csf('rate')];

		}
		if(($row[csf('entry_form')]==78 || $row[csf('entry_form')]==112) && $row[csf('trans_type')]==6)
		{
			$transfer_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["transfer_out_quantity"]+=$row[csf('quantity')];
			$transfer_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["transfer_out_amt"]+=$row[csf('quantity')]*$row[csf('rate')];

		}
	}

	if(!empty($jobIdArr))
	{
		$pre_cost_trim_sql="SELECT a.trim_group, a.description, a.cons_breack_down, a.brand_sup_ref, a.cons_dzn_gmts
		from wo_pre_cost_trim_cost_dtls a
		where a.status_active=1 and a.is_deleted=0 ".where_con_using_array($jobIdArr,0,'job_id')."";
		//echo $pre_cost_trim_sql;
		$pre_cost_trim_sql_result=sql_select($pre_cost_trim_sql);
		$trims_pre_cost_arr = array();
		foreach($pre_cost_trim_sql_result as $row)
		{
			$cons_breack_down = explode('_',$row[csf('cons_breack_down')]);
			$trims_pre_cost_arr[$cons_breack_down[0]][$row[csf('trim_group')]]["brand_sup_ref"]=$row[csf('brand_sup_ref')];
			$trims_pre_cost_arr[$cons_breack_down[0]][$row[csf('trim_group')]]["cons_dzn_gmts"]+=$row[csf('cons_dzn_gmts')];
		}
		//echo "<pre>";print_r($trims_pre_cost_arr);
		unset($pre_cost_trim_sql_result);

	}

	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$supllier_arr=return_library_array( "select id, supplier_name from lib_supplier",'id','supplier_name');
	$trim_group= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				{
				var w = window.open("Surprise", "#");
				var d = w.document.open();
				d.write(document.getElementById('details_reports').innerHTML);
				d.close();
				}

	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:1110px" align="center" id="details_reports">
	  	<legend>Accessories Status</legend>
	    <table id="tbl_id" class="rpt_table" width="1100" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="40">SL</th>
	            	<th width="100">Trims Name</th>
	                <th width="200">Item Description</th>
	                <th width="100">Brand/Sup Ref</th>
	                <th width="80">Avg. Cons</th>
	                <th width="80">Req Qty</th>
	                <th width="80">WO Qty</th>
	                <th width="80">Trims UOM</th>
	                <th width="80">In-House Qty</th>
	                <th width="80">Receive Balance</th>
	                <th width="80">Issue to Prod.</th>
	                <th>Left Over/Balance</th>
	            </tr>
	        </thead>
	       	<?

			$i=1;
			$recv_qnty=$rcv_rtn_qty=$issue_qty=$issue_rtn_qty=$req_qnty=0;
			foreach($rslt_bookingqty as $row)
			{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

				$recv_qnty=$issue_data_arr[$row[csf("po_id")]][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["rcv_quantity"];
				$recv_amt+=$issue_data_arr[$row[csf("po_id")]][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["rcv_amt"];
				$rcv_rtn_qty=$issue_data_arr[$row[csf("po_id")]][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["rcv_rtn_quantity"];


				if($recv_amt>0 && $recv_qnty>0)
				{
					$ord_avg_rate=($recv_amt/$recv_qnty);
				}
				else
				{
					$ord_avg_rate=0;
				}

				$issue_qty=$issue_data_arr[$row[csf("po_id")]][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["issue_quantity"];
				$issue_rtn_qty=$issue_data_arr[$row[csf("po_id")]][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["issue_rtn_quantity"];


				$transfer_in_qty=$transfer_data_arr[$row[csf("po_id")]][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["transfer_in_quantity"];
				$transfer_out_qty=$transfer_data_arr[$row[csf("po_id")]][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["transfer_out_quantity"];

				$receive_qnty=$recv_qnty-$rcv_rtn_qty;
				$net_recv_qnty=$receive_qnty+$transfer_in_qty;
				$iss_qnty=$issue_qty-$issue_rtn_qty;
				$net_issue_qnty=$iss_qnty+$transfer_out_qty;

				$brand_sup_ref = $trims_pre_cost_arr[$row[csf("po_id")]][$row[csf("trim_group")]]["brand_sup_ref"];
				$avg_cons = $trims_pre_cost_arr[$row[csf("po_id")]][$row[csf("trim_group")]]["cons_dzn_gmts"];

				$req_qnty=$trims_costing_arr[$row[csf("po_id")]][$row[csf("trim_group")]];

				?>
				 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr<? echo $i;?>','<? echo $bgcolor;?>')" id="tr<? echo $i;?>" style="text-decoration:none; cursor:pointer" >

					<td align="center" title="<? echo $row[csf("po_id")];?>"><? echo $i; ?></td>
					<td title="<? echo $row[csf("trim_group")];?>"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
					<td><? echo $row[csf("description")]; ?></td>
					<td align="center"><? echo $brand_sup_ref; ?></td>
					<td align="right"><? echo $avg_cons; ?></td>
					<td align="right"><? echo number_format($req_qnty,2); ?></td>
					<td align="right"><? echo number_format($row[csf("cons")],2); ?></td>
					<td align="right"><? echo $unit_of_measurement[$row[(csf('uom'))]]; ?></td>
					<td align="right"><? echo number_format($receive_qnty,2); ?></td>
					<td align="right"><? echo number_format($row[csf("cons")]-$receive_qnty,2); ?></td>
					<td align="right"><? echo number_format($iss_qnty,2); ?></td>
					<td align="right">
						<?
						   $left_over=$net_recv_qnty-$net_issue_qnty;
						   $tot_left_val=$left_over*$ord_avg_rate; echo number_format($tot_left_val,2);
						?>
					</td>
				</tr>
				<?
				$i++;
			}
			?>

	    </table>

	</div>
	<?
	exit();

}

if($action=='jobColorTrimsPopup')
{
	echo load_html_head_contents("Trims Info Details", "../../../", 1, 1,$unicode,'','');
	require_once('../../../includes/class4/class.conditions.php');
	require_once('../../../includes/class4/class.reports.php');
	require_once('../../../includes/class4/class.trims.php');

	$po_break_down_id=$_REQUEST['po_break_down_id'];
	//var_dump($po_break_down_id);

	$item_id=$_REQUEST['item_id'];
	$company_name=str_replace("'","",$_REQUEST['company_name']);

	$condition= new condition();
	$condition->company_name("=$company_name");
	if($po_break_down_id!='')
	{
		$condition->po_id("in(".$po_break_down_id.")");
	}

	$condition->init();

	$trims= new trims($condition);
	//echo $trims->getQuery();die;
	$trims_costing_arr=$trims->getQtyArray_by_orderAndItemid();

	function chop_last_string($str,$trim_str)
	{
		//alert("hello");
		$main_str_len=strlen($str);
		$trim_str_len=strlen($trim_str);
		$str2='';
		$str2=substr($str, $main_str_len-$trim_str_len, $trim_str_len);
		if ($trim_str==$str2) return substr($str,0,$main_str_len-$trim_str_len);
		else return $str;
	}



	//$null_val=" a.item_color as item_color, a.item_size as item_size";

	$sql_bookingqty = "SELECT d.job_no,b.trim_group,b.uom,a.description, sum(a.cons) as cons, a.item_color, a.item_size, LISTAGG (CAST (c.id AS VARCHAR2 (4000)), ',' ON OVERFLOW TRUNCATE)
	WITHIN GROUP (ORDER BY c.id)
	AS po_id, d.id as job_id
    FROM wo_booking_mst       p,
         wo_trim_book_con_dtls a,
         wo_booking_dtls      b,
         wo_po_break_down     c,
         wo_po_details_master d
   WHERE     p.booking_no = a.booking_no
         AND p.booking_no = b.booking_no
         AND a.wo_trim_booking_dtls_id = b.id
         AND b.po_break_down_id = c.id
         AND c.job_id = d.id
         AND d.company_name IN ($company_name)
         AND b.booking_type = 2
         AND a.cons > 0
         AND a.status_active = 1
         AND a.is_deleted = 0
         AND b.status_active = 1
         AND b.is_deleted = 0
         AND c.id IN ($po_break_down_id)
    group by d.job_no,b.trim_group,b.uom,a.description, a.item_color, a.item_size, d.id ";



	/* $sql_bookingqty = "SELECT d.buyer_name, d.season_buyer_wise, d.job_no, d.style_ref_no, d.total_set_qnty, c.id as po_id, c.po_number, c.file_no, c.grouping as int_ref_no, c.po_quantity, b.trim_group, b.booking_no, b.uom, a.description, $null_val, a.cons, a.amount, p.currency_id,d.id as job_id
	from  wo_booking_mst p, wo_trim_book_con_dtls a, wo_booking_dtls b, wo_po_break_down c, wo_po_details_master d
	where p.booking_no=a.booking_no and p.booking_no=b.booking_no and a.wo_trim_booking_dtls_id=b.id and b.po_break_down_id=c.id and c.job_id=d.id and d.company_name in($company_name) and b.booking_type=2 and a.cons>0 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.id in($po_break_down_id) order by d.job_no"; */

	//echo $sql_bookingqty;
	$rslt_bookingqty = sql_select($sql_bookingqty);
	$chkJobId = array();
	$jobIdArr = array();
	foreach($rslt_bookingqty as $row)
	{
		if($chkJobId[$row[csf("job_id")]]=="")
		{
			$chkJobId[$row[csf("job_id")]] = $row[csf("job_id")];
			$jobIdArr[$row[csf("job_id")]] = $row[csf("job_id")];
		}
	}

	$issue_qty_sql="SELECT b.po_breakdown_id, a.item_color as item_color_id, a.item_size, a.item_group_id, a.item_description, b.quantity, c.cons_rate as rate, b.entry_form, b.trans_type, c.store_id, b.reject_qty
	from product_details_master a, order_wise_pro_details b, inv_transaction c where a.id=b.prod_id and b.trans_id=c.id and item_category_id=4  and b.entry_form in(24,25,49,73) and b.trans_type in(1,2,3,4) and c.transaction_type in(1,2,3,4) and b.po_breakdown_id in($po_break_down_id) and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";
	//echo $issue_qty_sql;
	$issue_qty_sql_result=sql_select($issue_qty_sql);
	$issue_data_arr=array();
	foreach($issue_qty_sql_result as $row)
	{
		if($row[csf('item_size')]=="") $item_size_id=0; else $item_size_id=$row[csf('item_size')];

		$item_description=trim($row[csf("item_description")]);
		$trim_str=", [BS]";
		$item_desc=chop_last_string($item_description,$trim_str);

		if($row[csf('entry_form')]==24 && $row[csf('trans_type')]==1)
		{
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["rcv_quantity"]+=$row[csf('quantity')];
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["rcv_amt"]+=$row[csf('quantity')]*$row[csf('rate')];
		}
		if($row[csf('entry_form')]==49 && $row[csf('trans_type')]==3)
		{
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["rcv_rtn_quantity"]+=$row[csf('quantity')];
		}
		if($row[csf('entry_form')]==25 && $row[csf('trans_type')]==2)
		{
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["issue_quantity"]+=$row[csf('quantity')];
		}
		if($row[csf('entry_form')]==73 && $row[csf('trans_type')]==4)
		{
			$issue_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["issue_rtn_quantity"]+=$row[csf('quantity')];
		}
	}
	//echo "<pre>";print_r($issue_data_arr);

	$trans_qty_sql="SELECT b.po_breakdown_id, a.item_color as item_color_id, a.item_size, a.item_group_id, a.item_description, b.quantity, c.cons_rate as rate, b.entry_form, b.trans_type, c.store_id, d.job_no_mst as job_no
	from product_details_master a, order_wise_pro_details b, inv_transaction c ,wo_po_break_down d
	where a.id=b.prod_id and b.trans_id=c.id and d.id=b.po_breakdown_id and d.id=c.order_id and item_category_id=4 and b.po_breakdown_id in($po_break_down_id)  and b.entry_form in(78,112) and b.trans_type in(5,6) and c.transaction_type in(5,6) and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0";

	//echo $trans_qty_sql;
	$trans_qty_sql_result=sql_select($trans_qty_sql);
	$transfer_data_arr=array();
	//$chk_all_order_id=array_unique(explode(",",$all_order_id));
	foreach($trans_qty_sql_result as $row)
	{
		if($row[csf('item_size')]=="") $item_size_id=0; else $item_size_id=$row[csf('item_size')];

		$item_description=trim($row[csf("item_description")]);
		$trim_str=", [BS]";
		$item_desc=chop_last_string($item_description,$trim_str);

		if(($row[csf('entry_form')]==78 || $row[csf('entry_form')]==112) && $row[csf('trans_type')]==5)
		{
			$transfer_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["transfer_in_quantity"]+=$row[csf('quantity')];
			$transfer_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["transfer_in_amt"]+=$row[csf('quantity')]*$row[csf('rate')];

		}
		if(($row[csf('entry_form')]==78 || $row[csf('entry_form')]==112) && $row[csf('trans_type')]==6)
		{
			$transfer_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["transfer_out_quantity"]+=$row[csf('quantity')];
			$transfer_data_arr[$row[csf('po_breakdown_id')]][$row[csf('item_group_id')]][$item_desc][$row[csf('item_color_id')]][$item_size_id]["transfer_out_amt"]+=$row[csf('quantity')]*$row[csf('rate')];

		}
	}

	if(!empty($jobIdArr))
	{
		$pre_cost_trim_sql="SELECT a.trim_group, a.description, a.cons_breack_down, a.brand_sup_ref, a.cons_dzn_gmts
		from wo_pre_cost_trim_cost_dtls a
		where a.status_active=1 and a.is_deleted=0 ".where_con_using_array($jobIdArr,0,'job_id')."";
		//echo $pre_cost_trim_sql;
		$pre_cost_trim_sql_result=sql_select($pre_cost_trim_sql);
		$trims_pre_cost_arr = array();
		foreach($pre_cost_trim_sql_result as $row)
		{
			$cons_breack_down = explode('_',$row[csf('cons_breack_down')]);
			$trims_pre_cost_arr[$cons_breack_down[0]][$row[csf('trim_group')]]["brand_sup_ref"]=$row[csf('brand_sup_ref')];
			$trims_pre_cost_arr[$cons_breack_down[0]][$row[csf('trim_group')]]["cons_dzn_gmts"]+=$row[csf('cons_dzn_gmts')];
		}
		//echo "<pre>";print_r($trims_pre_cost_arr);
		unset($pre_cost_trim_sql_result);

	}

	$company_arr=return_library_array( "select id, company_name from lib_company",'id','company_name');
	$supllier_arr=return_library_array( "select id, supplier_name from lib_supplier",'id','supplier_name');
	$trim_group= return_library_array("select id, item_name from lib_item_group",'id','item_name');
	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				{
				var w = window.open("Surprise", "#");
				var d = w.document.open();
				d.write(document.getElementById('details_reports').innerHTML);
				d.close();
				}

	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:1110px" align="center" id="details_reports">
	  	<legend>Accessories Status</legend>
	    <table id="tbl_id" class="rpt_table" width="1100" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="40">SL</th>
	            	<th width="100">Trims Name</th>
	                <th width="200">Item Description</th>
	                <th width="100">Brand/Sup Ref</th>
	                <th width="80">Avg. Cons</th>
	                <th width="80">Req Qty</th>
	                <th width="80">WO Qty</th>
	                <th width="80">Trims UOM</th>
	                <th width="80">In-House Qty</th>
	                <th width="80">Receive Balance</th>
	                <th width="80">Issue to Prod.</th>
	                <th>Left Over/Balance</th>
	            </tr>
	        </thead>
	       	<?


			$i=1;

			foreach($rslt_bookingqty as $row)
			{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";


				$recv_qnty=$rcv_rtn_qty=$issue_qty=$issue_rtn_qty=$transfer_in_qty=$transfer_out_qty=$avg_cons=$req_qnty=0;
				$brand_sup_ref='';

				$po_id = explode(",", $row[csf('po_id')]);
				foreach ($po_id as $val)
				{
					$recv_qnty += $issue_data_arr[$val][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["rcv_quantity"];
					// $recv_amt += $issue_data_arr[$val][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["rcv_amt"];
					$rcv_rtn_qty += $issue_data_arr[$val][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["rcv_rtn_quantity"];

					$issue_qty += $issue_data_arr[$val][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["issue_quantity"];
					$issue_rtn_qty += $issue_data_arr[$val][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["issue_rtn_quantity"];


					$transfer_in_qty += $transfer_data_arr[$val][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["transfer_in_quantity"];
					$transfer_out_qty += $transfer_data_arr[$val][$row[csf("trim_group")]][trim($row[csf("description")])][$row[csf("item_color")]][$row[csf("item_size")]]["transfer_out_quantity"];

					$brand_sup_ref .= $trims_pre_cost_arr[$val][$row[csf("trim_group")]]["brand_sup_ref"].',';
					$avg_cons += $trims_pre_cost_arr[$row[csf("po_id")]][$row[csf("trim_group")]]["cons_dzn_gmts"];

					$req_qnty +=$trims_costing_arr[$val][$row[csf("trim_group")]];
				}




				if($recv_amt>0 && $recv_qnty>0)
				{
					$ord_avg_rate=($recv_amt/$recv_qnty);
				}
				else
				{
					$ord_avg_rate=0;
				}



				$receive_qnty=$recv_qnty-$rcv_rtn_qty;
				$net_recv_qnty=$receive_qnty+$transfer_in_qty;
				$iss_qnty=$issue_qty-$issue_rtn_qty;
				$net_issue_qnty=$iss_qnty+$transfer_out_qty;



				?>
				 <tr bgcolor="<? echo $bgcolor;?>" onClick="change_color('tr<? echo $i;?>','<? echo $bgcolor;?>')" id="tr<? echo $i;?>" style="text-decoration:none; cursor:pointer" >

					<td align="center" title="<? echo $row[csf("po_id")];?>"><? echo $i; ?></td>
					<td title="<? echo $row[csf("trim_group")];?>"><? echo $trim_group[$row[csf("trim_group")]]; ?></td>
					<td><? echo $row[csf("description")]; ?></td>
					<td align="center"><? echo chop($brand_sup_ref,','); ?></td>
					<td align="right"><? echo $avg_cons; ?></td>
					<td align="right"><? echo number_format($req_qnty,2); ?></td>
					<td align="right"><? echo number_format($row[csf("cons")],2); ?></td>
					<td align="right"><? echo $unit_of_measurement[$row[(csf('uom'))]]; ?></td>
					<td align="right"><? echo number_format($receive_qnty,2); ?></td>
					<td align="right"><? echo number_format($row[csf("cons")]-$receive_qnty,2); ?></td>
					<td align="right"><? echo number_format($iss_qnty,2); ?></td>
					<td align="right">
						<?
						   $left_over=$net_recv_qnty-$net_issue_qnty;
						   $tot_left_val=$left_over*$ord_avg_rate; echo number_format($tot_left_val,2);
						?>
					</td>
				</tr>
				<?
				$i++;
			}
			?>

	    </table>

	</div>
	<?
	exit();

}


if ($action=='OrderPopup_country')
{
	echo load_html_head_contents("Order Wise Production Report", "../../../", 1, 1,$unicode,'','');
	extract($_REQUEST);

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$company_name=str_replace("'","",$company_name);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);

	//echo $po_break_down_id."****".$company_name."****".$item_id."****".$country_id."****".$color_id;die;
	if($country_id>0) $contry_cond=" and a.country_id='$country_id'"; else $contry_cond="";
	$sql_exfect="SELECT c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id =$po_break_down_id and c.color_number_id='$color_id' $contry_cond and a.status_active=1 and a.is_deleted=0 group by  c.color_number_id, c.size_number_id";
	$sql_result_exfact=sql_select($sql_exfect);
	foreach($sql_result_exfact as $row)
	{
		$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("size_number_id")]]=$row[csf("production_qnty")];
	}

	$color_library=array(); $size_library=array(); $color_library_plan=array(); $dataQty=array();
	if($country_id>0) $contry_cond_col_size=" and country_id='$country_id'"; else $contry_cond_col_size="";
	$colorSizeData=sql_select("SELECT id, color_number_id, size_number_id,size_order, order_quantity, plan_cut_qnty, excess_cut_perc from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and color_number_id='$color_id' $contry_cond_col_size and status_active=1 and is_deleted=0 order by size_order");
 	  foreach($colorSizeData as $csRow)
	  {
		  if($csRow[csf('color_number_id')]>0)
		  {
			  $color_library[$csRow[csf('color_number_id')]]+=$csRow[csf('order_quantity')];
			  $color_library_plan[$csRow[csf('color_number_id')]]+=$csRow[csf('plan_cut_qnty')];
		  }

		  if($csRow[csf('size_number_id')]>0)
		  {
			  $size_library[$csRow[csf('size_number_id')]]=$csRow[csf('size_number_id')];
		  }

		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][1]+=$csRow[csf('order_quantity')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][2]+=$csRow[csf('plan_cut_qnty')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][3]+=$csRow[csf('excess_cut_perc')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][4]+=1;
		  $color_size_data[$csRow[csf("id")]]["color_number_id"]=$csRow[csf('color_number_id')];
		  $color_size_data[$csRow[csf("id")]]["size_number_id"]=$csRow[csf('size_number_id')];
	  }




	if($db_type==0)
	{
		$prod_sql= sql_select("SELECT a.po_break_down_id, c.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.status_active=1 and c.status_active=1 and a.po_break_down_id =".$po_break_down_id." and a.item_number_id='$item_id' $contry_cond
			group by a.po_break_down_id,c.color_size_break_down_id");
				/*IFNULL(sum(CASE WHEN c.production_type ='2' THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='3' THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty, */
	}
	else
	{
		 $pr_sql="SELECT a.po_break_down_id, c.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				NVL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.status_active=1 and c.status_active=1 and a.po_break_down_id =".$po_break_down_id." and a.item_number_id='$item_id' $contry_cond
			group by a.po_break_down_id,c.color_size_break_down_id";
			$prod_sql=sql_select($pr_sql);


	}
	//echo $prod_sql;
	$prod_color_size_data=array();
	foreach($prod_sql as $row)
	{
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["cutting_qnty"]+=$row[csf("cutting_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printing_qnty"]+=$row[csf("printing_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printreceived_qnty"]+=$row[csf("printreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["emb_qnty"]+=$row[csf("emb_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["embreceived_qnty"]+=$row[csf("embreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["wash_qnty"]+=$row[csf("wash_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["washreceived_qnty"]+=$row[csf("washreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sp_qnty"]+=$row[csf("sp_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["spreceived_qnty"]+=$row[csf("spreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingin_qnty"]+=$row[csf("sewingin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingout_qnty"]+=$row[csf("sewingout_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finishin_qnty"]+=$row[csf("finishin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["iron_qnty"]+=$row[csf("iron_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finish_qnty"]+=$row[csf("finish_qnty")];
		//$color_library[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		//$size_library[$row[csf("size_number_id")]]=$row[csf("size_number_id")];
	}
	//var_dump($color_library);die;

	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:700px" align="center" id="details_reports">
	  	<legend>Color And Size Wise Summary</legend>
	    <table id="tbl_id" class="rpt_table" width="700" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="70">Buyer</th>
	                <th width="100">Job Number</th>
	                <th width="120">Style Name</th>
	                <th width="100">Order Number</th>
	                <th width="70">Ship Date</th>
	                <th width="150">Item Name</th>
	                <th >Order Qty.</th>
	            </tr>
	        </thead>
	       	<?
				if($country_id>0) $contry_cond=" and c.country_id='$country_id'"; else $contry_cond="";
				$sql = "select a.job_no_mst, a.po_number as po_number,a.pub_shipment_date as pub_shipment_date,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,b.total_set_qnty as set_item_ratio, sum(c.order_quantity) as po_quantity
						from wo_po_break_down a, wo_po_details_master b, wo_po_color_size_breakdown c
						where a.job_id=b.id and a.id=c.po_break_down_id and a.id =$po_break_down_id and c.item_number_id=$item_id and c.color_number_id='$color_id' $contry_cond and a.status_active in(1,2,3) and a.is_deleted=0 and b.status_active=1 and c.status_active in(1,2,3) and b.is_deleted=0
						group by a.job_no_mst, a.po_number,a.pub_shipment_date,a.pub_shipment_date,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,b.total_set_qnty";
				//echo $sql;die;
				$resultRow=sql_select($sql);

				$cons_embr=return_field_value("sum(cons_dzn_gmts) as cons_dzn_gmts","wo_pre_cost_embe_cost_dtls","job_no='".$resultRow[0][csf("job_no_mst")]."' and status_active=1 and is_deleted=0","cons_dzn_gmts");

	 		?>
	        <tbody>
	        	<tr>
	                <td><p><? echo $buyer_short_library[$resultRow[0][csf("buyer_name")]]; ?></p></td>
	                <td><p><? echo $resultRow[0][csf("job_no_mst")]; ?></p></td>
	                <td><p><? echo $resultRow[0][csf("style_ref_no")]; ?></p></td>
	                <td><p><? echo implode(",",array_unique(explode(",",$resultRow[0][csf("po_number")]))); ?></p></td>
	                <td align="center"><? echo change_date_format($resultRow[0][csf("pub_shipment_date")]); ?></td>
	                <td><? echo $garments_item[$item_id]; ?></td>
	                <td align="right"><? echo number_format($resultRow[0][csf("po_quantity")]*$resultRow[0][csf("set_item_ratio")],2,'.',''); ?></td>
	            </tr>
	            <?
				$prod_sewing_sql=sql_select("SELECT sum(alter_qnty) as alter_qnty, sum(reject_qnty) as reject_qnty from pro_garments_production_mst where production_type=5 and po_break_down_id=$po_break_down_id and item_number_id=$item_id and is_deleted=0 and status_active=1");
				?>
	            <tr>
	                <td colspan="2">Total Alter Sewing Qty : <b><? echo $prod_sewing_sql[0][csf("alter_qnty")]; ?></b></td>
	                <td colspan="2">Total Reject Sewing Qty : <b><? echo  $prod_sewing_sql[0][csf("reject_qnty")]; ?></b></td>
	                <td colspan="2">Pack Assortment: <b><? echo $packing[$resultRow[csf("packing")]]; ?></b></td>
	            </tr>
	        </tbody>
	    </table>
	    <?

		  $size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
		  //$color_library_sql;
		  if($country_id>0) $contry_cond=" and country_id='$country_id'"; else $contry_cond="";
		  /*$color_size_sql=sql_select("select color_number_id as color_number_id,size_number_id as size_number_id from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and color_number_id='$color_id' $contry_cond  and status_active=1 ");
		  foreach($color_size_sql as $row)
		  {
			  $color_library[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
			  $size_library[$row[csf("size_number_id")]]=$row[csf("size_number_id")];
		  }*/
		  //$size_library=sql_select("select distinct(size_number_id) as size_number_id from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and size_mst_id!=0 and status_active=1");
		  $count = count($size_library);
		  $width= $count*70+350;

		?>
	    <table id="tblDtls_id" class="rpt_table" width="<? echo $width; ?>" border="1" rules="all" >
		 	<thead>
	        	<tr>
	            	<th width="100">Color Name</th>
	                <th width="170">Production Type</th>
	 				<?
					foreach($size_library as $val)
					{
					 	?><th width="80"><? echo $size_Arr_library[$val]; ?></th><?
					}
					?>
	     		    <th width="60">Total</th>
	           </tr>
	        </thead>
	        <?
			  foreach($color_library as $colorId=>$totalorderqnty)
			  {
				  if($color_variable_setting==2 || $color_variable_setting==3) $row_span=17; else $row_span=16;
				?>
				<tr>

					<td rowspan="<? echo $row_span; ?>"><? echo $color_Arr_library[$color_id]; ?></td>

	 			<?
	            	 /* $i=0;$j=0;$sqlPart="";
					  foreach($size_library as $size_id)
					  {
						  $i++;$j++;
						  if($i>1) $sqlPart .=",";
						  $sqlPart .= 'SUM( CASE WHEN color_number_id='.$color_id.' and size_number_id='.$size_id.' THEN order_quantity ELSE 0 END ) as '."col".$i;
						  $sqlPart .= ',SUM( CASE WHEN color_number_id='.$color_id.' and size_number_id='.$size_id.' THEN plan_cut_qnty ELSE 0 END ) as '."pcut".$i;
						  $sqlPart .= ',SUM( CASE WHEN color_number_id='.$color_id.' and size_number_id='.$size_id.' THEN excess_cut_perc ELSE 0 END ) as '."excess_cut".$i;
					  }
					  if($j>1)
					  {
						 $sqlPart .=',SUM( CASE WHEN color_number_id='.$color_id.' THEN order_quantity ELSE 0 END ) as totalorderqnty';
						 $sqlPart .=',SUM( CASE WHEN color_number_id='.$color_id.' THEN plan_cut_qnty ELSE 0 END ) as totalplancutqnty';
					  }
					$sql = sql_select("select avg(excess_cut_perc) as avg_excess_cut_perc,max(excess_cut_perc) as excess_cut_perc,". $sqlPart ." from wo_po_color_size_breakdown where status_active=1 and po_break_down_id =$po_break_down_id and item_number_id=$item_id");
					//echo $sql;die;
					foreach($sql as $resRow); */

	 					$bgcolor1="#E9F3FF";
						$bgcolor2="#FFFFFF";
					?>
						</tr>

	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                        <td><b>Order Quantity</b></td>
	                        <?
	                        foreach($size_library as $sizeId=>$sizeRes)
	                        {
	                        ?>
	                            <td><? echo $dataQty[$colorId][$sizeId][1]; ?></td>
	                        <?
	                        }
	                        ?>
	                        <td><? echo $totalorderqnty; ?></td>
	                    </tr>

	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                        <td><b>Plan To Cut (AVG <? echo number_format($dataQty[$colorId][$sizeId][3]/$dataQty[$colorId][$sizeId][4],2); ?>)% </b></td>
	                        <?
	                        foreach($size_library as $sizeId=>$sizeRes)
	                        {
	                        ?>
	                            <td title="Excess Cut <? echo $dataQty[$colorId][$sizeId][3]; ?>%"><? echo $dataQty[$colorId][$sizeId][2]; ?></td>
	                        <?
	                        }
	                        ?>
	                        <td><? echo $color_library_plan[$colorId]; ?></td>
	                    </tr>
						<?
	 				$total_cutting=0;$total_sew_in=0;$total_sew_out=0;$total_fin_in=0;$total_fin_out=0;$total_iron_out=0; $total_exfact_qnty=0;
					$total_print_issue=0;$total_print_rcv=0;$total_embro_issue=0;$total_embro_rcv=0; $total_sp_issue=0;$total_sp_rcv=0; $total_wash_issue=0;$total_wash_rcv=0;
					$cutting_html='';$sewin_html='';$sewout_html='';$finisin_html='';$finisout_html='';$iron_html=''; $exfact_html='';
					$printiss_html=''; $printrcv_html=''; $embroiss_html=''; $embrorcv_html=''; $spiss_html=''; $sprcv_html=''; $washiss_html=''; $washrcv_html='';
					foreach($size_library as $sizeId=>$sizeRes)
					{
						$cutting_qnty=$prod_color_size_data[$colorId][$sizeId]['cutting_qnty'];
						$printing_qnty=$prod_color_size_data[$colorId][$sizeId]['printing_qnty'];
						$printreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['printreceived_qnty'];
						$emb_qnty=$prod_color_size_data[$colorId][$sizeId]['emb_qnty'];
						$embreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['embreceived_qnty'];
						$wash_qnty=$prod_color_size_data[$colorId][$sizeId]['wash_qnty'];
						$washreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['washreceived_qnty'];
						$sp_qnty=$prod_color_size_data[$colorId][$sizeId]['sp_qnty'];
						$spreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['spreceived_qnty'];
						$sewingin_qnty=$prod_color_size_data[$colorId][$sizeId]['sewingin_qnty'];
						$sewingout_qnty=$prod_color_size_data[$colorId][$sizeId]['sewingout_qnty'];
						$finishin_qnty=$prod_color_size_data[$colorId][$sizeId]['finishin_qnty'];
						$iron_qnty=$prod_color_size_data[$colorId][$sizeId]['iron_qnty'];
						$finish_qnty=$prod_color_size_data[$colorId][$sizeId]['finish_qnty'];

						$resRow[csf($col)]=$dataQty[$colorId][$sizeId][2];
	                    if($cutting_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($cutting_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($cutting_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						$cutting_html .='<td '.$bgCol.'>'.$cutting_qnty.'</td>';
	                    $total_cutting+=$cutting_qnty;

						if($cons_embr>0)
						{
							if($printing_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($printing_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($printing_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $printiss_html .='<td '.$bgCol.'>'.$printing_qnty.'</td>';
	                    $total_print_issue+=$printing_qnty;

						if($cons_embr>0)
						{
							if($printreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($printreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($printreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $printrcv_html .='<td '.$bgCol.'>'.$printreceived_qnty.'</td>';
	                    $total_print_rcv+=$printreceived_qnty;

						if($cons_embr>0)
						{
							if($emb_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($emb_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($emb_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $embroiss_html .='<td '.$bgCol.'>'.$emb_qnty.'</td>';
	                    $total_embro_issue+=$emb_qnty;

						if($cons_embr>0)
						{
							if($embreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($embreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($embreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $embrorcv_html .='<td '.$bgCol.'>'.$embreceived_qnty.'</td>';
	                    $total_embro_rcv+=$embreceived_qnty;

						if($cons_embr>0)
						{
							if($sp_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($sp_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($sp_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $spiss_html .='<td '.$bgCol.'>'.$sp_qnty.'</td>';
	                    $total_sp_issue+=$sp_qnty;

						if($cons_embr>0)
						{
							if($spreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($spreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($spreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $sprcv_html .='<td '.$bgCol.'>'.$spreceived_qnty.'</td>';
	                    $total_sp_rcv+=$spreceived_qnty;

						if($cons_embr>0)
						{
							if($wash_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($wash_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($wash_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $washiss_html .='<td '.$bgCol.'>'.$wash_qnty.'</td>';
	                    $total_wash_issue+=$wash_qnty;

						if($cons_embr>0)
						{
							if($washreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($washreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($washreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $washrcv_html .='<td '.$bgCol.'>'.$washreceived_qnty.'</td>';
	                    $total_wash_rcv+=$washreceived_qnty;

						if($sewingin_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($sewingin_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($sewingin_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewin_html .='<td '.$bgCol.'>'.$sewingin_qnty.'</td>';
	                    $total_sew_in+=$sewingin_qnty;

						if($sewingout_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($sewingout_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($sewingout_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewout_html .='<td '.$bgCol.'>'.$sewingout_qnty.'</td>';
	                    $total_sew_out+=$sewingout_qnty;

						/*if($prodRow[csf("finishin_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						else if($prodRow[csf("finishin_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prodRow[csf("finishin_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisin_html .='<td '.$bgCol.'>'.$prodRow[csf("finishin_qnty")].'</td>';
	                    $total_fin_in+=$prodRow[csf("finishin_qnty")];*/

						if($finish_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($finish_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($finish_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisout_html .='<td '.$bgCol.'>'.$finish_qnty.'</td>';
	                    $total_fin_out+=$finish_qnty;

						if($iron_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($iron_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($iron_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $iron_html .='<td '.$bgCol.'>'.$iron_qnty.'</td>';
	                    $total_iron_out+=$iron_qnty;

						//if($prodRow[csf("iron_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						//else if($prodRow[csf("iron_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						//else if($prodRow[csf("iron_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							$bgCol=="bgcolor='#FFFFFF'";
							$exfact_html.='<td>'.$ex_fact_qty_arr[$colorId][$sizeId].'&nbsp;</td>';

							$total_exfact_qnty+=$ex_fact_qty_arr[$colorId][$sizeId];
						}


					}// end size foreach loop

					?>
						<tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Cutting</b></td>
	                        <? echo $cutting_html; ?>
	                        <td><? echo $total_cutting; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Print Issue</b></td>
	                        <? echo $printiss_html; ?>
	                        <td><? echo $total_print_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Print Received</b></td>
	                        <? echo $printrcv_html; ?>
	                        <td><? echo $total_print_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Embro Issue</b></td>
	                        <? echo $embroiss_html; ?>
	                        <td><? echo $total_embro_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Embro Received</b></td>
	                        <? echo $embrorcv_html; ?>
	                        <td><? echo $total_embro_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Special Works</b></td>
	                        <? echo $spiss_html; ?>
	                        <td><? echo $total_sp_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Special Works</b></td>
	                        <? echo $sprcv_html; ?>
	                        <td><? echo $total_sp_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Sewing Input</b></td>
	                       <? echo $sewin_html; ?>
	                        <td><? echo $total_sew_in; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Sewing Output</b></td>
	                        <? echo $sewout_html; ?>
	                        <td><? echo $total_sew_out; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Wash</b></td>
	                        <? echo $washiss_html; ?>
	                        <td><? echo $total_wash_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Wash</b></td>
	                        <? echo $washrcv_html; ?>
	                        <td><? echo $total_wash_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Iron Output</b></td>
	                        <? echo $iron_html; ?>
	                        <td><? echo $total_iron_out; ?></td>
	                    </tr>
	                   <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Finishing Output</b></td>
	                       <? echo $finisout_html; ?>
	                        <td><? echo $total_fin_out; ?></td>
	                    </tr>
	                    <?
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							?>
							<tr>
								<td><b>Ex-Factory Qty.</b></td>
								 <? echo $exfact_html; ?>
								<td><? echo $total_exfact_qnty; ?>&nbsp;</td>
							</tr>
							<?
						}
						?>
				<?
				}// end color foreach loop
				?>


	 </table>
	</div>


	<?
	exit();

}

if($action=="finishrcv_popup")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	 $po_id=str_replace("'","",$po_id);
	 $item_id=str_replace("'","",$item_id);
	 $company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	 $size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	 $floorArr = return_library_array("select id,floor_name from lib_prod_floor","id","floor_name");
	 $color_Arr_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" );
	 $buyer_short_library=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name"  );

	 $sql_finish_rcv="SELECT b.color_id,b.size_id,b.fin_receive_qnty,b.po_break_down_id,b.item_id,b.production_date from gmt_finishing_receive_dtls b WHERE b.po_break_down_id=$po_id and b.item_id=$item_id and b.status_active=1 and b.is_deleted=0 order by size_id";

	 $sql_total_finish_rcv=sql_select($sql_finish_rcv);
	 $size_number_arr=array();
	 $finish_rcv_arr=array();
	 $sub_finish_rcv_arr=array();

	 foreach($sql_total_finish_rcv as $row)
	 {
		  $size_number_arr[$row[csf('size_id')]]=$row[csf('size_id')];
		  $finish_rcv_arr[$row[csf('color_id')]][$row[csf('size_id')]]['fin_receive_qnty']+=$row[csf('fin_receive_qnty')];
		  $finish_rcv_arr[$row[csf('color_id')]][$row[csf('size_id')]]['production_date']=$row[csf('production_date')];
		  $sub_finish_rcv_arr[$row[csf('size_id')]]+=$row[csf('fin_receive_qnty')];

	 }
	//  echo '<pre>';print_r($finish_rcv_arr);'</pre>';
	// echo '<pre>';print_r($sub_finish_rcv_arr);'</pre>';

	 $tbl_width=250+(count($size_number_arr)*60);


	 $main_sql="SELECT b.production_date,b.po_break_down_id,b.item_id,b.size_id,b.color_id,b.company_id,b.floor_id as sewing_floor,a.sys_number_prefix_num,a.fini_company_id,a.floor_id as fini_floor,b.fin_receive_qnty from gmt_finishing_receive_mst a,gmt_finishing_receive_dtls b WHERE a.id=b.mst_id and b.po_break_down_id=$po_id and b.item_id=$item_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";

	 $main_sql_query=sql_select($main_sql);
     $main_arr=array();
	 $size_arr=array();
	 $size_subtotal_arr=array();

	 foreach($main_sql_query as $val)
	 {
		$size_arr[$val[csf('size_id')]]=$val[csf('size_id')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]][$val[csf('size_id')]]['fin_receive_qnty']+=$val[csf('fin_receive_qnty')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['sewing_floor']=$val[csf('sewing_floor')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['fini_floor']=$val[csf('fini_floor')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['sys_number_prefix_num']=$val[csf('sys_number_prefix_num')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['company_id']=$val[csf('company_id')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['fini_company_id']=$val[csf('fini_company_id')];
		$size_subtotal_arr[$val[csf('size_id')]]+=$val[csf('fin_receive_qnty')];

	 }
	//  echo '<pre>';  print_r($main_arr); echo'</pre>';

   $table_width_date=820+(count($size_arr)*60);

   $buyer_sql="SELECT a.buyer_name,a.style_ref_no,b.po_number,c.item_number_id,a.job_no_prefix_num,c.po_break_down_id from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.id=b.job_id and a.id=c.job_id and b.id=c.po_break_down_id and c.po_break_down_id=$po_id and c.item_number_id=$item_id ";
   $buyer_main_sql=sql_select($buyer_sql);

    ?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}

	function fnExportToExcel()
	{
		// $(".fltrow").hide();
		let tableData = document.getElementById("details_reports").innerHTML;
		// alert(tableData);
	    let data_type = 'data:application/vnd.ms-excel;base64,',
		template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table border="2px">{table}</table></body></html>',
		base64 = function (s) {
			return window.btoa(unescape(encodeURIComponent(s)))
		},
		format = function (s, c) {
			return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; })
		}

		let ctx = {
			worksheet: 'Worksheet',
			table: tableData
		}

        let dt = new Date();
	    document.getElementById("dlink").href = data_type + base64(format(template, ctx));
	    document.getElementById("dlink").traget = "_blank";
        document.getElementById("dlink").download = dt.getTime()+'_display_board.xls';
	    document.getElementById("dlink").click();
		// $(".fltrow").show();
		// alert('ok');
	}
    </script>
    <div id="exc"></div>
     </div>


	<div style="text-align: center;" > <strong>Buyer: <? echo $buyer_short_library[$buyer_main_sql[0][csf('buyer_name')]]; ?></strong>
			<strong>Job No: <? echo $buyer_main_sql[0][csf('job_no_prefix_num')];  ?></strong>
			<strong>Style No:<? echo $buyer_main_sql[0][csf('style_ref_no')];?></strong>
			<strong>Garments Item:<? echo $garments_item[$buyer_main_sql[0][csf('item_number_id')]];?></strong>
			<strong>Order No:<? echo $buyer_main_sql[0][csf('po_number')];?></strong>

		</div>

     <div style="width:<?=$tbl_width+20;?>px;" align="center" id="details_reports">
	 <h4 align="center">GMT FINISHING RECEIVE</h4>
	 <h3>Summary</h3>
	 <table width="<?=$tbl_width;?>" cellspacing="0" border="1" class="rpt_table" rules="all">
		<thead>

		  <tr>
			<th width colspan="3"></th>
			<th width colspan="<?  echo  count($size_number_arr); ?>">Size</th>
			<th></th>
		  </tr>
			<tr>
				<th width="50">SL</th>
				<th width="50"></th>
				<th width="100">Color</th>
				<?
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th width="60"><?
					echo $size_Arr_library[$size_id];
					?></th>
					<?
				}
				?>
				<th width="50">Total</th>
			</tr>
		</thead>
			<tbody>
			<?
				$i=1;
				foreach($finish_rcv_arr as $color_id=>$color_data)
				{

						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
						<td><? echo $i; ?></td>
						<td></td>
						<td><? echo $color_Arr_library[$color_id]; ?></td>
						<?
						$total_recive_qty=0;
                        foreach($size_number_arr as $size_id=>$size_data)
						{
					     	?>
						 	<td align="right"><? echo $color_data[$size_id]['fin_receive_qnty']; $total_recive_qty+=$color_data[$size_id]['fin_receive_qnty']; ?></td>
						 	<?
					   	}
					  	?>
						<td align="right"><? echo number_format($total_recive_qty,0);?></td>
						</tr>
                    <?
					$i++;
				}
			?>
			</tbody>
			<tfoot>
				<th colspan="3">Total</th>
				<?
				$grand_sub_finish_rcv_total=0;
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th align="right"><? echo  $sub_finish_rcv_arr[$size_id]; $grand_sub_finish_rcv_total+=$sub_finish_rcv_arr[$size_id]; ?></th>
					<?
				}
			  	?>
				<th align="right"><? echo number_format($grand_sub_finish_rcv_total,0)?></th>
			</tfoot>
	 </table>

      <h4 align="center">Deatils</h4>
	  <table  width="<?=$table_width_date;?>" cellspacing="0" border="1" class="rpt_table" rules="all">
	  <thead>
	  <tr>
		<th width colspan="8"></th>
		<th width colspan="<?  echo  count($size_arr); ?>">Size</th>
		<th></th>
	  </tr>
	   <tr>
		  <th width="20">SL</th>
		  <th width="100">Date</th>
		  <th width="100">Rcv Id</th>
		  <th width="100">Finishing Company</th>
		  <th width="100">Finishing Floor</th>
		  <th width="100">Sewing Company</th>
		  <th width="100">Sewing Floor</th>
		  <th width="100">Color</th>
		  <?
			foreach($size_arr as $size_id=>$size_data)
			{
				?>
				<th width="60"><?
				echo $size_Arr_library[$size_id];
				?></th>
				<?
			}
		  ?>
		  <th width="100">Total</th>
	   </tr>
	  </thead>
          <tbody>
            <?
			 $i=1;
             foreach($main_arr as $production_date=>$prod_date)
			 {
				foreach($prod_date as $color_id=>$color_data)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

				   ?>
				   	<tr bgcolor="<? echo $bgcolor; ?>">
					   <td><? echo $i; ?></td>
					   <td><? echo $production_date; ?></td>
					   <td align="right"><? echo $color_data['sys_number_prefix_num']; ?></td>
					   <td><? echo $company_library[$color_data['fini_company_id']]; ?></td>
					   <td><? echo $floorArr[$color_data['fini_floor']] ?></td>
					   <td><? echo $company_library[$color_data['company_id']]; ?></td>
					   <td><? echo $floorArr[$color_data['sewing_floor']]; ?></td>
					   <td><? echo $color_Arr_library[$color_id];  ?></td>
					   <?
						$total_fin_recive_qty=0;
                        foreach($size_arr as $size_id=>$size_data)
						{
					     	?>
						 	<td align="right"><? echo $color_data[$size_id]['fin_receive_qnty']; $total_fin_recive_qty+=$color_data[$size_id]['fin_receive_qnty']; ?></td>
						 	<?
					   	}
				    	?>
						 <td align="right"><? echo number_format($total_fin_recive_qty,0) ;  ?></td>

                   <?
			 	}
			  }

            ?>
		  </tbody>
		  <tfoot>
		  <th colspan="8">Total</th>
			<?
			$grand_sub_total=0;
			foreach($size_arr as $size_id=>$size_data)
			{
				?>
				<th align="right"><? echo  $size_subtotal_arr[$size_id]; $grand_sub_total+=$sub_finish_rcv_arr[$size_id]; ?></th>
				<?
			}
			?>
			<th align="right"><? echo number_format($grand_sub_total,0)?></th>
		  </tfoot>
	  </table>
	  </div>

		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><a href="##" onclick="fnExportToExcel()" target=_blank; style="text-decoration:none" id="dlink"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?

}

if ($action=="product_popup")  // All Production Data popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);
	$prod_popup_lelel_arr=explode('*',$prod_popup_lelel);
	$prod_popup_lelel_type=$prod_popup_lelel_arr[0];
	$prod_popup_lelel_cat=$prod_popup_lelel_arr[1];


	if($db_type==0) $rmg_process_breakdown=return_field_value("a.rmg_process_breakdown as rmg_process_breakdown"," wo_booking_mst a, wo_booking_dtls b","a.booking_no=b.booking_no and  b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc limit 1","rmg_process_breakdown");
	else if($db_type==2) $rmg_process_breakdown=return_field_value("rmg_process_breakdown"," (select a.id, a.rmg_process_breakdown  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc)","ROWNUM = 1","rmg_process_breakdown");

	if($rmg_process_breakdown!="")
	{
		$rmg_process_breakdown_arr=explode("_",$rmg_process_breakdown);
		//var_dump($rmg_process_breakdown_arr);die;
		$cut_panel_rejection=$rmg_process_breakdown_arr[8];
		$chest_printing=$rmg_process_breakdown_arr[2];
		$neck_sleeve_printing=$rmg_process_breakdown_arr[10];
		$embroidery=$rmg_process_breakdown_arr[1];
		$sewing_input=$rmg_process_breakdown_arr[4];
		$garments_wash=$rmg_process_breakdown_arr[3];
		$gmts_finishing=$rmg_process_breakdown_arr[15];
	}

	//echo $rmg_process_breakdown;die;
	//select rmg_process_breakdown from (select a.id, a.rmg_process_breakdown  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=4444 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc)   where  ROWNUM = 1
	//echo "select rmg_process_breakdown as rmg_process_breakdown from  wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and  b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $row_num";die;



	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	$sizearr_order=return_library_array("select size_number_id,size_number_id from wo_po_color_size_breakdown where po_break_down_id=$po_break_down_id order by size_order","size_number_id","size_number_id");
	$line_Arr_library=return_library_array( "select id,line_name from lib_sewing_line where  is_deleted=0 and status_active=1", "id", "line_name" );
	$resource_alocate_line = return_library_array("select id, line_number from prod_resource_mst", "id", "line_number");


	$country_cond="";
	if($country_id>0) $country_cond=" and c.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and c.color_number_id=$color_id";

	$sql_order_size= sql_select("SELECT c.size_number_id, c.order_quantity as order_quantity, c.plan_cut_qnty as plan_cut_qnty
		from wo_po_color_size_breakdown c
		where c.status_active=1 and c.is_deleted=0 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id $country_cond $color_cond
		 order by c.size_order");
	foreach($sql_order_size as $row)
	{
		$order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('order_quantity')];
		$plan_order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('plan_cut_qnty')];
	}
	$country_cond="";
	if($country_id>0) $country_cond=" and a.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and a.color_number_id=$color_id";

	$color_size_sql=sql_select( "select a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.")  $country_cond $color_cond order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
	}
	$sql_supplier=sql_select("select id,supplier_name from lib_supplier where status_active =1 and is_deleted=0 order by supplier_name");
	$supplier_arr=array();
	foreach($sql_supplier as $row)
	{
		$supplier_arr[$row[csf('id')]]=$row[csf('supplier_name')];
	}

	//echo "<pre>";
	//print_r($color_size_data); die;

		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$prod_print_cond=''; $prod_sourceCond='';

		if($prod_popup_lelel_cat=="") $prod_print_cond=''; else $prod_print_cond="and a.embel_name='$prod_popup_lelel_cat'";
		if($prod_popup_lelel_type!=0)
		{
			if($prod_popup_lelel_type=="") $prod_sourceCond=''; else $prod_sourceCond="and a.production_source='$prod_popup_lelel_type'";
		}
 		if($prod_popup_type==10)
		{
			$serving_company_id = array();
			$sql = "SELECT serving_company   FROM pro_garments_production_mst  WHERE po_break_down_id = $po_break_down_id  group by serving_company";
			$sql_res = sql_select($sql);
			// echo $sql_res[0][csf('serving_company')];
			$sql_colsiz="SELECT b.color_size_break_down_id,
			sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
			from pro_ex_factory_mst a,  pro_ex_factory_dtls b, wo_po_break_down c ,wo_po_color_size_breakdown d
			where a.id=b.mst_id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and c.id=d.po_break_down_id and d.id=b.color_size_break_down_id and a.po_break_down_id = c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active in(1,2,3) and d.status_active in(1,2,3) and d.is_deleted=0  group by b.color_size_break_down_id";

			$ex_fac_level=sql_select("SELECT ex_factory  from variable_settings_production where company_name in(select a.company_name from  wo_po_details_master a,wo_po_break_down b where a.id=b.job_id and b.id=$po_break_down_id and b.status_active in(1,2,3)) and variable_list=1 ");
			if($ex_fac_level[0][csf("ex_factory")]==1)
			{
				$sql_colsiz="SELECT
				sum(CASE WHEN a.entry_form!=85 THEN  a.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN  a.ex_factory_qnty ELSE 0 END) as production_qnty
				from pro_ex_factory_mst a
				where a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0";
			}
		}
		else if($prod_popup_type==11)
		{
			 $sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as production_qnty,a.serving_company,a.sewing_line
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_color_size_breakdown e
			where a.id=b.mst_id    and e.id=b.color_size_break_down_id    and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type'  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and e.status_active=1 and e.is_deleted=0 group by e.color_number_id,e.size_number_id , b.color_size_break_down_id,a.serving_company,a.sewing_line order by a.serving_company";
		}


		else if($prod_popup_type==17)
		{
			if($color_id>0) $color_cond=" and b.color_id=$color_id";
  			$sql_colsiz="SELECT b.color_id  as color_number_id,c.size_id as size_number_id ,sum(c.size_qty ) as production_qnty,a.working_company_id as serving_company  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.gmt_item_id=$item_id and (c.order_id=$po_break_down_id or b.order_id=$po_break_down_id) $color_cond  group by b.color_id,c.size_id,a.working_company_id order by a.working_company_id";


			foreach(sql_select($sql_colsiz) as $vals)
			{
				$col_size_wise_lay[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];
				if($vals[csf("serving_company")])
				{
					$col_size_wise_lay_company[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]] =$vals[csf("serving_company")];

					$allcolor_id_arr_dtls[$vals[csf("serving_company")]][$vals[csf("color_number_id")]]=$vals[csf("color_number_id")];
					$col_size_wise_lay_company_qnty[$vals[csf("serving_company")]][$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];

				}


			}


		}
  		else if($prod_popup_type==7)
		{
			$sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as
			 production_qnty,a.serving_company
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type' and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by e.color_number_id,e.size_number_id ,b.color_size_break_down_id,a.serving_company order by a.serving_company";
		}
		else
		{
			$sql_colsiz="SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty,a.serving_company,a.sewing_line
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type' and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by b.color_size_break_down_id,a.serving_company,a.sewing_line order by a.serving_company";
		}
		//echo $sql_colsiz;
		$sql_color_size=sql_select($sql_colsiz);
		$prod_color_size_data=array();
		$prod_color_size_data_working_comp=array();
		$color_size_working_comp=array();
		$color_size_sewingLine=array();

		foreach($sql_color_size as $row)
		{
			if($prod_popup_type==11)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]=$row[csf("size_number_id")];
				//$color_size_data[$row[csf("color_size_break_down_id")]]["serving_company"]=$row[csf("serving_company")];
				//$col_size_wise_company_arr[$row[csf("serving_company")]] =$row[csf("serving_company")];
			}
			if($prod_popup_type==7)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]=$row[csf("size_number_id")];
			}
			$allcolor_id_arr_dtls[$row[csf("serving_company")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]]["color"]=$row[csf("color_number_id")];

			if($color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=="")
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=$row[csf("sewing_line")];
			}
			else
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"].=','.$row[csf("sewing_line")];
			}

			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
			$prod_color_size_data_working_comp[$row[csf("serving_company")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
		}
		//print_r($color_size_sewingLine);
		//echo $prod_popup_type;
		if($prod_popup_type==8)
        {

			$transfer_info_sql="SELECT e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id as po_id,c.color_number_id as colors ,sum( case when a.trans_type=5 and  b.trans_type=5  then b.production_qnty else 0 end) as transfer_in ,sum( case when a.trans_type=6 and  b.trans_type=6  then b.production_qnty else 0 end) as transfer_out,a.serving_company,a.sewing_line from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c,pro_gmts_delivery_mst d,wo_po_details_master e,wo_po_break_down f where a.id=b.mst_id and b.color_size_break_down_id=c.id and d.id=a.delivery_mst_id and e.id=f.job_id and e.id=c.job_id and f.id=a.po_break_down_id and   a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   and a.production_type=10 and b.production_type=10 and a.trans_type in(5,6)  and b.trans_type in(5,6) and a.po_break_down_id=$po_break_down_id and d.status_active=1
			group by e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id ,c.color_number_id,a.serving_company,a.sewing_line order by a.serving_company";
			// echo $transfer_info_sql;
			$transfer_info=sql_select($transfer_info_sql);
			foreach($transfer_info as $trans_val)
			{
				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_in']+=$trans_val[csf("transfer_in")];
				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_out']+=$trans_val[csf("transfer_out")];

				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['style']=$trans_val[csf("style_ref_no")];

				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['buyer']+=$trans_val[csf("buyer_name")];
			}
		}
	    // echo "<pre>";	print_r($transfer_info_arr);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>

		<? ob_start(); ?>
        <div style="width:<? echo $table_width+200; ?>px" align="left" id="details_reports">
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
        	<?
        	$country_library=return_library_array( "select id,country_name from lib_country", "id", "country_name"  );
        	if($prod_popup_type==10 && $ex_fac_level[0][csf("ex_factory")]==1)
        	{
        		?>
        		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="230" align="left">
        			<thead>
        				<tr>
        					<th width="30">Sl</th>
        					<th width="100">Country Name</th>
        					<th width="100">Ex-factory Qty</th>
        				</tr>
        			</thead>
        			<tbody>
        				<?
        				$ex=1;
        				$tot = 0;
        				foreach ($sql_color_size as $val)
        				{
	        				?>
	        				<tr>
	        					<td><? echo $ex; ?></td>
	        					<td><? echo $country_library[$val['COUNTRY_ID']]; ?></td>
	        					<td align="right"><? echo $val['PRODUCTION_QNTY']; ?></td>
	        				</tr>
	        				<?
	        				$ex++;
	        				$tot += $val['PRODUCTION_QNTY'];
        				}
        				?>
        			</tbody>
        			<tfoot>
        				<tr>
        					<th></th>
        					<th>Total</th>
        					<th><? echo $tot; ?></th>
        				</tr>
        			</tfoot>

        		</table>
        		<?
        		exit();
        	}
        	?>
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
            	<tr>
                	<th width colspan="2"></th>
                    <th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
                    <?
                    $colspan = 0;
                     if($prod_popup_type==8)
                     {
                     	if($prod_popup_lelel !=1)
                     	{
                     		$colspan=2;
                     	}
                     	else
                     	{
                     		$colspan = 3;
                     	}
                     }
                     ?>
                    <th colspan="<? echo $colspan; ?>"></th>
                </tr>
                <tr>

                	<th width="30" >SL</th>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    if($prod_popup_type==8)
                    {
                    	if($prod_popup_lelel ==3)
                     	{
                     		?>
	                    	<th width="100" >Transfer In</th>
	                    	<?
                     	}
                     	else if($prod_popup_lelel ==2)
                     	{
                     		?>
	                    	<th width="100" >Transfer Out</th>
	                    	<?
                     	}
                     	else
                     	{
	                    	?>
	                    	<th width="100" >Transfer In</th>
	                    	<th width="100" >Transfer Out</th>
	                    	<?
                    	}
                    }
                    ?>

                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? $sl=1; $sub_total_prod_poly_qntyy=array(); $sub_totals=0;
            	foreach($allcolor_id_arr as $inc=>$color_id_val)
            	 {
            		if($color_id_val)
            		{

            		?>
                <tr>
                 	<td align="center" valign="middle"><? echo $sl; ?></td>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                    	if($prod_popup_type==17)
                    	{
							$sub_total_prod_poly_qntyy[$size_id]+=$col_size_wise_lay[$color_id_val][$size_id];
							 ?>
                    <td align="right"><? echo number_format($col_size_wise_lay[$color_id_val][$size_id],2,'.',''); $total_prod_poly_qnty+=$col_size_wise_lay[$color_id_val][$size_id] ; ?></td>

                    <?	}
                    	else
                    	{
							$sub_total_prod_poly_qntyy[$size_id]+=$prod_color_size_data[$color_id_val][$size_id]["qty"];
	                        ?>
	                        <td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["qty"],2,'.',''); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["qty"]; ?></td>
	                        <?
                    	}
                    }
                    if($prod_popup_type==8)
                    {
                    	if($prod_popup_lelel ==3)
                     	{
                     		?>
		                    <td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$inc]['transfer_in']; echo number_format($trans_in,2,'.',''); ?></td>
		                    <?
                     	}
                     	else if($prod_popup_lelel ==2)
                     	{
                     		?>
		                    <td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$inc]['transfer_out']; echo number_format($trans_out,2,'.',''); ?></td>
		                    <?
                     	}
                     	else
                     	{
		                    ?>
		                    <td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$inc]['transfer_in']; echo number_format($trans_in,2,'.',''); ?></td>
		                    <td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$inc]['transfer_out']; echo number_format($trans_out,2,'.',''); ?></td>
		                    <?
	                	}
                	}
               		 ?>
                    <td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,2,'.',''); ?></td>
                </tr>
                <? $sub_totals+=$totals; $sl++;
          		    }
                }
                ?>
            </tbody>
             <tfoot>
            	<td align="right" colspan="2"><b>Total</b></td>
                <?
				foreach($sizearr_order as $size_id)
				{
				?>
					<td align="right"><? echo number_format($sub_total_prod_poly_qntyy[$size_id],2,'.',''); ?></td>
				<?
				}
				if($prod_popup_type==8)
				{
					if($prod_popup_lelel ==3)
                     	{
                     		?>
								<td colspan="1"></td>
							<?
                     	}
                     	else if($prod_popup_lelel ==2)
                     	{
                     		?>
								<td colspan="1"></td>
							<?
                     	}
                     	else
                     	{
							?>
								<td colspan="2"></td>
							<?
						}
				}
                ?>
                <td align="right"> <? echo number_format($sub_totals,2,'.',''); ?></td>
            </tfoot>
		</table>
    	</div>
    	<? if($prod_popup_type==8 && $prod_popup_lelel !=1){ die();}?>
    	<!-- ================================ DETAILS PART =================================== -->
        <div style="width:<? echo $table_width+200; ?>px" align="center" id="details_reports">
        <?
			$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
			$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
			$prod_reso_allocation=array();
		    $nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
			foreach($nameArray as $nameArrayRow)
			{
				$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
			}
		   // $prod_reso_allocation = $nameArray[0][csf('auto_update')];
		?>
        <strong>Details</strong>
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width+200; ?>">
            <thead>
            	<tr>
                	<th width colspan="<?  if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){ echo "4"; }else{echo "3";} ?>"></th>
                    <th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
                    <th colspan="<? if($prod_popup_type==8){echo "3";} ?>"></th>
                </tr>
                <tr>
                	<th width="30" >SL</th>
                  	<th width="200" >Working Company</th>
                    <?
                    if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
                    {
                    	?>
                    	<th width="100" >Line</th>
                    	<?
                    }
					?>
                    <th width="100" >Color Name</th> <!--$prod_popup_type-->
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    if($prod_popup_type==8)
                    {
                    	?>
                    	<th width="100" >Transfer In</th>
                    	<th width="100" >Transfer Out</th>

                    	<?
                    }
                    ?>

                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? $sl=1; $sub_total_prod_poly_qnty=array(); $sub_totals=0;
            	   $po_company=sql_select(" SELECT a.company_name from wo_po_details_master a,wo_po_break_down b where a.id=b.job_id and a.status_active=1 and b.status_active in(1,2,3) and b.id in($po_break_down_id)");
            	/*echo "<pre>";
            	print_r($allcolor_id_arr_dtls);die;*/
				//foreach($col_size_wise_company_arr as $dataRow){
				 foreach($allcolor_id_arr_dtls as $company=>$company_data) {

				   foreach($company_data as $colors=>$val) {
				   	if($colors){
				 ?>
                <tr>
                	<td align="center" valign="middle"><? echo $sl; ?></td>
                    <td align="center" valign="middle"><? if($company_library[$company]) echo $company_library[$company];  else echo $supplier_arr[$company ];
                    if($prod_popup_type==10){ echo $company_library[$sql_res[0][csf('serving_company')]]; }

					?></td>
                    <?
                    if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
                    {
                    	?>
                    	 <td align="center" valign="middle"><?
						if($prod_reso_allocation[$po_company[0][csf("company_name")]]["auto_update"]==1)
						{
							$serving_company_lines=explode(",",$color_size_sewingLine[$company]["sewing_line"]);
							$sewing_line_name = "";
							$line_duplicate_arr=array();
							foreach($serving_company_lines as $lines_id)
							{
								$sewing_line =  $resource_alocate_line[$lines_id];
								$sewing_line_arr = explode(",", $sewing_line);

								foreach ($sewing_line_arr as $line_id)
								{
								//$lines= $prod_reso_arr[$line_id] ;
								//foreach(explode(",", $lines) as $key=>$value)
								//{
									if($line_duplicate_arr[$line_id]=="")
									{
										$sewing_line_name.=$lineArr[$line_id]." ,";
										$line_duplicate_arr[$line_id]=$line_id;
									}

								//}
								}

							}

							$sewing_line_name = chop($sewing_line_name, ",");
							echo $sewing_line_name;

						}
						else
						{
							$sewing_line =  $color_size_sewingLine[$company]["sewing_line"];
							foreach(explode(",", $sewing_line) as $key=>$value)
							{
								$sewing_line_name.=$lineArr[$value]." ,";
							}
								$sewing_line_name = chop($sewing_line_name, ",");
						   		echo $sewing_line_name;
						}
						 ?></td>
                    	<?
                    }
					?>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$colors]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {

                    	if($prod_popup_type==17)
                    	{
						$sub_total_prod_poly_qnty[$size_id]+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
						?>
                    <td align="right"><?
					echo number_format($col_size_wise_lay_company_qnty[$company][$colors][$size_id],2,'.','');$total_prod_poly_qnty+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
					?></td>

                    <?	}
                    	else{
							$sub_total_prod_poly_qnty[$size_id]+=$prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"];
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"],2,'.',''); $total_prod_poly_qnty+=$prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"]; ?></td>
                        <?  }
                    }
                    if($prod_popup_type==8)
                    {
                    ?>
                    <td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$colors]['transfer_in']; echo number_format($trans_in,2,'.',''); ?></td>
                    <td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$colors]['transfer_out']; echo number_format($trans_out,2,'.',''); ?></td>
                    <?
                	}
               		 ?>
                    <td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,2,'.',''); ?></td>
                </tr>
                <?
                   $sub_totals+=$totals; $sl++;
               }
				}
				} ?>
            </tbody>
            <tfoot>
            	<td align="right" colspan=" <? if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){echo "4";}else{echo "3";} ?>"><b>Total</b></td>
                <?
				foreach($sizearr_order as $size_id)
				{
				?>
					<td align="right"><? echo number_format($sub_total_prod_poly_qnty[$size_id],2,'.',''); ?></td>
				<?
				}
				if($prod_popup_type==8){
				?>
					<td colspan="2"></td>
				<?
				}
                ?>
                <td align="right"> <? echo number_format($sub_totals,2,'.',''); ?></td>
            </tfoot>
		</table>
    	</div>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
		//die;

	if($prod_popup_type==1 && $prod_popup_lelel_type==1) //for cutting
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id  $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
	group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4" align="center" valign="middle" ><? echo $color_Arr_library[$color_id]; ?></td>
                        <td >Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Qty.</td>
                        <?
						$total_color_size_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" ><? echo number_format($prod_color_size_data[$size_id],0); $total_color_size_qnty+=$prod_color_size_data[$size_id];  ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_color_size_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Balance.</td>
                        <?
						$total_cut_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" title="Cutting Qty-Plan Cut Qty."><? $cut_balance=($plan_order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($cut_balance,0); $total_cut_balance+=$cut_balance; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_cut_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
            <br />
    	</div>
    	<?

	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==1) //for emb print inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>

                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==2) //for emb print subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==1) //for emb print inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==2) //for emb print subcontract receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==2) //for emb ebroidery subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==2) //for emb ebroidery subcon receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] =$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==4) //for emb sp issue
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
	where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=2 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
	group by c.size_number_id
	order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}
		$table_width=(200+count($table_width)*60);
		?>
		<div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0);?></td>
						<?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Plan Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0);
						?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Balance</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=($prod_color_size_data[$size_id]-($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						 echo number_format($print_sent_balence,0);
						?>
                         </td>
                        <?
                    }
                    ?>
                </tr>
            </tbody>
		</table>
		</div>
    	<?*/
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==4) //for emb sp receive
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
	where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=3 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
	group by c.size_number_id
	order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}*/
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==1) //for sewing input
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Plan Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_plan_qnty=0;

                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
						$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Input Qty.</td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Input Qty.</td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Balance</td>
                    <?
					$total_prod_in_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==11) //for sewing input inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==13) //for sewing input subcon
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==1) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=5 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Plan Output Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_out_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input);
						$sewing_out_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_out_plan_cut,0); $total_sew_out_plan_qnty+=$sewing_out_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_out_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Output Qty.</td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Output Qty.</td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Output Balance</td>
                    <?
					$total_out_balance_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_out_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_out_balance,0); $total_out_balance_qnty+=$total_out_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_out_balance_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==11) //for emb sewing output Inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==13) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==3) //for emb wash issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Plan Qty</td>
                    <?
					$total_emp_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_emp_plan_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_emp_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Qty.</td>
                    <?
					$total_prod_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_sent_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent  Balance</td>
                    <?
					$total_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==3) //for emb wash receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Plan Qty.</td>
                    <?
					$total_plan_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_wash_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Qty.</td>
                    <?
					$total_prod_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_wash_qnty+=$prod_color_size_data[$size_id]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Balance</td>
                    <?
					$taoal_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $taoal_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($taoal_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==7 && $prod_popup_lelel_type==1) //for iron
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=7 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Plan Qty</td>
                    <?
					$toal_plan_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $toal_plan_iron_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_plan_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Qty.</td>
                    <?
					$total_prod_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_iron_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Balance</td>
                    <?
					$total_iron_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_iron_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_iron_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==8 && $prod_popup_lelel_type==1) //for finish
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=8 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Plan Qty.</td>
                    <?
					$total_plan_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash+$gmts_finishing;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_finish_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Qty.</td>
                    <?
					$total_prod_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_finish_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton  Balance</td>
                    <?
					$toal_finash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $toal_finash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_finash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==10 && $prod_popup_lelel_type==1) //for garments Delivery
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
	from pro_ex_factory_mst a,  pro_ex_factory_dtls b
	where a.id=b.mst_id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="3" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                </tr>

                <tr>
                    <td>Garments Delivery Qty.</td>
                    <?
					$total_delivery_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id],0); $total_delivery_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Gmts Deliv. Balance</td>
                    <?
					$total_delivery_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? $delivery_balance=($order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($delivery_balance,0); $total_delivery_balance+=$delivery_balance;?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==11) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		if($prod_popup_lelel_type=="") $prod_source_cond='';
		else
		{
			$prod_source_cond=$prod_popup_lelel_type;
		}

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
	from pro_garments_production_mst a, pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
	/*echo "SELECT b.color_size_break_down_id,
		sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
	from pro_garments_production_mst a, pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id "; die;*/

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qnty"]+=$row[csf('poly_qnty')];
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? foreach($allcolor_id_arr as $inc=>$color_id_val) { ?>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["poly_qnty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["poly_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_poly_qnty,0); ?></td>
                </tr>
                <? } ?>
            </tbody>
		</table>
    	</div>
    	<?
	}
	exit();
}
if ($action=="product_popup___")  // All Production Data popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);
	$prod_popup_lelel_arr=explode('*',$prod_popup_lelel);
	$prod_popup_lelel_type=$prod_popup_lelel_arr[0];
	$prod_popup_lelel_cat=$prod_popup_lelel_arr[1];


	if($db_type==0) $rmg_process_breakdown=return_field_value("a.rmg_process_breakdown as rmg_process_breakdown"," wo_booking_mst a, wo_booking_dtls b","a.booking_no=b.booking_no and  b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc limit 1","rmg_process_breakdown");
	else if($db_type==2) $rmg_process_breakdown=return_field_value("rmg_process_breakdown"," (select a.id, a.rmg_process_breakdown  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc)","ROWNUM = 1","rmg_process_breakdown");

	if($rmg_process_breakdown!="")
	{
		$rmg_process_breakdown_arr=explode("_",$rmg_process_breakdown);
		//var_dump($rmg_process_breakdown_arr);die;
		$cut_panel_rejection=$rmg_process_breakdown_arr[8];
		$chest_printing=$rmg_process_breakdown_arr[2];
		$neck_sleeve_printing=$rmg_process_breakdown_arr[10];
		$embroidery=$rmg_process_breakdown_arr[1];
		$sewing_input=$rmg_process_breakdown_arr[4];
		$garments_wash=$rmg_process_breakdown_arr[3];
		$gmts_finishing=$rmg_process_breakdown_arr[15];
	}

	//echo $rmg_process_breakdown;die;
	//select rmg_process_breakdown from (select a.id, a.rmg_process_breakdown  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=4444 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc)   where  ROWNUM = 1
	//echo "select rmg_process_breakdown as rmg_process_breakdown from  wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and  b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $row_num";die;



	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	$sizearr_order=return_library_array("select size_number_id,size_number_id from wo_po_color_size_breakdown where po_break_down_id=$po_break_down_id order by size_order","size_number_id","size_number_id");
	$line_Arr_library=return_library_array( "select id,line_name from lib_sewing_line where  is_deleted=0 and status_active=1", "id", "line_name" );
	$resource_alocate_line = return_library_array("select id, line_number from prod_resource_mst", "id", "line_number");


	$country_cond="";
	if($country_id>0) $country_cond=" and c.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and c.color_number_id=$color_id";

	$sql_order_size= sql_select("SELECT c.size_number_id, c.order_quantity as order_quantity, c.plan_cut_qnty as plan_cut_qnty
		from wo_po_color_size_breakdown c
		where c.status_active=1 and c.is_deleted=0 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id $country_cond $color_cond
		 order by c.size_order");
	foreach($sql_order_size as $row)
	{
		$order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('order_quantity')];
		$plan_order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('plan_cut_qnty')];
	}
	$country_cond="";
	if($country_id>0) $country_cond=" and a.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and a.color_number_id=$color_id";

	$color_size_sql=sql_select( "select a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.")  $country_cond $color_cond order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
	}
	$sql_supplier=sql_select("select id,supplier_name from lib_supplier where status_active =1 and is_deleted=0 order by supplier_name");
	$supplier_arr=array();
	foreach($sql_supplier as $row)
	{
		$supplier_arr[$row[csf('id')]]=$row[csf('supplier_name')];
	}

	//echo "<pre>";
	//print_r($color_size_data); die;

		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$prod_print_cond=''; $prod_sourceCond='';

		if($prod_popup_lelel_cat=="") $prod_print_cond=''; else $prod_print_cond="and a.embel_name='$prod_popup_lelel_cat'";
		if($prod_popup_lelel_type!=0)
		{
			if($prod_popup_lelel_type=="") $prod_sourceCond=''; else $prod_sourceCond="and a.production_source='$prod_popup_lelel_type'";
		}
 		if($prod_popup_type==10)
		{
			$serving_company_id = array();
			$sql = "SELECT serving_company   FROM pro_garments_production_mst  WHERE po_break_down_id = $po_break_down_id  group by serving_company";
			$sql_res = sql_select($sql);
			// echo $sql_res[0][csf('serving_company')];
			$sql_ex_factory_date="SELECT ex_factory_date FROM pro_ex_factory_mst WHERE po_break_down_id = $po_break_down_id group by ex_factory_date ";
			$sql_exdate=sql_select($sql_ex_factory_date);
		    // echo $sql_exdate[0][csf('ex_factory_date')];
			$sql_colsiz="SELECT b.color_size_break_down_id,
			sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
			from pro_ex_factory_mst a,  pro_ex_factory_dtls b, wo_po_break_down c ,wo_po_color_size_breakdown d
			where a.id=b.mst_id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and c.id=d.po_break_down_id and d.id=b.color_size_break_down_id and a.po_break_down_id = c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active in(1,2,3) and d.status_active in(1,2,3) and d.is_deleted=0  group by b.color_size_break_down_id";

			$ex_fac_level=sql_select("SELECT ex_factory  from variable_settings_production where company_name in(select a.company_name from  wo_po_details_master a,wo_po_break_down b where a.id=b.job_id and b.id=$po_break_down_id and b.status_active in(1,2,3)) and variable_list=1 ");
			if($ex_fac_level[0][csf("ex_factory")]==1)
			{
				$sql_colsiz="SELECT
				sum(CASE WHEN a.entry_form!=85 THEN  a.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN  a.ex_factory_qnty ELSE 0 END) as production_qnty
				from pro_ex_factory_mst a
				where a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0";
			}
		}
		else if($prod_popup_type==11)
		{
			 $sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as production_qnty,a.serving_company,a.sewing_line
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_color_size_breakdown e
			where a.id=b.mst_id    and e.id=b.color_size_break_down_id    and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type'  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and e.status_active=1 and e.is_deleted=0 group by e.color_number_id,e.size_number_id , b.color_size_break_down_id,a.serving_company,a.sewing_line order by a.serving_company";
		}


		else if($prod_popup_type==17)
		{
			if($color_id>0) $color_cond=" and b.color_id=$color_id";
  			$sql_colsiz="SELECT b.color_id  as color_number_id,c.size_id as size_number_id ,sum(c.size_qty ) as production_qnty,a.working_company_id as serving_company  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.gmt_item_id=$item_id and (c.order_id=$po_break_down_id or b.order_id=$po_break_down_id) $color_cond  group by b.color_id,c.size_id,a.working_company_id order by a.working_company_id";


			foreach(sql_select($sql_colsiz) as $vals)
			{
				$col_size_wise_lay[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];
				if($vals[csf("serving_company")])
				{
					$col_size_wise_lay_company[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]] =$vals[csf("serving_company")];

					$allcolor_id_arr_dtls[$vals[csf("serving_company")]][$vals[csf("color_number_id")]]=$vals[csf("color_number_id")];
					$col_size_wise_lay_company_qnty[$vals[csf("serving_company")]][$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];

				}


			}


		}
  		else if($prod_popup_type==7)
		{
			$sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as
			 production_qnty,a.serving_company,a.production_date
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type' and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by e.color_number_id,e.size_number_id ,b.color_size_break_down_id,a.serving_company,a.production_date order by a.serving_company";
		}
		else
		{
			$sql_colsiz="SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty,a.serving_company,a.sewing_line,a.production_date
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type' and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by b.color_size_break_down_id,a.serving_company,a.sewing_line,a.production_date order by a.serving_company";
		}
		// echo $sql_colsiz;
		$sql_color_size=sql_select($sql_colsiz);
		$prod_color_size_data=array();
		$prod_color_size_data_working_comp=array();
		$color_size_working_comp=array();
		$color_size_sewingLine=array();

		foreach($sql_color_size as $row)
		{
			if($prod_popup_type==11)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]=$row[csf("size_number_id")];
				//$color_size_data[$row[csf("color_size_break_down_id")]]["serving_company"]=$row[csf("serving_company")];
				//$col_size_wise_company_arr[$row[csf("serving_company")]] =$row[csf("serving_company")];
			}
			if($prod_popup_type==7)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]=$row[csf("size_number_id")];
			}
			$allcolor_id_arr_dtls[$row[csf("serving_company")]][$row[csf("production_date")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]]["color"]=$row[csf("color_number_id")];

			if($color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=="")
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=$row[csf("sewing_line")];
			}
			else
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"].=','.$row[csf("sewing_line")];
			}

			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
			$prod_color_size_data_working_comp[$row[csf("serving_company")]][$row[csf("production_date")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
		}
		//print_r($color_size_sewingLine);
		//echo $prod_popup_type;
		if($prod_popup_type==8)
        {

			$transfer_info_sql="SELECT e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id as po_id,c.color_number_id as colors ,sum( case when a.trans_type=5 and  b.trans_type=5  then b.production_qnty else 0 end) as transfer_in ,sum( case when a.trans_type=6 and  b.trans_type=6  then b.production_qnty else 0 end) as transfer_out,a.serving_company,a.sewing_line from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c,pro_gmts_delivery_mst d,wo_po_details_master e,wo_po_break_down f where a.id=b.mst_id and b.color_size_break_down_id=c.id and d.id=a.delivery_mst_id and e.id=f.job_id and e.id=c.job_id and f.id=a.po_break_down_id and   a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   and a.production_type=10 and b.production_type=10 and a.trans_type in(5,6)  and b.trans_type in(5,6) and a.po_break_down_id=$po_break_down_id and d.status_active=1
			group by e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id ,c.color_number_id,a.serving_company,a.sewing_line order by a.serving_company";
			// echo $transfer_info_sql;
			$transfer_info=sql_select($transfer_info_sql);
			foreach($transfer_info as $trans_val)
			{
				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_in']+=$trans_val[csf("transfer_in")];
				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_out']+=$trans_val[csf("transfer_out")];

				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['style']=$trans_val[csf("style_ref_no")];

				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['buyer']+=$trans_val[csf("buyer_name")];
			}
		}
	    // echo "<pre>";	print_r($transfer_info_arr);
		$table_width=(200+(count($sizearr_order)*60));
		$table_width_date=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>

		<? ob_start(); ?>
        <div style="width:<? echo $table_width+200; ?>px" align="left" id="details_reports">
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
        	<?
        	$country_library=return_library_array( "select id,country_name from lib_country", "id", "country_name"  );
        	if($prod_popup_type==10 && $ex_fac_level[0][csf("ex_factory")]==1)
        	{
        		?>
        		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="230" align="left">
        			<thead>
        				<tr>
        					<th width="30">Sl</th>
        					<th width="100">Country Name</th>
        					<th width="100">Ex-factory Qty</th>
        				</tr>
        			</thead>
        			<tbody>
        				<?
        				$ex=1;
        				$tot = 0;
        				foreach ($sql_color_size as $val)
        				{
	        				?>
	        				<tr>
	        					<td><? echo $ex; ?></td>
	        					<td><? echo $country_library[$val['COUNTRY_ID']]; ?></td>
	        					<td align="right"><? echo $val['PRODUCTION_QNTY']; ?></td>
	        				</tr>
	        				<?
	        				$ex++;
	        				$tot += $val['PRODUCTION_QNTY'];
        				}
        				?>
        			</tbody>
        			<tfoot>
        				<tr>
        					<th></th>
        					<th>Total</th>
        					<th><? echo $tot; ?></th>
        				</tr>
        			</tfoot>

        		</table>
        		<?
        		exit();
        	}
        	?>
			<div><?=get_order_info($po_break_down_id);?></div>
			<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
				<thead>
					<tr>
						<?  if ($prod_popup_type==1) echo "<h1>Cutting Qc</h1>"?>
						<?  if ($prod_popup_type==4) echo "<h1>Sewing Input</h1>"?>
						<?  if ($prod_popup_type==5) echo "<h1>Sewing Output</h1>"?>
						<?  if ($prod_popup_type==7) echo "<h1>Iron Details</h1>"?>
						<?  if ($prod_popup_type==8) echo "<h1>Finish Details</h1>"?>
						<?  if ($prod_popup_type!=100 && $prod_popup_type!=1 && $prod_popup_type!=2 && $prod_popup_type!=3 && $prod_popup_type!=4 && $prod_popup_type!=5 && $prod_popup_type!=7 && $prod_popup_type!=8 && $prod_popup_type!=11 ) echo "<h1>Ex-factory Details</h1>"?>
						<th width colspan="2"></th>
						<th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
						<?
						$colspan = 0;
						if($prod_popup_type==8)
						{
							if($prod_popup_lelel !=1)
							{
								$colspan=2;
							}
							else
							{
								$colspan = 3;
							}
						}
						?>
						<th colspan="<? echo $colspan; ?>"></th>
					</tr>
					<tr>

						<th width="30" >SL</th>
						<th width="100" >Color Name</th>
						<?
						foreach($sizearr_order as $size_id)
						{
							?>
							<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
							<?
						}
						if($prod_popup_type==8)
						{
							if($prod_popup_lelel ==3)
							{
								?>
								<th width="100" >Transfer In</th>
								<?
							}
							else if($prod_popup_lelel ==2)
							{
								?>
								<th width="100" >Transfer Out</th>
								<?
							}
							else
							{
								?>
								<th width="100" >Transfer In</th>
								<th width="100" >Transfer Out</th>
								<?
							}
						}
						?>

						<th width="100" >Total</th>
					</tr>
				</thead>
				<tbody>
					<? $sl=1; $sub_total_prod_poly_qntyy=array(); $sub_totals=0;
					foreach($allcolor_id_arr as $inc=>$color_id_val)
					{
						if($color_id_val)
						{

						?>
					<tr>
						<td align="center" valign="middle"><? echo $sl; ?></td>
						<td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
						<?
						$total_prod_poly_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							if($prod_popup_type==17)
							{
								$sub_total_prod_poly_qntyy[$size_id]+=$col_size_wise_lay[$color_id_val][$size_id];
								?>
						<td align="right"><? echo number_format($col_size_wise_lay[$color_id_val][$size_id],0); $total_prod_poly_qnty+=$col_size_wise_lay[$color_id_val][$size_id] ; ?></td>

						<?	}
							else
							{
								$sub_total_prod_poly_qntyy[$size_id]+=$prod_color_size_data[$color_id_val][$size_id]["qty"];
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["qty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["qty"]; ?></td>
								<?
							}
						}
						if($prod_popup_type==8)
						{
							if($prod_popup_lelel ==3)
							{
								?>
								<td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$inc]['transfer_in']; echo number_format($trans_in,0); ?></td>
								<?
							}
							else if($prod_popup_lelel ==2)
							{
								?>
								<td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$inc]['transfer_out']; echo number_format($trans_out,0); ?></td>
								<?
							}
							else
							{
								?>
								<td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$inc]['transfer_in']; echo number_format($trans_in,0); ?></td>
								<td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$inc]['transfer_out']; echo number_format($trans_out,0); ?></td>
								<?
							}
						}
						?>
						<td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,0); ?></td>
					</tr>
					<? $sub_totals+=$totals; $sl++;
						}
					}
					?>
				</tbody>
				<tfoot>
					<td align="right" colspan="2"><b>Total</b></td>
					<?
					foreach($sizearr_order as $size_id)
					{
					?>
						<td align="right"><? echo $sub_total_prod_poly_qntyy[$size_id]; ?></td>
					<?
					}
					if($prod_popup_type==8)
					{
						if($prod_popup_lelel ==3)
							{
								?>
									<td colspan="1"></td>
								<?
							}
							else if($prod_popup_lelel ==2)
							{
								?>
									<td colspan="1"></td>
								<?
							}
							else
							{
								?>
									<td colspan="2"></td>
								<?
							}
					}
					?>
					<td align="right"> <? echo $sub_totals; ?></td>
				</tfoot>
			</table>
			</div>
			<? if($prod_popup_type==8 && $prod_popup_lelel !=1){ die();}?>
			<!-- ================================ DETAILS PART =================================== -->
			<div style="width:<? echo $table_width+200; ?>px" align="center" id="details_reports">
				<?
					$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
					$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
					$prod_reso_allocation=array();
					$nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
					foreach($nameArray as $nameArrayRow)
					{
						$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
					}
				// $prod_reso_allocation = $nameArray[0][csf('auto_update')];
				?>
				<strong>Details</strong>
				<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width_date+200; ?>">
					<thead>
						<tr>
							<th width colspan="<?  if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){ echo "5"; }else{echo "4";} ?>"></th>
							<th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
							<th colspan="<? if($prod_popup_type==8){echo "3";} ?>"></th>
						</tr>
						<tr>
							<th width="30" >SL</th>
							<th width="100" >Date</th>
							<th width="200" >Working Company</th>
							<?
							if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
							{
								?>
								<th width="100" >Line</th>
								<?
							}
							?>
							<th width="100" >Color Name</th> <!--$prod_popup_type-->
							<?
							foreach($sizearr_order as $size_id)
							{
								?>
								<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
								<?
							}
							if($prod_popup_type==8)
							{
								?>
								<th width="100" >Transfer In</th>
								<th width="100" >Transfer Out</th>

								<?
							}
							?>

							<th width="100" >Total</th>
						</tr>
					</thead>
					<tbody>
						<? $sl=1; $sub_total_prod_poly_qnty=array(); $sub_totals=0;
						$po_company=sql_select(" SELECT a.company_name from wo_po_details_master a,wo_po_break_down b where a.id=b.job_id and a.status_active=1 and b.status_active in(1,2,3) and b.id in($po_break_down_id)");
						/*echo "<pre>";
						print_r($allcolor_id_arr_dtls);die;*/
						//foreach($col_size_wise_company_arr as $dataRow){
						foreach($allcolor_id_arr_dtls as $company=>$company_data) {
							foreach($company_data as $production_date=>$prod_date){
						foreach($prod_date as $colors=>$val) {
							if($colors){
						?>
						<tr>
							<td align="center" valign="middle"><? echo $sl; ?></td>
							<td align="center" valign="middle"><? echo $production_date; if($prod_popup_type==10){ echo $sql_exdate[0][csf('ex_factory_date')]; } ?></td>
							<td align="center" valign="middle"><? if($prod_popup_lelel_type!=3) echo $company_library[$company];  else echo $supplier_arr[$company ];
							if($prod_popup_type==10){ echo $company_library[$sql_res[0][csf('serving_company')]]; }

							?></td>
							<?
							if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
							{
								?>
								<td align="center" valign="middle"><?
								if($prod_reso_allocation[$po_company[0][csf("company_name")]]["auto_update"]==1)
								{
									$serving_company_lines=explode(",",$color_size_sewingLine[$company]["sewing_line"]);
									$sewing_line_name = "";
									$line_duplicate_arr=array();
									foreach($serving_company_lines as $lines_id)
									{
										$sewing_line =  $resource_alocate_line[$lines_id];
										$sewing_line_arr = explode(",", $sewing_line);

										foreach ($sewing_line_arr as $line_id)
										{
										//$lines= $prod_reso_arr[$line_id] ;
										//foreach(explode(",", $lines) as $key=>$value)
										//{
											if($line_duplicate_arr[$line_id]=="")
											{
												$sewing_line_name.=$lineArr[$line_id]." ,";
												$line_duplicate_arr[$line_id]=$line_id;
											}

										//}
										}

									}

									$sewing_line_name = chop($sewing_line_name, ",");
									echo $sewing_line_name;

								}
								else
								{
									$sewing_line =  $color_size_sewingLine[$company]["sewing_line"];
									foreach(explode(",", $sewing_line) as $key=>$value)
									{
										$sewing_line_name.=$lineArr[$value]." ,";
									}
										$sewing_line_name = chop($sewing_line_name, ",");
										echo $sewing_line_name;
								}
								?></td>
								<?
							}
							?>
							<td align="center" valign="middle"><? echo $color_Arr_library[$colors]; ?></td>
							<?
							$total_prod_poly_qnty=0;
							foreach($sizearr_order as $size_id)
							{

								if($prod_popup_type==17)
								{
									$sub_total_prod_poly_qnty[$size_id]+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
									?>
									<td align="right"><?
									echo number_format($col_size_wise_lay_company_qnty[$company][$colors][$size_id],0);$total_prod_poly_qnty+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
									?></td>

									<?
								}
								else{
									$sub_total_prod_poly_qnty[$size_id]+=$prod_color_size_data_working_comp[$company][$production_date][$colors][$size_id]["qty"];
								?>
								<td align="right"><? echo number_format($prod_color_size_data_working_comp[$company][$production_date][$colors][$size_id]["qty"],0); $total_prod_poly_qnty+=$prod_color_size_data_working_comp[$company][$production_date][$colors][$size_id]["qty"]; ?></td>
								<?  }
							}
							if($prod_popup_type==8)
							{
							?>
							<td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$colors]['transfer_in']; echo number_format($trans_in,0); ?></td>
							<td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$colors]['transfer_out']; echo number_format($trans_out,0); ?></td>
							<?
							}
							?>
							<td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,0); ?></td>
						</tr>
						<?
						$sub_totals+=$totals; $sl++;
					}
					}
						}
						} ?>
					</tbody>
					<tfoot>
						<td align="right" colspan=" <? if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){echo "5";}else{echo "4";} ?>"><b>Total</b></td>
						<?
						foreach($sizearr_order as $size_id)
						{
						?>
							<td align="right"><? echo $sub_total_prod_poly_qnty[$size_id]; ?></td>
						<?
						}
						if($prod_popup_type==8){
						?>
							<td colspan="2"></td>
						<?
						}
						?>
						<td align="right"> <? echo $sub_totals; ?></td>
					</tfoot>
				</table>
			</div>
			<!--  -->
			<div style="width:<? echo $table_width; ?>px" align="center">
				<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
					<thead>
						<tr>
						<th width="100" >Color Name</th>
						<th width="100">Production Type</th>
						<?
						foreach($sizearr_order as $size_id)
						{
							?>
							<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
							<?
						}
						?>
						<th width="100" >Total</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
							<td>Order Qty.</td>
							<?
							$total_ord_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Plan Cut Qty.</td>
							<?
							$total_plan_ord_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sewing Input Plan Qty.</td>
							<?
							$sewing_in_plan_cut=$total_sew_plan_qnty=0;

							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right">
								<?
								$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
								$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
								echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
								?>
								</td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Inhouse Sewing Input Qty.</td>
							<?
							$total_prod_sew_inhouse_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sub Con. Sewing Input Qty.</td>
							<?
							$total_production_subcon_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sewing Input Balance</td>
							<?
							$total_prod_in_balance=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right">
								<?
								$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
								echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
								?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
						</tr>
					</tbody>
				</table>
			</div>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
		//die;

	if($prod_popup_type==1 && $prod_popup_lelel_type==1) //for cutting
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id  $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
		group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>

        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4" align="center" valign="middle" ><? echo $color_Arr_library[$color_id]; ?></td>
                        <td >Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Qty.</td>
                        <?
						$total_color_size_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" ><? echo number_format($prod_color_size_data[$size_id],0); $total_color_size_qnty+=$prod_color_size_data[$size_id];  ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_color_size_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Balance.</td>
                        <?
						$total_cut_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" title="Cutting Qty-Plan Cut Qty."><? $cut_balance=($plan_order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($cut_balance,0); $total_cut_balance+=$cut_balance; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_cut_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
            <br />
    	</div>
    	<?

	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==1 ) //for emb print inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");//and a.production_source<>1

		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name </th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>

                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	/* else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==2) //for emb print subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	} */
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==1) //for emb print inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=1   and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");//and a.production_source=1
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	/* else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==2) //for emb print subcontract receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	} */
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==2) //for emb ebroidery subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==2) //for emb ebroidery subcon receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] =$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==1) //for sewing input
	{
		//echo "exist"; exit();
		/* 	$country_cond="";
			if($country_id>0) $country_cond=" and a.country_id=$country_id";

			$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
			sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
			sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

			foreach($sql_color_size as $row)
			{
				$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
				$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
			}

			$table_width=(300+(count($sizearr_order)*60));

			?>
			<div id="data_panel" style="width:100%">
				<script>
					function new_window()
					{
						var w = window.open("Surprise", "#");
						var d = w.document.open();
						d.write(document.getElementById('details_reports').innerHTML);
						d.close();
					}
				</script>
				<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
			</div>
			<div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
				<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
					<thead>
						<tr>
						<th width="100" >Color Name</th>
						<th width="100">Production Type</th>
						<?
						foreach($sizearr_order as $size_id)
						{
							?>
							<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
							<?
						}
						?>
						<th width="100" >Total</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
							<td>Order Qty.</td>
							<?
							$total_ord_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Plan Cut Qty.</td>
							<?
							$total_plan_ord_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sewing Input Plan Qty.</td>
							<?
							$sewing_in_plan_cut=$total_sew_plan_qnty=0;

							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right">
								<?
								$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
								$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
								echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
								?>
								</td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Inhouse Sewing Input Qty.</td>
							<?
							$total_prod_sew_inhouse_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sub Con. Sewing Input Qty.</td>
							<?
							$total_production_subcon_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sewing Input Balance</td>
							<?
							$total_prod_in_balance=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right">
								<?
								$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
								echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
								?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
						</tr>
					</tbody>
				</table>
			</div>
			<?
		 */
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==11) //for sewing input inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==13) //for sewing input subcon
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==11) //for emb sewing output Inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==13) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==3) //for emb wash issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Plan Qty</td>
                    <?
					$total_emp_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_emp_plan_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_emp_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Qty.</td>
                    <?
					$total_prod_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_sent_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent  Balance</td>
                    <?
					$total_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==3) //for emb wash receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Plan Qty.</td>
                    <?
					$total_plan_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_wash_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Qty.</td>
                    <?
					$total_prod_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_wash_qnty+=$prod_color_size_data[$size_id]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Balance</td>
                    <?
					$taoal_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $taoal_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($taoal_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==8 && $prod_popup_lelel_type==1) //for finish
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=8 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Plan Qty.</td>
                    <?
					$total_plan_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash+$gmts_finishing;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_finish_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Qty.</td>
                    <?
					$total_prod_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_finish_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton  Balance</td>
                    <?
					$toal_finash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $toal_finash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_finash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}

	else if($prod_popup_type==11) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		if($prod_popup_lelel_type=="") $prod_source_cond='';
		else
		{
			$prod_source_cond=$prod_popup_lelel_type;
		}

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
		from pro_garments_production_mst a, pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");


		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qnty"]+=$row[csf('poly_qnty')];
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? foreach($allcolor_id_arr as $inc=>$color_id_val) { ?>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["poly_qnty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["poly_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_poly_qnty,0); ?></td>
                </tr>
                <? } ?>
            </tbody>
		</table>
    	</div>
    	<?
	}
	exit();
}

if ($action=="fin_gmt_transfer_popup")  // order wise button
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);
	$prod_popup_lelel_arr=explode('*',$prod_popup_lelel);
	$prod_popup_lelel_type=$prod_popup_lelel_arr[0];
	$prod_popup_lelel_cat=$prod_popup_lelel_arr[1];



	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$buyer_library=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name");
	$color_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" );
	$country_library=return_library_array( "select id,country_name from lib_country", "id", "country_name" );


	$country_cond="";
	if($country_id>0) $country_cond=" and c.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and c.color_number_id=$color_id";

	$sql_order_size= sql_select("SELECT c.size_number_id, c.order_quantity as order_quantity, c.plan_cut_qnty as plan_cut_qnty
		from wo_po_color_size_breakdown c
		where c.status_active=1 and c.is_deleted=0 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id $country_cond $color_cond
		 order by c.size_order");
	foreach($sql_order_size as $row)
	{
		$order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('order_quantity')];
		$plan_order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('plan_cut_qnty')];
	}
	$country_cond="";
	if($country_id>0) $country_cond=" and a.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and a.color_number_id=$color_id";

	$color_size_sql=sql_select( "select a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.")  $country_cond $color_cond order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
	}
	$sql_supplier=sql_select("select id,supplier_name from lib_supplier where status_active =1 and is_deleted=0 order by supplier_name");
	$supplier_arr=array();
	foreach($sql_supplier as $row)
	{
		$supplier_arr[$row[csf('id')]]=$row[csf('supplier_name')];
	}



	$transfer_info_sql="SELECT e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id as po_id,c.color_number_id as colors ,sum( case when a.trans_type=5 and  b.trans_type=5  then b.production_qnty else 0 end) as transfer_in ,sum( case when a.trans_type=6 and  b.trans_type=6  then b.production_qnty else 0 end) as transfer_out,a.serving_company,a.sewing_line,a.trans_type,g.from_po_id,g.to_po_id from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c,pro_gmts_delivery_mst d,wo_po_details_master e,wo_po_break_down f,pro_gmts_delivery_dtls g where a.id=b.mst_id and b.color_size_break_down_id=c.id and d.id=a.delivery_mst_id and e.id=f.job_id and e.id=c.job_id and f.id=a.po_break_down_id and   a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.production_type=10 and b.production_type=10 and a.trans_type in(5,6)  and b.trans_type in(5,6) and a.po_break_down_id=$po_break_down_id and d.status_active=1 and g.id=a.dtls_id and d.id=g.mst_id and g.status_active=1
			group by e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id ,c.color_number_id,a.serving_company,a.sewing_line,a.trans_type,g.from_po_id,g.to_po_id order by a.serving_company";
	// echo $transfer_info_sql;
	$transfer_info=sql_select($transfer_info_sql);
	$transfer_info_arr = array();
	$from_po_id_arr = array();
	$to_po_id_arr = array();
	foreach($transfer_info as $trans_val)
	{
		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_in']+=$trans_val[csf("transfer_in")];
		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_out']+=$trans_val[csf("transfer_out")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['style']=$trans_val[csf("style_ref_no")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['buyer']=$trans_val[csf("buyer_name")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['po_number'] =$trans_val[csf("po_number")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['from_po_id'] =$trans_val[csf("from_po_id")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['to_po_id'] =$trans_val[csf("to_po_id")];

		$from_po_id_arr[$trans_val[csf("from_po_id")]] = $trans_val[csf("from_po_id")];
		$to_po_id_arr[$trans_val[csf("to_po_id")]] = $trans_val[csf("to_po_id")];
	}

	$from_po_ids = implode(",", $from_po_id_arr);
	$to_po_ids = implode(",", $to_po_id_arr);

	$from_po = return_library_array( "select id,po_number from wo_po_break_down where id in($from_po_ids)", "id", "po_number");
	$from_job = return_library_array( "select id,job_no_mst from wo_po_break_down where id in($from_po_ids)", "id", "job_no_mst");
	$to_po = return_library_array( "select id,po_number from wo_po_break_down where id in($to_po_ids)", "id", "po_number");
	$to_job = return_library_array( "select id,job_no_mst from wo_po_break_down where id in($to_po_ids)", "id", "job_no_mst");

	    // echo "<pre>";	print_r($transfer_info_arr);
		$table_width=580;

		?>
     <!--    <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>
         -->
		<? ob_start(); ?>
        <div style="width:<? echo $table_width+20; ?>px" align="center" id="details_reports">
	        <?
				$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
				$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
				$prod_reso_allocation=array();
			    $nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
				foreach($nameArray as $nameArrayRow)
				{
					$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
				}
			   // $prod_reso_allocation = $nameArray[0][csf('auto_update')];
			?>
	        <strong>Transfer In</strong>
			<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width+200; ?>">
	            <thead>
	                <tr>
	                	<th rowspan="2" width="10" >SL</th>
	                  	<th rowspan="2" width="50" >Transfer Date</th>
	                    <th rowspan="2" width="70" >Transfer ID</th>
	                    <th colspan="7" width="450" >From Order</th>
	                </tr>
	                <tr>
	                    <th width="70" >Buyer</th>
	                    <th width="70" >Order No</th>
	                    <th width="60" >Job</th>
	                    <th width="70" >Style</th>
	                    <th width="70" >Country</th>
	                    <th width="70" >Color</th>
	                    <th width="40" >Transfer Qty</th>
	                </tr>
	            </thead>
	            <tbody>
	            	<?
	            	$sl=1;
	            	$tot = 0;
	            	foreach ($transfer_info_arr[5] as $dt_key => $dt_val)
	            	{
	            		foreach ($dt_val as $sys_key => $sys_data)
	            		{
	            			foreach ($sys_data as $job_key => $job_data)
	            			{
	            				foreach ($job_data as $po_key => $po_data)
	            				{
	            					foreach ($po_data as $country_key => $country_data)
	            					{
	            						foreach ($country_data as $color_key => $row)
	            						{
	            							?>
	            							<tr>
	            								<td><?= $sl; ?></td>
	            								<td><?= change_date_format($dt_key); ?></td>
	            								<td><?= $sys_key; ?></td>
	            								<td><?= $buyer_library[$row['buyer']]; ?></td>
	            								<td><?= $from_po[$row['from_po_id']]; ?></td>
	            								<td><?= $from_job[$row['from_po_id']]; ?></td>
	            								<td><?= $row['style']; ?></td>
	            								<td><?= $country_library[$country_key]; ?></td>
	            								<td><?= $color_library[$color_key]; ?></td>
	            								<td align="right"><?= $row['transfer_in']; ?></td>
	            							</tr>
	            							<?
	            							$sl++;
	            							$tot += $row['transfer_in'];
	            						}
	            					}
	            				}
	            			}
	            		}
	            	}
	            	?>
	            </tbody>
	            <tfoot>
	            	<th colspan="9">Total</th>
	            	<th><?= number_format($tot,0); ?></th>
	            </tfoot>
			</table>
    	</div>


        <div style="width:<? echo $table_width+20; ?>px;margin-top: 30px;" align="center" id="details_reports">
	        <?
				$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
				$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
				$prod_reso_allocation=array();
			    $nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
				foreach($nameArray as $nameArrayRow)
				{
					$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
				}
			   // $prod_reso_allocation = $nameArray[0][csf('auto_update')];
			?>
	        <strong>Transfer Out</strong>
			<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width+200; ?>">
	            <thead>
	                <tr>
	                	<th rowspan="2" width="10" >SL</th>
	                  	<th rowspan="2" width="50" >Transfer Date</th>
	                    <th rowspan="2" width="70" >Transfer ID</th>
	                    <th colspan="7" width="450" >To Order</th>
	                </tr>
	                <tr>
	                    <th width="70" >Buyer</th>
	                    <th width="70" >Order No</th>
	                    <th width="60" >Job</th>
	                    <th width="70" >Style</th>
	                    <th width="70" >Country</th>
	                    <th width="70" >Color</th>
	                    <th width="40" >Transfer Qty</th>
	                </tr>
	            </thead>
	            <tbody>
	            	<?
	            	$sl=1;
	            	$tot = 0;
	            	foreach ($transfer_info_arr[6] as $dt_key => $dt_val)
	            	{
	            		foreach ($dt_val as $sys_key => $sys_data)
	            		{
	            			foreach ($sys_data as $job_key => $job_data)
	            			{
	            				foreach ($job_data as $po_key => $po_data)
	            				{
	            					foreach ($po_data as $country_key => $country_data)
	            					{
	            						foreach ($country_data as $color_key => $row)
	            						{
	            							?>
	            							<tr>
	            								<td><?= $sl; ?></td>
	            								<td><?= change_date_format($dt_key); ?></td>
	            								<td><?= $sys_key; ?></td>
	            								<td><?= $buyer_library[$row['buyer']]; ?></td>
	            								<td><?= $from_po[$row['to_po_id']]; ?></td>
	            								<td><?= $from_job[$row['to_po_id']]; ?></td>
	            								<td><?= $row['style']; ?></td>
	            								<td><?= $country_library[$country_key]; ?></td>
	            								<td><?= $color_library[$color_key]; ?></td>
	            								<td align="right"><?= $row['transfer_out']; ?></td>
	            							</tr>
	            							<?
	            							$sl++;
	            							$tot += $row['transfer_out'];
	            						}
	            					}
	            				}
	            			}
	            		}
	            	}
	            	?>
	            </tbody>
	            <tfoot>
	            	<th colspan="9">Total</th>
	            	<th><?= number_format($tot,0); ?></th>
	            </tfoot>
			</table>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
	exit();
}

if ($action=="transfer_popup")  // All Production Data popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);

	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$lib_color=return_library_array( "select id,color_name from lib_color", "id", "color_name");

	$color_size_sql=sql_select( "SELECT a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.") order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
	}

 		if($prod_popup_lelel==1)
		{
			$sql = "SELECT c.to_po_id, c.production_quantity, c.item_number_id ,d.color_number_id,a.job_no,a.style_ref_no,b.po_number
			FROM wo_po_details_master a, wo_po_break_down b, pro_gmts_delivery_dtls c, wo_po_color_size_breakdown d
			WHERE a.job_no=b.job_no_mst and b.id=c.to_po_id and b.id=d.po_break_down_id and c.to_po_id in( $po_break_down_id) and a.status_active=1 and b.status_active=1 and c.status_active=1
			";
		}
		else
		{
			$sql = "SELECT c.from_po_id, c.production_quantity, c.item_number_id ,d.color_number_id,a.job_no,a.style_ref_no,b.po_number
			FROM wo_po_details_master a, wo_po_break_down b, pro_gmts_delivery_dtls c, wo_po_color_size_breakdown d
			WHERE a.job_no=b.job_no_mst and b.id=c.from_po_id and b.id=d.po_break_down_id and c.from_po_id in( $po_break_down_id) and a.status_active=1 and b.status_active=1 and c.status_active=1
			";
		}
  		$sql_res = sql_select($sql);
  		$data_array = array();
  		foreach ($sql_res as $val)
  		{
  			$data_array[$val[csf('job_no')]][$val[csf('style_ref_no')]][$val[csf('po_number')]][$val[csf('color_number_id')]]['production_quantity'] += $val[csf('production_quantity')];
  			$data_array[$val[csf('job_no')]][$val[csf('style_ref_no')]][$val[csf('po_number')]][$val[csf('color_number_id')]]['po_number'] += $val[csf('po_number')];
  		}
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>

		<? ob_start(); $table_width=480;?>
        <div style="width:<? echo $table_width; ?>px" align="left" id="details_reports">
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>

                	<th width="30" >SL</th>
                    <th width="100" >Job</th>
                    <th width="100" >Style</th>
                    <th width="100" >PO NUmber</th>
                    <th width="100" >Color Name</th>
                    <th width="50" >Qnty</th>
                </tr>
            </thead>
            <tbody>
            	<?
            	$sl=1;
            	$sub_total_prod_poly_qntyy=array();
            	$sub_totals=0;
            	foreach($data_array as $job_no=>$job_no_data)
            	{
            		foreach ($job_no_data as $style => $style_data)
            		{
            			foreach ($style_data as $po_id => $po_data)
            			{
            				foreach ($po_data as $color_id => $row)
            				{
            					?>
            					<tr>
            						<td><? echo $i;;?></td>
            						<td><? echo $job_no;?></td>
            						<td><? echo $style;?></td>
            						<td><? echo $row['po_number'];?></td>
            						<td><? echo $lib_color[$color_id];?></td>
            						<td><? echo $row['production_qnty'];?></td>
            					</tr>
            					<?
            				}
            			}
            		}

                }
                ?>
            </tbody>
		</table>
    	</div>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
		die;

	if($prod_popup_type==1 && $prod_popup_lelel_type==1) //for cutting
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id  $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
		group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4" align="center" valign="middle" ><? echo $color_Arr_library[$color_id]; ?></td>
                        <td >Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Qty.</td>
                        <?
						$total_color_size_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" ><? echo number_format($prod_color_size_data[$size_id],0); $total_color_size_qnty+=$prod_color_size_data[$size_id];  ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_color_size_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Balance.</td>
                        <?
						$total_cut_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" title="Cutting Qty-Plan Cut Qty."><? $cut_balance=($plan_order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($cut_balance,0); $total_cut_balance+=$cut_balance; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_cut_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
            <br />
    	</div>
    	<?

	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==1) //for emb print inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>

                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==2) //for emb print subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==1) //for emb print inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==2) //for emb print subcontract receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==2) //for emb ebroidery subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==2) //for emb ebroidery subcon receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] =$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==4) //for emb sp issue
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
		where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=2 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.size_number_id
		order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}
		$table_width=(200+count($table_width)*60);
		?>
		<div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0);?></td>
						<?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Plan Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0);
						?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Balance</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=($prod_color_size_data[$size_id]-($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						 echo number_format($print_sent_balence,0);
						?>
                         </td>
                        <?
                    }
                    ?>
                </tr>
            </tbody>
		</table>
		</div>
    	<?*/
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==4) //for emb sp receive
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
		where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=3 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.size_number_id
		order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}*/
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==1) //for sewing input
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Plan Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_plan_qnty=0;

                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
						$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Input Qty.</td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Input Qty.</td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Balance</td>
                    <?
					$total_prod_in_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==11) //for sewing input inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==13) //for sewing input subcon
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==1) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Plan Output Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_out_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input);
						$sewing_out_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_out_plan_cut,0); $total_sew_out_plan_qnty+=$sewing_out_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_out_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Output Qty.</td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Output Qty.</td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Output Balance</td>
                    <?
					$total_out_balance_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_out_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_out_balance,0); $total_out_balance_qnty+=$total_out_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_out_balance_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==11) //for emb sewing output Inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==13) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==3) //for emb wash issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Plan Qty</td>
                    <?
					$total_emp_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_emp_plan_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_emp_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Qty.</td>
                    <?
					$total_prod_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_sent_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent  Balance</td>
                    <?
					$total_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==3) //for emb wash receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Plan Qty.</td>
                    <?
					$total_plan_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_wash_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Qty.</td>
                    <?
					$total_prod_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_wash_qnty+=$prod_color_size_data[$size_id]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Balance</td>
                    <?
					$taoal_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $taoal_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($taoal_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==7 && $prod_popup_lelel_type==1) //for iron
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=7 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Plan Qty</td>
                    <?
					$toal_plan_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $toal_plan_iron_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_plan_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Qty.</td>
                    <?
					$total_prod_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_iron_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Balance</td>
                    <?
					$total_iron_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_iron_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_iron_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==8 && $prod_popup_lelel_type==1) //for finish
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=8 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Plan Qty.</td>
                    <?
					$total_plan_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash+$gmts_finishing;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_finish_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Qty.</td>
                    <?
					$total_prod_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_finish_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton  Balance</td>
                    <?
					$toal_finash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $toal_finash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_finash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==10 && $prod_popup_lelel_type==1) //for garments Delivery
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
		from pro_ex_factory_mst a,  pro_ex_factory_dtls b
		where a.id=b.mst_id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="3" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                </tr>

                <tr>
                    <td>Garments Delivery Qty.</td>
                    <?
					$total_delivery_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id],0); $total_delivery_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Gmts Deliv. Balance</td>
                    <?
					$total_delivery_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? $delivery_balance=($order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($delivery_balance,0); $total_delivery_balance+=$delivery_balance;?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==11) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		if($prod_popup_lelel_type=="") $prod_source_cond='';
		else
		{
			$prod_source_cond=$prod_popup_lelel_type;
		}

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
		from pro_garments_production_mst a, pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		/*echo "SELECT b.color_size_break_down_id,
			sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
		from pro_garments_production_mst a, pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id "; die;*/

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qnty"]+=$row[csf('poly_qnty')];
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? foreach($allcolor_id_arr as $inc=>$color_id_val) { ?>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["poly_qnty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["poly_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_poly_qnty,0); ?></td>
                </tr>
                <? } ?>
            </tbody>
		</table>
    	</div>
    	<?
	}
	exit();
}



if ($action=='exfactory')  // exfactory date popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

 	?>
    <fieldset>
    <div style="margin-left:60px">
        <table width="500" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
            <thead>
                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Ex Factory Date</th>
                        <th width="">Ex Factory Qnty</th>
               		</tr>
            </thead>
        </table>
        <div style="max-height:425px; overflow-y:scroll; width:518px;" id="scroll_body">
            <table cellspacing="0" border="1" class="rpt_table"  width="500" rules="all" id="table_body" >
            <?
             $total_quantity=0;
             $sql=sql_select("select sum(ex_factory_qnty) as ex_factory_qnty, ex_factory_date from pro_ex_factory_mst where po_break_down_id in ($po_break_down_id) and item_number_id='$item_id' and status_active=1 and is_deleted=0 group by ex_factory_date");
            //echo $sql;
			$i=1;
            foreach($sql as $resultRow)
            {
                 if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="50"><? echo $i;?></td>
                    <td width="200" align="right"><? if($resultRow[csf("ex_factory_date")]!="0000-00-00") echo change_date_format($resultRow[csf("ex_factory_date")]); ?></td>
                    <td width="" align="right"><? echo number_format($resultRow[csf("ex_factory_qnty")]); ?></td>
                 </tr>
                 <?
                    $total_quantity+=$resultRow[csf("ex_factory_qnty")];
            	 	$i++;

        }//end foreach 1st
        ?>
        </table>
        <table cellspacing="0" border="1" class="tbl_bottom"  width="500" rules="all" id="body_bottom" >
                 <tr>
                    <td width="50">&nbsp;</td>
                    <td width="200">Total</td>
                    <td width=""><? echo number_format($total_quantity); ?></td>
                  </tr>
         </table>
       </div>
     </div>
     </fieldset>
    <?

 exit();

}

if($action=='date_wise_production_report')
{
	extract($_REQUEST);
 	echo load_html_head_contents("Remarks", "../../../", 1, 1,$unicode,'','');
	?>
    <div align="center">
        <fieldset style="width:480px">
        <legend>Cutting</legend>
            <?

                 $sql= "SELECT id,production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='1' and is_deleted=0 and status_active=1";
                 //echo $sql;
                 echo  create_list_view ( "list_view_1", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');

            ?>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Print/Embr Issue</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='2' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_2", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Print/Embr Receive</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='3' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_3", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>


        <fieldset style="width:480px">
        <legend>Sewing Input</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='4' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_4", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>


        <fieldset style="width:480px">
        <legend >Sewing Output</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='5' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_5", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>


        <fieldset style="width:480px">
        <legend>Finish Input</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='6' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_6", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Finish Output</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='8' and is_deleted=0 and status_active=1";

                  echo  create_list_view ( "list_view_7", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>
	</div>
	<?
	exit();
}//end if

if($action=="product_all_remarks")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Remarks", "../../../", 1, 1,$unicode,'','');
	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
	$floor_library=return_library_array( "select id,floor_name from  lib_prod_floor", "id", "floor_name"  );
	$line_library=return_library_array( "select id,line_name from lib_sewing_line", "id", "line_name"  );
	$actual_resource_library=return_library_array( "select id,line_number from prod_resource_mst", "id", "line_number"  );
	$job_sql = sql_select("SELECT a.company_name,a.style_ref_no,a.buyer_name,b.po_number from wo_po_details_master a,wo_po_break_down b where a.id=b.job_id and b.id in($po_break_down_id)");
	?>
    <div id="data_panel" style="width:100%;text-align: center;padding: 5px;">
		<script>
            function new_window()
            {
                var w = window.open("Surprise", "#");
                var d = w.document.open();
                d.write(document.getElementById('details_reports').innerHTML);
                d.close();
            }
        </script>
    	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
    	<span id="popup_report_container" align="center" style="width: 120px;"> </span>
    </div>
    <?
     ob_start();
	?>
    <div align="center" id="details_reports">
    <div style="width:480px">
	    <table width="100%">
	    	<tr>
	    		<th colspan="2" align="left" width="49%">Company : <? echo $company_library[$job_sql[0][csf('company_name')]];?></th>
	    		<th colspan="2" align="left" width="49%">Style : <? echo $job_sql[0][csf('style_ref_no')];?></th>
	    	</tr>
	    	<tr>
	    		<th colspan="2" align="left" width="49%">Buyer : <? echo $buyer_short_library[$job_sql[0][csf('buyer_name')]];?></th>
	    		<th colspan="2" align="left" width="49%">Po No. : <? echo $job_sql[0][csf('po_number')];?></th>
	    	</tr>
	    </table>
	</div>
    <fieldset style="width:480px">
        <legend>Cut and Lay</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
				<?
                if($country_id>0) $country_cond=" and a.country_id='$country_id'"; else $country_cond="";
                //if($color_id>0) $color_cond=" and c.color_number_id=$color_id"; else $color_cond="";
                if($color_id>0) $color_cond=" and b.color_id=$color_id"; else $color_cond="";
                if($item_id>0) $item_id_cond=" and b.gmt_item_id=$item_id"; else $item_id_cond="";

                $sql_cutAndLay= sql_select("SELECT a.remarks, max(a.entry_date) as production_date ,sum(c.size_qty) as production_quantity from  ppl_cut_lay_mst a,  ppl_cut_lay_dtls b, ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id in($po_break_down_id) $item_id_cond $color_cond group by a.remarks order by production_date");

                $i=1;
                $tot_lay_qty = 0;
                foreach($sql_cutAndLay as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td><? echo $row[csf('remarks')];?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_lay_qty += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_lay_qty,0); ?></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Cutting</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
				<?
                if($country_id>0) $country_cond=" and a.country_id='$country_id'"; else $country_cond="";
                if($color_id>0) $color_cond=" and c.color_number_id=$color_id"; else $color_cond="";
                if($item_id>0) $item_id_cond=" and a.item_number_id=$item_id"; else $item_id_cond="";

                $sql_cutting= sql_select("SELECT a.DELIVERY_MST_ID,a.production_date,d.remarks,sum(b.production_qnty) as production_quantity from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c,pro_gmts_cutting_qc_mst d
                where a.DELIVERY_MST_ID=d.id and a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $item_id_cond $country_cond $color_cond and a.production_type=1 and b.production_type=1 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 group by a.DELIVERY_MST_ID,a.production_date,d.remarks order by a.production_date");

                $i=1;
                $tot_cut_qty = 0;
                foreach($sql_cutting as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_cut_qty += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_cut_qty,0); ?></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Print/Embr Issue</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_print_issue= sql_select("SELECT a.production_date,b.remarks_dtls as remarks,sum(b.production_qnty) as production_quantity
                from pro_garments_production_mst a,  pro_garments_production_dtls b left join pro_gmts_delivery_mst d on b.delivery_mst_id=d.id and d.status_active=1, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $item_id_cond $country_cond $color_cond and a.production_type=2 and b.production_type=2 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 group by a.production_date,b.remarks_dtls order by a.production_date");
                if(count($sql_print_issue)==0)
                {
                	$sql_print_issue= sql_select("SELECT a.production_date,b.remarks_dtls as remarks,sum(b.production_qnty) as production_quantity
                	from pro_garments_production_mst a,  pro_garments_production_dtls b left join pro_gmts_delivery_mst d on b.delivery_mst_id=d.id and d.status_active=1, wo_po_color_size_breakdown c
                	where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $item_id_cond $country_cond $color_cond and a.production_type=2 and b.production_type=2 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 group by a.production_date,b.remarks_dtls  order by a.production_date");
                }
                $i=1;
                $tot_print_qty = 0;
                foreach($sql_print_issue as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_print_qty += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_print_qty,0); ?></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Print/Embr Receive</legend>
             <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_print_rcv=  sql_select("SELECT a.production_date,b.remarks_dtls as remarks,sum(b.production_qnty) as production_quantity
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $item_id_cond $country_cond $color_cond and a.production_type=3 and b.production_type=3 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 group by a.production_date,b.remarks_dtls order by a.production_date");

                $i=1;
                $tot_print_qty = 0;
                foreach($sql_print_rcv as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_print_qty += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_print_qty,0); ?></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Sewing Input</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_in= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $item_id_cond $country_cond $color_cond and a.production_type=4 and b.production_type=4 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 group by a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line  order by a.production_date , a.floor_id");
                $i=1;
                $tot_input = 0;
                foreach($sql_sewing_in as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td ><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td style="padding-left:3px;">
                        <?
                        if($row[csf("prod_reso_allo")]==1)
                        {
                            $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                            $all_sewing_line="";
                            foreach($sewing_ling_arr as $line_id)
                            {
                                $all_sewing_line.=$line_library[$line_id].",";
                            }
                            $all_sewing_line=chop($all_sewing_line," , ");
                            echo $all_sewing_line;
                        }
                        else
                        {
                            echo $line_library[$row[csf("sewing_line")]];
                        }
                        ?>
                        </td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_input += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_input,0); ?></th>
                	<th></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend >Sewing Output</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_out= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $item_id_cond $country_cond $color_cond and a.production_type=5 and b.production_type=5 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 group by  a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line order by a.production_date , a.floor_id");
                $i=1;
                $tot_output = 0;
                foreach($sql_sewing_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td ><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td style="padding-left:3px;">
                        <?
                        if($row[csf("prod_reso_allo")]==1)
                        {
                            $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                            $all_sewing_line="";
                            foreach($sewing_ling_arr as $line_id)
                            {
                                $all_sewing_line.=$line_library[$line_id].",";
                            }
                            $all_sewing_line=chop($all_sewing_line," , ");
                            echo $all_sewing_line;
                        }
                        else
                        {
                            echo $line_library[$row[csf("sewing_line")]];
                        }
                        ?>
                        </td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_output += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_output,0); ?></th>
                	<th></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Poly</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_out= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $item_id_cond $country_cond $color_cond and a.production_type=11 and b.production_type=11 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 group by a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line order by a.production_date , a.floor_id");
                $i=1;
                $tot_poly = 0;
                foreach($sql_sewing_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td style="padding-left:3px;">
                        <?
                        if($row[csf("prod_reso_allo")]==1)
                        {
                            $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                            $all_sewing_line="";
                            foreach($sewing_ling_arr as $line_id)
                            {
                                $all_sewing_line.=$line_library[$line_id].",";
                            }
                            $all_sewing_line=chop($all_sewing_line," , ");
                            echo $all_sewing_line;
                        }
                        else
                        {
                            echo $line_library[$row[csf("sewing_line")]];
                        }
                        ?>
                        </td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_poly += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_poly,0); ?></th>
                	<th></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Finishing & Packing</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="100">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_finish_out= sql_select("SELECT a.production_date, a.floor_id, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $item_id_cond $country_cond $color_cond and a.production_type=8 and b.production_type=8 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 group by a.production_date,a.floor_id order by a.production_date, a.floor_id");
                $i=1;
                $tot_fin = 0;
                foreach($sql_finish_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td ><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_fin += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_fin,0); ?></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>

		<fieldset style="width:480px">
        <legend>Ex-Factory</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Ex-Factory Date</td>
                        <td width="100">Floor</td>
                        <td width="100">Ex-Factory Qty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_finish_out= sql_select("SELECT a.ex_factory_date, b.delivery_floor_id, sum(a.ex_factory_qnty) as ex_factory_quantity, max(a.remarks) as remarks from pro_ex_factory_mst a, pro_ex_factory_delivery_mst b
                where a.po_break_down_id in($po_break_down_id) $item_id_cond and a.delivery_mst_id = b.id and a.is_deleted=0 and a.status_active=1 group by a.ex_factory_date,b.delivery_floor_id order by a.ex_factory_date , b.delivery_floor_id ");
                $tot_fin = 0;
                foreach($sql_finish_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("ex_factory_date")]!="" && $row[csf("ex_factory_date")]!="0000-00-00") echo change_date_format($row[csf("ex_factory_date")]); ?></td>
                        <td ><? echo $floor_library[$row[csf("delivery_floor_id")]]; ?></td>
                        <td align="right"><? echo number_format($row[csf("ex_factory_quantity")],0); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_fin += $row[csf("ex_factory_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_fin,0); ?></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
	<?
	$html=ob_get_contents();
	ob_flush();

	foreach (glob("$user_id*.xls") as $filename)
	{
	   @unlink($filename);
	}

	//html to xls convert
	$name=time();
	$name=$user_id."_".$name.".xls";
	$create_new_excel = fopen(''.$name, 'w');
	$is_created = fwrite($create_new_excel,$html);
	?>
    <input type="hidden" id="txt_excl_link" value="<? echo 'requires/'.$name; ?>" />
    <script>
		$(document).ready(function(e)
		{
			document.getElementById('popup_report_container').innerHTML='<a href="<? echo $name?>" style="text-decoration:none"><input type="button" value="Convert to Excel" name="excel" id="excel" style="padding:0 2px;" class="formbutton"/></a>&nbsp;&nbsp;';
		});
	</script>
	</div>
	<?
	exit();
}


if ($action=="reject_qty_backup")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	//echo $po_id;
	?>
     <div style="width:780px;" align="center">
       <table width="770" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Reject Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="80">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Cutting Reject Qty</th>
                    <th width="60">Print Reject Qty</th>
                    <th width="60">Emb. Reject Qty</th>
                    <th width="60">Wash Reject Qty</th>
                    <th width="60">Special Reject Qty</th>
                    <th width="60">Sewing Out Reject Qty</th>
                    <th width="60">Iron Reject Qty</th>
                    <th width="60">Poly Reject Qty</th>
                    <th width="60">Finish Reject Qty.</th>
                    <th>Total Reject Qty.</th>
                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			 $rej_data_arr=array(); $rej_qty_arr=array();
			/*$sql_qry="Select a.po_break_down_id, c.color_number_id, c.size_number_id,
							sum(CASE WHEN a.production_type ='1' THEN b.reject_qty ELSE 0 END) AS cutting_rej_qnty,
							sum(CASE WHEN a.production_type ='3' THEN b.reject_qty ELSE 0 END) AS emb_rej_qnty,

							sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN b.reject_qty ELSE 0 END) AS printreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN b.reject_qty ELSE 0 END) AS embreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN b.reject_qty ELSE 0 END) AS washreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN b.reject_qty ELSE 0 END) AS spreceived_qnty,

							sum(CASE WHEN a.production_type ='7' THEN b.reject_qty ELSE 0 END) AS iron_rej_qnty,
			 				sum(CASE WHEN a.production_type ='8' THEN b.reject_qty ELSE 0 END) AS finish_rej_qnty,
							sum(CASE WHEN a.production_type ='5' THEN b.reject_qty ELSE 0 END) AS sewingout_rej_qnty,
							sum(CASE WHEN a.production_type ='11' THEN b.reject_qty ELSE 0 END) AS poly_rej_qnty
							from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
							where a.id=b.mst_id and b.color_size_break_down_id=c.id and  a.po_break_down_id in ($po_id) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $sql_cond  group by a.po_break_down_id, c.color_number_id, c.size_number_id";*/

				$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty

							from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
							where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			//echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('reject_qty')];
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$cutting_rej_qty=$rej_qty_arr[$color_id][$size_id][1][0];
						$printreceived_qty=$rej_qty_arr[$color_id][$size_id][3][1];
						$embreceived_qty=$rej_qty_arr[$color_id][$size_id][3][2];
						$washreceived_qty=$rej_qty_arr[$color_id][$size_id][3][3];
						$spreceived_qty=$rej_qty_arr[$color_id][$size_id][3][4];
						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][5][0];
						$iron_rej_qty=$rej_qty_arr[$color_id][$size_id][7][0];
						$poly_rej_qty=$rej_qty_arr[$color_id][$size_id][11][0];
						$finish_rej_qty=$rej_qty_arr[$color_id][$size_id][8][0];
						$total_reject=$cutting_rej_qty+$printreceived_qty+$embreceived_qty+$washreceived_qty+$spreceived_qty+$sewingout_rej_qty+$iron_rej_qty+$poly_rej_qty+$finish_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($cutting_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($printreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($embreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($washreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($spreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($sewingout_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($iron_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($poly_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($finish_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo $total_reject; ?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_cutting_rej+=$cutting_rej_qty;
						$tot_printrec_rej+=$printreceived_qty;
						$tot_embrec_rej+=$embreceived_qty;
						$tot_washrec_rej+=$washreceived_qty;
						$tot_sphrec_rej+=$spreceived_qty;
						$tot_sewing_rej+=$sewingout_rej_qty;
						$tot_iron_rej+=$iron_rej_qty;
						$tot_poly_rej+=$poly_rej_qty;
						$tot_finish_rej+=$finish_rej_qty;
						$tot_rej+=$total_reject;
					}
				}
			}
			?>
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_cutting_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_printrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_embrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_washrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_sphrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_iron_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_poly_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_finish_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}

if ($action=="reject_qty")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	//echo $po_id;
	?>
     <div style="width:720px;" align="center">
       <table width="710" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Reject Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="80">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Cutting Reject Qty</th>
                    <th width="60">Print Reject Qty</th>
                    <th width="60">Emb. Reject Qty</th>
                    <th width="60">Wash Reject Qty</th>
                    <th width="60">Special Reject Qty</th>
                    <!-- <th width="60">Sewing Out Reject Qty</th> -->
                    <th width="60">Iron Reject Qty</th>
                    <th width="60">Poly Reject Qty</th>
                    <th width="60">Finish Reject Qty.</th>
                    <th>Total Reject Qty.</th>
                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			 $rej_data_arr=array(); $rej_qty_arr=array();
			/*$sql_qry="Select a.po_break_down_id, c.color_number_id, c.size_number_id,
							sum(CASE WHEN a.production_type ='1' THEN b.reject_qty ELSE 0 END) AS cutting_rej_qnty,
							sum(CASE WHEN a.production_type ='3' THEN b.reject_qty ELSE 0 END) AS emb_rej_qnty,

							sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN b.reject_qty ELSE 0 END) AS printreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN b.reject_qty ELSE 0 END) AS embreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN b.reject_qty ELSE 0 END) AS washreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN b.reject_qty ELSE 0 END) AS spreceived_qnty,

							sum(CASE WHEN a.production_type ='7' THEN b.reject_qty ELSE 0 END) AS iron_rej_qnty,
			 				sum(CASE WHEN a.production_type ='8' THEN b.reject_qty ELSE 0 END) AS finish_rej_qnty,
							sum(CASE WHEN a.production_type ='5' THEN b.reject_qty ELSE 0 END) AS sewingout_rej_qnty,
							sum(CASE WHEN a.production_type ='11' THEN b.reject_qty ELSE 0 END) AS poly_rej_qnty
							from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
							where a.id=b.mst_id and b.color_size_break_down_id=c.id and  a.po_break_down_id in ($po_id) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $sql_cond  group by a.po_break_down_id, c.color_number_id, c.size_number_id";*/

				$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty

							from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
							where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			// echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('reject_qty')];
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$cutting_rej_qty=$rej_qty_arr[$color_id][$size_id][1][0];
						$printreceived_qty=$rej_qty_arr[$color_id][$size_id][3][1];
						$embreceived_qty=$rej_qty_arr[$color_id][$size_id][3][2];
						$washreceived_qty=$rej_qty_arr[$color_id][$size_id][3][3];
						$spreceived_qty=$rej_qty_arr[$color_id][$size_id][3][4];
						// $sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][5][0];
						$iron_rej_qty=$rej_qty_arr[$color_id][$size_id][7][0];
						$poly_rej_qty=$rej_qty_arr[$color_id][$size_id][11][0];
						$finish_rej_qty=$rej_qty_arr[$color_id][$size_id][8][0];
						$total_reject=$cutting_rej_qty+$printreceived_qty+$embreceived_qty+$washreceived_qty+$spreceived_qty+$iron_rej_qty+$poly_rej_qty+$finish_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($cutting_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($printreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($embreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($washreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($spreceived_qty,0); ?>&nbsp;</td>
                            <!--<td align="right"><? //echo number_format($sewingout_rej_qty,0);?>&nbsp;</td>-->
                            <td align="right"><? echo number_format($iron_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($poly_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($finish_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo $total_reject; ?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_cutting_rej+=$cutting_rej_qty;
						$tot_printrec_rej+=$printreceived_qty;
						$tot_embrec_rej+=$embreceived_qty;
						$tot_washrec_rej+=$washreceived_qty;
						$tot_sphrec_rej+=$spreceived_qty;
						// $tot_sewing_rej+=$sewingout_rej_qty;
						$tot_iron_rej+=$iron_rej_qty;
						$tot_poly_rej+=$poly_rej_qty;
						$tot_finish_rej+=$finish_rej_qty;
						$tot_rej+=$total_reject;
					}
				}
			}
			?>
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_cutting_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_printrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_embrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_washrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_sphrec_rej,0); ?>&nbsp;</td>
                    <!--<td align="right"><? //echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>-->
                    <td align="right"><? echo number_format($tot_iron_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_poly_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_finish_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}


if ($action=="sewing_reject_qty")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	//echo $po_id;
	?>
     <div style="width:310px;" align="center">
       <table width="340" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Sewing Reject Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="130">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Sewing Out Reject Qty</th>
                    <th>Total Reject Qty.</th>
                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			$rej_data_arr=array();
			$rej_qty_arr=array();

			$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty,b.replace_qty,b.production_qnty,b.is_rescan
			from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
			where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			// echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				if($row[csf('is_rescan')]==0)
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('reject_qty')];
				}
				else
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('production_qnty')];
				}

				//$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('replace_qty')]; ISD-23-01062 dont open
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][5][0];
						$total_reject=$sewingout_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td valign="middle"><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($sewingout_rej_qty,0);?>&nbsp;</td>
                            <td align="right"><? echo number_format($total_reject,0); ?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_sewing_rej+=$sewingout_rej_qty;
						$tot_rej+=$total_reject;
					}
				}
			}
			?>
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}
if ($action=="replace_qty")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	//echo $po_id;
	?>
     <div style="width:310px;" align="center">
       <table width="340" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Sewing Replace Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="130">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Sewing Replace Qty</th>

                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			$rej_data_arr=array();
			$rej_qty_arr=array();

			$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty,b.replace_qty,b.production_qnty,b.is_rescan
			from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
			where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			// echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				if($row[csf('is_rescan')]==0)
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('replace_qty')];
				}
				else
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('production_qnty')];
				}

				//$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('replace_qty')];// ISD-23-01062 dont open
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][5][0];
						$total_reject=$sewingout_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td valign="middle"><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($sewingout_rej_qty,0);?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_sewing_rej+=$sewingout_rej_qty;
					//	$tot_rej+=$total_reject;
					}
				}
			}

			?>
			<!--  -->
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}
if ($action=="cut_replace_qty")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');


	?>
     <div style="width:310px;" align="center">
       <table width="340" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Cutting Replace Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="130">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Cutting Replace Qty</th>

                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			$rej_data_arr=array();
			$rej_qty_arr=array();

			$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty,b.replace_qty,b.production_qnty,b.is_rescan
			from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
			where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			// echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				if($row[csf('is_rescan')]==0)
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('replace_qty')];
				}
				else
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('production_qnty')];
				}

				//$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('replace_qty')];// ISD-23-01062 dont open
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][1][0];
						$total_reject=$sewingout_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td valign="middle"><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($sewingout_rej_qty,0);?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_sewing_rej+=$sewingout_rej_qty;
					//	$tot_rej+=$total_reject;
					}
				}
			}

			?>
			<!--  -->
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}
//-------------------------------------------END Show Date Location Floor & Line Wise------------------------
//-------------------------------------------end-----------------------------------------------------------------------------//

if ($action==1 || $action==5)
{
 	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	if($country_id=='') $country_cond=""; else $country_cond=" and country_id='$country_id'";
 	?>
    <script>
	 var tableFilters_sewout =
		{
			//col_0: "none",col_1:"none",display_all_text: " -- All --",
			col_operation: {
				id: ["total_sew_qty"],
				col: [4],
				operation: ["sum"],
				write_method: ["innerHTML"]
			}
		}

		function openmypage(po_break_down_id,item_id,prod_type,location_id,floor_id,dateOrLocWise,country_id,prod_date,action)
		{
			var popupWidth = "width=550px,height=320px,";
			emailwindow=dhtmlmodal.open('EmailBox', 'iframe', 'order_wise_fabric_to_rmg_production_status_report_controller.php?po_break_down_id='+po_break_down_id+'&item_id='+item_id+'&action='+action+'&location_id='+location_id+'&floor_id='+floor_id+'&dateOrLocWise='+dateOrLocWise+'&country_id='+country_id+'&prod_date='+prod_date+'&prod_type='+prod_type, 'Production Quantity', popupWidth+'center=1,resize=0,scrolling=0','../../');
		}
	</script>
    <fieldset>
    <div style="margin-left:50px">
        <table width="620" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
            <thead>
                 <? if($action==1){ ?>
                    <tr>
                        <th width="50">Sl.</th>
                        <th width="100">Cutting Date</th>
                        <th width="160">Cutt. Qty(In-house)</th>
                        <th width="160">Cutt. Qty(Out-bound)</th>
                        <th width="">Cutting Company</th>
                 	</tr>
				<? } else if($action==5){ ?>
                    <tr>
                        <th width="30">Sl.</th>
                        <th width="80">Output Date</th>
                        <th width="80">PO No</th>
                        <th width="80">Sewing Line</th>
                        <th width="80">Sew.Qty</th>
                        <th width="100">Source</th>
                        <th width="">Sewing Company</th>
                    </tr>
 				<? } ?>
            </thead>
        </table>
        <div style="max-height:370px; overflow-y:scroll; width:638px;" id="scroll_body">
            <table cellspacing="0" border="1" class="rpt_table" width="620" rules="all" id="table_body" >
            <?
             $total_in_quantity=0;$total_out_quantity=0;
             $i=1;
 			 $company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name"  );
 			 $supplier_library=return_library_array( "select id,supplier_name from  lib_supplier", "id", "supplier_name" );
			 $po_array=return_library_array( "select id,po_number from  wo_po_break_down where id in ($po_break_down_id)", "id", "po_number");
			 $sewing_library=return_library_array( "select id,line_name from  lib_sewing_line", "id", "line_name");
			 $prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');

			 $location="";$floor="";
			 if($dateOrLocWise==2 || $dateOrLocWise==4) // only for location floor and line wise
			 {
				 if($location_id!="") $location=" and location=$location_id";
				 if($floor_id!="") $floor=" and floor_id=$floor_id";
			 }
			 if($action==5)
			 {
				 $sql=sql_select("select po_break_down_id,production_date,prod_reso_allo,sewing_line,production_source,serving_company,
					  SUM(production_quantity) as production_quantity
					  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type=$action and status_active=1 $location $floor $country_cond group by serving_company,production_date,po_break_down_id,prod_reso_allo,sewing_line,production_source");
			 }
			 else
			 {
				 $sql=sql_select("select po_break_down_id,production_date,production_source,serving_company,
					  SUM(CASE WHEN production_source=1 THEN production_quantity ELSE 0 END) as in_house_cut_qnty,
					  SUM(CASE WHEN production_source=3 THEN production_quantity ELSE 0 END) as out_bound_cut_qnty
					  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type=$action and status_active=1 $location $floor $country_cond group by po_break_down_id,serving_company,production_date,production_source");
			 }

            foreach($sql as $resultRow)
            {
                 if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				 if($action==5)
				 {
					$sewing_line='';
					if($resultRow[csf('prod_reso_allo')]==1)
					{
						$line_number=explode(",",$prod_reso_arr[$resultRow[csf('sewing_line')]]);
						foreach($line_number as $val)
						{
							if($sewing_line=='') $sewing_line=$sewing_library[$val]; else $sewing_line.=",".$sewing_library[$val];
						}
					}
					else $sewing_line=$sewing_library[$resultRow[csf('sewing_line')]];
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="30"><? echo $i;?></td>
                    <td width="80"><a href="##" onclick="openmypage('<? echo $po_break_down_id ?>','<? echo $item_id ?>','<? echo $action ?>','<? echo $location_id ?>','<? echo $floor_id ?>','<? echo $dateOrLocWise ?>','<? echo $country_id ?>','<? echo $resultRow[csf("production_date")]; ?>','challanPopup')"><? echo change_date_format($resultRow[csf("production_date")]); ?></a></td>
                    <td width="80"><p><? echo $po_array[$resultRow[csf("po_break_down_id")]]; ?></p></td>
                    <td width="80"><? echo $sewing_line; ?></td>
                    <td width="80" align="right"><? echo number_format($resultRow[csf("production_quantity")]); ?>&nbsp;</td>
                    <td width="100"><? echo $knitting_source[$resultRow[csf("production_source")]]; ?></td>
                    <?
                    	$source= $resultRow[csf('production_source')];
					    if($source==3)
						{
							$serving_company= $supplier_library[$resultRow[csf('serving_company')]];
						}
						else
						{
							$serving_company= $company_library[$resultRow[csf('serving_company')]];
						}
					?>
                    <td width=""><p><? echo $serving_company; ?></p></td>
                 </tr>
                 <?
				 }
				 else
				 {
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="50"><? echo $i;?></td>
                    <td width="100"><a href="##" onclick="openmypage('<? echo $po_break_down_id ?>','<? echo $item_id ?>','<? echo $action ?>','<? echo $location_id ?>','<? echo $floor_id ?>','<? echo $dateOrLocWise ?>','<? echo $country_id ?>','<? echo $resultRow[csf("production_date")]; ?>','challanPopup')"><? echo change_date_format($resultRow[csf("production_date")]); ?></a></td>
                    <td width="160" align="right"><? echo number_format($resultRow[csf("in_house_cut_qnty")]); ?></td>
                    <td width="160" align="right"><? echo number_format($resultRow[csf("out_bound_cut_qnty")]); ?></td>
                    <?
                    	$source= $resultRow[csf('production_source')];
					    if($source==3)
						{
							$serving_company= $supplier_library[$resultRow[csf('serving_company')]];
						}
						else
						{
							$serving_company= $company_library[$resultRow[csf('serving_company')]];
						}
					?>
                    <td width=""><p><? echo $serving_company; ?></p></td>
                 </tr>
                 <?
				 }

				$total_sewing_quantity+=$resultRow[csf("production_quantity")];
				$total_in_quantity+=$resultRow[csf("in_house_cut_qnty")];
				$total_out_quantity+=$resultRow[csf("out_bound_cut_qnty")];
				$i++;
			}//end foreach 1st
			?>
			</table>
        <table width="500" cellspacing="0" border="1" class="tbl_bottom" rules="all" id="body_bottom" >
           <?
			if($action==5)
			{
			?>
            	<tfoot class="tbl_bottom">
                     <tr>

                        <td width="30">&nbsp;</td>
                        <td width="80">&nbsp;</td>
                        <td width="80">&nbsp;</td>
                        <td width="80">Total</td>
                        <td width="80" id="total_sew_qty"><? echo number_format($total_sewing_quantity); ?>&nbsp;</td>
                        <td width="100">&nbsp;</td>
                        <td>&nbsp;</td>
                     </tr>
                 </tfoot>
			 <?
			 }
			 else
			 {
			?>
            	<tfoot class="tbl_bottom">
                     <tr>
                        <td width="50">&nbsp;</td>
                        <td width="100">Total</td>
                        <td width="160"><? echo number_format($total_in_quantity); ?> </td>
                        <td width="160"><? echo number_format($total_out_quantity); ?></td>
                        <td width="">&nbsp;</td>
                     </tr>
                 </tfoot>
			 <?
			 }
			 ?>
			</table>
		</div>
	</div>
	</fieldset>
    <script>
	var action=<? echo $action; ?>;
	if(action==5) setFilterGrid("table_body",-1,tableFilters_sewout);
	</script>
    <?
 exit();

}


//---- sewing input-4, iron input-7, finish-8, re_iron input-9-----------popup--------//
if ($action==4 || $action==7 || $action==8 || $action==9) // popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	?>
	 <script>
	 var tableFilters_sewin =
	{
		//col_0: "none",col_1:"none",display_all_text: " -- All --",
		col_operation: {
			id: ["total_issue_qty"],
			col: [4],
			operation: ["sum"],
			write_method: ["innerHTML"]
		}
 	}
	</script>
    <?
	if($country_id=='') $country_cond=""; else $country_cond=" and country_id='$country_id'";

 	?>
    <fieldset>
    <div style="margin-left:60px">
        <table width="500" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
            <thead>
				<? if($action==2){ ?>

                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Print/ Emb. Issue Date</th>
                        <th width="">Print/ Emb. Issue Qnty</th>
                    </tr>

				<? } else if($action==3){ ?>

                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Print/ Emb. Receive Date</th>
                        <th width="">Print/ Emb. Receive Qnty</th>
                    </tr>

				<? } else if($action==4){ ?>

                    <tr>
                        <th width="30">Sl.</th>
                        <th width="70">Sewing Date</th>
                        <th width="80">PO No</th>
                        <th width="80">Sewing Line</th>
                        <th width="80">Sewing Qty</th>
                        <th width="">Source</th>
                    </tr>
                <? } else if($action==7){ ?>

                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Iron Output Date</th>
                        <th width="">Iron Output Qnty</th>
                    </tr>
                <? } else if($action==8){ ?>

                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Finish Date</th>
                        <th width="">Finish Qty</th>
                    </tr>
                <? } else if($action==9){ ?>
                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Iron Output Date</th>
                        <th width="">Re-Iron Output Qty</th>
                    </tr>
               <? } ?>
            </thead>
        </table>
        <div style="max-height:425px; overflow-y:scroll; width:518px;" id="scroll_body">
            <table width="500" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_body" >
            <?
				$po_array=return_library_array( "select id,po_number from  wo_po_break_down", "id", "po_number");
				$sewing_library=return_library_array( "select id,line_name from  lib_sewing_line", "id", "line_name");
				$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
             $total_quantity=0;
             $i=1;
			 $location="";$floor="";
			 if($dateOrLocWise==2 || $dateOrLocWise==4) // only for location floor and line wise
			 {
				 if($location_id!="") $location=" and location=$location_id";
				 if($floor_id!="") $floor=" and floor_id=$floor_id";
			 }
			 if ($action==9)
			 {
				 $sql=sql_select("select production_date, sum(re_production_qty) as production_quantity
				  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and re_production_qty!=0 and item_number_id=$item_id and status_active=1 and is_deleted=0 and production_type=7 $location $floor $country_cond group by production_date");
			 }
			 else if ($action==4)
			 {
				 $sql=sql_select("select po_break_down_id,production_date,prod_reso_allo,sewing_line,production_source,sum(production_quantity) as production_quantity
				  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and status_active=1 and is_deleted=0 and production_type=$action $location $floor $country_cond group by po_break_down_id,production_date,prod_reso_allo,sewing_line,production_source");
			 }
			 else
			 {
				 $sql=sql_select("select production_date,sum(production_quantity) as production_quantity
				  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and status_active=1 and is_deleted=0 and production_type=$action $location $floor $country_cond group by production_date");
			 }

            foreach($sql as $resultRow)
            {
                 if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				 if ($action==4)
				 {
					 $sewing_line='';
					if($resultRow[csf('prod_reso_allo')]==1)
					{
						$line_number=explode(",",$prod_reso_arr[$resultRow[csf('sewing_line')]]);
						foreach($line_number as $val)
						{
							if($sewing_line=='') $sewing_line=$sewing_library[$val]; else $sewing_line.=",".$sewing_library[$val];
						}
					}
					else $sewing_line=$sewing_library[$resultRow[csf('sewing_line')]];
             	?>
                     <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                        <td width="30"><? echo $i;?></td>
                        <td width="70" align="center"><? echo change_date_format($resultRow[csf("production_date")]); ?></td>
                        <td width="80" align="center"><p><? echo $po_array[$resultRow[csf("po_break_down_id")]]; ?></p></td>
                        <td width="80" align="center"><? echo $sewing_line; ?></td>
                        <td width="80" align="right"><? echo number_format($resultRow[csf("production_quantity")],0); ?>&nbsp;</td>
                        <td><? echo $knitting_source[$resultRow[csf("production_source")]]; ?></td>
                     </tr>
                 <?
				 }
				 else
				 {
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="50"><? echo $i;?></td>
                    <td width="200" align="right"><? echo change_date_format($resultRow[csf("production_date")]); ?></td>
                    <td width="" align="right"><? echo number_format($resultRow[csf("production_quantity")],0); ?>&nbsp;</td>
                 </tr>
                 <?
				 }
                    $total_quantity+=$resultRow[csf("production_quantity")];
            	 	$i++;

        }//end foreach 1st
        ?>
        </table>
        <table width="500" cellspacing="0" border="1" class="tbl_bottom" rules="all" id="body_bottom" >
        	<?
			if ($action==4)
			{
			?>
                 <tr>
                    <td width="30">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="80">Total</td>
                    <td width="80" id="total_issue_qty"><? echo number_format($total_quantity,0); ?>&nbsp;</td>
                    <td>&nbsp;</td>
                 </tr>
             <?
			}
			else
			{
			?>
                 <tr>
                    <td width="50">&nbsp;</td>
                    <td width="200">Total</td>
                    <td><? echo number_format($total_quantity,0); ?>&nbsp;</td>
                 </tr>
             <?
			}
			 ?>
         </table>
       </div>
     </div>
     </fieldset>
     <script>
	var action=<? echo $action; ?>;

	//if (action==4) setFilterGrid("tableFilters_sewin",-1);
	if(action==4) setFilterGrid("table_body",-1,tableFilters_sewin);

	</script>
    <?

 exit();

}



//--print/emb issue-2,print/emb receive-3,
if ($action==2 || $action==3)
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,1,1);

	if($country_id=='') $country_cond=""; else $country_cond=" and country_id='$country_id'";
	$emple_type=$location_id;
	if($emple_type==1) $hedding="Pringing";
	if($emple_type==2) $hedding="Embroidery";
	if($emple_type==3) $hedding="Wash";
	if($emple_type==4) $hedding="Special Work";
 	?>
    <div id="data_panel" align="center" style="width:100%">
         <script>
		 	function new_window()
			 {
				var w = window.open("Surprise", "#");
				var d = w.document.open();
				d.write(document.getElementById('details_reports').innerHTML);
				d.close();
			 }
          </script>
 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
 	</div>
    <div id="details_reports">
        <table width="400" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
            <thead>

                 <? if ($action==2) { ?>
                   <tr>
                        <th width="30" rowspan="2">Sl.</th>
                        <th width="80" rowspan="2">Date</th>
                        <th colspan="3"><? echo $hedding; ?> &nbsp; Issue</th>

                    </tr>
                 <? } else {?>
                 	<tr>
                        <th width="30" rowspan="2">Sl.</th>
                        <th width="80" rowspan="2">Date</th>
                        <th colspan="3"><? echo $hedding; ?> &nbsp; Receive</th>

                    </tr>
                 <? } ?>

                    <tr>

                      <th width="70">In-house</th>
                      <th width="70">Outside</th>
                      <th width="80">Embl. Company</th>


                    </tr>
            </thead>
        </table>
        <div style="max-height:425px; overflow-y:scroll; width:420px;" id="scroll_body">
            <table cellspacing="0" border="1" class="rpt_table"  width="399" rules="all" id="table_body" >
            <?
			$company_library=return_library_array( "select id,company_short_name from lib_company", "id", "company_short_name" );
 			$supplier_library=return_library_array( "select id,short_name from  lib_supplier", "id", "short_name" );

			$sql = sql_select("SELECT production_date,production_source,serving_company,
						SUM(CASE WHEN production_source =1 AND embel_name=$emple_type THEN production_quantity ELSE 0 END) AS prod11,
						SUM(CASE WHEN production_source =3 AND embel_name=$emple_type THEN production_quantity ELSE 0 END) AS prod31
 					FROM
						pro_garments_production_mst
					WHERE
						status_active=1 and is_deleted=0 and production_type=$action and po_break_down_id in ($po_break_down_id) and item_number_id=$item_id $country_cond
					GROUP BY production_date,production_source,serving_company");
			// echo $sql; die;

		   	$printing_in_qnty=0;$emb_in_qnty=0;$wash_in_qnty=0;$special_in_qnty=0;
			$printing_out_qnty=0;$emb_out_qnty=0;$wash_out_qnty=0;$special_out_qnty=0;
			$dataArray=array();$companyArray=array();
            $i=1;
			foreach($sql as $resultRow)
            {
                 if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

				 if($resultRow[csf('production_source')]==3)
					$serving_company= $supplier_library[$resultRow[csf('serving_company')]];
				else
					$serving_company= $company_library[$resultRow[csf('serving_company')]];
				$td_count = 2;
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="30"><? echo $i;?></td>
                    <td width="80" align="center"><? echo change_date_format($resultRow[csf("production_date")]); ?></td>

                    <td width="70" align="right"><? if($resultRow[csf('production_source')]==1){ echo $resultRow[csf("prod11")];$printing_in_qnty+=$resultRow[csf("prod11")];}else echo "0"; ?></td>
                    <td width="70" align="right"><? if($resultRow[csf('production_source')]==3){ echo $resultRow[csf("prod31")];$printing_out_qnty+=$resultRow[csf("prod31")];}else echo "0"; ?></td>
                    <td width="80"><p>&nbsp;<? if($resultRow[csf('prod11')]>0 || $resultRow[csf('prod31')]>0) echo $serving_company; ?></p></td>
                    <?
					$companyArray[$serving_company]=$serving_company;
					$dataArray[1][$serving_company]+=$resultRow[csf("prod11")]+$resultRow[csf("prod31")] ?>
                  </tr>
 				 <?
             	$i++;

        }//end foreach 1st
        ?>
        		<tfoot>
                    <tr>
                       <th align="right" colspan="2">Grand Total</th>
                       <th align="right"><? echo $printing_in_qnty; ?></th>
                       <th align="right"><? echo $printing_out_qnty; ?></th>
                       <th align="right">&nbsp;</th>

                     </tr>
               </tfoot>
        </table>
       </div>



 </div>

	<?
  	exit();

}



//cutting-1,sewing ouput-5--------------------popup-----------//
if ($action=="challanPopup")
{
 	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	if($country_id=='') $country_cond=""; else $country_cond=" and country_id='$country_id'";

 	?>
    <script>

		function print_window()
		{
			document.getElementById('scroll_body').style.overflow="auto";
			document.getElementById('scroll_body').style.maxHeight="none";

			var w = window.open("Surprise", "#");
			var d = w.document.open();
			d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
		'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');

			d.close();
			document.getElementById('scroll_body').style.overflowY="scroll";
			document.getElementById('scroll_body').style.maxHeight="260px";
		}

	</script>
    <div style="width:530px" align="center"><input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/></div>
    <fieldset style="width:530px; margin-left:5px">
        <div id="report_container">
            <table width="500" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
                <thead>
                    <th width="50">Sl.</th>
                    <th width="150">Production Date</th>
                    <th width="160">Challan No</th>
                    <th>Quantity</th>
                </thead>
            </table>
            <div style="max-height:260px; overflow-y:scroll; width:520px;" id="scroll_body">
                <table cellspacing="0" border="1" class="rpt_table" width="500" rules="all" id="table_body" >
                <?
					 $i=1; $total_quantity=0; $location="";$floor="";
					 if($dateOrLocWise==2 || $dateOrLocWise==4) // only for location floor and line wise
					 {
						 if($location_id!="") $location=" and location=$location_id";
						 if($floor_id!="") $floor=" and floor_id=$floor_id";
					 }

					 $sql=sql_select("select production_date, challan_no, SUM(production_quantity) as production_quantity from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type=$prod_type and status_active=1 and production_date='$prod_date' $location $floor $country_cond group by production_date, challan_no");
					foreach($sql as $resultRow)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                         <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                            <td width="50"><? echo $i;?></td>
                            <td width="150" align="center"><? echo change_date_format($resultRow[csf("production_date")]); ?></td>
                            <td width="160"><? echo $resultRow[csf("challan_no")]; ?>&nbsp;</td>
                            <td align="right" style="padding-right:2px"><? echo number_format($resultRow[csf("production_quantity")]); ?></td>
                         </tr>
                        <?
                        $total_sewing_quantity+=$resultRow[csf("production_quantity")];
                        $i++;
                    }
                    ?>
                   <tfoot class="tbl_bottom">
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td align="right">Total</td>
                        <td align="right" style="padding-right:2px"><? echo number_format($total_sewing_quantity); ?></td>
					</tfoot>
                </table>
            </div>
        </div>
	</fieldset>
    <?
 exit();

}

// ===================================== Job and color wise ===================================

if($action=="update_tna_progress_comment_job")
{
	//echo load_html_head_contents("TNA Info","../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	// var_dump($_REQUEST);
	$po_no = str_replace("'", "", $po_no);
	if($db_type==0) $blank_date="0000-00-00"; else $blank_date="";

	$tna_task_arr=return_library_array( "select task_name, task_short_name from lib_tna_task",'task_name','task_short_name');

	$tna_task_id=array(); $plan_start_array=array(); $plan_finish_array=array();
	$actual_start_array=array();
	$actual_finish_array=array();

	$notice_start_array=array();
	$notice_finish_array=array();
	$task_sql= sql_select("select a.task_number,a.task_start_date,a.task_finish_date,a.actual_start_date,a.actual_finish_date,a.notice_date_start,a.notice_date_end from tna_process_mst a, lib_tna_task b where a.task_number=b.task_name and a.template_id=$template_id and a.po_number_id in($po_no) order by b.task_sequence_no asc");
	foreach ($task_sql as $row_task)
	{
		$tna_task_id[]=$row_task[csf("task_number")];

		$plan_start_array[$row_task[csf("task_number")]] =$row_task[csf("task_start_date")];
		$plan_finish_array[$row_task[csf("task_number")]]=$row_task[csf("task_finish_date")];

		$actual_start_array[$row_task[csf("task_number")]] =$row_task[csf("actual_start_date")];
		$actual_finish_array[$row_task[csf("task_number")]]=$row_task[csf("actual_finish_date")];

		$notice_start_array[$row_task[csf("task_number")]] =$row_task[csf("notice_date_start")];
		$notice_finish_array[$row_task[csf("task_number")]]=$row_task[csf("notice_date_end")];
	}



	$comments_array=array(); $responsible_array=array();
	$res_comm_sql= sql_select("select task_id, comments, responsible from tna_progress_comments where tamplate_id=$template_id and order_id in($po_no)");
	foreach ($res_comm_sql as $row_res_comm)
	{
		$comments_array[$row_res_comm[csf("task_id")]] =$row_res_comm[csf("comments")];
		$responsible_array[$row_res_comm[csf("task_id")]]=$row_res_comm[csf("responsible")];
	}

	$execution_time_array=array();
	$execution_time_sql= sql_select("select tna_task_id, execution_days from tna_task_template_details where task_template_id=$template_id");
	foreach ($execution_time_sql as $row_execution_time)
	{
		$execution_time_array[$row_execution_time[csf("tna_task_id")]] =$row_execution_time[csf("execution_days")];
	}

	$lead_time=return_library_array("select task_template_id,lead_time from tna_task_template_details group by task_template_id,lead_time","task_template_id","lead_time");
	$company_library=return_library_array( "select id,company_short_name from lib_company", "id", "company_short_name"  );
    $buyer_short_library=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
	?>


	<fieldset style="width:1010px">
        <div class="form_caption" align="center"><strong>TNA Progress Comment</strong></div>
        <table style="margin-top:10px" width="1000" border="1" rules="all" class="rpt_table">
            <?
			$sql ="select b.company_name,b.buyer_name,a.po_number,b.job_no,b.style_ref_no,b.gmts_item_id,a.po_received_date,a.shipment_date from wo_po_break_down a,wo_po_details_master b where b.job_no='$job_no' and a.id in($po_no) and a.job_no_mst=b.job_no";
			//echo $sql;die;
			$result=sql_select($sql);
            foreach($result as $row)
            {
            ?>
            	<thead>
                    <tr bgcolor="#E9F3FF">
                        <th width="130">Company</th>
                        <td width="196" style="padding-left:5px"><? echo $company_library[$row[csf('company_name')]];  ?></td>
                        <th width="130">Buyer</th>
                        <td width="186" style="padding-left:5px"><? echo $buyer_short_library[$row[csf('buyer_name')]];  ?></td>
                        <th width="130">Order No</th>
                        <td width="186" style="padding-left:5px"><p><? echo $row[csf('po_number')]; ?></p></td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <th>Style Ref.</th>
                        <td style="padding-left:5px"><p><? echo $row[csf('style_ref_no')]; ?></p></td>
                        <th>RMG Item</th>
                        <td style="padding-left:5px"><p><? echo $garments_item[$row[csf('gmts_item_id')]]; ?></p></td>
                        <th>Order Recv. Date</th>
                        <td style="padding-left:5px"><? echo change_date_format($row[csf('po_received_date')]); ?></td>
                    </tr>
                    <tr bgcolor="#E9F3FF">
                        <th>Ship Date</th>
                        <td style="padding-left:5px"><? echo change_date_format($row[csf('shipment_date')]); ?></td>
                        <th>Lead Time</th>
                        <td style="padding-left:5px">
                            <?
								$template_id=str_replace("'","",$template_id);

								if($tna_process_type==1)
								{
									$lead_timee=$lead_time[$template_id];
								}
								else
								{
									$lead_timee=$template_id;
								}
								//echo $lead_time=return_field_value("lead_time","tna_task_template_details", "task_template_id='$template_id' and status_active=1 and is_deleted=0");
								echo $lead_timee;
							?>
                        </td>
                        <th>Job Number</th>
                        <td style="padding-left:5px">
							<? echo $row[csf('job_no')];   ?>
                        </td>
                    </tr>
                </thead>
            <?
            }
            ?>
        </table>
        <table style="margin-top:5px" cellpadding="0" width="1000" class="rpt_table" rules="all" border="1">
            <thead>
                <th width="50">Task No</th>
                <th width="150">Task Name</th>
                <th width="60">Allowed Days</th>
                <th width="80">Plan Start Date</th>
                <th width="80">Plan Finish Date</th>
                <th width="80">Actual Start Date</th>
                <th width="80">Actual Finish Date</th>
                <th width="80">Start Delay/ Early By</th>
                <th width="80">Finish Delay/ Early By</th>
                <th width="100">Responsible</th>
                <th>Comments</th>
            </thead>
        </table>



            <table cellpadding="0" width="1000" cellspacing="0" border="1" rules="all" class="rpt_table">
                <?


				$i=1;
                foreach($tna_task_id as $key)
                {
                    if($i%2==0) $trcolor="#E9F3FF"; else $trcolor="#FFFFFF";

					$bgcolor1=""; $bgcolor="";

					if ($plan_start_array[$key]!=$blank_date)
					{
						if (strtotime($notice_start_array[$key])<=strtotime(date("Y-m-d",time())) && strtotime(date("Y-m-d",time()))<=strtotime($plan_start_array[$key]))  $bgcolor="#FFFF00";
						else if (strtotime($plan_start_array[$key])<strtotime(date("Y-m-d",time())))  $bgcolor="#FF0000";
						else $bgcolor="";

					}

					if ($plan_finish_array[$key]!=$blank_date) {
						if (strtotime($notice_finish_array[$key])<=strtotime(date("Y-m-d",time())) && strtotime(date("Y-m-d",time()))<=strtotime($plan_finish_array[$key]))  $bgcolor1="#FFFF00";
						else if (strtotime($plan_finish_array[$key])<strtotime(date("Y-m-d",time())))  $bgcolor1="#FF0000"; else $bgcolor1="";
					}

					if ($actual_start_array[$key]!=$blank_date) $bgcolor="";
					if ($actual_finish_array[$key]!=$blank_date) $bgcolor1="";

					// Delay / Early............

					$bgcolor5=""; $bgcolor6="";
					$delay=""; $early="";

					if($actual_start_array[$key]!=$blank_date)
					{
						$start_diff1 = datediff( "d", $actual_start_array[$key], $plan_start_array[$key]);
						$finish_diff1 = datediff( "d", $actual_finish_array[$key], $plan_finish_array[$key]);

						$start_diff=$start_diff1-1;
						$finish_diff=$finish_diff1-1;

						if($start_diff<0)
						{
							$bgcolor5="#2A9FFF";	//Blue
							$start="(Delay)";
						}
						if($start_diff>0)
						{
							$bgcolor5="";
							$start="(Early)";

						}
						if($finish_diff<0)
						{
							$bgcolor6="#2A9FFF";
							$finish="(Delay)";
						}
						if($finish_diff>0)
						{
							$bgcolor6="";
							$finish="(Early)";
						}


					}
					else
					{
						if(date("Y-m-d")>$plan_start_array[$key])
						{
							$start_diff1 = datediff( "d", $plan_start_array[$key], date("Y-m-d"));
							$start_diff=$start_diff1-1;
							$bgcolor5="#FF0000";		//Red
							$start="(Delay)";
						}
						if(date("Y-m-d")>$plan_finish_array[$key])
						{
							$finish_diff1 = datediff( "d", $plan_finish_array[$key], date("Y-m-d"));
							$finish_diff=$finish_diff1-1;
							$bgcolor6="#FF0000";
							$finish="(Delay)";
						}
						if(date("Y-m-d")<=$plan_start_array[$key])
						{
							$start_diff = "";
							$bgcolor5="";
							$start="(Ac. Start Dt. Not Found)";
						}
						if(date("Y-m-d")<=$plan_finish_array[$key])
						{
							$finish_diff = "";
							$bgcolor6="";
							$finish="(Ac. Finish Dt. Not Found)";

						}
					}

                    ?>
                    <tr bgcolor="<? echo $trcolor; ?>" id="tr_<? echo $i; ?>" onclick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')">
                        <td align="center" width="50"><? echo $i; ?></td>
                        <td width="150"><? echo $tna_task_arr[$key]; ?></td>
                        <td align="center" width="60"><? echo datediff( "d", $plan_start_array[$key],$plan_finish_array[$key]);//$execution_time_array[$key]; ?></td>
                        <td align="center" width="80"><? echo change_date_format($plan_start_array[$key]); ?>&nbsp;</td>
                        <td align="center" width="80"><? echo change_date_format($plan_finish_array[$key]); ?>&nbsp;</td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor;  ?>">
                            <?
                                if($actual_start_array[$key]=="0000-00-00" || $actual_start_array[$key]=="") echo "&nbsp;";
                                else echo change_date_format($actual_start_array[$key]);
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor1;  ?>">
                            <?
                                 if($actual_finish_array[$key]=="0000-00-00" || $actual_finish_array[$key]=="") echo "&nbsp;";
                                 else echo change_date_format($actual_finish_array[$key]);
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor5;  ?>">
							<?
                                echo $start_diff." ".$start;
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor6;  ?>">
                            <?
                                echo $finish_diff." ".$finish;
                            ?>
                        </td>

                        <td width="100"><p><? echo $responsible_array[$key]; ?>&nbsp;</p></td>
                        <td><p><? echo $comments_array[$key]; ?>&nbsp;</p></td>
                    </tr>
              	<?
                    $i++;
                }
                ?>
            </table>
    </fieldset>
	<?
	exit();
}

if($action=="job_color_wise_remarks")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Remarks", "../../../", 1, 1,$unicode,'','');
	// $job_no=str_replace("'","",$job_no);
	$color_id=str_replace("'","",$color_id);
	$po_break_down_id = $po_no;
	$floor_library=return_library_array( "select id,floor_name from  lib_prod_floor", "id", "floor_name"  );
	$line_library=return_library_array( "select id,line_name from lib_sewing_line", "id", "line_name"  );
	$actual_resource_library=return_library_array( "select id,line_number from prod_resource_mst", "id", "line_number"  );
	$job_sql = sql_select("SELECT a.company_name,a.style_ref_no,a.buyer_name,b.po_number from wo_po_details_master a,wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($po_break_down_id)");
	?>
    <div id="data_panel" style="width:100%;text-align: center;padding: 5px;">
		<script>
            function new_window()
            {
                var w = window.open("Surprise", "#");
                var d = w.document.open();
                d.write(document.getElementById('details_reports').innerHTML);
                d.close();
            }
        </script>
    	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
    	<span id="popup_report_container" align="center" style="width: 120px;"> </span>
    </div>
    <?
     ob_start();
	?>
    <div align="center" id="details_reports">
    <div style="width:480px">
	    <table width="100%">
	    	<tr>
	    		<th colspan="2" align="left" width="49%">Company : <? echo $company_library[$job_sql[0][csf('company_name')]];?></th>
	    		<th colspan="2" align="left" width="49%">Style : <? echo $job_sql[0][csf('style_ref_no')];?></th>
	    	</tr>
	    	<tr>
	    		<th colspan="2" align="left" width="49%">Buyer : <? echo $buyer_short_library[$job_sql[0][csf('buyer_name')]];?></th>
	    		<th colspan="2" align="left" width="49%">Po No. : <? echo $job_sql[0][csf('po_number')];?></th>
	    	</tr>
	    </table>
	</div>
    <fieldset style="width:480px">
        <legend>Cut and Lay</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
				<?
                if($color_id>0) $color_cond=" and c.color_number_id=$color_id"; else $color_cond="";

                $sql_cutAndLay= sql_select("SELECT max(a.entry_date) as production_date ,sum(c.size_qty) as production_quantity from  ppl_cut_lay_mst a,  ppl_cut_lay_dtls b, ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.job_no='$job_no' and b.color_id=$color_id order by production_date");
                $i=1;
                $cutTotal=0;
                foreach($sql_cutAndLay as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td>&nbsp;</td>
                    </tr>
                    <?
                     $cutTotal+=$row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($cutTotal,2); ?></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
    </fieldset>



    	<fieldset style="width:480px">
        	<legend>Cutting</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
				<?
                if($color_id>0) $color_cond=" and c.color_number_id=$color_id"; else $color_cond="";

                $sql_cutting= sql_select("SELECT a.production_date,a.remarks,sum(b.production_qnty) as production_quantity from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='1' and b.production_type='1' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,a.remarks order by a.production_date");
                $i=1;
                $cuttingTotal = 0;
                foreach($sql_cutting as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $cuttingTotal += $row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($cuttingTotal,2); ?></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Print/Embr Issue</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_print_issue= sql_select("SELECT a.production_date,a.remarks,sum(b.production_qnty) as production_quantity
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='2' and b.production_type='2' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,a.remarks  order by a.production_date");
                $i=1;
                $embIssueTotal = 0;
                foreach($sql_print_issue as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $embIssueTotal += $row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($embIssueTotal,2); ?></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Print/Embr Receive</legend>
             <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_print_rcv=  sql_select("SELECT a.production_date,a.remarks,sum(b.production_qnty) as production_quantity
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='3' and b.production_type='3' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,a.remarks  order by a.production_date");

                $i=1;
                $embRcvTotal = 0;
                foreach($sql_print_rcv as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $embRcvTotal += $row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($embRcvTotal,2); ?></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        	<legend>Sewing Input</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_in= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='4' and b.production_type='4' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line  order by a.production_date , a.floor_id");
                $sewing_in_array = array();
                foreach ($sql_sewing_in as $key => $row)
                {
                	if($row[csf("prod_reso_allo")]==1)
                    {
                        $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                        $all_sewing_line="";
                        foreach($sewing_ling_arr as $line_id)
                        {
                            $all_sewing_line.=$line_library[$line_id].",";
                        }
                        $all_sewing_line=chop($all_sewing_line," , ");
                        // echo $all_sewing_line;
                        $sewing_in_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['production_quantity'] += $row[csf("production_quantity")];
	                	$sewing_in_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['remarks'] = $row[csf("remarks")];
                    }
                    else
                    {
                        $all_sewing_line = $line_library[$row[csf("sewing_line")]];
                        $sewing_in_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['production_quantity'] += $row[csf("production_quantity")];
	                	$sewing_in_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['remarks'] = $row[csf("remarks")];
                    }

                }
                /*echo "<pre>";
                print_r($sewing_in_array);
                echo "</pre>";*/
                $i=1;
                $GrandTotal = 0;
                foreach($sewing_in_array as $floor_id=>$floor_data)
                {
                	$floorTotal = 0;
                	foreach ($floor_data as $date => $date_data)
                	{
                		foreach ($date_data as $line_name => $row)
                		{
		                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
		                    ?>
		                    <tr bgcolor="<? echo $bgcolor; ?>">
		                        <td align="center"><? echo $i; ?></td>
		                        <td align="center"><? if($date!="" && $date!="0000-00-00") echo change_date_format($date); ?></td>
		                        <td align="right"><? echo number_format($row["production_quantity"],2); ?></td>
		                        <td ><? echo $floor_library[$floor_id]; ?></td>
		                        <td style="padding-left:3px;"><? echo $line_name; ?> </td>
		                        <td><? echo $row["remarks"]; ?></td>
		                    </tr>
		                    <?
		                    $i++;
		                    $floorTotal += $row["production_quantity"];
		                    $GrandTotal += $row["production_quantity"];
                    	}
                	}
                	?>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($floorTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                	<?
                }
                ?>
                	<tr>
                		<td></td>
                		<td align="right">Grand Total</td>
                		<td align="right"><? echo number_format($GrandTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                </tbody>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        	<legend >Sewing Output</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_out= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='5' and b.production_type='5' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1     group by  a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line order by a.production_date , a.floor_id");
                $sewing_out_array = array();
                foreach ($sql_sewing_out as $key => $row)
                {
                	if($row[csf("prod_reso_allo")]==1)
                    {
                        $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                        $all_sewing_line="";
                        foreach($sewing_ling_arr as $line_id)
                        {
                            $all_sewing_line.=$line_library[$line_id].",";
                        }
                        $all_sewing_line=chop($all_sewing_line," , ");
                        // echo $all_sewing_line;
                        $sewing_out_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['production_quantity'] += $row[csf("production_quantity")];
	                	$sewing_out_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['remarks'] = $row[csf("remarks")];
                    }
                    else
                    {
                        $all_sewing_line = $line_library[$row[csf("sewing_line")]];
                        $sewing_out_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['production_quantity'] += $row[csf("production_quantity")];
	                	$sewing_out_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['remarks'] = $row[csf("remarks")];
                    }

                }
                /*echo "<pre>";
                print_r($sewing_in_array);
                echo "</pre>";*/
                $i=1;
                $GrandTotal = 0;
                foreach($sewing_out_array as $floor_id=>$floor_data)
                {
                	$floorTotal = 0;
                	foreach ($floor_data as $date => $date_data)
                	{
                		foreach ($date_data as $line_name => $row)
                		{
		                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
		                    ?>
		                    <tr bgcolor="<? echo $bgcolor; ?>">
		                        <td align="center"><? echo $i; ?></td>
		                        <td align="center"><? if($date!="" && $date!="0000-00-00") echo change_date_format($date); ?></td>
		                        <td align="right"><? echo number_format($row["production_quantity"],2); ?></td>
		                        <td ><? echo $floor_library[$floor_id]; ?></td>
		                        <td style="padding-left:3px;"><? echo $line_name; ?> </td>
		                        <td><? echo $row["remarks"]; ?></td>
		                    </tr>
		                    <?
		                    $i++;
		                    $floorTotal += $row["production_quantity"];
		                    $GrandTotal += $row["production_quantity"];
                    	}
                	}
                	?>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($floorTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                	<?
                }
                ?>
                	<tr>
                		<td></td>
                		<td align="right">Grand Total</td>
                		<td align="right"><? echo number_format($GrandTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                </tbody>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        	<legend>Poly</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_out= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='11' and b.production_type='11' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by  a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line order by a.production_date , a.floor_id");
                $i=1;
                $polyTotal = 0;
                foreach($sql_sewing_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td style="padding-left:3px;">
                        <?
                        if($row[csf("prod_reso_allo")]==1)
                        {
                            $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                            $all_sewing_line="";
                            foreach($sewing_ling_arr as $line_id)
                            {
                                $all_sewing_line.=$line_library[$line_id].",";
                            }
                            $all_sewing_line=chop($all_sewing_line," , ");
                            echo $all_sewing_line;
                        }
                        else
                        {
                            echo $line_library[$row[csf("sewing_line")]];
                        }
                        ?>
                        </td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $polyTotal += $row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($polyTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        	<legend>Finishing & Packing</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="100">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_finish_out= sql_select("SELECT a.production_date, a.floor_id, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='8' and b.production_type='8' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1    group by a.production_date,a.floor_id order by a.production_date , a.floor_id");
                $i=1;
                $finTotal = 0;
                foreach($sql_finish_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td ><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $finTotal += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($finTotal,2); ?></td>
                		<td></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>
    <?
	$html=ob_get_contents();
	ob_flush();

	foreach (glob("$user_id*.xls") as $filename)
	{
	   @unlink($filename);
	}

	//html to xls convert
	$name=time();
	$name=$user_id."_".$name.".xls";
	$create_new_excel = fopen(''.$name, 'w');
	$is_created = fwrite($create_new_excel,$html);
	?>
    <input type="hidden" id="txt_excl_link" value="<? echo 'requires/'.$name; ?>" />
    <script>
		$(document).ready(function(e)
		{
			document.getElementById('popup_report_container').innerHTML='<a href="<? echo $name?>" style="text-decoration:none"><input type="button" value="Convert to Excel" name="excel" id="excel" style="padding:0 2px;" class="formbutton"/></a>&nbsp;&nbsp;';
		});
	</script>
	</div>
	<?
	exit();
}

if ($action=='JobColorOrderPopup')
{
	echo load_html_head_contents("Order Wise Production Report", "../../../", 1, 1,$unicode,'','');
	extract($_REQUEST);

	$po_break_down_id=$po_no;
	$company_name=str_replace("'","",$company_name);
	$color_id=str_replace("'","",$color_id);

	//echo $po_break_down_id."****".$company_name."****".$item_id."****".$country_id."****".$color_id;die;
	$sql_exfect="SELECT c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) and c.color_number_id='$color_id' and a.status_active=1 and a.is_deleted=0 group by  c.color_number_id, c.size_number_id";
	$sql_result_exfact=sql_select($sql_exfect);
	foreach($sql_result_exfact as $row)
	{
		$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("size_number_id")]]=$row[csf("production_qnty")];
	}

	$color_library=array();
	$size_library=array();
	$color_library_plan=array();
	$dataQty=array();
	$colorSizeData=sql_select("SELECT id, color_number_id, size_number_id, order_quantity, plan_cut_qnty, excess_cut_perc from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and color_number_id='$color_id' and status_active=1 and is_deleted=0");
 	  foreach($colorSizeData as $csRow)
	  {
		  if($csRow[csf('color_number_id')]>0)
		  {
			  $color_library[$csRow[csf('color_number_id')]]+=$csRow[csf('order_quantity')];
			  $color_library_plan[$csRow[csf('color_number_id')]]+=$csRow[csf('plan_cut_qnty')];
		  }

		  if($csRow[csf('size_number_id')]>0)
		  {
			  $size_library[$csRow[csf('size_number_id')]]=$csRow[csf('size_number_id')];
		  }

		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][1]+=$csRow[csf('order_quantity')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][2]+=$csRow[csf('plan_cut_qnty')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][3]+=$csRow[csf('excess_cut_perc')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][4]+=1;
		  $color_size_data[$csRow[csf("id")]]["color_number_id"]=$csRow[csf('color_number_id')];
		  $color_size_data[$csRow[csf("id")]]["size_number_id"]=$csRow[csf('size_number_id')];
	  }




	if($db_type==0)
	{
		$prod_sql= sql_select("SELECT a.po_break_down_id, c.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.status_active=1 and c.status_active=1 and a.po_break_down_id in($po_break_down_id) group by a.po_break_down_id,c.color_size_break_down_id");
				/*IFNULL(sum(CASE WHEN c.production_type ='2' THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='3' THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty, */
	}
	else
	{
		 $pr_sql="SELECT a.po_break_down_id, c.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				NVL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.status_active=1 and c.status_active=1 and a.po_break_down_id in($po_break_down_id)
			group by a.po_break_down_id,c.color_size_break_down_id";
			$prod_sql=sql_select($pr_sql);


	}
	//echo $prod_sql;
	$prod_color_size_data=array();
	foreach($prod_sql as $row)
	{
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["cutting_qnty"]+=$row[csf("cutting_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printing_qnty"]+=$row[csf("printing_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printreceived_qnty"]+=$row[csf("printreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["emb_qnty"]+=$row[csf("emb_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["embreceived_qnty"]+=$row[csf("embreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["wash_qnty"]+=$row[csf("wash_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["washreceived_qnty"]+=$row[csf("washreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sp_qnty"]+=$row[csf("sp_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["spreceived_qnty"]+=$row[csf("spreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingin_qnty"]+=$row[csf("sewingin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingout_qnty"]+=$row[csf("sewingout_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finishin_qnty"]+=$row[csf("finishin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["iron_qnty"]+=$row[csf("iron_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finish_qnty"]+=$row[csf("finish_qnty")];
		//$color_library[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		//$size_library[$row[csf("size_number_id")]]=$row[csf("size_number_id")];
	}
	//var_dump($color_library);die;

	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:700px" align="center" id="details_reports">
	  	<legend>Color And Size Wise Summary</legend>
	    <table id="tbl_id" class="rpt_table" width="700" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="70">Buyer</th>
	                <th width="100">Job Number</th>
	                <th width="120">Style Name</th>
	                <th width="100">Order Number</th>
	                <th width="70">Ship Date</th>
	                <th width="150">Item Name</th>
	                <th >Order Qty.</th>
	            </tr>
	        </thead>
	       	<?
				$sql = "SELECT a.job_no_mst, a.po_number as po_number,a.pub_shipment_date as pub_shipment_date,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,b.total_set_qnty as set_item_ratio,c.item_number_id, sum(c.order_quantity) as po_quantity
						from wo_po_break_down a, wo_po_details_master b, wo_po_color_size_breakdown c
						where a.job_no_mst=b.job_no and a.id=c.po_break_down_id and b.job_no='$job_no' and a.id in($po_break_down_id) and c.color_number_id='$color_id' and a.status_active in(1,2,3) and a.is_deleted=0 and b.status_active=1 and c.status_active in(1,2,3) and b.is_deleted=0
						group by a.job_no_mst, a.po_number,a.pub_shipment_date,a.pub_shipment_date,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,b.total_set_qnty,c.item_number_id";
				//echo $sql;die;
				$resultRow=sql_select($sql);

				$cons_embr=return_field_value("sum(cons_dzn_gmts) as cons_dzn_gmts","wo_pre_cost_embe_cost_dtls","job_no='$job_no' and status_active=1 and is_deleted=0","cons_dzn_gmts");

	 		?>
	        <tbody>
	        	<?
	        	foreach ($resultRow as $key => $row)
	        	{
	        	?>
	        	<tr>
	                <td><p><? echo $buyer_short_library[$row[csf("buyer_name")]]; ?></p></td>
	                <td><p><? echo $job_no; ?></p></td>
	                <td><p><? echo $row[csf("style_ref_no")]; ?></p></td>
	                <td><p><? echo implode(",",array_unique(explode(",",$row[csf("po_number")]))); ?></p></td>
	                <td align="center"><? echo change_date_format($row[csf("pub_shipment_date")]); ?></td>
	                <td><? echo $garments_item[$row[csf('item_number_id')]]; ?></td>
	                <td align="right"><? echo number_format($row[csf("po_quantity")]*$row[csf("set_item_ratio")],2,'.',''); ?></td>
	            </tr>
	            <?
	        	}
				$prod_sewing_sql=sql_select("SELECT sum(alter_qnty) as alter_qnty, sum(reject_qnty) as reject_qnty from pro_garments_production_mst where production_type=5 and po_break_down_id in($po_break_down_id) and is_deleted=0 and status_active=1");
				foreach ($prod_sewing_sql as $key => $val) {

				?>
	            <tr>
	                <td colspan="2">Total Alter Sewing Qty : <b><? echo $val[csf("alter_qnty")]; ?></b></td>
	                <td colspan="2">Total Reject Sewing Qty : <b><? echo  $val[csf("reject_qnty")]; ?></b></td>
	                <td colspan="2">Pack Assortment: <b><? //echo $packing[$resultRow[csf("packing")]]; ?></b></td>
	            </tr>
	            <?
	        	}
	            ?>
	        </tbody>
	    </table>
	    <?

		  $size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
		  //$color_library_sql;
		  if($country_id>0) $contry_cond=" and country_id='$country_id'"; else $contry_cond="";

		  $count = count($size_library);
		  $width= $count*70+350;

		?>
	    <table id="tblDtls_id" class="rpt_table" width="<? echo $width; ?>" border="1" rules="all" >
		 	<thead>
	        	<tr>
	            	<th width="100">Color Name</th>
	                <th width="170">Production Type</th>
	 				<?
					foreach($size_library as $val)
					{
					 	?><th width="80"><? echo $size_Arr_library[$val]; ?></th><?
					}
					?>
	     		    <th width="60">Total</th>
	           </tr>
	        </thead>
	        <?
			  foreach($color_library as $colorId=>$totalorderqnty)
			  {
				  if($color_variable_setting==2 || $color_variable_setting==3) $row_span=17; else $row_span=16;
				?>
				<tr>

					<td rowspan="<? echo $row_span; ?>"><? echo $color_Arr_library[$color_id]; ?></td>

	 			<?

	 					$bgcolor1="#E9F3FF";
						$bgcolor2="#FFFFFF";
					?>
						</tr>

	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                        <td><b>Order Quantity</b></td>
	                        <?
	                        foreach($size_library as $sizeId=>$sizeRes)
	                        {
	                        ?>
	                            <td><? echo $dataQty[$colorId][$sizeId][1]; ?></td>
	                        <?
	                        }
	                        ?>
	                        <td><? echo $totalorderqnty; ?></td>
	                    </tr>

	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                        <td><b>Plan To Cut (AVG <? echo number_format($dataQty[$colorId][$sizeId][3]/$dataQty[$colorId][$sizeId][4],2); ?>)% </b></td>
	                        <?
	                        foreach($size_library as $sizeId=>$sizeRes)
	                        {
	                        ?>
	                            <td title="Excess Cut <? echo $dataQty[$colorId][$sizeId][3]; ?>%"><? echo $dataQty[$colorId][$sizeId][2]; ?></td>
	                        <?
	                        }
	                        ?>
	                        <td><? echo $color_library_plan[$colorId]; ?></td>
	                    </tr>
						<?
	 				$total_cutting=0;$total_sew_in=0;$total_sew_out=0;$total_fin_in=0;$total_fin_out=0;$total_iron_out=0; $total_exfact_qnty=0;
					$total_print_issue=0;$total_print_rcv=0;$total_embro_issue=0;$total_embro_rcv=0; $total_sp_issue=0;$total_sp_rcv=0; $total_wash_issue=0;$total_wash_rcv=0;
					$cutting_html='';$sewin_html='';$sewout_html='';$finisin_html='';$finisout_html='';$iron_html=''; $exfact_html='';
					$printiss_html=''; $printrcv_html=''; $embroiss_html=''; $embrorcv_html=''; $spiss_html=''; $sprcv_html=''; $washiss_html=''; $washrcv_html='';
					foreach($size_library as $sizeId=>$sizeRes)
					{
						$cutting_qnty=$prod_color_size_data[$colorId][$sizeId]['cutting_qnty'];
						$printing_qnty=$prod_color_size_data[$colorId][$sizeId]['printing_qnty'];
						$printreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['printreceived_qnty'];
						$emb_qnty=$prod_color_size_data[$colorId][$sizeId]['emb_qnty'];
						$embreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['embreceived_qnty'];
						$wash_qnty=$prod_color_size_data[$colorId][$sizeId]['wash_qnty'];
						$washreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['washreceived_qnty'];
						$sp_qnty=$prod_color_size_data[$colorId][$sizeId]['sp_qnty'];
						$spreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['spreceived_qnty'];
						$sewingin_qnty=$prod_color_size_data[$colorId][$sizeId]['sewingin_qnty'];
						$sewingout_qnty=$prod_color_size_data[$colorId][$sizeId]['sewingout_qnty'];
						$finishin_qnty=$prod_color_size_data[$colorId][$sizeId]['finishin_qnty'];
						$iron_qnty=$prod_color_size_data[$colorId][$sizeId]['iron_qnty'];
						$finish_qnty=$prod_color_size_data[$colorId][$sizeId]['finish_qnty'];

						$resRow[csf($col)]=$dataQty[$colorId][$sizeId][2];
	                    if($cutting_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($cutting_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($cutting_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						$cutting_html .='<td '.$bgCol.'>'.$cutting_qnty.'</td>';
	                    $total_cutting+=$cutting_qnty;

						if($cons_embr>0)
						{
							if($printing_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($printing_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($printing_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $printiss_html .='<td '.$bgCol.'>'.$printing_qnty.'</td>';
	                    $total_print_issue+=$printing_qnty;

						if($cons_embr>0)
						{
							if($printreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($printreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($printreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $printrcv_html .='<td '.$bgCol.'>'.$printreceived_qnty.'</td>';
	                    $total_print_rcv+=$printreceived_qnty;

						if($cons_embr>0)
						{
							if($emb_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($emb_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($emb_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $embroiss_html .='<td '.$bgCol.'>'.$emb_qnty.'</td>';
	                    $total_embro_issue+=$emb_qnty;

						if($cons_embr>0)
						{
							if($embreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($embreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($embreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $embrorcv_html .='<td '.$bgCol.'>'.$embreceived_qnty.'</td>';
	                    $total_embro_rcv+=$embreceived_qnty;

						if($cons_embr>0)
						{
							if($sp_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($sp_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($sp_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $spiss_html .='<td '.$bgCol.'>'.$sp_qnty.'</td>';
	                    $total_sp_issue+=$sp_qnty;

						if($cons_embr>0)
						{
							if($spreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($spreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($spreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $sprcv_html .='<td '.$bgCol.'>'.$spreceived_qnty.'</td>';
	                    $total_sp_rcv+=$spreceived_qnty;

						if($cons_embr>0)
						{
							if($wash_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($wash_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($wash_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $washiss_html .='<td '.$bgCol.'>'.$wash_qnty.'</td>';
	                    $total_wash_issue+=$wash_qnty;

						if($cons_embr>0)
						{
							if($washreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($washreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($washreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $washrcv_html .='<td '.$bgCol.'>'.$washreceived_qnty.'</td>';
	                    $total_wash_rcv+=$washreceived_qnty;

						if($sewingin_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($sewingin_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($sewingin_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewin_html .='<td '.$bgCol.'>'.$sewingin_qnty.'</td>';
	                    $total_sew_in+=$sewingin_qnty;

						if($sewingout_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($sewingout_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($sewingout_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewout_html .='<td '.$bgCol.'>'.$sewingout_qnty.'</td>';
	                    $total_sew_out+=$sewingout_qnty;

						/*if($prodRow[csf("finishin_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						else if($prodRow[csf("finishin_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prodRow[csf("finishin_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisin_html .='<td '.$bgCol.'>'.$prodRow[csf("finishin_qnty")].'</td>';
	                    $total_fin_in+=$prodRow[csf("finishin_qnty")];*/

						if($finish_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($finish_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($finish_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisout_html .='<td '.$bgCol.'>'.$finish_qnty.'</td>';
	                    $total_fin_out+=$finish_qnty;

						if($iron_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($iron_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($iron_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $iron_html .='<td '.$bgCol.'>'.$iron_qnty.'</td>';
	                    $total_iron_out+=$iron_qnty;

						//if($prodRow[csf("iron_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						//else if($prodRow[csf("iron_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						//else if($prodRow[csf("iron_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							$bgCol=="bgcolor='#FFFFFF'";
							$exfact_html.='<td>'.$ex_fact_qty_arr[$colorId][$sizeId].'&nbsp;</td>';

							$total_exfact_qnty+=$ex_fact_qty_arr[$colorId][$sizeId];
						}


					}// end size foreach loop

					?>
						<tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Cutting</b></td>
	                        <? echo $cutting_html; ?>
	                        <td><? echo $total_cutting; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Print Issue</b></td>
	                        <? echo $printiss_html; ?>
	                        <td><? echo $total_print_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Print Received</b></td>
	                        <? echo $printrcv_html; ?>
	                        <td><? echo $total_print_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Embro Issue</b></td>
	                        <? echo $embroiss_html; ?>
	                        <td><? echo $total_embro_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Embro Received</b></td>
	                        <? echo $embrorcv_html; ?>
	                        <td><? echo $total_embro_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Special Works</b></td>
	                        <? echo $spiss_html; ?>
	                        <td><? echo $total_sp_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Special Works</b></td>
	                        <? echo $sprcv_html; ?>
	                        <td><? echo $total_sp_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Sewing Input</b></td>
	                       <? echo $sewin_html; ?>
	                        <td><? echo $total_sew_in; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Sewing Output</b></td>
	                        <? echo $sewout_html; ?>
	                        <td><? echo $total_sew_out; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Wash</b></td>
	                        <? echo $washiss_html; ?>
	                        <td><? echo $total_wash_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Wash</b></td>
	                        <? echo $washrcv_html; ?>
	                        <td><? echo $total_wash_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Iron Output</b></td>
	                        <? echo $iron_html; ?>
	                        <td><? echo $total_iron_out; ?></td>
	                    </tr>
	                   <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Finishing Output</b></td>
	                       <? echo $finisout_html; ?>
	                        <td><? echo $total_fin_out; ?></td>
	                    </tr>
	                    <?
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							?>
							<tr>
								<td><b>Ex-Factory Qty.</b></td>
								 <? echo $exfact_html; ?>
								<td><? echo $total_exfact_qnty; ?>&nbsp;</td>
							</tr>
							<?
						}
						?>
				<?
				}// end color foreach loop
				?>


	 </table>
	</div>


	<?
	exit();

}


if ($action=="JobColorProdPopup")
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	// echo $po_no;
	$company_name=str_replace("'","",$company_name);
	$color_id=str_replace("'","",$color_id);
	// $prod_type=str_replace("'","",$prod_type);
	$po_break_down_id = $po_no;
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);
	$prod_popup_lelel_arr=explode('*',$prod_popup_lelel);
	$prod_popup_lelel_type=$prod_popup_lelel_arr[0];  // source (inhouse / subcon)
	$prod_popup_lelel_cat=$prod_popup_lelel_arr[1]; // embel name

	if($db_type==0) $rmg_process_breakdown=return_field_value("a.rmg_process_breakdown as rmg_process_breakdown"," wo_booking_mst a, wo_booking_dtls b","a.booking_no=b.booking_no and  b.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc limit 1","rmg_process_breakdown");
	else if($db_type==2) $rmg_process_breakdown=return_field_value("rmg_process_breakdown"," (select a.id, a.rmg_process_breakdown  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc)","ROWNUM = 1","rmg_process_breakdown");
	// print_r($rmg_process_breakdown);
	if($rmg_process_breakdown!="")
	{
		$rmg_process_breakdown_arr=explode("_",$rmg_process_breakdown);
		//var_dump($rmg_process_breakdown_arr);die;
		$cut_panel_rejection=$rmg_process_breakdown_arr[8];
		$chest_printing=$rmg_process_breakdown_arr[2];
		$neck_sleeve_printing=$rmg_process_breakdown_arr[10];
		$embroidery=$rmg_process_breakdown_arr[1];
		$sewing_input=$rmg_process_breakdown_arr[4];
		$garments_wash=$rmg_process_breakdown_arr[3];
		$gmts_finishing=$rmg_process_breakdown_arr[15];
	}


	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	$sizearr_order=return_library_array("select size_number_id,size_number_id from wo_po_color_size_breakdown where job_no_mst='$job_no' and color_number_id=$color_id order by size_order","size_number_id","size_number_id");
	$line_Arr_library=return_library_array( "select id,line_name from lib_sewing_line where  is_deleted=0 and status_active=1", "id", "line_name" );
	$resource_alocate_line = return_library_array("select id, line_number from prod_resource_mst", "id", "line_number");
	// print_r($sizearr_order);
	$sql_order_size= sql_select("SELECT c.size_number_id, c.order_quantity as order_quantity, c.plan_cut_qnty as plan_cut_qnty
		from wo_po_color_size_breakdown c
		where c.status_active=1 and c.is_deleted=0 and c.job_no_mst='$job_no' and c.color_number_id=$color_id
		 order by c.size_order");
	// print_r($sql_order_size);
	foreach($sql_order_size as $row)
	{
		$order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('order_quantity')];
		$plan_order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('plan_cut_qnty')];
	}

	$color_size_sql=sql_select( "SELECT a.job_no_mst as job_no,a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.job_no_mst='$job_no' and a.color_number_id=$color_id order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
	}
	// print_r($color_size_data);
	$sql_supplier=sql_select("select id,supplier_name from lib_supplier where status_active =1 and is_deleted=0 order by supplier_name");
	$supplier_arr=array();
	foreach($sql_supplier as $row)
	{
		$supplier_arr[$row[csf('id')]]=$row[csf('supplier_name')];
	}

	//echo "<pre>";
	//print_r($color_size_data); die;



 		if($prod_popup_type==10)
		{
			$serving_company_id = array();
			$sql = "SELECT serving_company FROM pro_garments_production_mst  WHERE po_break_down_id in($po_break_down_id)  group by serving_company";
			$sql_res = sql_select($sql);
			// echo $sql_res[0][csf('serving_company')];
			$sql_colsiz="SELECT b.color_size_break_down_id,d.color_number_id,d.size_number_id,
			sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
			from pro_ex_factory_mst a,  pro_ex_factory_dtls b, wo_po_break_down c ,wo_po_color_size_breakdown d
			where a.id=b.mst_id and a.po_break_down_id in($po_break_down_id) and d.color_number_id=$color_id  and c.id=d.po_break_down_id and d.id=b.color_size_break_down_id and a.po_break_down_id = c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active in(1,2,3) and d.status_active in(1,2,3) and d.is_deleted=0  group by b.color_size_break_down_id,d.color_number_id,d.size_number_id";

			$ex_fac_level=sql_select("select ex_factory  from variable_settings_production where company_name in(select a.company_name from  wo_po_details_master a,wo_po_break_down b where a.job_no=b.job_no_mst and a.job_no='$job_no' and b.status_active in(1,2,3)) and variable_list=1");
			if($ex_fac_level[0][csf("ex_factory")]==1)
			{
				$sql_colsiz="SELECT
				sum(CASE WHEN entry_form!=85 THEN  ex_factory_qnty ELSE 0 END)-sum(CASE WHEN entry_form=85 THEN  ex_factory_qnty ELSE 0 END) as production_qnty
				from pro_ex_factory_mst
				where po_break_down_id in($po_break_down_id) and status_active=1 and is_deleted=0";
			}
		}
		else if($prod_popup_type==11)
		{
			$sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as production_qnty,a.serving_company,a.sewing_line
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_color_size_breakdown e
			where a.id=b.mst_id    and e.id=b.color_size_break_down_id    and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type'  and a.po_break_down_id in($po_break_down_id) and e.color_number_id=$color_id and a.production_source=$prod_popup_lelel_type and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and e.status_active=1 and e.is_deleted=0 group by e.color_number_id,e.size_number_id , b.color_size_break_down_id,a.serving_company,a.sewing_line order by a.serving_company";
		}
		else if($prod_popup_type==17)
		{
  			$sql_colsiz="SELECT b.color_id  as color_number_id,c.size_id as size_number_id ,sum(c.size_qty ) as production_qnty,a.working_company_id as serving_company  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.job_no='$job_no' and b.color_id=$color_id and (c.order_id in($po_break_down_id) or b.order_id in($po_break_down_id))  group by b.color_id,c.size_id,a.working_company_id order by a.working_company_id";


			foreach(sql_select($sql_colsiz) as $vals)
			{
				$col_size_wise_lay[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];
				if($vals[csf("serving_company")])
				{
					$col_size_wise_lay_company[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]] =$vals[csf("serving_company")];

					$allcolor_id_arr_dtls[$vals[csf("serving_company")]][$vals[csf("color_number_id")]]=$vals[csf("color_number_id")];
					$col_size_wise_lay_company_qnty[$vals[csf("serving_company")]][$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];

				}


			}
		}
  		else if($prod_popup_type==7)
		{
			$sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as
			production_qnty,a.serving_company
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.job_no=e.job_no_mst and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id and c.job_no='$job_no'  and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type' and a.po_break_down_id in($po_break_down_id) and a.color_number_id=$color_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by e.color_number_id,e.size_number_id ,b.color_size_break_down_id,a.serving_company order by a.serving_company";
		}
  		else if($prod_popup_type==6)
		{
			$sql_colsiz="SELECT e.color_number_id,c.job_no, sum(b.reject_qty) as production_qnty,a.serving_company,a.sewing_line,b.color_size_break_down_id
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.job_no=e.job_no_mst and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type in(1,3,5,7,8,11) and b.production_type in(1,3,5,7,8,11) and a.po_break_down_id in($po_break_down_id) and e.color_number_id=$color_id and c.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by e.color_number_id,c.job_no,a.serving_company,a.sewing_line,b.color_size_break_down_id order by a.serving_company";
		}
		else
		{
			$embel_con = "";
			$source_cond = "";
			if($prod_popup_type==2 && $prod_popup_lelel_type !="" || $prod_popup_type==3 && $prod_popup_lelel_type !="" || $prod_popup_type==4 && $prod_popup_lelel_type !="" || $prod_popup_type==5 && $prod_popup_lelel_type !="")
				{ $source_cond = "and a.production_source=$prod_popup_lelel_type";}
			if($prod_popup_type==2 || $prod_popup_type==3){$embel_con=" and a.embel_name=$prod_popup_lelel_cat";}
			// $source_cond = ($prod_popup_type==1 && $prod_popup_lelel_type !="") ? "" : "and a.production_source=$prod_popup_lelel_type";
			$sql_colsiz="SELECT e.color_number_id,c.job_no, sum(b.production_qnty) as production_qnty,b.color_size_break_down_id,a.serving_company,a.sewing_line
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.job_no=e.job_no_mst and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type='$prod_popup_type' $source_cond $embel_con and b.production_type='$prod_popup_type' and a.po_break_down_id in($po_break_down_id) and e.color_number_id=$color_id and c.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by b.color_size_break_down_id,e.color_number_id,c.job_no,a.serving_company,a.sewing_line order by a.serving_company";
		}
		//echo $sql_colsiz;
		$sql_color_size=sql_select($sql_colsiz);
		// print_r($sql_color_size);
		$prod_color_size_data=array();
		$prod_color_size_data_working_comp=array();
		$color_size_working_comp=array();
		$color_size_sewingLine=array();
		// print_r($sql_color_size);die();
		foreach($sql_color_size as $row)
		{
			if($prod_popup_type==11)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["size_number_id"]=$row[csf("size_number_id")];
				//$color_size_data[$row[csf("color_size_break_down_id")]]["serving_company"]=$row[csf("serving_company")];
				//$col_size_wise_company_arr[$row[csf("serving_company")]] =$row[csf("serving_company")];
			}
			if($prod_popup_type==10)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["size_number_id"]=$row[csf("size_number_id")];
			}
			if($prod_popup_type==7)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["size_number_id"]=$row[csf("size_number_id")];
			}
			$allcolor_id_arr_dtls[$row[csf("serving_company")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]]["color"]=$row[csf("color_number_id")];
			// print_r($allcolor_id_arr_dtls);
			if($color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=="")
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=$row[csf("sewing_line")];
			}
			else
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"].=','.$row[csf("sewing_line")];
			}

			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
			$prod_color_size_data_working_comp[$row[csf("serving_company")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
		}
		//print_r($color_size_sewingLine);
		//echo $prod_popup_type;
		if($prod_popup_type==8)
        {

			$transfer_info_sql="SELECT c.job_no_mst as job_no, c.po_break_down_id as po_id,c.color_number_id as colors ,sum( case when a.trans_type=5 and  b.trans_type=5  then b.production_qnty else 0 end) as transfer_in ,sum( case when a.trans_type=6 and  b.trans_type=6  then b.production_qnty else 0 end) as transfer_out,a.serving_company,a.sewing_line from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c where a.id=b.mst_id and b.color_size_break_down_id=c.id and   a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   and a.production_type=10 and b.production_type=10 and a.trans_type in(5,6)  and b.trans_type in(5,6) and a.po_break_down_id in($po_break_down_id) and c.color_number_id=$color_id group by c.job_no_mst, c.po_break_down_id  ,c.color_number_id,a.serving_company,a.sewing_line order by a.serving_company";
			// echo $transfer_info_sql;
			$transfer_info=sql_select($transfer_info_sql);
			foreach($transfer_info as $trans_val)
			{
				$transfer_info_arr[$trans_val[csf("job_no")]][$trans_val[csf("colors")]]['transfer_in']+=$trans_val[csf("transfer_in")];
				$transfer_info_arr[$trans_val[csf("job_no")]][$trans_val[csf("colors")]]['transfer_out']+=$trans_val[csf("transfer_out")];
			}
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>

		<? ob_start(); ?>
        <div style="width:<? echo $table_width+200; ?>px" align="left" id="details_reports">
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
            	<tr>
                	<th width colspan="2"></th>
                    <th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
                    <th colspan="<? if($prod_popup_type==8){echo "3";} ?>"></th>
                </tr>
                <tr>

                	<th width="30" >SL</th>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    if($prod_popup_type==8)
                    {
                    	?>
                    	<th width="100" >Transfer In</th>
                    	<th width="100" >Transfer Out</th>

                    	<?
                    }
                    ?>

                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? $sl=1; $sub_total_prod_poly_qntyy=array(); $sub_totals=0;
            	foreach($allcolor_id_arr as $inc=>$color_id_val)
            	{
            		if($color_id_val)
            		{
		            	?>
		                <tr>
		                 	<td align="center" valign="middle"><? echo $sl; ?></td>
		                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
		                    <?
							$total_prod_poly_qnty=0;
		                    foreach($sizearr_order as $size_id)
		                    {
		                    	if($prod_popup_type==17)
		                    	{
									$sub_total_prod_poly_qntyy[$size_id]+=$col_size_wise_lay[$color_id_val][$size_id];
									 ?>
		                    		<td align="right"><? echo number_format($col_size_wise_lay[$color_id_val][$size_id],0); $total_prod_poly_qnty+=$col_size_wise_lay[$color_id_val][$size_id] ; ?></td>
		                    		<?
		                		}
		                    	else
		                    	{
									$sub_total_prod_poly_qntyy[$size_id]+=$prod_color_size_data[$color_id_val][$size_id]["qty"];
		                        	?>
		                        	<td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["qty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["qty"]; ?></td>
		                        	<?
		                    	}
		                    }
		                    if($prod_popup_type==8)
		                    {
			                    ?>
			                    <td align="right"><? $trans_in=$transfer_info_arr[$job_no][$inc]['transfer_in']; echo number_format($trans_in,0); ?></td>
			                    <td align="right"><? $trans_out=$transfer_info_arr[$job_no][$inc]['transfer_out']; echo number_format($trans_out,0); ?></td>
			                    <?
		                	}
		               		?>
		                    <td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,2,'.',''); ?></td>
		                </tr>
		                <? $sub_totals+=$totals; $sl++;
          		    }
                }
                ?>
            </tbody>
             <tfoot>
            	<td align="right" colspan="2"><b>Total</b></td>
                <?
				foreach($sizearr_order as $size_id)
				{
				?>
					<td align="right"><? echo $sub_total_prod_poly_qntyy[$size_id]; ?></td>
				<?
				}
				if($prod_popup_type==8){
				?>
					<td colspan="2"></td>
				<?
				}
                ?>
                <td align="right"> <? echo number_format($sub_totals,2,'.',''); ?></td>
            </tfoot>
		</table>
    	</div>
        <div style="width:<? echo $table_width+200; ?>px" align="center" id="details_reports">
        <?
			$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
			$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
			$prod_reso_allocation=array();
		    $nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
			foreach($nameArray as $nameArrayRow)
			{
				$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
			}
		   // $prod_reso_allocation = $nameArray[0][csf('auto_update')];
		?>
        <strong>Details</strong>
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width+200; ?>">
            <thead>
            	<tr>
                	<th width colspan="<?  if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){ echo "4"; }else{echo "3";} ?>"></th>
                    <th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
                    <th colspan="<? if($prod_popup_type==8){echo "3";} ?>"></th>
                </tr>
                <tr>
                	<th width="30" >SL</th>
                  	<th width="200" >Working Company</th>
                    <?
                    if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
                    {
                    	?>
                    	<th width="100" >Line</th>
                    	<?
                    }
					?>
                    <th width="100" >Color Name</th> <!--$prod_popup_type-->
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    if($prod_popup_type==8)
                    {
                    	?>
                    	<th width="100" >Transfer In</th>
                    	<th width="100" >Transfer Out</th>

                    	<?
                    }
                    ?>

                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<?
            	$sl=1;
            	$sub_total_prod_poly_qnty=array();
            	$sub_totals=0;
            	$po_company=sql_select("SELECT a.company_name from wo_po_details_master a,wo_po_break_down b where a.job_no=b.job_no_mst and a.job_no='$job_no' and b.id in($po_break_down_id) and a.status_active=1 and b.status_active in(1,2,3)");
            	// echo "<pre>";
            	// print_r($allcolor_id_arr_dtls);
				//foreach($col_size_wise_company_arr as $dataRow){
				foreach($allcolor_id_arr_dtls as $company=>$company_data)
				{
				   	foreach($company_data as $colors=>$val)
				   	{
				   		if($colors)
				   		{
							?>
			                <tr>
			                	<td align="center" valign="middle"><? echo $sl; ?></td>
			                    <td align="center" valign="middle"><? if($company_library[$company]) echo $company_library[$company];  else echo $supplier_arr[$company ];
			                    if($prod_popup_type==10){ echo $company_library[$sql_res[0][csf('serving_company')]]; }

								?></td>
			                    <?
			                    if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
			                    {
			                    	?>
			                    	 <td align="center" valign="middle"><?
									if($prod_reso_allocation[$po_company[0][csf("company_name")]]["auto_update"]==1)
									{
										$serving_company_lines=explode(",",$color_size_sewingLine[$company]["sewing_line"]);
										$sewing_line_name = "";
										$line_duplicate_arr=array();
										foreach($serving_company_lines as $lines_id)
										{
											$sewing_line =  $resource_alocate_line[$lines_id];
											$sewing_line_arr = explode(",", $sewing_line);

											foreach ($sewing_line_arr as $line_id)
											{
												if($line_duplicate_arr[$line_id]=="")
												{
													$sewing_line_name.=$lineArr[$line_id]." ,";
													$line_duplicate_arr[$line_id]=$line_id;
												}
											}
										}
										$sewing_line_name = chop($sewing_line_name, ",");
										echo $sewing_line_name;

									}
									else
									{
										$sewing_line =  $color_size_sewingLine[$company]["sewing_line"];
										foreach(explode(",", $sewing_line) as $key=>$value)
										{
											$sewing_line_name.=$lineArr[$value]." ,";
										}
											$sewing_line_name = chop($sewing_line_name, ",");
									   		echo $sewing_line_name;
									}
									 ?></td>
			                    	<?
			                    }
								?>
			                    <td align="center" valign="middle"><? echo $color_Arr_library[$colors]; ?></td>
			                    <?
								$total_prod_poly_qnty=0;
			                    foreach($sizearr_order as $size_id)
			                    {

			                    	if($prod_popup_type==17)
			                    	{
										$sub_total_prod_poly_qnty[$size_id]+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
										?>
				                    	<td align="right"><?
										echo number_format($col_size_wise_lay_company_qnty[$company][$colors][$size_id],0);$total_prod_poly_qnty+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
										?></td>

			                    		<?
			                    	}
			                    	else
			                    	{
										$sub_total_prod_poly_qnty[$size_id]+=$prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"];
				                        ?>
				                        <td align="right"><? echo number_format($prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"],0); $total_prod_poly_qnty+=$prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"]; ?></td>
				                        <?
			                    	}
			                    }
			                    if($prod_popup_type==8)
			                    {
				                    ?>
				                    <td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$colors]['transfer_in']; echo number_format($trans_in,0); ?></td>
				                    <td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$colors]['transfer_out']; echo number_format($trans_out,0); ?></td>
				                    <?
			                	}
			               		?>
			                    <td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,0); ?></td>
			                </tr>
			                <?
			                $sub_totals+=$totals; $sl++;
		               	}
					}
				}
				?>
            </tbody>
            <tfoot>
            	<td align="right" colspan=" <? if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){echo "4";}else{echo "3";} ?>"><b>Total</b></td>
                <?
				foreach($sizearr_order as $size_id)
				{
				?>
					<td align="right"><? echo $sub_total_prod_poly_qnty[$size_id]; ?></td>
				<?
				}
				if($prod_popup_type==8){
				?>
					<td colspan="2"></td>
				<?
				}
                ?>
                <td align="right"> <? echo $sub_totals; ?></td>
            </tfoot>
		</table>
    	</div>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
		die;

	if($prod_popup_type==1 && $prod_popup_lelel_type==1) //for cutting
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
		group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name1</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4" align="center" valign="middle" ><? echo $color_Arr_library[$color_id]; ?></td>
                        <td >Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Qty.</td>
                        <?
						$total_color_size_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" ><? echo number_format($prod_color_size_data[$size_id],0); $total_color_size_qnty+=$prod_color_size_data[$size_id];  ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_color_size_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Balance.</td>
                        <?
						$total_cut_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" title="Cutting Qty-Plan Cut Qty."><? $cut_balance=($plan_order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($cut_balance,0); $total_cut_balance+=$cut_balance; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_cut_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
            <br />
    	</div>
    	<?

	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==1) //for emb print inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source=1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>

                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==2) //for emb print subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source<>1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==1) //for emb print inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source=1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==2) //for emb print subcontract receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source<>1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==2) //for emb ebroidery subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==2) //for emb ebroidery subcon receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] =$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==4) //for emb sp issue
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
		where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=2 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.size_number_id
		order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}
		$table_width=(200+count($table_width)*60);
		?>
		<div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0);?></td>
						<?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Plan Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0);
						?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Balance</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=($prod_color_size_data[$size_id]-($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						 echo number_format($print_sent_balence,0);
						?>
                         </td>
                        <?
                    }
                    ?>
                </tr>
            </tbody>
		</table>
		</div>
    	<?*/
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==4) //for emb sp receive
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
		where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=3 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.size_number_id
		order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}*/
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==1) //for sewing input
	{

		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Plan Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_plan_qnty=0;

                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
						$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Input Qty.</td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Input Qty.</td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Balance</td>
                    <?
					$total_prod_in_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==11) //for sewing input inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==13) //for sewing input subcon
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==1) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Plan Output Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_out_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input);
						$sewing_out_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_out_plan_cut,0); $total_sew_out_plan_qnty+=$sewing_out_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_out_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Output Qty.</td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Output Qty.</td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Output Balance</td>
                    <?
					$total_out_balance_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_out_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_out_balance,0); $total_out_balance_qnty+=$total_out_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_out_balance_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==11) //for emb sewing output Inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==13) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==3) //for emb wash issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=3 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Plan Qty</td>
                    <?
					$total_emp_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_emp_plan_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_emp_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Qty.</td>
                    <?
					$total_prod_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_sent_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent  Balance</td>
                    <?
					$total_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==3) //for emb wash receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=3 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Plan Qty.</td>
                    <?
					$total_plan_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_wash_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Qty.</td>
                    <?
					$total_prod_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_wash_qnty+=$prod_color_size_data[$size_id]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Balance</td>
                    <?
					$taoal_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $taoal_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($taoal_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==7 && $prod_popup_lelel_type==1) //for iron
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=7 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Plan Qty</td>
                    <?
					$toal_plan_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $toal_plan_iron_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_plan_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Qty.</td>
                    <?
					$total_prod_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_iron_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Balance</td>
                    <?
					$total_iron_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_iron_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_iron_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==8 && $prod_popup_lelel_type==1) //for finish
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=8 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Plan Qty.</td>
                    <?
					$total_plan_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash+$gmts_finishing;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_finish_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Qty.</td>
                    <?
					$total_prod_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_finish_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton  Balance</td>
                    <?
					$toal_finash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $toal_finash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_finash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==10 && $prod_popup_lelel_type==1) //for garments Delivery
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
		from pro_ex_factory_mst a,  pro_ex_factory_dtls b
		where a.id=b.mst_id and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="3" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                </tr>

                <tr>
                    <td>Garments Delivery Qty.</td>
                    <?
					$total_delivery_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id],0); $total_delivery_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Gmts Deliv. Balance</td>
                    <?
					$total_delivery_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? $delivery_balance=($order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($delivery_balance,0); $total_delivery_balance+=$delivery_balance;?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==11) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		if($prod_popup_lelel_type=="") $prod_source_cond='';
		else
		{
			$prod_source_cond=$prod_popup_lelel_type;
		}

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
		from pro_garments_production_mst a, pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qnty"]+=$row[csf('poly_qnty')];
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? foreach($allcolor_id_arr as $inc=>$color_id_val) { ?>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["poly_qnty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["poly_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_poly_qnty,0); ?></td>
                </tr>
                <? } ?>
            </tbody>
		</table>
    	</div>
    	<?
	}
	exit();
}

?>