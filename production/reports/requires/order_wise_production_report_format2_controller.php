<?php
session_start();
if( $_SESSION['logic_erp']['user_id'] == "" ) header("location:login.php");

require_once('../../../includes/common.php');
$data=$_REQUEST['data'];
$action=$_REQUEST['action'];
$user_id=$_SESSION['logic_erp']['user_id'];
// echo file_exists("../../../ext_resource/excel/excel/vendor/autoload.php");
require_once("../../../ext_resource/excel/excel/vendor/autoload.php");
use PhpOffice\PhpSpreadsheet\Spreadsheet;
use PhpOffice\PhpSpreadsheet\IOFactory;

use PhpOffice\PhpSpreadsheet\Writer\Xlsx;
use PhpOffice\PhpSpreadsheet\Style\Border;
use PhpOffice\PhpSpreadsheet\Style\Color;
// $order_status = array(1 => "Confirmed", 2 => "Projected");


function get_order_info($po_id)
{
	$buyerArr=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
	$itemArray = return_library_array("select id,item_name from  lib_garment_item where status_active=1 and is_deleted=0 order by item_name", "id", "item_name");
	$orderResult = sql_select("SELECT A.ID, A.BUYER_NAME, A.JOB_NO, A.STYLE_REF_NO, B.PO_NUMBER, B.GROUPING, B.SHIPMENT_DATE, C.ITEM_NUMBER_ID,B.PO_QUANTITY
		FROM
			wo_po_details_master 		a,
			wo_po_break_down 			b,
			wo_po_color_size_breakdown 	c
		WHERE a.id=b.job_id and b.id=$po_id and
			a.id=c.job_id and b.id=c.po_break_down_id and
			a.status_active=1 and a.is_deleted=0 and
			b.status_active=1 and b.is_deleted=0 AND
			c.status_active=1 and c.is_deleted=0
			");
	$orderDataArray = array();
	foreach($orderResult as $ord){
		$orderDataArray[$ord['ID']]['BUYER_NAME']		= $ord['BUYER_NAME'];
		$orderDataArray[$ord['ID']]['JOB_NO']			= $ord['JOB_NO'];
		$orderDataArray[$ord['ID']]['STYLE_REF_NO']		= $ord['STYLE_REF_NO'];
		$orderDataArray[$ord['ID']]['PO_NUMBER']		= $ord['PO_NUMBER'];
		$orderDataArray[$ord['ID']]['GROUPING']			= $ord['GROUPING'];
		$orderDataArray[$ord['ID']]['SHIPMENT_DATE']	= $ord['SHIPMENT_DATE'];
		$orderDataArray[$ord['ID']]['ITEM_NUMBER_ID']	= $ord['ITEM_NUMBER_ID'];
		$orderDataArray[$ord['ID']]['PO_QUANTITY']		= $ord['PO_QUANTITY'];
	}
	$table ="<table cellpadding='0' cellspacing='0' border='1' class='rpt_table' rules='all' width='800'>
				<thead>
					<tr>
						<th width='100' >Buyer</th>
						<th width='100' >Job Number</th>
						<th width='100' >Style Name</th>
						<th width='100' >Order Number</th>
						<th width='100' >Internal Ref.</th>
						<th width='100' >Ship Date</th>
						<th width='100' >Item Name</th>
						<th width='100' >Order Qty</th>
					</tr>
				</thead>
				<tbody>";
	foreach($orderDataArray as $ordData){
		$table .= "<tr>
					<td width='100' >".$buyerArr[$ordData['BUYER_NAME']]."</td>
					<td width='100' >".$ordData['JOB_NO']."</td>
					<td width='100' >".$ordData['STYLE_REF_NO']."</td>
					<td width='100' >".$ordData['PO_NUMBER']."</td>
					<td width='100' >".$ordData['GROUPING']."</td>
					<td width='100' >".$ordData['SHIPMENT_DATE']."</td>
					<td width='100' >".$itemArray[$ordData['ITEM_NUMBER_ID']]."</td>
					<td width='100' >".$ordData['PO_QUANTITY']."</td>
				</tr>";
	}

	$table .="</tbody>
			</table>";

	return $table;
}
//--------------------------------------------------------------------------------------------------------------------
if($action=="load_report_format")
{
	$print_report_format=return_field_value("format_id","lib_report_template","template_name ='".$data."' and module_id=7 and report_id in(40) and is_deleted=0 and status_active=1");
		//echo "document.getElementById('report_ids').value = '".$print_report_format."';\n";
		//echo "print_report_button_setting('".$print_report_format."');\n";
	echo trim($print_report_format);
	exit();

}

if ($action=="load_drop_down_location")
{
	echo create_drop_down( "cbo_location", 120, "select id,location_name from lib_location where status_active =1 and is_deleted=0 and company_id='$data' order by location_name","id,location_name", 1, "-- Select --", $selected, "load_drop_down( 'requires/order_wise_production_report_format2_controller', this.value, 'load_drop_down_floor', 'floor_td' );",0 );
	exit();
}

if ($action=="load_drop_down_floor")
{
	echo create_drop_down( "cbo_floor", 110, "select id,floor_name from lib_prod_floor where status_active =1 and is_deleted=0 and location_id='$data' order by floor_name","id,floor_name", 1, "-- Select --", $selected, "",0 );
	exit();
}

if ($action=="load_drop_down_buyer")
{
	echo create_drop_down( "cbo_buyer_name", 120, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$data' and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90)) $buyer_cond order by buyer_name","id,buyer_name", 1, "-- Select --", $selected, "load_drop_down( 'requires/order_wise_production_report_format2_controller', this.value, 'load_drop_down_season', 'season_td');");
	exit();
}
if ($action=="load_drop_down_season")
{
	echo create_drop_down( "cbo_season_id", 70, "select id, season_name from lib_buyer_season where buyer_id='$data' and status_active =1 and is_deleted=0 order by season_name ASC","id,season_name", 1, "-- Select Season--", "", "" );
	exit();
}
//style search------------------------------//
if($action=="style_refarence_surch")
{
	extract($_REQUEST);
	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode);
	//echo $style_id;die;

	?>
    <script>

		var selected_id = new Array;
		var selected_name = new Array;
		var selected_no = new Array;
    	function check_all_data()
		{
			var tbl_row_count = document.getElementById( 'list_view' ).rows.length;
			tbl_row_count = tbl_row_count - 0;
			for( var i = 1; i <= tbl_row_count; i++ )
			{
				var onclickString = $('#tr_' + i).attr('onclick');
				var paramArr = onclickString.split("'");
				var functionParam = paramArr[1];
				js_set_value( functionParam );

			}
		}

		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function js_set_value( strCon )
		{
			//alert(strCon);
				var splitSTR = strCon.split("_");
				var str = splitSTR[0];
				var selectID = splitSTR[1];
				var selectDESC = splitSTR[2];
				//$('#txt_individual_id' + str).val(splitSTR[1]);
				//$('#txt_individual' + str).val('"'+splitSTR[2]+'"');

				toggle( document.getElementById( 'tr_' + str), '#FFFFCC' );

				if( jQuery.inArray( selectID, selected_id ) == -1 ) {
					selected_id.push( selectID );
					selected_name.push( selectDESC );
					selected_no.push( str );
				}
				else {
					for( var i = 0; i < selected_id.length; i++ ) {
						if( selected_id[i] == selectID ) break;
					}
					selected_id.splice( i, 1 );
					selected_name.splice( i, 1 );
					selected_no.splice( i, 1 );
				}
				var id = ''; var name = ''; var job = ''; var num='';
				for( var i = 0; i < selected_id.length; i++ ) {
					id += selected_id[i] + ',';
					name += selected_name[i] + ',';
					num += selected_no[i] + ',';
				}
				id 		= id.substr( 0, id.length - 1 );
				name 	= name.substr( 0, name.length - 1 );
				num 	= num.substr( 0, num.length - 1 );
				//alert(num);
				$('#txt_selected_id').val( id );
				$('#txt_selected').val( name );
				$('#txt_selected_no').val( num );
		}

		/*function js_set_value( str ) { //alert(str);
		toggle( document.getElementById( 'search' + str ), '#FFFFCC' );

		if( jQuery.inArray( $('#txt_serial_id' + str).val(), selected_id ) == -1 ) {
			selected_id.push( $('#txt_serial_id' + str).val() );
			selected_no.push( $('#txt_serial_no' + str).val() );
 		}




		else {
			for( var i = 0; i < selected_id.length; i++ ) {
				if( selected_id[i] == $('#txt_serial_id' + str).val() ) break;
			}
			selected_id.splice( i, 1 );
			selected_no.splice( i, 1 );
		}
		var id = '';	var no = '';
		for( var i = 0; i < selected_id.length; i++ ) {
			id += selected_id[i] + ',';
			no += selected_no[i] + ',';
		}
		id = id.substr( 0, id.length - 1 );
		no = no.substr( 0, no.length - 1 );
  		$('#txt_string_id').val( id );
		$('#txt_string_no').val( no );
	}

	function fn_onClosed()
	{
		var txt_string = $('#txt_string').val();
		if(txt_string==""){ alert("Please Select The Serial"); return;}
		parent.emailwindow.hide();
	}*/

    </script>
    <?
	$buyer=str_replace("'","",$buyer);
	$company=str_replace("'","",$company);
	$job_year=str_replace("'","",$job_year);
	if($buyer!=0) $buyer_cond=" and a.buyer_name=$buyer"; else $buyer_cond="";
	if($db_type==0)
	{
		if($job_year!=0) $job_year_cond=" and year(a.insert_date)=$job_year"; else $job_year_cond="";
		$select_date=" year(a.insert_date)";
	}
	else if($db_type==2)
	{
		if($job_year!=0) $job_year_cond=" and to_char(a.insert_date,'YYYY')=$job_year"; else $job_year_cond="";
		$select_date=" to_char(a.insert_date,'YYYY')";
	}

	$sql = "select a.id,a.style_ref_no,a.job_no,a.job_no_prefix_num,$select_date as year from wo_po_details_master a where a.company_name=$company $buyer_cond  $job_year_cond and is_deleted=0 order by job_no_prefix_num";
	//echo $sql; die;
	echo create_list_view("list_view", "Style Ref No,Job No,Year","160,90,100","400","310",0, $sql , "js_set_value", "id,job_no_prefix_num", "", 1, "0", $arr, "style_ref_no,job_no_prefix_num,year", "","setFilterGrid('list_view',-1)","0","",1) ;
	echo "<input type='hidden' id='txt_selected_id' />";
	echo "<input type='hidden' id='txt_selected' />";
	echo "<input type='hidden' id='txt_selected_no' />";

	?>
    <script language="javascript" type="text/javascript">
	var style_no='<? echo $txt_style_ref_no;?>';
	var style_id='<? echo $txt_style_ref_id;?>';
	var style_des='<? echo $txt_style_ref;?>';
	//alert(style_id);
	if(style_no!="")
	{
		style_no_arr=style_no.split(",");
		style_id_arr=style_id.split(",");
		style_des_arr=style_des.split(",");
		var str_ref="";
		for(var k=0;k<style_no_arr.length; k++)
		{
			str_ref=style_no_arr[k]+'_'+style_id_arr[k]+'_'+style_des_arr[k];
			js_set_value(str_ref);
		}
	}
	</script>

    <?

	exit();
}


//order search------------------------------//
if($action=="order_surch")
{
	extract($_REQUEST);
	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode);
	?>
    <script>

		var selected_id = new Array;
		var selected_name = new Array;
		var selected_no = new Array;
    	function check_all_data() {
			var tbl_row_count = document.getElementById( 'list_view' ).rows.length;
			tbl_row_count = tbl_row_count - 0;
			for( var i = 1; i <= tbl_row_count; i++ ) {
				var onclickString = $('#tr_' + i).attr('onclick');
				var paramArr = onclickString.split("'");
				var functionParam = paramArr[1];
				js_set_value( functionParam );

			}
		}

		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function js_set_value( strCon )
		{
			//alert(strCon);
				var splitSTR = strCon.split("_");
				var str_or = splitSTR[0];
				var selectID = splitSTR[1];
				var selectDESC = splitSTR[2];
				//$('#txt_individual_id' + str).val(splitSTR[1]);
				//$('#txt_individual' + str).val('"'+splitSTR[2]+'"');

				toggle( document.getElementById( 'tr_' + str_or ), '#FFFFCC' );

				if( jQuery.inArray( selectID, selected_id ) == -1 ) {
					selected_id.push( selectID );
					selected_name.push( selectDESC );
					selected_no.push( str_or );
				}
				else {
					for( var i = 0; i < selected_id.length; i++ ) {
						if( selected_id[i] == selectID ) break;
					}
					selected_id.splice( i, 1 );
					selected_name.splice( i, 1 );
					selected_no.splice( i, 1 );
				}
				var id = ''; var name = ''; var job = ''; var num='';
				for( var i = 0; i < selected_id.length; i++ ) {
					id += selected_id[i] + ',';
					name += selected_name[i] + ',';
					num += selected_no[i] + ',';
				}
				id 		= id.substr( 0, id.length - 1 );
				name 	= name.substr( 0, name.length - 1 );
				num 	= num.substr( 0, num.length - 1 );
				//alert(num);
				$('#txt_selected_id').val( id );
				$('#txt_selected').val( name );
				$('#txt_selected_no').val( num );
		}
    </script>
    <?
	$buyer=str_replace("'","",$buyer);
	$company=str_replace("'","",$company);
	$job_year=str_replace("'","",$job_year);
	$txt_style_ref_id=str_replace("'","",$txt_style_ref_id);

	if($buyer!=0) $buyer_cond="and b.buyer_name=$buyer"; else $buyer_cond="";
	if($db_type==0)
	{
		if($job_year!=0) $job_year_cond=" and year(b.insert_date)=$job_year"; else $job_year_cond="";
		$select_date=" year(b.insert_date)";
	}
	else if($db_type==2)
	{
		if($job_year!=0) $job_year_cond=" and to_char(b.insert_date,'YYYY')=$job_year"; else $job_year_cond="";
		$select_date=" to_char(b.insert_date,'YYYY')";
	}
	if($txt_style_ref_id!="") $style_cond=" and b.id in($txt_style_ref_id)"; else $style_cond="";
	$sql = "select a.id,a.po_number,a.job_no_mst,b.style_ref_no,b.job_no_prefix_num,$select_date as year from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no and b.company_name=$company $buyer_cond $job_year_cond  $style_cond and a.status_active in(1,2,3) and b.status_active=1";
	//echo $sql; die;
	echo create_list_view("list_view", "Order NO,Job No,Year,Style Ref No","150,80,70,150","500","310",0, $sql , "js_set_value", "id,po_number", "", 1, "0", $arr, "po_number,job_no_prefix_num,year,style_ref_no", "","setFilterGrid('list_view',-1)","0","",1) ;
	echo "<input type='hidden' id='txt_selected_id' />";
	echo "<input type='hidden' id='txt_selected' />";
	echo "<input type='hidden' id='txt_selected_no' />";

	?>
    <script language="javascript" type="text/javascript">
	var style_no='<? echo $txt_order_id_no;?>';
	var style_id='<? echo $txt_order_id;?>';
	var style_des='<? echo $txt_order;?>';
	//alert(style_id);
	if(style_no!="")
	{
		style_no_arr=style_no.split(",");
		style_id_arr=style_id.split(",");
		style_des_arr=style_des.split(",");
		var str_ref="";
		for(var k=0;k<style_no_arr.length; k++)
		{
			str_ref=style_no_arr[k]+'_'+style_id_arr[k]+'_'+style_des_arr[k];
			js_set_value(str_ref);
		}
	}
	</script>

    <?
	exit();
}

$color_Arr_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" );
$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name"  );
$buyer_short_library=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
//$po_no_library=return_library_array( "select id,po_number from wo_po_break_down", "id", "po_number"  );

if($action=="report_generate_excel")
{

	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_buyer_name=str_replace("'","",$cbo_buyer_name);
	$cbo_season_id=str_replace("'","",$cbo_season_id);
	$cbo_location=str_replace("'","",$cbo_location);
	$cbo_floor=str_replace("'","",$cbo_floor);
	$txt_date_from=str_replace("'","",$txt_date_from);
	$txt_date_to=str_replace("'","",$txt_date_to);
	$cbo_job_year=str_replace("'","",$cbo_job_year);
	$txt_style_ref=str_replace("'","",$txt_style_ref);
	$txt_style_ref_id=str_replace("'","",$txt_style_ref_id);
	$txt_order_no=str_replace("'","",$txt_order);
	$txt_order_id=str_replace("'","",$txt_order_id);
	$shipping_status=str_replace("'","",$shipping_status);
	$orderStatus=str_replace("'","",$orderStatus);
	$txt_style_ref_number=str_replace("'","",$txt_style_ref_number);
	$cbo_style_owner_wise_status=str_replace("'","",$cbo_style_owner_wise_status);
	$active_status=str_replace("'", "", $active_status);
	$active_cond="";
	$active_cond_c="";
	$active_cond_a_d="";
	$active_cond_d="";
	$active_cond_b="";
	$active_cond_e_f="";
	$order_status_cond="";
	// 0 For Active Status -> Active
	// 1 For Active Status -> All
	if($active_status == 0) $active_cond 		= " and b.status_active=1 and c.status_active=1 ";
	if($active_status == 0) $active_cond_a_d 	= " and a.status_active=1 and d.status_active=1 ";
	if($active_status == 0) $active_cond_e_f 	= " and e.status_active=1 and f.status_active=1 ";
	if($active_status == 0) $active_cond_c 		= "  and c.status_active=1 ";
	if($active_status == 0) $active_cond_d 		= "  and d.status_active=1 ";
	if($active_status == 0) $active_cond_b 		= "  and b.status_active=1 ";
	if($orderStatus)  $order_status_cond 	= "  and b.is_confirmed=$orderStatus ";

	$txt_order_number=str_replace("'","",$txt_order);
	$txt_order_number=trim($txt_order_number);
	$txt_order_number = "'".implode("','", explode(",", $txt_order_number))."'";

	if($txt_order_id=="")
	{
		$txt_order_number_expl=explode(",",$txt_order_number);
		$poDatas="";
		foreach($txt_order_number_expl as $poData)
		{
			$poDatas.=$poData.",";
		}
		$poNumbers=chop($poDatas,",");

		if($txt_order_number!="")
		{
			$str_poNumbers_cond =" and b.po_number in($poNumbers)";
		}
		else
		{
			$str_poNumbers_cond = "";
		}
		//echo $str_poNumbers_cond;
		//echo $txt_order_number;
	}

	//$internal_ref_cond=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active=1 and is_deleted=0) ";
	$country_id=str_replace("'","",$country_id);
	//$template_id_arr=return_library_array("select po_number_id, template_id from tna_process_mst group by po_number_id, template_id","po_number_id","template_id");

	if($txt_date_from!="" && $txt_date_to!="")
	{
		if($db_type==0)
		{
			$txt_datefrom=change_date_format($txt_date_from,'yyyy-mm-dd');
			$txt_dateto=change_date_format($txt_date_to,'yyyy-mm-dd');
		}
		else if($db_type==2)
		{
			$txt_datefrom=change_date_format($txt_date_from,'','',-1);
			$txt_dateto=change_date_format($txt_date_to,'','',-1);
		}
	}
	//if($txt_style_ref_number=="") $txt_style_ref_number_cond=''; else $txt_style_ref_number_cond=" and a.style_ref_no like ".$txt_style_ref_number."";
	if ($txt_style_ref_number!="")
	{
		$txt_style_ref_number_cond="and a.style_ref_no like '%$txt_style_ref_number%'";
	}
	else
	{
		$txt_style_ref_number_cond="";
	}
	$report_data = "";

	if($type==1) //  order wise excel convert
	{
		// echo $type.'kausar'; die;
		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}
		//if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_season_id!=0) $str_po_cond.=" and a.season_buyer_wise=$cbo_season_id";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}

		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and c.po_break_down_id in (SELECT id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";

		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";
		$order_sql="SELECT  a.id as job_id,b.id, a.job_no_prefix_num,a.job_no, $select_job_year, b.po_number, b.po_quantity, b.unit_price, b.po_total_price, b.job_no_mst, b.pub_shipment_date as shipment_date, b.is_confirmed, b.shiping_status, b.excess_cut, b.plan_cut, a.company_name, a.style_owner, a.buyer_name, a.set_break_down, a.style_ref_no,a.client_id,a.total_set_qnty,b.pack_handover_date,a.set_smv
		from wo_po_details_master a, wo_po_break_down b
		where a.id=b.job_id and a.status_active=1 and a.is_deleted=0 $active_cond_b and b.is_deleted=0 $str_po_cond $txt_style_ref_number_cond $internal_ref_cond_po $order_status_cond
		order by b.pub_shipment_date, b.id";



		$sql_po_result=sql_select($order_sql);
		if(count($sql_po_result)<1)
		{
			echo "<div style='color:red;text-align:center;font-weight:bold;'>Data not found!</div>";
			die;
		}
		$all_po_id=""; $all_po_id_arr=array(); $all_dtls_mst_id_arr=array();
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("id")].",";
			$all_po_id_arr[$row[csf("id")]]=$row[csf("id")];

			$all_dtls_mst_id_arr[$row[csf("job_id")]]=$row[csf("job_id")];
			$all_style_arr[$row[csf('style_ref_no')]] = $row[csf('style_ref_no')];
			$style_wise_po_arr[$row[csf('style_ref_no')]][$row[csf('id')]] = $row[csf('id')];
		}
	    $all_po_id=chop($all_po_id,",");
		$all_dtl_mst_id=chop($all_dtl_mst_id,",");

	    $all_po_ids=implode(",", $all_po_id_arr);
		$all_dtl_mst_ids=implode(",", $all_dtls_mst_id_arr);

	    $all_po_ids_cond="";
 		if(count($all_po_id_arr)>0)
 		{
 			  if($db_type==2 && count($all_po_id_arr)>999)
			   {
			   		$chunk_arr=array_chunk($all_po_id_arr, 999);
			   		foreach($chunk_arr as $vals)
			   		{
			   			$po_ids=implode(",", $vals);
			   			if($all_po_ids_cond=="")
			   			{
			   				$all_po_ids_cond.=" and (c.order_id in ($po_ids)";
			   			}
			   			else
			   			{
			   				$all_po_ids_cond.=" or  c.order_id in ($po_ids)";
			   			}
			   		}
			   		$all_po_ids_cond.= " )";
			   }
			   else
			   {
			   		$all_po_ids_cond= " and c.order_id in($all_po_ids) ";
			   }

 		}


		//=================================== Delete data From TEMP ENGINE ====================================
		$con = connect();
		execute_query("DELETE from gbl_temp_engine where user_id=$user_id and entry_form = 21 and ref_from in(7,8)");
		oci_commit($con);
		//=================================== Insert data into TEMP ENGINE ====================================
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 21, 7,$all_po_id_arr, $empty_arr);
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 21, 8,$all_dtls_mst_id_arr, $empty_arr); // job id
		oci_commit($con);

		$smv_source=return_field_value("smv_source","variable_settings_production","company_name=$cbo_company_name and variable_list=25 and   status_active=1 and is_deleted=0");
		if($smv_source==3) // from gsd enrty
		{
			$style_cond = where_con_using_array($all_style_arr,1,"a.style_ref");
			if($txt_datefrom!="" &&  $txt_dateto!="")  $str_app_date_cond .=" and a.APPLICABLE_PERIOD <= '$txt_dateto'";
			// $style_nos="'".implode("','",$all_style_arr)."'";
			$sql_item="SELECT a.id,a.APPLICABLE_PERIOD,a.BULLETIN_TYPE,A.TOTAL_SMV,A.STYLE_REF,a.GMTS_ITEM_ID  from PPL_GSD_ENTRY_MST a where  a.bulletin_type=4 and  A.IS_DELETED=0 and A.STATUS_ACTIVE=1 $style_cond  $str_app_date_cond group by a.id,a.APPLICABLE_PERIOD,a.BULLETIN_TYPE,A.TOTAL_SMV,A.STYLE_REF,a.GMTS_ITEM_ID ORDER BY a.GMTS_ITEM_ID ,a.APPLICABLE_PERIOD  DESC , a.id DESC";//and a.APPROVED=1
			$gsdSqlResult=sql_select($sql_item); //a.bulletin_type=4 (ONLY PRODUCTION BULLETIN)
			// echo $sql_item;die;

			foreach($gsdSqlResult as $rows)
			{
				// echo $rows['STYLE_REF']."<br>";
				foreach($style_wise_po_arr[$rows['STYLE_REF']] as $po_id)
				{
					if($item_smv_array[$po_id][$rows['GMTS_ITEM_ID']]=='')
					{
						$item_smv_array[$po_id][$rows['GMTS_ITEM_ID']] = $rows['TOTAL_SMV'];
					}
				}
			}
		}
		else
		{
			$sql_item="SELECT b.id, c.gmts_item_id, c.set_item_ratio, c.smv_pcs, c.smv_pcs_precost,c.smv_set from wo_po_break_down b, wo_po_details_mas_set_details c, gbl_temp_engine tmp where  b.job_id=c.job_id and b.id=tmp.ref_val  and tmp.entry_form=21 and tmp.ref_from=7 and tmp.user_id=$user_id and a.company_name=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1";
			// echo $sql_item;
			$resultItem=sql_select($sql_item);

			foreach($resultItem as $itemData)
			{
				if($smv_source==1)
				{
					$item_smv_array[$itemData[csf('id')]][$itemData[csf('gmts_item_id')]]=$itemData[csf('smv_pcs')];
				}
				if($smv_source==2)
				{
					$item_smv_array[$itemData[csf('id')]][$itemData[csf('gmts_item_id')]]=$itemData[csf('smv_pcs_precost')];
				}
			}
		}

		/* $smv_sql = "SELECT gmts_item_id, smv_pcs from wo_po_details_mas_set_details a,gbl_temp_engine tmp where  a.job_id=tmp.ref_val and a.status_active=1 and a.is_deleted=0 and tmp.entry_form=21 and tmp.ref_from=8 and tmp.user_id=$user_id";
		$smv_sql_result=sql_select($smv_sql);
		$smv_arr=array();
		foreach($smv_sql_result as $row)
		{
			$smv_arr[$row[csf("gmts_item_id")]]['smv_pcs']=$row[csf("smv_pcs")];
		} */
		// echo "<pre>"; print_r($item_smv_array); die;


 		// ================================= FINISH FABRIC RECEIVE =====================================
		$fin_rcv_sql = "SELECT a.item_id,a.fin_receive_qnty,a.po_break_down_id as po_id  from gmt_finishing_receive_dtls a,gbl_temp_engine tmp where a.po_break_down_id=tmp.ref_val and a.status_active=1 and a.is_deleted=0 and tmp.entry_form=21 and tmp.ref_from=7 and tmp.user_id=$user_id";
		// echo $fin_rcv_sql; die;
		$fin_rcv_sql_res=sql_select($fin_rcv_sql);
		$finishing_rcv_arr = array();
		$po_wise_fin_rcv_arr = array();
		foreach($fin_rcv_sql_res as $v)
		{
			$finishing_rcv_arr[$v["PO_ID"]][$v["ITEM_ID"]]['receive_qnty'] += $v['FIN_RECEIVE_QNTY'];
			$po_wise_fin_rcv_arr [$v["PO_ID"]] += $v['FIN_RECEIVE_QNTY'];
		}
		// echo "<pre>"; print_r($po_wise_fin_rcv_arr); die;

 		// ================================= GETTING ORDER QTY (ITEM WISE) =====================================
 		/* $order_qty_sql="SELECT b.id,c.item_number_id as item_id, SUM(c.order_quantity) as order_quantity
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where b.job_id=a.id and b.id=c.po_break_down_id and a.id=c.job_id and a.status_active=1 and a.is_deleted=0 $active_cond_b and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $order_status_cond $str_po_cond $txt_style_ref_number_cond $internal_ref_cond_po group by b.id,c.item_number_id"; */
		$order_qty_sql="SELECT c.po_break_down_id as po_id,c.item_number_id as item_id, c.order_quantity as order_quantity
		from  wo_po_color_size_breakdown c,gbl_temp_engine tmp
		where c.po_break_down_id=tmp.ref_val and tmp.entry_form=21 and tmp.ref_from=7 and tmp.user_id=$user_id and c.status_active=1";
		//   echo $order_qty_sql;die;
		$order_qty_sql_res = sql_select($order_qty_sql);
		$order_qty_array = array();
		foreach ($order_qty_sql_res as $val)
		{
			$order_qty_array[$val[csf('po_id')]][$val[csf('item_id')]] += $val[csf('order_quantity')];
		}
		// echo '<pre>';
        // print_r($order_qty_array);
		// echo '</pre>';
		// ================================ end order qnty ===============================================


 		$template_id_arr=return_library_array("SELECT a.po_number_id, a.template_id from tna_process_mst a,GBL_TEMP_ENGINE b where a.po_number_id =b.ref_val and b.entry_form=21 and b.ref_from=7 and b.user_id=$user_id group by a.po_number_id, a.template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and c.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(array_unique(explode(",",$all_po_id)),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (c.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or c.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}
			}
		}

		$ex_factory_arr=array();

		$ex_fac_level=sql_select("SELECT ex_factory  from variable_settings_production where company_name=$cbo_company_name and variable_list=1 and status_active=1");
		// if($ex_fac_level[0][csf("ex_factory")]==1)
		// {
			/* $ex_factory_data=sql_select("SELECT c.po_break_down_id , c.item_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN c.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN c.ex_factory_qnty ELSE 0 END) as ex_factory_qnty
			from pro_ex_factory_mst c,gbl_temp_engine tmp	where c.po_break_down_id=tmp.ref_val and tmp.entry_form=21 and tmp.ref_from=7 and tmp.user_id=$user_id  and  c.status_active=1 and c.is_deleted=0  group by c.po_break_down_id, c.item_number_id"); */
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , c.item_number_id, c.ex_factory_date AS ex_factory_date, c.total_carton_qnty as total_carton_qnty,
			(CASE WHEN c.entry_form!=85 THEN c.ex_factory_qnty ELSE 0 END)-(CASE WHEN c.entry_form=85 THEN c.ex_factory_qnty ELSE 0 END) as ex_factory_qnty
			from pro_ex_factory_mst c,gbl_temp_engine tmp	where c.po_break_down_id=tmp.ref_val and tmp.entry_form=21 and tmp.ref_from=7 and tmp.user_id=$user_id  and  c.status_active=1 and c.is_deleted=0 order by c.id");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}

		unset($ex_factory_data);


		$producttion_cond =" and c.po_break_down_id in($po_id)";
		$prod_sql= "SELECT c.po_break_down_id, c.item_number_id,c.production_type,c.embel_name,c.production_source,d.TRANS_TYPE,d.is_rescan, d.production_qnty,d.reject_qty,d.replace_qty,c.re_production_qty
		from pro_garments_production_dtls d , pro_garments_production_mst c,gbl_temp_engine tmp
		where d.mst_id=c.id and c.po_break_down_id=tmp.ref_val and tmp.entry_form=21 and tmp.ref_from=7 and tmp.user_id=$user_id and c.production_type in (1,2,3,4,5,7,8,10,11) and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0";
		// echo $prod_sql;die;


		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('production_type')]][$gmtsRow[csf('production_source')]][$gmtsRow[csf('embel_name')]]['qty'] += $gmtsRow[csf('production_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('production_type')]][$gmtsRow[csf('production_source')]][$gmtsRow[csf('embel_name')]]['reject_qty'] += $gmtsRow[csf('reject_qty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('production_type')]][$gmtsRow[csf('production_source')]][$gmtsRow[csf('embel_name')]]['replace_qty'] += $gmtsRow[csf('replace_qty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('production_type')]][$gmtsRow[csf('production_source')]][$gmtsRow[csf('embel_name')]]['re_prod_qty'] += $gmtsRow[csf('re_production_qty')];

			if($gmtsRow[csf('TRANS_TYPE')]==5 || $gmtsRow[csf('TRANS_TYPE')]==6)
			{
				$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('TRANS_TYPE')]]['qty'] += $gmtsRow[csf('production_qnty')];
			}

			if($gmtsRow[csf('production_type')]==5)
			{
				if($gmtsRow[csf('is_rescan')]==0)
				{
					$rej_qty = $gmtsRow[csf('reject_qty')];
				}
				if($gmtsRow[csf('is_rescan')]!=0)
				{
					$rej_qty2 = $gmtsRow[csf('production_qnty')];
				}

				$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['sew_rej_qty'] += $gmtsRow[csf('reject_qty')];
			}

		}

		$sql_carton_qty=sql_select("SELECT c.po_break_down_id,
		(case when c.production_type ='8' and c.production_source=1 then c.carton_qty else 0 end) as carton_qty_no_inhouse,
		(case when c.production_type ='8' and c.production_source=3 then c.carton_qty else 0 end) as carton_qty_no_outbound,
		(case when c.production_type ='8' then c.carton_qty else 0 end) as carton_total_qty
		from pro_garments_production_mst c,gbl_temp_engine tmp where c.po_break_down_id=tmp.ref_val and tmp.entry_form=21 and tmp.ref_from=7 and tmp.user_id=$user_id and c.status_active=1 and c.is_deleted=0 ");


		/* $sql = "SELECT a.PO_BREAK_DOWN_ID,a.ITEM_NUMBER_ID,b.PRODUCTION_QNTY,b.TRANS_TYPE from pro_garments_production_mst a,pro_garments_production_dtls b,GBL_TEMP_ENGINE c where a.id=b.mst_id and a.po_break_down_id=c.ref_val and a.status_active=1 and b.status_active=1 and b.TRANS_TYPE in(5,6) and c.entry_form=21 and c.ref_from=7 and c.user_id=$user_id";
		// echo $sql;
		$res = sql_select($sql);
		$po_transfer_arr = array();
		foreach ($res as $val)
		{
			$po_transfer_arr[$val['PO_BREAK_DOWN_ID']][$val['ITEM_NUMBER_ID']][$val['TRANS_TYPE']] += $val['PRODUCTION_QNTY']	;
		} */

		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  	$carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_inhouse"]+=$crtn[csf("carton_qty_no_inhouse")];
		  	$carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_outbound"]+=$crtn[csf("carton_qty_no_outbound")];
		  	$carton_arr[$crtn[csf("po_break_down_id")]]["carton_total_qty"]+=$crtn[csf("carton_total_qty")];
		}
		// echo $prod_sql; die;

		// sub contract query start here
		if(str_replace("'", "",$txt_order)!="")
		{
			$str_po_cond_subcon="";
			$str_po_cond_subcon2="";
			if($txt_datefrom!="" &&  $txt_dateto!="") { $str_po_cond_subcon .=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'"; $str_po_cond_subcon2.=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'";}
			if(str_replace("'", "",$cbo_company_name)!=0)
			{
				//$str_po_cond_subcon.=" and b.company_id=$cbo_company_name";
				$str_po_cond_subcon2.=" and a.company_id=$cbo_company_name";
			}
			if(str_replace("'", "",$cbo_buyer_name)!=0) $str_po_cond_subcon.=" and b.party_id=$cbo_buyer_name";
			if(str_replace("'", "",$cbo_location)!=0) $str_po_cond_subcon.=" and b.location_id=$cbo_location";
			if(str_replace("'", "",$txt_style_ref)!="") $str_po_cond_subcon.=" and b.job_no_prefix_num=$txt_style_ref";
			if(str_replace("'", "",$txt_order)!="") $str_po_cond_subcon.=" and c.order_no=$txt_order";
			if($db_type==0) $select_job_year_subcon="year(b.insert_date) as job_year"; else $select_job_year_subcon="to_char(b.insert_date,'YYYY') as job_year";
			$sub_con_po_wise_qty_sql="SELECT c.id,sum(b.qnty) as order_quantity,sum(b.plan_cut) as plan_cut  from subcon_ord_mst a,  subcon_ord_dtls c,subcon_ord_breakdown b where c.status_active=1 and c.is_deleted=0 and c.id=b.order_id and c.job_no_mst=a.subcon_job and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 $str_po_cond_subcon2  group by  c.id";
			foreach(sql_select($sub_con_po_wise_qty_sql) as $key=>$vals)
			{
				$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"]=$vals[csf("order_quantity")];
				$sub_con_po_wise_qty_arr[$vals[csf("id")]]["plan"]=$vals[csf("plan_cut")];
			}

			$subcon_sql="SELECT c.id,b.company_id,b.party_id as buyer_name,c.order_no as po_number,b.subcon_job as job_no,b.job_no_prefix_num ,$select_job_year_subcon,c.cust_style_ref as style_ref_no,e.item_id as item_number_id,sum(e.qnty) as po_quantity,c.delivery_date as country_ship_date,sum(e.plan_cut) as plan_cut,sum(case when d.production_type=1 then d.prod_qnty else 0 end ) as cutting_qnty,sum(case when d.production_type=2 then d.prod_qnty else 0 end) as sewing_out,sum(case when d.production_type=3 then d.prod_qnty else 0 end) as iron_qnty,sum(case when d.production_type=5 then d.prod_qnty else 0 end) as poly_qnty,sum(case when d.production_type=4 then d.prod_qnty else 0 end) as finishing_qnty,c.cust_buyer
			FROM subcon_gmts_prod_dtls a,subcon_gmts_prod_col_sz d, subcon_ord_mst b, subcon_ord_dtls c ,subcon_ord_breakdown e
			WHERE a.id=d.dtls_id and a.order_id=c.id and c.job_no_mst=b.subcon_job and a.status_active=1 and a.is_deleted=0   and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and e.id=d.ord_color_size_id and e.order_id=c.id and a.order_id=e.order_id $str_po_cond_subcon
			group by c.id,b.company_id,b.party_id ,c.order_no ,b.subcon_job ,b.job_no_prefix_num ,b.insert_date,c.cust_style_ref ,e.item_id ,c.delivery_date,c.cust_buyer";
			// echo $subcon_sql;

			$subcon_ex_sql="SELECT b.party_id ,sum(y.delivery_qty) as qtys FROM subcon_delivery_mst x,subcon_delivery_dtls y,subcon_ord_mst b, subcon_ord_dtls c WHERE x.id=y.mst_id and x.status_active=1   and c.job_no_mst=b.subcon_job and c.id=y.order_id $str_po_cond_subcon and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  GROUP BY b.party_id";
			foreach(sql_select($subcon_ex_sql) as $rows)
			{
				$party_arr_ex[$rows[csf("party_id")]]+=$rows[csf("qtys")];
				//$party_arr_ex_ground["ex"]+=$rows[csf("qtys")];
			}

			$subcon_ex_date="SELECT y.order_id,max(x.delivery_date) as delivery_date ,sum(y.delivery_qty) as qtys FROM subcon_delivery_mst x,subcon_delivery_dtls y,subcon_ord_mst b,  subcon_ord_dtls c WHERE x.id=y.mst_id and x.status_active=1   and c.id=y.order_id $str_po_cond_subcon and c.status_active=1 and c.is_deleted=0    and c.job_no_mst=b.subcon_job  GROUP BY y.order_id";
			foreach(sql_select($subcon_ex_date) as $rows)
			{
				$subcon_ex_date_arr[$rows[csf("order_id")]]["qtys"]=$rows[csf("qtys")];
				$subcon_ex_date_arr[$rows[csf("order_id")]]["date"]=$rows[csf("delivery_date")];
			}

			//print_r($party_arr_ex);die;
			foreach(sql_select($subcon_sql) as $vals)
			{
				$party_arr[$vals[csf("buyer_name")]]["po_quantity"]+=$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"];
				$party_arr[$vals[csf("buyer_name")]]["cust_buyer"]=$vals[csf("cust_buyer")];
				$party_arr[$vals[csf("buyer_name")]]["cutting_qnty"]+=$vals[csf("cutting_qnty")];
				$party_arr[$vals[csf("buyer_name")]]["sewing_out"]+=$vals[csf("sewing_out")];
				$party_arr[$vals[csf("buyer_name")]]["iron_qnty"]+=$vals[csf("iron_qnty")];
				$party_arr[$vals[csf("buyer_name")]]["poly_qnty"]+=$vals[csf("poly_qnty")];
				$party_arr[$vals[csf("buyer_name")]]["finishing_qnty"]+=$vals[csf("finishing_qnty")];
				$party_ground_total["po_quantity"]+=$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"];
				$party_ground_total["cutting_qnty"]+=$vals[csf("cutting_qnty")];
				$party_ground_total["sewing_out"]+=$vals[csf("sewing_out")];
				$party_ground_total["iron_qnty"]+=$vals[csf("iron_qnty")];
				$party_ground_total["poly_qnty"]+=$vals[csf("poly_qnty")];
				$party_ground_total["finishing_qnty"]+=$vals[csf("finishing_qnty")];
				$party_arr_ex_ground["ex"]+=$party_arr_ex[$vals[csf("buyer_name")]];
			}
		}

		$subcon_buyer_html="";
		$subcon_html="";
		if(count(sql_select($subcon_sql))>0)
		{
			$i=1;
			$subcon_html.="<tr> <th colspan='56' align='left'> Sub-Contract Production</th> </tr>";
			foreach(sql_select($subcon_sql) as $key=>$orderRes)
			{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";


				$subcon_html.="<tr bgcolor='$bgcolor' onclick=change_color('tr33_2nd$i','$bgcolor') id=tr33_2nd$i>";
				$subcon_html.='<td width="30" align="left"><p>'.$i.'</p></td>
					<td width="100" align="left"><p>'. $company_library[$orderRes[csf("company_id")]].'</p></td>
					<td width="100" align="left"><p>'.$company_library[$orderRes[csf("company_id")]].'</p></td>
					<td width="130" align="left"><p>'.$orderRes[csf("po_number")].'</p></td>
					<td width="80" align="left"><p>'.$orderRes[csf("is_confirmed")].'</p></td>
					<td width="60" align="left"><p>'.$buyer_short_library[$orderRes[csf("buyer_name")]].'</p></td>
					<td width="60" align="left"><p>'.$buyer_short_library[$orderRes[csf("cust_buyer")]].'</p></td>

					<td width="100" align="left"><p>'.$orderRes[csf("job_no")].'</p></td>
					<td width="80" align="left"><p>'.$orderRes[csf("job_no_prefix_num")].'</p></td>
					<td width="120" align="left"><p>'.$orderRes[csf("style_ref_no")].'</p></td>
					<td width="130" align="left"><p>'.$garments_item[$orderRes[csf("item_number_id")]].'</p></td>
					<td width="80" align="left"><p>'.$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"].'</p></td>
					<td width="80" align="left" bgcolor="'.$color.'"><div style="word-wrap:break-word; width:50px">'.change_date_format($orderRes[csf("country_ship_date")]).'&nbsp;</div></td>



					<td width="80" align="left"><p>'.change_date_format($subcon_ex_date_arr[$orderRes[csf("id")]]["date"]).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("excess_cut")],2)." %".'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["plan"],2).'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("lay_cut")],2).'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("cutting_qnty")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("cutting_bal_qnty")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($short_excess_cut_qnty,2).'</p></td>
					<td width="80" align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>


					<td width="80" align="right"><p>'.number_format($print_issue_inhouse,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($print_issue_subcon,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($print_rcv_inhouse,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($print_rcv_subcon,0).'</p></td>


					<td width="80" align="right"><p>'.number_format($emb_issue_inhouse,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($emb_issue_subcon,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($emb_rcv_inhouse,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($emb_rcv_subcon,0).'</p></td>



					<td width="80" align="right"><p>'.number_format($spwork_issue,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($spcial_rec,0).'</p></td>

					<td width="80" align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($sewingin_qnty,0).'</p></td>
					<td width="80" align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($orderRes[csf("sewing_out")],0).'</p></td>

					<td width="80" align="right"><p>'.number_format($sewingin_subcon,0).'</p></a></td>
					<td width="80" align="right"><p>'.number_format($sewingout_subcon,0).'</p></td>


					<td width="80" align="right"><p>'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("sewing_out")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($wash_issue,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($wash_rec,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("iron_qnty")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>


					<td width="80" align="right"><p>'.number_format($orderRes[csf("poly_qnty")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($finish_qnty_outbound,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("poly_qnty")],0).'</p></td>

					<td width="80" align="right"><p>'.number_format(($orderRes[csf("poly_qnty")]*100)/$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"],2)." %".'</p></td>

					<td width="80" align="right"><p>'.number_format($orderRes[csf("finishing_qnty")],0).'</td>
					<td width="80" align="right">'.number_format($testt,0).'</p></td>
					<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
					<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
					<td width="80"  align="right"><p>'.number_format($orderRes[csf("finishing_qnty")],0).'</p></td>
					<td width="80"  align="right"><p>'.number_format(($orderRes[csf("finishing_qnty")]*100)/$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"],2).' %</p></td>
					<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
					<td width="80"  align="right"><p>'.number_format($subcon_ex_date_arr[$orderRes[csf("id")]]["qtys"],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($shortage,0).'</p></td>
					<td width="80"  align="right" width="85"><p>'.number_format($shortages,0).'</p></td>
					<td align="right"><p>'.$shortages.'</p></td>
				</tr>';
				$i++;
			}
		}

		if(count($party_arr)>0)
		{
			$subcon_buyer_html.='<tr> <th align="left" colspan="25"> Sub-Contract Production </th> </tr>';
			$i=1;
			foreach($party_arr as $buyer_id=>$value)
			{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

								$subcon_buyer_html.='
								<tr bgcolor="'.$bgcolor.'"  onClick="change_color(\'tr22_'.$i."'".', '."'".$bgcolor."'".')" id="tr_'.$i.'"  >
									<td align="left">'.$i.'</td>

									<td align="left">'.$buyer_short_library[$buyer_id].'</td>
									<td align="left">'.$buyer_short_library[$value['cust_buyer']].'</td>
									<td align="right">'.number_format($value["po_quantity"]).'</td>
									<td align="right">'. number_format($value["lay_qnty"]).'</td>
									<td align="right">'. number_format($value["cutting_qnty"]).'</td>
									<td align="right">'. number_format($value["print"]).'</td>
									<td align="right">'. number_format($value["print_rec"]).'</td>
									<td align="right">'. number_format($value["emb"]).'</td>
									<td align="right">'. number_format($value["emb_rec"]).'</td>
									<td align="right">'. number_format($value["emb_rec"]).'</td>
									<td align="right">'.  number_format($value["wash"]).'</td>
									<td align="right">'.  number_format($value["wash_rec"]).'</td>
									<td align="right">'.  number_format($value["spwork"]).'</td>
									<td align="right">'.  number_format($value["spwork_rec"]).'</td>
									<td align="right">'. number_format($value["sQty"]).'</td>
									<td align="right">'. number_format($value["soQty"]).'</td>
									<td align="right">'. number_format($value["sewing_out"]).'</td>
									<td align="right">'. number_format($value["sQty"]).'</td>
									<td align="right">'.  number_format($value["sewing_out"]).'</td>
									<td align="right">'.  number_format($value["soQty"]+$value["iron_qnty"]).'</td>

									<td align="right">'. number_format($value["poly_qnty"]).'</td>
	                                <td align="right">'.  number_format( ($value["poly_qnty"]*100)/$value["po_quantity"],2 ).'</td>

									<td align="right">'.  number_format($value["finishing_qnty"],2).'</td>
									<td align="right">'.  number_format( ($value["finishing_qnty"]*100)/$value["po_quantity"] ,2).'</td>

									<td align="right">'. number_format($party_arr_ex[$buyer_id],2).'</td>
									<td  align="right">'.  number_format( ($party_arr_ex[$buyer_id]*100)/$value["po_quantity"] ,2).'</td>


								</tr>';
								$i++;

			}

		}
		// die('ok');
		$sql_cutlay="SELECT a.entry_form,b.order_id as po_id,b.gmt_item_id as gmts,c.order_id,c.size_qty  as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,GBL_TEMP_ENGINE d where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id =d.ref_val and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name and d.entry_form=21 and d.ref_from=7 and d.user_id=$user_id";
		$sql_res=sql_select($sql_cutlay);
		// die('ok');
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			// if($entry_form!=76)
			// {
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]]+=$vals[csf("qty")];
			/*}
			else
			{
				$cut_lay_arrs[$vals[csf("po_id")]][$vals[csf("gmts")]]+=$vals[csf("qty")];
			}*/
		}


		//echo "<pre>";print_r($gmts_prod_arr);die;
		unset($res_gmtsData);

		/*$po_transfer_in_sql=sql_select("SELECT a.po_break_down_id,b.production_quantity,a.item_number_id from pro_gmts_delivery_dtls where status_active=1 and is_deleted=0");
		foreach($po_transfer_in_sql as $vals)
		{
			$po_transfer_in_arr[$vals[csf("to_po_id")]][$vals[csf("item_number_id")]]+=$vals[csf("production_quantity")];
		}

		$po_transfer_out_sql=sql_select("SELECT from_po_id,production_quantity,item_number_id from pro_gmts_delivery_dtls where status_active=1 and is_deleted=0");
		foreach($po_transfer_out_sql as $vals)
		{
			$po_transfer_out_arr[$vals[csf("from_po_id")]][$vals[csf("item_number_id")]]+=$vals[csf("production_quantity")];
		}*/


		// echo "<pre>";print_r($po_transfer_arr);echo "</pre>";
		//echo "<pre>";print_r($po_transfer_out_arr);echo "</pre>";die;
		unset($po_transfer_in_sql);
		unset($po_transfer_out_sql);



		$fromDate = change_date_format( str_replace("'","",trim($txt_date_from)) );
		$toDate = change_date_format( str_replace("'","",trim($txt_date_to)) );
		$buyer_array=array();
		$result=sql_select($order_sql);
		$i=0; $k=0; $date=date("Y-m-d");
		$days_in_hand="";
		// echo "<pre>";print_r($result);die;
		foreach($result as $orderRes)
		{
		   $i++;
		   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
		   $setArr = explode("__",$orderRes[csf("set_break_down")] );
		   $countArr = count($setArr);

		   if($countArr==0) $countArr=1;
		   for($j=0;$j<$countArr;$j++)
		   {
			   $setItemArr = explode("_",$setArr[$j]);
			   $item_id=$setItemArr[0];
			   $set_qnty=$setItemArr[1];
			   if($item_id>0)
			   {
				   	$k++;
				   	// $po_quantity_in_pcs = $orderRes[csf("po_quantity")]*$set_qnty;
				   	$po_qty = $order_qty_array[$orderRes[csf("id")]][$item_id];
				   	$po_quantity_in_pcs = $po_qty;//*$set_qnty;
					$smv=$orderRes[csf('set_smv')];
					$unit_price2=$orderRes[csf("unit_price")]/$orderRes[csf("total_set_qnty")];
					$unit_price=$orderRes[csf("unit_price")]/$set_qnty;
				   	$ex_factory_date=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['date'];
					$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['qty'];
					$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['ex_fac_carton_qty'];

					$color=""; $days_remian="";
					if($orderRes[csf("shiping_status")]==1 || $orderRes[csf("shiping_status")]==2)
					{
						$days_remian=datediff("d",$date,$orderRes[csf("shipment_date")]);
						$days_in_hand=datediff("d",$date,$orderRes[csf("shipment_date")]);
						if($orderRes[csf("shipment_date")] > $date)
						{
							$color="";
						}
						else if($orderRes[csf("shipment_date")] < $date)
						{
							$color="red";
						}
						else if($orderRes[csf("shipment_date")] >= $date && $days_remian<=5 )
						{
							$color="orange";
						}
					}
					else if($orderRes[csf("shiping_status")]==3)
					{
						$days_remian=datediff("d",$ex_factory_date,$orderRes[csf("shipment_date")]);
						if($orderRes[csf("shipment_date")] >= $ex_factory_date)
						{
							$color="green";
						}
						else if($orderRes[csf("shipment_date")] < $ex_factory_date)
						{
							$color="#2A9FFF";
						}
						$days_in_hand="";

					}//end if condition
					//if($days_in_hand<0) $days_in_hand=abs($days_in_hand)." Days Pass";
					//print_r($gmts_prod_arr[$orderRes[csf("id")]]);
					$cutting_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][1][0]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][3][0]['qty'];
					$cut_replace_qty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][1][0]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][3][0]['qty'];

					$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][1]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][2]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][3]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][1]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][2]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][3]['qty'];

					$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][4][1][0]['qty'];
					$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][5][1][0]['qty'];
					$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][4][3][0]['qty'];
					$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][5][3][0]['qty'];
					$iron_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][7][1][0]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][7][3][0]['qty'];
					$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][7][1][0]['re_prod_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][7][3][0]['re_prod_qty'];
					$polyInQnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][11][1][0]['qty'];
					$polyOutQnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][11][3][0]['qty'];
					$poly_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][11][1][0]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][11][3][0]['qty'];
					$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][8][1][0]['qty'];
					$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][8][3][0]['qty'];

					$replace_qty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][5][1][0]['replace_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][5][3][0]['replace_qty'];

					$cartonInQnty=$carton_arr[$orderRes[csf("id")]]['carton_qty_no_inhouse'];
					$cartonOutQnty=$carton_arr[$orderRes[csf("id")]]['carton_qty_no_outbound'];
					$cartonTotal_qnty=$carton_arr[$orderRes[csf("id")]]['carton_total_qty'];


					$finish_qnty_transferIn=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][5]['qty'];
					$finish_qnty_transferOut=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][6]['qty'];

					// $finish_qnty_transferIn=$po_transfer_arr[$orderRes[csf("id")]][$item_id][5];
					// $finish_qnty_transferOut=$po_transfer_arr[$orderRes[csf("id")]][$item_id][6];

					$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][1][1]['qty'];
					$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][3][1]['qty'];
					$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][1]['qty'];
					$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][1]['qty'];

					$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][1][2]['qty'];
					$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][3][2]['qty'];
					$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][2]['qty'];
					$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][2]['qty'];

					$print_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][1][1]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][3][1]['qty'];
					$cut_lays=$cut_lay_arrs[$orderRes[csf("id")]][$item_id] ;
					$embl_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][1][2]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][3][2]['qty'];
					$wash_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][1][3]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][3][3]['qty'];
					$spwork_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][1][4]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][3][4]['qty'];

					$spc_qty_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][1][4]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][3][4]['qty'];
					$wash_qty_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][1][3]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][2][3][3]['qty'];

					$print_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][1]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][1]['qty'];
					$emb_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][2]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][2]['qty'];
					$wash_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][3]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][3]['qty'];
					$spcial_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][4]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][4]['qty'];
					$buyer_array[$orderRes[csf("buyer_name")]]['client_id']=$orderRes[csf("client_id")];
					// $buyer_array[$orderRes[csf("buyer_name")]]['id']=$orderRes[csf("id")];
					$buyer_array[$orderRes[csf("buyer_name")]]['receive_qnty']+=$po_wise_fin_rcv_arr[$orderRes[csf("id")]];
					$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
 					$buyer_array[$orderRes[csf("buyer_name")]]['cut_lays']+=$cut_lays;
					$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$po_quantity_in_pcs;
					$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$po_quantity_in_pcs*$unit_price;
					$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
					$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
					$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound;
					$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$finish_qnty_transferIn-$finish_qnty_transferOut;
					// echo $finish_qnty_inhouse."+".$finish_qnty_outbound."+".$finish_qnty_transferIn."-".$finish_qnty_transferOut."<br>";
					$actual_exces_cut = $gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][1][0]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][3][0]['qty'];
					$buyer_array[$orderRes[csf("buyer_name")]]['polyQty']+=$poly_qnty;
					if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

					$plan_cut_qnty=$orderRes[csf("plan_cut")]*$set_qnty;
					$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
					$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);

					//$rej_value=$proRes[csf("finish_rej_qnty")]+$proRes[csf("sewingout_rej_qnty")];

					//$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('production_type')]][$gmtsRow[csf('production_source')]][$gmtsRow[csf('embel_name')]]['reject_qty'] += $gmtsRow[csf('reject_qty')];
					//Other reject quantity
					$rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][1][0]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][1]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][2]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][3]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][1][4]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][7][1][0]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][8][1][0]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][11][1][0]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][3][0]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][1]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][2]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][3]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][3][3][4]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][7][3][0]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][8][3][0]['reject_qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][11][3][0]['reject_qty'];
					//reject_qty

					$cut_rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][1][0]['qty'] + $gmts_prod_arr[$orderRes[csf("id")]][$item_id][1][3][0]['qty'];

					//Sewing reject val
					$sewing_rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sew_rej_qty'];

					/* $pQty = 0;
					$sewing_rej_value = 0;
					foreach($gmts_prod_arr[$orderRes[csf("id")]][$item_id][4] as $typeWise){
						foreach($typeWise as $embWise){
							$pQty += $embWise['reject_qty'];
						}
					}
					foreach($gmts_prod_arr[$orderRes[csf("id")]][$item_id][5] as $typeWise){
						foreach($typeWise as $embWise){
							$pQty += $embWise['reject_qty'];
						}
					}

					$sewing_rej_value=$pQty; */

					$poly_status = $poly_qnty*100/$po_quantity_in_pcs;
					$finish_status = $total_finish_qnty*100/$po_quantity_in_pcs;
					if($j==0)
					{
						$display_font_color="";
						$font_end="";
					}
					else
					{
						$display_font_color="&nbsp;<font style='display:none'>";
						$font_end="</font>";
					}

					$company_name=$orderRes[csf("company_name")];
					$po_id=$orderRes[csf("id")];
					if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);
					if($orderRes[csf("shiping_status")]==3) $days_remian=$days_remian; else $days_remian="---";
					if(round($actual_exces_cut) > round($orderRes[csf("excess_cut")])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
					$total_rej_value+=$rej_value;
					$template_id=$template_id_arr[$orderRes[csf('id')]];
				   	$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$k','$bgcolor') id=tr_2nd$k>";
					$shortage = 0; $excess = 0; $balance = 0;
					if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
					{
						$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

						if($shortage<0)
						{
							//$shortage = "".ltrim($shortage,"-")."";
						}
					}
					else
					{
						//$shortage = "-";
					}

					if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
					{
						$excess = $ex_factory_qnty-$po_quantity_in_pcs;
					}
					else
					{
						$excess = 0;
					}

					$balance = $ex_factory_qnty-$po_quantity_in_pcs;

					$html.='<td align="left">'.$display_font_color.$i.$font_end.'</td>
						<td align="left">'.$display_font_color.$company_library[$orderRes[csf("company_name")]].$font_end.'</td>
						<td align="left">'.$display_font_color.$company_library[$orderRes[csf("style_owner")]].$font_end.'</td>
						<td align="left"><p><a href="##" onclick="progress_comment_popup('.$orderRes[csf("id")].",'".$template_id."',".$tna_process_type.')">'.$display_font_color.$orderRes[csf("po_number")].$font_end.'</a></p></td>
						<td align="left"><p>'.$display_font_color.$order_status[$orderRes[csf("is_confirmed")]].$font_end.'</p></td>
						<td align="left"><p>'.$display_font_color.$buyer_short_library[$orderRes[csf("buyer_name")]].$font_end.'</p></td>
						<td align="left"><p>'.$display_font_color.$buyer_short_library[$orderRes[csf("client_id")]].$font_end.'</p></td>

						<td align="left"><p>'.$display_font_color.$orderRes[csf("job_no")].$font_end.'</p></td>
						<td align="left"><p>'.$display_font_color.$orderRes[csf("job_no_prefix_num")].$font_end.'</p></td>
						<td align="left"><p>'.$display_font_color.$orderRes[csf("style_ref_no")].$font_end.'</p></td>
						<td align="left"><p>'.$garments_item[$item_id].'</p></td>
						<td align="right"><p>'.$item_smv_array[$orderRes[csf("id")]][$item_id].'</p></td>
						<td align="right"><a href="##" onclick="openmypage_order('.$po_id.",".$company_name.",".$item_id.",0,'OrderPopup'".')">'.$po_quantity_in_pcs.'</a></td>
						<td align="right"><p>'.number_format($unit_price2,2).'</p></td>
						<td align="right"><p>'.number_format($po_quantity_in_pcs*$unit_price2,2).'</p></td>

						<td align="center"><p>'.change_date_format($orderRes[csf("pack_handover_date")]).'</p></td>
						<td align="center"><p>'.change_date_format($orderRes[csf("shipment_date")]).'</p></td>
						<td align="center"><a href="##" onclick="openmypage('.$po_id.",".$item_id.",'exfactory','','','','0'".')">View</a></td>
						<td align="right"><p>'.number_format($orderRes[csf("excess_cut")],2)." %".'</p></td>
						<td align="right"><p>'.number_format($plan_cut_qnty,0).'</p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','17','1','product_popup'".')">'.number_format($cut_lay_arrs[$orderRes[csf("id")]][$item_id],0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','1','0','product_popup'".')">'.number_format($cutting_qnty,0).'</a></p></td>
						<td align="right"><p>'.number_format($cut_lay_arrs[$orderRes[csf("id")]][$item_id]-$cutting_qnty,0).'</p></td>
						<td align="right"><p>'.number_format($cut_rej_value,0).'</p></td>

						<td align="right"><p><a href="##" onclick="openmypage_cutting_replace('.$po_id.",".$item_id.",'cut_replace_qty','','','$type',''".')">'.number_format($cut_replace_qty,0).'</a></p></td>

						<td align="right" title="Plan Cut - Cut Qty"><p>'.number_format($short_excess_cut_qnty,0).'</p></td>
						<td align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','1*1','product_popup'".')">'.number_format($print_issue_inhouse,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','3*1','product_popup'".')">'.number_format($print_issue_subcon,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','1*1','product_popup'".')">'.number_format($print_rcv_inhouse,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','3*1','product_popup'".')">'.number_format($print_rcv_subcon,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','1*2','product_popup'".')">'.number_format($emb_issue_inhouse,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','3*2','product_popup'".')">'.number_format($emb_issue_subcon,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','1*2','product_popup'".')">'.number_format($emb_rcv_inhouse,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','3*2','product_popup'".')">'.number_format($emb_rcv_subcon,0).'</a></p></td>

						<td align="right">'.$spc_qty_issue.'</td>
						<td align="right">'.$spcial_rec.'</td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','4','1','product_popup'".')">'.number_format($sewingin_qnty,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','5','1','product_popup'".')">'.number_format($sewingout_qnty,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','4','3','product_popup'".')">'.number_format($sewingin_subcon,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','5','3','product_popup'".')">'.number_format($sewingout_subcon,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','4','1','product_popup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','5','1','product_popup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</a></p></td>
						<td align="right"><p>'.number_format($finishing_rcv_arr[$orderRes[csf("id")]][$item_id]['receive_qnty']).'</p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','0*3','product_popup'".')">'.number_format($wash_qty_issue,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','0*3','product_popup'".')">'.number_format($wash_rec,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','7','1','product_popup'".')">'.number_format($iron_qnty,0).'</a></p></td>
						<td align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','11','1','product_popup'".')">'.number_format($polyInQnty,0).'</p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','11','3','product_popup'".')">'.number_format($polyOutQnty,0).'</p></td>

						<td align="right"><p>'.number_format($poly_qnty,0).'</p></td>
						<td align="right">'.number_format($poly_status,2)." %".'</td>

						<td align="right"><p>'.number_format($finish_qnty_inhouse,0).'<br>'.'Ctn: '.$cartonInQnty.'</p></td>
						<td align="right"><p>'.number_format($finish_qnty_outbound,0).'<br>'.'Ctn: '.$cartonOutQnty.'</p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','8','300','fin_gmt_transfer_popup'".')">'.number_format($finish_qnty_transferIn,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','8','200','fin_gmt_transfer_popup'".')">'.number_format($finish_qnty_transferOut,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','8','1','product_popup'".')">'.number_format($total_finish_qnty,0).'</a><br>'.'Ctn: '.$cartonTotal_qnty.'</p></td>

						<td align="right">'.number_format($finish_status,2)." %".'</td>

						<td align="right"><p><a href="##" onclick="openmypage_rej('.$po_id.",".$item_id.",'reject_qty','','','$type',''".')">'.number_format($rej_value,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_sewing_rej('.$po_id.",".$item_id.",'sewing_reject_qty','','','$type',''".')">'.number_format($sewing_rej_value,0).'</a></p></td>


						<td align="right"><p><a href="##" onclick="openmypage_sewing_replace('.$po_id.",".$item_id.",'replace_qty','','','$type',''".')">'.number_format($replace_qty,0).'</a></p></td>

						<td align="right"><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','10','1','product_popup'".')">'.number_format($ex_factory_qnty,0).' </a> <br>  Ctn: '.number_format($ex_factory_carton_qnty,0).'</td>

						<td align="right">&nbsp;'.$shortage.'</td>
						<td align="right">&nbsp;'.$excess.'</td>
						<td align="right">&nbsp;'.$balance.'</td>
						<td>'.$shipment_status[$orderRes[csf("shiping_status")]].'</td>
						<td>&nbsp;<a href="##" onclick="openmypage_color_countyr_remark('.$po_id.",'".$item_id."','0','','product_all_remarks'".')">Remarks</a></td>
					</tr>';
				}
			} //end for loop
		}// end main foreach  exfactory
		/*$buyer_wise_cut_lay_sql=sql_select("select c.buyer_name,sum(b.size_qty) as size_qty  from  ppl_cut_lay_mst a,  ppl_cut_lay_bundle b,wo_po_details_master  c,wo_po_break_down d
            where a.job_no= c.job_no and a.id=b.mst_id and a.company_id=$cbo_company_name and c.company_name=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and
            d.status_active=1 and d.is_deleted=0 and c.job_no=d.job_no_mst and d.id=b.order_id and a.job_no=d.job_no_mst
            -- and a.job_no='FTML-17-00591'
            and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by c.buyer_name");
		foreach ($buyer_wise_cut_lay_sql as $key => $values)
		 {
			  $buyer_wise_cut_lay_arr[$values[csf("buyer_name")]]['cut_lay']=$values[csf("size_qty")];
		 }*/
		 //=================================== Delete Order Id From TEMP ENGINE ====================================
		execute_query("DELETE from gbl_temp_engine where user_id=$user_id and entry_form = 21 and ref_from in(7,8)");
		oci_commit($con);
		disconnect($con);

		$report_data ='<div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						Order Wise RMG Production Status
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						Company Name :'.$company_library[str_replace("'","",$cbo_company_name)].'
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">';
				if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
				{
					$report_data.='From ' .$fromDate.' To '.$toDate;
				}
				$report_data.='</td>
				</tr>
			</table>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:2270px">This Report is Generated based on Published Ship Date.</div>
			<div style="float:left; width:2250px">
				<table cellspacing="0" border="1" class="rpt_table" rules="all">
					<thead>
						 <tr>
							<th rowspan="2">Sl.</th>
							<th rowspan="2">Buyer Name</th>
							<th rowspan="2">Buyer Client</th>
							<th rowspan="2">PO Qty.</th>
							<th rowspan="2">Cut Qty.</th>
							<th rowspan="2"> Cutting QC Qty</th>
							<th rowspan="2">Sent to Print</th>
							<th rowspan="2">Rcv Print</th>
							<th rowspan="2">Sent to Emb</th>
							<th rowspan="2" >Rcv Emb</th>
							<th rowspan="2">Sent to Wash</th>
							<th rowspan="2">Rcv Wash</th>
							<th rowspan="2" >Sent to Sp. Works</th>
							<th rowspan="2">Rcv Sp. Works</th>
							<th colspan="2">InHouse</th>
							<th colspan="2">Sub-Contact</th>
							<th rowspan="2">Total Sewing Input Qty</th>
							<th rowspan="2">Total Sewing Output Qty</th>
							<th rowspan="2">Finishing Rcv</th>
							<th rowspan="2">Total Iron Qty</th>
                            <th rowspan="2">Total Poly Qty</th>
							<th rowspan="2">Poly Comp %</th>
							<th rowspan="2">Total Finish Qty</th>
							<th rowspan="2" >Fin Comp %</th>
							<th rowspan="2">Ex-Fac</th>
							<th rowspan="2" >Ex-Fac%</th>
						 </tr>
						<tr>
							<th >Sew Input.</th>
							<th >Sew OutPut </th>
							<th >Sew Input.</th>
							<th >Sew OutPut </th>
						 </tr>
					</thead>
				</table>
				<div style="max-height:425px; overflow-y:scroll; width:2220px" >
					<table cellspacing="0" border="1" class="rpt_table"  width="2200" rules="all">';
					$i=1; $total_po_quantity=0;$total_po_value=0; $total_cut=0; $total_print_iss=0;$total_lay=0;
					$total_print_re=0; $total_sew_input=0; $total_sew_out=0; $total_iron=0; $total_re_iron=0; $total_finish=0;$total_ex_factory=0;
					// echo "<pre>"; print_r($buyer_array); die;
					foreach($buyer_array as $buyer_id=>$value)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";


						$report_data.='<tr bgcolor="'.$bgcolor.'">
							<td>'.$i.'</td>
							<td>'.$buyer_short_library[$buyer_id].'</td>
							<td>'.$buyer_short_library[$value[client_id]].'</td>
							<td align="right">'.number_format($value[poQty]).'</td>

							<td align="right">'.number_format($value[cut_lays]) .'</td>
							<td align="right">'.number_format($value[cQty]).'</td>

							<td align="right">'.number_format($value["print"]).'</td>
							<td align="right">'.number_format($value[print_rec]).'</td>
							<td align="right">'.number_format($value[emb]).'</td>
							<td align="right">'.number_format($value[emb_rec]).'</td>
							<td align="right">'.number_format($value[wash]).'</td>
							<td align="right">'.number_format($value[wash_rec]).'</td>
							<td align="right">'.number_format($value[spwork]).'</td>
							<td align="right">'.number_format($value[spwork_rec]).'</td>
							<td align="right">'.number_format($value[sQty]).'</td>
							<td align="right">'.number_format($value[soQty]).'</td>
							<td align="right">'.number_format($value[subcon_sewing]).'</td>
							<td align="right">'.number_format($value[subcon_sewout]).'</td>
							<td align="right">'.number_format($value[sQty]+$value[subcon_sewing]).'</td>
							<td align="right">'.number_format($value[soQty]+$value[subcon_sewout]).'</td>
							<td align="right">'.number_format($value[receive_qnty]).'</td>
							<td align="right">'.number_format($value[iQty]).'</td>
							<td align="right">'.number_format($value[polyQty]).'</td>';
							 $poly_gd_status = ($value[polyQty]/$value[poQty])*100;
							 $report_data.='<td align="right">'.number_format($poly_gd_status,2).'</td>
							<td align="right">'.number_format($value[fQty]).'</td>';
							 $finish_gd_status = ($value[fQty]/$value[poQty])*100;
							 $report_data.='<td align="right">'.number_format($finish_gd_status,2).'</td>
							<td align="right">'.number_format($value[ex]).'</td>';
							$ex_gd_status = ($value[ex]/$value[poQty])*100;
							$report_data.='<td align="right">'.number_format($ex_gd_status,2).'</td>
						</tr>';

							$total_po_quantity+=$value[poQty];
							$total_cut+=$value[cQty];
							$total_lay+=$value[cut_lays];
							$total_sent_print+=$value["print"];
							$total_print_re+=$value[print_rec];
							$total_emb+=$value[emb];
							$total_emb_re+=$value[emb_rec];
							$total_wash+=$value[wash];
							$total_wash_re+=$value[wash_rec];
							$total_spwork+=$value[spwork];
							$total_spwork_re+=$value[spwork_rec];
							$total_sew_input+=$value[sQty];
							$total_sew_out+=$value[soQty];
							$total_subcon_sewing+=$value[subcon_sewing];
							$total_subcon_sewout+=$value[subcon_sewout];
							$total_iron+=$value[iQty];
							$total_poly+=$value[polyQty];
							$total_re_iron+=$value[reiQty];
							$total_finish+=$value[fQty];
							$total_ex_factory+=$value[ex];
							$total_receive+=$value[receive_qnty];
						$i++;
					}//end foreach 1st
					$chart_data_qnty="Order Qty;".$total_po_quantity."\n"."Cutting;".$total_cut."\n"."Sew In;".$total_sew_input."\n"."Sew Out ;".$total_sew_out."\n"."Iron ;".$total_iron."\n"."Finish ;".$total_finish."\n"."Ex-Fact;".$total_ex_factory."\n";
					$report_data.= $subcon_buyer_html;

					$report_data.='</table>
					<table border="1" class="tbl_bottom"  width="2200" rules="all">
						<tr>
							<td>&nbsp;</td>
							<td align="right"></td>
							<td align="right">Total</td>
							<td id="tot_po_quantity">'.number_format($total_po_quantity+$party_ground_total["po_quantity"]).'</td>
							<td id="tot_lay">'.number_format($total_lay).'</td>
							<td id="tot_cutting">'.number_format($total_cut+$party_ground_total["cutting_qnty"]).'</td>
							<td id="tot_emb_rcv">'.number_format($total_sent_print).'</td>
							<td id="tot_sew_in">'.number_format($total_print_re).'</td>
							<td id="tot_sew_out">'.number_format($total_emb).'</td>
							<td id="tot_iron">'.number_format($total_emb_re).'</td>
							<td id="tot_emb_rcv">'.number_format($total_wash).'</td>
							<td id="tot_sew_in">'.number_format($total_wash_re).'</td>
							<td id="tot_sew_out">'.number_format($total_spwork).'</td>
							<td id="tot_iron">'.number_format($total_spwork_re).'</td>
							<td id="tot_emb_rcv">'.number_format($total_sew_input).'</td>
							<td id="tot_sew_in">'.number_format($total_sew_out).'</td>
							<td id="tot_sew_out">'.number_format($total_subcon_sewing).'</td>
							<td id="tot_iron">'.number_format($total_subcon_sewout+$party_ground_total["sewing_out"]).'</td>
							<td id="tot_iron">'.number_format($total_sew_input+$total_subcon_sewing).'</td>
							<td id="tot_sew_out">'.number_format($total_subcon_sewout+$total_sew_out+$party_ground_total["sewing_out"]).'</td>
							<td>'.number_format($total_receive).'</td>
							<td id="tot_iron">'.number_format($total_iron+$party_ground_total["iron_qnty"]).'</td>
                            <td id="tot_poly">'.number_format($total_poly+$party_ground_total["poly_qnty"]).'</td>';

                            $total_poly_gd_status = ($total_poly/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_poly_gd_status,2).'</td >

							<td id="tot_finish">'.number_format($total_finish+$party_ground_total["finishing_qnty"]).'</td>';
							$total_finish_gd_status = ($total_finish/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_finish_gd_status,2).'</td >
							<td>'.number_format($total_ex_factory+$party_arr_ex_ground["ex"]).'</td >';
							$total_ex_status = ($total_ex_factory/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_ex_status,2).'</td>
						</tr>

					 </table>
				</div>
			</div>
			<div style="clear:both"></div>


			<table width="5410" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1">
				<thead>
					<tr>
						<th rowspan="2">SL</th>
                        <th rowspan="2">Original Owner</th>
                        <th rowspan="2">Transferee Owner</th>
						<th rowspan="2">Order Number</th>
                        <th rowspan="2">Order Status</th>
						<th rowspan="2">Buyer Name</th>
						<th rowspan="2">Buyer Client</th>

                        <th rowspan="2">Job No</th>
                        <th rowspan="2">Job Prefix</th>
						<th rowspan="2">Style Name</th>
						<th rowspan="2">Item Name</th>
						<th rowspan="2">SMV</th>
						<th rowspan="2">Order Qty.</th>
						<th rowspan="2">Avg. Rate</th>
						<th rowspan="2" title="Order Qty Pcs * Avg. Rate">FOB Value</th>
						<th rowspan="2">PHD Date</th>
						<th rowspan="2">Ship Date</th>
						<th rowspan="2">Ex-Factory Date</th>

                        <th rowspan="2">Approved Cut %</th>
                        <th rowspan="2">Plan Cut Qty</th>
                        <th rowspan="2">Cut Qty</th>
						<th rowspan="2">Cutting QC Qty</th>
						<th rowspan="2">QC Pending</th>
						<th rowspan="2">Reject Qnty</th>
						<th rowspan="2">Replace Qnty</th>
                        <th rowspan="2">Short/Excess Cut Qty</th>
                        <th rowspan="2">Short/Excess Cut%</th>

						<th colspan="2">Sent to Print</th>
						<th colspan="2">Rcv Print</th>
						<th colspan="2">Sent to Emb</th>
						<th colspan="2">Rcv Emb</th>

						<th rowspan="2" >Sent to Sp. Works</th>
						<th rowspan="2">Rcv Sp. Works</th>
						<th colspan="2">InHouse</th>
						<th colspan="2">Out-bound Sub-Contact</th>
						<th rowspan="2">Total Sewing Input Qty</th>
						<th rowspan="2">Total Sewing Output Qty</th>
						<th rowspan="2">Finishing Rcv.</th>
						<th rowspan="2">Sent to Wash</th>
						<th rowspan="2">Rcv Wash</th>
						<th rowspan="2">Total Iron Qty</th>
						<th rowspan="2">Total Re-Iron Qty</th>
                        <th colspan="3">Poly Qty</th>
                        <th rowspan="2">Poly Comp %</th>
						<th colspan="5">Finish Qty</th>
						<th rowspan="2">Fin Comp %</th>

						<th rowspan="2">Reject Qty Others</th>
						<th rowspan="2">Sewing Reject Qty</th>
						<th rowspan="2">Replace Quantity</th>
						<th rowspan="2">Total Ex-Factory</th>
						<th rowspan="2">Shortage Qty.</th>
						<th rowspan="2">Excess Qty.</th>
						<th rowspan="2">Balance</th>
						<th rowspan="2">Status</th>
						<th rowspan="2" >Remarks</th>
					 </tr>
					 <tr>
                        <th>Inhouse</th>
                        <th>SubCon</th>
                        <th>Inhouse</th>
                        <th>SubCon</th>
                        <th>Inhouse</th>
                        <th>SubCon</th>
                        <th>Inhouse</th>
                        <th>SubCon</th>
                        <th>Sew Input.</th>
                        <th>Sew OutPut </th>
                        <th>Sew Input.</th>
                        <th>Sew OutPut </th>
                        <th>In-house</th>
                        <th>Out-bound </th>
                        <th>Total</th>

                        <th>In-house</th>
                        <th>Out-bound </th>
                        <th>Transfer In</th>
                        <th>Transfer Out </th>
                        <th>Total</th>
					</tr>
				</thead>
			</table>

			<div style="max-height:425px; overflow-y:scroll; width:5430px" id="scroll_body">
				<table border="1" class="rpt_table" width="5410" rules="all" id="table_body">';
				$report_data.=$html;
				$report_data.='</table>
				<table border="1" class="tbl_bottom" width="5330" rules="all" id="report_table_footer" >
					<tr>
						<td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>

                        <td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>Total</td>
						<td id="td_smv_qty"></td>
						<td id="td_po_qty"></td>
						<td>&nbsp;</td>
						<td id="td_fob_value"></td>

						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td id="td_plan_cutting"></td>
						<td id="td_cut_lay"></td>
						<td id="td_cutting"></td>

						<td id="td_cutting_reject"></td>
						<td id="td_reject_qty"></td>
						<td id="td_short_access_cut"></td>
						<td>&nbsp;</td>
						<td id="td_print_issue"></td>
						<td id="td_printIss_subcon"></td>
						<td id="td_print_receive"></td>

						<td id="td_printRec_subcon"></td>
						<td id="total_emb_issue"></td>
						<td id="td_embIss_subcon"></td>
						<td id="total_emb_receive"></td>
						<td id="td_embRec_subcon"></td>
						<td id="total_sp_issue"></td>
						<td id="total_sp_receive"></td>

						<td id="total_sewing_input"></td>
						<td id="total_sewing_out"></td>
						<td id="total_subcon_sewing_input"></td>
						<td id="total_subcon_sewing_out"></td>
						<td id="total_sewing_input_all_qnty"></td>
						<td id="total_sewing_output_all_qnty"></td>
						<td id="finishing_rcv_qnty"></td>

						<td id="td_wash_iss"></td>
						<td id="td_wash_rec"></td>
						<td   id="total_iron_qnty"></td>
						<td id="total_re_iron_qnty"></td>
						<td id="total_poly_in_qnty"></td>
						<td id="total_poly_out_qnty"></td>
						<td id="total_poly_qnty"></td>

						<td>&nbsp;</td>
						<td id="td_finish_in"></td>
						<td id="td_finish_out"></td>
						<td id="td_transfer_in"></td>
						<td id="td_transfer_out"></td>
						<td id="td_finish"></td>
						<td>&nbsp;</td>

						<td id="td_reject"></td>
						<td id="td_sewing_reject"></td>
						<td    id="td_ex_factory"></td>
						<td  ></td>
						<td id="td_excess"></td>
						<td align="right"><span id="td_short"></span></td>
						<td align="right"><span id="td_balance"></span></td>
						<td>&nbsp;</td>

						<td>&nbsp;</td>
					</tr>
				</table>
			</div>
		 </div>';


	}
	else if($type==2) //color wise excel
	{
		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}
		//if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_season_id!=0) $str_po_cond.=" and a.season_buyer_wise=$cbo_season_id";

		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";

		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";
		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";

		$order_sql="SELECT a.id job_id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.id as po_id, b.po_number, b.pub_shipment_date as shipment_date, b.excess_cut,  b.is_confirmed,b.pack_handover_date, b.grouping, c.item_number_id as item_number_id, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total ,max(b.shiping_status) as shiping_status,sum(c.plan_cut_qnty) as plan_cut_qnty
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active in(1,2,3) and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $active_cond $order_status_cond $str_po_cond $txt_style_ref_number_cond  $internal_ref_cond_po
		group by a.id,a.job_no_prefix_num,a.job_no,a.insert_date,a.company_name,a.buyer_name,a.style_ref_no,b.id,b.po_number, b.pub_shipment_date, b.excess_cut, b.is_confirmed,b.pack_handover_date, b.grouping, c.item_number_id, c.color_number_id
		order by b.pub_shipment_date, b.id, c.item_number_id,c.color_number_id";
		// echo $order_sql."TYPE 2";
		$po_id_arr = array();
		$sql_po_result=sql_select($order_sql);

		if(count($sql_po_result)==0)
		{
			echo '<div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">No Data Found.</div>'; die;
		}

		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("po_id")].",";
			$po_id_arr[$row[csf("po_id")]] = $row[csf("po_id")];
		}

		$con = connect();
		execute_query("delete from gbl_temp_engine where user_id = ".$user_id." and ref_from =12 and entry_form=21");
		oci_commit($con);

		fnc_tempengine("gbl_temp_engine", $user_id, 21, 12, $po_id_arr, $empty_arr);//po id

		//echo "<pre>";print_r($booking_no_arr);die;



		$all_po_id=implode(',',array_unique(explode(",",chop($all_po_id,","))));
		//echo count(explode(",",$all_po_id));die;
		$template_id_arr=return_library_array("SELECT a.po_number_id, a.template_id from tna_process_mst a,gbl_temp_engine temp where a.po_number_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id group by a.po_number_id, a.template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and a.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(explode(",",$all_po_id),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (a.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or a.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}

			}
		}

		// echo $po_product_cond;die();
		// ========================================== cut and lay data =================================
		$all_po_ids_cond = str_replace("a.po_break_down_id", "c.order_id", $po_product_cond);
		$sql_cutlay="SELECT a.entry_form,b.order_id,b.gmt_item_id as gmts,b.color_id,c.order_id,sum(c.size_qty ) as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,gbl_temp_engine temp where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name group by a.entry_form,b.order_id,b.gmt_item_id,b.color_id,c.order_id";
		// echo $sql_cutlay;die();
		$sql_res=sql_select($sql_cutlay);
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			if($entry_form!=76)
			{
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
			}
			else
			{
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
			}

			// $po_id_arr[$vals[csf("order_id")]] =$vals[csf("order_id")];
		}
		//echo "<pre>";print_r($cut_lay_arrs);

		$color_id_arr=return_library_array( "SELECT a.id,a.color_number_id from wo_po_color_size_breakdown a,gbl_temp_engine temp where a.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.color_number_id>0 $po_product_cond", "id", "color_number_id");


		$ex_factory_data=sql_select("SELECT a.po_break_down_id, a.item_number_id, b.color_size_break_down_id, MAX(a.ex_factory_date) AS ex_factory_date,
		sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as ex_factory_qnty,a.total_carton_qnty
	    from pro_ex_factory_mst a, pro_ex_factory_dtls b , wo_po_color_size_breakdown e,gbl_temp_engine temp
	    where a.id=b.mst_id and b.color_size_break_down_id=e.id and a.po_break_down_id=e.po_break_down_id  and a.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and e.status_active=1 and e.is_deleted=0
	    group by a.po_break_down_id, a.item_number_id, b.color_size_break_down_id,a.total_carton_qnty");

		$ex_factory_arr=array();
		foreach($ex_factory_data as $exRow)
		{
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['date']=$exRow[csf('ex_factory_date')];
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['qty']+=$exRow[csf('ex_factory_qnty')];
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['ex_fac_carton_qty']=$exRow[csf('total_carton_qnty')];
            // $po_id_arr[$exRow[csf('po_break_down_id')]] = $exRow[csf('po_break_down_id')] ;
		}
		// echo "<pre>";
		// print_r($ex_factory_arr);
		unset($ex_factory_data);

		//echo "exit"; exit();
		$prod_sql= "SELECT a.po_break_down_id, a.item_number_id, b.color_size_break_down_id , max(a.re_production_qty) AS re_iron_qnty,
			NVL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
			NVL(sum(CASE WHEN a.production_type ='3'  and b.production_type='3' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
			NVL(sum(CASE WHEN a.production_type ='2'  and b.production_type='2'and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

			NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
			NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
			NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
			NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

			NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=5 THEN b.production_qnty ELSE 0 END),0) AS trans_in_qty,
			NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=6 THEN b.production_qnty ELSE 0 END),0) AS trans_out_qty,


			NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS poly_qnty_in,
			NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS poly_qnty_out,


			NVL(sum(CASE WHEN a.production_type ='7' and b.production_type='7' THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
			NVL(sum(CASE WHEN a.production_type ='8'  and b.production_type='8' THEN b.production_qnty ELSE 0 END),0) AS finish_qnty,
			NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
			NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
			NVL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' and a.embel_name=0 THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=2 THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='7' and b.production_type='7' and a.embel_name=2  THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' and a.embel_name=0 THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' and a.embel_name=0 THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=1 THEN b.reject_qty ELSE 0 END),0) AS print_reject_qty,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=3 THEN b.reject_qty ELSE 0 END),0) AS wash_reject_qty,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=4 THEN b.reject_qty ELSE 0 END),0) AS special_reject_qty,
			NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan=0 THEN b.reject_qty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan!=0 THEN b.production_qnty ELSE 0 END),0) AS sewingout_rej_qnty,

			NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan=0 THEN b.reject_qty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan!=0 THEN b.production_qnty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' THEN b.replace_qty ELSE 0 END),0) AS sewingout_rej_qnty_old
		from
			pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c,gbl_temp_engine temp
		where
			a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  and b.color_size_break_down_id>0 $active_cond_c $str_cond_product  $internal_ref_cond_prod
		group by a.po_break_down_id, a.item_number_id, b.color_size_break_down_id";

		$sql_carton_qty=sql_select("SELECT a.po_break_down_id,b.color_size_break_down_id,
			nvl(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			nvl(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			nvl(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a, pro_garments_production_dtls b,gbl_temp_engine temp
			where a.id=b.mst_id and a.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.carton_qty>0  $internal_ref_cond_prod
			group by a.po_break_down_id,b.color_size_break_down_id");
		//$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject;




		//sql test
		//echo $prod_sql;die;
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		//   $po_id_arr[$crtn[csf("po_break_down_id")]]=$crtn[csf("po_break_down_id")];
		}

		//print_r($carton_arr);
		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_qnty']+=$gmtsRow[csf('cutting_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printing_qnty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['wash']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printreceived_qnty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printr']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['embr']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['washr']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['specialr']+=$gmtsRow[csf('specialr')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];


			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_qnty_in']+=$gmtsRow[csf('poly_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_qnty_out']+=$gmtsRow[csf('poly_qnty_out')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_in']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_in']+=$gmtsRow[csf('sewingout_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_out']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			//$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_qnty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['re_iron_qnty']+=$gmtsRow[csf('re_iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_rej_qnty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rej_qnty']+=$gmtsRow[csf('emb_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_rej_qnty']+=$gmtsRow[csf('iron_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_rej_qnty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_rej_qnty']+=$gmtsRow[csf('finish_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_rej_qnty']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_reject_qty']+=$gmtsRow[csf('print_reject_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['wash_reject_qty']+=$gmtsRow[csf('wash_reject_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['special_reject_qty']+=$gmtsRow[csf('special_reject_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewing_input_rej_qnty']+=$gmtsRow[csf('sewing_input_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_rej_qnty']+=$gmtsRow[csf('emb_issue_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_in_qty']+=$gmtsRow[csf('trans_in_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];

			// $gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];
			$po_id_arr[$gmtsRow[csf('po_break_down_id')]]=$gmtsRow[csf('po_break_down_id')];
		}
		//$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject;

		//echo "<pre>";print_r($gmtsRow[csf('po_break_down_id')]);die;

		unset($res_gmtsData);

		$book_arr = array();
		$book_arr2 = array();


		$booking_no_arr=" SELECT a.item_number_id,c.po_break_down_id,c.gmts_color_id, c.booking_no FROM wo_pre_cost_fabric_cost_dtls    a, wo_booking_dtls    c, gbl_temp_engine  temp WHERE    a.id = c.pre_cost_fabric_cost_dtls_id AND c.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id  AND a.status_active = 1
		AND a.is_deleted = 0
		AND c.status_active = 1
		AND c.is_deleted = 0 ";
		//	echo $booking_no_arr ; die;
		$book_execute = sql_select($booking_no_arr);
		foreach($book_execute as $rowData ){


			if(!$book_arr2[$rowData['PO_BREAK_DOWN_ID']][$rowData['ITEM_NUMBER_ID']][$rowData['GMTS_COLOR_ID']][$rowData['BOOKING_NO']]){
				$book_arr[$rowData['PO_BREAK_DOWN_ID']][$rowData['ITEM_NUMBER_ID']][$rowData['GMTS_COLOR_ID']] .= $rowData['BOOKING_NO'] .',';
			}
			$book_arr2[$rowData['PO_BREAK_DOWN_ID']][$rowData['ITEM_NUMBER_ID']][$rowData['GMTS_COLOR_ID']][$rowData['BOOKING_NO']] = $rowData['BOOKING_NO'];

		}
		//echo "<pre>";print_r($book_arr2);die;



		execute_query("delete from gbl_temp_engine where user_id = ".$user_id." and ref_from =12 and entry_form=21");
		oci_commit($con);
		disconnect($con);


		$result=sql_select($order_sql);
		$i=0; $k=0; $date=date("Y-m-d");
		$days_in_hand="";
		foreach($result as $orderRes)
		{

		   $i++;
		   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

			$k++;
			$lay_qty = $cut_lay_arrs[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]];
			$ex_factory_date=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['date'];
			$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['qty'];
			$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['ex_fac_carton_qty'];

			$color=""; $days_remian="";
			$days_remian=datediff("d",$date,$orderRes[csf("shipment_date")]);
			$days_in_hand=datediff("d",$date,$orderRes[csf("shipment_date")]);
			if($orderRes[csf("shipment_date")] > $date)
			{
				$color="";
			}
			else if($orderRes[csf("shipment_date")] < $date)
			{
				$color="red";
			}
			else if($orderRes[csf("shipment_date")] >= $date && $days_remian<=5 )
			{
				$color="orange";
			}
			//end if condition
			//if($days_in_hand<0) $days_in_hand=abs($days_in_hand)." Days Pass";
			//print_r($gmts_prod_arr[$orderRes[csf("id")]]);



			$cutting_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['cutting_qnty'];
			$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['printreceived_qnty'];
			$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_in'];
			$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_in'];
			$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_out'];
			$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_out'];
			$iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['iron_qnty'];
			$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['re_iron_qnty'];
			//$finish_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty'];
			$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_inhouse'];
			$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_outbound'];

			$poly_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_qnty_in'];
			$poly_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_qnty_out'];


			$print_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print'];
			$embl_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb'];
			$wash_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['wash'];
			$spwork_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['special'];
			$print_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['printr'];
			$emb_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['embr'];
			$wash_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['washr'];

			$spcial_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['specialr'];


			$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_issue_inhouse'];
			$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_issue_subcon'];
			$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_rcv_inhouse'];
			$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_rcv_subcon'];

			$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_inhouse'];
			$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_subcon'];
			$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_inhouse'];
			$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_subcon'];

			$cutting_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['cutting_rej_qnty'];
			$emb_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rej_qnty'];
			$iron_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['iron_rej_qnty'];
			$sewing_out_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_rej_qnty'];
			$finish_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_rej_qnty'];


			$poly_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_rej_qnty'];
			$print_reject_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_reject_qty'];
			$wash_reject_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['wash_reject_qty'];
			$special_reject_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['special_reject_qty'];
			$sewing_input_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewing_input_rej_qnty'];
			$emb_issue_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_rej_qnty'];

			$trans_in_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['trans_in_qty'];
			$trans_out_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['trans_out_qty'];

			$cartonInQnty=$carton_arr[$orderRes[csf("po_id")]]['carton_qty_no_inhouse'];
			$cartonOutQnty=$carton_arr[$orderRes[csf("po_id")]]['carton_qty_no_outbound'];
			$cartonTotal_qnty=$carton_arr[$orderRes[csf("po_id")]]['carton_total_qty'];

			$po_id_arr[$orderRes[csf("po_id")]]=$orderRes[csf("po_id")];




			$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$orderRes[csf("order_quantity")];
			$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$orderRes[csf("order_total")];
			$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['cutQty']+=$lay_qty;
			$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
			$actual_exces_cut = $cutting_qnty;
			$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
			$total_poly_qnty=$poly_qnty_inhouse+$poly_qnty_outbound;
			if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

			$po_quantity_in_pcs=$orderRes[csf("order_quantity")];
			$plan_cut_qnty=$orderRes[csf("plan_cut_qnty")];
			//$actual_exces_cut = $cutting_qnty;
			$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
			$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);
			$excess_cut_percent=$short_excess_cut_percent-$orderRes[csf("excess_cut")];
			$embl_recv_qty=$print_rec+$emb_rec+$wash_rec+$spcial_rec;
			$rej_value=$cutting_reject+$emb_reject+$iron_reject+$finish_reject+$poly_rej_qnty+$print_reject_qty+$wash_reject_qty+$special_reject_qty;

			/*
			$cutting_reject=$rej_qty_arr[$color_id][$size_id][1][0];//
			$print_reject_qty=$rej_qty_arr[$color_id][$size_id][3][1];//
			$emb_reject=$rej_qty_arr[$color_id][$size_id][3][2];//
			$wash_reject_qty=$rej_qty_arr[$color_id][$size_id][3][3];//
			$special_reject_qty=$rej_qty_arr[$color_id][$size_id][3][4];
			$iron_reject=$rej_qty_arr[$color_id][$size_id][7][0];//
			$poly_rej_qnty=$rej_qty_arr[$color_id][$size_id][11][0];//
			$finish_reject=$rej_qty_arr[$color_id][$size_id][8][0];// */

			$finish_status = $total_finish_qnty*100/$po_quantity_in_pcs;
			$poly_status = $total_poly_qnty*100/$po_quantity_in_pcs;

			$company_name=$orderRes[csf("company_name")];
			$po_id=$orderRes[csf("po_id")];
			$item_id=$orderRes[csf("item_number_id")];

			if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);

			if(($orderRes[csf("pack_handover_date")]=="" || $orderRes[csf("pack_handover_date")]=="0000-00-00")) $pack_handover_date="&nbsp;"; else $pack_handover_date=change_date_format($orderRes[csf("pack_handover_date")]);

			//if($orderRes[csf("shiping_status")]==3) $days_remian=$days_remian; else $days_remian="---";
			//if(round($actual_exces_cut) > round($orderRes[csf("excess_cut")])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
			$total_rej_value+=$rej_value;
			$template_id=$template_id_arr[$orderRes[csf("po_id")]];
			/// for order popup define leter
			//<a href="##" onclick="openmypage_order('.$po_id.",".$company_name.",".$item_id.",0,'OrderPopup'".')"></a>

			$shortage = 0; $excess = 0; $balance = 0;
			if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
			{
				$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

				if($shortage<0)
				{
					//$shortage = "".ltrim($shortage,"-")."";
				}
			}
			else
			{
				//$shortage="(".ltrim($shortage,"-").")";
				//$shortage = "-";
			}

			if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
			{
				$excess = $ex_factory_qnty-$po_quantity_in_pcs;
			}
			else
			{
				$excess = 0;
			}

			$balance = $ex_factory_qnty-$po_quantity_in_pcs;
			//echo  $gmtsRow['PO_BREAK_DOWN_ID'];
			//	echo "<pre>"




			$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$k','$bgcolor') id=tr_2nd$k>";
			$html.='<td>'.$i.'</td>

					<td><p><a href="##" onclick="progress_comment_popup('.$orderRes[csf("po_id")].",'".$template_id."',".$tna_process_type.')">'.$orderRes[csf("po_number")].'</a></p></td>
					<td><p>'.$order_status[$orderRes[csf("is_confirmed")]].'</p></td>
					<td><p>'.$buyer_short_library[$orderRes[csf("buyer_name")]].'</p></td>
					<td align="center" title="'.$orderRes[PO_ID].'"><p>'.$orderRes[csf("job_no")].'</p></td>

					<td" align="center"><p>' . trim( $book_arr[$orderRes["PO_ID"]][$orderRes["ITEM_NUMBER_ID"]][$orderRes["COLOR_NUMBER_ID"]],',')


					.'</p></td>

					<td align="center"><p>'.$orderRes[csf("job_no_prefix_num")].'</p></td>
					<td align="center"><p>'.$orderRes[csf("grouping")].'</p></td>
					<td><p>'.$orderRes[csf("style_ref_no")].'</p></td>
					<td><p>'.$garments_item[$orderRes[csf("item_number_id")]].'</p></td>
					<td align="center"><p>'.$color_Arr_library[$orderRes[csf("color_number_id")]].'&nbsp;</p></td>
					<td align="right"><p><a href="##" onclick="openmypage_order_country('.$po_id.",".$company_name.",".$item_id.",'0',".$orderRes[csf("color_number_id")].",'OrderPopup_country'".')">'.$po_quantity_in_pcs.'</a></p></td>
					<td align="center"><p>'.change_date_format($orderRes[csf("shipment_date")]).'&nbsp;</p></td>
					<td align="center"><p>'.$pack_handover_date.'</p></td>
					<td align="center"><p>'.$ex_factory_date.'</p></td>
					<td align="right"><p>'.number_format($orderRes[csf("excess_cut")],2)." %".'</p></td>
					<td align="right"><p>'.number_format($plan_cut_qnty,0).'</p></td>

					<td" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','17','1','product_popup'".')">'.number_format($lay_qty,0).'</a></p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','1','1','product_popup'".')">'.number_format($cutting_qnty,0).'</a></p></td>

					<td align="right"><p>'.number_format($short_excess_cut_qnty,0).'</p></td>

					<td align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','1*1','product_popup'".')">'.number_format($print_issue_inhouse,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','3*1','product_popup'".')">'.number_format($print_issue_subcon,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','3','1*1','product_popup'".')">'.number_format($print_rcv_inhouse,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','3','3*1','product_popup'".')">'.number_format($print_rcv_subcon,0).'</a></p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','1*2','product_popup'".')">'.number_format($emb_issue_inhouse,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','3*2','product_popup'".')">'.number_format($emb_issue_subcon,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','1*2','product_popup'".')">'.number_format($emb_rcv_inhouse,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','3*2','product_popup'".')">'.number_format($emb_rcv_subcon,0).'</a></p></td>

					<td align="right"><p>'.number_format($spwork_issue,0).'</p></td>
					<td align="right"><p>'.number_format($spcial_rec,0).'</p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','4','1','product_popup'".')">'.number_format($sewingin_qnty,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','5','1','product_popup'".')">'.number_format($sewingout_qnty,0).'</a></p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','4','3','product_popup'".')">'.number_format($sewingin_subcon,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','5','3','product_popup'".')">'.number_format($sewingout_subcon,0).'</a></p></td>


					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','4','','product_popup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','5','','product_popup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','3','product_popup'".')">'.number_format($wash_issue,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','3','3','product_popup'".')">'.number_format($wash_rec,0).'</a></p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','11','1','product_popup'".')">'.number_format($poly_qnty_inhouse,0).'</p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','11','3','product_popup'".')">'.number_format($poly_qnty_outbound,0).'</p></td>

					<td align="right"><p>'.$total_poly_qnty.'</p></td>
					<td align="right"><p>'.number_format($poly_status,2)." %".'</p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','7','1','product_popup'".')">'.number_format($iron_qnty,0).'</a></p></td>
					<td align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>
					<td align="right"><p>'.number_format($finish_qnty_inhouse,0).' Qnty.' .$cartonInQnty.'</p></td>
					<td align="right"><p>'.number_format($finish_qnty_outbound,0).' Qnty.' .$cartonOutQnty.'</p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','8','300','fin_gmt_transfer_popup'".')">'.number_format($trans_in_qty,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','8','200','fin_gmt_transfer_popup'".')">'.number_format($trans_out_qty,0).'</a></p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','8','','product_popup'".')">'.number_format($total_finish_qnty,0).'</a>'.' Qnty.' .$cartonTotal_qnty.'</p></td>
					<td align="right"><p>'.number_format($finish_status,2)." %".'</p></td>

					<td align="right"><p><a href="##" onclick="openmypage_rej('.$po_id.",".$item_id.",'reject_qty','','".$orderRes[csf("color_number_id")]."','$type',''".')">'.$rej_value.'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','10','1','product_popup'".')">'.number_format($ex_factory_qnty,0).'</a>'.' Qnty.'.$ex_factory_carton_qnty.'</p></td>
					<td align="right"><p>'.$shortage.'</p></td>
					<td align="right"><p>'.$excess.'</p></td>
					<td align="right"><p>'.$balance.'</p></td>
					<td><p>'.$shipment_status[$orderRes[csf("shiping_status")]].'</p></td>
					<td>&nbsp;<a href="##" onclick="openmypage_color_countyr_remark('.$po_id.",'".$item_id."','0','".$orderRes[csf("color_number_id")]."','product_all_remarks'".')">Remarks</a></td>

				</tr>';
		}// end main foreach  exfactory
		// for remarks/view popup link <a href="##" onclick="openmypage_remark('.$po_id.",".$item_id.",0,'date_wise_production_report'".')"></a>


		$report_data = '<div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						Order Wise RMG Production Status
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						Company Name : '.$company_library[str_replace("'","",$cbo_company_name)].'
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">';

							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								$report_data .="From $fromDate To $toDate" ;
							}

				$report_data.='</td>
				</tr>
			</table>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">This Report is Generated based on Published Ship Date.</div>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">This Report Will Be Perfect When Order, Production, Delivery All Procedure Follow Color or Color & Size Level.</div>
			<div>
				<table>
					<thead>
						<tr>
							<th rowspan="2">Sl.</th>
							<th rowspan="2">Buyer Name</th>
							<th rowspan="2">Order Qty.(Pcs)</th>
							<th rowspan="2"">Cut and Lay Qty</th>
							<th rowspan="2">Cutting QC Qty</th>
							<th rowspan="2">Print Sent</th>
							<th rowspan="2">Print Received</th>
							<th rowspan="2">Embroidery Sent</th>
							<th rowspan="2" >Embroidery Received</th>
							<th rowspan="2" >Sp. Work Sent</th>
							<th rowspan="2">Sp. Work Received</th>
							<th colspan="2">In House</th>
							<th colspan="2">Sub-Contract</th>
							<th rowspan="2">Total Sewing Input Qty</th>
							<th rowspan="2">Total Sewing Output Qty</th>
							<th rowspan="2">Wash Sent</th>
							<th rowspan="2">Wash Received</th>
							<th rowspan="2">Total Iron Qty</th>
							<th  rowspan="2">Total Packing Qty</th>
							<th rowspan="2" >Finished Goods(%)</th>
							<th rowspan="2">Total Ex-Factory Qty</th>
							<th rowspan="2" >Ex-Factory(%)</th>
						 </tr>
						<tr>
							<th >Sew Input.</th>
							<th >Sew OutPut </th>
							<th >Sew Input.</th>
							<th >Sew OutPut </th>
						 </tr>
					</thead>
				</table>
				<div  >
					<table cellspacing="0" border="1">';

						$i=1; $total_po_quantity=0;$total_po_value=0; $total_cut=0; $total_print_iss=0;
						$total_print_re=0; $total_sew_input=0; $total_sew_out=0; $total_iron=0; $total_re_iron=0; $total_finish=0;$total_ex_factory=0;
						foreach($buyer_array as $buyer_id=>$value)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";


							$report_data.='<tr bgcolor="'.$bgcolor.'">
								<td>'.$i.'</td>
								<td>'.$buyer_short_library[$buyer_id].'</td>
								<td align="right">'.number_format($value["poQty"]).'</td>
								<td align="right">'.number_format($value["cutQty"]) .'</td>
								<td align="right">'.number_format($value["cQty"]).'</td>
								<td align="right">'.number_format($value["print"]).'</td>
								<td align="right">'.number_format($value["print_rec"]).'</td>
								<td align="right">'.number_format($value["emb"]).'</td>
								<td align="right">'.number_format($value["emb_rec"]).'</td>
								<td align="right">'.number_format($value["spwork"]).'</td>
								<td align="right">'.number_format($value["spwork_rec"]).'</td>
                                <td align="right">'.number_format($value["sQty"]).'</td>
								<td align="right">'.number_format($value["soQty"]).'</td>
								<td align="right">'.number_format($value["subcon_sewing"]).'</td>
								<td align="right">'.number_format($value["subcon_sewout"]).'</td>
								<td align="right">'.number_format($value["sQty"]+$value["subcon_sewing"]).'</td>
								<td align="right">'.number_format($value["soQty"]+$value["subcon_sewout"]).'</td>
								<td align="right">'.number_format($value["wash"]).'</td>
								<td align="right">'.number_format($value["wash_rec"]).'</td>
								<td align="right">'.number_format($value["iQty"]).'</td>
								<td align="right">'.number_format($value["fQty"]).'</td>';
								$finish_gd_status = ($value["fQty"]/$value["poQty"])*100;
								$report_data.='<td align="right">'.number_format($finish_gd_status,2).'</td>
								<td align="right">'.number_format($value["ex"]).'</td>';
								$ex_gd_status = ($value["ex"]/$value["poQty"])*100;
								$report_data.='<td align="right">'. number_format($ex_gd_status,2).'</td>
							</tr>';

								$total_po_quantity+=$value["poQty"];
								$total_cut+=$value["cQty"];
								$total_cut_and_lay+=$value["cutQty"];
								$total_sent_print+=$value["print"];
								$total_print_re+=$value["print_rec"];
								$total_emb+=$value["emb"];
								$total_emb_re+=$value["emb_rec"];
								$total_wash+=$value["wash"];
								$total_wash_re+=$value["wash_rec"];
								$total_spwork+=$value["spwork"];
								$total_spwork_re+=$value["spwork_rec"];
								$total_sew_input+=$value["sQty"];
								$total_sew_out+=$value["soQty"];
								$total_subcon_sewing+=$value["subcon_sewing"];
								$total_subcon_sewout+=$value["subcon_sewout"];
								$total_iron+=$value["iQty"];
								$total_re_iron+=$value["reiQty"];
								$total_finish+=$value["fQty"];
								$total_ex_factory+=$value["ex"];
							$i++;
						}//end foreach 1st

						$chart_data_qnty="Order Qty;".$total_po_quantity."\n"."Cutting;".$total_cut."\n"."Sew In;".$total_sew_input."\n"."Sew Out ;".$total_sew_out."\n"."Iron ;".$total_iron."\n"."Finish ;".$total_finish."\n"."Ex-Fact;".$total_ex_factory."\n";

						$report_data.='</table>
					<table border="1" class="tbl_bottom"  width="1960" rules="all">
						<tr>
							<td>&nbsp;</td>
							<td align="right">Total</td>
							<td id="tot_po_quantity">'.number_format($total_po_quantity).'</td>

							<td id="tot_cutting">'.number_format($total_cut_and_lay).'</td>
							<td id="tot_cutting">'.number_format($total_cut).'</td>

							<td id="tot_emb_rcv">'.number_format($total_sent_print).'</td>
							<td id="tot_sew_in">'.number_format($total_print_re).'</td>
							<td id="tot_sew_out">'.number_format($total_emb).'</td>
							<td id="tot_iron">'.number_format($total_emb_re).'</td>
							<td id="tot_sew_out">'.number_format($total_spwork).'</td>
							<td id="tot_iron">'.number_format($total_spwork_re).'</td>
							<td id="tot_sew_out">'.number_format($total_sew_input).'</td>
							<td id="tot_iron">'.number_format($total_sew_out).'</td>
							<td id="tot_iron">'.number_format($total_subcon_sewing).'</td>
							<td id="tot_sew_out">'.number_format($total_subcon_sewout).'</td>
							<td id="tot_emb_rcv">'.number_format($total_sew_input+$total_subcon_sewing).'</td>
							<td id="tot_sew_in">'.number_format($total_sew_out+$total_subcon_sewout).'</td>
							<td id="tot_emb_rcv">'.number_format($total_wash).'</td>
							<td id="tot_sew_in">'.number_format($total_wash_re).'</td>
							<td id="tot_iron">'.number_format($total_iron).'</td>
							<td id="tot_finish">'.number_format($total_finish).'</td>';
							$total_finish_gd_status = ($total_finish/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_finish_gd_status,2).'</td >
							<td>'.number_format($total_ex_factory).'</td >';
							$total_ex_status = ($total_ex_factory/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_ex_status,2).'</td>
						</tr>
					 </table>
				</div>
			</div>
			<table cellspacing="0" border="1">
				<thead>
					<tr>
						<th rowspan="2">SL</th>
						<th rowspan="2">Order Number</th>
                        <th rowspan="2">Order Status</th>
						<th rowspan="2">Buyer Name</th>
                        <th rowspan="2">Job Number</th>
						<th rowspan="2">Booking No</th>
                        <th rowspan="2">Job Prefix</th>
                        <th rowspan="2">Internal Ref</th>
						<th rowspan="2">Style Name</th>
						<th rowspan="2">Item Name</th>

                        <th rowspan="2">Color Name</th>
                        <th rowspan="2">Order Qty.</th>
						<th rowspan="2">Shipment Date</th>
						<th rowspan="2">PHD Date</th>
						<th rowspan="2">Ex-Factory Date</th>
						<th rowspan="2">Approved Cut %</th>
                        <th rowspan="2">Plan Cut Qty</th>
                        <th rowspan="2">Cut and Lay Qty</th>
						<th rowspan="2">Cutting QC Qty</th>
                        <th rowspan="2">Short/Excess Cut Qty</th>


                        <th rowspan="2">Short/Excess Cut%</th>
						<th colspan="2">Sent to Print</th>
						<th colspan="2">Rcv Print</th>
						<th colspan="2">Sent to Emb</th>
						<th colspan="2">Rcv Emb</th>
						<th rowspan="2">Sent to Sp. Works</th>
						<th rowspan="2">Rcv Sp. Works</th>
						<th colspan="2">InHouse</th>
						<th colspan="2">Out-bound Sub-Contact</th>
						<th rowspan="2">Total Sewing Input Qty</th>


						<th rowspan="2">Total Sewing Output Qty</th>
						<th rowspan="2">Sent to Wash</th>
						<th rowspan="2">Rcv Wash</th>
						<th colspan="3">Poly Qty</th>
						<th rowspan="2">Poly Comp%</th>
						<th rowspan="2">Total Iron Qty</th>
						<th rowspan="2">Total Re-Iron Qty</th>
						<th colspan="5">Finish Qty</th>
						<th rowspan="2">Fin Goods Status</th>
						<th rowspan="2">Reject Qty</th>


						<th rowspan="2">Total Ex-Factory</th>
						<th rowspan="2">Shortage Qty.</th>
						<th rowspan="2">Excess Qty.</th>
						<th rowspan="2">Balance Qty.</th>
						<th rowspan="2">Status</th>
                        <th rowspan="2">Remarks</th>
					 </tr>
					 <tr>
                        <th>Inhouse</th>
                        <th>SubCon</th>

                        <th>Inhouse</th>
                        <th>SubCon</th>

                        <th>Inhouse</th>
                        <th>SubCon</th>

                        <th>Inhouse</th>
                        <th>SubCon</th>

                        <th>Sew Input.</th>
                        <th>Sew OutPut </th>
                        <th>Sew Input.</th>
                        <th>Sew OutPut </th>
                        <th>In-house</th>
                        <th>Out-bound </th>
                        <th>Total</th>
                        <th>In-house</th>
                        <th>Out-bound </th>
                        <th>Transfer In </th>
                        <th>Transfer Out </th>
                        <th>Total</th>
					</tr>
				</thead>
			</table>
			<div>
				<table border="1">';
				$report_data.=$html;
				$report_data.='</table>
				<table border="1">
					<tr>
						<td></td>
						<td></td>
                        <td></td>
						<td></td>
                        <td></td>
                        <td></td>
                        <td></td>
						<td></td>
						<td></td>
                        <td></td>

                        <td">Total</td>
                        <td id="total_order_quantity"></td>
						<td></td>
						<td></td>
						<td></td>
                        <td></td>
                        <td id="total_plan_cutting"></td>
						<td id="total_lay"></td>
						<td id="total_cutting"></td>
                        <td id="short_access_cut"></td>

						<td></td>
                        <td id="total_print_issue_in"></td>
						<td id="total_print_receive_in"></td>
						<td id="total_print_receive_out"></td>
						<td id="total_emb_issue_in"></td>
                        <td id="total_emb_issue_out"></td>
						<td id="total_emb_receive_in"></td>
						<td id="total_emb_receive_out"></td>
						<td id="total_sp_issue"></td>
						<td id="total_sp_receive"></td>

						<td id="total_sewing_input"></td>
						<td id="total_sewing_out"></td>
						<td id="total_subcon_sewing_input"></td>
						<td id="total_subcon_sewing_out"></td>
						<td id="total_sewing_input_all_qnty"></td>
						<td id="total_sewing_output_all_qnty"></td>
						<td id="total_wash_issue"></td>
						<td id="total_wash_receive"></td>
						<td id="poly_qnty_inhouse"></td>
                        <td id="poly_qnty_subcon"></td>

                        <td id="total_poly_qnty"></td>
						<td></td>
						<td id="total_iron_qnty"></td>
						<td id="total_re_iron_qnty"></td>
						<td id="finish_qnty_inhouse"></td>
                        <td id="finish_qnty_subcon"></td>
                        <td id="finish_qnty_transferIn"></td>
                        <td id="finish_qnty_transferOut"></td>
                        <td id="total_finish_qnty"></td>
						<td></td>
						<td align="right" id="total_rej_value_td"></td>
						<td id="total_exfact"></td>
						<td><span id="total_shortage"></span></td>
						<td id="td_excess"></td>
						<td align="right"><span id="td_balance"></span></td>
						<td></td>
                        <td></td>
					 </tr>
				</table>
			</div>
			<br>
			<br>
		 </div>';

	}
	else if($type==3) // country wise ezcel
	{
		$country_library=return_library_array( "select id,country_name from lib_country", "id", "country_name"  );

		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}
		//if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";

		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_season_id!=0) $str_po_cond.=" and a.season_buyer_wise=$cbo_season_id";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and c.country_ship_date between '$txt_datefrom' and '$txt_dateto'";


		if($country_id>0) $str_po_cond.=" and c.country_id=$country_id";

		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";

		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";
		if($active_status==0) $active_cond 		= " and b.status_active=1 and c.status_active=1 ";

		$order_sql="SELECT a.id job_id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.id as po_id, b.po_number, b.excess_cut, b.is_confirmed,b.pack_handover_date, c.item_number_id as item_number_id, c.country_id, c.country_ship_date, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total ,max(c.shiping_status) as shiping_status,sum(c.plan_cut_qnty) as plan_cut_qnty
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0   $active_cond $str_po_cond $txt_style_ref_number_cond   $internal_ref_cond_po $order_status_cond
		group by a.id, a.job_no_prefix_num,a.job_no, a.insert_date, a.company_name, a.buyer_name, a.style_ref_no, b.id,b.po_number, b.excess_cut, b.is_confirmed,b.pack_handover_date, c.item_number_id, c.country_id, c.country_ship_date, c.color_number_id
		order by c.country_ship_date, b.id, c.item_number_id, c.country_id, c.color_number_id";// and b.status_active in(1,2,3)

		// echo $order_sql."<br>";


		$sql_po_result=sql_select($order_sql);
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("po_id")].",";
		}
		$all_po_id=implode(',',array_unique(explode(",",chop($all_po_id,","))));
		//echo count(explode(",",$all_po_id));die;
		$template_id_arr=return_library_array("select po_number_id, template_id from tna_process_mst where po_number_id in ('".$all_po_id."') group by po_number_id, template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and a.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(explode(",",$all_po_id),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (a.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or a.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}

			}
		}


		if($po_product_cond=="")
		{
			echo '<div style="color:#FF0000; font-size:14px; font-weight:bold; margin:0 auto; text-align:center; width:1930px">No Data Found.</div>'; die;
		}
		// ========================================== cut and lay data =================================
		$all_po_ids_cond = str_replace("a.po_break_down_id", "c.order_id", $po_product_cond);
		$sql_cutlay="SELECT a.entry_form,b.order_id as po_id,b.gmt_item_id as gmts,b.color_id,c.order_id,c.country_id,sum(c.size_qty ) as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name $all_po_ids_cond  group by a.entry_form,b.order_id,c.country_id,b.gmt_item_id,b.color_id,c.order_id";
		// echo $sql_cutlay;die();
		$sql_res=sql_select($sql_cutlay);
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			// if($entry_form!=76)
			// {
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("country_id")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
			/*}
			else
			{
				$cut_lay_arrs[$vals[csf("po_id")]][$vals[csf("gmts")]][$vals[csf("country_id")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
			}*/
		}
		// echo "<pre>";print_r($cut_lay_arrs);


		$color_id_arr=return_library_array( "select a.id,a.color_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 $po_product_cond", "id", "color_number_id");



		$entry_break_down_type_exf=return_field_value("ex_factory","variable_settings_production","company_name=$cbo_company_name and variable_list=1 and status_active=1","ex_factory");
		$ex_factory_arr=array();
		if($entry_break_down_type_exf !=1) // not gross level
		{
			$ex_factory_data=sql_select("SELECT a.po_break_down_id, a.item_number_id, a.country_id, MAX(a.ex_factory_date) AS ex_factory_date, b.color_size_break_down_id,
			sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as ex_factory_qnty ,a.total_carton_qnty
			 from pro_ex_factory_mst a, pro_ex_factory_dtls b
			 where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 $po_product_cond
			 group by a.po_break_down_id, a.item_number_id, a.country_id, b.color_size_break_down_id,a.total_carton_qnty");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		}
		else
		{
			$ex_factory_data=sql_select("SELECT a.po_break_down_id, a.item_number_id, a.country_id, MAX(a.ex_factory_date) AS ex_factory_date,
			sum(CASE WHEN a.entry_form!=85 THEN a.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN a.ex_factory_qnty ELSE 0 END) as ex_factory_qnty ,a.total_carton_qnty
			 from pro_ex_factory_mst a
			 where a.status_active=1 and a.is_deleted=0 $po_product_cond
			 group by a.po_break_down_id, a.item_number_id, a.country_id,a.total_carton_qnty");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		}
		// echo "<pre>";print_r($ex_factory_arr);die;

		unset($ex_factory_data);


		//if($txt_datefrom!="" && $txt_dateto!="") $str_cond_product.=" and e.country_ship_date between  '$txt_datefrom' and '$txt_dateto'";
		//if($country_id>0) $str_cond_product.=" and c.country_id=$country_id";


		if($db_type==0)
		{
			$prod_sql="SELECT a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN a.production_type ='2'  and b.production_type='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'   and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,


				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4'  and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type=5 THEN b.production_qnty ELSE 0 END),0) AS trans_in_qty,
				IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type=6 THEN b.production_qnty ELSE 0 END),0) AS trans_out_qty,


				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN a.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN a.production_type ='1' and b.production_type='1'  THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  THEN b.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c	where
				a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and a.country_id=c.country_id and a.item_number_id=c.item_number_id $active_cond_c $po_product_cond $internal_ref_cond_prod and b.status_active=1 and b.is_deleted=0 and c.status_active in(1,2,3) and c.is_deleted=0
			group by a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id";

			$sql_carton_qty=sql_select("select a.po_break_down_id,a.country_id,
			IFNULL(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a where a.status_active=1 and a.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by a.po_break_down_id,a.country_id");
		}
		else
		{
			$prod_sql= "SELECT a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type ='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,



				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type ='4' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type ='4' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=5 THEN b.production_qnty ELSE 0 END),0) AS trans_in_qty,
				NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=6 THEN b.production_qnty ELSE 0 END),0) AS trans_out_qty,

				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN a.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type ='1' THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type ='1' THEN b.replace_qty ELSE 0 END),0) AS cutting_replace_qty,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and b.is_rescan=0 THEN b.reject_qty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and b.is_rescan!=0 THEN b.production_qnty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' THEN b.replace_qty ELSE 0 END),0) AS sewingout_rej_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c
			where
				a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and a.country_id=c.country_id and a.item_number_id=c.item_number_id $active_cond_c $po_product_cond $internal_ref_cond_prod   and b.status_active=1 and b.is_deleted=0 and c.status_active in(1,2,3) and c.is_deleted=0
			group by a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id";

			$sql_carton_qty=sql_select("select a.po_break_down_id,a.country_id,
			NVL(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			NVL(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			NVL(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a where a.status_active=1 and a.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by a.po_break_down_id,a.country_id");
		}
		//echo $prod_sql;exit();
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		}

		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);

		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_qnty']+=$gmtsRow[csf('cutting_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printing_qnty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['wash']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printreceived_qnty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printr']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['embr']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['washr']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['specialr']+=$gmtsRow[csf('specialr')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_in']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_in']+=$gmtsRow[csf('sewingout_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_out']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			//$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_qnty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['re_iron_qnty']+=$gmtsRow[csf('re_iron_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];


			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_rej_qnty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_replace_qty']+=$gmtsRow[csf('cutting_replace_qty')];


			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rej_qnty']+=$gmtsRow[csf('emb_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_rej_qnty']+=$gmtsRow[csf('iron_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_rej_qnty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_rej_qnty']+=$gmtsRow[csf('finish_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_rej_qnty']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewing_input_rej_qnty']+=$gmtsRow[csf('sewing_input_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_rej_qnty']+=$gmtsRow[csf('emb_issue_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_in_qty']+=$gmtsRow[csf('trans_in_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];
		}




		$result=sql_select($order_sql);
		$i=0; $k=0; $date=date("Y-m-d");
		$days_in_hand="";
		foreach($result as $orderRes)
		{

		   $i++;
		   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

			$k++;

			$lay_qty = $cut_lay_arrs[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]];

			if($entry_break_down_type_exf !=1) // not gross level
			{
				$ex_factory_date=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['date'];
				$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['qty'];
				$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['ex_fac_carton_qty'];
			}
			else
			{
				$ex_factory_date=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]]['date'];
				$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]]['qty'];
				$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]]['ex_fac_carton_qty'];
			}




			$color=""; $days_remian="";
			$days_remian=datediff("d",$date,$orderRes[csf("country_ship_date")]);
			$days_in_hand=datediff("d",$date,$orderRes[csf("country_ship_date")]);
			if($orderRes[csf("country_ship_date")] > $date)
			{
				$color="";
			}
			else if($orderRes[csf("country_ship_date")] < $date)
			{
				$color="red";
			}
			else if($orderRes[csf("country_ship_date")] >= $date && $days_remian<=5 )
			{
				$color="orange";
			}
			//end if condition
			//if($days_in_hand<0) $days_in_hand=abs($days_in_hand)." Days Pass";
			//print_r($gmts_prod_arr[$orderRes[csf("id")]]);



			$cutting_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['cutting_qnty'];
			$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['printreceived_qnty'];
			$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_in'];
			$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_in'];
			$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_out'];
			$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_out'];
			$iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['iron_qnty'];
			$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['re_iron_qnty'];
			//$finish_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_qnty'];
			$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_inhouse'];
			$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_outbound'];

			$print_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print'];
			$embl_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb'];
			$wash_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['wash'];
			$spwork_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['special'];
			$print_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['printr'];
			$emb_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['embr'];
			$wash_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['washr'];
			$spcial_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['specialr'];


			$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_issue_inhouse'];
			$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_issue_subcon'];
			$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_rcv_inhouse'];
			$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_rcv_subcon'];

			$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_inhouse'];
			$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_subcon'];
			$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_inhouse'];
			$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_subcon'];



			$cutting_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['cutting_rej_qnty'];
			$emb_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rej_qnty'];
			$iron_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['iron_rej_qnty'];
			$sewing_out_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_rej_qnty'];

			$cutting_replace_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['cutting_replace_qty'];

			$finish_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_rej_qnty'];

			$poly_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['poly_rej_qnty'];

			$sewing_input_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewing_input_rej_qnty'];

			$emb_issue_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_rej_qnty'];

			$trans_in_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['trans_in_qty'];
			$trans_out_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['trans_out_qty'];

			$cartonInQnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_qty_no_inhouse'];
			$cartonOutQnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_qty_no_outbound'];
			$cartonTotal_qnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_total_qty'];

			$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$orderRes[csf("order_quantity")];
			$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$orderRes[csf("order_total")];
			$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
			$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;


			$po_quantity_in_pcs=$orderRes[csf("order_quantity")];
			$plan_cut_qnty=$orderRes[csf("plan_cut_qnty")];
			//$actual_exces_cut = $cutting_qnty;
			$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
			$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);
			$excess_cut_percent=$short_excess_cut_percent-$orderRes[csf("excess_cut")];

			//if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

			$embl_recv_qty=$print_rec+$emb_rec+$wash_rec+$spcial_rec;

			$rej_value=$cutting_reject+$emb_reject+$iron_reject+$sewing_input_rej_qnty+$finish_reject+$poly_rej_qnty+$emb_issue_rej_qnty;

			$sewing_rej_value=$sewing_out_reject;

			$finish_status = $finish_qnty*100/$po_quantity_in_pcs;

			$company_name=$orderRes[csf("company_name")];
			$po_id=$orderRes[csf("po_id")];
			$item_id=$orderRes[csf("item_number_id")];
			if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);

			if(($orderRes[csf("pack_handover_date")]=="" || $orderRes[csf("pack_handover_date")]=="0000-00-00")) $pack_handover_date="&nbsp;"; else $pack_handover_date=change_date_format($orderRes[csf("pack_handover_date")]);

			//if($orderRes[csf("shiping_status")]==3) $days_remian=$days_remian; else $days_remian="---";
			//if(round($actual_exces_cut) > round($orderRes[csf("excess_cut")])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
			$total_rej_value+=$rej_value;

			$total_rej_value+=$sewing_rej_value;

			$template_id=$template_id_arr[$orderRes[csf("po_id")]];
			/// for order popup define leter
			//

			$shortage = 0; $excess = 0; $balance = 0;
			if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
			{
				$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

				if($shortage<0)
				{
					//$shortage = "".ltrim($shortage,"-")."";
				}
			}
			else
			{
				//$shortage="(".ltrim($shortage,"-").")";
				//$shortage = "-";
			}

			if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
			{
				$excess = $ex_factory_qnty-$po_quantity_in_pcs;
			}
			else
			{
				$excess = 0;
			}

			$balance = $ex_factory_qnty-$po_quantity_in_pcs;

			$total_cut_qty = $cutting_replace_qty + $lay_qty;
			$gt_po_qty	+=$po_quantity_in_pcs;
				$gt_plan_cut_qty += $plan_cut_qnty;
				$gt_cut_lay_qty += $lay_qty;
				$gt_cutting_replace_qty += $cutting_replace_qty;
				$gt_total_cut_qty	+= $total_cut_qty;
				$gt_cutting_qc_qty += $cutting_qnty;
				$gt_short_excess_cut_qnty += $short_excess_cut_qnty;
				$gt_print_issue_inhouse   += $print_issue_inhouse;
				$gt_print_issue_subcon       += $print_issue_subcon;
				$gt_print_rcv_inhouse	 += $print_rcv_inhouse;
				$gt_print_rcv_subcon	 += $print_rcv_subcon;
				$gt_emb_issue_inhouse    += $emb_issue_inhouse;
				$gt_emb_issue_subcon       += $emb_issue_subcon;
				$gt_emb_rcv_inhouse       += $emb_rcv_inhouse;
				$gt_emb_rcv_subcon        += $emb_rcv_subcon;
				$gt_spc_qty_issue         += $spwork_issue;
				$gt_spcial_rec			  += $spcial_rec;
				$gt_sewingin_qnty += $sewingin_qnty ;
				$gt_sewingout_qnty += $sewingout_qnty;
				$gt_sewingin_subcon += $sewingin_subcon;
				$gt_sewingout_subcon += $sewingout_subcon;
				$gt_ttl_sewingin_qnty += ($sewingin_qnty+$sewingin_subcon);
				$gt_ttl_sewingout_qnty += ($sewingout_qnty+$sewingout_subcon);
				$gt_wash_qty_issue		+= $wash_issue;
				$gt_wash_rec			+= $wash_rec;
				$gt_iron_qnty			+= $iron_qnty;
				$gt_re_iron_qnty			+= $re_iron_qnty;
				$gt_finish_qnty_inhouse     += $finish_qnty_inhouse;
				$gt_finish_qnty_outbound	+= $finish_qnty_outbound;
				$gt_finish_qnty_transferIn  += $trans_in_qty;
				$gt_finish_qnty_transferOut	+= $trans_out_qty;
				$gt_total_finish_qnty	+= $total_finish_qnty;
				$gt_rej_value			+= $rej_value;
				$gt_sewing_rej_value		+= $sewing_rej_value;
				$gt_ex_factory_qnty			+=	$ex_factory_qnty;
				$gt_shortage				+=	$shortage;
				$gt_excess					+= $excess;
				$gt_balance					+= $balance;
				$gt_cartonInQnty			+= $cartonInQnty;
				$gt_cartonOutQnty			+= $cartonOutQnty;
				$gt_cartonTotal_qnty		+= $cartonTotal_qnty ;
				$gt_ex_factory_carton_qnty		+= $ex_factory_carton_qnty;

			$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$k','$bgcolor') id=tr_2nd$k>";
			$html.='<td><p>'.$display_font_color.$i.$font_end.'</p></td>
					<td><p><a href="##" onclick="progress_comment_popup('.$orderRes[csf("po_id")].",'".$template_id."',".$tna_process_type.')">'.$display_font_color.$orderRes[csf("po_number")].$font_end.'</a></p></td>
					<td><p>'.$display_font_color.$order_status[$orderRes[csf("is_confirmed")]].$font_end.'</p></td>
					<td><p>'.$display_font_color.$buyer_short_library[$orderRes[csf("buyer_name")]].$font_end.'</p></td>
					<td align="center"><p>'.$display_font_color.$orderRes[csf("job_year")].$font_end.'</p></td>
					<td align="center"><p>'.$display_font_color.$orderRes[csf("job_no")].$font_end.'</p></td>
					<td align="center"><p>'.$display_font_color.$orderRes[csf("job_no_prefix_num")].$font_end.'</p></td>
					<td><p>'.$display_font_color.$orderRes[csf("style_ref_no")].$font_end.'</p></td>
					<td><p>'.$garments_item[$orderRes[csf("item_number_id")]].'</p></td>
					<td align="center" bgcolor="'.$color.'"><div>'.change_date_format($orderRes[csf("country_ship_date")]).'&nbsp;</div></td>
					<td align="center" bgcolor="'.$color.'"><p>'.$country_library[$orderRes[csf("country_id")]].'&nbsp;</p></td>
					<td align="center" bgcolor="'.$color.'"><p>'.$color_Arr_library[$orderRes[csf("color_number_id")]].'&nbsp;</p></td>
					<td align="right"><p><a href="##" onclick="openmypage_order_country('.$po_id.",".$company_name.",".$item_id.",".$orderRes[csf("country_id")].",".$orderRes[csf("color_number_id")].",'OrderPopup_country'".')">'.$po_quantity_in_pcs.'</a></p></td>
					<td align="right"><p>'.$pack_handover_date.'</p></td>
					<td align="right"><p>'.$ex_factory_date.'</p></td>
					<td align="right"><p>'.number_format($orderRes[csf("excess_cut")],0)." %".'&nbsp;</p></td>
					<td align="right"><p>'.number_format($plan_cut_qnty,0).'&nbsp;</p></td>
					<td align="right"><p>'.number_format($lay_qty,0).'&nbsp;</p></td>
					<td align="right"><p>'.number_format($cutting_replace_qty,0).'&nbsp;</p></td>
					<td align="right"><p>'.number_format($total_cut_qty,0).'&nbsp;</p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','1','0','product_popup'".')">'.number_format($cutting_qnty,0).'</a></p></td>
					<td align="right"><p>'.number_format($short_excess_cut_qnty,0).'</p></td>
					<td align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>


					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','1*1','product_popup'".')">'.number_format($print_issue_inhouse,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','3*1','product_popup'".')">'.number_format($print_issue_subcon,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','1*1','product_popup'".')">'.number_format($print_rcv_inhouse,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','3*1','product_popup'".')">'.number_format($print_rcv_subcon,0).'</a></p></td>


					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','1*2','product_popup'".')">'.number_format($emb_issue_inhouse,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','3*2','product_popup'".')">'.number_format($emb_issue_subcon,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','1*2','product_popup'".')">'.number_format($emb_rcv_inhouse,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','3*2','product_popup'".')">'.number_format($emb_rcv_subcon,0).'</a></p></td>



					<td align="right"><p>'.number_format($spwork_issue,0).'</p></td>
					<td align="right"><p>'.number_format($spcial_rec,0).'</p></td>

					<td align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($sewingin_qnty,0).'</p></td>
					<td align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($sewingout_qnty,0).'</p></td>

					<td align="right"><p>'.number_format($sewingin_subcon,0).'</p></a></td>
					<td align="right"><p>'.number_format($sewingout_subcon,0).'</p></td>


					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','4','','product_popup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','5','','product_popup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','3','product_popup'".')">'.number_format($wash_issue,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','3','product_popup'".')">'.number_format($wash_rec,0).'</a></p></td>
					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','7','1','product_popup'".')">'.number_format($iron_qnty,0).'</a></p></td>
					<td align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>


					<td align="right"><p>'.number_format($finish_qnty_inhouse,0).'<br>'.'Ctn: '.$cartonInQnty.'</p></td>
					<td align="right"><p>'.number_format($finish_qnty_outbound,0).'<br>'.'Ctn: '.$cartonOutQnty.'</p></td>

						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','8','300','fin_gmt_transfer_popup'".')">'.number_format($trans_in_qty,0).'</a></p></td>
						<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','8','200','fin_gmt_transfer_popup'".')">'.number_format($trans_out_qty,0).'</a></p></td>

					<td align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','8','1','product_popup'".')">'.number_format($total_finish_qnty,0).'</a><br>'.'Ctn: '.$cartonTotal_qnty.'</p></td>

					<td align="right"><p>'.number_format($finish_status,2)." %".'</p></td>


					<td align="right"><p><a href="##" onclick="openmypage_rej('.$po_id.",".$item_id.",'reject_qty','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','$type',''".')">'.number_format($rej_value,0).'</a></td>


					<td align="right"><p><a href="##" onclick="openmypage_sewing_rej('.$po_id.",".$item_id.",'sewing_reject_qty','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','$type',''".')">'.number_format($sewing_rej_value,0).'</a></p></td>


					<td align="right"><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','10','1','product_popup'".')" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'">'.number_format($ex_factory_qnty,0).'</a><br>'.'Ctn: '.$ex_factory_carton_qnty.'</p></td>

					<td align="right"><p>'.$shortage.'</p></td>
					<td align="right"><p>'.$excess.'</p></td>
					<td align="right"><p>'.$balance.'</p></td>
				</tr>';
				//Issue872
		}// end main foreach  exfactory
		// for remarks/view popup link <a href="##" onclick="openmypage_remark('.$po_id.",".$item_id.",0,'date_wise_production_report'".')"></a>

        $report_data ='<div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						Order Wise RMG Production Status
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						Company Name :'.$company_library[str_replace("'","",$cbo_company_name)].'
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold" >';

							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								$report_data.= "From $fromDate To $toDate" ;
							}

				$report_data.='</td>
				</tr>
			</table>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left;">This Report  is Generated based on Country Ship Date.</div>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">This Report Will Be Perfect When Order, Production, Delivery All Procedure Follow Color or Color & Size Level.</div>
			<div style="float:left;">
				<table cellspacing="0" border="1">
					<thead>

						 <tr>
							<th rowspan="2">Sl.</th>
							<th rowspan="2">Buyer Name</th>
							<th rowspan="2">Order Qty.(Pcs)</th>
							<th rowspan="2">Cutting QC Qty</th>
							<th rowspan="2">Print Sent</th>
							<th rowspan="2">Print Received</th>
							<th rowspan="2">Embroidery Sent</th>
							<th rowspan="2" >Embroidery Received</th>
							<th rowspan="2" >Sp. Work Sent</th>
							<th rowspan="2">Sp. Work Received</th>
							<th colspan="2">In House</th>
							<th colspan="2">Out bound Sub-Contact</th>
							<th rowspan="2">Total Sewing Input Qty</th>
							<th rowspan="2">Total Sewing Output Qty</th>
							<th rowspan="2">Wash Sent</th>
							<th rowspan="2">Wash Received</th>
							<th rowspan="2">Total Iron Qty</th>
							<th  rowspan="2">Total Packing/Carton Qty</th>
							<th rowspan="2" >Finished Goods(%)</th>
							<th rowspan="2">Total Ex-Factory Qty</th>
							<th rowspan="2" >Ex-Factory(%)</th>
						 </tr>
						<tr>
							<th >Sew Input.</th>
							<th >Sew OutPut </th>
							<th >Sew Input.</th>
							<th >Sew OutPut </th>
						 </tr>

					</thead>
				</table>
				<div style="max-height:425px; overflow-y:scroll; width:1900px" >
					<table cellspacing="0" border="1">';

						$i=1; $total_po_quantity=0;$total_po_value=0; $total_cut=0; $total_print_iss=0;
						$total_print_re=0; $total_sew_input=0; $total_sew_out=0; $total_iron=0; $total_re_iron=0; $total_finish=0;$total_ex_factory=0;
						foreach($buyer_array as $buyer_id=>$value)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";


							$report_data.='<tr bgcolor="'.$bgcolor.'">
								<td>'.$i.'</td>
								<td>'.$buyer_short_library[$buyer_id].'</td>
								<td align="right">'.number_format($value["poQty"]).'</td>
								<td align="right">'.number_format($value["cQty"]).'</td>
								<td align="right">'.number_format($value["print"]).'</td>
								<td align="right">'.number_format($value["print_rec"]).'</td>
								<td align="right">'.number_format($value["emb"]).'</td>
								<td align="right">'.number_format($value["emb_rec"]).'</td>
								<td align="right">'.number_format($value["spwork"]).'</td>
								<td align="right">'.number_format($value["spwork_rec"]).'</td>
                                <td align="right">'.number_format($value["sQty"]).'</td>
								<td align="right">'.number_format($value["soQty"]).'</td>
								<td align="right">'.number_format($value["subcon_sewing"]).'</td>
								<td align="right">'.number_format($value["subcon_sewout"]).'</td>
								<td align="right">'.number_format($value["sQty"]+$value["subcon_sewing"]).'</td>
								<td align="right">'.number_format($value["soQty"]+$value["subcon_sewout"]).'</td>
								<td align="right">'.number_format($value["wash"]).'</td>
								<td align="right">'.number_format($value["wash_rec"]).'</td>
								<td align="right">'.number_format($value["iQty"]).'</td>
								<td align="right">'.number_format($value["fQty"]).'</td>';
								$finish_gd_status = ($value["fQty"]/$value["poQty"])*100;
								$report_data.='<td align="right">'.number_format($finish_gd_status,2).'</td>
								<td align="right">'.number_format($value["ex"]).'</td>';
								$ex_gd_status = ($value["ex"]/$value["poQty"])*100;
								$report_data.='<td align="right">'. number_format($ex_gd_status,2).'</td>
							</tr>';

								$total_po_quantity+=$value["poQty"];
								$total_cut+=$value["cQty"];
								$total_sent_print+=$value["print"];
								$total_print_re+=$value["print_rec"];
								$total_emb+=$value["emb"];
								$total_emb_re+=$value["emb_rec"];
								$total_wash+=$value["wash"];
								$total_wash_re+=$value["wash_rec"];
								$total_spwork+=$value["spwork"];
								$total_spwork_re+=$value["spwork_rec"];
								$total_sew_input+=$value["sQty"];
								$total_sew_out+=$value["soQty"];
								$total_subcon_sewing+=$value["subcon_sewing"];
								$total_subcon_sewout+=$value["subcon_sewout"];
								$total_iron+=$value["iQty"];
								$total_re_iron+=$value["reiQty"];
								$total_finish+=$value["fQty"];
								$total_ex_factory+=$value["ex"];
							$i++;
						}//end foreach 1st

						$chart_data_qnty="Order Qty;".$total_po_quantity."\n"."Cutting;".$total_cut."\n"."Sew In;".$total_sew_input."\n"."Sew Out ;".$total_sew_out."\n"."Iron ;".$total_iron."\n"."Finish ;".$total_finish."\n"."Ex-Fact;".$total_ex_factory."\n";

					$report_data.='</table>
					<table border="1">
						<tr>
							<td>&nbsp;</td>
							<td align="right">Total</td>
							<td >'.number_format($total_po_quantity).'</td>
							<td >'.number_format($total_cut).'</td>
							<td >'.number_format($total_sent_print).'</td>
							<td >'.number_format($total_print_re).'</td>
							<td >'.number_format($total_emb).'</td>
							<td >'.number_format($total_emb_re).'</td>
							<td >'.number_format($total_spwork).'</td>
							<td >'.number_format($total_spwork_re).'</td>
							<td >'.number_format($total_sew_input).'</td>
							<td >'.number_format($total_sew_out).'</td>
							<td >'.number_format($total_subcon_sewing).'</td>
							<td >'.number_format($total_subcon_sewout).'</td>
							<td >'.number_format($total_sew_input+$total_subcon_sewing).'</td>
							<td >'.number_format($total_subcon_sewout+$total_sew_out).'</td>
							<td >'.number_format($total_wash).'</td>
							<td >'.number_format($total_wash_re).'</td>
							<td >'.number_format($total_iron).'</td>
							<td >'.number_format($total_finish).'</td>';
							$total_finish_gd_status = ($total_finish/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_finish_gd_status,2).'</td >
							<td>'.number_format($total_ex_factory).'</td >';
							$total_ex_status = ($total_ex_factory/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_ex_status,2).'</td>
						</tr>
					 </table>
				</div>
			</div>

				<div align="center" style="height:auto; margin:0 auto; padding:0;">
					<table border="1" cellpadding="0" cellspacing="0">
						<thead>
							<tr>
								<th rowspan="2">SL</th>
								<th rowspan="2">Order No.</th>
								<th rowspan="2">Order Status</th>
								<th rowspan="2">Buyer Name</th>
								<th rowspan="2">Job Year</th>
								<th rowspan="2">Job No.</th>
								<th rowspan="2">Job Prefix.</th>
								<th rowspan="2">Style Name</th>
								<th rowspan="2">Item Name</th>
								<th rowspan="2">Country Ship Date</th>
								<th rowspan="2">Country Name</th>
								<th rowspan="2">Color Name</th>
								<th rowspan="2">Order Qty.</th>
								<th rowspan="2">PHD Date</th>
								<th rowspan="2">Ex- Factory Date</th>
								<th rowspan="2">Approved Cut %</th>
								<th rowspan="2">Plan Cut Qty</th>
								<th rowspan="2">Cut Qty</th>
								<th rowspan="2">Replace Qty</th>
								<th rowspan="2">Total Cut Qty</th>
								<th rowspan="2">Cutting QC Qty</th>
								<th rowspan="2">Short/ Excess Cut Qty.</th>
								<th rowspan="2">Short/ Excess Cut %</th>

								<th colspan="2">Sent to Print</th>
								<th colspan="2">Rcv Print</th>
								<th colspan="2">Sent to Emb</th>
								<th colspan="2">Rcv Emb</th>

								<th rowspan="2" >Sent to Sp. Works</th>
								<th rowspan="2">Rcv Sp. Works</th>
								<th colspan="2">InHouse</th>
								<th colspan="2">Out-bound Sub-Contact</th>
								<th rowspan="2">Total Sewing Input Qty</th>
								<th rowspan="2">Total Sewing Output Qty</th>
								<th rowspan="2">Sent to Wash</th>
								<th rowspan="2">Rcv Wash</th>
								<th rowspan="2">Total Iron Qty</th>
								<th rowspan="2">Total Re-Iron Qty</th>
								<th colspan="5">Finish Qty</th>
								<th rowspan="2">Fin Goods Status</th>
								<th rowspan="2">Reject Qty</th>

								<th rowspan="2">Sewing Reject Qty</th>

								<th rowspan="2">Total Ex-Factory</th>
								<th rowspan="2">Shortage Qty.</th>
								<th rowspan="2">Excess Qty.</th>
								<th rowspan="2">Balance Qty.</th>
							</tr>
							<tr>
								<th>Inhouse</th>
								<th>SubCon</th>
								<th>Inhouse</th>
								<th>SubCon</th>
								<th>Inhouse</th>
								<th>SubCon</th>
								<th>Inhouse</th>
								<th>SubCon</th>
								<th>Sew Input.</th>
								<th>Sew OutPut </th>
								<th>Sew Input.</th>
								<th>Sew OutPut </th>
								<th >In-house</th>
								<th >Out-bound </th>
								<th >Transfer In </th>
								<th >Transfer Out </th>
								<th >Total</th>
							</tr>
						</thead>
					</table>
					<div>
						<table  border="1" cellpadding="2" cellspacing="0">';
						$report_data.=$html;
						$report_data.='</table>
					</div>
					<div>
						<table cellspacing="0" cellpadding="0" border="1">
							<tfoot>
								<tr>
									<th></th>
									<th"></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th></th>
									<th"></th>
									<th></th>
									<th></th>
									<th></th>
									<th>Total</th>
									<th id="total_order_quantity">'.$gt_po_qty.'</th>
									<th></th>
									<th></th>
									<th></th>
									<th id="plan_cut_qnty">'.$gt_plan_cut_qty.'</th>
									<th id="total_lay">'.$gt_cut_lay_qty .'</th>
									<th id="replace_qty">'.$gt_cutting_replace_qty.'</th>
									<th id="total_cut_qty">'.$gt_total_cut_qty.'</th>
									<th id="total_cutting">'.$gt_cutting_qc_qty.'</th>
									<th id="short_excess_cut">'.$gt_short_excess_cut_qnty.'</th>
									<th></th>

									<th id="total_print_issue_in">'.$gt_print_issue_inhouse.'</th>
									<th id="total_print_issue_out">'.$gt_print_issue_subcon.'</th>
									<th id="total_print_receive_in">'.$gt_print_rcv_inhouse.'</th>
									<th id="total_print_receive_out">'.$gt_print_rcv_subcon.'</th>
									<th id="total_emb_issue_in">'.$gt_emb_issue_inhouse.'</th>
									<th id="total_emb_issue_out">'.$gt_emb_issue_subcon.'</th>
									<th id="total_emb_receive_in">'.$gt_emb_rcv_inhouse.'</th>
									<th id="total_emb_receive_out">'.$gt_emb_rcv_subcon.'</th>

									<th id="total_sp_issue">'.$gt_spc_qty_issue.'</th>
									<th id="total_sp_receive">'.$gt_spcial_rec.'</th>
									<th id="total_sewing_input">'.$gt_sewingin_qnty.'</th>
									<th id="total_sewing_out">'.$gt_sewingout_qnty.'</th>
									<th id="total_subcon_sewing_input">'.$gt_sewingin_subcon.'</th>
									<th id="total_subcon_sewing_out">'.$gt_sewingout_subcon.'</th>
									<th id="total_sewing_input_all_qnty">'.$gt_ttl_sewingin_qnty.'</th>
									<th id="total_sewing_output_all_qnty">'.$gt_ttl_sewingout_qnty.'</th>
									<th id="total_wash_issue">'.$gt_wash_qty_issue.'</th>
									<th id="total_wash_receive">'.$gt_wash_rec.'</th>
									<th id="total_iron_qnty">'.$gt_iron_qnty.'</th>
									<th id="total_re_iron_qnty">'.$gt_re_iron_qnty.'</th>
									<th id="finish_qnty_inhouse" title="'. $msg.'">'.number_format($gt_finish_qnty_inhouse,0).'<br>'.'Ctn: '.$gt_cartonInQnty.'</th>
									<th id="finish_qnty_subcon">'.number_format($gt_finish_qnty_outbound,0).'<br>'.'Ctn: '.$gt_cartonOutQnty.'</th>
									<th id="finish_qnty_transferIn">'.$gt_finish_qnty_transferIn.'</th>
									<th id="finish_qnty_transferOut">'.$gt_finish_qnty_transferOut.'</th>
									<th id="total_finish_qnty">'.number_format($gt_total_finish_qnty,0).'<br>'.'Ctn: '.$gt_cartonTotal_qnty.'</th>
									<th></th>
									<th id="total_rej_value_td">'.$gt_rej_value.'</th>

									<th id="total_sewing_rej_value_td">'.$gt_sewing_rej_value.'</th>

									<th id="total_out">'.number_format($gt_ex_factory_qnty,0).'<br>'.'Ctn: '.number_format($gt_ex_factory_carton_qnty,0).'</th>
									<th><span id="total_shortage">'.$gt_shortage.'</span></th>
									<th id="td_excess">'.$gt_excess.'</th>
									<th><span id="td_balance">'.$gt_balance.'</span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>';

	}
	else  if($type==4) //color and size wise excel
	{
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$year_cond =" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$year_cond =" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		?>

		<?
		//report size and color wise kaiyum
		// if(str_replace("'", "", $txt_order) !=""){$po_number_cond=" and d.po_number = $txt_order";}
		if(str_replace("'", "", $txt_order) !=""){$po_conds=" and b.po_number in($txt_order_number)";}
		if(str_replace("'", "", $txt_internal_ref) !=""){$intref_conds=" and b.grouping=$txt_internal_ref";}
		if(str_replace("'", "", $cbo_buyer_name) !=0){$buyer_conds=" and a.buyer_name=$cbo_buyer_name";}
		if(str_replace("'", "", $cbo_season_id) !=0){$season_conds=" and a.season_buyer_wise=$cbo_season_id";}
		if(str_replace("'", "", $txt_style_ref) !=""){$po_conds.=" and a.job_no_prefix_num in($txt_style_ref)";}
		if($txt_datefrom!="" &&  $txt_dateto!="")  $po_conds.=" and  b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($po_status=="confirm"){$po_status_cond = " and b.is_confirmed=1";}
		// echo $po_status;die();
		$all_po_id_sql= sql_select("SELECT b.id from wo_po_details_master a, wo_po_break_down b where a.id=b.job_id and b.status_active in(1,2,3) and b.is_deleted=0 $year_cond $po_conds $po_status_cond $intref_conds $buyer_conds $season_conds");
		// echo "SELECT b.id from wo_po_details_master a, wo_po_break_down b where a.id=b.job_id and b.status_active in(1,2,3) and b.is_deleted=0 $year_cond $po_conds $po_status_cond $intref_conds $buyer_conds";die();
		foreach($all_po_id_sql as $keys=>$values)
		{
 			$all_po_id_arr[$values[csf("id")]]=$values[csf("id")];
		}
	   $all_po_ids=implode(",", $all_po_id_arr);
	   $all_po_ids_cond="";

	   if(count($all_po_id_arr)>0)
	   {
		   	if($db_type==2 && count($all_po_id_arr)>999)
		    {
		   		$chunk_arr=array_chunk($all_po_id_arr, 999);
		   		foreach($chunk_arr as $vals)
		   		{
		   			$po_ids=implode(",", $vals);
		   			if($all_po_ids_cond=="")
		   			{
		   				$all_po_ids_cond.=" and (a.order_id in ($po_ids)";
		   			}
		   			else
		   			{
		   				$all_po_ids_cond.=" or  a.order_id in ($po_ids)";
		   			}
		   		}
		   		$all_po_ids_cond.= " )";
		   }
		   else
		   {
		   		$all_po_ids_cond= " and a.order_id in($all_po_ids) ";
		   }
	   }
	   else
	   {
	   	?>
	   		<div style="text-align: center;color: red;font-weight: bold;font-size: 20px;">Sorry! Report data not found.</div>
	   	<?
	   	die();
	   }

		$po_break_down_id=$txt_order_id ; // 25434
		$company_name=$cbo_company_name;
		if ($txt_style_ref_number!="")
		{
			$txt_style_ref_number_cond="and e.style_ref_no like '%$txt_style_ref_number%'";
		}
		else
		{
			$txt_style_ref_number_cond="";
		}
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$cbo_job_year_cond =" and year(e.insert_date)='$cbo_job_year'";
			}
			else
			{
				$cbo_job_year_cond =" and to_char(e.insert_date,'YYYY')='$cbo_job_year'";
			}
		}

		if($txt_style_ref_id!="")
		{
			$txt_style_ref_id_cond=" and e.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$txt_style_ref_id_cond =" and e.job_no_prefix_num='$txt_style_ref'";
		}

		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.company_name=$cbo_company_name";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$shipping_status_cond =" and d.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$shipping_status_cond =" and d.shiping_status in(1,2)";
			}
			else
			{
				$shipping_status_cond =" and d.shiping_status in(1,2,3)";
			}
		}
		if($po_break_down_id!="" )  $po_break_down_id_cond =" and a.po_break_down_id in (".$po_break_down_id.") ";
		if($po_break_down_id!="" )  $po_break_down_id_cond_cut =" and a.order_id in (".$po_break_down_id.") ";  // for cut lay qnty
		if($cbo_buyer_name!=0 )  $cbo_buyer_name_cond =" and e.buyer_name =$cbo_buyer_name";
		if($cbo_season_id!=0 )  $cbo_season_id_cond =" and e.season_buyer_wise =$cbo_season_id";


		if($cbo_location!=0 )  $cbo_location_cond =" and e.location_name =$cbo_location";

		if($txt_datefrom!="" &&  $txt_dateto!="")  $txt_datefrom_to_cond =" and d.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($txt_datefrom!="" &&  $txt_dateto!="")  $txt_datefrom_to_cond_prod =" and a.production_date between '$txt_datefrom' and '$txt_dateto'";

		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and d.grouping=$txt_internal_ref ";

		$color_variable_setting=return_field_value("ex_factory","variable_settings_production","company_name='$company_name' and variable_list=1 and status_active=1 and is_deleted=0","ex_factory");
		$color_variable_setting = ($color_variable_setting==0) ? 3 : $color_variable_setting;

		$ex_fact_qty_arr=array();
		$po_break_down_id_cond = str_replace("a.order_id", "d.id", $all_po_ids_cond);
		if($color_variable_setting==2 || $color_variable_setting==3)
		{
			//echo	$sql_exfect="select c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c,wo_po_details_master e where a.id=b.mst_id and b.color_size_break_down_id=c.id $po_break_down_id_cond_2 $txt_style_ref_number_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond and a.status_active=1 and a.is_deleted=0  and c.job_no_mst=e.job_no group by  c.color_number_id, c.size_number_id";

			$sql_exfect="SELECT e.job_no,a.item_number_id, a.color_number_id, a.size_number_id, sum(y.production_qnty) as production_qnty from pro_ex_factory_mst x,pro_ex_factory_dtls y,wo_po_color_size_breakdown a,wo_po_break_down d,wo_po_details_master e
			where  x.id=y.mst_id and y.color_size_break_down_id=a.id and x.status_active=1 and x.is_deleted=0 and y.status_active=1 and y.is_deleted=0  and a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond  $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond $internal_ref_cond_po  group by  e.job_no,a.item_number_id,a.color_number_id,a.size_number_id order by a.size_number_id";

			// echo $sql_exfect;die();
			$sql_result_exfact=sql_select($sql_exfect);
			foreach($sql_result_exfact as $row)
			{
				$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("size_number_id")]][$row[csf("job_no")]]['ex_fact_qty']=$row[csf("production_qnty")];
			}
		}

		$color_size_sql=sql_select( "SELECT a.id, e.job_no, e.buyer_name, a.item_number_id, a.color_number_id, a.size_number_id, e.style_ref_no, d.pub_shipment_date, a.order_quantity, a.plan_cut_qnty, a.is_deleted  from wo_po_color_size_breakdown a, wo_po_break_down d, wo_po_details_master e where a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond  $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond  $internal_ref_cond_po and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and e.status_active=1 order by a.color_order,a.size_order");

		$color_size_data=array();$color_size_qnty=array();
		foreach($color_size_sql as $row)
		{
			//$test_data[]=$row[csf("color_number_id")];
			if($row[csf("is_deleted")]==0)
			{
				$color_size_data[$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("job_no")]]['size'].= $row[csf("size_number_id")].',';
				$color_size_data[$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("job_no")]]['shipdate'].= change_date_format($row[csf("pub_shipment_date")]).',';
			}

			if($row[csf("is_deleted")]==0)
			{
				$color_size_qnty[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity']+=$row[csf("order_quantity")];
				$color_size_qnty[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_plan_cut']+=$row[csf("plan_cut_qnty")];
			}
			$job_libr[$row[csf("job_no")]]['style']=$row[csf("style_ref_no")];
			$job_libr[$row[csf("job_no")]]['buyer']=$buyer_short_library[$row[csf("buyer_name")]];
			$col_size_id.=$row[csf("id")].',';
		}
	 	$colBrekId=rtrim($col_size_id,",");
		$colBrekId_arr=explode(",",$colBrekId);

		$prod_sql_cut=sql_select("SELECT a.size_id,sum(a.size_qty) as cutlay_qty , b.job_no,c.gmt_item_id, c.color_id
		from ppl_cut_lay_bundle a,ppl_cut_lay_mst b,ppl_cut_lay_dtls c where b.company_id=$cbo_company_name  and a.mst_id=b.id and b.id=c.mst_id $all_po_ids_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by c.gmt_item_id,a.mst_id,a.size_id, b.job_no,c.color_id order by a.size_id ");//$po_break_down_id_cond_cut

		$color_size_cut_qnty=array();
		foreach($prod_sql_cut as $row)
		{
			$color_size_cut_qnty[$row[csf("color_id")]][$row[csf("gmt_item_id")]][$row[csf("job_no")]][$row[csf("size_id")]]['quantityCutting']+=$row[csf("cutlay_qty")];
		}
		$po_break_down_id_cond = str_replace("a.order_id", "a.po_break_down_id", $all_po_ids_cond);
		if($db_type==0)
		{
			$prod_sql="SELECT a.po_break_down_id,d.item_number_id, c.color_size_break_down_id,  d.color_number_id, d.size_number_id,e.style_ref_no, e.job_no,
					IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='1' AND a.entry_break_down_type=3 THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty_qc,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' and c.production_type ='3'  AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='4' and c.production_type ='4'  THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='5' and c.production_type ='5'  THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='6' and c.production_type ='6'  THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='7' and c.production_type ='7'  THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='8' and c.production_type ='8'  THEN c.production_qnty ELSE 0 END),0) AS finish_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='11' and c.production_type ='11' THEN c.production_qnty ELSE 0 END),0) AS poly_qty,
					IFNULL(sum(CASE WHEN a.production_type ='80' and c.production_type ='80' THEN c.production_qnty ELSE 0 END),0) AS finishing_qty,
					IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type =5 THEN c.production_qnty ELSE 0 END),0) AS trans_in_qty,
					IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type =6 THEN c.production_qnty ELSE 0 END),0) AS trans_out_qty
				from
					pro_garments_production_mst a, pro_garments_production_dtls c ,wo_po_color_size_breakdown d, wo_po_details_master e
				where
					a.id=c.mst_id
					 and c.color_size_break_down_id=d.id and d.job_no_mst=e.job_no $po_break_down_id_cond  $cbo_style_owner_wise_status_cond  $txt_style_ref_id_cond $internal_ref_cond_prod
				and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and e.status_active=1 and e.is_deleted=0   $txt_datefrom_to_cond_prod  and d.id in ($colBrekId)
				group by d.item_number_id,a.po_break_down_id, c.color_size_break_down_id, d.color_number_id, d.size_number_id,e.job_no,e.style_ref_no, c.bundle_no order by  d.size_number_id";
		}
		else
		{
			$colBrekId_chunk=array_chunk($colBrekId_arr,999);
			$colorBreakDownId_cond=" and";
			foreach($colBrekId_chunk as $dtls_id)
			{
			if($colorBreakDownId_cond==" and" )  $colorBreakDownId_cond.=" ( d.id in(".implode(',',$dtls_id).")"; else $colorBreakDownId_cond.=" or d.id in(".implode(',',$dtls_id).")";
			}
			$colorBreakDownId_cond.=" )";
			//echo $colorBreakDownId_cond;die;

			$prod_sql="SELECT d.item_number_id,c.bundle_no,a.po_break_down_id, c.color_size_break_down_id,  d.color_number_id, d.size_number_id,e.job_no,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.production_qnty else 0 end),0) as cutting_qnty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.reject_qty else 0 end),0) as reject_qty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.replace_qty else 0 end),0) as replace_qnty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.production_qnty else 0 end),0) as cutting_qnty_qc,
				nvl(sum(case when a.production_type ='2' and a.embel_name=1 then c.production_qnty else 0 end),0) as printing_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=1 then c.production_qnty else 0 end),0) as printreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=2 then c.production_qnty else 0 end),0) as emb_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=2 then c.production_qnty else 0 end),0) as embreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=3 then c.production_qnty else 0 end),0) as wash_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=3 then c.production_qnty else 0 end),0) as washreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=4 then c.production_qnty else 0 end),0) as sp_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=4 then c.production_qnty else 0 end),0) as spreceived_qnty,
				nvl(sum(case when a.production_type ='4' and c.production_type ='4' then c.production_qnty else 0 end),0) as sewingin_qnty,
				nvl(sum(case when a.production_type ='5' and c.production_type ='5' then c.production_qnty else 0 end),0) as sewingout_qnty,
				nvl(sum(case when a.production_type ='5' and c.production_type ='5' then c.reject_qty else 0 end),0) as sewing_reject,
				nvl(sum(case when a.production_type ='6' and c.production_type ='6' then c.production_qnty else 0 end),0) as finishin_qnty,
				nvl(sum(case when a.production_type ='7' and c.production_type ='7' then c.production_qnty else 0 end),0) as iron_qnty,
				nvl(sum(case when a.production_type ='8'  and c.production_type ='8' then c.production_qnty else 0 end),0) as finish_qnty,
				nvl(sum(case when a.production_type ='11' and c.production_type ='11' then c.production_qnty else 0 end),0) as poly_qty,
				nvl(sum(case when a.production_type ='11' and c.production_type ='11' then c.production_qnty else 0 end),0) as poly_qty,
				nvl(sum(case when a.production_type ='11' and c.production_type ='11' then c.reject_qty else 0 end),0) as poly_reject,
				nvl(sum(case when a.production_type ='80' and c.production_type ='80' then c.production_qnty else 0 end),0) as finishing_qty,
				nvl(sum(CASE WHEN a.production_type ='10' and a.trans_type =5 THEN c.production_qnty ELSE 0 END),0) AS trans_in_qty,
				nvl(sum(CASE WHEN a.production_type ='10' and a.trans_type =6 THEN c.production_qnty ELSE 0 END),0) AS trans_out_qty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c ,wo_po_color_size_breakdown d, wo_po_details_master e
			where
				a.id=c.mst_id  and c.color_size_break_down_id=d.id and d.job_id=e.id $po_break_down_id_cond  $cbo_style_owner_wise_status_cond $txt_style_ref_id_cond and a.PO_BREAK_DOWN_ID=d.PO_BREAK_DOWN_ID
			and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and e.status_active=1 and e.is_deleted=0   $txt_datefrom_to_cond_prod $colorBreakDownId_cond   $internal_ref_cond_prod
			group by d.item_number_id,a.po_break_down_id, c.color_size_break_down_id, d.color_number_id, d.size_number_id,e.job_no,e.style_ref_no, c.bundle_no order by  d.size_number_id";

		}
		// echo $prod_sql;die;
		$prod_sql_res = sql_select($prod_sql);
		$prod_color_size_data=array();
		$has_cut_qty = count($color_size_cut_qnty);
		foreach($prod_sql_res as $row)
		{
			if (!$has_cut_qty){
				$color_size_cut_qnty[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantityCutting']+=$row[csf("cutting_qnty")];
			}


			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_cutting']+=$row[csf("cutting_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['reject_qty']+=$row[csf("reject_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['replace_qnty']+=$row[csf("replace_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_qc']+=$row[csf("cutting_qnty_qc")];//+$row[csf("replace_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_toprint']+=$row[csf("printing_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_fromprint']+=$row[csf("printreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_toemb']+=$row[csf("emb_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_fromemb']+=$row[csf("embreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_to_spwork']+=$row[csf("sp_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_from_spwork']+=$row[csf("spreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_swinput']+=$row[csf("sewingin_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_swoutput']+=$row[csf("sewingout_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['sewing_reject']+=$row[csf("sewing_reject")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_poly']+=$row[csf("poly_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['poly_reject']+=$row[csf("poly_reject")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_packing']+=$row[csf("finish_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_finishing_qty']+=$row[csf("finishing_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_washreceived']+=$row[csf("washreceived_qnty")];

			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['trans_in_qty']+=$row[csf("trans_in_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['trans_out_qty']+=$row[csf("trans_out_qty")];

		}
		/* 	echo "<pre>";
		print_r($color_size_cut_qnty);
		echo "</pre>";die;
			 */


		$report_data='<div id="scroll_body" style="overflow-y: scroll; width: 900px; overflow-x: auto;">
	  	<legend>Color and Size</legend>';


		$size_Arr_library=return_library_array( "SELECT id,size_name from lib_size", "id", "size_name" );
		//$count = count($size_library);
		//$width= $count*70+350;

		foreach($color_size_data as $item_id=>$item_data)
		{
			foreach($item_data as $color=>$color_data)
			{
				foreach ($color_data as $style => $value)
				{
					$size_ids=$value['size'];
					$color_size_ids=array_unique(explode(',',$size_ids));
					$pubshipdate=implode(", ",array_filter(array_unique(explode(',',$value['shipdate']))));
					// $color_size_qnty[$row[csf("color_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['style_ref']

					$report_data.='<div>

					 	<table border="1" rules="all" >
					 		<caption><h2>Colour: '.$color_Arr_library[$color].' / '.$garments_item[$item_id].'</h2></caption>
						 	<thead>
					        	<tr>
					            	<th>Style</th>
					                <th>Size</th>';

									foreach($color_size_ids as $sizeRes)
									{
										$report_data.='<th><p>'.$size_Arr_library[$sizeRes].'&nbsp;</p></th>';
									}

									$report_data.='<th>Total Qty</th>
					           </tr>
					        </thead>

					        <tr>
					            <td rowspan="31">JOB No: '.$style.'<br /><br />Style Ref. : '.$job_libr[$style]["style"].'<br /><br />Buyer : '.$job_libr[$style][buyer].'<br /><br />Pub. Ship Date : '.$pubshipdate.'</td>
					            <td>Order Quantity</td>';

									$tot_po_size_qnty=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qnty+=$po_size_qnty;
										$report_data.='<td align="center">'.number_format($po_size_qnty).'</td>';
									}

								$report_data.='<td align="center">'.number_format($tot_po_size_qnty).'</td>
					        </tr>
					        <tr>
					            <td>Plan To Cut</td>';

									$tot_po_size_qnty_plan_cut=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_plan_cut=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity_plan_cut'];
										$tot_po_size_qnty_plan_cut+=$po_size_qnty_plan_cut;
										$report_data.='<td align="center" >'.number_format($po_size_qnty_plan_cut).'</td>';
									}

									$report_data.=' <td align="center">'.number_format($tot_po_size_qnty_plan_cut).'</td>
					        </tr>
					        <tr>
					            <td>Cutting </td>';

									$tot_po_size_qnty_cutting=0;
									foreach($color_size_ids as $sizeRes)
									{
										// $po_size_qnty_cutting=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);  color_size_data
										$po_size_qnty_cutting=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$tot_po_size_qnty_cutting+=$po_size_qnty_cutting;
										$report_data.='<td align="center">'.number_format($po_size_qnty_cutting).'</td>';
									}

								$report_data.=' <td align="center">'.number_format($tot_po_size_qnty_cutting).'</td>
					        </tr>
					        <tr>
					            <td>Cutting Balance</td>';

									$tot_po_size_qnty_cutting_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
									    // $cuting_qc_blnc=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);
									  	$cuting_qc_blnc=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$cutting_plan2cut_blnc=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity_plan_cut'];
										// $cuting_qc_blnc=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting'];
										// $cutting_plan2cut_blnc=$color_size_qnty[$color][$style][$sizeRes]['quantity_plan_cut'];
										$cuting_qc_blnc_qty=$cutting_plan2cut_blnc-$cuting_qc_blnc;
										$tot_po_size_qnty_cutting_blnc+=$cuting_qc_blnc_qty;
										if($cuting_qc_blnc_qty<0)
										{
											$cuting_qc_blnc_qty=abs($cuting_qc_blnc_qty);
											$cuting_qc_blnc_qty='('.number_format($cuting_qc_blnc_qty).')'; $bg_tdColor='red';
										}
										else
										{
											$cuting_qc_blnc_qty=$cuting_qc_blnc_qty;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:<? echo $bg_tdColor; ?>">'.$cuting_qc_blnc_qty.'</td>';
									}
									if($tot_po_size_qnty_cutting_blnc<0)
									{
										$tot_po_size_qnty_cutting_blnc=abs($tot_po_size_qnty_cutting_blnc);
										$tot_po_size_qnty_cutting_blnc='('.number_format($tot_po_size_qnty_cutting_blnc).')'; $bg_tdColor='red';
									}
									else
									{
										$tot_po_size_qnty_cutting_blnc=$tot_po_size_qnty_cutting_blnc;$bg_tdColor='';
									}

					            $report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_cutting_blnc.'</td>
					        </tr>
					        <tr>
					            <td>Cutting QC</td>';

									$tot_po_size_qnty_qc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										$tot_po_size_qnty_qc+=$po_size_qnty_qc;
										$report_data.='<td align="center">'.number_format($po_size_qnty_qc).'</td>';
									}

								$report_data.='<td align="center">'.number_format($tot_po_size_qnty_qc).'</td>
					        </tr>
					        <tr>
					            <td>Cutting QC  Balance</td>';

									$tot_po_size_qnty_qc_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										//$po_size_qnty_cutting=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);
										$po_size_qnty_cutting=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$po_size_qnty_qc_blnc=$po_size_qnty_cutting-$po_size_qnty_qc;
										$tot_po_size_qnty_qc_blnc+=$po_size_qnty_qc_blnc;

										if($po_size_qnty_qc_blnc<0)
										{
											$po_size_qnty_qc_blnc=abs($po_size_qnty_qc_blnc);
											$po_size_qnty_qc_blnc='('.number_format($po_size_qnty_qc_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_qc_blnc=$po_size_qnty_qc_blnc;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_qc_blnc.'</td>';
									}
									if($tot_po_size_qnty_qc_blnc<0)
									{
										$tot_po_size_qnty_qc_blnc=abs($tot_po_size_qnty_qc_blnc);
										$tot_po_size_qnty_qc_blnc='('.number_format($tot_po_size_qnty_qc_blnc).')'; $bg_tdColor='red';
									}
									else
									{
										$tot_po_size_qnty_qc_blnc=$tot_po_size_qnty_qc_blnc;$bg_tdColor='';
									}

					            $report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_qc_blnc.'</td>
					        </tr>
					        <tr>
					            <td>Send To print </td>';

									$tot_po_size_qnty_to_print=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toprint'];
										$tot_po_size_qnty_to_print+=$po_size_qnty_to_print;
										$report_data.='<td align="center">'.number_format($po_size_qnty_to_print).'</td>';
									}

									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_to_print).'</td>
					        </tr>
					        <tr>
					            <td>Receive from Print</td>';

									$tot_po_size_qnty_from_print=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromprint'];
										$tot_po_size_qnty_from_print+=$po_size_qnty_from_print;
										$report_data.='<td align="center">'.number_format($po_size_qnty_from_print).'</td>';
									}

					            $report_data.='<td align="center">'.number_format($tot_po_size_qnty_from_print).'</td>
					        </tr>
					      	<tr>
					            <td> Printing Balance </td>';

									$tot_po_size_qnty_from_print_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromprint'];
										$po_size_qnty_to_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toprint'];
										$po_size_qnty_from_print_blnc=$po_size_qnty_to_print-$po_size_qnty_from_print;
										$tot_po_size_qnty_from_print_blnc+=$po_size_qnty_from_print_blnc;

										if($po_size_qnty_from_print_blnc<0)
										{
											$po_size_qnty_from_print_blnc=abs($po_size_qnty_from_print_blnc);
											$po_size_qnty_from_print_blnc='('.number_format($po_size_qnty_from_print_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_print_blnc=$po_size_qnty_from_print_blnc;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_from_print_blnc.'</td>';
									}
									if($tot_po_size_qnty_from_print_blnc<0)
										{
											$tot_po_size_qnty_from_print_blnc=abs($tot_po_size_qnty_from_print_blnc);
											$tot_po_size_qnty_from_print_blnc='('.number_format($tot_po_size_qnty_from_print_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_print_blnc=$tot_po_size_qnty_from_print_blnc;$bg_tdColor='';
										}

								$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_from_print_blnc.'</td>
					        </tr>
					        <tr>
					            <td>Send To Embroiedery </td>';

									$tot_po_size_qnty_to_emb=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toemb'];
										$tot_po_size_qnty_to_emb+=$po_size_qnty_to_emb;
										$report_data.='<td align="center">'.number_format($po_size_qnty_to_emb).'</td>';
									}

								$report_data.='<td align="center">'.number_format($tot_po_size_qnty_to_emb).'</td>
					        </tr>
					        <tr>
					            <td>Receive from Embroiedery</td>';

									$tot_po_size_qnty_from_emb=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromemb'];
										$tot_po_size_qnty_from_emb+=$po_size_qnty_from_emb;
										$report_data.='<td align="center">'.number_format($po_size_qnty_from_emb).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_from_emb).'</td>
					        </tr>
					         <tr>
					            <td>Embroiedery Balance </td>';
									$tot_po_size_qnty_from_emb_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromemb'];
										$po_size_qnty_to_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toemb'];
										$po_size_qnty_from_emb_blnc=$po_size_qnty_to_emb-$po_size_qnty_from_emb ;
										$tot_po_size_qnty_from_emb_blnc+=$po_size_qnty_from_emb_blnc;

										if($po_size_qnty_from_emb_blnc<0)
										{
											$po_size_qnty_from_emb_blnc=abs($po_size_qnty_from_emb_blnc);
											$po_size_qnty_from_emb_blnc='('.number_format($po_size_qnty_from_emb_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_emb_blnc=$po_size_qnty_from_emb_blnc;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'"> '.$po_size_qnty_from_emb_blnc.'</td>';
									}
									if($tot_po_size_qnty_from_emb_blnc<0)
										{
											$tot_po_size_qnty_from_emb_blnc=abs($tot_po_size_qnty_from_emb_blnc);
											$tot_po_size_qnty_from_emb_blnc='('.number_format($tot_po_size_qnty_from_emb_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_emb_blnc=$tot_po_size_qnty_from_emb_blnc;$bg_tdColor='';
										}

					            $report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_from_emb_blnc.'</td>
					        </tr>
					         <tr>
					            <td>Send To Special Work </td>';
									$tot_po_size_qnty_to_spwork=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_spwork=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_to_spwork'];
										$tot_po_size_qnty_to_spwork+=$po_size_qnty_to_spwork;
										$report_data.='<td align="center" >'.number_format($po_size_qnty_to_spwork).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_to_spwork).'</td>
					        </tr>
					         <tr>
					            <td>Receive From Special Work </td>';
									$tot_po_size_qnty_from_spwork=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_spwork=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_from_spwork'];
										$tot_po_size_qnty_from_spwork+=$po_size_qnty_from_spwork;
										$report_data.='<td align="center">'.number_format($po_size_qnty_from_spwork).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_from_spwork).'</td>
					        </tr>
					      	<tr>
					            <td> Special Work  Balance </td>';
									//$tot_po_size_qnty_from_spwork_blncs=0;
									foreach($color_size_ids as $sizeRes)
									{


										$po_size_qnty_from_spworks=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_from_spwork'];
										$po_size_qnty_to_spworks=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_to_spwork'];
										$po_size_qnty_from_spwork_blnc=$po_size_qnty_from_spworks-$po_size_qnty_to_spworks;
										//$tot_po_size_qnty_from_spwork_blncs=+$po_size_qnty_from_spwork_blnc;

										if($po_size_qnty_from_spwork_blnc<0)
										{
											$po_size_qnty_from_spwork_blnc=abs($po_size_qnty_from_spwork_blnc);
											$po_size_qnty_from_spwork_blnc='('.number_format($po_size_qnty_from_spwork_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_spwork_blnc=$po_size_qnty_from_spwork_blnc;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_from_spwork_blnc.'</td>';
									}
									$tot_po_size_qnty_from_spwork_blncs=$tot_po_size_qnty_from_spwork-$tot_po_size_qnty_to_spwork;
									if($tot_po_size_qnty_from_spwork_blncs<0)
										{
											$tot_po_size_qnty_from_spwork_blncs=abs($tot_po_size_qnty_from_spwork_blncs);
											$tot_po_size_qnty_from_spwork_blncs='('.number_format($tot_po_size_qnty_from_spwork_blncs).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_spwork_blncs=$tot_po_size_qnty_from_spwork_blncs;$bg_tdColor='';
										}

								$report_data.='<td align="center"  style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_from_spwork_blncs.'</td>
					        </tr>
					        <tr>
					            <td>Sewing Input</td>';
									$tot_po_size_qnty_swinput=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swinput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$tot_po_size_qnty_swinput+=$po_size_qnty_swinput;
										$report_data.='<td align="center" >'.number_format($po_size_qnty_swinput).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_swinput).'</td>
					        </tr>
					        <tr>
					            <td>Input Balance </td>';

									$tot_po_size_qnty_swinput_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swinput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										$po_size_qnty_swinput_blnc=$po_size_qnty_qc-$po_size_qnty_swinput;


										$tot_po_size_qnty_swinput_blnc+=$po_size_qnty_swinput_blnc;

										if($po_size_qnty_swinput_blnc<0)
										{
											$po_size_qnty_swinput_blnc=abs($po_size_qnty_swinput_blnc);
											$po_size_qnty_swinput_blnc='('.number_format($po_size_qnty_swinput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_swinput_blnc=$po_size_qnty_swinput_blnc;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_swinput_blnc.'</td>';
									}
									if($tot_po_size_qnty_swinput_blnc<0)
										{
											$tot_po_size_qnty_swinput_blnc=abs($tot_po_size_qnty_swinput_blnc);
											$tot_po_size_qnty_swinput_blnc='('.number_format($tot_po_size_qnty_swinput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_swinput_blnc=$tot_po_size_qnty_swinput_blnc;$bg_tdColor='';
										}

								$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_swinput_blnc.'</td>
					        </tr>
					        <tr>
					            <td>Sewing Output</td>';
									$tot_po_size_qnty_swoutput=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swoutput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput'];
										$tot_po_size_qnty_swoutput+=$po_size_qnty_swoutput;
										$report_data.='<td align="center">'.number_format($po_size_qnty_swoutput).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_swoutput).'</td>
					        </tr>
					        <tr>
					            <td>Sewing Reject</td>';
									$tot_po_size_qnty_reject=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_sew_rej=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['sewing_reject'];
										$tot_po_size_qnty_reject+=$po_size_qnty_sew_rej;
										$report_data.='<td align="center" >'.number_format($po_size_qnty_sew_rej).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_reject).'</td>
					        </tr>
					        <tr>
					            <td>Sewing Balance </td>';
									$tot_po_size_qnty_swoutput_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swoutput_blnc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput']; ////
										$po_size_qnty_swoutput_rej = $color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['sewing_reject'];
										$po_size_qnty_swinput_blnc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];

										$po_size_qnty_swoutput_blnc=$po_size_qnty_swinput_blnc-($po_size_qnty_swoutput_blnc+$po_size_qnty_swoutput_rej);
										$tot_po_size_qnty_swoutput_blnc+=$po_size_qnty_swoutput_blnc;

										if($po_size_qnty_swoutput_blnc<0)
										{
											$po_size_qnty_swoutput_blnc=abs($po_size_qnty_swoutput_blnc);
											$po_size_qnty_swoutput_blnc='('.number_format($po_size_qnty_swoutput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_swoutput_blnc=$po_size_qnty_swoutput_blnc;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_swoutput_blnc.'</td>';
									}
									if($tot_po_size_qnty_swoutput_blnc<0)
										{
											$tot_po_size_qnty_swoutput_blnc=abs($tot_po_size_qnty_swoutput_blnc);
											$tot_po_size_qnty_swoutput_blnc='('.number_format($tot_po_size_qnty_swoutput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_swoutput_blnc=$tot_po_size_qnty_swoutput_blnc;$bg_tdColor='';
										}

										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_swoutput_blnc.'</td>
					        </tr>
							<tr>
					            <td>Finishing</td>';
									$tot_po_size_qnty_finishing=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_finishing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_finishing_qty'];
										$tot_po_size_qnty_finishing+=$po_size_qnty_finishing;
										$report_data.='<td align="center">'.number_format($po_size_qnty_finishing).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_finishing).'</td>
					        </tr>
							<tr>
					            <td>Finishing Balance  </td>';
									$tot_po_size_qnty_finishing_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_finishing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_finishing_qty'];
										$po_size_qnty_washreceived=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_washreceived'];
										$po_size_qnty_finishing_blnc=$po_size_qnty_washreceived-$po_size_qnty_finishing;
										$tot_po_size_qnty_finishing_blnc+=$po_size_qnty_finishing_blnc;

										if($po_size_qnty_finishing_blnc<0)
										{
											$po_size_qnty_finishing_blnc=abs($po_size_qnty_finishing_blnc);
											$po_size_qnty_finishing_blnc='('.number_format($po_size_qnty_finishing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_finishing_blnc=$po_size_qnty_finishing_blnc;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_finishing_blnc.'</td>';
									}
									if($tot_po_size_qnty_finishing_blnc<0)
										{
											$tot_po_size_qnty_finishing_blnc=abs($tot_po_size_qnty_finishing_blnc);
											$tot_po_size_qnty_finishing_blnc='('.number_format($tot_po_size_qnty_finishing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_finishing_blnc=$tot_po_size_qnty_finishing_blnc;$bg_tdColor='';
										}

										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_finishing_blnc.'</td>
					        </tr>
					         <tr>
					            <td>Poly</td>';
									$tot_po_size_qnty_poly=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										$tot_po_size_qnty_poly+=$po_size_qnty_poly;
										$report_data.='<td align="center">'.number_format($po_size_qnty_poly).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_poly).'</td>
					        </tr>
							<tr>
					            <td>Poly Reject</td>';
									$tot_po_size_qnty_poly_reject=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_poly_reject=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['poly_reject'];
										$tot_po_size_qnty_poly_reject+=$po_size_qnty_poly_reject;
										$report_data.='<td align="center">'.number_format($po_size_qnty_poly_reject).'</td>';

									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_poly_reject).'</td>
					        </tr>
					       	<tr>
					            <td>Poly Balance  </td>';
									$tot_po_size_qnty_poly_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swinput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										$po_size_qnty_poly_reject=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['poly_reject'];
										// $po_size_qnty_swoutput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput'];
										$po_size_qnty_poly_blnc=$po_size_qnty_swinput-$po_size_qnty_poly-$po_size_qnty_poly_reject;
										$tot_po_size_qnty_poly_blnc+=$po_size_qnty_poly_blnc;

										if($po_size_qnty_poly_blnc<0)
										{
											$po_size_qnty_poly_blnc=abs($po_size_qnty_poly_blnc);
											$po_size_qnty_poly_blnc='('.number_format($po_size_qnty_poly_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_poly_blnc=$po_size_qnty_poly_blnc;$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_poly_blnc.'</td>';
									}
									if($tot_po_size_qnty_poly_blnc<0)
										{
											$tot_po_size_qnty_poly_blnc=abs($tot_po_size_qnty_poly_blnc);
											$tot_po_size_qnty_poly_blnc='('.number_format($tot_po_size_qnty_poly_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_poly_blnc=$tot_po_size_qnty_poly_blnc;$bg_tdColor='';
										}

										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_poly_blnc.'</td>
					        </tr>
					         <tr>
					            <td>Packing </td>';
									$tot_po_size_qnty_packing=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_packing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_packing']+$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['trans_in_qty']-$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['trans_out_qty'];
										$tot_po_size_qnty_packing+=$po_size_qnty_packing;
										$report_data.='<td align="center">'.number_format($po_size_qnty_packing).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_packing).'</td>
					        </tr>
					         <tr>
					            <td>Packing Balance </td>';
									$tot_po_size_qnty_packing_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_packing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_packing']+$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['trans_in_qty']-$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['trans_out_qty'];
		//										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
		//										$po_size_qnty_packing_blnc=$po_size_qnty_poly-$po_size_qnty_packing;
                                        $po_size_qnty_swoutput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput'];
                                        $po_size_qnty_packing_blnc=$po_size_qnty_swoutput-$po_size_qnty_packing;

                                        $tot_po_size_qnty_packing_blnc+=$po_size_qnty_packing_blnc;


										if($po_size_qnty_packing_blnc<0)
										{
											$po_size_qnty_packing_blnc=abs($po_size_qnty_packing_blnc);
											$po_size_qnty_packing_blnc='('.number_format($po_size_qnty_packing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_packing_blnc=$po_size_qnty_packing_blnc;$bg_tdColor='';
										}

										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_packing_blnc.'</td>';
									}

									if($tot_po_size_qnty_packing_blnc<0)
										{
											$tot_po_size_qnty_packing_blnc=abs($tot_po_size_qnty_packing_blnc);
											$tot_po_size_qnty_packing_blnc='('.number_format($tot_po_size_qnty_packing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_packing_blnc=$tot_po_size_qnty_packing_blnc;$bg_tdColor='';
										}

								$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_packing_blnc.'</td>
					        </tr>
					         <tr>
					            <td>Ex Factory</td>';
									$tot_po_size_qnty_exfact=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$tot_po_size_qnty_exfact+=$po_size_qnty_exfact;
										$report_data.='<td align="center">'.number_format($po_size_qnty_exfact).'</td>';
									}
									$report_data.='<td align="center">'.number_format($tot_po_size_qnty_exfact).'</td>
					        </tr>
					        <tr>
					            <td>Ex- Factory Balance </td>';
									$tot_po_size_qnty_exfact_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc=($po_size_qnty-$po_size_qnty_exfact);
										$tot_po_size_qnty_exfact_blnc+=$po_size_qnty_exfact_blnc;

										if($po_size_qnty_exfact_blnc<0)
										{
											$po_size_qnty_exfact_blnc=abs($po_size_qnty_exfact_blnc);
											$po_size_qnty_exfact_blnc='('.number_format($po_size_qnty_exfact_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_exfact_blnc=$po_size_qnty_exfact_blnc;$bg_tdColor='';
										}

										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$po_size_qnty_exfact_blnc.'</td>';
									}

									if($tot_po_size_qnty_exfact_blnc<0)
										{
											$tot_po_size_qnty_exfact_blnc=abs($tot_po_size_qnty_exfact_blnc);
											$tot_po_size_qnty_exfact_blnc='('.number_format($tot_po_size_qnty_exfact_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_blnc=$tot_po_size_qnty_exfact_blnc;$bg_tdColor='';
										}


										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">
									'.$tot_po_size_qnty_exfact_blnc.'
					            </td>
					        </tr>


					        <tr>
					            <td title="Poly Qty - Ex-factory Qty">FG Stock in Hand </td>';
									$tot_po_size_qnty_fg=0;
									foreach($color_size_ids as $sizeRes)
									{
										//$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										//$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];

										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];

										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];



										$tot_po_size_qnty_fg+=$po_size_qnty_poly - $po_size_qnty_exfact;
										$report_data.='<td align="center" >'.number_format(($po_size_qnty_poly - $po_size_qnty_exfact)).'</td>';
									}
									$report_data.='<td align="center" style="color:'.$bg_tdColor.'">
									'.$tot_po_size_qnty_fg.'
					            </td>
					        </tr>


					         <tr>

					            <td>Ex- Factory Balance % </td>';
									$tot_po_size_qnty_exfact_blnc_prcn=0; $tot_po_size_qnty_exfact_blnc2=0;$tot_po_size_qnty2=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_exfact_perc=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$po_size_qnty_perc=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc=($po_size_qnty_perc-$po_size_qnty_exfact_perc);
										$exfact_size_bal_perc_sum=($po_size_qnty_exfact_blnc/$po_size_qnty_perc)*100;

										// for total
										$po_size_qnty_exfact2=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$po_size_qnty2=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc2=($po_size_qnty2-$po_size_qnty_exfact2);
										$tot_po_size_qnty_exfact_blnc2+=$po_size_qnty_exfact_blnc2;

										$po_size_qnty2=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qnty2+=$po_size_qnty2;
										//
										//$tot_po_size_qnty_exfact_blnc_prcn+=$exfact_size_bal_perc_sum;
										if($exfact_size_bal_perc_sum<0)
										{
											$exfact_size_bal_perc_sum=abs($exfact_size_bal_perc_sum);
											$exfact_size_bal_perc_sum='('.number_format($exfact_size_bal_perc_sum,2).')'; $bg_tdColor='red';
										}
										else
										{
											$exfact_size_bal_perc_sum=number_format($exfact_size_bal_perc_sum,2);$bg_tdColor='';
										}
										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$exfact_size_bal_perc_sum.'</td>';
									}

									  	$tot_po_size_qnty_exfact_blnc_prcn=($tot_po_size_qnty_exfact_blnc2/$tot_po_size_qnty2)*100;
										if($tot_po_size_qnty_exfact_blnc_prcn<0)
										{

											$tot_po_size_qnty_exfact_blnc_prcn=abs($tot_po_size_qnty_exfact_blnc_prcn);
											$tot_po_size_qnty_exfact_blnc_prcn='('.number_format($tot_po_size_qnty_exfact_blnc_prcn,2).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_blnc_prcn=number_format($tot_po_size_qnty_exfact_blnc_prcn,2);$bg_tdColor='';
										}




										$report_data.='<td align="center" style="color:'.$bg_tdColor.'">'.$tot_po_size_qnty_exfact_blnc_prcn.'
					            </td>
					        </tr>
					        <tr>

					            <td>Ex- Factory  % </td>';
									$tot_po_size_qnty_exfact_perc=0;$tot_po_size_qnty_exfact2=0;$tot_po_size_qntyy=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$result_exfactPerc=($po_size_qnty_exfact/$po_size_qnty)*100;
										$tot_po_size_qnty_exfact_perc+=$result_exfactPerc;


										//

										$po_size_qnty_exfact2=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$tot_po_size_qnty_exfact2+=$po_size_qnty_exfact2;

										$po_size_qntyy=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qntyy+=$po_size_qntyy;
										//



										if($result_exfactPerc<0)
										{
											$result_exfactPerc=abs($result_exfactPerc);
											$result_exfactPerc='('.$result_exfactPerc.')'; $bg_tdColor='red';
										}
										else
										{
											$result_exfactPerc=$result_exfactPerc;$bg_tdColor='';
										}
										$report_data.='<td align="center">'.number_format($result_exfactPerc,2).'</td>';
									}
									$tot_po_size_qnty_exfact_perc=($tot_po_size_qnty_exfact2/$tot_po_size_qntyy)*100;
									if($tot_po_size_qnty_exfact_perc<0)
										{
											$tot_po_size_qnty_exfact_perc=abs($tot_po_size_qnty_exfact_perc);
											$tot_po_size_qnty_exfact_perc='('.$tot_po_size_qnty_exfact_perc.')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_perc=$tot_po_size_qnty_exfact_perc;$bg_tdColor='';
										}

										$report_data.='<td align="center">'.number_format($tot_po_size_qnty_exfact_perc,2).'</td>
					        </tr>

					 	</table>
					 </div>';

				}
			}
		}

		$report_data.='</div>';

	}
	else if($type==5) //order and size wise excel
	{
		$buyer_library=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name"  );
		//report order and color wise kaiyum
		$active_status=str_replace("'", "", $active_status);
		$active_cond="";
		if($active_status) $active_cond.=" and a.status_active=1 and d.status_active=1 ";

		$po_break_down_id=$txt_order_id ;
		$company_name=$cbo_company_name;
		if ($txt_style_ref_number!="")
		{
			$txt_style_ref_number_cond="and e.style_ref_no like '%$txt_style_ref_number%'";
		}
		else
		{
			$txt_style_ref_number_cond="";
		}
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$cbo_job_year_cond =" and year(e.insert_date)='$cbo_job_year'";
			}
			else
			{
				$cbo_job_year_cond =" and to_char(e.insert_date,'YYYY')='$cbo_job_year'";
			}
		}

		if($txt_style_ref_id!="")
		{
			$txt_style_ref_id_cond=" and e.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$txt_style_ref_id_cond =" and e.job_no_prefix_num in($txt_style_ref)";
		}

		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.company_name=$cbo_company_name";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$shipping_status_cond =" and d.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$shipping_status_cond =" and d.shiping_status in(1,2)";
			}
			else
			{
				$shipping_status_cond =" and d.shiping_status in(1,2,3)";
			}

		}
		if($txt_order_id=="")
		{
			if($txt_order_no!="")
			{
				$order_no_cond =" and d.po_number in($poNumbers)";
			}
		}
		//if($txt_order_no!="" )  $order_no_cond =" and d.po_number in( '".$txt_order_no."') ";
		if($po_break_down_id!="" )  $po_break_down_id_cond =" and a.po_break_down_id in (".$po_break_down_id.") ";
		$po_break_down_id_cond_new=($po_break_down_id!="") ?" and x.po_break_down_id in($po_break_down_id) " : "";

		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and x.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and d.grouping=$txt_internal_ref ";


		if($cbo_buyer_name!=0 )  $cbo_buyer_name_cond =" and e.buyer_name =$cbo_buyer_name";
		if($cbo_season_id!=0 )  $cbo_season_id_cond =" and e.season_buyer_wise =$cbo_season_id";
		if($cbo_location!=0 )  $cbo_location_cond =" and e.location_name =$cbo_location";
		if($txt_datefrom!="" &&  $txt_dateto!="")  $txt_datefrom_to_cond =" and d.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
		$color_variable_setting=return_field_value("ex_factory","variable_settings_production","company_name='$company_name' and variable_list=1 and status_active=1 and is_deleted=0","ex_factory");
		$color_variable_setting = ($color_variable_setting==0) ? 3 : $color_variable_setting;
		$ex_fact_qty_arr=array();
		if($color_variable_setting==2 || $color_variable_setting==3)
		{
		 	$sql_exfect="SELECT a.po_break_down_id,a.item_number_id, a.color_number_id, a.size_number_id, sum(y.production_qnty) as production_qnty from pro_ex_factory_mst x,pro_ex_factory_dtls y,wo_po_color_size_breakdown a,wo_po_break_down d,wo_po_details_master e
			where  x.id=y.mst_id and y.color_size_break_down_id=a.id   and x.status_active=1 and x.is_deleted=0 and y.status_active=1 and y.is_deleted=0   and a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond $internal_ref_cond_po group by  a.color_number_id,a.size_number_id,a.po_break_down_id,a.item_number_id order by a.po_break_down_id,a.color_number_id, a.size_number_id";

			//echo $sql_exfect."<br>";
			$sql_result_exfact=sql_select($sql_exfect);
			foreach($sql_result_exfact as $row)
			{
				$ex_fact_qty_arr[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['ex_fact_qty']=$row[csf("production_qnty")];
			}
		}

		if($db_type==0)
		{
			$prod_sq="SELECT x.po_break_down_id, y.color_size_break_down_id, a.item_number_id, a.color_number_id, a.size_number_id,e.style_ref_no,
				  IFNULL(sum(case when x.production_type ='1' and y.production_type ='1'  then y.production_qnty else 0 end),0) as cutting_qnty,
				  IFNULL(sum(case when x.production_type ='1' and x.entry_break_down_type=3 then (y.production_qnty+y.replace_qty) else 0 end),0) as cutting_qnty_qc,
				  IFNULL(sum(case when x.production_type ='2' and x.embel_name=1 then y.production_qnty else 0 end),0) as printing_qnty,
				  IFNULL(sum(case when x.production_type ='3' and x.embel_name=1 then y.production_qnty else 0 end),0) as printreceived_qnty,
				  IFNULL(sum(case when x.production_type ='2' and x.embel_name=2 then y.production_qnty else 0 end),0) as emb_qnty,
				  IFNULL(sum(case when x.production_type ='3' and x.embel_name=2 then y.production_qnty else 0 end),0) as embreceived_qnty,
				  IFNULL(sum(case when x.production_type ='2' and x.embel_name=3 then y.production_qnty else 0 end),0) as wash_qnty,
				  IFNULL(sum(case when x.production_type ='3' and x.embel_name=3 then y.production_qnty else 0 end),0) as washreceived_qnty,
				  IFNULL(sum(case when x.production_type ='2' and x.embel_name=4 then y.production_qnty else 0 end),0) as sp_qnty,
				  IFNULL(sum(case when x.production_type ='3' and x.embel_name=4 then y.production_qnty else 0 end),0) as spreceived_qnty,
				  IFNULL(sum(case when x.production_type ='4' and y.production_type ='4' then y.production_qnty else 0 end),0) as sewingin_qnty,
				  IFNULL(sum(case when x.production_type ='5' and y.production_type ='5' then y.production_qnty else 0 end),0) as sewingout_qnty,
				  IFNULL(sum(case when x.production_type ='6' then y.production_qnty else 0 end),0) as finishin_qnty,
				  IFNULL(sum(case when x.production_type ='7' then y.production_qnty else 0 end),0) as iron_qnty,
				  IFNULL(sum(case when x.production_type ='8' then y.production_qnty else 0 end),0) as finish_qnty,

				  IFNULL(sum(case when x.production_type ='10' and x.trans_type=5 then y.production_qnty else 0 end),0) as trans_in_qty,
				  IFNULL(sum(case when x.production_type ='10' and x.trans_type=6 then y.production_qnty else 0 end),0) as trans_out_qty,

				  IFNULL(sum(case when x.production_type ='11' and y.production_type ='11' then y.production_qnty else 0 end),0) as poly_qty
				from
					pro_garments_production_mst x, pro_garments_production_dtls y , wo_po_color_size_breakdown a,wo_po_details_master e
				where
				x.id=y.mst_id  and y.color_size_break_down_id=a.id      and a.job_id=e.id and e.company_name=$cbo_company_name
				 $po_break_down_id_cond_new  $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_location_cond $cbo_job_year_cond $cbo_style_owner_wise_status_cond    $internal_ref_cond_prod
			and y.status_active=1 and x.status_active=1 and a.status_active=1 and e.status_active=1
			group by x.po_break_down_id, y.color_size_break_down_id, a.item_number_id, a.color_number_id, a.size_number_id,e.style_ref_no order by x.po_break_down_id,a.size_number_id
			order by x.po_break_down_id,a.color_number_id ,a.size_number_id";
			$prod_sql=sql_select($prod_sq);
		}
		else
		{
		   $prod_sq="SELECT x.po_break_down_id, y.color_size_break_down_id, a.item_number_id, a.color_number_id, a.size_number_id,e.style_ref_no,
			(case when y.production_type ='1' and x.production_type ='1' then y.production_qnty else 0 end) as cutting_qnty,
			(case when y.production_type ='1' and x.production_type ='1' and x.entry_break_down_type=3 then y.production_qnty else 0 end) as cutting_qnty_qc,
			(case when x.production_type ='2' and x.embel_name=1 then y.production_qnty else 0 end) as printing_qnty,
			(case when x.production_type ='3' and x.embel_name=1 then y.production_qnty else 0 end) as printreceived_qnty,
			(case when x.production_type ='2' and x.embel_name=2 then y.production_qnty else 0 end) as emb_qnty,
			(case when x.production_type ='3' and x.embel_name=2 then y.production_qnty else 0 end) as embreceived_qnty,
			(case when x.production_type ='2' and x.embel_name=3 then y.production_qnty else 0 end) as wash_qnty,
			(case when x.production_type ='3' and x.embel_name=3 then y.production_qnty else 0 end) as washreceived_qnty,
			(case when x.production_type ='2' and x.embel_name=4 then y.production_qnty else 0 end) as sp_qnty,
			(case when x.production_type ='3' and x.embel_name=4 then y.production_qnty else 0 end) as spreceived_qnty,
			(case when x.production_type ='4' and y.production_type ='4' then y.production_qnty else 0 end) as sewingin_qnty,
			(case when x.production_type ='5' and  y.production_type ='5' then y.production_qnty else 0 end) as sewingout_qnty,
			(case when x.production_type ='6' and y.production_type ='6' then y.production_qnty else 0 end) as finishin_qnty,
			(case when x.production_type ='7' and y.production_type ='7' then y.production_qnty else 0 end) as iron_qnty,
			(case when x.production_type ='8' and y.production_type ='8' then y.production_qnty else 0 end) as finish_qnty,
			(case when x.production_type ='11' and y.production_type ='11' then y.production_qnty else 0 end) as poly_qty,
			(case when x.production_type ='11' and y.production_type ='11' then y.reject_qty else 0 end) as poly_reject,
			(case when x.production_type ='1' and y.production_type ='1' then y.replace_qty else 0 end) as replace_qnty_qc,

		  	(case when x.production_type ='10' and x.trans_type=5 then y.production_qnty else 0 end) as trans_in_qty,
		  	(case when x.production_type ='10' and x.trans_type=6 then y.production_qnty else 0 end) as trans_out_qty
			from
			pro_garments_production_mst x, pro_garments_production_dtls y , wo_po_color_size_breakdown a,wo_po_details_master e
			where
			x.id=y.mst_id and y.color_size_break_down_id=a.id   and e.status_active=1   and a.job_id=e.id and e.company_name=$cbo_company_name    and e.is_deleted=0
			 $po_break_down_id_cond_new  $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond  $cbo_style_owner_wise_status_cond  $internal_ref_cond_prod $txt_style_ref_id_cond
			and y.status_active=1 and x.status_active=1 and x.is_deleted=0 and y.is_deleted=0 and a.status_active=1 order by x.po_break_down_id,a.color_number_id ,a.size_number_id ";
			$prod_sql=sql_select($prod_sq);
		}

		$prod_color_size_data=array();
		foreach($prod_sql as $row)
		{
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_qc']+=$row[csf("cutting_qnty_qc")] ;
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['replace_qnty_qc']+=$row[csf("replace_qnty_qc")];

			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_toprint']+=$row[csf("printing_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_fromprint']+=$row[csf("printreceived_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_toemb']+=$row[csf("emb_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_fromemb']+=$row[csf("embreceived_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_to_spwork']+=$row[csf("sp_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_from_spwork']+=$row[csf("spreceived_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_swinput']+=$row[csf("sewingin_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_swoutput']+=$row[csf("sewingout_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_poly']+=$row[csf("poly_qty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['poly_reject']+=$row[csf("poly_reject")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_packing']+=$row[csf("finish_qnty")];
		  	$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['color_idd']=$row[csf("color_number_id")];

			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['trans_in_qty']+=$row[csf("trans_in_qty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['trans_out_qty']+=$row[csf("trans_out_qty")];

			//$color[$row[csf("po_break_down_id")]][$row[csf("size_number_id")]]['color_ids'].=$row[csf("color_number_id")].'__';
			//$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("style_ref_no")]][$row[csf("size_number_id")]]['quantity_exfact']+=$row[csf("finish_qnty")];
		}
		//echo "<pre>";
		 //print_r($color_size_qnty_prod); die;


		$color_size_sql=sql_select( "SELECT a.id, a.po_break_down_id, d.po_number, d.pub_shipment_date, a.item_number_id, a.color_number_id, a.size_number_id, e.style_ref_no, e.job_no, e.buyer_name, a.order_quantity, a.plan_cut_qnty, a.is_deleted from wo_po_color_size_breakdown a, wo_po_break_down d, wo_po_details_master e where  a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and d.status_active in(1,2,3)  and a.status_active in(1,2,3) and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond  $order_no_cond $internal_ref_cond_po $active_cond order by a.po_break_down_id, a.color_order, a.size_order");


		$po_color_size_data=array();$color_size_qnty=array();
		$all_po_arr=array();
		foreach($color_size_sql as $row)
		{
			//$test_data[]=$row[csf("color_number_id")];
			$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['style_ref_no']=$row[csf("style_ref_no")];
			$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['buyer_name']=$row[csf("buyer_name")];
			$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['po_number']=$row[csf("po_number")];
			$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['shipdate']=$row[csf("pub_shipment_date")];
			if($row[csf("is_deleted")]==0)
			{
				$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['order_quantity']+=$row[csf("order_quantity")];
				$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['plan_cut_qnty']=$row[csf("plan_cut_qnty")];
			}
			//$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("size_number_id")]]['color_number_id']=$row[csf("color_number_id")];
			$all_po_arr[$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
		}
		if($db_type==2 && count($all_po_arr)>999)
		{
			$all_po_id_chunk=array_chunk($all_po_arr,999) ;
			$all_po_id_cond="";
			foreach($all_po_id_chunk as $chunk_arr)
			{
				$ids=implode(",",$chunk_arr);
				if(!$all_po_id_cond) $all_po_id_cond.=" and ( b.order_id in($ids) ";
				else $all_po_id_cond.=" or b.order_id in($ids) ";

			}

			$all_po_id_cond.=" )";

		}
		else
		{
			$all_po_ids=implode(",",$all_po_arr);
			$all_po_id_cond=" and b.order_id in($all_po_ids)";
		}

		$lay_sql="SELECT a.gmt_item_id,a.color_id,b.order_id, b.size_id,sum(b.size_qty) as qnty from ppl_cut_lay_dtls a,ppl_cut_lay_bundle b where a.id=b.dtls_id and a.status_active=1 and b.status_active=1 $all_po_id_cond group by a.gmt_item_id,a.color_id,b.order_id, b.size_id ";
		foreach(sql_select($lay_sql) as $rows)
		{
			$color_size_qnty_lay[$rows[csf("order_id")]][$rows[csf("gmt_item_id")]][$rows[csf("color_id")]][$rows[csf("size_id")]]['lay_qty']+=$rows[csf("qnty")];
		}


		$all_po_id_cond3=str_replace('b.order_id','b.id',$all_po_id_cond);
		$po_no_library=return_library_array( "select b.id,b.po_number from wo_po_break_down b where 1=1 $all_po_id_cond3", "id", "po_number");




    	$report_data='<div>
    	<fieldset>
    	<legend> Order and Size Wise</legend>
    	<table border="1" cellpadding="0" cellspacing="0">
		<caption><h2>Order and Size - Style NO: '.$color_size_sql[0][csf(style_ref_no)].' JOB NO : '.$color_size_sql[0][csf(job_no)].' Buyer Name : '.$buyer_short_library[$color_size_sql[0][csf('buyer_name')]].' </h2></caption>
         <thead>
        	<tr>
     		    <th colspan="12"></th>
                <th colspan="3">Emblishment Rcvd</th>
                <th colspan="12"></th>
           </tr>
        </thead>
        <thead>
        	<tr>
            	<th>SL</th>
            	<th>PO</th>
				<th>Style No</th>
            	<th>Buyer Name</th>
                <th>Pub. Ship Date</th>
            	<th">Garments Item</th>
                <th>Color</th>
     		    <th>Size</th>
                <th>Order Total</th>
                <th">Cutting Qty</th>
                <th>Cutt/Qc Total</th>
     		    <th>Cutt Short/excess</th>

                <th>Print</th>
                <th>Embroidary</th>
                <th>Sp. Work</th>

                <th>Inp Total</th>
     		    <th>Inp Short/Excess</th>
                <th>Sewing Output Total</th>
                <th>Output Short/excess</th>
     		    <th>Poly Out Total</th>
				<th>Poly Reject</th>
                <th>Poly Output Short/excess</th>
                <th><p>Total Packing and Finishing</p></th>
     		    <th><p>Packing and finishing Short/excess</p></th>
                <th>Total Ex Factory</th>
                <th>FG Stock in Hand</th>
     		    <th>Exfactory Short/excess</th>

             </tr>
        </thead>
		</table>
		<div>
		 	<table cellspacing="0" cellpadding="0">
			  	<tbody> ';

			    /*foreach($color_size_sql as $row)
				{*/
				$i=0;
				foreach($po_color_size_data as $poID=>$breakDown_id)
				{
					foreach($breakDown_id as $itemID=> $items)
					{
						$item_total_order_qty="";
						$item_total_lay_qty=0;
						$item_total_cutt_qty="";
						$item_total_cuttShortEx_qty="";

						$item_total_emblPrint="";
						$item_total_emblEmbro="";
						$item_total_emblSPwork="";

						$item_total_input_qty="";
						$item_total_inputShortEx_qty="";
						$item_total_sewing_qty="";
						$item_total_swoutShortEx_qty="";
						$item_total_poly_qty="";
						$item_total_polyShortEx_qty="";
						$item_total_carton_qty="";
						$item_total_cartonShortEx_qty="";
						$item_total_exfact_qty="";
						$item_total_fg_qty="";
						$item_total_exfactShortEx_qty="";
						//$gTotal_inputShortEx_qty="";
						foreach($items as $colorID=> $colors)
						{
							$total_order_qty="";
							$total_lay_qty=0;
							$total_cutt_qty="";
							$total_cuttShortEx_qty="";

							$total_emblPrint="";
							$total_emblEmbro="";
							$total_emblSPwork="";

							$total_input_qty="";
							$total_inputShortEx_qty="";
							$total_sewing_qty="";
							$total_swoutShortEx_qty="";
							$total_poly_qty="";
							$total_poly_reject="";
							$total_polyShortEx_qty="";
							$total_carton_qty="";
							$total_cartonShortEx_qty="";
							$total_exfact_qty="";
							$total_fg_qty="";
							$total_exfactShortEx_qty="";
							//$gTotal_inputShortEx_qty="";
							foreach($colors as $sizeNoID=> $val)
							{

								$bgcolor = ($i%2) ? "#ebf3ff" : "#ffffff";
								$i++;

						        $report_data.='<tr  bgcolor="'.$bgcolor.'">
						        	<td align="left">'.$i.'</td>
									<td align="left">'.$val[po_number].'</td>
									<td align="left">'.$val[style_ref_no].'</td>
									<td align="left">'.$buyer_library[$val[buyer_name]] .'</td>
                                    <td align="left">'.change_date_format($val[shipdate]).'</td>
									<td align="left">'.$garments_item[$itemID].'</td>
						            <td  align="left">'. $color_Arr_library[$colorID].'</td>
						            <td align="left"><p>'.$size_Arr_library[$sizeNoID].'&nbsp;</p></td>
						            <td align="right">'.$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID][order_quantity].'</td>
						            <td align="right">'.$layQty=$color_size_qnty_lay[$poID][$itemID][$colorID][$sizeNoID]['lay_qty'].'</td>
						            <td align="right">'.$cuttQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_qc'].'</td>';

										$cut_shortExc= $po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_qc'];
										if($cut_shortExc<0)
										{
											$cut_shortExc=abs($cut_shortExc);
											$cut_shortExc='('.$cut_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$cut_shortExc=$cut_shortExc;$bg_tdColor='';
										}

						            $report_data.='<td align="right" style="color:'.$bg_tdColor.'">'.$cut_shortExc.'</td>



						            <td align="right">'.

										$sendToPrint=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_fromprint']+=$row[csf(printreceived_qnty)];
										 $emblishMentPrint=$sendToPrint.'
						            </td>
						             <td align="right">'.

										$sentToEmblishment=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_fromemb']+=$row[csf("embreceived_qnty")];
										 $emblishMentEmbro=$sentToEmblishment.'
						            </td>
						             <td align="right">'.

										$sentToSpecialWork=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_from_spwork']+=$row[csf("spreceived_qnty")];
										 $emblishMentSPwork=$sentToSpecialWork.'
						            </td>

						            <td align="right">'.$inputQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swinput].'</td>';

										$qtyCuttQC=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_qc];
										$swInPut=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swinput];

							            $input_shortExc=$qtyCuttQC-$swInPut;
										if($input_shortExc<0)
										{
											$input_shortExc=abs($input_shortExc);
											$input_shortExc='('.$input_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$input_shortExc=$input_shortExc;$bg_tdColor='';
										}

						            $report_data.='<td align="right"  style="color:'.$bg_tdColor.'">'.$input_shortExc.'</td>
						            <td align="right">'.$swoutQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swoutput].'</td>';

										$output_shortExc=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swinput]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swoutput];
										if($output_shortExc<0)
										{
											$output_shortExc=abs($output_shortExc);
											$output_shortExc='('.$output_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$output_shortExc=$output_shortExc;$bg_tdColor='';
										}

						            $report_data.='<td align="right" style="color:'.$bg_tdColor.'">'.$output_shortExc.'</td>
						            <td align="right">'.$polyQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_poly].'</td>
									<td align="right">'.$polyreject=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][poly_reject].'</td>';

										$poly_output_shortExc=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swinput]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_poly]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][poly_reject];
										if($poly_output_shortExc<0)
										{
											$poly_output_shortExc=abs($poly_output_shortExc);
											$poly_output_shortExc='('.$poly_output_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$poly_output_shortExc=$poly_output_shortExc;$bg_tdColor='';
										}

										$report_data.='<td align="right" style="color:'.$bg_tdColor.'">'.$poly_output_shortExc.'</td>
						            <td align="right">'.$cartonQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_packing]+$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][trans_in_qty]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][trans_out_qty].'</td>';

										$carton_shortExc=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_poly']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_packing']+$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_in_qty']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_out_qty'];
										if($carton_shortExc<0)
										{
											$carton_shortExc=abs($carton_shortExc);
											$carton_shortExc='('.$carton_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$carton_shortExc=$carton_shortExc;$bg_tdColor='';
										}

										$report_data.='<td align="right" style="color:'.$bg_tdColor.'">'.$carton_shortExc.'</td>
						            <td align="right">'.$exFacQty=$ex_fact_qty_arr[$poID][$itemID][$colorID][$sizeNoID][ex_fact_qty].'</td>
						            <td align="right">'.$fg_inhand_qty = $polyQty - $exFacQty.'</td>';


										$exFactory_shortExc=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity']-$ex_fact_qty_arr[$poID][$itemID][$colorID][$sizeNoID]['ex_fact_qty'];


										if($exFactory_shortExc<0)
										{
											$exFactory_shortExc=abs($exFactory_shortExc);
											$exFactory_shortExc='('.$exFactory_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$exFactory_shortExc=$exFactory_shortExc;$bg_tdColor='';
										}

										$report_data.='<td align="right" style="color:'.$bg_tdColor.'">'.$exFactory_shortExc.'</td>
								</tr>';

								$total_order_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID][order_quantity];

								$total_lay_qty+=$layQty;
								$total_cutt_qty+=$cuttQty;
								$total_cuttShortEx_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID][order_quantity]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_qc];

								$total_emblPrint+=$emblishMentPrint;
								$total_emblEmbro+=$emblishMentEmbro;
								$total_emblSPwork+=$emblishMentSPwork;

								$total_input_qty+=$inputQty;
								$total_inputShortEx_qty+=$qtyCuttQC-$swInPut;
								$total_sewing_qty+=$swoutQty;
								$total_swoutShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swinput]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swoutput];
								$total_poly_qty+=$polyQty;
								$total_poly_reject+=$polyreject;
								$total_polyShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swinput]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_poly]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][poly_reject];
								$total_carton_qty+=$cartonQty;
								$total_cartonShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_poly]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_packing]+$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][trans_in_qty]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][trans_out_qty];
								$total_exfact_qty+=$exFacQty;
								$total_fg_qty+=$fg_inhand_qty;
								$total_exfactShortEx_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID][order_quantity]-$ex_fact_qty_arr[$poID][$itemID][$colorID][$sizeNoID][ex_fact_qty];

								// ====================== item wise ==================================
								$item_total_order_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID][order_quantity];

								$item_total_lay_qty+=$layQty;
								$item_total_cutt_qty+=$cuttQty;
								$item_total_cuttShortEx_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID][order_quantity]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_qc];

								$item_total_emblPrint+=$emblishMentPrint;
								$item_total_emblEmbro+=$emblishMentEmbro;
								$item_total_emblSPwork+=$emblishMentSPwork;

								$item_total_input_qty+=$inputQty;
								$item_total_inputShortEx_qty+=$qtyCuttQC-$swInPut;
								$item_total_sewing_qty+=$swoutQty;
								$item_total_swoutShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swinput]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swoutput];
								$item_total_poly_qty+=$polyQty;
								$item_total_poly_reject+=$polyreject;
								$item_total_polyShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_swinput]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_poly]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][poly_reject];
								$item_total_carton_qty+=$cartonQty;
								$item_total_cartonShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_poly]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][quantity_packing]+$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][trans_in_qty]-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID][trans_out_qty];
								$item_total_exfact_qty+=$exFacQty;
								$item_total_fg_qty+=$fg_inhand_qty;
								$item_total_exfactShortEx_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID][order_quantity]-$ex_fact_qty_arr[$poID][$itemID][$colorID][$sizeNoID][ex_fact_qty];
							}

					        $report_data.='<tr>
					        	<td align="left"><b></b></td>
					        	<td align="left"><b>'.$po_no_library[$poID].'</b></td>
								<th></th>
            					<th></th>
                                <td align="left"><b></b></td>
					        	<td align="left"><b>'.$garments_item[$itemID].'</b></td>
					            <td colspan="2" align="right"><b>Color Wise PO Total=</b></td>

					            <td align="right"><b>'.$total_order_qty.'</b></td>
					            <td align="right"><b>'.$total_lay_qty.'</b></td>
					            <td align="right"><b>'.$total_cutt_qty.'</b></td>';


								 $bg_tdColor='';
								 $total_cuttShortEx_qtyy=$total_cuttShortEx_qty;
					            if($total_cuttShortEx_qtyy<0)
									{
										$total_cuttShortEx_qtyy=abs($total_cuttShortEx_qtyy);
										$total_cuttShortEx_qtyy='('.$total_cuttShortEx_qtyy.')'; $bg_tdColor='red';
									}
									else
									{
										$total_cuttShortEx_qtyy=$total_cuttShortEx_qty;$bg_tdColor='';
									}

									$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$total_cuttShortEx_qtyy.'</b></td>

					            <td align="right"><b>'.$total_emblPrint.'</b></td>
					            <td align="right"><b>'.$total_emblEmbro.'</b></td>
					            <td align="right"><b>'.$total_emblSPwork.'</b></td>
					            <td align="right"><b>'.$total_input_qty.'</b></td>';
					           $gTotal_inputShortEx_qty=$total_inputShortEx_qty; if($total_inputShortEx_qty<0){  $total_inputShortEx_qty=abs($total_inputShortEx_qty); $total_inputShortEx_qty='('.$total_inputShortEx_qty.')'; $bg_tdColor='red'; } else {  $total_inputShortEx_qty;$bg_tdColor='';  }

							   $report_data.='<td style="color:'.$bg_tdColor.'" align="right"><b>'.$total_inputShortEx_qty; $total_inputShortEx_qty='';
							   $report_data.='</b></td>
					            <td align="right"><b>'.$total_sewing_qty.'</b></td>
					            <td align="right"><b>'.$total_swoutShortEx_qty.'</b></td>
					            <td align="right"><b>'.$total_poly_qty.'</b></td>
								<td align="right"><b>'.$total_poly_reject.'</b></td>';


								 $total_polyShortEx_qtyy=$total_polyShortEx_qty;
					            if($total_polyShortEx_qtyy<0)
									{
										$total_polyShortEx_qtyy=abs($total_polyShortEx_qtyy);
										$total_polyShortEx_qtyy='('.$total_polyShortEx_qtyy.')'; $bg_tdColor='red';
									}
									else
									{
										$total_polyShortEx_qtyy=$total_polyShortEx_qty;$bg_tdColor='';
									}


									$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$total_polyShortEx_qtyy.'</b></td>
					            <td align="right"><b>'.$total_carton_qty.'</b></th>';


								 $total_cartonShortEx_qtyy=$total_cartonShortEx_qty;
					            if($total_cartonShortEx_qtyy<0)
									{
										$total_cartonShortEx_qtyy=abs($total_cartonShortEx_qtyy);
										$total_cartonShortEx_qtyy='('.$total_cartonShortEx_qtyy.')'; $bg_tdColor='red';
									}
									else
									{
										$total_cartonShortEx_qtyy=$total_cartonShortEx_qty;$bg_tdColor='';
									}



									$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$total_cartonShortEx_qtyy.'</b></td>
					            <td align="right"><b>'.$total_exfact_qty.'</b></td>
					            <td align="right"><b>'.$total_fg_qty.'</b></td>';


								 $total_exfactShortEx_qtyy=$total_exfactShortEx_qty;
					            if($total_exfactShortEx_qtyy<0)
									{
										$total_exfactShortEx_qtyy=abs($total_exfactShortEx_qtyy);
										$total_exfactShortEx_qtyy='('.$total_exfactShortEx_qtyy.')'; $bg_tdColor='red';
									}
									else
									{
										$total_exfactShortEx_qtyy=$total_exfactShortEx_qty;$bg_tdColor='';
									}


									$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$total_exfactShortEx_qtyy.'</b></td>
					        </tr>';

					        $grandTotal_order_qty+=$total_order_qty;
							$total_order_qty=0;
							$grandTotal_lay_qty+=$total_lay_qty;
							$grandTotal_cutt_qty+=$total_cutt_qty;
							$total_lay_qty=0;
							$total_cutt_qty=0;
							$grandTotal_cuttShortEx_qty+=$total_cuttShortEx_qty;
							$total_cuttShortEx_qty=0;

							$grandTotal_emblPrint+=$total_emblPrint;
							$total_emblPrint=0;
							$grandTotal_emblEmbro+=$total_emblEmbro;
							$total_emblEmbro=0;
							$grandTotal_emblSPwork+=$total_emblSPwork;
							$total_emblSPwork=0;

							$grandTotal_input_qty+=$total_input_qty;
							$total_input_qty=0;
							$grandTotal_inputShortEx_qty+=$gTotal_inputShortEx_qty;
							$gTotal_inputShortEx_qty=0;
							$grandTotal_sewing_qty+=$total_sewing_qty;
							$total_sewing_qty=0;
							$grandTotal_swoutShortEx_qty+=$total_swoutShortEx_qty;
							$total_swoutShortEx_qty=0;
							$grandTotal_poly_qty+=$total_poly_qty;
							$grandTotal_poly_reject+=$total_poly_reject;
							$total_poly_qty=0;
							$grandTotal_polyShortEx_qty+=$total_polyShortEx_qty;
							$total_polyShortEx_qty=0;
							$grandTotal_carton_qty+=$total_carton_qty;
							$total_carton_qty=0;
							$grandTotal_cartonShortEx_qty+=$total_cartonShortEx_qty;
							$total_cartonShortEx_qty=0;
							$grandTotal_exfact_qty+=$total_exfact_qty;
							$grandTotal_fg_qty+=$total_fg_qty;
							$total_exfact_qty=0;
							$grandTotal_exfactShortEx_qty+=$total_exfactShortEx_qty;
							$total_exfactShortEx_qty=0;



							$report_data.='<tr>
				        	<td align="left"><b></b></td>
				        	<td align="left"><b>'.$po_no_library[$poID].'</b></td>
							<th></th>
            				<th></th>
                            <td align="left"><b></b></td>
				        	<td align="left"><b>'.$garments_item[$itemID].'</b></td>
				            <td colspan="2" align="right"><b>Item Wise PO Total=</b></td>

				            <td align="right"><b>'.$item_total_order_qty.'</b></td>
				            <td align="right"><b>'.$item_total_lay_qty.'</b></td>
				            <td align="right"><b>'.$item_total_cutt_qty.'</b></td>';


							 $bg_tdColor='';
							 $item_total_cuttShortEx_qtyy=$item_total_cuttShortEx_qty;
				            if($item_total_cuttShortEx_qtyy<0)
								{
									$item_total_cuttShortEx_qtyy=abs($item_total_cuttShortEx_qtyy);
									$item_total_cuttShortEx_qtyy='('.$item_total_cuttShortEx_qtyy.')'; $bg_tdColor='red';
								}
								else
								{
									$item_total_cuttShortEx_qtyy=$item_total_cuttShortEx_qty;$bg_tdColor='';
								}

								$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$item_total_cuttShortEx_qtyy.'</b></td>

				            <td align="right"><b>'.$item_total_emblPrint.'</b></td>
				            <td align="right"><b>'.$item_total_emblEmbro.'</b></td>
				            <td align="right"><b>'.$item_total_emblSPwork.'</b></td>
				            <td align="right"><b>'.$item_total_input_qty.'</b></td>';
				           $gTotal_inputShortEx_qty=$item_total_inputShortEx_qty; if($item_total_inputShortEx_qty<0){  $item_total_inputShortEx_qty=abs($item_total_inputShortEx_qty); $total_inputShortEx_qty='('.$total_inputShortEx_qty.')'; $bg_tdColor='red'; } else {  $total_inputShortEx_qty;$bg_tdColor='';  }

						   $report_data.='<td style="color:'.$bg_tdColor.'" align="right"><b>'.$item_total_inputShortEx_qty; $item_total_inputShortEx_qty='';
						   $report_data.='</b></td>
				            <td align="right"><b>'.$item_total_sewing_qty.'</b></td>
				            <td align="right"><b>'.$item_total_swoutShortEx_qty.'</b></td>
				            <td align="right"><b>'.$item_total_poly_qty.'</b></td>
							<td align="right"><b>'.$item_total_poly_reject.'</b></td>';


							 $item_total_polyShortEx_qtyy=$item_total_polyShortEx_qty;
				            if($item_total_polyShortEx_qtyy<0)
								{
									$item_total_polyShortEx_qtyy=abs($item_total_polyShortEx_qtyy);
									$item_total_polyShortEx_qtyy='('.$item_total_polyShortEx_qtyy.')'; $bg_tdColor='red';
								}
								else
								{
									$item_total_polyShortEx_qtyy=$item_total_polyShortEx_qty;$bg_tdColor='';
								}


								$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$item_total_polyShortEx_qtyy.'</b></td>
				            <td align="right"><b>'.$item_total_carton_qty.'</b></th>';


							$item_total_cartonShortEx_qtyy=$item_total_cartonShortEx_qty;
				            if($total_cartonShortEx_qtyy<0)
								{
									$item_total_cartonShortEx_qtyy=abs($item_total_cartonShortEx_qtyy);
									$item_total_cartonShortEx_qtyy='('.$item_total_cartonShortEx_qtyy.')'; $bg_tdColor='red';
								}
								else
								{
									$item_total_cartonShortEx_qtyy=$item_total_cartonShortEx_qty;$bg_tdColor='';
								}



							$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$item_total_cartonShortEx_qtyy.'</b></td>
				            <td align="right"><b>'.$item_total_exfact_qty.'</b></td>
				            <td align="right"><b>'.$item_total_fg_qty.'</b></td>';


							 $item_total_exfactShortEx_qtyy=$item_total_exfactShortEx_qty;
				            if($item_total_exfactShortEx_qtyy<0)
								{
									$item_total_exfactShortEx_qtyy=abs($item_total_exfactShortEx_qtyy);
									$item_total_exfactShortEx_qtyy='('.$item_total_exfactShortEx_qtyy.')'; $bg_tdColor='red';
								}
								else
								{
									$item_total_exfactShortEx_qtyy=$item_total_exfactShortEx_qty;$bg_tdColor='';
								}


								$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$item_total_exfactShortEx_qtyy.'</b></td>
				        </tr>';

					} // end item wise


				} // end po wise
				//  grand total bottom part
			}

				$report_data.='<tr>
		            <td colspan="8" align="right"><b>Grand Total </b></td>
		            <td align="right"><b>'.$grandTotal_order_qty.'</b></td>
		            <td align="right"><b>'.$grandTotal_lay_qty.'</b></td>
		            <td align="right"><b>'.$grandTotal_cutt_qty.'</b></td>';



		            if($grandTotal_cuttShortEx_qty<0)
						{
							$grandTotal_cuttShortEx_qty=abs($grandTotal_cuttShortEx_qty);
							$grandTotal_cuttShortEx_qty='('.$grandTotal_cuttShortEx_qty.')'; $bg_tdColor='red';
						}
						else
						{
							$grandTotal_cuttShortEx_qty=$grandTotal_cuttShortEx_qty;$bg_tdColor='';
						}


						$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$grandTotal_cuttShortEx_qty.'</b></td>

		            <td align="right"><b>'.$grandTotal_emblPrint.'</b></td>
		            <td align="right"><b>'.$grandTotal_emblEmbro.'</b></td>
		            <td align="right"><b>'.$grandTotal_emblSPwork.'</b></td>

		            <td align="right"><b>'.$grandTotal_input_qty.'</b></td>';
		            if($grandTotal_inputShortEx_qty<0){  $grandTotal_inputShortEx_qty=abs($grandTotal_inputShortEx_qty); $grandTotal_inputShortEx_qty='('.$grandTotal_inputShortEx_qty.')'; $bg_tdColor='red'; } else {  $grandTotal_inputShortEx_qty;$bg_tdColor='';  }

					$report_data.=' <td style="color:'.$bg_tdColor.'" align="right"><b>'.$grandTotal_inputShortEx_qty.'</b></td>
		            <td align="right"><b>'.$grandTotal_sewing_qty.'</b></td>
		            <td align="right"><b>'.$grandTotal_swoutShortEx_qty.'</b></td>
		            <td align="right"><b>'.$grandTotal_poly_qty.'</b></td>
					<td align="right"><b>'.$grandTotal_poly_reject.'</b></td>';



		            if($grandTotal_polyShortEx_qty<0)
						{
							$grandTotal_polyShortEx_qty=abs($grandTotal_polyShortEx_qty);
							$grandTotal_polyShortEx_qty='('.$grandTotal_polyShortEx_qty.')'; $bg_tdColor='red';
						}
						else
						{
							$grandTotal_polyShortEx_qty=$grandTotal_polyShortEx_qty;$bg_tdColor='';
						}



						$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$grandTotal_polyShortEx_qty.'</b></td>
		            <td align="right"><b>'.$grandTotal_carton_qty.'</b></th>
		            <td align="right"><b>'.$grandTotal_cartonShortEx_qty.'</b></td>
		            <td align="right"><b>'.$grandTotal_exfact_qty.'</b></td>
		            <td align="right"><b>'.$grandTotal_fg_qty.'</b></td>';


		            if($grandTotal_exfactShortEx_qty<0)
						{
							$grandTotal_exfactShortEx_qty=abs($grandTotal_exfactShortEx_qty);
							$grandTotal_exfactShortEx_qty='('.$grandTotal_exfactShortEx_qty.')'; $bg_tdColor='red';
						}
						else
						{
							$grandTotal_exfactShortEx_qty=$grandTotal_exfactShortEx_qty;$bg_tdColor='';
						}


						$report_data.='<td align="right" style="color:'.$bg_tdColor.'"><b>'.$grandTotal_exfactShortEx_qty.'</b></td>
		        </tr>

			    </tbody>
		    </table>
			</div>
			</fieldset>
			</div>';



	}
	else if($type==6) // job and color wise
	{
		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}

		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_season_id!=0) $str_po_cond.=" and a.season_buyer_wise=$cbo_season_id";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}

		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and c.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";

		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";

		// ========================================== MAIN QUERY ==================================================
		$order_sql="SELECT b.id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.po_number, b.shipment_date, b.excess_cut,  b.is_confirmed, c.item_number_id as item_number_id, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total ,max(c.shiping_status) as shiping_status,sum(c.plan_cut_qnty) as plan_cut_qnty,b.grouping
		from wo_po_details_master a,wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active in(1,2,3) and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $active_cond $order_status_cond $str_po_cond $txt_style_ref_number_cond  $internal_ref_cond_po
		group by a.id,a.job_no_prefix_num,a.job_no,a.insert_date,a.company_name,a.buyer_name,a.style_ref_no,b.id,b.po_number, b.shipment_date, b.excess_cut, b.is_confirmed, c.item_number_id, c.color_number_id,b.grouping
		order by b.shipment_date, b.id, c.item_number_id,c.color_number_id";

		$sql_po_result=sql_select($order_sql);
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("id")].",";
			$all_po_id_arr[$row[csf("id")]]=$row[csf("id")];
		}
		//=================================== Delete Order Id From TEMP ENGINE ====================================
		$con = connect();
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 21 and ref_from=6");
		oci_commit($con);
		//=================================== Insert order_id into TEMP ENGINE ====================================
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 21, 6,$all_po_id_arr, $empty_arr);

	    $all_po_id=chop($all_po_id,",");

	    $all_po_ids=implode(",", $all_po_id_arr);
	    $all_po_ids_cond="";
 		if(count($all_po_id_arr)>0)
 		{
 			  if($db_type==2 && count($all_po_id_arr)>999)
			   {
			   		$chunk_arr=array_chunk($all_po_id_arr, 999);
			   		foreach($chunk_arr as $vals)
			   		{
			   			$po_ids=implode(",", $vals);
			   			if($all_po_ids_cond=="")
			   			{
			   				$all_po_ids_cond.=" and (c.order_id in ($po_ids)";
			   			}
			   			else
			   			{
			   				$all_po_ids_cond.=" or  c.order_id in ($po_ids)";
			   			}
			   		}
			   		$all_po_ids_cond.= " )";
			   }
			   else
			   {
			   		$all_po_ids_cond= " and c.order_id in($all_po_ids) ";
			   }
 		}

 		if($all_po_ids != "")
 		{
			$template_sql = "select a.po_number_id, a.template_id from tna_process_mst a ,GBL_TEMP_ENGINE b where a.po_number_id=b.ref_val and b.entry_form=21 and b.ref_from=6 and b.user_id=$user_id group by a.po_number_id, a.template_id";
			$template_id_arr=return_library_array($template_sql ,"po_number_id","template_id");
 		}
		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and c.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(array_unique(explode(",",$all_po_id)),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (c.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or c.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}
			}
		}
		// ======================= FOR EXFACTORY  ===========================
		$ex_factory_arr=array();
		$ex_fac_level=sql_select("select ex_factory  from variable_settings_production where company_name=$cbo_company_name and variable_list=1 and status_active=1");
		if($ex_fac_level[0][csf("ex_factory")]==1)
		{
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , c.item_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN c.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN c.ex_factory_qnty ELSE 0 END) as ex_factory_qnty
			from GBL_TEMP_ENGINE b,pro_ex_factory_mst c where c.po_break_down_id=b.ref_val and b.entry_form=21 and b.ref_from=6 and b.user_id=$user_id and c.status_active=1 and c.is_deleted=0  group by c.po_break_down_id, c.item_number_id");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}

		}
		else
		{
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , f.color_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN d.production_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN d.production_qnty ELSE 0 END) as ex_factory_qnty, e.job_no_mst as job_no
			from  GBL_TEMP_ENGINE b,pro_ex_factory_mst c ,pro_ex_factory_dtls d,wo_po_break_down e ,wo_po_color_size_breakdown f
			where c.po_break_down_id=b.ref_val and c.id=d.mst_id and c.po_break_down_id=e.id and e.id=f.po_break_down_id and f.id=d.color_size_break_down_id and
         	c.status_active=1 and c.is_deleted=0 and    d.status_active=1 and d.is_deleted=0 and      e.status_active in(1,2,3) and e.is_deleted=0 and f.status_active in(1,2,3)
         	group by c.po_break_down_id, f.color_number_id,e.job_no_mst");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		}
		unset($ex_factory_data);
		// ============================ FOR PRODUCTION DATA =================================
		if($db_type==0)
		{

			$prod_sql="SELECT c.po_break_down_id, c.item_number_id,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				IFNULL(sum(CASE WHEN d.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,


				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				IFNULL(sum(CASE WHEN c.production_type ='10' and c.trans_type=5 THEN d.production_qnty ELSE 0 END),0) AS trans_in_qty,
				IFNULL(sum(CASE WHEN c.production_type ='10' and c.trans_type=6 THEN d.production_qnty ELSE 0 END),0) AS trans_out_qty,


				IFNULL(sum(CASE WHEN d.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='5' THEN d.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='11' THEN d.production_qnty ELSE 0 END),0) AS poly_qty,
				IFNULL(sum(CASE WHEN d.production_type in (1,2,4,3,5,7,8,11) and c.production_type in (1,2,4,3,5,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=1 then c.carton_qty ELSE 0 END),0) as carton_qty_no_inhouse,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=3 then c.carton_qty ELSE 0 END),0) as carton_qty_no_outbound,
				IFNULL(sum(CASE When d.production_type ='8' and c.production_type ='8' then c.carton_qty ELSE 0 END),0) as carton_total_qty

			from
				pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e
			where  c.id=d.mst_id  and c.po_break_down_id=a.po_break_down_id and a.job_no_mst=e.job_no  and a.id=d.color_size_break_down_id and c.status_active=1 and   c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and e.status_active=1 and e.is_deleted=0  $active_cond_a_d  $po_product_cond $internal_ref_cond_prod
			group by c.po_break_down_id, c.item_number_id";

			$sql_carton_qty=sql_select("select c.po_break_down_id,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=1 then c.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=3 then c.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when c.production_type ='8' then c.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst c where c.status_active=1 and c.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by c.po_break_down_id");
		}
		else
		{
			$producttion_cond =" and c.po_break_down_id in($po_id)";
			$prod_sql= "SELECT c.po_break_down_id, a.color_number_id,e.job_no,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.replace_qty ELSE 0 END),0) AS replace_qty,

				NVL(sum(CASE WHEN d.production_type ='2'  and c.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				NVL(sum(CASE WHEN c.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				NVL(sum(CASE WHEN d.production_type ='3'  and c.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,

				NVL(sum(CASE WHEN c.production_type ='10' and c.trans_type=5 THEN d.production_qnty ELSE 0 END),0) AS trans_in_qty,
				NVL(sum(CASE WHEN c.production_type ='10' and c.trans_type=6 THEN d.production_qnty ELSE 0 END),0) AS trans_out_qty,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,

				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' THEN d.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' THEN d.reject_qty ELSE 0 END),0) AS poly_rej_qnty,

				NVL(sum(CASE WHEN d.production_type in (1,3,5,7,8,11) and c.production_type in (1,3,5,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				NVL(sum(CASE WHEN d.production_type ='11' and c.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,

				NVL(sum(CASE WHEN c.production_type ='11' and d.production_type ='11'  THEN d.production_qnty ELSE 0 END),0) AS poly_qty

			from
				GBL_TEMP_ENGINE b,pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e
			where  c.po_break_down_id=b.ref_val and c.id=d.mst_id     and a.job_id=e.id  and a.id=d.color_size_break_down_id and b.entry_form=21 and b.ref_from=6 and b.user_id=$user_id  and
				c.status_active=1 and c.is_deleted=0 and d.status_active=1 and a.status_active=1  $active_cond_a_d and d.is_deleted=0  and e.status_active=1 and e.is_deleted=0
			group by c.po_break_down_id, a.color_number_id,e.job_no";

			// =============================== for carton quantity =======================================
			$po_product_cond2 = str_replace('c.po_break_down_id', 'd.po_break_down_id', $po_product_cond);
			$sql_carton_qty=sql_select("SELECT d.po_break_down_id,a.job_no,c.color_number_id,
			NVL(sum(case when d.production_type ='8' and d.production_source=1 then d.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			NVL(sum(case when d.production_type ='8' and d.production_source=3 then d.carton_qty else 0 end),0) as carton_qty_no_outbound,
			NVL(sum(case when d.production_type ='8' then d.carton_qty else 0 end),0) as carton_total_qty
			FROM wo_po_details_master a,wo_po_break_down b, wo_po_color_size_breakdown c,pro_garments_production_mst d
			WHERE a.id=b.job_id and a.id=c.job_id and b.job_id=c.job_id and b.id=c.po_break_down_id and b.id=d.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0  $active_cond $po_product_cond2 $internal_ref_cond_prod
			GROUP BY d.po_break_down_id,a.job_no,c.color_number_id");

		}
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		}
		// print_r($carton_arr);
		// ===================== sub contract query start here ===========================
		$str_po_cond_subcon="";
		$str_po_cond_subcon2="";
		if($txt_datefrom!="" &&  $txt_dateto!="") { $str_po_cond_subcon .=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'"; $str_po_cond_subcon2.=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'";}
		if(str_replace("'", "",$cbo_company_name)!=0)
		{
			$str_po_cond_subcon.=" and b.company_id=$cbo_company_name";
			$str_po_cond_subcon2.=" and a.company_id=$cbo_company_name";
		}
		if(str_replace("'", "",$cbo_buyer_name)!=0) $str_po_cond_subcon.=" and b.party_id=$cbo_buyer_name";
		if(str_replace("'", "",$cbo_location)!=0) $str_po_cond_subcon.=" and b.location_id=$cbo_location";
		if(str_replace("'", "",$txt_style_ref)!="") $str_po_cond_subcon.=" and b.job_no_prefix_num=$txt_style_ref";
		if(str_replace("'", "",$txt_order)!="") $str_po_cond_subcon.=" and c.order_no=$txt_order";
		if($db_type==0) $select_job_year_subcon="year(b.insert_date) as job_year"; else $select_job_year_subcon="to_char(b.insert_date,'YYYY') as job_year";
		$sub_con_po_wise_qty_sql="SELECT c.id,sum(b.qnty) as order_quantity,sum(b.plan_cut) as plan_cut  from subcon_ord_mst a,  subcon_ord_dtls c,subcon_ord_breakdown b where c.status_active=1 and c.is_deleted=0 and c.id=b.order_id and c.job_no_mst=a.subcon_job and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 $str_po_cond_subcon2  group by  c.id";
		foreach(sql_select($sub_con_po_wise_qty_sql) as $key=>$vals)
		{
			$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"]=$vals[csf("order_quantity")];
			$sub_con_po_wise_qty_arr[$vals[csf("id")]]["plan"]=$vals[csf("plan_cut")];
		}

	    $subcon_sql="SELECT c.id,b.company_id,b.party_id as buyer_name,c.order_no as po_number,b.subcon_job as job_no,b.job_no_prefix_num ,$select_job_year_subcon,c.cust_style_ref as style_ref_no,e.item_id as item_number_id,sum(e.qnty) as po_quantity,c.delivery_date as country_ship_date,sum(e.plan_cut) as plan_cut,sum(case when d.production_type=1 then d.prod_qnty else 0 end ) as cutting_qnty,sum(case when d.production_type=2 then d.prod_qnty else 0 end) as sewing_out,sum(case when d.production_type=3 then d.prod_qnty else 0 end) as iron_qnty,sum(case when d.production_type=5 then d.prod_qnty else 0 end) as poly_qnty,sum(case when d.production_type=4 then d.prod_qnty else 0 end) as finishing_qnty FROM subcon_gmts_prod_dtls a,subcon_gmts_prod_col_sz d, subcon_ord_mst b, subcon_ord_dtls c ,subcon_ord_breakdown e
				WHERE a.id=d.dtls_id and a.order_id=c.id and c.job_no_mst=b.subcon_job and a.status_active=1 and a.is_deleted=0   and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and e.id=d.ord_color_size_id and e.order_id=c.id and a.order_id=e.order_id $str_po_cond_subcon
				group by c.id,b.company_id,b.party_id ,c.order_no ,b.subcon_job ,b.job_no_prefix_num ,b.insert_date,c.cust_style_ref ,e.item_id ,c.delivery_date";

	    $subcon_ex_sql="SELECT b.party_id ,sum(y.delivery_qty) as qtys FROM subcon_delivery_mst x,subcon_delivery_dtls y,subcon_ord_mst b, subcon_ord_dtls c WHERE x.id=y.mst_id and x.status_active=1   and c.job_no_mst=b.subcon_job and c.id=y.order_id $str_po_cond_subcon and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  GROUP BY b.party_id";
		foreach(sql_select($subcon_ex_sql) as $rows)
		{
			$party_arr_ex[$rows[csf("party_id")]]+=$rows[csf("qtys")];
			//$party_arr_ex_ground["ex"]+=$rows[csf("qtys")];
		}

		$subcon_ex_date="SELECT y.order_id,max(x.delivery_date) as delivery_date ,sum(y.delivery_qty) as qtys FROM subcon_delivery_mst x,subcon_delivery_dtls y,subcon_ord_mst b,  subcon_ord_dtls c WHERE x.id=y.mst_id and x.status_active=1   and c.id=y.order_id $str_po_cond_subcon and c.status_active=1 and c.is_deleted=0    and c.job_no_mst=b.subcon_job  GROUP BY y.order_id";
		foreach(sql_select($subcon_ex_date) as $rows)
		{
			$subcon_ex_date_arr[$rows[csf("order_id")]]["qtys"]=$rows[csf("qtys")];
			$subcon_ex_date_arr[$rows[csf("order_id")]]["date"]=$rows[csf("delivery_date")];
 		}

		//print_r($party_arr_ex);die;
		foreach(sql_select($subcon_sql) as $vals)
		{
			$party_arr[$vals[csf("buyer_name")]]["po_quantity"]+=$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"];
			$party_arr[$vals[csf("buyer_name")]]["cutting_qnty"]+=$vals[csf("cutting_qnty")];
			$party_arr[$vals[csf("buyer_name")]]["sewing_out"]+=$vals[csf("sewing_out")];
			$party_arr[$vals[csf("buyer_name")]]["iron_qnty"]+=$vals[csf("iron_qnty")];
			$party_arr[$vals[csf("buyer_name")]]["poly_qnty"]+=$vals[csf("poly_qnty")];
			$party_arr[$vals[csf("buyer_name")]]["finishing_qnty"]+=$vals[csf("finishing_qnty")];
			$party_ground_total["po_quantity"]+=$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"];
			$party_ground_total["cutting_qnty"]+=$vals[csf("cutting_qnty")];
			$party_ground_total["sewing_out"]+=$vals[csf("sewing_out")];
			$party_ground_total["iron_qnty"]+=$vals[csf("iron_qnty")];
			$party_ground_total["poly_qnty"]+=$vals[csf("poly_qnty")];
			$party_ground_total["finishing_qnty"]+=$vals[csf("finishing_qnty")];
			$party_arr_ex_ground["ex"]+=$party_arr_ex[$vals[csf("buyer_name")]];
		}

		$subcon_buyer_html="";
		$subcon_html="";
		if(count($party_arr)>0)
		{
			$subcon_buyer_html.='<tr> <th align="left" colspan="25"> Sub-Contract Production </th> </tr>';
			$i=1;
			foreach($party_arr as $buyer_id=>$value)
			{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

				$subcon_buyer_html.='
				<tr bgcolor="'.$bgcolor.'"  onClick="change_color(\'tr22_'.$i."'".', '."'".$bgcolor."'".')" id="tr_'.$i.'"  >
					<td>'.$i.'</td>

					<td>'.$buyer_short_library[$buyer_id].'</td>
					<td align="right">'.number_format($value["po_quantity"]).'</td>
					<td align="right">'. number_format($value["lay_qnty"]).'</td>
					<td align="right">'. number_format($value["cutting_qnty"]).'</td>
					<td align="right">'. number_format($value["print"]).'</td>
					<td align="right">'. number_format($value["print_rec"]).'</td>
					<td align="right">'. number_format($value["emb"]).'</td>
					<td align="right">'. number_format($value["emb_rec"]).'</td>
					<td align="right">'. number_format($value["emb_rec"]).'</td>
					<td align="right">'.  number_format($value["wash"]).'</td>
					<td align="right">'.  number_format($value["wash_rec"]).'</td>
					<td align="right">'.  number_format($value["spwork"]).'</td>
					<td align="right">'.  number_format($value["spwork_rec"]).'</td>
					<td align="right">'. number_format($value["sQty"]).'</td>
					<td align="right">'. number_format($value["soQty"]).'</td>
					<td align="right">'. number_format($value["sewing_out"]).'</td>
					<td align="right">'. number_format($value["sQty"]).'</td>
					<td align="right">'.  number_format($value["sewing_out"]).'</td>
					<td align="right">'.  number_format($value["soQty"]+$value["iron_qnty"]).'</td>

					<td align="right">'. number_format($value["poly_qnty"]).'</td>
                    <td align="right">'.  number_format( ($value["poly_qnty"]*100)/$value["po_quantity"],2 ).'</td>

					<td align="right">'.  number_format($value["finishing_qnty"],2).'</td>
					<td align="right">'.  number_format( ($value["finishing_qnty"]*100)/$value["po_quantity"] ,2).'</td>

					<td align="right">'. number_format($party_arr_ex[$buyer_id],2).'</td>
					<td  align="right">'.  number_format( ($party_arr_ex[$buyer_id]*100)/$value["po_quantity"] ,2).'</td>

				</tr>';
				$i++;
			}
		}
		$sql_cutlay="SELECT a.job_no,a.entry_form,b.order_id as po_id,b.gmt_item_id as gmts,c.order_id,sum(c.size_qty ) as qty,b.color_id  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,GBL_TEMP_ENGINE d  where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id =d.ref_val and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name and d.entry_form=21 and d.ref_from=6 and d.user_id=$user_id group by a.entry_form,b.order_id,b.gmt_item_id,c.order_id,b.color_id,a.job_no";
		// echo $sql_cutlay;die;
		$sql_res=sql_select($sql_cutlay);
		$cutQntyArr=array();
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			if($entry_form!=76)
			{
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]]+=$vals[csf("qty")];

			}
			else
			{
				$cut_lay_arrs[$vals[csf("po_id")]][$vals[csf("gmts")]]+=$vals[csf("qty")];

			}
			$cutQntyArr[$vals[csf("job_no")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
		}
		// print_r($cut_lay_arrs)	; die;
		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['cQty']+=$gmtsRow[csf('cutting_qnty')];//+$gmtsRow[csf('replace_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['pQty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['washiss']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['prQty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['washrec']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['special']+=$gmtsRow[csf('specialr')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['spc_qty']+=$gmtsRow[csf('issue_spc_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['issue_wash']+=$gmtsRow[csf('issue_wash_qty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['sQty']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['soQty']+=$gmtsRow[csf('sewingout_qnty_in')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['subcon_sewingin']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['subcon_sewingout']+=$gmtsRow[csf('sewingout_qnty_out')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['all_sewingout']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['iQty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['riQty']+=$gmtsRow[csf('re_iron_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['crQty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['sorQty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['frQty']+=$gmtsRow[csf('finish_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyRej']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['rej_qnty']+=$gmtsRow[csf('rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyInQty']+=$gmtsRow[csf('poly_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyOutQty']+=$gmtsRow[csf('poly_outbound')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyQty']+=$gmtsRow[csf('poly_qty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['trans_in_qty']+=$gmtsRow[csf('trans_in_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];
		}
		// echo "<pre>";print_r($gmts_prod_arr);die;
		unset($res_gmtsData);

		/*$po_transfer_in_sql=sql_select("select to_po_id,production_quantity,color_number_id from pro_gmts_delivery_dtls where status_active=1 and is_deleted=0");
		foreach($po_transfer_in_sql as $vals)
		{
			$po_transfer_in_arr[$vals[csf("to_po_id")]][$vals[csf("color_number_id")]]+=$vals[csf("production_quantity")];
		}

		$po_transfer_out_sql=sql_select("select from_po_id,production_quantity,color_number_id from pro_gmts_delivery_dtls where status_active=1 and is_deleted=0");
		foreach($po_transfer_out_sql as $vals)
		{
			$po_transfer_out_arr[$vals[csf("from_po_id")]][$vals[csf("color_number_id")]]+=$vals[csf("production_quantity")];
		}
		//echo "<pre>";print_r($po_transfer_in_arr);echo "</pre>";
		//echo "<pre>";print_r($po_transfer_out_arr);echo "</pre>";die;
		unset($po_transfer_in_sql);
		unset($po_transfer_out_sql);*/



		$fromDate = change_date_format( str_replace("'","",trim($txt_date_from)) );
		$toDate = change_date_format( str_replace("'","",trim($txt_date_to)) );
		$buyer_array=array();
		$result=sql_select($order_sql);
		$data_arr = array();
		$check_order = array();
		foreach ($result as $key => $val)
		{
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['job_num'] = $val[csf('job_no_prefix_num')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['style_ref_no'] = $val[csf('style_ref_no')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['grouping'] = $val[csf('grouping')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['buyer_name'] = $val[csf('buyer_name')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['style_qty'] += $val[csf('order_quantity')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['plan_cut'] += $val[csf('plan_cut_qnty')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['excess_cut'] += $val[csf('excess_cut')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['shiping_status'] = $val[csf('shiping_status')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['company_name'] = $val[csf('company_name')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['item_number_id'] = $val[csf('item_number_id')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['id'] = $val[csf('id')];
			// echo $val[csf('id')];
			if($check_order[$val[csf('job_no')]][$val[csf('color_number_id')]][$val[csf('id')]] != $val[csf('id')])
			{
				$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['order_no'] .= $val[csf('po_number')].",";
				$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['po_no'] .= $val[csf('id')].",";
				$check_order[$val[csf('job_no')]][$val[csf('color_number_id')]][$val[csf('id')]] = $val[csf('id')];
			}
		}
		// unset($check_order);
		// print_r($check_order);
		// echo "<pre>";
		// print_r($data_arr);

		$i=0; $k=0;
		$days_in_hand="";
		foreach($data_arr as $job_no=>$job_data)
		{
			foreach ($job_data as $color_id => $orderRes)
			{
		  	 	$i++;
		   		if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

		   			$po_quantity_in_pcs=$orderRes["style_qty"];

					$ex_factory_date=$ex_factory_arr[$job_no][$color_id]['date'];
					$ex_factory_qnty=$ex_factory_arr[$job_no][$color_id]['qty'];
					$ex_factory_carton_qnty=$ex_factory_arr[$job_no][$color_id]['ex_fac_carton_qty'];

					$cutting_qnty=$gmts_prod_arr[$job_no][$color_id]['cQty'];
					$embl_recv_qnty=$gmts_prod_arr[$job_no][$color_id]['prQty'];
					$sewingin_qnty=$gmts_prod_arr[$job_no][$color_id]['sQty'];
					$sewingout_qnty=$gmts_prod_arr[$job_no][$color_id]['soQty'];
					$sewingin_subcon=$gmts_prod_arr[$job_no][$color_id]['subcon_sewingin'];
					$sewingout_subcon=$gmts_prod_arr[$job_no][$color_id]['subcon_sewingout'];
					$iron_qnty=$gmts_prod_arr[$job_no][$color_id]['iQty'];
					$re_iron_qnty=$gmts_prod_arr[$job_no][$color_id]['riQty'];
					$polyInQnty=$gmts_prod_arr[$job_no][$color_id]['polyInQty'];
					$polyOutQnty=$gmts_prod_arr[$job_no][$color_id]['polyOutQty'];
					$poly_qnty=$gmts_prod_arr[$job_no][$color_id]['polyQty'];
					$finish_qnty_inhouse=$gmts_prod_arr[$job_no][$color_id]['finish_qnty_inhouse'];
					$finish_qnty_outbound=$gmts_prod_arr[$job_no][$color_id]['finish_qnty_outbound'];

					$trans_in_qty=$gmts_prod_arr[$job_no][$color_id]['trans_in_qty'];
					$trans_out_qty=$gmts_prod_arr[$job_no][$color_id]['trans_out_qty'];

					$cartonInQnty=$carton_arr[$job_no][$color_id]['carton_qty_no_inhouse'];
					$cartonOutQnty=$carton_arr[$job_no][$color_id]['carton_qty_no_outbound'];
					$cartonTotal_qnty=$carton_arr[$job_no][$color_id]['carton_total_qty'];

					$finish_qnty_transferIn=$po_transfer_in_arr[$job_no][$color_id];
					$finish_qnty_transferOut=$po_transfer_out_arr[$job_no][$color_id];

					$print_issue_inhouse=$gmts_prod_arr[$job_no][$color_id]['print_issue_inhouse'];
					$print_issue_subcon=$gmts_prod_arr[$job_no][$color_id]['print_issue_subcon'];
					$print_rcv_inhouse=$gmts_prod_arr[$job_no][$color_id]['print_rcv_inhouse'];
					$print_rcv_subcon=$gmts_prod_arr[$job_no][$color_id]['print_rcv_subcon'];

					$emb_issue_inhouse=$gmts_prod_arr[$job_no][$color_id]['emb_issue_inhouse'];
					$emb_issue_subcon=$gmts_prod_arr[$job_no][$color_id]['emb_issue_subcon'];
					$emb_rcv_inhouse=$gmts_prod_arr[$job_no][$color_id]['emb_rcv_inhouse'];
					$emb_rcv_subcon=$gmts_prod_arr[$job_no][$color_id]['emb_rcv_subcon'];

					$print_issue=$gmts_prod_arr[$job_no][$color_id]['print'];
					$cut_lays=$cutQntyArr[$job_no][$color_id] ;
					$embl_issue=$gmts_prod_arr[$job_no][$color_id]['emb'];
					$wash_issue=$gmts_prod_arr[$job_no][$color_id]['washiss'];
					$spwork_issue=$gmts_prod_arr[$job_no][$color_id]['special'];

					$spc_qty_issue=$gmts_prod_arr[$job_no][$color_id]['spc_qty'];
					$wash_qty_issue=$gmts_prod_arr[$job_no][$color_id]['issue_wash'];

					$print_rec=$gmts_prod_arr[$job_no][$color_id]['print'];
					$emb_rec=$gmts_prod_arr[$job_no][$color_id]['emb'];
					$wash_rec=$gmts_prod_arr[$job_no][$color_id]['washrec'];
					$spcial_rec=$gmts_prod_arr[$job_no][$color_id]['special'];
					$buyer_array[$orderRes["buyer_name"]]['print']+=$print_issue;
 					$buyer_array[$orderRes["buyer_name"]]['cut_lays']+=$cut_lays;
					$buyer_array[$orderRes["buyer_name"]]['emb']+=$embl_issue;
					$buyer_array[$orderRes["buyer_name"]]['wash']+=$wash_issue;
					$buyer_array[$orderRes["buyer_name"]]['spwork']+=$spwork_issue;
					$buyer_array[$orderRes["buyer_name"]]['print_rec']+=$print_rec;
					$buyer_array[$orderRes["buyer_name"]]['emb_rec']+=$emb_rec;
					$buyer_array[$orderRes["buyer_name"]]['wash_rec']+=$wash_rec;
					$buyer_array[$orderRes["buyer_name"]]['spwork_rec']+=$spcial_rec;
					$buyer_array[$orderRes["buyer_name"]]['poQty']+=$po_quantity_in_pcs;
					$buyer_array[$orderRes["buyer_name"]]['poVal']+=$po_quantity_in_pcs*$unit_price;
					$buyer_array[$orderRes["buyer_name"]]['ex']+=$ex_factory_qnty;
					$buyer_array[$orderRes["buyer_name"]]['cQty']+=$cutting_qnty;
					$buyer_array[$orderRes["buyer_name"]]['prQty']+=$embl_recv_qnty;
					$buyer_array[$orderRes["buyer_name"]]['sQty']+=$sewingin_qnty;
					$buyer_array[$orderRes["buyer_name"]]['soQty']+=$sewingout_qnty;
					$buyer_array[$orderRes["buyer_name"]]['subcon_sewing']+=$sewingin_subcon;
					$buyer_array[$orderRes["buyer_name"]]['subcon_sewout']+=$sewingout_subcon;
					$buyer_array[$orderRes["buyer_name"]]['iQty']+=$iron_qnty;
					$buyer_array[$orderRes["buyer_name"]]['reiQty']+=$re_iron_qnty;
					$buyer_array[$orderRes["buyer_name"]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
					$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
					$actual_exces_cut = $gmts_prod_arr[$job_no][$color_id]['cQty'];
					$buyer_array[$orderRes["buyer_name"]]['polyQty']+=$poly_qnty;
					if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

					$plan_cut_qnty=$orderRes["plan_cut"];
					$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
					$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);

					//$rej_value=$proRes["finish_rej_qnty")]+$proRes["sewingout_rej_qnty")];
					$rej_value=$gmts_prod_arr[$job_no][$color_id]['rej_qnty'];
					$cut_rej_value=$gmts_prod_arr[$job_no][$color_id]['crQty'];
					//$gmts_prod_arr[$orderRes["id")]][$item_id]['crQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['sorQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['frQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['polyRej'];
					$shortage = 0; $excess = 0; $balance = 0;
					if($orderRes["shiping_status"]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
					{
						$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

						if($shortage<0)
						{
							//$shortage = "".ltrim($shortage,"-")."";
						}
					}
					else
					{
						//$shortage="(".ltrim($shortage,"-").")";
						//$shortage = "-";
					}

					if($orderRes["shiping_status"]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
					{
						$excess = $ex_factory_qnty-$po_quantity_in_pcs;
					}
					else
					{
						$excess = 0;
					}

					$balance = $ex_factory_qnty-$po_quantity_in_pcs;


					$poly_status = $poly_qnty*100/$po_quantity_in_pcs;
					$finish_status = ($total_finish_qnty*100)/$po_quantity_in_pcs;
					if($j==0)
					{
						$display_font_color="";
						$font_end="";
					}
					else
					{
						$display_font_color="&nbsp;<font style='display:none'>";
						$font_end="</font>";
					}

					$company_name=$orderRes["company_name"];
					$po_id=$job_no;
					if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);
					if($orderRes["shiping_status"]==3) $days_remian=$days_remian; else $days_remian="---";
					if(round($actual_exces_cut) > round($orderRes["excess_cut"])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
					$total_rej_value+=$rej_value;
					$template_id=$template_id_arr[$orderRes['id']];
					$cutlay=$cutQntyArr[$job_no][$color_id] ;
				   	$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$i','$bgcolor') id=tr_2nd$i>";
					$html.='<td>'.$display_font_color.$i.$font_end.'</td>

						<td>'.$display_font_color.$orderRes["style_ref_no"].$font_end.'</td>

						<td>'.$display_font_color.$buyer_short_library[$orderRes["buyer_name"]].$font_end.'</td>

						<td><p>'.$display_font_color.$job_no.$font_end.'</p></td>

						<td><p>'.$display_font_color.$orderRes["grouping"].$font_end.'</p></td>

						<td><a href="##" onclick="job_progress_comment_popup('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."','".$template_id."',".$tna_process_type.')">'.$display_font_color.chop($orderRes["order_no"],",").$font_end.'</a></td>

						<td><p>'.$display_font_color.$color_Arr_library[$color_id].$font_end.'</p></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_order('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'JobColorOrderPopup'".')">'.$display_font_color.$orderRes["style_qty"].$font_end.'</a></td>

						<td align="right"><p>'.$display_font_color.$orderRes["plan_cut"].$font_end.'</p></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'17','1','JobColorProdPopup'".')">'.$display_font_color.$cutlay.$font_end.'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'1','1','JobColorProdPopup'".')">'.$display_font_color.$cutting_qnty.$font_end.'</a></td>

						<td align="right"><p>'.$short_excess_cut_qnty.'</p></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','1*1','JobColorProdPopup'".')">'.number_format($print_issue_inhouse,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','3*1','JobColorProdPopup'".')">'.number_format($print_issue_subcon,0).'&nbsp;</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','1*1','JobColorProdPopup'".')">'.number_format($print_rcv_inhouse,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','3*1','JobColorProdPopup'".')">'.number_format($print_rcv_subcon,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','1*2','JobColorProdPopup'".')">'.number_format($emb_issue_inhouse,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','3*2','JobColorProdPopup'".')">'.number_format($emb_issue_subcon,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','1*2','JobColorProdPopup'".')">'.number_format($emb_rcv_inhouse,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','3*2','JobColorProdPopup'".')">'.number_format($emb_rcv_subcon,0).'</a></td>

						<td align="right"><p>'.number_format($spc_qty_issue,0).'</p></td>
						<td align="right"><p>'.number_format($spcial_rec,0).'</p></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'4','1','JobColorProdPopup'".')">'.number_format($sewingin_qnty,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'5','1','JobColorProdPopup'".')">'.number_format($sewingout_qnty,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'4','3','JobColorProdPopup'".')">'.number_format($sewingin_subcon,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'5','3','JobColorProdPopup'".')">'.number_format($sewingout_subcon,0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'4','','JobColorProdPopup'".')">'.number_format(($sewingin_subcon+$sewingin_qnty),0).'</a></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'5','','JobColorProdPopup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</a></td>

						<td align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','3','JobColorProdPopup'".')">'.number_format($wash_qty_issue,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','3','JobColorProdPopup'".')">'.number_format($wash_rec,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'11','1','JobColorProdPopup'".')">'.number_format($polyInQnty,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'11','3','JobColorProdPopup'".')">'.number_format($polyOutQnty,0).'</a></p></td>

						<td align="right">'.$poly_qnty.'</td>

						<td align="right">'.number_format($poly_status,2)." %".'</td>

						<td align="right"><p>'.number_format($finish_qnty_inhouse,0).'<br/>'.'Ctn: '.$cartonInQnty.'</p></td>

						<td align="right"><p>'.number_format($finish_qnty_outbound,0).'<br/>'.'Ctn: '.$cartonOutQnty.'</p></td>

						<td align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'8','','JobColorProdPopup'".')">'.number_format($total_finish_qnty,0).'</a></td>

						<td align="right"><p>'.number_format($finish_status,2)." %".'</p></td>

						<td align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'$type','','JobColorProdPopup'".')">'.number_format($rej_value,0).'</a></p></td>

						<td align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'10','1','JobColorProdPopup'".')">'.number_format($ex_factory_qnty,0).'</a></p></td>

						<td align="right"><p>'.$shortage.'</p></td>
						<td align="right"><p>'.$excess.'</p></td>
						<td align="right"><p>'.$balance.'</p></td>

						<td>&nbsp;'.$shipment_status[$orderRes["shiping_status"]].'</td>

						<td>&nbsp;<a href="##" onclick="openmypage_job_color_remark('.$orderRes['job_num'].",'".$job_no."','".chop($orderRes['po_no'],',')."','".$color_id."','job_color_wise_remarks'".')">Remarks</a></td>
					</tr>';

			}
		}
		//=================================== Delete Order Id From TEMP ENGINE ====================================
		execute_query("DELETE from gbl_temp_engine where user_id=$user_id and entry_form = 21 and ref_from=6");
		oci_commit($con);
		disconnect($con);

		$report_data='<div>
			<table >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >Order Wise RMG Production Status</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						Company Name : '.$company_library[str_replace("'","",$cbo_company_name)].'
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">';

							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								$report_data.= "From $fromDate To $toDate" ;
							}

						$report_data.='</td>
				</tr>
			</table>
            <div>This Report is Generated based on Published Ship Date.</div>
			<div>
				<table border="1">
					<thead>
						 <tr>
							<th rowspan="2">Sl.</th>
							<th rowspan="2">Buyer Name</th>
							<th rowspan="2">Order Qty.(Pcs)</th>
							<th rowspan="2">Lay Qty.</th>
							<th rowspan="2"> Cutting QC Qty</th>
							<th rowspan="2">Sent to Print</th>
							<th rowspan="2">Rcv Print</th>
							<th rowspan="2">Sent to Emb</th>
							<th rowspan="2" >Rcv Emb</th>
							<th rowspan="2">Sent to Wash</th>
							<th rowspan="2">Rcv Wash</th>
							<th rowspan="2" >Sent to Sp. Works</th>
							<th rowspan="2">Rcv Sp. Works</th>
							<th colspan="2">InHouse</th>
							<th colspan="2">Sub-Contact</th>
							<th rowspan="2">Total Sewing Input Qty</th>
							<th rowspan="2">Total Sewing Output Qty</th>
							<th rowspan="2">Total Iron Qty</th>
                            <th rowspan="2">Total Poly Qty</th>
							<th rowspan="2">Poly Comp %</th>
							<th rowspan="2">Total Finish Qty</th>
							<th rowspan="2" >Fin Comp %</th>
							<th rowspan="2">Ex-Fac</th>
							<th rowspan="2" >Ex-Fac%</th>
						 </tr>
						<tr>
							<th >Sew Input.</th>
							<th >Sew OutPut </th>
							<th >Sew Input.</th>
							<th >Sew OutPut </th>
						 </tr>
					</thead>
				</table>
				<div>
					<table>';

						$i=1; $total_po_quantity=0;$total_po_value=0; $total_cut=0; $total_print_iss=0;$total_lay=0;
						$total_print_re=0; $total_sew_input=0; $total_sew_out=0; $total_iron=0; $total_re_iron=0; $total_finish=0;$total_ex_factory=0;
						foreach($buyer_array as $buyer_id=>$value)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";


							$report_data.='<tr bgcolor="'.$bgcolor.'">
								<td>'.$i.'</td>
								<td>'.$buyer_short_library[$buyer_id].'</td>
								<td align="right">'.number_format($value["poQty"]).'</td>

								<td align="right">'.number_format($value["cut_lays"]) .'</td>
								<td align="right">'.number_format($value["cQty"]).'</td>

								<td align="right">'.number_format($value["print"]).'</td>
								<td align="right">'.number_format($value["print_rec"]).'</td>
								<td align="right">'.number_format($value["emb"]).'</td>
								<td align="right">'.number_format($value["emb_rec"]).'</td>
								<td align="right">'.number_format($value["wash"]).'</td>
								<td align="right">'.number_format($value["wash_rec"]).'</td>
								<td align="right">'.number_format($value["spwork"]).'</td>
								<td align="right">'.number_format($value["spwork_rec"]).'</td>
								<td align="right">'.number_format($value["sQty"]).'</td>
								<td align="right">'.number_format($value["soQty"]).'</td>
								<td align="right">'.number_format($value["subcon_sewing"]).'</td>
								<td align="right">'.number_format($value["subcon_sewout"]).'</td>
								<td align="right">'.number_format($value["sQty"]+$value["subcon_sewing"]).'</td>
								<td align="right">'.number_format($value["soQty"]+$value["subcon_sewout"]).'</td>

								<td align="right">'.number_format($value["iQty"]).'</td>
                                <td align="right">'.number_format($value["polyQty"]).'</td>';
							    $poly_gd_status = ($value["polyQty"]/$value["poQty"])*100;
								$report_data.='<td align="right">'.number_format($poly_gd_status,2).'</td>
								<td align="right">'.number_format($value["fQty"]).'</td>';
								$finish_gd_status = ($value["fQty"]/$value["poQty"])*100;
								$report_data.='<td align="right">'.number_format($finish_gd_status,2).'</td>
								<td align="right">'.number_format($value["ex"]).'</td>';
								$ex_gd_status = ($value["ex"]/$value["poQty"])*100;
								$report_data.='<td align="right">'. number_format($ex_gd_status,2).'</td>
							</tr>';

								$total_po_quantity+=$value["poQty"];
								$total_cut+=$value["cQty"];
								$total_lay+=$value["cut_lays"];
								$total_sent_print+=$value["print"];
								$total_print_re+=$value["print_rec"];
								$total_emb+=$value["emb"];
								$total_emb_re+=$value["emb_rec"];
								$total_wash+=$value["wash"];
								$total_wash_re+=$value["wash_rec"];
								$total_spwork+=$value["spwork"];
								$total_spwork_re+=$value["spwork_rec"];
								$total_sew_input+=$value["sQty"];
								$total_sew_out+=$value["soQty"];
								$total_subcon_sewing+=$value["subcon_sewing"];
								$total_subcon_sewout+=$value["subcon_sewout"];
								$total_iron+=$value["iQty"];
								$total_poly+=$value["polyQty"];
								$total_re_iron+=$value["reiQty"];
								$total_finish+=$value["fQty"];
								$total_ex_factory+=$value["ex"];
							$i++;
						}//end foreach 1st

						$chart_data_qnty="Order Qty;".$total_po_quantity."\n"."Cutting;".$total_cut."\n"."Sew In;".$total_sew_input."\n"."Sew Out ;".$total_sew_out."\n"."Iron ;".$total_iron."\n"."Finish ;".$total_finish."\n"."Ex-Fact;".$total_ex_factory."\n";
						$report_data.=$subcon_buyer_html;

					$report_data.='</table>
					<table border="1">
						<tr>
							<td>&nbsp;</td>
							<td align="right">Total</td>
							<td id="tot_po_quantity">'.number_format($total_po_quantity+$party_ground_total["po_quantity"]).'</td>
							<td id="tot_lay">'.number_format($total_lay).'</td>
							<td id="tot_cutting">'.number_format($total_cut+$party_ground_total["cutting_qnty"]).'</td>
							<td id="tot_emb_rcv">'.number_format($total_sent_print).'</td>
							<td id="tot_sew_in">'.number_format($total_print_re).'</td>
							<td id="tot_sew_out">'.number_format($total_emb).'</td>
							<td id="tot_iron">'.number_format($total_emb_re).'</td>
							<td id="tot_emb_rcv">'.number_format($total_wash).'</td>
							<td id="tot_sew_in">'.number_format($total_wash_re).'</td>
							<td id="tot_sew_out">'.number_format($total_spwork).'</td>
							<td id="tot_iron">'.number_format($total_spwork_re).'</td>
							<td id="tot_emb_rcv">'.number_format($total_sew_input).'</td>
							<td id="tot_sew_in">'.number_format($total_sew_out).'</td>
							<td id="tot_sew_out">'.number_format($total_subcon_sewing).'</td>
							<td id="tot_iron">'.number_format($total_subcon_sewout+$party_ground_total["sewing_out"]).'</td>
							<td id="tot_iron">'.number_format($total_sew_input+$total_subcon_sewing).'</td>
							<td id="tot_sew_out">'.number_format($total_subcon_sewout+$total_sew_out+$party_ground_total["sewing_out"]).'</td>
							<td id="tot_iron">'.number_format($total_iron+$party_ground_total["iron_qnty"]).'</td>
                            <td id="tot_poly">'.number_format($total_poly+$party_ground_total["poly_qnty"]).'</td>';

                            $total_poly_gd_status = ($total_poly/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_poly_gd_status,2).'</td >

							<td id="tot_finish">'.number_format($total_finish+$party_ground_total["finishing_qnty"]).'</td>';
							$total_finish_gd_status = ($total_finish/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_finish_gd_status,2).'</td >
							<td>'.number_format($total_ex_factory+$party_arr_ex_ground["ex"]).'</td >';
							$total_ex_status = ($total_ex_factory/$total_po_quantity)*100;
							$report_data.='<td>'.number_format($total_ex_status,2).'</td>
						</tr>

					 </table>
				</div>
			</div>
			<table border="1">
				<thead>
					<tr>
						<th rowspan="2">SL</th>
						<th rowspan="2">Style Name</th>
						<th rowspan="2">Buyer Name</th>
						<th rowspan="2">Job No</th>
						<th rowspan="2">IR/IB</th>
						<th rowspan="2">Order Number</th>
                        <th rowspan="2">Color Name</th>
                        <th rowspan="2">Order Qty.</th>
                        <th rowspan="2">Plan Cut Qty</th>
                        <th rowspan="2">Cut Qty</th>
                        <th rowspan="2">Cutting QC Qty</th>
                        <th rowspan="2">Short/Excess Cut Qty</th>

						<th colspan="2">Sent to Print</th>
						<th colspan="2">Rcv Print</th>
						<th colspan="2">Sent to Emb</th>
						<th colspan="2">Rcv Emb</th>

						<th rowspan="2" >Sent to Sp. Works</th>
						<th rowspan="2">Rcv Sp. Works</th>
						<th colspan="2">InHouse</th>
						<th colspan="2">Out-bound Sub-Contact</th>
						<th rowspan="2">Total Sewing Input Qty</th>
						<th rowspan="2">Total Sewing Output Qty</th>
						<th rowspan="2">Sent to Wash</th>
						<th rowspan="2">Rcv Wash</th>
                        <th colspan="3">Poly Qty</th>
                        <th rowspan="2">Poly Comp %</th>
						<th colspan="3">Finish Qty</th>
						<th rowspan="2">Fin Goods Status</th>

						<th rowspan="2">Reject Qty</th>
						<th rowspan="2">Total Ex-Factory</th>
						<th rowspan="2">Shortage Qty.</th>
						<th rowspan="2">Excess Qty.</th>
						<th rowspan="2">Balance Qty.</th>
						<th rowspan="2">Status</th>
						<th rowspan="2" >Remarks</th>
					 </tr>
					 <tr>
                        <th>Inhouse</th>
                        <th>SubCon</th>

                        <th>Inhouse</th>
                        <th>SubCon</th>

                        <th>Inhouse</th>
                        <th>SubCon</th>

                        <th>Inhouse</th>
                        <th>SubCon</th>

                        <th>Sew Input.</th>
                        <th>Sew OutPut </th>

                        <th>Sew Input.</th>
                        <th>Sew OutPut </th>

                        <th>In-house</th>
                        <th>Out-bound </th>
                        <th>Total</th>

                        <th>In-house</th>
                        <th>Out-bound </th>
                        <th>Total</th>
					</tr>
				</thead>
			</table>
			<div>
				<table border="1">';
				$report_data.=$html;$report_data.=$subcon_html;
				$report_data.='</table>
				<table border="1">
					<tr>
						<td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>Total</td>

                        <td  id="td_po_qty">&nbsp;</td>
						<td id="td_plan_cutting">&nbsp;</td>
						<td id="td_lay_cutting">&nbsp;</td>
						<td id="td_total_cut"></td>
						<td id="td_short_excess_cut"></td>

						<td id="td_print_issue_in">&nbsp;</td>
						<td id="td_print_issue_sub">&nbsp;</td>
						<td id="td_print_receive_in">&nbsp;</td>
						<td id="td_print_receive_sub"></td>
						<td id="td_embIss_id"></td>
						<td id="td_embIss_subcon"></td>
						<td id="td_embRec_in"></td>
						<td id="td_embRec_subcon"></td>
						<td id="total_sp_issue"></td>
						<td id="total_sp_receive">&nbsp;</td>

						<td id="total_sewing_input"></td>
						<td id="total_sewing_out"></td>
						<td id="total_sewing_input_sub"></td>
						<td id="total_sewing_out_sub"></td>

						<td id="total_sewing_in"></td>
						<td id="total_sewing_output"></td>
						<td id="td_wash_iss"></td>
						<td id="td_wash_rec"></td>

						<td id="total_poly_in"></td>
						<td id="total_poly_out"></td>

						<td id="total_poly"></td>
						<td id="total_poly_comp"></td>

						<td id="total_finish_in"></td>
						<td id="total_finish_sub"></td>

						<td id="total_finish"></td>
						<td id="total_finish_gd_status"></td>
						<td id="total_reject"></td>
						<td id="total_exfact"></td>
						<td><span id="total_excess"></span></td>
						<td id="td_excess">&nbsp;</td>
						<td><span id="td_balance"></span></td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
					</tr>
				</table>
			</div>
		 </div>';

	}

	// echo $report_data;die;
	foreach (glob("Order_wise_$user_id*.xlsx") as $filename)
	{
		@unlink($filename);
	}
	$name=time();
	$filename='Order_wise_'.$user_id."_".$name.".xlsx";

	$reader = new \PhpOffice\PhpSpreadsheet\Reader\Html();
	$spreadsheet = $reader->loadFromString($report_data);
	$writer = new \PhpOffice\PhpSpreadsheet\Writer\Xlsx($spreadsheet);
	$writer->save($filename);
	echo "$filename####$filename####$type";
	exit();
}

if($action=="report_generate")
{

	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	$cbo_company_name=str_replace("'","",$cbo_company_name);
	$cbo_buyer_name=str_replace("'","",$cbo_buyer_name);
	$cbo_season_id=str_replace("'","",$cbo_season_id);
	$cbo_location=str_replace("'","",$cbo_location);
	$cbo_floor=str_replace("'","",$cbo_floor);
	$txt_date_from=str_replace("'","",$txt_date_from);
	$txt_date_to=str_replace("'","",$txt_date_to);
	$cbo_job_year=str_replace("'","",$cbo_job_year);
	$txt_style_ref=str_replace("'","",$txt_style_ref);
	$txt_style_ref_id=str_replace("'","",$txt_style_ref_id);
	$txt_order_no=str_replace("'","",$txt_order);
	$txt_order_id=str_replace("'","",$txt_order_id);
	$shipping_status=str_replace("'","",$shipping_status);
	$orderStatus=str_replace("'","",$orderStatus);
	$txt_style_ref_number=str_replace("'","",$txt_style_ref_number);
	$cbo_style_owner_wise_status=str_replace("'","",$cbo_style_owner_wise_status);
	$active_status=str_replace("'", "", $active_status);
	$active_cond="";
	$active_cond_c="";
	$active_cond_a_d="";
	$active_cond_d="";
	$active_cond_b="";
	$active_cond_e_f="";
	$order_status_cond="";
	// 0 For Active Status -> Active
	// 1 For Active Status -> All
	if($active_status == 0) $active_cond 		= " and b.status_active=1 and c.status_active=1 ";
	if($active_status == 0) $active_cond_a_d 	= " and a.status_active=1 and d.status_active=1 ";
	if($active_status == 0) $active_cond_e_f 	= " and e.status_active=1 and f.status_active=1 ";
	if($active_status == 0) $active_cond_c 		= "  and c.status_active=1 ";
	if($active_status == 0) $active_cond_d 		= "  and d.status_active=1 ";
	if($active_status == 0) $active_cond_b 		= "  and b.status_active=1 ";
	if($orderStatus)  $order_status_cond 	= "  and b.is_confirmed=$orderStatus ";

	$txt_order_number=str_replace("'","",$txt_order);
	$txt_order_number=trim($txt_order_number);
	$txt_order_number = "'".implode("','", explode(",", $txt_order_number))."'";

	if($txt_order_id=="")
	{
		$txt_order_number_expl=explode(",",$txt_order_number);
		$poDatas="";
		foreach($txt_order_number_expl as $poData)
		{
			$poDatas.=$poData.",";
		}
		$poNumbers=chop($poDatas,",");

		if($txt_order_number!="")
		{
			$str_poNumbers_cond =" and b.po_number in($poNumbers)";
		}
		else
		{
			$str_poNumbers_cond = "";
		}
		//echo $str_poNumbers_cond;
		//echo $txt_order_number;
	}

	//$internal_ref_cond=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active=1 and is_deleted=0) ";
	$country_id=str_replace("'","",$country_id);//******/ come from capacity and order booking report  //******/
	//$template_id_arr=return_library_array("select po_number_id, template_id from tna_process_mst group by po_number_id, template_id","po_number_id","template_id");

	if($txt_date_from!="" && $txt_date_to!="")
	{
		if($db_type==0)
		{
			$txt_datefrom=change_date_format($txt_date_from,'yyyy-mm-dd');
			$txt_dateto=change_date_format($txt_date_to,'yyyy-mm-dd');
		}
		else if($db_type==2)
		{
			$txt_datefrom=change_date_format($txt_date_from,'','',-1);
			$txt_dateto=change_date_format($txt_date_to,'','',-1);
		}
	}
	//if($txt_style_ref_number=="") $txt_style_ref_number_cond=''; else $txt_style_ref_number_cond=" and a.style_ref_no like ".$txt_style_ref_number."";
	if ($txt_style_ref_number!="")
	{
		$txt_style_ref_number_cond="and a.style_ref_no like '%$txt_style_ref_number%'";
	}
	else
	{
		$txt_style_ref_number_cond="";
	}

	ob_start();

	if($type==1) // country wise
	{
		$country_library=return_library_array( "select id,country_name from lib_country", "id", "country_name"  );

		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}
		//if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";

		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_season_id!=0) $str_po_cond.=" and a.season_buyer_wise=$cbo_season_id";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and c.country_ship_date between '$txt_datefrom' and '$txt_dateto'";


		if($country_id>0) $str_po_cond.=" and c.country_id=$country_id";

		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";

		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";
		if($active_status==0) $active_cond 		= " and b.status_active=1 and c.status_active=1 ";

		$order_sql="SELECT a.id job_id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.id as po_id, b.po_number, b.excess_cut, b.is_confirmed,b.pack_handover_date, c.item_number_id as item_number_id, c.country_id, c.country_ship_date, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total ,max(c.shiping_status) as shiping_status,sum(c.plan_cut_qnty) as plan_cut_qnty
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.is_deleted=0 and c.is_deleted=0   $active_cond $str_po_cond $txt_style_ref_number_cond   $internal_ref_cond_po $order_status_cond
		group by a.id, a.job_no_prefix_num,a.job_no, a.insert_date, a.company_name, a.buyer_name, a.style_ref_no, b.id,b.po_number, b.excess_cut, b.is_confirmed,b.pack_handover_date, c.item_number_id, c.country_id, c.country_ship_date, c.color_number_id
		order by c.country_ship_date, b.id, c.item_number_id, c.country_id, c.color_number_id";// and b.status_active in(1,2,3)

		// echo $order_sql."<br>";


		$sql_po_result=sql_select($order_sql);
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("po_id")].",";
		}
		$all_po_id=implode(',',array_unique(explode(",",chop($all_po_id,","))));
		//echo count(explode(",",$all_po_id));die;
		$template_id_arr=return_library_array("select po_number_id, template_id from tna_process_mst where po_number_id in ('".$all_po_id."') group by po_number_id, template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and a.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(explode(",",$all_po_id),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (a.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or a.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}

			}
		}


		if($po_product_cond=="")
		{
			echo '<div style="color:#FF0000; font-size:14px; font-weight:bold; margin:0 auto; text-align:center; width:1930px">No Data Found.</div>'; die;
		}
		// ========================================== cut and lay data =================================
		$all_po_ids_cond = str_replace("a.po_break_down_id", "c.order_id", $po_product_cond);
		$sql_cutlay="SELECT a.entry_form,b.order_id as po_id,b.gmt_item_id as gmts,b.color_id,c.order_id,c.country_id,sum(c.size_qty ) as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name $all_po_ids_cond  group by a.entry_form,b.order_id,c.country_id,b.gmt_item_id,b.color_id,c.order_id";
		// echo $sql_cutlay;die();
		$sql_res=sql_select($sql_cutlay);
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			// if($entry_form!=76)
			// {
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("country_id")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
			/*}
			else
			{
				$cut_lay_arrs[$vals[csf("po_id")]][$vals[csf("gmts")]][$vals[csf("country_id")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
			}*/
		}
		// echo "<pre>";print_r($cut_lay_arrs);


		$color_id_arr=return_library_array( "select a.id,a.color_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 $po_product_cond", "id", "color_number_id");



		$entry_break_down_type_exf=return_field_value("ex_factory","variable_settings_production","company_name=$cbo_company_name and variable_list=1 and status_active=1","ex_factory");
		$ex_factory_arr=array();
		if($entry_break_down_type_exf !=1) // not gross level
		{
			$ex_factory_data=sql_select("SELECT a.po_break_down_id, a.item_number_id, a.country_id, MAX(a.ex_factory_date) AS ex_factory_date, b.color_size_break_down_id,
			sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as ex_factory_qnty ,a.total_carton_qnty
			 from pro_ex_factory_mst a, pro_ex_factory_dtls b
			 where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 $po_product_cond
			 group by a.po_break_down_id, a.item_number_id, a.country_id, b.color_size_break_down_id,a.total_carton_qnty");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		}
		else
		{
			$ex_factory_data=sql_select("SELECT a.po_break_down_id, a.item_number_id, a.country_id, MAX(a.ex_factory_date) AS ex_factory_date,
			sum(CASE WHEN a.entry_form!=85 THEN a.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN a.ex_factory_qnty ELSE 0 END) as ex_factory_qnty ,a.total_carton_qnty
			 from pro_ex_factory_mst a
			 where a.status_active=1 and a.is_deleted=0 $po_product_cond
			 group by a.po_break_down_id, a.item_number_id, a.country_id,a.total_carton_qnty");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		}
		// echo "<pre>";print_r($ex_factory_arr);die;

		unset($ex_factory_data);


		//if($txt_datefrom!="" && $txt_dateto!="") $str_cond_product.=" and e.country_ship_date between  '$txt_datefrom' and '$txt_dateto'";
		//if($country_id>0) $str_cond_product.=" and c.country_id=$country_id";


		if($db_type==0)
		{
			$prod_sql="SELECT a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN a.production_type ='2'  and b.production_type='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'   and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,


				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4'  and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type=5 THEN b.production_qnty ELSE 0 END),0) AS trans_in_qty,
				IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type=6 THEN b.production_qnty ELSE 0 END),0) AS trans_out_qty,


				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN a.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN a.production_type ='1' and b.production_type='1'  THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  THEN b.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c	where
				a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and a.country_id=c.country_id and a.item_number_id=c.item_number_id $active_cond_c $po_product_cond $internal_ref_cond_prod and b.status_active=1 and b.is_deleted=0 and c.status_active in(1,2,3) and c.is_deleted=0
			group by a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id";

			$sql_carton_qty=sql_select("select a.po_break_down_id,a.country_id,
			IFNULL(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a where a.status_active=1 and a.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by a.po_break_down_id,a.country_id");
		}
		else
		{
			$prod_sql= "SELECT a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type ='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,



				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type ='4' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type ='4' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=5 THEN b.production_qnty ELSE 0 END),0) AS trans_in_qty,
				NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=6 THEN b.production_qnty ELSE 0 END),0) AS trans_out_qty,

				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN a.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type ='1' THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type ='1' THEN b.replace_qty ELSE 0 END),0) AS cutting_replace_qty,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and b.is_rescan=0 THEN b.reject_qty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and b.is_rescan!=0 THEN b.production_qnty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' THEN b.replace_qty ELSE 0 END),0) AS sewingout_rej_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c
			where
				a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and a.country_id=c.country_id and a.item_number_id=c.item_number_id $active_cond_c $po_product_cond $internal_ref_cond_prod   and b.status_active=1 and b.is_deleted=0 and c.status_active in(1,2,3) and c.is_deleted=0
			group by a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id";

			$sql_carton_qty=sql_select("select a.po_break_down_id,a.country_id,
			NVL(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			NVL(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			NVL(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a where a.status_active=1 and a.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by a.po_break_down_id,a.country_id");
		}
		//echo $prod_sql;exit();
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		}

		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);

		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_qnty']+=$gmtsRow[csf('cutting_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printing_qnty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['wash']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printreceived_qnty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printr']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['embr']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['washr']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['specialr']+=$gmtsRow[csf('specialr')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_in']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_in']+=$gmtsRow[csf('sewingout_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_out']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			//$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_qnty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['re_iron_qnty']+=$gmtsRow[csf('re_iron_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];


			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_rej_qnty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_replace_qty']+=$gmtsRow[csf('cutting_replace_qty')];


			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rej_qnty']+=$gmtsRow[csf('emb_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_rej_qnty']+=$gmtsRow[csf('iron_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_rej_qnty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_rej_qnty']+=$gmtsRow[csf('finish_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_rej_qnty']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewing_input_rej_qnty']+=$gmtsRow[csf('sewing_input_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_rej_qnty']+=$gmtsRow[csf('emb_issue_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_in_qty']+=$gmtsRow[csf('trans_in_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];
		}




		$result=sql_select($order_sql);
		$i=0; $k=0; $date=date("Y-m-d");
		$days_in_hand="";
		foreach($result as $orderRes)
		{

		   $i++;
		   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

			$k++;

			$lay_qty = $cut_lay_arrs[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]];

			if($entry_break_down_type_exf !=1) // not gross level
			{
				$ex_factory_date=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['date'];
				$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['qty'];
				$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['ex_fac_carton_qty'];
			}
			else
			{
				$ex_factory_date=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]]['date'];
				$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]]['qty'];
				$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]]['ex_fac_carton_qty'];
			}




			$color=""; $days_remian="";
			$days_remian=datediff("d",$date,$orderRes[csf("country_ship_date")]);
			$days_in_hand=datediff("d",$date,$orderRes[csf("country_ship_date")]);
			if($orderRes[csf("country_ship_date")] > $date)
			{
				$color="";
			}
			else if($orderRes[csf("country_ship_date")] < $date)
			{
				$color="red";
			}
			else if($orderRes[csf("country_ship_date")] >= $date && $days_remian<=5 )
			{
				$color="orange";
			}
			//end if condition
			//if($days_in_hand<0) $days_in_hand=abs($days_in_hand)." Days Pass";
			//print_r($gmts_prod_arr[$orderRes[csf("id")]]);



			$cutting_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['cutting_qnty'];
			$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['printreceived_qnty'];
			$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_in'];
			$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_in'];
			$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_out'];
			$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_out'];
			$iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['iron_qnty'];
			$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['re_iron_qnty'];
			//$finish_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_qnty'];
			$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_inhouse'];
			$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_outbound'];

			$print_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print'];
			$embl_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb'];
			$wash_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['wash'];
			$spwork_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['special'];
			$print_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['printr'];
			$emb_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['embr'];
			$wash_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['washr'];
			$spcial_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['specialr'];


			$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_issue_inhouse'];
			$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_issue_subcon'];
			$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_rcv_inhouse'];
			$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_rcv_subcon'];

			$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_inhouse'];
			$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_subcon'];
			$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_inhouse'];
			$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_subcon'];



			$cutting_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['cutting_rej_qnty'];
			$emb_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rej_qnty'];
			$iron_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['iron_rej_qnty'];
			$sewing_out_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_rej_qnty'];

			$cutting_replace_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['cutting_replace_qty'];

			$finish_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_rej_qnty'];

			$poly_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['poly_rej_qnty'];

			$sewing_input_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewing_input_rej_qnty'];

			$emb_issue_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_rej_qnty'];

			$trans_in_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['trans_in_qty'];
			$trans_out_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['trans_out_qty'];

			$cartonInQnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_qty_no_inhouse'];
			$cartonOutQnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_qty_no_outbound'];
			$cartonTotal_qnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_total_qty'];

			$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$orderRes[csf("order_quantity")];
			$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$orderRes[csf("order_total")];
			$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
			$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;


			$po_quantity_in_pcs=$orderRes[csf("order_quantity")];
			$plan_cut_qnty=$orderRes[csf("plan_cut_qnty")];
			//$actual_exces_cut = $cutting_qnty;
			$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
			$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);
			$excess_cut_percent=$short_excess_cut_percent-$orderRes[csf("excess_cut")];

			//if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

			$embl_recv_qty=$print_rec+$emb_rec+$wash_rec+$spcial_rec;

			$rej_value=$cutting_reject+$emb_reject+$iron_reject+$sewing_input_rej_qnty+$finish_reject+$poly_rej_qnty+$emb_issue_rej_qnty;

			$sewing_rej_value=$sewing_out_reject;

			$finish_status = $finish_qnty*100/$po_quantity_in_pcs;

			$company_name=$orderRes[csf("company_name")];
			$po_id=$orderRes[csf("po_id")];
			$item_id=$orderRes[csf("item_number_id")];
			if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);

			if(($orderRes[csf("pack_handover_date")]=="" || $orderRes[csf("pack_handover_date")]=="0000-00-00")) $pack_handover_date="&nbsp;"; else $pack_handover_date=change_date_format($orderRes[csf("pack_handover_date")]);

			//if($orderRes[csf("shiping_status")]==3) $days_remian=$days_remian; else $days_remian="---";
			//if(round($actual_exces_cut) > round($orderRes[csf("excess_cut")])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
			$total_rej_value+=$rej_value;

			$total_rej_value+=$sewing_rej_value;

			$template_id=$template_id_arr[$orderRes[csf("po_id")]];
			/// for order popup define leter
			//

			$shortage = 0; $excess = 0; $balance = 0;
			if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
			{
				$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

				if($shortage<0)
				{
					//$shortage = "".ltrim($shortage,"-")."";
				}
			}
			else
			{
				//$shortage="(".ltrim($shortage,"-").")";
				//$shortage = "-";
			}

			if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
			{
				$excess = $ex_factory_qnty-$po_quantity_in_pcs;
			}
			else
			{
				$excess = 0;
			}

			$balance = $ex_factory_qnty-$po_quantity_in_pcs;

			$total_cut_qty = $cutting_replace_qty + $lay_qty;
			$gt_po_qty	+=$po_quantity_in_pcs;
				$gt_plan_cut_qty += $plan_cut_qnty;
				$gt_cut_lay_qty += $lay_qty;
				$gt_cutting_replace_qty += $cutting_replace_qty;
				$gt_total_cut_qty	+= $total_cut_qty;
				$gt_cutting_qc_qty += $cutting_qnty;
				$gt_short_excess_cut_qnty += $short_excess_cut_qnty;
				$gt_print_issue_inhouse   += $print_issue_inhouse;
				$gt_print_issue_subcon       += $print_issue_subcon;
				$gt_print_rcv_inhouse	 += $print_rcv_inhouse;
				$gt_print_rcv_subcon	 += $print_rcv_subcon;
				$gt_emb_issue_inhouse    += $emb_issue_inhouse;
				$gt_emb_issue_subcon       += $emb_issue_subcon;
				$gt_emb_rcv_inhouse       += $emb_rcv_inhouse;
				$gt_emb_rcv_subcon        += $emb_rcv_subcon;
				$gt_spc_qty_issue         += $spwork_issue;
				$gt_spcial_rec			  += $spcial_rec;
				$gt_sewingin_qnty += $sewingin_qnty ;
				$gt_sewingout_qnty += $sewingout_qnty;
				$gt_sewingin_subcon += $sewingin_subcon;
				$gt_sewingout_subcon += $sewingout_subcon;
				$gt_ttl_sewingin_qnty += ($sewingin_qnty+$sewingin_subcon);
				$gt_ttl_sewingout_qnty += ($sewingout_qnty+$sewingout_subcon);
				$gt_wash_qty_issue		+= $wash_issue;
				$gt_wash_rec			+= $wash_rec;
				$gt_iron_qnty			+= $iron_qnty;
				$gt_re_iron_qnty			+= $re_iron_qnty;
				$gt_finish_qnty_inhouse     += $finish_qnty_inhouse;
				$gt_finish_qnty_outbound	+= $finish_qnty_outbound;
				$gt_finish_qnty_transferIn  += $trans_in_qty;
				$gt_finish_qnty_transferOut	+= $trans_out_qty;
				$gt_total_finish_qnty	+= $total_finish_qnty;
				$gt_rej_value			+= $rej_value;
				$gt_sewing_rej_value		+= $sewing_rej_value;
				$gt_ex_factory_qnty			+=	$ex_factory_qnty;
				$gt_shortage				+=	$shortage;
				$gt_excess					+= $excess;
				$gt_balance					+= $balance;
				$gt_cartonInQnty			+= $cartonInQnty;
				$gt_cartonOutQnty			+= $cartonOutQnty;
				$gt_cartonTotal_qnty		+= $cartonTotal_qnty ;
				$gt_ex_factory_carton_qnty		+= $ex_factory_carton_qnty;

			$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$k','$bgcolor') id=tr_2nd$k>";
			$html.='<td width="30"><p>'.$display_font_color.$i.$font_end.'</p></td>
					<td width="130"><p><a href="##" onclick="progress_comment_popup('.$orderRes[csf("po_id")].",'".$template_id."',".$tna_process_type.')">'.$display_font_color.$orderRes[csf("po_number")].$font_end.'</a></p></td>
					<td width="80"><p>'.$display_font_color.$order_status[$orderRes[csf("is_confirmed")]].$font_end.'</p></td>
					<td width="60"><p>'.$display_font_color.$buyer_short_library[$orderRes[csf("buyer_name")]].$font_end.'</p></td>
					<td width="50" align="center"><p>'.$display_font_color.$orderRes[csf("job_year")].$font_end.'</p></td>
					<td width="100" align="center"><p>'.$display_font_color.$orderRes[csf("job_no")].$font_end.'</p></td>
					<td width="80" align="center"><p>'.$display_font_color.$orderRes[csf("job_no_prefix_num")].$font_end.'</p></td>
					<td width="120"><p>'.$display_font_color.$orderRes[csf("style_ref_no")].$font_end.'</p></td>
					<td width="130"><p>'.$garments_item[$orderRes[csf("item_number_id")]].'</p></td>
					<td width="70" align="center" bgcolor="'.$color.'"><div style="word-wrap:break-word; width:50px">'.change_date_format($orderRes[csf("country_ship_date")]).'&nbsp;</div></td>
					<td width="120" align="center" bgcolor="'.$color.'"><p>'.$country_library[$orderRes[csf("country_id")]].'&nbsp;</p></td>
					<td width="120" align="center" bgcolor="'.$color.'"><p>'.$color_Arr_library[$orderRes[csf("color_number_id")]].'&nbsp;</p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_order_country('.$po_id.",".$company_name.",".$item_id.",".$orderRes[csf("country_id")].",".$orderRes[csf("color_number_id")].",'OrderPopup_country'".')">'.$po_quantity_in_pcs.'</a></p></td>
					<td width="70" align="right"><p>'.$pack_handover_date.'</p></td>
					<td width="70" align="right"><p>'.$ex_factory_date.'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("excess_cut")],0)." %".'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($plan_cut_qnty,0).'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($lay_qty,0).'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($cutting_replace_qty,0).'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($total_cut_qty,0).'&nbsp;</p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','1','0','product_popup'".')">'.number_format($cutting_qnty,0).'</a></p></td>
					<td width="80" align="right"><p>'.number_format($short_excess_cut_qnty,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>


					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','1*1','product_popup'".')">'.number_format($print_issue_inhouse,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','3*1','product_popup'".')">'.number_format($print_issue_subcon,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','1*1','product_popup'".')">'.number_format($print_rcv_inhouse,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','3*1','product_popup'".')">'.number_format($print_rcv_subcon,0).'</a></p></td>


					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','1*2','product_popup'".')">'.number_format($emb_issue_inhouse,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','3*2','product_popup'".')">'.number_format($emb_issue_subcon,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','1*2','product_popup'".')">'.number_format($emb_rcv_inhouse,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','3*2','product_popup'".')">'.number_format($emb_rcv_subcon,0).'</a></p></td>



					<td width="80" align="right"><p>'.number_format($spwork_issue,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($spcial_rec,0).'</p></td>

					<td width="80" align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($sewingin_qnty,0).'</p></td>
					<td width="80" align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($sewingout_qnty,0).'</p></td>

					<td width="80" align="right"><p>'.number_format($sewingin_subcon,0).'</p></a></td>
					<td width="80" align="right"><p>'.number_format($sewingout_subcon,0).'</p></td>


					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','4','','product_popup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','5','','product_popup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','2','3','product_popup'".')">'.number_format($wash_issue,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','3','product_popup'".')">'.number_format($wash_rec,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','7','1','product_popup'".')">'.number_format($iron_qnty,0).'</a></p></td>
					<td width="80" align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>


					<td width="80" align="right"><p>'.number_format($finish_qnty_inhouse,0).'<br>'.'Ctn: '.$cartonInQnty.'</p></td>
					<td width="80" align="right"><p>'.number_format($finish_qnty_outbound,0).'<br>'.'Ctn: '.$cartonOutQnty.'</p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','8','300','fin_gmt_transfer_popup'".')">'.number_format($trans_in_qty,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','8','200','fin_gmt_transfer_popup'".')">'.number_format($trans_out_qty,0).'</a></p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','8','1','product_popup'".')">'.number_format($total_finish_qnty,0).'</a><br>'.'Ctn: '.$cartonTotal_qnty.'</p></td>

					<td width="80" align="right"><p>'.number_format($finish_status,2)." %".'</p></td>


					<td width="80" align="right"><p><a href="##" onclick="openmypage_rej('.$po_id.",".$item_id.",'reject_qty','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','$type',''".')">'.number_format($rej_value,0).'</a></td>


					<td width="80" align="right"><p><a href="##" onclick="openmypage_sewing_rej('.$po_id.",".$item_id.",'sewing_reject_qty','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','$type',''".')">'.number_format($sewing_rej_value,0).'</a></p></td>


					<td width="80" align="right"><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','10','1','product_popup'".')" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'">'.number_format($ex_factory_qnty,0).'</a><br>'.'Ctn: '.$ex_factory_carton_qnty.'</p></td>

					<td width="80" align="right"><p>'.$shortage.'</p></td>
					<td width="80" align="right"><p>'.$excess.'</p></td>
					<td width="80" align="right"><p>'.$balance.'</p></td>
				</tr>';
				//Issue872
		}// end main foreach  exfactory
		// for remarks/view popup link <a href="##" onclick="openmypage_remark('.$po_id.",".$item_id.",0,'date_wise_production_report'".')"></a>
		?>
        <div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						<?
							echo "Order Wise RMG Production Status";

						?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						Company Name : <? echo $company_library[str_replace("'","",$cbo_company_name)]; ?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold" >
						<?
							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								echo "From $fromDate To $toDate" ;
							}
						?>
					</td>
				</tr>
			</table>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">This Report  is Generated based on Country Ship Date.</div>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">This Report Will Be Perfect When Order, Production, Delivery All Procedure Follow Color or Color & Size Level.</div>
			<div style="float:left; width:1930px">
				<table width="1880" cellspacing="0" border="1" class="rpt_table" rules="all" id="" >
					<thead>

						 <tr>
							<th rowspan="2" width="30">Sl.</th>
							<th rowspan="2" width="80">Buyer Name</th>
							<th rowspan="2" width="80">Order Qty.(Pcs)</th>
							<th rowspan="2" width="80">Cutting QC Qty</th>
							<th rowspan="2" width="80">Print Sent</th>
							<th rowspan="2" width="80">Print Received</th>
							<th rowspan="2" width="80">Embroidery Sent</th>
							<th rowspan="2"  width="80">Embroidery Received</th>
							<th rowspan="2"  width="80">Sp. Work Sent</th>
							<th rowspan="2" width="80">Sp. Work Received</th>
							<th width="160" colspan="2">In House</th>
							<th width="160" colspan="2">Out bound Sub-Contact</th>
							<th rowspan="2" width="80">Total Sewing Input Qty</th>
							<th rowspan="2" width="80">Total Sewing Output Qty</th>
							<th rowspan="2" width="80">Wash Sent</th>
							<th rowspan="2" width="80">Wash Received</th>
							<th rowspan="2" width="80">Total Iron Qty</th>
							<th  rowspan="2" width="80">Total Packing/Carton Qty</th>
							<th rowspan="2"  width="80">Finished Goods(%)</th>
							<th rowspan="2" width="80">Total Ex-Factory Qty</th>
							<th rowspan="2" >Ex-Factory(%)</th>
						 </tr>
						<tr>
							<th  width="80">Sew Input.</th>
							<th  width="80">Sew OutPut </th>
							<th  width="80">Sew Input.</th>
							<th  width="80">Sew OutPut </th>
						 </tr>

					</thead>
				</table>
				<div style="max-height:425px; overflow-y:scroll; width:1900px" >
					<table cellspacing="0" border="1" class="rpt_table"  width="1880" rules="all" id="" >
					<?
						$i=1; $total_po_quantity=0;$total_po_value=0; $total_cut=0; $total_print_iss=0;
						$total_print_re=0; $total_sew_input=0; $total_sew_out=0; $total_iron=0; $total_re_iron=0; $total_finish=0;$total_ex_factory=0;
						foreach($buyer_array as $buyer_id=>$value)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="80"><? echo $buyer_short_library[$buyer_id]; ?></td>
								<td width="80" align="right"><? echo number_format($value["poQty"]);?></td>
								<td width="80" align="right"><? echo number_format($value["cQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["print"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["print_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["emb"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["emb_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["spwork"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["spwork_rec"]); ?></td>
                                <td width="80" align="right"><? echo number_format($value["sQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["soQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["subcon_sewing"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["subcon_sewout"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["sQty"]+$value["subcon_sewing"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["soQty"]+$value["subcon_sewout"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["wash"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["wash_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["iQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["fQty"]); ?></td>
								<? $finish_gd_status = ($value["fQty"]/$value["poQty"])*100; ?>
								<td width="80" align="right"><? echo number_format($finish_gd_status,2); ?></td>
								<td width="80" align="right"><? echo number_format($value["ex"]); ?></td>
								<? $ex_gd_status = ($value["ex"]/$value["poQty"])*100; ?>
								<td width="" align="right"><? echo  number_format($ex_gd_status,2); ?></td>
							</tr>
							<?
								$total_po_quantity+=$value["poQty"];
								$total_cut+=$value["cQty"];
								$total_sent_print+=$value["print"];
								$total_print_re+=$value["print_rec"];
								$total_emb+=$value["emb"];
								$total_emb_re+=$value["emb_rec"];
								$total_wash+=$value["wash"];
								$total_wash_re+=$value["wash_rec"];
								$total_spwork+=$value["spwork"];
								$total_spwork_re+=$value["spwork_rec"];
								$total_sew_input+=$value["sQty"];
								$total_sew_out+=$value["soQty"];
								$total_subcon_sewing+=$value["subcon_sewing"];
								$total_subcon_sewout+=$value["subcon_sewout"];
								$total_iron+=$value["iQty"];
								$total_re_iron+=$value["reiQty"];
								$total_finish+=$value["fQty"];
								$total_ex_factory+=$value["ex"];
							$i++;
						}//end foreach 1st

						$chart_data_qnty="Order Qty;".$total_po_quantity."\n"."Cutting;".$total_cut."\n"."Sew In;".$total_sew_input."\n"."Sew Out ;".$total_sew_out."\n"."Iron ;".$total_iron."\n"."Finish ;".$total_finish."\n"."Ex-Fact;".$total_ex_factory."\n";
					?>
					</table>
					<table border="1" class="tbl_bottom"  width="1880" rules="all" id="" >
						<tr>
							<td width="30">&nbsp;</td>
							<td width="80" align="right">Total</td>
							<td width="80" ><? echo number_format($total_po_quantity); ?></td>
							<td width="80" ><? echo number_format($total_cut); ?></td>
							<td width="80" ><? echo number_format($total_sent_print); ?></td>
							<td width="80" ><? echo number_format($total_print_re); ?></td>
							<td width="80" ><? echo number_format($total_emb); ?></td>
							<td width="80" ><? echo number_format($total_emb_re); ?></td>
							<td width="80" ><? echo number_format($total_spwork); ?></td>
							<td width="80" ><? echo number_format($total_spwork_re); ?></td>
							<td width="80" ><? echo number_format($total_sew_input); ?></td>
							<td width="80" ><? echo number_format($total_sew_out); ?></td>
							<td width="80" ><? echo number_format($total_subcon_sewing); ?></td>
							<td width="80" ><? echo number_format($total_subcon_sewout); ?></td>
							<td width="80" ><? echo number_format($total_sew_input+$total_subcon_sewing); ?></td>
							<td width="80" ><? echo number_format($total_subcon_sewout+$total_sew_out); ?></td>
							<td width="80" ><? echo number_format($total_wash); ?></td>
							<td width="80" ><? echo number_format($total_wash_re); ?></td>
							<td width="80" ><? echo number_format($total_iron); ?></td>
							<td width="80" ><? echo number_format($total_finish); ?></td>
							<? $total_finish_gd_status = ($total_finish/$total_po_quantity)*100; ?>
							<td width="80"><? echo number_format($total_finish_gd_status,2); ?></td >
							<td width="80"><? echo number_format($total_ex_factory); ?></td >
							<? $total_ex_status = ($total_ex_factory/$total_po_quantity)*100; ?>
							<td width=""><? echo number_format($total_ex_status,2); ?></td>
						</tr>
					 </table>
					 <input type="hidden" id="graph_data" value="<? echo substr($chart_data_qnty,0,-1); ?>"/>
				</div>
			</div>
			<div style="float:left; width:600px">
				<table>
					<tr>
						<td height="21" width="600"><div id="chartdiv"> </div></td>
					</tr>
				</table>
			</div>
			<div style="clear:both; width:4460px"></div>
				<!-- <div style="width:4460px" id="scroll_body"></div> -->
				<div align="center" style="height:auto; width:4460px; margin:0 auto; padding:0;">
					<table border="1" cellpadding="0" cellspacing="0" class="rpt_table" width="4440" rules="all" id="rpt_table_header" align="left">
						<thead>
							<tr>
								<th rowspan="2" width="30">SL</th>
								<th rowspan="2" width="130">Order No.</th>
								<th rowspan="2" width="80">Order Status</th>
								<th rowspan="2" width="60">Buyer Name</th>
								<th rowspan="2" width="50">Job Year</th>
								<th rowspan="2" width="100">Job No.</th>
								<th rowspan="2" width="80">Job Prefix.</th>
								<th rowspan="2" width="120">Style Name</th>
								<th rowspan="2" width="130">Item Name</th>
								<th rowspan="2" width="70">Country Ship Date</th>
								<th rowspan="2" width="120">Country Name</th>
								<th rowspan="2" width="120">Color Name</th>
								<th rowspan="2" width="80">Order Qty.</th>
								<th rowspan="2" width="70">PHD Date</th>
								<th rowspan="2" width="70">Ex- Factory Date</th>
								<th rowspan="2" width="80">Approved Cut %</th>
								<th rowspan="2" width="80">Plan Cut Qty</th>
								<th rowspan="2" width="80">Cut Qty</th>
								<th rowspan="2" width="80">Replace Qty</th>
								<th rowspan="2" width="80">Total Cut Qty</th>
								<th rowspan="2" width="80">Cutting QC Qty</th>
								<th rowspan="2" width="80">Short/ Excess Cut Qty.</th>
								<th rowspan="2" width="80">Short/ Excess Cut %</th>

								<th colspan="2">Sent to Print</th>
								<th colspan="2">Rcv Print</th>
								<th colspan="2">Sent to Emb</th>
								<th colspan="2">Rcv Emb</th>

								<th rowspan="2"  width="80">Sent to Sp. Works</th>
								<th rowspan="2" width="80">Rcv Sp. Works</th>
								<th width="160" colspan="2">InHouse</th>
								<th width="160" colspan="2">Out-bound Sub-Contact</th>
								<th rowspan="2" width="80">Total Sewing Input Qty</th>
								<th rowspan="2" width="80">Total Sewing Output Qty</th>
								<th rowspan="2" width="80">Sent to Wash</th>
								<th rowspan="2" width="80">Rcv Wash</th>
								<th rowspan="2" width="80">Total Iron Qty</th>
								<th rowspan="2" width="80">Total Re-Iron Qty</th>
								<th colspan="5">Finish Qty</th>
								<th rowspan="2" width="80">Fin Goods Status</th>
								<th rowspan="2" width="80">Reject Qty</th>

								<th rowspan="2" width="80">Sewing Reject Qty</th>

								<th rowspan="2" width="80">Total Ex-Factory</th>
								<th rowspan="2" width="80">Shortage Qty.</th>
								<th rowspan="2" width="80">Excess Qty.</th>
								<th rowspan="2" width="80">Balance Qty.</th>
							</tr>
							<tr>
								<th width="80">Inhouse</th>
								<th width="80">SubCon</th>
								<th width="80">Inhouse</th>
								<th width="80">SubCon</th>
								<th width="80">Inhouse</th>
								<th width="80">SubCon</th>
								<th width="80">Inhouse</th>
								<th width="80">SubCon</th>
								<th width="80">Sew Input.</th>
								<th width="80">Sew OutPut </th>
								<th width="80">Sew Input.</th>
								<th width="80">Sew OutPut </th>
								<th  width="80">In-house</th>
								<th  width="80">Out-bound </th>
								<th  width="80">Transfer In </th>
								<th  width="80">Transfer Out </th>
								<th  width="80">Total</th>
							</tr>
						</thead>
					</table>
					<div style="width:4460px; max-height:250px; float:left; overflow-y:scroll;" id="scroll_body">
						<table  border="1" cellpadding="2" cellspacing="0" class="rpt_table" id="table_body" width="4440" rules="all" align="left">
							<?  echo $html; ?>
						</table>
					</div>
					<div style="width:4460px;float:left;">
						<table style="float:left;" cellspacing="0" cellpadding="0" border="1" class="rpt_table" rules="all" width="4440">
							<tfoot>
								<tr>
									<th width="30"></th>
									<th width="130"></th>
									<th width="80"></th>
									<th width="60"></th>
									<th width="50"></th>
									<th width="100"></th>
									<th width="80"></th>
									<th width="120"></th>
									<th width="130"></th>
									<th width="70"></th>
									<th width="120"></th>
									<th width="120">Total</th>
									<th width="80" id="total_order_quantity"><?=$gt_po_qty;?></th>
									<th width="70"></th>
									<th width="70"></th>
									<th width="80"></th>
									<th width="80" id="plan_cut_qnty"><?=$gt_plan_cut_qty;?></th>
									<th width="80" id="total_lay"><?=$gt_cut_lay_qty ;?></th>
									<th width="80" id="replace_qty"><?=$gt_cutting_replace_qty;?></th>
									<th width="80" id="total_cut_qty"><?=$gt_total_cut_qty;?></th>
									<th width="80" id="total_cutting"><?=$gt_cutting_qc_qty;?></th>
									<th width="80" id="short_excess_cut"><?=$gt_short_excess_cut_qnty;?></th>
									<th width="80"></th>

									<th width="80" id="total_print_issue_in"><?=$gt_print_issue_inhouse;?></th>
									<th width="80" id="total_print_issue_out"><?=$gt_print_issue_subcon;?></th>
									<th width="80" id="total_print_receive_in"><?=$gt_print_rcv_inhouse;?></th>
									<th width="80" id="total_print_receive_out"><?=$gt_print_rcv_subcon;?></th>
									<th width="80" id="total_emb_issue_in"><?=$gt_emb_issue_inhouse;?></th>
									<th width="80" id="total_emb_issue_out"><?=$gt_emb_issue_subcon;?></th>
									<th width="80" id="total_emb_receive_in"><?=$gt_emb_rcv_inhouse;?></th>
									<th width="80" id="total_emb_receive_out"><?=$gt_emb_rcv_subcon;?></th>

									<th width="80" id="total_sp_issue"><?=$gt_spc_qty_issue;?></th>
									<th width="80" id="total_sp_receive"><?=$gt_spcial_rec;?></th>
									<th width="80" id="total_sewing_input"><?=$gt_sewingin_qnty;?></th>
									<th width="80" id="total_sewing_out"><?=$gt_sewingout_qnty;?></th>
									<th width="80" id="total_subcon_sewing_input"><?=$gt_sewingin_subcon;?></th>
									<th width="80" id="total_subcon_sewing_out"><?=$gt_sewingout_subcon;?></th>
									<th width="80" id="total_sewing_input_all_qnty"><?=$gt_ttl_sewingin_qnty;?></th>
									<th width="80" id="total_sewing_output_all_qnty"><?=$gt_ttl_sewingout_qnty;?></th>
									<th width="80" id="total_wash_issue"><?=$gt_wash_qty_issue;?></th>
									<th width="80" id="total_wash_receive"><?=$gt_wash_rec;?></th>
									<th width="80" id="total_iron_qnty"><?=$gt_iron_qnty;?></th>
									<th width="80" id="total_re_iron_qnty"><?=$gt_re_iron_qnty;?></th>
									<?php $msg = 'Html filtered sum can not perform because of number and charecter mixing' ?>
									<th width="80" id="finish_qnty_inhouse" title="<?= $msg ?>"><?=number_format($gt_finish_qnty_inhouse,0).'<br>'.'Ctn: '.$gt_cartonInQnty; ?></th>
									<th width="80" id="finish_qnty_subcon" title="<?= $msg ?>"><?=number_format($gt_finish_qnty_outbound,0).'<br>'.'Ctn: '.$gt_cartonOutQnty;?></th>
									<th width="80" id="finish_qnty_transferIn"><?=$gt_finish_qnty_transferIn;?></th>
									<th width="80" id="finish_qnty_transferOut"><?=$gt_finish_qnty_transferOut;?></th>
									<th width="80" id="total_finish_qnty" title="<?= $msg ?>"><?=number_format($gt_total_finish_qnty,0).'<br>'.'Ctn: '.$gt_cartonTotal_qnty;?></th>
									<th width="80"></th>
									<th width="80" id="total_rej_value_td"><?=$gt_rej_value;?></th>

									<th width="80" id="total_sewing_rej_value_td"><?=$gt_sewing_rej_value;?></th>

									<th width="80" id="total_out" title="<?= $msg ?>"><?=number_format($gt_ex_factory_qnty,0).'<br>'.'Ctn: '.number_format($gt_ex_factory_carton_qnty,0);?></th>
									<th width="80"><span id="total_shortage"><?=$gt_shortage;?></span></th>
									<th width="80" id="td_excess"><?=$gt_excess;?></th>
									<th width="80"><span id="td_balance"><?=$gt_balance;?></span></th>
								</tr>
							</tfoot>
						</table>
					</div>
				</div>
			</div>
		</div>
        <?
	}
	else if($type==2) //color wise
	{


		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}
		//if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_season_id!=0) $str_po_cond.=" and a.season_buyer_wise=$cbo_season_id";

		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";

		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";
		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";

		$order_sql="SELECT a.id job_id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.id as po_id, b.po_number, b.pub_shipment_date as shipment_date, b.excess_cut,  b.is_confirmed,b.pack_handover_date, b.grouping, c.item_number_id as item_number_id, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total ,max(b.shiping_status) as shiping_status,sum(c.plan_cut_qnty) as plan_cut_qnty
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active in(1,2,3) and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $active_cond $order_status_cond $str_po_cond $txt_style_ref_number_cond  $internal_ref_cond_po
		group by a.id,a.job_no_prefix_num,a.job_no,a.insert_date,a.company_name,a.buyer_name,a.style_ref_no,b.id,b.po_number, b.pub_shipment_date, b.excess_cut, b.is_confirmed,b.pack_handover_date, b.grouping, c.item_number_id, c.color_number_id
		order by b.pub_shipment_date, b.id, c.item_number_id,c.color_number_id";
		// echo $order_sql."TYPE 2";
		$po_id_arr = array();
		$sql_po_result=sql_select($order_sql);

		if(count($sql_po_result)==0)
		{
			echo '<div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">No Data Found.</div>'; die;
		}

		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("po_id")].",";
			$po_id_arr[$row[csf("po_id")]] = $row[csf("po_id")];
		}

		$con = connect();
		execute_query("delete from gbl_temp_engine where user_id = ".$user_id." and ref_from =12 and entry_form=21");
		oci_commit($con);

		fnc_tempengine("gbl_temp_engine", $user_id, 21, 12, $po_id_arr, $empty_arr);//po id

		//echo "<pre>";print_r($booking_no_arr);die;



		$all_po_id=implode(',',array_unique(explode(",",chop($all_po_id,","))));
		//echo count(explode(",",$all_po_id));die;
		$template_id_arr=return_library_array("SELECT a.po_number_id, a.template_id from tna_process_mst a,gbl_temp_engine temp where a.po_number_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id group by a.po_number_id, a.template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and a.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(explode(",",$all_po_id),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (a.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or a.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}

			}
		}

		// echo $po_product_cond;die();
		// ========================================== cut and lay data =================================
		$all_po_ids_cond = str_replace("a.po_break_down_id", "c.order_id", $po_product_cond);
		$sql_cutlay="SELECT a.entry_form,b.order_id,b.gmt_item_id as gmts,b.color_id,c.order_id,sum(c.size_qty ) as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,gbl_temp_engine temp where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name group by a.entry_form,b.order_id,b.gmt_item_id,b.color_id,c.order_id";
		// echo $sql_cutlay;die();
		$sql_res=sql_select($sql_cutlay);
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			if($entry_form!=76)
			{
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
			}
			else
			{
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
			}

			// $po_id_arr[$vals[csf("order_id")]] =$vals[csf("order_id")];
		}
		//echo "<pre>";print_r($cut_lay_arrs);

		$color_id_arr=return_library_array( "SELECT a.id,a.color_number_id from wo_po_color_size_breakdown a,gbl_temp_engine temp where a.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.color_number_id>0 $po_product_cond", "id", "color_number_id");


		$ex_factory_data=sql_select("SELECT a.po_break_down_id, a.item_number_id, b.color_size_break_down_id, MAX(a.ex_factory_date) AS ex_factory_date,
		sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as ex_factory_qnty,a.total_carton_qnty
	    from pro_ex_factory_mst a, pro_ex_factory_dtls b , wo_po_color_size_breakdown e,gbl_temp_engine temp
	    where a.id=b.mst_id and b.color_size_break_down_id=e.id and a.po_break_down_id=e.po_break_down_id  and a.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and e.status_active=1 and e.is_deleted=0
	    group by a.po_break_down_id, a.item_number_id, b.color_size_break_down_id,a.total_carton_qnty");

		$ex_factory_arr=array();
		foreach($ex_factory_data as $exRow)
		{
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['date']=$exRow[csf('ex_factory_date')];
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['qty']+=$exRow[csf('ex_factory_qnty')];
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['ex_fac_carton_qty']=$exRow[csf('total_carton_qnty')];
            // $po_id_arr[$exRow[csf('po_break_down_id')]] = $exRow[csf('po_break_down_id')] ;
		}
		// echo "<pre>";
		// print_r($ex_factory_arr);
		unset($ex_factory_data);

		//echo "exit"; exit();
		$prod_sql= "SELECT a.po_break_down_id, a.item_number_id, b.color_size_break_down_id , max(a.re_production_qty) AS re_iron_qnty,
			NVL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
			NVL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' and a.embel_name=0 THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' and a.embel_name=0 THEN b.replace_qty ELSE 0 END),0) AS cutting_replace_qnty,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
			NVL(sum(CASE WHEN a.production_type ='3'  and b.production_type='3' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
			NVL(sum(CASE WHEN a.production_type ='2'  and b.production_type='2'and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

			NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
			NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
			NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
			NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

			NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=5 THEN b.production_qnty ELSE 0 END),0) AS trans_in_qty,
			NVL(sum(CASE WHEN a.production_type ='10' and a.trans_type=6 THEN b.production_qnty ELSE 0 END),0) AS trans_out_qty,


			NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS poly_qnty_in,
			NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS poly_qnty_out,


			NVL(sum(CASE WHEN a.production_type ='7' and b.production_type='7' THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
			NVL(sum(CASE WHEN a.production_type ='8'  and b.production_type='8' THEN b.production_qnty ELSE 0 END),0) AS finish_qnty,
			NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
			NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,

			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=2 THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='7' and b.production_type='7' and a.embel_name=2  THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='8' and b.production_type='8' and a.embel_name=0 THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' and a.embel_name=0 THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=1 THEN b.reject_qty ELSE 0 END),0) AS print_reject_qty,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=3 THEN b.reject_qty ELSE 0 END),0) AS wash_reject_qty,
			NVL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' and a.embel_name=4 THEN b.reject_qty ELSE 0 END),0) AS special_reject_qty,
			NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
			NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan=0 THEN b.reject_qty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan!=0 THEN b.production_qnty ELSE 0 END),0) AS sewingout_rej_qnty,

			NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan=0 THEN b.reject_qty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' and b.is_rescan!=0 THEN b.production_qnty ELSE 0 END),0) - NVL(sum(CASE WHEN a.production_type ='5' and b.production_type='5' THEN b.replace_qty ELSE 0 END),0) AS sewingout_rej_qnty_old
		from
			pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c,gbl_temp_engine temp
		where
			a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  and b.color_size_break_down_id>0 $active_cond_c $str_cond_product  $internal_ref_cond_prod
		group by a.po_break_down_id, a.item_number_id, b.color_size_break_down_id";

		$sql_carton_qty=sql_select("SELECT a.po_break_down_id,b.color_size_break_down_id,
			nvl(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			nvl(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			nvl(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a, pro_garments_production_dtls b,gbl_temp_engine temp
			where a.id=b.mst_id and a.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.carton_qty>0  $internal_ref_cond_prod
			group by a.po_break_down_id,b.color_size_break_down_id");
		//$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject;




		//sql test
		//echo $prod_sql;die;
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		//   $po_id_arr[$crtn[csf("po_break_down_id")]]=$crtn[csf("po_break_down_id")];
		}

		//print_r($carton_arr);
		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_qnty']+=$gmtsRow[csf('cutting_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['reject_qty'] += $gmtsRow[csf('cutting_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['replace_qty'] += $gmtsRow[csf('cutting_replace_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printing_qnty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['wash']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printreceived_qnty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printr']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['embr']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['washr']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['specialr']+=$gmtsRow[csf('specialr')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];


			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_qnty_in']+=$gmtsRow[csf('poly_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_qnty_out']+=$gmtsRow[csf('poly_qnty_out')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_in']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_in']+=$gmtsRow[csf('sewingout_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_out']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			//$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_qnty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['re_iron_qnty']+=$gmtsRow[csf('re_iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_rej_qnty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rej_qnty']+=$gmtsRow[csf('emb_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_rej_qnty']+=$gmtsRow[csf('iron_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_rej_qnty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_rej_qnty']+=$gmtsRow[csf('finish_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_rej_qnty']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_reject_qty']+=$gmtsRow[csf('print_reject_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['wash_reject_qty']+=$gmtsRow[csf('wash_reject_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['special_reject_qty']+=$gmtsRow[csf('special_reject_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewing_input_rej_qnty']+=$gmtsRow[csf('sewing_input_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_rej_qnty']+=$gmtsRow[csf('emb_issue_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_in_qty']+=$gmtsRow[csf('trans_in_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];
			$po_id_arr[$gmtsRow[csf('po_break_down_id')]]=$gmtsRow[csf('po_break_down_id')];
		}
		//$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject;

		// echo "<pre>";print_r($gmts_prod_arr);die;

		unset($res_gmtsData);

		$book_arr = array();
		$book_arr2 = array();


		$booking_no_arr=" SELECT a.item_number_id,c.po_break_down_id,c.gmts_color_id, c.booking_no FROM wo_pre_cost_fabric_cost_dtls    a, wo_booking_dtls    c, gbl_temp_engine  temp WHERE    a.id = c.pre_cost_fabric_cost_dtls_id AND c.po_break_down_id = temp.ref_val AND temp.entry_form = 21 AND temp.ref_from = 12 AND temp.user_id = $user_id  AND a.status_active = 1
		AND a.is_deleted = 0
		AND c.status_active = 1
		AND c.is_deleted = 0 ";
		//	echo $booking_no_arr ; die;
		$book_execute = sql_select($booking_no_arr);
		foreach($book_execute as $rowData ){


			if(!$book_arr2[$rowData['PO_BREAK_DOWN_ID']][$rowData['ITEM_NUMBER_ID']][$rowData['GMTS_COLOR_ID']][$rowData['BOOKING_NO']]){
				$book_arr[$rowData['PO_BREAK_DOWN_ID']][$rowData['ITEM_NUMBER_ID']][$rowData['GMTS_COLOR_ID']] .= $rowData['BOOKING_NO'] .',';
			}
			$book_arr2[$rowData['PO_BREAK_DOWN_ID']][$rowData['ITEM_NUMBER_ID']][$rowData['GMTS_COLOR_ID']][$rowData['BOOKING_NO']] = $rowData['BOOKING_NO'];

		}
		//echo "<pre>";print_r($book_arr2);die;



		execute_query("delete from gbl_temp_engine where user_id = ".$user_id." and ref_from =12 and entry_form=21");
		oci_commit($con);
		disconnect($con);

		ob_start();
		$result=sql_select($order_sql);
		$i=0; $k=0; $date=date("Y-m-d");
		$days_in_hand="";
		foreach($result as $orderRes)
		{

		   $i++;
		   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

			$k++;
			$lay_qty = $cut_lay_arrs[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]];
			$ex_factory_date=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['date'];
			$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['qty'];
			$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['ex_fac_carton_qty'];

			$color=""; $days_remian="";
			$days_remian=datediff("d",$date,$orderRes[csf("shipment_date")]);
			$days_in_hand=datediff("d",$date,$orderRes[csf("shipment_date")]);
			if($orderRes[csf("shipment_date")] > $date)
			{
				$color="";
			}
			else if($orderRes[csf("shipment_date")] < $date)
			{
				$color="red";
			}
			else if($orderRes[csf("shipment_date")] >= $date && $days_remian<=5 )
			{
				$color="orange";
			}
			//end if condition
			//if($days_in_hand<0) $days_in_hand=abs($days_in_hand)." Days Pass";
			//print_r($gmts_prod_arr[$orderRes[csf("id")]]);



			$cutting_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['cutting_qnty'];
			// echo $cutting_reject;
			$cutting_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['reject_qty'];
			// echo $cutting_reject;
			$cutting_replace=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['replace_qty'];

			$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['printreceived_qnty'];
			$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_in'];
			$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_in'];
			$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_out'];
			$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_out'];
			$iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['iron_qnty'];
			$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['re_iron_qnty'];
			//$finish_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty'];
			$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_inhouse'];
			$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_outbound'];

			$poly_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_qnty_in'];
			$poly_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_qnty_out'];


			$print_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print'];
			$embl_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb'];
			$wash_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['wash'];
			$spwork_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['special'];
			$print_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['printr'];
			$emb_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['embr'];
			$wash_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['washr'];

			$spcial_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['specialr'];


			$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_issue_inhouse'];
			$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_issue_subcon'];
			$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_rcv_inhouse'];
			$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_rcv_subcon'];

			$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_inhouse'];
			$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_subcon'];
			$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_inhouse'];
			$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_subcon'];

			//$cutting_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['cutting_rej_qnty'];
			$emb_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_rej_qnty'];
			$iron_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['iron_rej_qnty'];
			$sewing_out_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewingout_rej_qnty'];
			$finish_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['finish_rej_qnty'];


			$poly_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['poly_rej_qnty'];
			$print_reject_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['print_reject_qty'];
			$wash_reject_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['wash_reject_qty'];
			$special_reject_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['special_reject_qty'];
			$sewing_input_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['sewing_input_rej_qnty'];
			$emb_issue_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['emb_issue_rej_qnty'];

			$trans_in_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['trans_in_qty'];
			$trans_out_qty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("color_number_id")]]['trans_out_qty'];

			$cartonInQnty=$carton_arr[$orderRes[csf("po_id")]]['carton_qty_no_inhouse'];
			$cartonOutQnty=$carton_arr[$orderRes[csf("po_id")]]['carton_qty_no_outbound'];
			$cartonTotal_qnty=$carton_arr[$orderRes[csf("po_id")]]['carton_total_qty'];

			$po_id_arr[$orderRes[csf("po_id")]]=$orderRes[csf("po_id")];




			$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$orderRes[csf("order_quantity")];
			$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$orderRes[csf("order_total")];
			$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['cutQty']+=$lay_qty;
			$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
			$actual_exces_cut = $cutting_qnty;
			$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
			$total_poly_qnty=$poly_qnty_inhouse+$poly_qnty_outbound;
			if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

			$po_quantity_in_pcs=$orderRes[csf("order_quantity")];
			$plan_cut_qnty=$orderRes[csf("plan_cut_qnty")];
			//$actual_exces_cut = $cutting_qnty;
			$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
			$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);
			$excess_cut_percent=$short_excess_cut_percent-$orderRes[csf("excess_cut")];
			$embl_recv_qty=$print_rec+$emb_rec+$wash_rec+$spcial_rec;
			$rej_value=$cutting_reject+$emb_reject+$iron_reject+$finish_reject+$poly_rej_qnty+$print_reject_qty+$wash_reject_qty+$special_reject_qty;

			/*
			$cutting_reject=$rej_qty_arr[$color_id][$size_id][1][0];//
			$print_reject_qty=$rej_qty_arr[$color_id][$size_id][3][1];//
			$emb_reject=$rej_qty_arr[$color_id][$size_id][3][2];//
			$wash_reject_qty=$rej_qty_arr[$color_id][$size_id][3][3];//
			$special_reject_qty=$rej_qty_arr[$color_id][$size_id][3][4];
			$iron_reject=$rej_qty_arr[$color_id][$size_id][7][0];//
			$poly_rej_qnty=$rej_qty_arr[$color_id][$size_id][11][0];//
			$finish_reject=$rej_qty_arr[$color_id][$size_id][8][0];// */

			$finish_status = $total_finish_qnty*100/$po_quantity_in_pcs;
			$poly_status = $total_poly_qnty*100/$po_quantity_in_pcs;

			$company_name=$orderRes[csf("company_name")];
			$po_id=$orderRes[csf("po_id")];
			$item_id=$orderRes[csf("item_number_id")];

			if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);

			if(($orderRes[csf("pack_handover_date")]=="" || $orderRes[csf("pack_handover_date")]=="0000-00-00")) $pack_handover_date="&nbsp;"; else $pack_handover_date=change_date_format($orderRes[csf("pack_handover_date")]);

			//if($orderRes[csf("shiping_status")]==3) $days_remian=$days_remian; else $days_remian="---";
			//if(round($actual_exces_cut) > round($orderRes[csf("excess_cut")])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
			$total_rej_value+=$rej_value;
			$template_id=$template_id_arr[$orderRes[csf("po_id")]];
			/// for order popup define leter
			//<a href="##" onclick="openmypage_order('.$po_id.",".$company_name.",".$item_id.",0,'OrderPopup'".')"></a>

			$shortage = 0; $excess = 0; $balance = 0;
			if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
			{
				$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

				if($shortage<0)
				{
					//$shortage = "".ltrim($shortage,"-")."";
				}
			}
			else
			{
				//$shortage="(".ltrim($shortage,"-").")";
				//$shortage = "-";
			}

			if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
			{
				$excess = $ex_factory_qnty-$po_quantity_in_pcs;
			}
			else
			{
				$excess = 0;
			}

			$balance = $ex_factory_qnty-$po_quantity_in_pcs;
			//echo  $gmtsRow['PO_BREAK_DOWN_ID'];
			//	echo "<pre>"




			$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$k','$bgcolor') id=tr_2nd$k>";
			$html.='<td width="30">'.$i.'</td>

					<td width="130"><p><a href="##" onclick="progress_comment_popup('.$orderRes[csf("po_id")].",'".$template_id."',".$tna_process_type.')">'.$orderRes[csf("po_number")].'</a></p></td>
					<td width="80"><p>'.$order_status[$orderRes[csf("is_confirmed")]].'</p></td>
					<td width="60"><p>'.$buyer_short_library[$orderRes[csf("buyer_name")]].'</p></td>
					<td width="100" align="center" title="'.$orderRes[PO_ID].'"><p>'.$orderRes[csf("job_no")].'</p></td>

					<td width="100" align="center"><p>' . trim( $book_arr[$orderRes["PO_ID"]][$orderRes["ITEM_NUMBER_ID"]][$orderRes["COLOR_NUMBER_ID"]],',')


					.'</p></td>

					<td width="80" align="center"><p>'.$orderRes[csf("job_no_prefix_num")].'</p></td>
					<td width="80" align="center"><p>'.$orderRes[csf("grouping")].'</p></td>
					<td width="120"><p>'.$orderRes[csf("style_ref_no")].'</p></td>
					<td width="130"><p>'.$garments_item[$orderRes[csf("item_number_id")]].'</p></td>
					<td width="140" align="center"><p>'.$color_Arr_library[$orderRes[csf("color_number_id")]].'&nbsp;</p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_order_country('.$po_id.",".$company_name.",".$item_id.",'0',".$orderRes[csf("color_number_id")].",'OrderPopup_country'".')">'.$po_quantity_in_pcs.'</a></p></td>
					<td width="70" align="center"><p>'.change_date_format($orderRes[csf("shipment_date")]).'&nbsp;</p></td>
					<td width="70" align="center"><p>'.$pack_handover_date.'</p></td>
					<td width="70" align="center"><p>'.$ex_factory_date.'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("excess_cut")],2)." %".'</p></td>
					<td width="80" align="right"><p>'.number_format($plan_cut_qnty,0).'</p></td>

					<td width="100" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','17','1','product_popup'".')">'.number_format($lay_qty,0).'</a></p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','1','1','product_popup'".')">'.number_format($cutting_qnty,0).'</a></p></td>
					<td width="80" align="right"><p>'.number_format($cutting_reject,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($cutting_replace,0).'</p></td>



					<td width="80" align="right"><p>'.number_format($short_excess_cut_qnty,0).'</p></td>

					<td width="80" align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','1*1','product_popup'".')">'.number_format($print_issue_inhouse,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','3*1','product_popup'".')">'.number_format($print_issue_subcon,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','3','1*1','product_popup'".')">'.number_format($print_rcv_inhouse,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','3','3*1','product_popup'".')">'.number_format($print_rcv_subcon,0).'</a></p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','1*2','product_popup'".')">'.number_format($emb_issue_inhouse,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','3*2','product_popup'".')">'.number_format($emb_issue_subcon,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','1*2','product_popup'".')">'.number_format($emb_rcv_inhouse,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','3','3*2','product_popup'".')">'.number_format($emb_rcv_subcon,0).'</a></p></td>

					<td width="80" align="right"><p>'.number_format($spwork_issue,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($spcial_rec,0).'</p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','4','1','product_popup'".')">'.number_format($sewingin_qnty,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','5','1','product_popup'".')">'.number_format($sewingout_qnty,0).'</a></p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','4','3','product_popup'".')">'.number_format($sewingin_subcon,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','5','3','product_popup'".')">'.number_format($sewingout_subcon,0).'</a></p></td>


					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','4','','product_popup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','5','','product_popup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','2','3','product_popup'".')">'.number_format($wash_issue,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','3','3','product_popup'".')">'.number_format($wash_rec,0).'</a></p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','11','1','product_popup'".')">'.number_format($poly_qnty_inhouse,0).'</p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','".$orderRes[csf("country_id")]."','".$orderRes[csf("color_number_id")]."','11','3','product_popup'".')">'.number_format($poly_qnty_outbound,0).'</p></td>

					<td width="80" align="right"><p>'.$total_poly_qnty.'</p></td>
					<td width="80" align="right"><p>'.number_format($poly_status,2)." %".'</p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','7','1','product_popup'".')">'.number_format($iron_qnty,0).'</a></p></td>
					<td width="80" align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($finish_qnty_inhouse,0).'<br> Ctn: ' .$cartonInQnty.'</p></td>
					<td width="80" align="right"><p>'.number_format($finish_qnty_outbound,0).'<br> Ctn: ' .$cartonOutQnty.'</p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','8','300','fin_gmt_transfer_popup'".')">'.number_format($trans_in_qty,0).'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','8','200','fin_gmt_transfer_popup'".')">'.number_format($trans_out_qty,0).'</a></p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','8','','product_popup'".')">'.number_format($total_finish_qnty,0).'</a>'.'<br> Ctn: ' .$cartonTotal_qnty.'</p></td>
					<td width="80" align="right"><p>'.number_format($finish_status,2)." %".'</p></td>

					<td width="80" align="right"><p><a href="##" onclick="openmypage_rej('.$po_id.",".$item_id.",'reject_qty','','".$orderRes[csf("color_number_id")]."','$type',''".')">'.$rej_value.'</a></p></td>
					<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','10','1','product_popup'".')">'.number_format($ex_factory_qnty,0).'</a><br>'.'Ctn: '.$ex_factory_carton_qnty.'</p></td>

					<td width="80" align="right"><p>'.$shortage.'</p></td>
					<td width="80" align="right"><p>'.$excess.'</p></td>
					<td width="80" align="right"><p>'.$balance.'</p></td>
					<td width="90"><p>'.$shipment_status[$orderRes[csf("shiping_status")]].'</p></td>
					<td>&nbsp;<a href="##" onclick="openmypage_color_countyr_remark('.$po_id.",'".$item_id."','0','".$orderRes[csf("color_number_id")]."','product_all_remarks'".')">Remarks</a></td>

				</tr>';
		}// end main foreach  exfactory
		// for remarks/view popup link <a href="##" onclick="openmypage_remark('.$po_id.",".$item_id.",0,'date_wise_production_report'".')"></a>


		?>
        <div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						<?
							echo "Order Wise RMG Production Status";

						?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						Company Name : <? echo $company_library[str_replace("'","",$cbo_company_name)]; ?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">
						<?
							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								echo "From $fromDate To $toDate" ;
							}
						?>
					</td>
				</tr>
			</table>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">This Report is Generated based on Published Ship Date.</div>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">This Report Will Be Perfect When Order, Production, Delivery All Procedure Follow Color or Color & Size Level.</div>
			<div style="float:left; width:1980px">
				<table width="1960" cellspacing="0" border="1" class="rpt_table" rules="all" id="" >
					<thead>
						<tr>
							<th rowspan="2" width="30">Sl.</th>
							<th rowspan="2" width="80">Buyer Name</th>
							<th rowspan="2" width="80">Order Qty.(Pcs)</th>
							<th rowspan="2" width="100">Cut and Lay Qty</th>
							<th rowspan="2" width="80">Cutting QC Qty</th>
							<th rowspan="2" width="80">Print Sent</th>
							<th rowspan="2" width="80">Print Received</th>
							<th rowspan="2" width="80">Embroidery Sent</th>
							<th rowspan="2"  width="80">Embroidery Received</th>
							<th rowspan="2"  width="80">Sp. Work Sent</th>
							<th rowspan="2" width="80">Sp. Work Received</th>
							<th width="160" colspan="2">In House</th>
							<th width="160" colspan="2">Sub-Contract</th>
							<th rowspan="2" width="80">Total Sewing Input Qty</th>
							<th rowspan="2" width="80">Total Sewing Output Qty</th>
							<th rowspan="2" width="80">Wash Sent</th>
							<th rowspan="2" width="80">Wash Received</th>
							<th rowspan="2" width="80">Total Iron Qty</th>
							<th  rowspan="2" width="80">Total Packing Qty</th>
							<th rowspan="2"  width="80">Finished Goods(%)</th>
							<th rowspan="2" width="80">Total Ex-Factory Qty</th>
							<th rowspan="2" >Ex-Factory(%)</th>
						 </tr>
						<tr>
							<th  width="80">Sew Input.</th>
							<th  width="80">Sew OutPut </th>
							<th  width="80">Sew Input.</th>
							<th  width="80">Sew OutPut </th>
						 </tr>
					</thead>
				</table>
				<div style="max-height:300px; overflow-y:scroll; width:1980px" >
					<table cellspacing="0" border="1" class="rpt_table"  width="1960" rules="all" id="" >
					<?
						$i=1; $total_po_quantity=0;$total_po_value=0; $total_cut=0; $total_print_iss=0;
						$total_print_re=0; $total_sew_input=0; $total_sew_out=0; $total_iron=0; $total_re_iron=0; $total_finish=0;$total_ex_factory=0;
						foreach($buyer_array as $buyer_id=>$value)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="80"><? echo $buyer_short_library[$buyer_id]; ?></td>
								<td width="80" align="right"><? echo number_format($value["poQty"]);?></td>
								<td width="100" align="right"><? echo number_format($value["cutQty"]) ; ?></td>
								<td width="80" align="right"><? echo number_format($value["cQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["print"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["print_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["emb"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["emb_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["spwork"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["spwork_rec"]); ?></td>
                                <td width="80" align="right"><? echo number_format($value["sQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["soQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["subcon_sewing"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["subcon_sewout"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["sQty"]+$value["subcon_sewing"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["soQty"]+$value["subcon_sewout"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["wash"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["wash_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["iQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["fQty"]); ?></td>
								<? $finish_gd_status = ($value["fQty"]/$value["poQty"])*100; ?>
								<td width="80" align="right"><? echo number_format($finish_gd_status,2); ?></td>
								<td width="80" align="right"><? echo number_format($value["ex"]); ?></td>
								<? $ex_gd_status = ($value["ex"]/$value["poQty"])*100; ?>
								<td width="" align="right"><? echo  number_format($ex_gd_status,2); ?></td>
							</tr>
							<?
								$total_po_quantity+=$value["poQty"];
								$total_cut+=$value["cQty"];
								$total_cut_and_lay+=$value["cutQty"];
								$total_sent_print+=$value["print"];
								$total_print_re+=$value["print_rec"];
								$total_emb+=$value["emb"];
								$total_emb_re+=$value["emb_rec"];
								$total_wash+=$value["wash"];
								$total_wash_re+=$value["wash_rec"];
								$total_spwork+=$value["spwork"];
								$total_spwork_re+=$value["spwork_rec"];
								$total_sew_input+=$value["sQty"];
								$total_sew_out+=$value["soQty"];
								$total_subcon_sewing+=$value["subcon_sewing"];
								$total_subcon_sewout+=$value["subcon_sewout"];
								$total_iron+=$value["iQty"];
								$total_re_iron+=$value["reiQty"];
								$total_finish+=$value["fQty"];
								$total_ex_factory+=$value["ex"];
							$i++;
						}//end foreach 1st

						$chart_data_qnty="Order Qty;".$total_po_quantity."\n"."Cutting;".$total_cut."\n"."Sew In;".$total_sew_input."\n"."Sew Out ;".$total_sew_out."\n"."Iron ;".$total_iron."\n"."Finish ;".$total_finish."\n"."Ex-Fact;".$total_ex_factory."\n";
					?>
					</table>
					<table border="1" class="tbl_bottom"  width="1960" rules="all" id="" >
						<tr>
							<td width="30">&nbsp;</td>
							<td width="80" align="right">Total</td>
							<td width="80" id="tot_po_quantity"><? echo number_format($total_po_quantity); ?></td>

							<td width="100" id="tot_cutting"><? echo number_format($total_cut_and_lay); ?></td>
							<td width="80" id="tot_cutting"><? echo number_format($total_cut); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_sent_print); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_print_re); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_emb); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_emb_re); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_spwork); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_spwork_re); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_sew_input); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_sew_out); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_subcon_sewing); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_subcon_sewout); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_sew_input+$total_subcon_sewing); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_sew_out+$total_subcon_sewout); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_wash); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_wash_re); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_iron); ?></td>
							<td width="80" id="tot_finish"><? echo number_format($total_finish); ?></td>
							<? $total_finish_gd_status = ($total_finish/$total_po_quantity)*100; ?>
							<td width="80"><? echo number_format($total_finish_gd_status,2); ?></td >
							<td width="80"><? echo number_format($total_ex_factory); ?></td >
							<? $total_ex_status = ($total_ex_factory/$total_po_quantity)*100; ?>
							<td width=""><? echo number_format($total_ex_status,2); ?></td>
						</tr>
					 </table>
					 <input type="hidden" id="graph_data" value="<? echo substr($chart_data_qnty,0,-1); ?>"/>
				</div>
			</div>
			<div style="float:left; width:600px">
				<table>
					<tr>
						<td height="21" width="600"><div id="chartdiv"> </div></td>
					</tr>
				</table>
			</div>
			<div style="clear:both"></div>
			<table width="5400" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1">
				<thead>
					<tr>
						<th rowspan="2" width="30">SL</th>
						<th rowspan="2" width="130">Order Number</th>
                        <th rowspan="2" width="80">Order Status</th>
						<th rowspan="2" width="60">Buyer Name</th>
                        <th rowspan="2" width="100">Job Number</th>
						<th rowspan="2" width="100">Booking No</th>
                        <th rowspan="2" width="80">Job Prefix</th>
                        <th rowspan="2" width="80">Internal Ref</th>
						<th rowspan="2" width="120">Style Name</th>
						<th rowspan="2" width="130">Item Name</th>

                        <th rowspan="2" width="140">Color Name</th>
                        <th rowspan="2" width="80">Order Qty.</th>
						<th rowspan="2" width="70">Shipment Date</th>
						<th rowspan="2" width="70">PHD Date</th>
						<th rowspan="2" width="70">Ex-Factory Date</th>
						<th rowspan="2" width="80">Approved Cut %</th>
                        <th rowspan="2" width="80">Plan Cut Qty</th>
                        <th rowspan="2" width="100">Cut and Lay Qty</th>
						<th rowspan="2" width="80">Cutting QC Qty</th>

						<th rowspan="2" width="80">Reject Qnty</th>
						<th rowspan="2" width="80">Replace Qnty</th>

                        <th rowspan="2" width="80">Short/Excess Cut Qty</th>


                        <th rowspan="2" width="80">Short/Excess Cut%</th>
						<th colspan="2" width="80">Sent to Print</th>
						<th colspan="2" width="80">Rcv Print</th>
						<th colspan="2" width="80">Sent to Emb</th>
						<th colspan="2" width="80">Rcv Emb</th>
						<th rowspan="2" width="80">Sent to Sp. Works</th>
						<th rowspan="2" width="80">Rcv Sp. Works</th>
						<th width="80" colspan="2">InHouse</th>
						<th width="80" colspan="2">Out-bound Sub-Contact</th>
						<th rowspan="2" width="80">Total Sewing Input Qty</th>


						<th rowspan="2" width="80">Total Sewing Output Qty</th>
						<th rowspan="2" width="80">Sent to Wash</th>
						<th rowspan="2" width="80">Rcv Wash</th>
						<th colspan="3" width="80">Poly Qty</th>
						<th rowspan="2" width="80">Poly Comp%</th>
						<th rowspan="2" width="80">Total Iron Qty</th>
						<th rowspan="2" width="80">Total Re-Iron Qty</th>
						<th width="80" colspan="5">Finish Qty</th>
						<th rowspan="2" width="80">Fin Goods Status</th>
						<th rowspan="2" width="80">Reject Qty</th>


						<th rowspan="2" width="80">Total Ex-Factory</th>
						<th rowspan="2" width="80">Shortage Qty.</th>
						<th rowspan="2" width="80">Excess Qty.</th>
						<th rowspan="2" width="80">Balance Qty.</th>
						<th rowspan="2" width="90">Status</th>
                        <th rowspan="2">Remarks</th>
					 </tr>
					 <tr>
                        <th width="80">Inhouse</th>
                        <th width="80">SubCon</th>

                        <th width="80">Inhouse</th>
                        <th width="80">SubCon</th>

                        <th width="80">Inhouse</th>
                        <th width="80">SubCon</th>

                        <th width="80">Inhouse</th>
                        <th width="80">SubCon</th>

                        <th width="80">Sew Input.</th>
                        <th width="80">Sew OutPut </th>
                        <th width="80">Sew Input.</th>
                        <th width="80">Sew OutPut </th>
                        <th width="80">In-house</th>
                        <th width="80">Out-bound </th>
                        <th width="80">Total</th>
                        <th width="80">In-house</th>
                        <th width="80">Out-bound </th>
                        <th width="80">Transfer In </th>
                        <th width="80">Transfer Out </th>
                        <th width="80">Total</th>
					</tr>
				</thead>
			</table>
			<div style="max-height:425px; overflow-y:scroll; width:5400px" id="scroll_body">
				<table border="1" class="rpt_table" width="5400" rules="all" id="table_body">
					<?  echo $html; ?>
				</table>
				<table border="1" class="tbl_bottom" width="5400" rules="all" id="report_table_footer_1" >
					<tr>
						<td width="30"></td>
						<td width="130"></td>
                        <td width="80"></td>
						<td width="60"></td>
                        <td width="100"></td>
                        <td width="100"></td>
                        <td width="80"></td>
						<td width="80"></td>
						<td width="120"></td>
                        <td width="130"></td>

                        <td width="140">Total</td>
                        <td width="80" id="total_order_quantity"></td>
						<td width="70"></td>
						<td width="70"></td>
						<td width="70"></td>
                        <td width="80" id=""></td>
                        <td width="80" id="total_plan_cutting"></td>
						<td width="100" id="total_lay"></td>
						<td width="80" id="total_cutting"></td>
						<td width="80" id="total_reject"></td>
						<td width="80" id="total_replace"></td>
                        <td width="80" id="short_access_cut"></td>

						<td width="80" id=""></td>
                        <td width="80" id="total_print_issue_in"></td>
						<td width="80" id="total_print_receive_in"></td>
						<td width="80" id="total_print_receive_out"></td>
						<td width="80" id="total_emb_issue_in"></td>
                        <td width="80" id="total_emb_issue_out"></td>
						<td width="80" id="total_emb_receive_in"></td>
						<td width="80" id="total_emb_receive_out"></td>
						<td width="80" id="total_sp_issue"></td>
						<td width="80" id="total_sp_receive"></td>

						<td width="80" id="total_sewing_input"></td>
						<td width="80" id="total_sewing_out"></td>
						<td width="80" id="total_subcon_sewing_input"></td>
						<td width="80" id="total_subcon_sewing_out"></td>
						<td width="80" id="total_sewing_input_all_qnty"></td>
						<td width="80" id="total_sewing_output_all_qnty"></td>
						<td width="80" id="total_wash_issue"></td>
						<td width="80" id="total_wash_receive"></td>
						<td width="80" id="poly_qnty_inhouse"></td>
                        <td width="80" id="poly_qnty_subcon"></td>

                        <td width="80" id="total_poly_qnty"></td>
						<td width="80" id="total_poly_qnty2"></td>
						<td width="80" id="total_iron_qnty"></td>
						<td width="80" id="total_re_iron_qnty"></td>
						<td width="80" id="finish_qnty_inhouse"></td>
                        <td width="80" id="finish_qnty_subcon"></td>
                        <td width="80" id="finish_qnty_transferIn"></td>
                        <td width="80" id="finish_qnty_transferOut"></td>
                        <td width="80" id="total_finish_qnty"></td>
						<td width="80" id="th_total_finish_qnty2"></td>
						<td width="80" align="right" id="total_rej_value_td"></td>
						<td width="80" id="total_exfact"></td>
						<td width="80" id="total_shortage"></td>
						<td width="80" id="td_excess"></td>
						<td align="right" id="td_balance" width="80"></td>
						<td width="90"></td>
                        <td></td>
					</tr>
				</table>
			</div>
			<br>
			<br>
		 </div>
        <?
	}
	else  if($type==3) //color and size wise
	{
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$year_cond =" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$year_cond =" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		?>

		<?
		//report size and color wise kaiyum
		// if(str_replace("'", "", $txt_order) !=""){$po_number_cond=" and d.po_number = $txt_order";}
		if(str_replace("'", "", $txt_order) !=""){$po_conds=" and b.po_number in($txt_order_number)";}
		if(str_replace("'", "", $txt_internal_ref) !=""){$intref_conds=" and b.grouping=$txt_internal_ref";}
		if(str_replace("'", "", $cbo_buyer_name) !=0){$buyer_conds=" and a.buyer_name=$cbo_buyer_name";}
		if(str_replace("'", "", $cbo_season_id) !=0){$season_conds=" and a.season_buyer_wise=$cbo_season_id";}
		if(str_replace("'", "", $txt_style_ref) !=""){$po_conds.=" and a.job_no_prefix_num in($txt_style_ref)";}
		if($txt_datefrom!="" &&  $txt_dateto!="")  $po_conds.=" and  b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($po_status=="confirm"){$po_status_cond = " and b.is_confirmed=1";}
		// echo $po_status;die();
		$all_po_id_sql= sql_select("SELECT b.id from wo_po_details_master a, wo_po_break_down b where a.id=b.job_id and b.status_active in(1,2,3) and b.is_deleted=0 $year_cond $po_conds $po_status_cond $intref_conds $buyer_conds $season_conds");
		// echo "SELECT b.id from wo_po_details_master a, wo_po_break_down b where a.id=b.job_id and b.status_active in(1,2,3) and b.is_deleted=0 $year_cond $po_conds $po_status_cond $intref_conds $buyer_conds";die();
		foreach($all_po_id_sql as $keys=>$values)
		{
 			$all_po_id_arr[$values[csf("id")]]=$values[csf("id")];
		}
	   $all_po_ids=implode(",", $all_po_id_arr);
	   $all_po_ids_cond="";

	   if(count($all_po_id_arr)>0)
	   {
		   	if($db_type==2 && count($all_po_id_arr)>999)
		    {
		   		$chunk_arr=array_chunk($all_po_id_arr, 999);
		   		foreach($chunk_arr as $vals)
		   		{
		   			$po_ids=implode(",", $vals);
		   			if($all_po_ids_cond=="")
		   			{
		   				$all_po_ids_cond.=" and (a.order_id in ($po_ids)";
		   			}
		   			else
		   			{
		   				$all_po_ids_cond.=" or  a.order_id in ($po_ids)";
		   			}
		   		}
		   		$all_po_ids_cond.= " )";
		   }
		   else
		   {
		   		$all_po_ids_cond= " and a.order_id in($all_po_ids) ";
		   }
	   }
	   else
	   {
	   	?>
	   		<div style="text-align: center;color: red;font-weight: bold;font-size: 20px;">Sorry! Report data not found.</div>
	   	<?
	   	die();
	   }

		$po_break_down_id=$txt_order_id ; // 25434
		$company_name=$cbo_company_name;
		if ($txt_style_ref_number!="")
		{
			$txt_style_ref_number_cond="and e.style_ref_no like '%$txt_style_ref_number%'";
		}
		else
		{
			$txt_style_ref_number_cond="";
		}
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$cbo_job_year_cond =" and year(e.insert_date)='$cbo_job_year'";
			}
			else
			{
				$cbo_job_year_cond =" and to_char(e.insert_date,'YYYY')='$cbo_job_year'";
			}
		}

		if($txt_style_ref_id!="")
		{
			$txt_style_ref_id_cond=" and e.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$txt_style_ref_id_cond =" and e.job_no_prefix_num='$txt_style_ref'";
		}

		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.company_name=$cbo_company_name";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$shipping_status_cond =" and d.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$shipping_status_cond =" and d.shiping_status in(1,2)";
			}
			else
			{
				$shipping_status_cond =" and d.shiping_status in(1,2,3)";
			}
		}
		if($po_break_down_id!="" )  $po_break_down_id_cond =" and a.po_break_down_id in (".$po_break_down_id.") ";
		if($po_break_down_id!="" )  $po_break_down_id_cond_cut =" and a.order_id in (".$po_break_down_id.") ";  // for cut lay qnty
		if($cbo_buyer_name!=0 )  $cbo_buyer_name_cond =" and e.buyer_name =$cbo_buyer_name";
		if($cbo_season_id!=0 )  $cbo_season_id_cond =" and e.season_buyer_wise =$cbo_season_id";


		if($cbo_location!=0 )  $cbo_location_cond =" and e.location_name =$cbo_location";

		if($txt_datefrom!="" &&  $txt_dateto!="")  $txt_datefrom_to_cond =" and d.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($txt_datefrom!="" &&  $txt_dateto!="")  $txt_datefrom_to_cond_prod =" and a.production_date between '$txt_datefrom' and '$txt_dateto'";

		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and d.grouping=$txt_internal_ref ";

		$color_variable_setting=return_field_value("ex_factory","variable_settings_production","company_name='$company_name' and variable_list=1 and status_active=1 and is_deleted=0","ex_factory");
		$color_variable_setting = ($color_variable_setting==0) ? 3 : $color_variable_setting;

		$ex_fact_qty_arr=array();
		$po_break_down_id_cond = str_replace("a.order_id", "d.id", $all_po_ids_cond);
		if($color_variable_setting==2 || $color_variable_setting==3)
		{
			//echo	$sql_exfect="select c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c,wo_po_details_master e where a.id=b.mst_id and b.color_size_break_down_id=c.id $po_break_down_id_cond_2 $txt_style_ref_number_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond and a.status_active=1 and a.is_deleted=0  and c.job_no_mst=e.job_no group by  c.color_number_id, c.size_number_id";

			$sql_exfect="SELECT e.job_no,a.item_number_id, a.color_number_id, a.size_number_id, sum(y.production_qnty) as production_qnty from pro_ex_factory_mst x,pro_ex_factory_dtls y,wo_po_color_size_breakdown a,wo_po_break_down d,wo_po_details_master e
			where  x.id=y.mst_id and y.color_size_break_down_id=a.id and x.status_active=1 and x.is_deleted=0 and y.status_active=1 and y.is_deleted=0  and a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond  $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond $internal_ref_cond_po  group by  e.job_no,a.item_number_id,a.color_number_id,a.size_number_id order by a.size_number_id";

			// echo $sql_exfect;die();
			$sql_result_exfact=sql_select($sql_exfect);
			foreach($sql_result_exfact as $row)
			{
				$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("size_number_id")]][$row[csf("job_no")]]['ex_fact_qty']=$row[csf("production_qnty")];
			}
		}

		$color_size_sql=sql_select( "SELECT a.id, e.job_no, e.buyer_name, a.item_number_id, a.color_number_id, a.size_number_id, e.style_ref_no, d.pub_shipment_date, a.order_quantity, a.plan_cut_qnty, a.is_deleted  from wo_po_color_size_breakdown a, wo_po_break_down d, wo_po_details_master e where a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond  $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond  $internal_ref_cond_po and a.status_active=1 and a.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and e.status_active=1 order by a.color_order,a.size_order");

		$color_size_data=array();$color_size_qnty=array();
		foreach($color_size_sql as $row)
		{
			//$test_data[]=$row[csf("color_number_id")];
			if($row[csf("is_deleted")]==0)
			{
				$color_size_data[$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("job_no")]]['size'].= $row[csf("size_number_id")].',';
				$color_size_data[$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("job_no")]]['shipdate'].= change_date_format($row[csf("pub_shipment_date")]).',';
			}

			if($row[csf("is_deleted")]==0)
			{
				$color_size_qnty[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity']+=$row[csf("order_quantity")];
				$color_size_qnty[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_plan_cut']+=$row[csf("plan_cut_qnty")];
			}
			$job_libr[$row[csf("job_no")]]['style']=$row[csf("style_ref_no")];
			$job_libr[$row[csf("job_no")]]['buyer']=$buyer_short_library[$row[csf("buyer_name")]];
			$col_size_id.=$row[csf("id")].',';
		}
	 	$colBrekId=rtrim($col_size_id,",");
		$colBrekId_arr=explode(",",$colBrekId);

		$prod_sql_cut=sql_select("SELECT a.size_id,sum(a.size_qty) as cutlay_qty , b.job_no,c.gmt_item_id, c.color_id
		from ppl_cut_lay_bundle a,ppl_cut_lay_mst b,ppl_cut_lay_dtls c where b.company_id=$cbo_company_name  and a.mst_id=b.id and b.id=c.mst_id $all_po_ids_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by c.gmt_item_id,a.mst_id,a.size_id, b.job_no,c.color_id order by a.size_id ");//$po_break_down_id_cond_cut

		$color_size_cut_qnty=array();
		foreach($prod_sql_cut as $row)
		{
			$color_size_cut_qnty[$row[csf("color_id")]][$row[csf("gmt_item_id")]][$row[csf("job_no")]][$row[csf("size_id")]]['quantityCutting']+=$row[csf("cutlay_qty")];
		}
		$po_break_down_id_cond = str_replace("a.order_id", "a.po_break_down_id", $all_po_ids_cond);
		if($db_type==0)
		{
			$prod_sql="SELECT a.po_break_down_id,d.item_number_id, c.color_size_break_down_id,  d.color_number_id, d.size_number_id,e.style_ref_no, e.job_no,
					IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='1' AND a.entry_break_down_type=3 THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty_qc,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' and c.production_type ='3'  AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='4' and c.production_type ='4'  THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='5' and c.production_type ='5'  THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='6' and c.production_type ='6'  THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='7' and c.production_type ='7'  THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='8' and c.production_type ='8'  THEN c.production_qnty ELSE 0 END),0) AS finish_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='11' and c.production_type ='11' THEN c.production_qnty ELSE 0 END),0) AS poly_qty,
					IFNULL(sum(CASE WHEN a.production_type ='80' and c.production_type ='80' THEN c.production_qnty ELSE 0 END),0) AS finishing_qty,
					IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type =5 THEN c.production_qnty ELSE 0 END),0) AS trans_in_qty,
					IFNULL(sum(CASE WHEN a.production_type ='10' and a.trans_type =6 THEN c.production_qnty ELSE 0 END),0) AS trans_out_qty
				from
					pro_garments_production_mst a, pro_garments_production_dtls c ,wo_po_color_size_breakdown d, wo_po_details_master e
				where
					a.id=c.mst_id
					 and c.color_size_break_down_id=d.id and d.job_no_mst=e.job_no $po_break_down_id_cond  $cbo_style_owner_wise_status_cond  $txt_style_ref_id_cond $internal_ref_cond_prod
				and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and e.status_active=1 and e.is_deleted=0   $txt_datefrom_to_cond_prod  and d.id in ($colBrekId)
				group by d.item_number_id,a.po_break_down_id, c.color_size_break_down_id, d.color_number_id, d.size_number_id,e.job_no,e.style_ref_no, c.bundle_no order by  d.size_number_id";
		}
		else
		{
			$colBrekId_chunk=array_chunk($colBrekId_arr,999);
			$colorBreakDownId_cond=" and";
			foreach($colBrekId_chunk as $dtls_id)
			{
			if($colorBreakDownId_cond==" and" )  $colorBreakDownId_cond.=" ( d.id in(".implode(',',$dtls_id).")"; else $colorBreakDownId_cond.=" or d.id in(".implode(',',$dtls_id).")";
			}
			$colorBreakDownId_cond.=" )";
			//echo $colorBreakDownId_cond;die;

			$prod_sql="SELECT d.item_number_id,c.bundle_no,a.po_break_down_id, c.color_size_break_down_id,  d.color_number_id, d.size_number_id,e.job_no,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.production_qnty else 0 end),0) as cutting_qnty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.reject_qty else 0 end),0) as reject_qty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.replace_qty else 0 end),0) as replace_qnty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.production_qnty else 0 end),0) as cutting_qnty_qc,
				nvl(sum(case when a.production_type ='2' and a.embel_name=1 then c.production_qnty else 0 end),0) as printing_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=1 then c.production_qnty else 0 end),0) as printreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=2 then c.production_qnty else 0 end),0) as emb_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=2 then c.production_qnty else 0 end),0) as embreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=3 then c.production_qnty else 0 end),0) as wash_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=3 then c.production_qnty else 0 end),0) as washreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=4 then c.production_qnty else 0 end),0) as sp_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=4 then c.production_qnty else 0 end),0) as spreceived_qnty,
				nvl(sum(case when a.production_type ='4' and c.production_type ='4' then c.production_qnty else 0 end),0) as sewingin_qnty,
				nvl(sum(case when a.production_type ='5' and c.production_type ='5' then c.production_qnty else 0 end),0) as sewingout_qnty,
				nvl(sum(case when a.production_type ='5' and c.production_type ='5' then c.reject_qty else 0 end),0) as sewing_reject,
				nvl(sum(case when a.production_type ='6' and c.production_type ='6' then c.production_qnty else 0 end),0) as finishin_qnty,
				nvl(sum(case when a.production_type ='7' and c.production_type ='7' then c.production_qnty else 0 end),0) as iron_qnty,
				nvl(sum(case when a.production_type ='8'  and c.production_type ='8' then c.production_qnty else 0 end),0) as finish_qnty,
				nvl(sum(case when a.production_type ='11' and c.production_type ='11' then c.production_qnty else 0 end),0) as poly_qty,
				nvl(sum(case when a.production_type ='11' and c.production_type ='11' then c.production_qnty else 0 end),0) as poly_qty,

				nvl(sum(case when a.production_type ='15' and c.production_type ='15' then c.production_qnty else 0 end),0) as hangtag_qty,

				nvl(sum(case when a.production_type ='11' and c.production_type ='11' then c.reject_qty else 0 end),0) as poly_reject,
				nvl(sum(case when a.production_type ='80' and c.production_type ='80' then c.production_qnty else 0 end),0) as finishing_qty,
				nvl(sum(CASE WHEN a.production_type ='10' and a.trans_type =5 THEN c.production_qnty ELSE 0 END),0) AS trans_in_qty,
				nvl(sum(CASE WHEN a.production_type ='10' and a.trans_type =6 THEN c.production_qnty ELSE 0 END),0) AS trans_out_qty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c ,wo_po_color_size_breakdown d, wo_po_details_master e
			where
				a.id=c.mst_id  and c.color_size_break_down_id=d.id and d.job_id=e.id $po_break_down_id_cond  $cbo_style_owner_wise_status_cond $txt_style_ref_id_cond and a.PO_BREAK_DOWN_ID=d.PO_BREAK_DOWN_ID
			and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and e.status_active=1 and e.is_deleted=0   $txt_datefrom_to_cond_prod $colorBreakDownId_cond   $internal_ref_cond_prod
			group by d.item_number_id,a.po_break_down_id, c.color_size_break_down_id, d.color_number_id, d.size_number_id,e.job_no,e.style_ref_no, c.bundle_no order by  d.size_number_id";

		}
		// echo $prod_sql;die;
		$prod_sql_res = sql_select($prod_sql);
		$prod_color_size_data=array();
		$has_cut_qty = count($color_size_cut_qnty);
		foreach($prod_sql_res as $row)
		{
			if (!$has_cut_qty){
				$color_size_cut_qnty[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantityCutting']+=$row[csf("cutting_qnty")];
			}


			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_cutting']+=$row[csf("cutting_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['reject_qty']+=$row[csf("reject_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['replace_qnty']+=$row[csf("replace_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_qc']+=$row[csf("cutting_qnty_qc")];//+$row[csf("replace_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_toprint']+=$row[csf("printing_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_fromprint']+=$row[csf("printreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_toemb']+=$row[csf("emb_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_fromemb']+=$row[csf("embreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_to_spwork']+=$row[csf("sp_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_from_spwork']+=$row[csf("spreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_swinput']+=$row[csf("sewingin_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_swoutput']+=$row[csf("sewingout_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['sewing_reject']+=$row[csf("sewing_reject")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_poly']+=$row[csf("poly_qty")];

			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_hangtag']+=$row[csf("hangtag_qty")];

			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['poly_reject']+=$row[csf("poly_reject")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_packing']+=$row[csf("finish_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_finishing_qty']+=$row[csf("finishing_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_washreceived']+=$row[csf("washreceived_qnty")];

			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['trans_in_qty']+=$row[csf("trans_in_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['trans_out_qty']+=$row[csf("trans_out_qty")];

		}
		/* 	echo "<pre>";
		print_r($color_size_cut_qnty);
		echo "</pre>";die;
			 */

		?>
		<div id="scroll_body" style="overflow-y: scroll; width: 900px; overflow-x: auto;">
		<!--<div style="width:700px" align="center" id="scroll_body"> -->
	  	<legend>Color and Size</legend>

	    <?
		$size_Arr_library=return_library_array( "SELECT id,size_name from lib_size", "id", "size_name" );
		//$count = count($size_library);
		//$width= $count*70+350;

		foreach($color_size_data as $item_id=>$item_data)
		{
			foreach($item_data as $color=>$color_data)
			{
				foreach ($color_data as $style => $value)
				{
					$size_ids=rtrim($value['size'],',');
					$color_size_ids=array_unique(explode(',',$size_ids));
					$pubshipdate=implode(", ",array_filter(array_unique(explode(',',$value['shipdate']))));
					// $color_size_qnty[$row[csf("color_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['style_ref']
					?>
					<div style="width: 100%; margin: 0 auto; padding: 10px;clear: both;">

					 	<table id="" class="rpt_table" width="<? echo $width; ?>" border="1" rules="all" >
					 		<caption><h2>Colour: <? echo $color_Arr_library[$color]; ?> / <? echo $garments_item[$item_id] ;?></h2></caption>
						 	<thead>
					        	<tr>
					            	<th width="100">Style</th>
					                <th width="170">Size</th>
					 				<?
									foreach($color_size_ids as $sizeRes)
									{
									 	?><th width="80"><p><? echo $size_Arr_library[$sizeRes]; ?>&nbsp;</p></th><?
									}
									?>
					     		    <th width="60">Total Qty</th>
					           </tr>
					        </thead>

					        <tr>
					            <td rowspan="32"><? echo "JOB No: ".$style; ?><br /><br /><? echo "Style Ref. : ".$job_libr[$style]['style']; ?><br /><br /><? echo "Buyer : ".$job_libr[$style]['buyer']; ?><br /><br /><? echo "Pub. Ship Date : ".$pubshipdate; ?></td>
					            <td>Order Quantity</td>
					            <?
									$tot_po_size_qnty=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qnty+=$po_size_qnty;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty); ?></td>
					        </tr>
					        <tr>
					            <td>Plan To Cut</td>
					             <?
									$tot_po_size_qnty_plan_cut=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_plan_cut=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity_plan_cut'];
										$tot_po_size_qnty_plan_cut+=$po_size_qnty_plan_cut;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_plan_cut); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_plan_cut); ?></td>
					        </tr>
					        <tr>
					            <td>Cutting </td>
					            <?
									$tot_po_size_qnty_cutting=0;
									foreach($color_size_ids as $sizeRes)
									{
										// $po_size_qnty_cutting=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);  color_size_data
										$po_size_qnty_cutting=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$tot_po_size_qnty_cutting+=$po_size_qnty_cutting;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty_cutting); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_cutting); ?></td>
					        </tr>
					        <tr>
					            <td>Cutting Balance</td>
					            <?
									$tot_po_size_qnty_cutting_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
									    // $cuting_qc_blnc=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);
									  	$cuting_qc_blnc=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$cutting_plan2cut_blnc=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity_plan_cut'];
										// $cuting_qc_blnc=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting'];
										// $cutting_plan2cut_blnc=$color_size_qnty[$color][$style][$sizeRes]['quantity_plan_cut'];
										$cuting_qc_blnc_qty=$cutting_plan2cut_blnc-$cuting_qc_blnc;
										$tot_po_size_qnty_cutting_blnc+=$cuting_qc_blnc_qty;
										if($cuting_qc_blnc_qty<0)
										{
											$cuting_qc_blnc_qty=abs($cuting_qc_blnc_qty);
											$cuting_qc_blnc_qty='('.number_format($cuting_qc_blnc_qty).')'; $bg_tdColor='red';
										}
										else
										{
											$cuting_qc_blnc_qty=$cuting_qc_blnc_qty;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $cuting_qc_blnc_qty ?></td><?
									}
									if($tot_po_size_qnty_cutting_blnc<0)
										{
											$tot_po_size_qnty_cutting_blnc=abs($tot_po_size_qnty_cutting_blnc);
											$tot_po_size_qnty_cutting_blnc='('.number_format($tot_po_size_qnty_cutting_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_cutting_blnc=$tot_po_size_qnty_cutting_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_cutting_blnc; ?></td>
					        </tr>
					        <tr>
					            <td>Cutting QC</td>
					            <?
									$tot_po_size_qnty_qc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										$tot_po_size_qnty_qc+=$po_size_qnty_qc;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_qc); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_qc); ?></td>
					        </tr>
					        <tr>
					            <td>Cutting QC  Balance</td>
					            <?
									$tot_po_size_qnty_qc_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										//$po_size_qnty_cutting=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);
										$po_size_qnty_cutting=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$po_size_qnty_qc_blnc=$po_size_qnty_cutting-$po_size_qnty_qc;
										$tot_po_size_qnty_qc_blnc+=$po_size_qnty_qc_blnc;

										if($po_size_qnty_qc_blnc<0)
										{
											$po_size_qnty_qc_blnc=abs($po_size_qnty_qc_blnc);
											$po_size_qnty_qc_blnc='('.number_format($po_size_qnty_qc_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_qc_blnc=$po_size_qnty_qc_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_qc_blnc; ?></td><?
									}
									if($tot_po_size_qnty_qc_blnc<0)
										{
											$tot_po_size_qnty_qc_blnc=abs($tot_po_size_qnty_qc_blnc);
											$tot_po_size_qnty_qc_blnc='('.number_format($tot_po_size_qnty_qc_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_qc_blnc=$tot_po_size_qnty_qc_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_qc_blnc; ?></td>
					        </tr>
					        <tr>
					            <td>Send To print </td>
					             <?
									$tot_po_size_qnty_to_print=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toprint'];
										$tot_po_size_qnty_to_print+=$po_size_qnty_to_print;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty_to_print); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_to_print); ?></td>
					        </tr>
					        <tr>
					            <td>Receive from Print</td>
					             <?
									$tot_po_size_qnty_from_print=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromprint'];
										$tot_po_size_qnty_from_print+=$po_size_qnty_from_print;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty_from_print); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_from_print); ?></td>
					        </tr>
					      	<tr>
					            <td> Printing Balance </td>
					            <?
									$tot_po_size_qnty_from_print_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromprint'];
										$po_size_qnty_to_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toprint'];
										$po_size_qnty_from_print_blnc=$po_size_qnty_to_print-$po_size_qnty_from_print;
										$tot_po_size_qnty_from_print_blnc+=$po_size_qnty_from_print_blnc;

										if($po_size_qnty_from_print_blnc<0)
										{
											$po_size_qnty_from_print_blnc=abs($po_size_qnty_from_print_blnc);
											$po_size_qnty_from_print_blnc='('.number_format($po_size_qnty_from_print_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_print_blnc=$po_size_qnty_from_print_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_from_print_blnc; ?></td><?
									}
									if($tot_po_size_qnty_from_print_blnc<0)
										{
											$tot_po_size_qnty_from_print_blnc=abs($tot_po_size_qnty_from_print_blnc);
											$tot_po_size_qnty_from_print_blnc='('.number_format($tot_po_size_qnty_from_print_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_print_blnc=$tot_po_size_qnty_from_print_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_from_print_blnc; ?></td>
					        </tr>
					        <tr>
					            <td>Send To Embroiedery </td>
					            <?
									$tot_po_size_qnty_to_emb=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toemb'];
										$tot_po_size_qnty_to_emb+=$po_size_qnty_to_emb;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_to_emb); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_to_emb); ?></td>
					        </tr>
					        <tr>
					            <td>Receive from Embroiedery</td>
					           		<?
									$tot_po_size_qnty_from_emb=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromemb'];
										$tot_po_size_qnty_from_emb+=$po_size_qnty_from_emb;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_from_emb); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_from_emb); ?></td>
					        </tr>
					         <tr>
					            <td>Embroiedery Balance </td>
					            <?
									$tot_po_size_qnty_from_emb_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromemb'];
										$po_size_qnty_to_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toemb'];
										$po_size_qnty_from_emb_blnc=$po_size_qnty_to_emb-$po_size_qnty_from_emb ;
										$tot_po_size_qnty_from_emb_blnc+=$po_size_qnty_from_emb_blnc;

										if($po_size_qnty_from_emb_blnc<0)
										{
											$po_size_qnty_from_emb_blnc=abs($po_size_qnty_from_emb_blnc);
											$po_size_qnty_from_emb_blnc='('.number_format($po_size_qnty_from_emb_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_emb_blnc=$po_size_qnty_from_emb_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_from_emb_blnc; ?></td><?
									}
									if($tot_po_size_qnty_from_emb_blnc<0)
										{
											$tot_po_size_qnty_from_emb_blnc=abs($tot_po_size_qnty_from_emb_blnc);
											$tot_po_size_qnty_from_emb_blnc='('.number_format($tot_po_size_qnty_from_emb_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_emb_blnc=$tot_po_size_qnty_from_emb_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_from_emb_blnc; ?></td>
					        </tr>
					         <tr>
					            <td>Send To Special Work </td>
					            	<?
									$tot_po_size_qnty_to_spwork=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_spwork=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_to_spwork'];
										$tot_po_size_qnty_to_spwork+=$po_size_qnty_to_spwork;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_to_spwork); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_to_spwork); ?></td>
					        </tr>
					         <tr>
					            <td>Receive From Special Work </td>
					            	<?
									$tot_po_size_qnty_from_spwork=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_spwork=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_from_spwork'];
										$tot_po_size_qnty_from_spwork+=$po_size_qnty_from_spwork;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty_from_spwork); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_from_spwork); ?></td>
					        </tr>
					      	<tr>
					            <td> Special Work  Balance </td>
					            <?
									//$tot_po_size_qnty_from_spwork_blncs=0;
									foreach($color_size_ids as $sizeRes)
									{


										$po_size_qnty_from_spworks=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_from_spwork'];
										$po_size_qnty_to_spworks=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_to_spwork'];
										$po_size_qnty_from_spwork_blnc=$po_size_qnty_from_spworks-$po_size_qnty_to_spworks;
										//$tot_po_size_qnty_from_spwork_blncs=+$po_size_qnty_from_spwork_blnc;

										if($po_size_qnty_from_spwork_blnc<0)
										{
											$po_size_qnty_from_spwork_blnc=abs($po_size_qnty_from_spwork_blnc);
											$po_size_qnty_from_spwork_blnc='('.number_format($po_size_qnty_from_spwork_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_spwork_blnc=$po_size_qnty_from_spwork_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80"  style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_from_spwork_blnc; ?></td><?
									}
									$tot_po_size_qnty_from_spwork_blncs=$tot_po_size_qnty_from_spwork-$tot_po_size_qnty_to_spwork;
									if($tot_po_size_qnty_from_spwork_blncs<0)
										{
											$tot_po_size_qnty_from_spwork_blncs=abs($tot_po_size_qnty_from_spwork_blncs);
											$tot_po_size_qnty_from_spwork_blncs='('.number_format($tot_po_size_qnty_from_spwork_blncs).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_spwork_blncs=$tot_po_size_qnty_from_spwork_blncs;$bg_tdColor='';
										}
									?>
					            <td align="center"  style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_from_spwork_blncs; ?></td>
					        </tr>
					        <tr>
					            <td>Sewing Input</td>
					            <?
									$tot_po_size_qnty_swinput=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swinput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$tot_po_size_qnty_swinput+=$po_size_qnty_swinput;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_swinput); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_swinput); ?></td>
					        </tr>
					        <tr>
					            <td>Input Balance </td>
					             <?
									$tot_po_size_qnty_swinput_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swinput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										$po_size_qnty_swinput_blnc=$po_size_qnty_qc-$po_size_qnty_swinput;


										$tot_po_size_qnty_swinput_blnc+=$po_size_qnty_swinput_blnc;

										if($po_size_qnty_swinput_blnc<0)
										{
											$po_size_qnty_swinput_blnc=abs($po_size_qnty_swinput_blnc);
											$po_size_qnty_swinput_blnc='('.number_format($po_size_qnty_swinput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_swinput_blnc=$po_size_qnty_swinput_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_swinput_blnc; ?></td><?
									}
									if($tot_po_size_qnty_swinput_blnc<0)
										{
											$tot_po_size_qnty_swinput_blnc=abs($tot_po_size_qnty_swinput_blnc);
											$tot_po_size_qnty_swinput_blnc='('.number_format($tot_po_size_qnty_swinput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_swinput_blnc=$tot_po_size_qnty_swinput_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_swinput_blnc; ?></td>
					        </tr>
					        <tr>
					            <td>Sewing Output</td>
					            	<?
									$tot_po_size_qnty_swoutput=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swoutput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput'];
										$tot_po_size_qnty_swoutput+=$po_size_qnty_swoutput;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_swoutput); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_swoutput); ?></td>
					        </tr>
					        <tr>
					            <td>Sewing Reject</td>
					            	<?
									$tot_po_size_qnty_reject=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_sew_rej=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['sewing_reject'];
										$tot_po_size_qnty_reject+=$po_size_qnty_sew_rej;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_sew_rej); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_reject); ?></td>
					        </tr>
					        <tr>
					            <td>Sewing Balance </td>
					            	<?
									$tot_po_size_qnty_swoutput_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swoutput_blnc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput']; ////
										$po_size_qnty_swoutput_rej = $color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['sewing_reject'];
										$po_size_qnty_swinput_blnc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];

										$po_size_qnty_swoutput_blnc=$po_size_qnty_swinput_blnc-($po_size_qnty_swoutput_blnc+$po_size_qnty_swoutput_rej);
										$tot_po_size_qnty_swoutput_blnc+=$po_size_qnty_swoutput_blnc;

										if($po_size_qnty_swoutput_blnc<0)
										{
											$po_size_qnty_swoutput_blnc=abs($po_size_qnty_swoutput_blnc);
											$po_size_qnty_swoutput_blnc='('.number_format($po_size_qnty_swoutput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_swoutput_blnc=$po_size_qnty_swoutput_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_swoutput_blnc; ?></td><?
									}
									if($tot_po_size_qnty_swoutput_blnc<0)
										{
											$tot_po_size_qnty_swoutput_blnc=abs($tot_po_size_qnty_swoutput_blnc);
											$tot_po_size_qnty_swoutput_blnc='('.number_format($tot_po_size_qnty_swoutput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_swoutput_blnc=$tot_po_size_qnty_swoutput_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_swoutput_blnc; ?></td>
					        </tr>
							<tr>
					            <td>Finishing</td>
					            	<?
									$tot_po_size_qnty_finishing=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_finishing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_finishing_qty'];
										$tot_po_size_qnty_finishing+=$po_size_qnty_finishing;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_finishing); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_finishing); ?></td>
					        </tr>
							<tr>
					            <td>Finishing Balance  </td>
					            <?
									$tot_po_size_qnty_finishing_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_finishing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_finishing_qty'];
										$po_size_qnty_washreceived=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_washreceived'];
										$po_size_qnty_finishing_blnc=$po_size_qnty_washreceived-$po_size_qnty_finishing;
										$tot_po_size_qnty_finishing_blnc+=$po_size_qnty_finishing_blnc;

										if($po_size_qnty_finishing_blnc<0)
										{
											$po_size_qnty_finishing_blnc=abs($po_size_qnty_finishing_blnc);
											$po_size_qnty_finishing_blnc='('.number_format($po_size_qnty_finishing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_finishing_blnc=$po_size_qnty_finishing_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_finishing_blnc; ?></td><?
									}
									if($tot_po_size_qnty_finishing_blnc<0)
										{
											$tot_po_size_qnty_finishing_blnc=abs($tot_po_size_qnty_finishing_blnc);
											$tot_po_size_qnty_finishing_blnc='('.number_format($tot_po_size_qnty_finishing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_finishing_blnc=$tot_po_size_qnty_finishing_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_finishing_blnc; ?></td>
					        </tr>
							<tr>
					            <td>Hang Tag</td>
					            	<?
									$tot_po_size_qnty_hangtag=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_hangtag=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_hangtag'];
										$tot_po_size_qnty_hangtag+=$po_size_qnty_hangtag;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_hangtag); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_hangtag); ?></td>
					        </tr>

					         <tr>
					            <td>Poly</td>
					            	<?
									$tot_po_size_qnty_poly=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										$tot_po_size_qnty_poly+=$po_size_qnty_poly;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_poly); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_poly); ?></td>
					        </tr>
							<tr>
					            <td>Poly Reject</td>
					            	<?
									$tot_po_size_qnty_poly_reject=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_poly_reject=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['poly_reject'];
										$tot_po_size_qnty_poly_reject+=$po_size_qnty_poly_reject
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_poly_reject); ?></td><?

									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_poly_reject); ?></td>
					        </tr>
					       	<tr>
					            <td>Poly Balance  </td>
					            <?
									$tot_po_size_qnty_poly_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swinput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										$po_size_qnty_poly_reject=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['poly_reject'];
										// $po_size_qnty_swoutput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput'];
										$po_size_qnty_poly_blnc=$po_size_qnty_swinput-$po_size_qnty_poly-$po_size_qnty_poly_reject;
										$tot_po_size_qnty_poly_blnc+=$po_size_qnty_poly_blnc;

										if($po_size_qnty_poly_blnc<0)
										{
											$po_size_qnty_poly_blnc=abs($po_size_qnty_poly_blnc);
											$po_size_qnty_poly_blnc='('.number_format($po_size_qnty_poly_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_poly_blnc=$po_size_qnty_poly_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_poly_blnc; ?></td><?
									}
									if($tot_po_size_qnty_poly_blnc<0)
										{
											$tot_po_size_qnty_poly_blnc=abs($tot_po_size_qnty_poly_blnc);
											$tot_po_size_qnty_poly_blnc='('.number_format($tot_po_size_qnty_poly_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_poly_blnc=$tot_po_size_qnty_poly_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_poly_blnc; ?></td>
					        </tr>
					         <tr>
					            <td>Packing </td>
					            <?
									$tot_po_size_qnty_packing=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_packing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_packing']+$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['trans_in_qty']-$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['trans_out_qty'];
										$tot_po_size_qnty_packing+=$po_size_qnty_packing;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_packing); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_packing); ?></td>
					        </tr>
					         <tr>
					            <td>Packing Balance </td>
					           <?
									$tot_po_size_qnty_packing_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_packing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_packing']+$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['trans_in_qty']-$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['trans_out_qty'];
		//										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
		//										$po_size_qnty_packing_blnc=$po_size_qnty_poly-$po_size_qnty_packing;
                                        $po_size_qnty_swoutput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput'];
                                        $po_size_qnty_packing_blnc=$po_size_qnty_swoutput-$po_size_qnty_packing;

                                        $tot_po_size_qnty_packing_blnc+=$po_size_qnty_packing_blnc;


										if($po_size_qnty_packing_blnc<0)
										{
											$po_size_qnty_packing_blnc=abs($po_size_qnty_packing_blnc);
											$po_size_qnty_packing_blnc='('.number_format($po_size_qnty_packing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_packing_blnc=$po_size_qnty_packing_blnc;$bg_tdColor='';
										}

									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_packing_blnc; ?></td><?
									}

									if($tot_po_size_qnty_packing_blnc<0)
										{
											$tot_po_size_qnty_packing_blnc=abs($tot_po_size_qnty_packing_blnc);
											$tot_po_size_qnty_packing_blnc='('.number_format($tot_po_size_qnty_packing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_packing_blnc=$tot_po_size_qnty_packing_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_packing_blnc; ?></td>
					        </tr>
					         <tr>
					            <td>Ex Factory</td>
					             <?
									$tot_po_size_qnty_exfact=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$tot_po_size_qnty_exfact+=$po_size_qnty_exfact;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_exfact); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_exfact); ?></td>
					        </tr>
					        <tr>
					            <td>Ex- Factory Balance </td>
					             <?
									$tot_po_size_qnty_exfact_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc=($po_size_qnty-$po_size_qnty_exfact);
										$tot_po_size_qnty_exfact_blnc+=$po_size_qnty_exfact_blnc;

										if($po_size_qnty_exfact_blnc<0)
										{
											$po_size_qnty_exfact_blnc=abs($po_size_qnty_exfact_blnc);
											$po_size_qnty_exfact_blnc='('.number_format($po_size_qnty_exfact_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_exfact_blnc=$po_size_qnty_exfact_blnc;$bg_tdColor='';
										}

									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_exfact_blnc; ?></td><?
									}

									if($tot_po_size_qnty_exfact_blnc<0)
										{
											$tot_po_size_qnty_exfact_blnc=abs($tot_po_size_qnty_exfact_blnc);
											$tot_po_size_qnty_exfact_blnc='('.number_format($tot_po_size_qnty_exfact_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_blnc=$tot_po_size_qnty_exfact_blnc;$bg_tdColor='';
										}

									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>">
								<?

									echo $tot_po_size_qnty_exfact_blnc;
								?>
					            </td>
					        </tr>


					        <tr>
					            <td title="Poly Qty - Ex-factory Qty">FG Stock in Hand </td>
					             <?
									$tot_po_size_qnty_fg=0;
									foreach($color_size_ids as $sizeRes)
									{
										//$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										//$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];

										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];

										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];



										$tot_po_size_qnty_fg+=$po_size_qnty_poly - $po_size_qnty_exfact;
									 	?><td align="center" width="80"><? echo number_format(($po_size_qnty_poly - $po_size_qnty_exfact)); ?></td><?
									}

									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>">
								<?

									echo $tot_po_size_qnty_fg;
								?>
					            </td>
					        </tr>


					         <tr>
								<!-- <td></td> -->
					            <td>Ex- Factory Balance % </td>
					             <?
									$tot_po_size_qnty_exfact_blnc_prcn=0; $tot_po_size_qnty_exfact_blnc2=0;$tot_po_size_qnty2=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_exfact_perc=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$po_size_qnty_perc=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc=($po_size_qnty_perc-$po_size_qnty_exfact_perc);
										$exfact_size_bal_perc_sum=($po_size_qnty_exfact_blnc/$po_size_qnty_perc)*100;

										// for total
										$po_size_qnty_exfact2=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$po_size_qnty2=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc2=($po_size_qnty2-$po_size_qnty_exfact2);
										$tot_po_size_qnty_exfact_blnc2+=$po_size_qnty_exfact_blnc2;

										$po_size_qnty2=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qnty2+=$po_size_qnty2;
										//
										//$tot_po_size_qnty_exfact_blnc_prcn+=$exfact_size_bal_perc_sum;
										if($exfact_size_bal_perc_sum<0)
										{
											$exfact_size_bal_perc_sum=abs($exfact_size_bal_perc_sum);
											$exfact_size_bal_perc_sum='('.number_format($exfact_size_bal_perc_sum,2).')'; $bg_tdColor='red';
										}
										else
										{
											$exfact_size_bal_perc_sum=number_format($exfact_size_bal_perc_sum,2);$bg_tdColor='';
										}
									 	?><td align="center" width="80 " style="color:<? echo $bg_tdColor; ?>"><? echo $exfact_size_bal_perc_sum; ?></td><?
									}

									  	$tot_po_size_qnty_exfact_blnc_prcn=($tot_po_size_qnty_exfact_blnc2/$tot_po_size_qnty2)*100;
										if($tot_po_size_qnty_exfact_blnc_prcn<0)
										{

											$tot_po_size_qnty_exfact_blnc_prcn=abs($tot_po_size_qnty_exfact_blnc_prcn);
											$tot_po_size_qnty_exfact_blnc_prcn='('.number_format($tot_po_size_qnty_exfact_blnc_prcn,2).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_blnc_prcn=number_format($tot_po_size_qnty_exfact_blnc_prcn,2);$bg_tdColor='';
										}


								?>

					            <td align="center" style="color:<? echo $bg_tdColor; ?>">
									<? echo $tot_po_size_qnty_exfact_blnc_prcn; ?>
					            </td>
					        </tr>
					        <tr>
								<!-- <td></td> -->
					            <td>Ex- Factory  % </td>
					             <?
									$tot_po_size_qnty_exfact_perc=0;$tot_po_size_qnty_exfact2=0;$tot_po_size_qntyy=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$result_exfactPerc=($po_size_qnty_exfact/$po_size_qnty)*100;
										$tot_po_size_qnty_exfact_perc+=$result_exfactPerc;


										//

										$po_size_qnty_exfact2=$ex_fact_qty_arr[$color][$item_id][$sizeRes][$style]['ex_fact_qty'];
										$tot_po_size_qnty_exfact2+=$po_size_qnty_exfact2;

										$po_size_qntyy=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qntyy+=$po_size_qntyy;
										//



										if($result_exfactPerc<0)
										{
											$result_exfactPerc=abs($result_exfactPerc);
											$result_exfactPerc='('.$result_exfactPerc.')'; $bg_tdColor='red';
										}
										else
										{
											$result_exfactPerc=$result_exfactPerc;$bg_tdColor='';
										}
									 	?><td align="center" width="80"><? echo  number_format($result_exfactPerc,2); ?></td><?
									}
									$tot_po_size_qnty_exfact_perc=($tot_po_size_qnty_exfact2/$tot_po_size_qntyy)*100;
									if($tot_po_size_qnty_exfact_perc<0)
										{
											$tot_po_size_qnty_exfact_perc=abs($tot_po_size_qnty_exfact_perc);
											$tot_po_size_qnty_exfact_perc='('.$tot_po_size_qnty_exfact_perc.')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_perc=$tot_po_size_qnty_exfact_perc;$bg_tdColor='';
										}
									?>
					            <td align="center"><? echo  number_format($tot_po_size_qnty_exfact_perc,2); ?></td>
					        </tr>

					 	</table>
					 </div>
				 	<?
				}
			}
		}
		?>
		</div>


		<?
	}
	else  if($type==33) //color and size wise backup
	{
		//report size and color wise kaiyum
		if($txt_datefrom!="" &&  $txt_dateto!="")  $po_conds=" and  pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		$all_po_id_sql= sql_select("SELECT id from wo_po_break_down where status_active in(1,2,3) and is_deleted=0 $po_conds");
		foreach($all_po_id_sql as $keys=>$values)
		{
 			$all_po_id_arr[$values[csf("id")]]=$values[csf("id")];
		}
	   $all_po_ids=implode(",", $all_po_id_arr);
	   $all_po_ids_cond="";

	   if(count($all_po_id_arr)>0)
	   {
		   	if($db_type==2 && count($all_po_id_arr)>999)
		    {
		   		$chunk_arr=array_chunk($all_po_id_arr, 999);
		   		foreach($chunk_arr as $vals)
		   		{
		   			$po_ids=implode(",", $vals);
		   			if($all_po_ids_cond=="")
		   			{
		   				$all_po_ids_cond.=" and (a.order_id in ($po_ids)";
		   			}
		   			else
		   			{
		   				$all_po_ids_cond.=" or  a.order_id in ($po_ids)";
		   			}
		   		}
		   		$all_po_ids_cond.= " )";
		   }
		   else
		   {
		   		$all_po_ids_cond= " and a.order_id in($all_po_ids) ";
		   }
	   }

		$po_break_down_id=$txt_order_id ; // 25434
		$company_name=$cbo_company_name;
		if ($txt_style_ref_number!="")
		{
			$txt_style_ref_number_cond="and e.style_ref_no like '%$txt_style_ref_number%'";
		}
		else
		{
			$txt_style_ref_number_cond="";
		}
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$cbo_job_year_cond =" and year(e.insert_date)='$cbo_job_year'";
			}
			else
			{
				$cbo_job_year_cond =" and to_char(e.insert_date,'YYYY')='$cbo_job_year'";
			}
		}

		if($txt_style_ref_id!="")
		{
			$txt_style_ref_id_cond=" and e.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$txt_style_ref_id_cond =" and e.job_no_prefix_num='$txt_style_ref'";
		}

		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.company_name=$cbo_company_name";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$shipping_status_cond =" and d.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$shipping_status_cond =" and d.shiping_status in(1,2)";
			}
			else
			{
				$shipping_status_cond =" and d.shiping_status in(1,2,3)";
			}
		}
		if($po_break_down_id!="" )  $po_break_down_id_cond =" and a.po_break_down_id in (".$po_break_down_id.") ";
		if($po_break_down_id!="" )  $po_break_down_id_cond_cut =" and a.order_id in (".$po_break_down_id.") ";  // for cut lay qnty
		if($cbo_buyer_name!=0 )  $cbo_buyer_name_cond =" and e.buyer_name =$cbo_buyer_name";
		if($cbo_location!=0 )  $cbo_location_cond =" and e.location_name =$cbo_location";

		if($txt_datefrom!="" &&  $txt_dateto!="")  $txt_datefrom_to_cond =" and d.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($txt_datefrom!="" &&  $txt_dateto!="")  $txt_datefrom_to_cond_prod =" and a.production_date between '$txt_datefrom' and '$txt_dateto'";

		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and d.grouping=$txt_internal_ref ";

		$color_variable_setting=return_field_value("ex_factory","variable_settings_production","company_name='$company_name' and variable_list=1 and status_active=1 and is_deleted=0","ex_factory");
		$color_variable_setting = ($color_variable_setting==0) ? 3 : $color_variable_setting;

		$ex_fact_qty_arr=array();
		if($color_variable_setting==2 || $color_variable_setting==3)
		{
			//echo	$sql_exfect="select c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c,wo_po_details_master e where a.id=b.mst_id and b.color_size_break_down_id=c.id $po_break_down_id_cond_2 $txt_style_ref_number_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond and a.status_active=1 and a.is_deleted=0  and c.job_no_mst=e.job_no group by  c.color_number_id, c.size_number_id";
			$sql_exfect="SELECT a.item_number_id, a.color_number_id, a.size_number_id, sum(y.production_qnty) as production_qnty from pro_ex_factory_mst x,pro_ex_factory_dtls y,wo_po_color_size_breakdown a,wo_po_break_down d,wo_po_details_master e
			where  x.id=y.mst_id and y.color_size_break_down_id=a.id and x.status_active=1 and x.is_deleted=0 and y.status_active=1 and y.is_deleted=0  and a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and e.company_name=$cbo_company_name $active_cond_a_d $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond $internal_ref_cond_po group by  a.item_number_id,a.color_number_id,a.size_number_id order by a.size_number_id";

			//echo $sql_exfect."<br>";
			$sql_result_exfact=sql_select($sql_exfect);
			foreach($sql_result_exfact as $row)
			{
				$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("size_number_id")]]['ex_fact_qty']=$row[csf("production_qnty")];
			}
		}
		$color_size_sql=sql_select( "SELECT a.id, e.job_no, a.color_number_id, a.size_number_id,e.style_ref_no,a.order_quantity,a.plan_cut_qnty,a.is_deleted  from wo_po_color_size_breakdown a,wo_po_break_down d,wo_po_details_master e where   a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond  $internal_ref_cond_po and a.status_active=1 and d.status_active=1 and e.status_active=1 and a.is_deleted=0 and d.is_deleted=0 and e.is_deleted=0 order by a.color_order,a.size_order");

		// $color_size_sql=sql_select( "SELECT a.id, e.job_no,a.item_number_id, a.color_number_id, a.size_number_id,e.style_ref_no,a.order_quantity,a.plan_cut_qnty,a.is_deleted  from wo_po_color_size_breakdown a,wo_po_break_down d,wo_po_details_master e where   a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_no_mst=e.job_no and e.company_name=$cbo_company_name $active_cond_a_d   $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond  $internal_ref_cond_po order by a.color_order,a.size_order");

		$color_size_data=array();$color_size_qnty=array();
		foreach($color_size_sql as $row)
		{
			//$test_data[]=$row[csf("color_number_id")];

			if($row[csf("is_deleted")]==0)
			{
				$color_size_data[$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("job_no")]]['size'].= $row[csf("size_number_id")].',';
				$color_size_qnty[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity']+=$row[csf("order_quantity")];
				$color_size_qnty[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_plan_cut']+=$row[csf("plan_cut_qnty")];
			}
			$job_libr[$row[csf("job_no")]]=$row[csf("style_ref_no")];
			$col_size_id.=$row[csf("id")].',';

		}
	 	$colBrekId=rtrim($col_size_id,",");
		$colBrekId_arr=explode(",",$colBrekId);

		  $prod_sql_cut=sql_select("SELECT a.size_id,sum(a.size_qty) as cutlay_qty , b.job_no,c.gmt_item_id, c.color_id
		from ppl_cut_lay_bundle a,ppl_cut_lay_mst b,ppl_cut_lay_dtls c where b.company_id=$cbo_company_name  and a.mst_id=b.id and b.id=c.mst_id     $po_break_down_id_cond_cut $all_po_ids_cond group by c.gmt_item_id,a.mst_id,a.size_id, b.job_no,c.color_id order by a.size_id ");
		$color_size_cut_qnty=array();
		foreach($prod_sql_cut as $row)
		{
			$color_size_cut_qnty[$row[csf("color_id")]][$row[csf("gmt_item_id")]][$row[csf("job_no")]][$row[csf("size_id")]]['quantityCutting']+=$row[csf("cutlay_qty")];
		}

		if($db_type==0)
		{
			$prod_sql="SELECT a.po_break_down_id,d.item_number_id, c.color_size_break_down_id,  d.color_number_id, d.size_number_id,e.style_ref_no, e.job_no,
					IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='1' AND a.entry_break_down_type=3 THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty_qc,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='3' and c.production_type ='3'  AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='4' and c.production_type ='4'  THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='5' and c.production_type ='5'  THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='6' and c.production_type ='6'  THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='7' and c.production_type ='7'  THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='8' and c.production_type ='8'  THEN c.production_qnty ELSE 0 END),0) AS finish_qnty,
					IFNULL(sum(CASE WHEN a.production_type ='11' and c.production_type ='11' THEN c.production_qnty ELSE 0 END),0) AS poly_qty
				from
					pro_garments_production_mst a, pro_garments_production_dtls c ,wo_po_color_size_breakdown d, wo_po_details_master e
				where
					a.id=c.mst_id
					 and c.color_size_break_down_id=d.id and d.job_id=e.id $active_cond_d $po_break_down_id_cond  $cbo_style_owner_wise_status_cond  $txt_style_ref_id_cond $internal_ref_cond_prod
				and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and e.status_active=1 and e.is_deleted=0 and d.status_active=1   $txt_datefrom_to_cond_prod  and d.id in ($colBrekId)
				group by d.item_number_id,a.po_break_down_id, c.color_size_break_down_id, d.color_number_id, d.size_number_id,e.job_no,e.style_ref_no, c.bundle_no order by  d.size_number_id";
		}
		else
		{
			$colBrekId_chunk=array_chunk($colBrekId_arr,999);
			$colorBreakDownId_cond=" and";
			foreach($colBrekId_chunk as $dtls_id)
			{
			if($colorBreakDownId_cond==" and" )  $colorBreakDownId_cond.=" ( d.id in(".implode(',',$dtls_id).")"; else $colorBreakDownId_cond.=" or d.id in(".implode(',',$dtls_id).")";
			}
			$colorBreakDownId_cond.=" )";
			//echo $colorBreakDownId_cond;die;

			$prod_sql="SELECT d.item_number_id,c.bundle_no,a.po_break_down_id, c.color_size_break_down_id,  d.color_number_id, d.size_number_id,e.job_no,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.production_qnty else 0 end),0) as cutting_qnty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.reject_qty else 0 end),0) as reject_qty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.replace_qty else 0 end),0) as replace_qnty,
				nvl(sum(case when a.production_type ='1' and c.production_type ='1' then c.production_qnty else 0 end),0) as cutting_qnty_qc,
				nvl(sum(case when a.production_type ='2' and a.embel_name=1 then c.production_qnty else 0 end),0) as printing_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=1 then c.production_qnty else 0 end),0) as printreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=2 then c.production_qnty else 0 end),0) as emb_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=2 then c.production_qnty else 0 end),0) as embreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=3 then c.production_qnty else 0 end),0) as wash_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=3 then c.production_qnty else 0 end),0) as washreceived_qnty,
				nvl(sum(case when a.production_type ='2' and a.embel_name=4 then c.production_qnty else 0 end),0) as sp_qnty,
				nvl(sum(case when a.production_type ='3' and a.embel_name=4 then c.production_qnty else 0 end),0) as spreceived_qnty,
				nvl(sum(case when a.production_type ='4' and c.production_type ='4' then c.production_qnty else 0 end),0) as sewingin_qnty,
				nvl(sum(case when a.production_type ='5' and c.production_type ='5' then c.production_qnty else 0 end),0) as sewingout_qnty,
				nvl(sum(case when a.production_type ='6' and c.production_type ='6' then c.production_qnty else 0 end),0) as finishin_qnty,
				nvl(sum(case when a.production_type ='7' and c.production_type ='7' then c.production_qnty else 0 end),0) as iron_qnty,
				nvl(sum(case when a.production_type ='8'  and c.production_type ='8' then c.production_qnty else 0 end),0) as finish_qnty,
				nvl(sum(case when a.production_type ='11' and c.production_type ='11' then c.production_qnty else 0 end),0) as poly_qty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c ,wo_po_color_size_breakdown d, wo_po_details_master e
			where
				a.id=c.mst_id  and c.color_size_break_down_id=d.id and d.job_id=e.id $active_cond_d $po_break_down_id_cond  $cbo_style_owner_wise_status_cond $txt_style_ref_id_cond and a.PO_BREAK_DOWN_ID=d.PO_BREAK_DOWN_ID
			and c.status_active=1 and c.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and e.status_active=1 and e.is_deleted=0 and d.status_active=1  $txt_datefrom_to_cond_prod $colorBreakDownId_cond   $internal_ref_cond_prod
			group by d.item_number_id,a.po_break_down_id, c.color_size_break_down_id, d.color_number_id, d.size_number_id,e.job_no,e.style_ref_no, c.bundle_no order by  d.size_number_id";
		}
		// echo $prod_sql;
		$prod_sql_res = sql_select($prod_sql);
		$prod_color_size_data=array();
		foreach($prod_sql_res as $row)
		{
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_cutting']+=$row[csf("cutting_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['reject_qty']+=$row[csf("reject_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['replace_qnty']+=$row[csf("replace_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_qc']+=$row[csf("cutting_qnty_qc")];//+$row[csf("replace_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_toprint']+=$row[csf("printing_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_fromprint']+=$row[csf("printreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_toemb']+=$row[csf("emb_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_fromemb']+=$row[csf("embreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_to_spwork']+=$row[csf("sp_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_from_spwork']+=$row[csf("spreceived_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_swinput']+=$row[csf("sewingin_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_swoutput']+=$row[csf("sewingout_qnty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_poly']+=$row[csf("poly_qty")];
			$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("item_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['quantity_packing']+=$row[csf("finish_qnty")];
			//$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("style_ref_no")]][$row[csf("size_number_id")]]['quantity_exfact']+=$row[csf("finish_qnty")];
		}
		// echo "<pre>";
		// print_r($color_size_qnty_prod);
		// echo "</pre>";


		?>
		<div id="scroll_body" style="overflow-y: scroll; width: 900px; overflow-x: auto;">
		<!--<div style="width:700px" align="center" id="scroll_body"> -->
	  	<legend>Color and Size</legend>

	    <?
		$size_Arr_library=return_library_array( "SELECT id,size_name from lib_size", "id", "size_name" );
		//$count = count($size_library);
		//$width= $count*70+350;

		foreach($color_size_data as $item_id=>$item_data)
		{
			foreach($item_data as $color=>$color_data)
			{
				foreach ($color_data as $style => $value)
				{
					$size_ids=rtrim($value['size'],',');
					$color_size_ids=array_unique(explode(',',$size_ids));
					// $color_size_qnty[$row[csf("color_number_id")]][$row[csf("job_no")]][$row[csf("size_number_id")]]['style_ref']
					?>
					<div style="width: 100%; margin: 0 auto; padding: 10px;clear: both;">

					 	<table id="" class="rpt_table" width="<? echo $width; ?>" border="1" rules="all" >
					 		<caption><h2>Colour: <? echo $color_Arr_library[$color]; ?> / <? echo $garments_item[$item_id] ;?></h2></caption>
						 	<thead>
					        	<tr>
					            	<th width="100">Style</th>
					                <th width="170">Size</th>
					 				<?
									foreach($color_size_ids as $sizeRes)
									{
									 	?><th width="80"><p><? echo $size_Arr_library[$sizeRes]; ?>&nbsp;</p></th><?
									}
									?>
					     		    <th width="60">Total Qty</th>
					           </tr>
					        </thead>

					        <tr>
					            <td rowspan="27" align="center"><? echo $style; ?><br /><br /><? echo $job_libr[$style]; ?></td>
					            <td>Order Quantity</td>
					            <?
									$tot_po_size_qnty=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qnty+=$po_size_qnty;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty); ?></td>
					        </tr>
					        <tr>
					            <td>Plan To Cut</td>
					             <?
									$tot_po_size_qnty_plan_cut=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_plan_cut=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity_plan_cut'];
										$tot_po_size_qnty_plan_cut+=$po_size_qnty_plan_cut;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_plan_cut); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_plan_cut); ?></td>
					        </tr>
					        <tr>
					            <td>Cutting </td>
					            <?
									$tot_po_size_qnty_cutting=0;
									foreach($color_size_ids as $sizeRes)
									{
										//$po_size_qnty_cutting=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);  color_size_data
										$po_size_qnty_cutting=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$tot_po_size_qnty_cutting+=$po_size_qnty_cutting;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty_cutting); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_cutting); ?></td>
					        </tr>
					        <tr>
					            <td>Cutting Balance</td>
					            <?
									$tot_po_size_qnty_cutting_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
									  //	$cuting_qc_blnc=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);
									  	$cuting_qc_blnc=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$cutting_plan2cut_blnc=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity_plan_cut'];
										//$cuting_qc_blnc=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting'];
										//$cutting_plan2cut_blnc=$color_size_qnty[$color][$style][$sizeRes]['quantity_plan_cut'];
										$cuting_qc_blnc_qty=$cutting_plan2cut_blnc-$cuting_qc_blnc;
										$tot_po_size_qnty_cutting_blnc+=$cuting_qc_blnc_qty;
										if($cuting_qc_blnc_qty<0)
										{
											$cuting_qc_blnc_qty=abs($cuting_qc_blnc_qty);
											$cuting_qc_blnc_qty='('.number_format($cuting_qc_blnc_qty).')'; $bg_tdColor='red';
										}
										else
										{
											$cuting_qc_blnc_qty=$cuting_qc_blnc_qty;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $cuting_qc_blnc_qty ?></td><?
									}
									if($tot_po_size_qnty_cutting_blnc<0)
										{
											$tot_po_size_qnty_cutting_blnc=abs($tot_po_size_qnty_cutting_blnc);
											$tot_po_size_qnty_cutting_blnc='('.number_format($tot_po_size_qnty_cutting_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_cutting_blnc=$tot_po_size_qnty_cutting_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_cutting_blnc; ?></td>
					        </tr>
					        <tr>
					            <td>Cutting QC</td>
					            <?
									$tot_po_size_qnty_qc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										$tot_po_size_qnty_qc+=$po_size_qnty_qc;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_qc); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_qc); ?></td>
					        </tr>
					        <tr>
					            <td>Cutting QC  Balance</td>
					            <?
									$tot_po_size_qnty_qc_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										//$po_size_qnty_cutting=$color_size_qnty_prod[$color][$style][$sizeRes]['quantity_cutting']+($color_size_qnty_prod[$color][$style][$sizeRes]['reject_qty']-$color_size_qnty_prod[$color][$style][$sizeRes]['replace_qty']);
										$po_size_qnty_cutting=$color_size_cut_qnty[$color][$item_id][$style][$sizeRes]['quantityCutting'];
										$po_size_qnty_qc_blnc=$po_size_qnty_cutting-$po_size_qnty_qc;
										$tot_po_size_qnty_qc_blnc+=$po_size_qnty_qc_blnc;

										if($po_size_qnty_qc_blnc<0)
										{
											$po_size_qnty_qc_blnc=abs($po_size_qnty_qc_blnc);
											$po_size_qnty_qc_blnc='('.number_format($po_size_qnty_qc_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_qc_blnc=$po_size_qnty_qc_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_qc_blnc; ?></td><?
									}
									if($tot_po_size_qnty_qc_blnc<0)
										{
											$tot_po_size_qnty_qc_blnc=abs($tot_po_size_qnty_qc_blnc);
											$tot_po_size_qnty_qc_blnc='('.number_format($tot_po_size_qnty_qc_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_qc_blnc=$tot_po_size_qnty_qc_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_qc_blnc; ?></td>
					        </tr>
					        <tr>
					            <td>Send To print </td>
					             <?
									$tot_po_size_qnty_to_print=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toprint'];
										$tot_po_size_qnty_to_print+=$po_size_qnty_to_print;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty_to_print); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_to_print); ?></td>
					        </tr>
					        <tr>
					            <td>Receive from Print</td>
					             <?
									$tot_po_size_qnty_from_print=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromprint'];
										$tot_po_size_qnty_from_print+=$po_size_qnty_from_print;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty_from_print); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_from_print); ?></td>
					        </tr>
					      	<tr>
					            <td> Printing Balance </td>
					            <?
									$tot_po_size_qnty_from_print_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromprint'];
										$po_size_qnty_to_print=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toprint'];
										$po_size_qnty_from_print_blnc=$po_size_qnty_to_print-$po_size_qnty_from_print;
										$tot_po_size_qnty_from_print_blnc+=$po_size_qnty_from_print_blnc;

										if($po_size_qnty_from_print_blnc<0)
										{
											$po_size_qnty_from_print_blnc=abs($po_size_qnty_from_print_blnc);
											$po_size_qnty_from_print_blnc='('.number_format($po_size_qnty_from_print_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_print_blnc=$po_size_qnty_from_print_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_from_print_blnc; ?></td><?
									}
									if($tot_po_size_qnty_from_print_blnc<0)
										{
											$tot_po_size_qnty_from_print_blnc=abs($tot_po_size_qnty_from_print_blnc);
											$tot_po_size_qnty_from_print_blnc='('.number_format($tot_po_size_qnty_from_print_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_print_blnc=$tot_po_size_qnty_from_print_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_from_print_blnc; ?></td>
					        </tr>
					        <tr>
					            <td>Send To Embroiedery </td>
					            <?
									$tot_po_size_qnty_to_emb=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toemb'];
										$tot_po_size_qnty_to_emb+=$po_size_qnty_to_emb;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_to_emb); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_to_emb); ?></td>
					        </tr>
					        <tr>
					            <td>Receive from Embroiedery</td>
					           		<?
									$tot_po_size_qnty_from_emb=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromemb'];
										$tot_po_size_qnty_from_emb+=$po_size_qnty_from_emb;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_from_emb); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_from_emb); ?></td>
					        </tr>
					         <tr>
					            <td>Embroiedery Balance </td>
					            <?
									$tot_po_size_qnty_from_emb_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_fromemb'];
										$po_size_qnty_to_emb=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_toemb'];
										$po_size_qnty_from_emb_blnc=$po_size_qnty_to_emb-$po_size_qnty_from_emb ;
										$tot_po_size_qnty_from_emb_blnc+=$po_size_qnty_from_emb_blnc;

										if($po_size_qnty_from_emb_blnc<0)
										{
											$po_size_qnty_from_emb_blnc=abs($po_size_qnty_from_emb_blnc);
											$po_size_qnty_from_emb_blnc='('.number_format($po_size_qnty_from_emb_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_emb_blnc=$po_size_qnty_from_emb_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_from_emb_blnc; ?></td><?
									}
									if($tot_po_size_qnty_from_emb_blnc<0)
										{
											$tot_po_size_qnty_from_emb_blnc=abs($tot_po_size_qnty_from_emb_blnc);
											$tot_po_size_qnty_from_emb_blnc='('.number_format($tot_po_size_qnty_from_emb_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_emb_blnc=$tot_po_size_qnty_from_emb_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_from_emb_blnc; ?></td>
					        </tr>
					         <tr>
					            <td>Send To Special Work </td>
					            	<?
									$tot_po_size_qnty_to_spwork=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_to_spwork=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_to_spwork'];
										$tot_po_size_qnty_to_spwork+=$po_size_qnty_to_spwork;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_to_spwork); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_to_spwork); ?></td>
					        </tr>
					         <tr>
					            <td>Receive From Special Work </td>
					            	<?
									$tot_po_size_qnty_from_spwork=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_from_spwork=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_from_spwork'];
										$tot_po_size_qnty_from_spwork+=$po_size_qnty_from_spwork;
									 	?><td width="80" align="center"><? echo number_format($po_size_qnty_from_spwork); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_from_spwork); ?></td>
					        </tr>
					      	<tr>
					            <td> Special Work  Balance </td>
					            <?
									//$tot_po_size_qnty_from_spwork_blncs=0;
									foreach($color_size_ids as $sizeRes)
									{


										$po_size_qnty_from_spworks=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_from_spwork'];
										$po_size_qnty_to_spworks=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_to_spwork'];
										$po_size_qnty_from_spwork_blnc=$po_size_qnty_from_spworks-$po_size_qnty_to_spworks;
										//$tot_po_size_qnty_from_spwork_blncs=+$po_size_qnty_from_spwork_blnc;

										if($po_size_qnty_from_spwork_blnc<0)
										{
											$po_size_qnty_from_spwork_blnc=abs($po_size_qnty_from_spwork_blnc);
											$po_size_qnty_from_spwork_blnc='('.number_format($po_size_qnty_from_spwork_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_from_spwork_blnc=$po_size_qnty_from_spwork_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80"  style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_from_spwork_blnc; ?></td><?
									}
									$tot_po_size_qnty_from_spwork_blncs=$tot_po_size_qnty_from_spwork-$tot_po_size_qnty_to_spwork;
									if($tot_po_size_qnty_from_spwork_blncs<0)
										{
											$tot_po_size_qnty_from_spwork_blncs=abs($tot_po_size_qnty_from_spwork_blncs);
											$tot_po_size_qnty_from_spwork_blncs='('.number_format($tot_po_size_qnty_from_spwork_blncs).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_from_spwork_blncs=$tot_po_size_qnty_from_spwork_blncs;$bg_tdColor='';
										}
									?>
					            <td align="center"  style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_from_spwork_blncs; ?></td>
					        </tr>
					        <tr>
					            <td>Sewing Input</td>
					            <?
									$tot_po_size_qnty_swinput=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swinput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$tot_po_size_qnty_swinput+=$po_size_qnty_swinput;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_swinput); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_swinput); ?></td>
					        </tr>
					        <tr>
					            <td>Input Balance </td>
					             <?
									$tot_po_size_qnty_swinput_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swinput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$po_size_qnty_qc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_qc'];
										$po_size_qnty_swinput_blnc=$po_size_qnty_qc-$po_size_qnty_swinput;


										$tot_po_size_qnty_swinput_blnc+=$po_size_qnty_swinput_blnc;

										if($po_size_qnty_swinput_blnc<0)
										{
											$po_size_qnty_swinput_blnc=abs($po_size_qnty_swinput_blnc);
											$po_size_qnty_swinput_blnc='('.number_format($po_size_qnty_swinput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_swinput_blnc=$po_size_qnty_swinput_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_swinput_blnc; ?></td><?
									}
									if($tot_po_size_qnty_swinput_blnc<0)
										{
											$tot_po_size_qnty_swinput_blnc=abs($tot_po_size_qnty_swinput_blnc);
											$tot_po_size_qnty_swinput_blnc='('.number_format($tot_po_size_qnty_swinput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_swinput_blnc=$tot_po_size_qnty_swinput_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_swinput_blnc; ?></td>
					        </tr>
					        <tr>
					            <td>Sewing Output</td>
					            	<?
									$tot_po_size_qnty_swoutput=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swoutput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput'];
										$tot_po_size_qnty_swoutput+=$po_size_qnty_swoutput;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_swoutput); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_swoutput); ?></td>
					        </tr>
					        <tr>
					            <td>Sewing Balance </td>
					            	<?
									$tot_po_size_qnty_swoutput_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_swoutput_blnc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput']; ////
										$po_size_qnty_swinput_blnc=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swinput'];
										$po_size_qnty_swoutput_blnc=$po_size_qnty_swinput_blnc-$po_size_qnty_swoutput_blnc;
										$tot_po_size_qnty_swoutput_blnc+=$po_size_qnty_swoutput_blnc;

										if($po_size_qnty_swoutput_blnc<0)
										{
											$po_size_qnty_swoutput_blnc=abs($po_size_qnty_swoutput_blnc);
											$po_size_qnty_swoutput_blnc='('.number_format($po_size_qnty_swoutput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_swoutput_blnc=$po_size_qnty_swoutput_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_swoutput_blnc; ?></td><?
									}
									if($tot_po_size_qnty_swoutput_blnc<0)
										{
											$tot_po_size_qnty_swoutput_blnc=abs($tot_po_size_qnty_swoutput_blnc);
											$tot_po_size_qnty_swoutput_blnc='('.number_format($tot_po_size_qnty_swoutput_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_swoutput_blnc=$tot_po_size_qnty_swoutput_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_swoutput_blnc; ?></td>
					        </tr>
					         <tr>
					            <td>Poly</td>
					            	<?
									$tot_po_size_qnty_poly=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										$tot_po_size_qnty_poly+=$po_size_qnty_poly;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_poly); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_poly); ?></td>
					        </tr>
					       	<tr>
					            <td>Poly Balance  </td>
					            <?
									$tot_po_size_qnty_poly_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										$po_size_qnty_swoutput=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_swoutput'];
										$po_size_qnty_poly_blnc=$po_size_qnty_swoutput-$po_size_qnty_poly;
										$tot_po_size_qnty_poly_blnc+=$po_size_qnty_poly_blnc;

										if($po_size_qnty_poly_blnc<0)
										{
											$po_size_qnty_poly_blnc=abs($po_size_qnty_poly_blnc);
											$po_size_qnty_poly_blnc='('.number_format($po_size_qnty_poly_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_poly_blnc=$po_size_qnty_poly_blnc;$bg_tdColor='';
										}
									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_poly_blnc; ?></td><?
									}
									if($tot_po_size_qnty_poly_blnc<0)
										{
											$tot_po_size_qnty_poly_blnc=abs($tot_po_size_qnty_poly_blnc);
											$tot_po_size_qnty_poly_blnc='('.number_format($tot_po_size_qnty_poly_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_poly_blnc=$tot_po_size_qnty_poly_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_poly_blnc; ?></td>
					        </tr>
					         <tr>
					            <td>Packing </td>
					            <?
									$tot_po_size_qnty_packing=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_packing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_packing'];
										$tot_po_size_qnty_packing+=$po_size_qnty_packing;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_packing); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_packing); ?></td>
					        </tr>
					         <tr>
					            <td>Packing Balance </td>
					           <?
									$tot_po_size_qnty_packing_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_packing=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_packing'];
										$po_size_qnty_poly=$color_size_qnty_prod[$color][$item_id][$style][$sizeRes]['quantity_poly'];
										$po_size_qnty_packing_blnc=$po_size_qnty_poly-$po_size_qnty_packing;

										$tot_po_size_qnty_packing_blnc+=$po_size_qnty_packing_blnc;


										if($po_size_qnty_packing_blnc<0)
										{
											$po_size_qnty_packing_blnc=abs($po_size_qnty_packing_blnc);
											$po_size_qnty_packing_blnc='('.number_format($po_size_qnty_packing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_packing_blnc=$po_size_qnty_packing_blnc;$bg_tdColor='';
										}

									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_packing_blnc; ?></td><?
									}

									if($tot_po_size_qnty_packing_blnc<0)
										{
											$tot_po_size_qnty_packing_blnc=abs($tot_po_size_qnty_packing_blnc);
											$tot_po_size_qnty_packing_blnc='('.number_format($tot_po_size_qnty_packing_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_packing_blnc=$tot_po_size_qnty_packing_blnc;$bg_tdColor='';
										}
									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>"><? echo $tot_po_size_qnty_packing_blnc; ?></td>
					        </tr>
					         <tr>
					            <td>Ex Factory</td>
					             <?
									$tot_po_size_qnty_exfact=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes]['ex_fact_qty'];
										$tot_po_size_qnty_exfact+=$po_size_qnty_exfact;
									 	?><td align="center" width="80"><? echo number_format($po_size_qnty_exfact); ?></td><?
									}
									?>
					            <td align="center"><? echo number_format($tot_po_size_qnty_exfact); ?></td>
					        </tr>
					        <tr>
					            <td>Ex- Factory Balance </td>
					             <?
									$tot_po_size_qnty_exfact_blnc=0;
									foreach($color_size_ids as $sizeRes)
									{
										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes]['ex_fact_qty'];
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc=($po_size_qnty-$po_size_qnty_exfact);
										$tot_po_size_qnty_exfact_blnc+=$po_size_qnty_exfact_blnc;

										if($po_size_qnty_exfact_blnc<0)
										{
											$po_size_qnty_exfact_blnc=abs($po_size_qnty_exfact_blnc);
											$po_size_qnty_exfact_blnc='('.number_format($po_size_qnty_exfact_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$po_size_qnty_exfact_blnc=$po_size_qnty_exfact_blnc;$bg_tdColor='';
										}

									 	?><td align="center" width="80" style="color:<? echo $bg_tdColor; ?>"><? echo $po_size_qnty_exfact_blnc; ?></td><?
									}

									if($tot_po_size_qnty_exfact_blnc<0)
										{
											$tot_po_size_qnty_exfact_blnc=abs($tot_po_size_qnty_exfact_blnc);
											$tot_po_size_qnty_exfact_blnc='('.number_format($tot_po_size_qnty_exfact_blnc).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_blnc=$tot_po_size_qnty_exfact_blnc;$bg_tdColor='';
										}

									?>
					            <td align="center" style="color:<? echo $bg_tdColor; ?>">
								<?

									echo $tot_po_size_qnty_exfact_blnc;
								?>
					            </td>
					        </tr>
					         <tr>
					            <td>Ex- Factory Balance % </td>
					             <?
									$tot_po_size_qnty_exfact_blnc_prcn=0; $tot_po_size_qnty_exfact_blnc2=0;$tot_po_size_qnty2=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_exfact_perc=$ex_fact_qty_arr[$color][$item_id][$sizeRes]['ex_fact_qty'];
										$po_size_qnty_perc=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc=($po_size_qnty_perc-$po_size_qnty_exfact_perc);
										$exfact_size_bal_perc_sum=($po_size_qnty_exfact_blnc/$po_size_qnty_perc)*100;

										// for total
										$po_size_qnty_exfact2=$ex_fact_qty_arr[$color][$item_id][$sizeRes]['ex_fact_qty'];
										$po_size_qnty2=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$po_size_qnty_exfact_blnc2=($po_size_qnty2-$po_size_qnty_exfact2);
										$tot_po_size_qnty_exfact_blnc2+=$po_size_qnty_exfact_blnc2;

										$po_size_qnty2=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qnty2+=$po_size_qnty2;
										//
										//$tot_po_size_qnty_exfact_blnc_prcn+=$exfact_size_bal_perc_sum;
										if($exfact_size_bal_perc_sum<0)
										{
											$exfact_size_bal_perc_sum=abs($exfact_size_bal_perc_sum);
											$exfact_size_bal_perc_sum='('.number_format($exfact_size_bal_perc_sum,2).')'; $bg_tdColor='red';
										}
										else
										{
											$exfact_size_bal_perc_sum=number_format($exfact_size_bal_perc_sum,2);$bg_tdColor='';
										}
									 	?><td align="center" width="80 " style="color:<? echo $bg_tdColor; ?>"><? echo $exfact_size_bal_perc_sum; ?></td><?
									}

									  	$tot_po_size_qnty_exfact_blnc_prcn=($tot_po_size_qnty_exfact_blnc2/$tot_po_size_qnty2)*100;
										if($tot_po_size_qnty_exfact_blnc_prcn<0)
										{

											$tot_po_size_qnty_exfact_blnc_prcn=abs($tot_po_size_qnty_exfact_blnc_prcn);
											$tot_po_size_qnty_exfact_blnc_prcn='('.number_format($tot_po_size_qnty_exfact_blnc_prcn,2).')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_blnc_prcn=number_format($tot_po_size_qnty_exfact_blnc_prcn,2);$bg_tdColor='';
										}


								?>

					            <td align="center" style="color:<? echo $bg_tdColor; ?>">
									<? echo $tot_po_size_qnty_exfact_blnc_prcn; ?>
					            </td>
					        </tr>
					        <tr>
					            <td>Ex- Factory  % </td>
					             <?
									$tot_po_size_qnty_exfact_perc=0;$tot_po_size_qnty_exfact2=0;$tot_po_size_qntyy=0;
									foreach($color_size_ids as $sizeRes)
									{

										$po_size_qnty_exfact=$ex_fact_qty_arr[$color][$item_id][$sizeRes]['ex_fact_qty'];
										$po_size_qnty=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$result_exfactPerc=($po_size_qnty_exfact/$po_size_qnty)*100;
										$tot_po_size_qnty_exfact_perc+=$result_exfactPerc;


										//

										$po_size_qnty_exfact2=$ex_fact_qty_arr[$color][$item_id][$sizeRes]['ex_fact_qty'];
										$tot_po_size_qnty_exfact2+=$po_size_qnty_exfact2;

										$po_size_qntyy=$color_size_qnty[$color][$item_id][$style][$sizeRes]['quantity'];
										$tot_po_size_qntyy+=$po_size_qntyy;
										//



										if($result_exfactPerc<0)
										{
											$result_exfactPerc=abs($result_exfactPerc);
											$result_exfactPerc='('.$result_exfactPerc.')'; $bg_tdColor='red';
										}
										else
										{
											$result_exfactPerc=$result_exfactPerc;$bg_tdColor='';
										}
									 	?><td align="center" width="80"><? echo  number_format($result_exfactPerc,2); ?></td><?
									}
									$tot_po_size_qnty_exfact_perc=($tot_po_size_qnty_exfact2/$tot_po_size_qntyy)*100;
									if($tot_po_size_qnty_exfact_perc<0)
										{
											$tot_po_size_qnty_exfact_perc=abs($tot_po_size_qnty_exfact_perc);
											$tot_po_size_qnty_exfact_perc='('.$tot_po_size_qnty_exfact_perc.')'; $bg_tdColor='red';
										}
										else
										{
											$tot_po_size_qnty_exfact_perc=$tot_po_size_qnty_exfact_perc;$bg_tdColor='';
										}
									?>
					            <td align="center"><? echo  number_format($tot_po_size_qnty_exfact_perc,2); ?></td>
					        </tr>

					 	</table>
					 </div>
				 	<?
				}
			}
		}
		?>
		</div>


		<?
	}
	else if($type==4) //order and size wise
	{
		$buyer_library=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name"  );
		//report order and color wise kaiyum
		$active_status=str_replace("'", "", $active_status);
		$active_cond="";
		if($active_status) $active_cond.=" and a.status_active=1 and d.status_active=1 ";

		$po_break_down_id=$txt_order_id ;
		$company_name=$cbo_company_name;
		if ($txt_style_ref_number!="")
		{
			$txt_style_ref_number_cond="and e.style_ref_no like '%$txt_style_ref_number%'";
		}
		else
		{
			$txt_style_ref_number_cond="";
		}
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$cbo_job_year_cond =" and year(e.insert_date)='$cbo_job_year'";
			}
			else
			{
				$cbo_job_year_cond =" and to_char(e.insert_date,'YYYY')='$cbo_job_year'";
			}
		}

		if($txt_style_ref_id!="")
		{
			$txt_style_ref_id_cond=" and e.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$txt_style_ref_id_cond =" and e.job_no_prefix_num in($txt_style_ref)";
		}

		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $cbo_style_owner_wise_status_cond=" and e.company_name=$cbo_company_name";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$shipping_status_cond =" and d.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$shipping_status_cond =" and d.shiping_status in(1,2)";
			}
			else
			{
				$shipping_status_cond =" and d.shiping_status in(1,2,3)";
			}

		}
		if($txt_order_id=="")
		{
			if($txt_order_no!="")
			{
				$order_no_cond =" and d.po_number in($poNumbers)";
			}
		}
		//if($txt_order_no!="" )  $order_no_cond =" and d.po_number in( '".$txt_order_no."') ";
		if($po_break_down_id!="" )  $po_break_down_id_cond =" and a.po_break_down_id in (".$po_break_down_id.") ";
		$po_break_down_id_cond_new=($po_break_down_id!="") ?" and x.po_break_down_id in($po_break_down_id) " : "";

		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and x.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and d.grouping=$txt_internal_ref ";


		if($cbo_buyer_name!=0 )  $cbo_buyer_name_cond =" and e.buyer_name =$cbo_buyer_name";
		if($cbo_season_id!=0 )  $cbo_season_id_cond =" and e.season_buyer_wise =$cbo_season_id";
		if($cbo_location!=0 )  $cbo_location_cond =" and e.location_name =$cbo_location";
		if($txt_datefrom!="" &&  $txt_dateto!="")  $txt_datefrom_to_cond =" and d.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
		$color_variable_setting=return_field_value("ex_factory","variable_settings_production","company_name='$company_name' and variable_list=1 and status_active=1 and is_deleted=0","ex_factory");
		$color_variable_setting = ($color_variable_setting==0) ? 3 : $color_variable_setting;
		$ex_fact_qty_arr=array();
		if($color_variable_setting==2 || $color_variable_setting==3)
		{
		 	$sql_exfect="SELECT a.po_break_down_id,a.item_number_id, a.color_number_id, a.size_number_id, sum(y.production_qnty) as production_qnty from pro_ex_factory_mst x,pro_ex_factory_dtls y,wo_po_color_size_breakdown a,wo_po_break_down d,wo_po_details_master e
			where  x.id=y.mst_id and y.color_size_break_down_id=a.id   and x.status_active=1 and x.is_deleted=0 and y.status_active=1 and y.is_deleted=0   and a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond $internal_ref_cond_po group by  a.color_number_id,a.size_number_id,a.po_break_down_id,a.item_number_id order by a.po_break_down_id,a.color_number_id, a.size_number_id";

			//echo $sql_exfect."<br>";
			$sql_result_exfact=sql_select($sql_exfect);
			foreach($sql_result_exfact as $row)
			{
				$ex_fact_qty_arr[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['ex_fact_qty']=$row[csf("production_qnty")];
			}
		}

		if($db_type==0)
		{
			$prod_sq="SELECT x.po_break_down_id, y.color_size_break_down_id, a.item_number_id, a.color_number_id, a.size_number_id,e.style_ref_no,
				  IFNULL(sum(case when x.production_type ='1' and y.production_type ='1'  then y.production_qnty else 0 end),0) as cutting_qnty,
				  IFNULL(sum(case when x.production_type ='1' and x.entry_break_down_type=3 then (y.production_qnty+y.replace_qty) else 0 end),0) as cutting_qnty_qc,
				  IFNULL(sum(case when x.production_type ='2' and x.embel_name=1 then y.production_qnty else 0 end),0) as printing_qnty,
				  IFNULL(sum(case when x.production_type ='3' and x.embel_name=1 then y.production_qnty else 0 end),0) as printreceived_qnty,
				  IFNULL(sum(case when x.production_type ='2' and x.embel_name=2 then y.production_qnty else 0 end),0) as emb_qnty,
				  IFNULL(sum(case when x.production_type ='3' and x.embel_name=2 then y.production_qnty else 0 end),0) as embreceived_qnty,
				  IFNULL(sum(case when x.production_type ='2' and x.embel_name=3 then y.production_qnty else 0 end),0) as wash_qnty,
				  IFNULL(sum(case when x.production_type ='3' and x.embel_name=3 then y.production_qnty else 0 end),0) as washreceived_qnty,
				  IFNULL(sum(case when x.production_type ='2' and x.embel_name=4 then y.production_qnty else 0 end),0) as sp_qnty,
				  IFNULL(sum(case when x.production_type ='3' and x.embel_name=4 then y.production_qnty else 0 end),0) as spreceived_qnty,
				  IFNULL(sum(case when x.production_type ='4' and y.production_type ='4' then y.production_qnty else 0 end),0) as sewingin_qnty,
				  IFNULL(sum(case when x.production_type ='5' and y.production_type ='5' then y.production_qnty else 0 end),0) as sewingout_qnty,
				  IFNULL(sum(case when x.production_type ='6' then y.production_qnty else 0 end),0) as finishin_qnty,
				  IFNULL(sum(case when x.production_type ='7' then y.production_qnty else 0 end),0) as iron_qnty,
				  IFNULL(sum(case when x.production_type ='8' then y.production_qnty else 0 end),0) as finish_qnty,

				  IFNULL(sum(case when x.production_type ='10' and x.trans_type=5 then y.production_qnty else 0 end),0) as trans_in_qty,
				  IFNULL(sum(case when x.production_type ='10' and x.trans_type=6 then y.production_qnty else 0 end),0) as trans_out_qty,

				  IFNULL(sum(case when x.production_type ='11' and y.production_type ='11' then y.production_qnty else 0 end),0) as poly_qty
				from
					pro_garments_production_mst x, pro_garments_production_dtls y , wo_po_color_size_breakdown a,wo_po_details_master e
				where
				x.id=y.mst_id  and y.color_size_break_down_id=a.id      and a.job_id=e.id and e.company_name=$cbo_company_name
				 $po_break_down_id_cond_new  $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_location_cond $cbo_job_year_cond $cbo_style_owner_wise_status_cond    $internal_ref_cond_prod
			and y.status_active=1 and x.status_active=1 and a.status_active=1 and e.status_active=1
			group by x.po_break_down_id, y.color_size_break_down_id, a.item_number_id, a.color_number_id, a.size_number_id,e.style_ref_no order by x.po_break_down_id,a.size_number_id
			order by x.po_break_down_id,a.color_number_id ,a.size_number_id";
			$prod_sql=sql_select($prod_sq);
		}
		else
		{
		   $prod_sq="SELECT x.po_break_down_id, y.color_size_break_down_id, a.item_number_id, a.color_number_id, a.size_number_id,e.style_ref_no,
			(case when y.production_type ='1' and x.production_type ='1' then y.production_qnty else 0 end) as cutting_qnty,
			(case when y.production_type ='1' and x.production_type ='1' and x.entry_break_down_type=3 then y.production_qnty else 0 end) as cutting_qnty_qc,
			(case when x.production_type ='2' and x.embel_name=1 then y.production_qnty else 0 end) as printing_qnty,
			(case when x.production_type ='3' and x.embel_name=1 then y.production_qnty else 0 end) as printreceived_qnty,
			(case when x.production_type ='2' and x.embel_name=2 then y.production_qnty else 0 end) as emb_qnty,
			(case when x.production_type ='3' and x.embel_name=2 then y.production_qnty else 0 end) as embreceived_qnty,
			(case when x.production_type ='2' and x.embel_name=3 then y.production_qnty else 0 end) as wash_qnty,
			(case when x.production_type ='3' and x.embel_name=3 then y.production_qnty else 0 end) as washreceived_qnty,
			(case when x.production_type ='2' and x.embel_name=4 then y.production_qnty else 0 end) as sp_qnty,
			(case when x.production_type ='3' and x.embel_name=4 then y.production_qnty else 0 end) as spreceived_qnty,
			(case when x.production_type ='4' and y.production_type ='4' then y.production_qnty else 0 end) as sewingin_qnty,
			(case when x.production_type ='5' and  y.production_type ='5' then y.production_qnty else 0 end) as sewingout_qnty,
			(case when x.production_type ='6' and y.production_type ='6' then y.production_qnty else 0 end) as finishin_qnty,
			(case when x.production_type ='7' and y.production_type ='7' then y.production_qnty else 0 end) as iron_qnty,
			(case when x.production_type ='8' and y.production_type ='8' then y.production_qnty else 0 end) as finish_qnty,
			(case when x.production_type ='11' and y.production_type ='11' then y.production_qnty else 0 end) as poly_qty,
			(case when x.production_type ='11' and y.production_type ='11' then y.reject_qty else 0 end) as poly_reject,
			(case when x.production_type ='1' and y.production_type ='1' then y.replace_qty else 0 end) as replace_qnty_qc,

		  	(case when x.production_type ='10' and x.trans_type=5 then y.production_qnty else 0 end) as trans_in_qty,
		  	(case when x.production_type ='10' and x.trans_type=6 then y.production_qnty else 0 end) as trans_out_qty
			from
			pro_garments_production_mst x, pro_garments_production_dtls y , wo_po_color_size_breakdown a,wo_po_details_master e
			where
			x.id=y.mst_id and y.color_size_break_down_id=a.id   and e.status_active=1   and a.job_id=e.id and e.company_name=$cbo_company_name    and e.is_deleted=0
			 $po_break_down_id_cond_new  $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond  $cbo_style_owner_wise_status_cond  $internal_ref_cond_prod $txt_style_ref_id_cond
			and y.status_active=1 and x.status_active=1 and x.is_deleted=0 and y.is_deleted=0 and a.status_active=1 order by x.po_break_down_id,a.color_number_id ,a.size_number_id ";
			$prod_sql=sql_select($prod_sq);
		}

		$prod_color_size_data=array();
		foreach($prod_sql as $row)
		{
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_qc']+=$row[csf("cutting_qnty_qc")] ;
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['replace_qnty_qc']+=$row[csf("replace_qnty_qc")];

			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_toprint']+=$row[csf("printing_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_fromprint']+=$row[csf("printreceived_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_toemb']+=$row[csf("emb_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_fromemb']+=$row[csf("embreceived_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_to_spwork']+=$row[csf("sp_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_from_spwork']+=$row[csf("spreceived_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_swinput']+=$row[csf("sewingin_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_swoutput']+=$row[csf("sewingout_qnty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_poly']+=$row[csf("poly_qty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['poly_reject']+=$row[csf("poly_reject")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['quantity_packing']+=$row[csf("finish_qnty")];
		  	$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['color_idd']=$row[csf("color_number_id")];

			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['trans_in_qty']+=$row[csf("trans_in_qty")];
			$color_size_qnty_prod[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['trans_out_qty']+=$row[csf("trans_out_qty")];

			//$color[$row[csf("po_break_down_id")]][$row[csf("size_number_id")]]['color_ids'].=$row[csf("color_number_id")].'__';
			//$color_size_qnty_prod[$row[csf("color_number_id")]][$row[csf("style_ref_no")]][$row[csf("size_number_id")]]['quantity_exfact']+=$row[csf("finish_qnty")];
		}
		//echo "<pre>";
		 //print_r($color_size_qnty_prod); die;


		$color_size_sql=sql_select( "SELECT a.id, a.po_break_down_id, d.po_number, d.pub_shipment_date, a.item_number_id, a.color_number_id, a.size_number_id, e.style_ref_no, e.job_no, e.buyer_name, a.order_quantity, a.plan_cut_qnty, a.is_deleted from wo_po_color_size_breakdown a, wo_po_break_down d, wo_po_details_master e where  a.color_number_id>0 and a.size_number_id>0 $po_break_down_id_cond and a.po_break_down_id=d.id and a.job_id=e.id and d.status_active in(1,2,3)  and a.status_active in(1,2,3) and e.company_name=$cbo_company_name  $txt_datefrom_to_cond $txt_style_ref_number_cond  $cbo_buyer_name_cond $cbo_season_id_cond $cbo_location_cond $cbo_job_year_cond $txt_style_ref_id_cond $cbo_style_owner_wise_status_cond $shipping_status_cond  $order_no_cond $internal_ref_cond_po $active_cond order by a.po_break_down_id, a.color_order, a.size_order");


		$po_color_size_data=array();$color_size_qnty=array();
		$all_po_arr=array();
		foreach($color_size_sql as $row)
		{
			//$test_data[]=$row[csf("color_number_id")];
			$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['style_ref_no']=$row[csf("style_ref_no")];
			$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['buyer_name']=$row[csf("buyer_name")];
			$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['po_number']=$row[csf("po_number")];
			$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['shipdate']=$row[csf("pub_shipment_date")];
			if($row[csf("is_deleted")]==0)
			{
				$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['order_quantity']+=$row[csf("order_quantity")];
				$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("item_number_id")]][$row[csf("color_number_id")]][$row[csf("size_number_id")]]['plan_cut_qnty']=$row[csf("plan_cut_qnty")];
			}
			//$po_color_size_data[$row[csf("po_break_down_id")]][$row[csf("size_number_id")]]['color_number_id']=$row[csf("color_number_id")];
			$all_po_arr[$row[csf("po_break_down_id")]]=$row[csf("po_break_down_id")];
		}
		if($db_type==2 && count($all_po_arr)>999)
		{
			$all_po_id_chunk=array_chunk($all_po_arr,999) ;
			$all_po_id_cond="";
			foreach($all_po_id_chunk as $chunk_arr)
			{
				$ids=implode(",",$chunk_arr);
				if(!$all_po_id_cond) $all_po_id_cond.=" and ( b.order_id in($ids) ";
				else $all_po_id_cond.=" or b.order_id in($ids) ";

			}

			$all_po_id_cond.=" )";

		}
		else
		{
			$all_po_ids=implode(",",$all_po_arr);
			$all_po_id_cond=" and b.order_id in($all_po_ids)";
		}

		$lay_sql="SELECT a.gmt_item_id,a.color_id,b.order_id, b.size_id,sum(b.size_qty) as qnty from ppl_cut_lay_dtls a,ppl_cut_lay_bundle b where a.id=b.dtls_id and a.status_active=1 and b.status_active=1 $all_po_id_cond group by a.gmt_item_id,a.color_id,b.order_id, b.size_id ";
		foreach(sql_select($lay_sql) as $rows)
		{
			$color_size_qnty_lay[$rows[csf("order_id")]][$rows[csf("gmt_item_id")]][$rows[csf("color_id")]][$rows[csf("size_id")]]['lay_qty']+=$rows[csf("qnty")];
		}


		$all_po_id_cond3=str_replace('b.order_id','b.id',$all_po_id_cond);
		$po_no_library=return_library_array( "select b.id,b.po_number from wo_po_break_down b where 1=1 $all_po_id_cond3", "id", "po_number");



		?>
    	<div id="scroll_body" style="height:auto; width:2040px; margin:0 auto; padding:0;">
    	<fieldset>
    	<legend> Order and Size Wise</legend>
    	<table border="1" cellpadding="0" cellspacing="0" class="rpt_table" rules="all" width="2500" align="left">
		<!--<div id="scroll_body" style="overflow-y: scroll; width: 1620px; overflow-x: auto;">
    	<table width="1610" cellspacing="0" border="1" class="rpt_table" rules="all" id="">-->
		<caption><h2>Order and Size - Style NO: <? echo $color_size_sql[0][csf('style_ref_no')].'; JOB NO : '.$color_size_sql[0][csf('job_no')].'; Buyer Name : '.$buyer_short_library[$color_size_sql[0][csf('buyer_name')]]; ?> </h2></caption>
         <thead>
        	<tr>
     		    <th width="" colspan="12"></th>
                <th width="" colspan="3">Emblishment Rcvd</th>
                <th width="" colspan="12"></th>
           </tr>
        </thead>
        <thead>
        	<tr>
            	<th width="30">SL</th>
            	<th width="200">PO</th>
				<th width="200">Style No</th>
            	<th width="200">Buyer Name</th>
                <th width="70">Pub. Ship Date</th>
            	<th width="200">Garments Item</th>
                <th width="200">Color</th>
     		    <th width="60">Size</th>
                <th width="60">Order Total</th>
                <th width="100">Cutting Qty</th>
                <th width="60">Cutt/Qc Total</th>
     		    <th width="80">Cutt Short/excess</th>

                <th width="70">Print</th>
                <th width="70">Embroidary</th>
                <th width="70">Sp. Work</th>

                <th width="60">Inp Total</th>
     		    <th width="80">Inp Short/Excess</th>
                <th width="60">Sewing Output Total</th>
                <th width="80">Output Short/excess</th>
     		    <th width="60">Poly Out Total</th>
				 <th width="60">Poly Reject</th>
                <th width="80">Poly Output Short/excess</th>
                <th width="60"><p>Total Packing and Finishing</p></th>
     		    <th width="80"><p>Packing and finishing Short/excess</p></th>
                <th width="60">Total Ex Factory</th>
                <th width="60">FG Stock in Hand</th>
     		    <th>Exfactory Short/excess</th>

             </tr>
        </thead>
		</table>
		<div style="width:2520px; max-height:410px; overflow-y: scroll;" id="scroll_body">
		 	<table cellspacing="0" cellpadding="0"  width="2500"  border="1" rules="all" class="rpt_table" id="" >
			  	<tbody>
		         <!--
		           </tr>
		        </thead>
				</table>

				<table border="1" class="rpt_table" width="1610" rules="all" id="" >-->
			    <?
			    /*foreach($color_size_sql as $row)
				{*/
				$i=0;
				foreach($po_color_size_data as $poID=>$breakDown_id)
				{
					foreach($breakDown_id as $itemID=> $items)
					{
						$item_total_order_qty="";
						$item_total_lay_qty=0;
						$item_total_cutt_qty="";
						$item_total_cuttShortEx_qty="";

						$item_total_emblPrint="";
						$item_total_emblEmbro="";
						$item_total_emblSPwork="";

						$item_total_input_qty="";
						$item_total_inputShortEx_qty="";
						$item_total_sewing_qty="";
						$item_total_swoutShortEx_qty="";
						$item_total_poly_qty="";
						$item_total_polyShortEx_qty="";
						$item_total_carton_qty="";
						$item_total_cartonShortEx_qty="";
						$item_total_exfact_qty="";
						$item_total_fg_qty="";
						$item_total_exfactShortEx_qty="";
						//$gTotal_inputShortEx_qty="";
						foreach($items as $colorID=> $colors)
						{
							$total_order_qty="";
							$total_lay_qty=0;
							$total_cutt_qty="";
							$total_cuttShortEx_qty="";

							$total_emblPrint="";
							$total_emblEmbro="";
							$total_emblSPwork="";

							$total_input_qty="";
							$total_inputShortEx_qty="";
							$total_sewing_qty="";
							$total_swoutShortEx_qty="";
							$total_poly_qty="";
							$total_poly_reject="";
							$total_polyShortEx_qty="";
							$total_carton_qty="";
							$total_cartonShortEx_qty="";
							$total_exfact_qty="";
							$total_fg_qty="";
							$total_exfactShortEx_qty="";
							//$gTotal_inputShortEx_qty="";
							foreach($colors as $sizeNoID=> $val)
							{

								$bgcolor = ($i%2) ? "#ebf3ff" : "#ffffff";
								$i++;
								?>
						        <tr onclick="change_color('tr_<? echo $i; ?>', '<? echo $bgcolor; ?>')" id="tr_<? echo $i; ?>" bgcolor="<?echo $bgcolor;?>">
						        	<td width="30" align="left"><? echo $i; ?></td>
									<td width="200" align="left"><? echo $val['po_number']; ?></td>
									<td width="200" align="left"><? echo $val['style_ref_no']; ?></td>
									<td width="200" align="left"><? echo $buyer_library[$val['buyer_name']] ; ?></td>
                                    <td width="70" align="left"><? echo change_date_format($val['shipdate']); ?></td>
									<td width="200" align="left"><? echo $garments_item[$itemID]; ?></td>
						            <td width="200"  align="left"><? echo  $color_Arr_library[$colorID]; //$color_Arr_library[$color_size_qnty_prod[$poID][$colorID][$sizeNoID]['color_idd']]; ?></td>
						            <td width="60" align="left"><p><? echo $size_Arr_library[$sizeNoID]; ?>&nbsp;</p></td>
						            <td width="60" align="right"><? echo $po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity'];//echo $row[csf('order_quantity')]; ?></td>
						            <td width="100" align="right"><? echo $layQty=$color_size_qnty_lay[$poID][$itemID][$colorID][$sizeNoID]['lay_qty']; ?></td>
						            <td width="60" align="right"><? echo $cuttQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_qc']; ?></td>
							            <?
										$cut_shortExc= $po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_qc'];
										if($cut_shortExc<0)
										{
											$cut_shortExc=abs($cut_shortExc);
											$cut_shortExc='('.$cut_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$cut_shortExc=$cut_shortExc;$bg_tdColor='';
										}
										?>
						            <td width="80" align="right" style="color:<? echo $bg_tdColor; ?>"><? echo $cut_shortExc;?></td>



						            <td width="70" align="right">
							            <?
										$sendToPrint=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_fromprint']+=$row[csf("printreceived_qnty")];
										echo $emblishMentPrint=$sendToPrint;

							            ?>
						            </td>
						             <td width="70" align="right">
							            <?
										$sentToEmblishment=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_fromemb']+=$row[csf("embreceived_qnty")];
										echo $emblishMentEmbro=$sentToEmblishment;
							            ?>
						            </td>
						             <td width="70" align="right">
							            <?
										$sentToSpecialWork=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_from_spwork']+=$row[csf("spreceived_qnty")];
										echo $emblishMentSPwork=$sentToSpecialWork;
							            ?>
						            </td>

						            <td width="60" align="right"><? echo $inputQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swinput']; ?></td>
							            <?
										$qtyCuttQC=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_qc'];
										$swInPut=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swinput'];

							            $input_shortExc=$qtyCuttQC-$swInPut;
										if($input_shortExc<0)
										{
											$input_shortExc=abs($input_shortExc);
											$input_shortExc='('.$input_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$input_shortExc=$input_shortExc;$bg_tdColor='';
										}
										?>
						            <td width="80" align="right"  style="color:<? echo $bg_tdColor; ?>"><? echo $input_shortExc; ?></td>
						            <td width="60" align="right"><? echo $swoutQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swoutput']; ?></td>
							             <?
										$output_shortExc=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swinput']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swoutput'];
										if($output_shortExc<0)
										{
											$output_shortExc=abs($output_shortExc);
											$output_shortExc='('.$output_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$output_shortExc=$output_shortExc;$bg_tdColor='';
										}
										?>
						            <td width="80" align="right" style="color:<? echo $bg_tdColor; ?>"><? echo $output_shortExc ?></td>
						            <td width="60" align="right"><? echo $polyQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_poly']; ?></td>
									<td width="60" align="right"><? echo $polyreject=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['poly_reject']; ?></td>
							             <?
										$poly_output_shortExc=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swinput']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_poly']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['poly_reject'];
										if($poly_output_shortExc<0)
										{
											$poly_output_shortExc=abs($poly_output_shortExc);
											$poly_output_shortExc='('.$poly_output_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$poly_output_shortExc=$poly_output_shortExc;$bg_tdColor='';
										}
										?>
						            <td width="80" align="right" style="color:<? echo $bg_tdColor; ?>"><? echo $poly_output_shortExc; ?></td>
						            <td width="60" align="right"><? echo $cartonQty=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_packing']+$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_in_qty']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_out_qty']; ?></td>
							             <?
										$carton_shortExc=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_poly']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_packing']+$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_in_qty']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_out_qty'];
										if($carton_shortExc<0)
										{
											$carton_shortExc=abs($carton_shortExc);
											$carton_shortExc='('.$carton_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$carton_shortExc=$carton_shortExc;$bg_tdColor='';
										}
										?>
						            <td width="80" align="right" style="color:<? echo $bg_tdColor; ?>"><? echo $carton_shortExc; ?></td>
						            <td width="60" align="right"><? echo $exFacQty=$ex_fact_qty_arr[$poID][$itemID][$colorID][$sizeNoID]['ex_fact_qty']; ?></td>
						            <td width="60" align="right"><? echo $fg_inhand_qty = $polyQty - $exFacQty; ?></td>

							             <?
										$exFactory_shortExc=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity']-$ex_fact_qty_arr[$poID][$itemID][$colorID][$sizeNoID]['ex_fact_qty'];


										if($exFactory_shortExc<0)
										{
											$exFactory_shortExc=abs($exFactory_shortExc);
											$exFactory_shortExc='('.$exFactory_shortExc.')'; $bg_tdColor='red';
										}
										else
										{
											$exFactory_shortExc=$exFactory_shortExc;$bg_tdColor='';
										}
										?>
						            <td align="right" style="color:<? echo $bg_tdColor; ?>"><? echo $exFactory_shortExc; ?></td>
								</tr>
							    <?
								$total_order_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity'];

								$total_lay_qty+=$layQty;
								$total_cutt_qty+=$cuttQty;
								$total_cuttShortEx_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_qc'];

								$total_emblPrint+=$emblishMentPrint;
								$total_emblEmbro+=$emblishMentEmbro;
								$total_emblSPwork+=$emblishMentSPwork;

								$total_input_qty+=$inputQty;
								$total_inputShortEx_qty+=$qtyCuttQC-$swInPut;
								$total_sewing_qty+=$swoutQty;
								$total_swoutShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swinput']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swoutput'];
								$total_poly_qty+=$polyQty;
								$total_poly_reject+=$polyreject;
								$total_polyShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swinput']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_poly']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['poly_reject'];
								$total_carton_qty+=$cartonQty;
								$total_cartonShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_poly']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_packing']+$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_in_qty']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_out_qty'];
								$total_exfact_qty+=$exFacQty;
								$total_fg_qty+=$fg_inhand_qty;
								$total_exfactShortEx_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity']-$ex_fact_qty_arr[$poID][$itemID][$colorID][$sizeNoID]['ex_fact_qty'];

								// ====================== item wise ==================================
								$item_total_order_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity'];

								$item_total_lay_qty+=$layQty;
								$item_total_cutt_qty+=$cuttQty;
								$item_total_cuttShortEx_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_qc'];

								$item_total_emblPrint+=$emblishMentPrint;
								$item_total_emblEmbro+=$emblishMentEmbro;
								$item_total_emblSPwork+=$emblishMentSPwork;

								$item_total_input_qty+=$inputQty;
								$item_total_inputShortEx_qty+=$qtyCuttQC-$swInPut;
								$item_total_sewing_qty+=$swoutQty;
								$item_total_swoutShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swinput']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swoutput'];
								$item_total_poly_qty+=$polyQty;
								$item_total_poly_reject+=$polyreject;
								$item_total_polyShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_swinput']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_poly']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['poly_reject'];
								$item_total_carton_qty+=$cartonQty;
								$item_total_cartonShortEx_qty+=$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_poly']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['quantity_packing']+$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_in_qty']-$color_size_qnty_prod[$poID][$itemID][$colorID][$sizeNoID]['trans_out_qty'];
								$item_total_exfact_qty+=$exFacQty;
								$item_total_fg_qty+=$fg_inhand_qty;
								$item_total_exfactShortEx_qty+=$po_color_size_data[$poID][$itemID][$colorID][$sizeNoID]['order_quantity']-$ex_fact_qty_arr[$poID][$itemID][$colorID][$sizeNoID]['ex_fact_qty'];
							}
							?>
					        <tr class="gd-color3">
					        	<td width="30" align="left"><b></b></td>
					        	<td width="200" align="left"><b><? echo $po_no_library[$poID]; ?></b></td>
								<th width="200"></th>
            					<th width="200"></th>
                                <td width="70" align="left"><b></b></td>
					        	<td width="200" align="left"><b><? echo $garments_item[$itemID]; ?></b></td>
					            <td width="200" colspan="2" align="right"><b>Color Wise PO Total=</b></td>

					            <td width="60" align="right"><b><? echo $total_order_qty; ?></b></td>
					            <td width="100" align="right"><b><? echo $total_lay_qty; ?></b></td>
					            <td width="60" align="right"><b><? echo $total_cutt_qty; ?></b></td>

					             <?
								 $bg_tdColor='';
								 $total_cuttShortEx_qtyy=$total_cuttShortEx_qty;
					            if($total_cuttShortEx_qtyy<0)
									{
										$total_cuttShortEx_qtyy=abs($total_cuttShortEx_qtyy);
										$total_cuttShortEx_qtyy='('.$total_cuttShortEx_qtyy.')'; $bg_tdColor='red';
									}
									else
									{
										$total_cuttShortEx_qtyy=$total_cuttShortEx_qty;$bg_tdColor='';
									}
					            ?>
					            <td width="80" align="right" style="color:<? echo $bg_tdColor; ?>"><b><? echo $total_cuttShortEx_qtyy; ?></b></td>

					            <td width="70" align="right"><b><? echo $total_emblPrint; ?></b></td>
					            <td width="70" align="right"><b><? echo $total_emblEmbro; ?></b></td>
					            <td width="70" align="right"><b><? echo $total_emblSPwork; ?></b></td>
					            <td width="60" align="right"><b><? echo $total_input_qty; ?></b></td>
					           <?  $gTotal_inputShortEx_qty=$total_inputShortEx_qty; if($total_inputShortEx_qty<0){  $total_inputShortEx_qty=abs($total_inputShortEx_qty); $total_inputShortEx_qty='('.$total_inputShortEx_qty.')'; $bg_tdColor='red'; } else {  $total_inputShortEx_qty;$bg_tdColor='';  } ?>

					            <td style="color:<? echo $bg_tdColor ?>" width="80" align="right"><b><?
								  echo $total_inputShortEx_qty; $total_inputShortEx_qty='';
								 ?></b></td>
					            <td width="60" align="right"><b><? echo $total_sewing_qty; ?></b></td>
					            <td width="80" align="right"><b><? echo $total_swoutShortEx_qty; ?></b></td>
					            <td width="60" align="right"><b><? echo $total_poly_qty; ?></b></td>
								<td width="60" align="right"><b><? echo $total_poly_reject; ?></b></td>

					             <?
								 $total_polyShortEx_qtyy=$total_polyShortEx_qty;
					            if($total_polyShortEx_qtyy<0)
									{
										$total_polyShortEx_qtyy=abs($total_polyShortEx_qtyy);
										$total_polyShortEx_qtyy='('.$total_polyShortEx_qtyy.')'; $bg_tdColor='red';
									}
									else
									{
										$total_polyShortEx_qtyy=$total_polyShortEx_qty;$bg_tdColor='';
									}
					            ?>

					            <td width="80" align="right" style="color:<? echo $bg_tdColor ?>"><b><? echo $total_polyShortEx_qtyy; ?></b></td>
					            <td width="60" align="right"><b><? echo $total_carton_qty; ?></b></th>

					             <?
								 $total_cartonShortEx_qtyy=$total_cartonShortEx_qty;
					            if($total_cartonShortEx_qtyy<0)
									{
										$total_cartonShortEx_qtyy=abs($total_cartonShortEx_qtyy);
										$total_cartonShortEx_qtyy='('.$total_cartonShortEx_qtyy.')'; $bg_tdColor='red';
									}
									else
									{
										$total_cartonShortEx_qtyy=$total_cartonShortEx_qty;$bg_tdColor='';
									}
					            ?>


					            <td width="80" align="right" style="color:<? echo $bg_tdColor ?>"><b><? echo $total_cartonShortEx_qtyy; ?></b></td>
					            <td width="60" align="right"><b><? echo $total_exfact_qty; ?></b></td>
					            <td width="60" align="right"><b><? echo $total_fg_qty; ?></b></td>

					             <?
								 $total_exfactShortEx_qtyy=$total_exfactShortEx_qty;
					            if($total_exfactShortEx_qtyy<0)
									{
										$total_exfactShortEx_qtyy=abs($total_exfactShortEx_qtyy);
										$total_exfactShortEx_qtyy='('.$total_exfactShortEx_qtyy.')'; $bg_tdColor='red';
									}
									else
									{
										$total_exfactShortEx_qtyy=$total_exfactShortEx_qty;$bg_tdColor='';
									}
					            ?>

					            <td align="right" style="color:<? echo $bg_tdColor ?>"><b><? echo $total_exfactShortEx_qtyy; ?></b></td>
					        </tr>
					        <?
					        $grandTotal_order_qty+=$total_order_qty;
							$total_order_qty=0;
							$grandTotal_lay_qty+=$total_lay_qty;
							$grandTotal_cutt_qty+=$total_cutt_qty;
							$total_lay_qty=0;
							$total_cutt_qty=0;
							$grandTotal_cuttShortEx_qty+=$total_cuttShortEx_qty;
							$total_cuttShortEx_qty=0;

							$grandTotal_emblPrint+=$total_emblPrint;
							$total_emblPrint=0;
							$grandTotal_emblEmbro+=$total_emblEmbro;
							$total_emblEmbro=0;
							$grandTotal_emblSPwork+=$total_emblSPwork;
							$total_emblSPwork=0;

							$grandTotal_input_qty+=$total_input_qty;
							$total_input_qty=0;
							$grandTotal_inputShortEx_qty+=$gTotal_inputShortEx_qty;
							$gTotal_inputShortEx_qty=0;
							$grandTotal_sewing_qty+=$total_sewing_qty;
							$total_sewing_qty=0;
							$grandTotal_swoutShortEx_qty+=$total_swoutShortEx_qty;
							$total_swoutShortEx_qty=0;
							$grandTotal_poly_qty+=$total_poly_qty;
							$grandTotal_poly_reject+=$total_poly_reject;
							$total_poly_qty=0;
							$grandTotal_polyShortEx_qty+=$total_polyShortEx_qty;
							$total_polyShortEx_qty=0;
							$grandTotal_carton_qty+=$total_carton_qty;
							$total_carton_qty=0;
							$grandTotal_cartonShortEx_qty+=$total_cartonShortEx_qty;
							$total_cartonShortEx_qty=0;
							$grandTotal_exfact_qty+=$total_exfact_qty;
							$grandTotal_fg_qty+=$total_fg_qty;
							$total_exfact_qty=0;
							$grandTotal_exfactShortEx_qty+=$total_exfactShortEx_qty;
							$total_exfactShortEx_qty=0;
						}

						?>
					    <tr class="gd-color">
				        	<td width="30" align="left"><b></b></td>
				        	<td width="200" align="left"><b><? echo $po_no_library[$poID]; ?></b></td>
							<th width="200"></th>
            				<th width="200"></th>
                            <td width="70" align="left"><b></b></td>
				        	<td width="200" align="left"><b><? echo $garments_item[$itemID]; ?></b></td>
				            <td width="200" colspan="2" align="right"><b>Item Wise PO Total=</b></td>

				            <td width="60" align="right"><b><? echo $item_total_order_qty; ?></b></td>
				            <td width="100" align="right"><b><? echo $item_total_lay_qty; ?></b></td>
				            <td width="60" align="right"><b><? echo $item_total_cutt_qty; ?></b></td>

				             <?
							 $bg_tdColor='';
							 $item_total_cuttShortEx_qtyy=$item_total_cuttShortEx_qty;
				            if($item_total_cuttShortEx_qtyy<0)
								{
									$item_total_cuttShortEx_qtyy=abs($item_total_cuttShortEx_qtyy);
									$item_total_cuttShortEx_qtyy='('.$item_total_cuttShortEx_qtyy.')'; $bg_tdColor='red';
								}
								else
								{
									$item_total_cuttShortEx_qtyy=$item_total_cuttShortEx_qty;$bg_tdColor='';
								}
				            ?>
				            <td width="80" align="right" style="color:<? echo $bg_tdColor; ?>"><b><? echo $item_total_cuttShortEx_qtyy; ?></b></td>

				            <td width="70" align="right"><b><? echo $item_total_emblPrint; ?></b></td>
				            <td width="70" align="right"><b><? echo $item_total_emblEmbro; ?></b></td>
				            <td width="70" align="right"><b><? echo $item_total_emblSPwork; ?></b></td>
				            <td width="60" align="right"><b><? echo $item_total_input_qty; ?></b></td>
				           <?  $gTotal_inputShortEx_qty=$item_total_inputShortEx_qty; if($item_total_inputShortEx_qty<0){  $item_total_inputShortEx_qty=abs($item_total_inputShortEx_qty); $total_inputShortEx_qty='('.$total_inputShortEx_qty.')'; $bg_tdColor='red'; } else {  $total_inputShortEx_qty;$bg_tdColor='';  } ?>

				            <td style="color:<? echo $bg_tdColor ?>" width="80" align="right"><b><?
							  echo $item_total_inputShortEx_qty; $item_total_inputShortEx_qty='';
							 ?></b></td>
				            <td width="60" align="right"><b><? echo $item_total_sewing_qty; ?></b></td>
				            <td width="80" align="right"><b><? echo $item_total_swoutShortEx_qty; ?></b></td>
				            <td width="60" align="right"><b><? echo $item_total_poly_qty; ?></b></td>
							<td width="60" align="right"><b><? echo $item_total_poly_reject; ?></b></td>

				             <?
							 $item_total_polyShortEx_qtyy=$item_total_polyShortEx_qty;
				            if($item_total_polyShortEx_qtyy<0)
								{
									$item_total_polyShortEx_qtyy=abs($item_total_polyShortEx_qtyy);
									$item_total_polyShortEx_qtyy='('.$item_total_polyShortEx_qtyy.')'; $bg_tdColor='red';
								}
								else
								{
									$item_total_polyShortEx_qtyy=$item_total_polyShortEx_qty;$bg_tdColor='';
								}
				            ?>

				            <td width="80" align="right" style="color:<? echo $bg_tdColor ?>"><b><? echo $item_total_polyShortEx_qtyy; ?></b></td>
				            <td width="60" align="right"><b><? echo $item_total_carton_qty; ?></b></th>

				             <?
							 $item_total_cartonShortEx_qtyy=$item_total_cartonShortEx_qty;
				            if($total_cartonShortEx_qtyy<0)
								{
									$item_total_cartonShortEx_qtyy=abs($item_total_cartonShortEx_qtyy);
									$item_total_cartonShortEx_qtyy='('.$item_total_cartonShortEx_qtyy.')'; $bg_tdColor='red';
								}
								else
								{
									$item_total_cartonShortEx_qtyy=$item_total_cartonShortEx_qty;$bg_tdColor='';
								}
				            ?>


				            <td width="80" align="right" style="color:<? echo $bg_tdColor ?>"><b><? echo $item_total_cartonShortEx_qtyy; ?></b></td>
				            <td width="60" align="right"><b><? echo $item_total_exfact_qty; ?></b></td>
				            <td width="60" align="right"><b><? echo $item_total_fg_qty; ?></b></td>

				             <?
							 $item_total_exfactShortEx_qtyy=$item_total_exfactShortEx_qty;
				            if($item_total_exfactShortEx_qtyy<0)
								{
									$item_total_exfactShortEx_qtyy=abs($item_total_exfactShortEx_qtyy);
									$item_total_exfactShortEx_qtyy='('.$item_total_exfactShortEx_qtyy.')'; $bg_tdColor='red';
								}
								else
								{
									$item_total_exfactShortEx_qtyy=$item_total_exfactShortEx_qty;$bg_tdColor='';
								}
				            ?>

				            <td align="right" style="color:<? echo $bg_tdColor ?>"><b><? echo $item_total_exfactShortEx_qtyy; ?></b></td>
				        </tr>
				        <?
					} // end item wise


				} // end po wise
				//  grand total bottom part
				?>
		 		<tr class="gd-color2">
		            <td width="200" colspan="8" align="right"><b>Grand Total </b></td>
		            <td width="60" align="right"><b><? echo $grandTotal_order_qty; ?></b></td>
		            <td width="100" align="right"><b><? echo $grandTotal_lay_qty; ?></b></td>
		            <td width="60" align="right"><b><? echo $grandTotal_cutt_qty; ?></b></td>


		              <?
		            if($grandTotal_cuttShortEx_qty<0)
						{
							$grandTotal_cuttShortEx_qty=abs($grandTotal_cuttShortEx_qty);
							$grandTotal_cuttShortEx_qty='('.$grandTotal_cuttShortEx_qty.')'; $bg_tdColor='red';
						}
						else
						{
							$grandTotal_cuttShortEx_qty=$grandTotal_cuttShortEx_qty;$bg_tdColor='';
						}
		            ?>

		            <td width="80" align="right" style="color:<? echo $bg_tdColor; ?>"><b><? echo $grandTotal_cuttShortEx_qty; ?></b></td>

		            <td width="70" align="right"><b><? echo $grandTotal_emblPrint; ?></b></td>
		            <td width="70" align="right"><b><? echo $grandTotal_emblEmbro; ?></b></td>
		            <td width="70" align="right"><b><? echo $grandTotal_emblSPwork; ?></b></td>

		            <td width="60" align="right"><b><? echo $grandTotal_input_qty; ?></b></td>
		           <? if($grandTotal_inputShortEx_qty<0){  $grandTotal_inputShortEx_qty=abs($grandTotal_inputShortEx_qty); $grandTotal_inputShortEx_qty='('.$grandTotal_inputShortEx_qty.')'; $bg_tdColor='red'; } else {  $grandTotal_inputShortEx_qty;$bg_tdColor='';  } ?>

		            <td style="color:<? echo $bg_tdColor ?>" width="80" align="right"><b><?
					  echo $grandTotal_inputShortEx_qty;
					 ?></b></td>
		            <td width="60" align="right"><b><? echo $grandTotal_sewing_qty; ?></b></td>
		            <td width="80" align="right"><b><? echo $grandTotal_swoutShortEx_qty; ?></b></td>
		            <td width="60" align="right"><b><? echo $grandTotal_poly_qty; ?></b></td>
					<td width="60" align="right"><b><? echo $grandTotal_poly_reject; ?></b></td>


		            <?
		            if($grandTotal_polyShortEx_qty<0)
						{
							$grandTotal_polyShortEx_qty=abs($grandTotal_polyShortEx_qty);
							$grandTotal_polyShortEx_qty='('.$grandTotal_polyShortEx_qty.')'; $bg_tdColor='red';
						}
						else
						{
							$grandTotal_polyShortEx_qty=$grandTotal_polyShortEx_qty;$bg_tdColor='';
						}
		            ?>


		            <td width="80" align="right" style="color:<? echo $bg_tdColor ?>"><b><? echo $grandTotal_polyShortEx_qty; ?></b></td>
		            <td width="60" align="right"><b><? echo $grandTotal_carton_qty; ?></b></th>
		            <td width="80" align="right"><b><? echo $grandTotal_cartonShortEx_qty; ?></b></td>
		            <td width="60" align="right"><b><? echo $grandTotal_exfact_qty; ?></b></td>
		            <td width="60" align="right"><b><? echo $grandTotal_fg_qty; ?></b></td>

		            <?
		            if($grandTotal_exfactShortEx_qty<0)
						{
							$grandTotal_exfactShortEx_qty=abs($grandTotal_exfactShortEx_qty);
							$grandTotal_exfactShortEx_qty='('.$grandTotal_exfactShortEx_qty.')'; $bg_tdColor='red';
						}
						else
						{
							$grandTotal_exfactShortEx_qty=$grandTotal_exfactShortEx_qty;$bg_tdColor='';
						}
		            ?>

		            <td align="right" style="color:<? echo $bg_tdColor ?>"><b><? echo $grandTotal_exfactShortEx_qty; ?></b></td>
		        </tr>
		        <?
				//

				//}
				?>
			    </tbody>
		    </table>
	    </div>
	    </fieldset>
		</div>

		<?
	}
	else if($type==5)
	{
		$country_library=return_library_array( "select id,country_name from lib_country", "id", "country_name"  );

		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}

		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}
		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";


		if($country_id>0) $str_po_cond.=" and c.country_id=$country_id";

		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";

		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and a.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";

		$order_sql="SELECT a.id job_id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.id as po_id, b.po_number, b.excess_cut, b.is_confirmed, c.item_number_id as item_number_id, c.country_id, c.country_ship_date, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total ,max(c.shiping_status) as shiping_status,sum(c.plan_cut_qnty) as plan_cut_qnty
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id  and a.status_active=1 and a.is_deleted=0 and b.status_active in(1,2,3) and c.status_active in(1,2,3) and b.is_deleted=0 and c.is_deleted=0 $active_cond $order_status_cond $str_po_cond $txt_style_ref_number_cond   $internal_ref_cond_po
		group by a.id, a.job_no_prefix_num,a.job_no, a.insert_date, a.company_name, a.buyer_name, a.style_ref_no, b.id,b.po_number, b.excess_cut, b.is_confirmed, c.item_number_id, c.country_id, c.country_ship_date, c.color_number_id
		order by c.country_ship_date, b.id, c.item_number_id, c.country_id, c.color_number_id";


		$all_po_id.="0".",";
		$sql_po_result=sql_select($order_sql);
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("po_id")].",";
		}
		$all_po_id=implode(',',array_unique(explode(",",chop($all_po_id,","))));
		$template_id_arr=return_library_array("select po_number_id, template_id from tna_process_mst where po_number_id in (".$all_po_id.") group by po_number_id, template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and a.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(explode(",",$all_po_id),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (a.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or a.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}

			}
		}


		if($po_product_cond=="")
		{
			echo '<div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:1930px">No Data Found.</div>'; die;
		}


		$color_id_arr=return_library_array( "select a.id,a.color_number_id from wo_po_color_size_breakdown a where  a.color_number_id>0 $po_product_cond", "id", "color_number_id");




		$ex_factory_arr=array();
		$ex_factory_data=sql_select("select a.po_break_down_id, a.item_number_id, a.country_id, MAX(a.ex_factory_date) AS ex_factory_date, b.color_size_break_down_id,
		sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END) as ex_factory_qnty ,a.total_carton_qnty
		 from pro_ex_factory_mst a, pro_ex_factory_dtls b
		 where a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 $po_product_cond
		 group by a.po_break_down_id, a.item_number_id, a.country_id, b.color_size_break_down_id,a.total_carton_qnty");

		foreach($ex_factory_data as $exRow)
		{
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['date']+=$exRow[csf('ex_factory_date')];
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['qty']+=$exRow[csf('ex_factory_qnty')];
			$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]][$exRow[csf('country_id')]][$color_id_arr[$exRow[csf('color_size_break_down_id')]]]['ex_fac_carton_qty']=$exRow[csf('total_carton_qnty')];

		}

		unset($ex_factory_data);


		if($db_type==0)
		{
			$prod_sql="SELECT a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' and b.production_type='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN a.production_type ='2'  and b.production_type='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'   and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2'  and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,


				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4'  and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,


				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN a.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN a.production_type ='1' and b.production_type='1'  THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,

				IFNULL(sum(CASE WHEN a.production_type ='3' and b.production_type='3'  THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' and b.production_type='7'  THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' and b.production_type='8'  THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' and b.production_type='5'  THEN b.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c	where
				a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0   $active_cond_c $po_product_cond $internal_ref_cond_prod and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
			group by a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id";

			$sql_carton_qty=sql_select("select a.po_break_down_id,a.country_id,
			IFNULL(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a where a.status_active=1 and a.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by a.po_break_down_id,a.country_id");
		}
		else
		{
			$prod_sql= "SELECT a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type ='1' THEN b.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' THEN b.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS special,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' THEN b.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 THEN b.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 THEN b.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=3 THEN b.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=4 THEN b.production_qnty ELSE 0 END),0) AS specialr,

				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=1 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type ='2' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' and a.embel_name=2 and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,



				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type ='4' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type ='4' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' and a.production_source<>1 THEN b.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN b.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN a.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' and a.production_source=1 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' and a.production_source=3 THEN b.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN a.production_type ='1' and b.production_type ='1' THEN b.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' and b.production_type ='3' THEN b.reject_qty ELSE 0 END),0) AS emb_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' and b.production_type ='7' THEN b.reject_qty ELSE 0 END),0) AS iron_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' and b.production_type ='8' THEN b.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='11' and b.production_type='11' THEN b.reject_qty ELSE 0 END),0) AS poly_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' and b.production_type='4' THEN b.reject_qty ELSE 0 END),0) AS sewing_input_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' and b.production_type='2' THEN b.reject_qty ELSE 0 END),0) AS emb_issue_rej_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' and b.production_type ='5' THEN b.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls b,wo_po_color_size_breakdown c
			where
				a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0  $active_cond_c $po_product_cond $internal_ref_cond_prod   and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
			group by a.po_break_down_id, a.item_number_id,a.country_id, b.color_size_break_down_id";

			$sql_carton_qty=sql_select("select a.po_break_down_id,a.country_id,
			NVL(sum(case when a.production_type ='8' and a.production_source=1 then a.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			NVL(sum(case when a.production_type ='8' and a.production_source=3 then a.carton_qty else 0 end),0) as carton_qty_no_outbound,
			NVL(sum(case when a.production_type ='8' then a.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst a where a.status_active=1 and a.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by a.po_break_down_id,a.country_id");
		}
		//echo $prod_sql;die;
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("po_break_down_id")]][$crtn[csf("country_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		}

		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);

		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_qnty']+=$gmtsRow[csf('cutting_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printing_qnty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['wash']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printreceived_qnty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['printr']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['embr']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['washr']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['specialr']+=$gmtsRow[csf('specialr')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];



			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_in']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_in']+=$gmtsRow[csf('sewingout_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingin_qnty_out']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty_out']+=$gmtsRow[csf('sewingout_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_qnty']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_qnty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['re_iron_qnty']+=$gmtsRow[csf('re_iron_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];


			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['cutting_rej_qnty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_rej_qnty']+=$gmtsRow[csf('emb_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['iron_rej_qnty']+=$gmtsRow[csf('iron_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewingout_rej_qnty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['finish_rej_qnty']+=$gmtsRow[csf('finish_rej_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['poly_rej_qnty']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['sewing_input_rej_qnty']+=$gmtsRow[csf('sewing_input_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]][$gmtsRow[csf('country_id')]][$color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]]['emb_issue_rej_qnty']+=$gmtsRow[csf('emb_issue_rej_qnty')];

		}






		$result=sql_select($order_sql);
		$i=0; $k=0; $date=date("Y-m-d");
		$days_in_hand="";
		foreach($result as $orderRes)
		{

		   $i++;
		   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

			$k++;

			$ex_factory_date=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['date'];
			$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['qty'];
			$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['ex_fac_carton_qty'];




			$color=""; $days_remian="";
			$days_remian=datediff("d",$date,$orderRes[csf("country_ship_date")]);
			$days_in_hand=datediff("d",$date,$orderRes[csf("country_ship_date")]);
			if($orderRes[csf("country_ship_date")] > $date)
			{
				$color="";
			}
			else if($orderRes[csf("country_ship_date")] < $date)
			{
				$color="red";
			}
			else if($orderRes[csf("country_ship_date")] >= $date && $days_remian<=5 )
			{
				$color="orange";
			}


			$cutting_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['cutting_qnty'];
			$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['printreceived_qnty'];
			$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_in'];
			$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_in'];
			$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingin_qnty_out'];
			$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_qnty_out'];
			$iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['iron_qnty'];
			$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['re_iron_qnty'];
			$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_inhouse'];
			$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_qnty_outbound'];

			$print_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print'];
			$embl_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb'];
			$wash_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['wash'];
			$spwork_issue=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['special'];
			$print_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['printr'];
			$emb_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['embr'];
			$wash_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['washr'];
			$spcial_rec=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['specialr'];


			$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_issue_inhouse'];
			$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_issue_subcon'];
			$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_rcv_inhouse'];
			$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['print_rcv_subcon'];

			$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_inhouse'];
			$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_subcon'];
			$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_inhouse'];
			$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rcv_subcon'];



			$cutting_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['cutting_rej_qnty'];
			$emb_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_rej_qnty'];
			$iron_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['iron_rej_qnty'];
			$sewing_out_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewingout_rej_qnty'];
			$finish_reject=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['finish_rej_qnty'];

			$poly_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['poly_rej_qnty'];
			$sewing_input_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['sewing_input_rej_qnty'];
			$emb_issue_rej_qnty=$gmts_prod_arr[$orderRes[csf("po_id")]][$orderRes[csf("item_number_id")]][$orderRes[csf("country_id")]][$orderRes[csf("color_number_id")]]['emb_issue_rej_qnty'];

			$cartonInQnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_qty_no_inhouse'];
			$cartonOutQnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_qty_no_outbound'];
			$cartonTotal_qnty=$carton_arr[$orderRes[csf("po_id")]][$orderRes[csf("country_id")]]['carton_total_qty'];



			$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
			$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
			$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$orderRes[csf("order_quantity")];
			$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$orderRes[csf("order_total")];
			$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
			$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
			$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound;
			$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound;


			$po_quantity_in_pcs=$orderRes[csf("order_quantity")];
			$plan_cut_qnty=$orderRes[csf("plan_cut_qnty")];
			$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
			$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);
			$excess_cut_percent=$short_excess_cut_percent-$orderRes[csf("excess_cut")];


			$embl_recv_qty=$print_rec+$emb_rec+$wash_rec+$spcial_rec;
			$rej_value=$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject+$poly_rej_qnty+$sewing_input_rej_qnty+$emb_issue_rej_qnty;
			$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

			$finish_status = $finish_qnty*100/$po_quantity_in_pcs;

			$company_name=$orderRes[csf("company_name")];
			$po_id=$orderRes[csf("po_id")];
			$item_id=$orderRes[csf("item_number_id")];
			if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);

			$total_rej_value+=$rej_value;
			$template_id=$template_id_arr[$orderRes[csf("po_id")]];


			$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$k','$bgcolor') id=tr_2nd$k>";
			$html.='<td width="30"><p>'.$display_font_color.$i.$font_end.'</p></td>
					<td width="130"><p>'.$display_font_color.$orderRes[csf("po_number")].$font_end.'</p></td>
					<td width="80"><p>'.$display_font_color.$order_status[$orderRes[csf("is_confirmed")]].$font_end.'</p></td>
					<td width="60"><p>'.$display_font_color.$buyer_short_library[$orderRes[csf("buyer_name")]].$font_end.'</p></td>
					<td width="100" align="center"><p>'.$display_font_color.$orderRes[csf("job_no")].$font_end.'</p></td>
					<td width="120"><p>'.$display_font_color.$orderRes[csf("style_ref_no")].$font_end.'</p></td>
					<td width="130"><p>'.$garments_item[$orderRes[csf("item_number_id")]].'</p></td>
					<td width="70" align="center" bgcolor="'.$color.'"><div>'.change_date_format($orderRes[csf("country_ship_date")]).'&nbsp;</div></td>
					<td width="120" align="center" bgcolor="'.$color.'"><p>'.$country_library[$orderRes[csf("country_id")]].'&nbsp;</p></td>
					<td width="120" align="center" bgcolor="'.$color.'"><p>'.$color_Arr_library[$orderRes[csf("color_number_id")]].'&nbsp;</p></td>
					<td width="80" align="right"><p>'.$po_quantity_in_pcs.'</p></td>
					<td width="80" align="right"><p>'.number_format($plan_cut_qnty,2).'</p></td>
					<td width="80" align="right"><p>'.number_format($cutting_qnty,0).'</p></td>



					<td width="80" align="right"><p>'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</p></td>
					<td width="80" align="right"><p>'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</p></td>


					<td width="80" align="right"><p>'.number_format($total_finish_qnty,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($rej_value,0).'</td>
					<td align="right">'.number_format($ex_factory_qnty,0).'<br>'.'Ctn: '.$ex_factory_carton_qnty.'</p></td>
				</tr>';
		}// end main foreach  exfactory
		?>
        <div>



			<div style="clear:both; width:3950px"></div>
			<table cellspacing="0" width="1700" border="1" class="rpt_table" rules="all" id="table_header_5">
				<thead>
					<tr>
						<th width="30">SL</th>
						<th width="130">Order No.</th>
                        <th width="80">Order Status</th>
						<th width="60">Buyer Name</th>
                        <th width="100">Job No.</th>
						<th width="120">Style Name</th>
						<th width="130">Item Name</th>
						<th width="70">Country Ship Date</th>
						<th width="120">Country Name</th>
                        <th width="120">Color Name</th>
                        <th width="80">Order Qty.</th>
                        <th width="80">Plan Cut Qty</th>
						<th width="80">Total Cut Qty</th>
						<th width="80">Total Sewing Input Qty</th>
						<th width="80">Total Sewing Output Qty</th>
						<th width="80">Finish Qty</th>
						<th width="80">Reject Qty</th>
						<th >Total Ex-Factory</th>
					 </tr>
				</thead>
			</table>
			<div style="max-height:300px; overflow-y:scroll; width:3930px" id="scroll_body">
				<table border="1" width="1700" class="rpt_table" rules="all" id="table_body">
					<?  echo $html; ?>
				</table>
				<!--<table border="1" width="1700" class="tbl_bottom" rules="all" id="report_table_footer_1" >
					<tr>
						<td width="30"></td>
						<td width="130"></td>
                        <td width="80"></td>
						<td width="60"></td>
                        <td width="100"></td>
						<td width="120"></td>
						<td width="130"></td>
						<td width="70"></td>
                        <td width="120"></td>
                        <td width="120">Total</td>
                        <td width="80" id="total_order_quantity"></td>
                        <td width="80" id="plan_cut_qnty"></td>
						<td width="80" id="total_cutting"></td>
						<td width="80" id="total_sewing_input_all_qnty"></td>
						<td width="80" id="total_sewing_output_all_qnty"></td>
                        <td width="80" id="total_finish_qnty"></td>
						<td width="80" id="total_rej_value_td"></td>
						<td id="total_out"></td>
					 </tr>
				</table>-->
			</div>
		 </div>
        <?
	}
	else if($type==6) // job and color wise
	{
		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}

		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_season_id!=0) $str_po_cond.=" and a.season_buyer_wise=$cbo_season_id";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}

		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and c.po_break_down_id in (select id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";

		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";

		// ========================================== MAIN QUERY ==================================================
		$order_sql="SELECT b.id, a.job_no_prefix_num,a.job_no, $select_job_year, a.company_name, a.buyer_name, a.style_ref_no, b.po_number, b.shipment_date, b.excess_cut,  b.is_confirmed, c.item_number_id as item_number_id, c.color_number_id, sum(c.order_quantity) as order_quantity, sum(c.order_total) as order_total ,max(c.shiping_status) as shiping_status,sum(c.plan_cut_qnty) as plan_cut_qnty,b.grouping
		from wo_po_details_master a,wo_po_break_down b, wo_po_color_size_breakdown c
		where a.id=b.job_id and b.id=c.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active in(1,2,3) and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0  $active_cond $order_status_cond $str_po_cond $txt_style_ref_number_cond  $internal_ref_cond_po
		group by a.id,a.job_no_prefix_num,a.job_no,a.insert_date,a.company_name,a.buyer_name,a.style_ref_no,b.id,b.po_number, b.shipment_date, b.excess_cut, b.is_confirmed, c.item_number_id, c.color_number_id,b.grouping
		order by b.shipment_date, b.id, c.item_number_id,c.color_number_id";

		$sql_po_result=sql_select($order_sql);
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("id")].",";
			$all_po_id_arr[$row[csf("id")]]=$row[csf("id")];
		}
		//=================================== Delete Order Id From TEMP ENGINE ====================================
		$con = connect();
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 21 and ref_from=6");
		oci_commit($con);
		//=================================== Insert order_id into TEMP ENGINE ====================================
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 21, 6,$all_po_id_arr, $empty_arr);

	    $all_po_id=chop($all_po_id,",");

	    $all_po_ids=implode(",", $all_po_id_arr);
	    $all_po_ids_cond="";
 		if(count($all_po_id_arr)>0)
 		{
 			  if($db_type==2 && count($all_po_id_arr)>999)
			   {
			   		$chunk_arr=array_chunk($all_po_id_arr, 999);
			   		foreach($chunk_arr as $vals)
			   		{
			   			$po_ids=implode(",", $vals);
			   			if($all_po_ids_cond=="")
			   			{
			   				$all_po_ids_cond.=" and (c.order_id in ($po_ids)";
			   			}
			   			else
			   			{
			   				$all_po_ids_cond.=" or  c.order_id in ($po_ids)";
			   			}
			   		}
			   		$all_po_ids_cond.= " )";
			   }
			   else
			   {
			   		$all_po_ids_cond= " and c.order_id in($all_po_ids) ";
			   }
 		}

 		if($all_po_ids != "")
 		{
			$template_sql = "select a.po_number_id, a.template_id from tna_process_mst a ,GBL_TEMP_ENGINE b where a.po_number_id=b.ref_val and b.entry_form=21 and b.ref_from=6 and b.user_id=$user_id group by a.po_number_id, a.template_id";
			$template_id_arr=return_library_array($template_sql ,"po_number_id","template_id");
 		}
		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and c.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(array_unique(explode(",",$all_po_id)),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (c.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or c.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}
			}
		}
		// ======================= FOR EXFACTORY  ===========================
		$ex_factory_arr=array();
		$ex_fac_level=sql_select("select ex_factory  from variable_settings_production where company_name=$cbo_company_name and variable_list=1 and status_active=1");
		if($ex_fac_level[0][csf("ex_factory")]==1)
		{
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , c.item_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN c.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN c.ex_factory_qnty ELSE 0 END) as ex_factory_qnty
			from GBL_TEMP_ENGINE b,pro_ex_factory_mst c where c.po_break_down_id=b.ref_val and b.entry_form=21 and b.ref_from=6 and b.user_id=$user_id and c.status_active=1 and c.is_deleted=0  group by c.po_break_down_id, c.item_number_id");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}

		}
		else
		{
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , f.color_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN d.production_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN d.production_qnty ELSE 0 END) as ex_factory_qnty, e.job_no_mst as job_no
			from  GBL_TEMP_ENGINE b,pro_ex_factory_mst c ,pro_ex_factory_dtls d,wo_po_break_down e ,wo_po_color_size_breakdown f
			where c.po_break_down_id=b.ref_val and c.id=d.mst_id and c.po_break_down_id=e.id and e.id=f.po_break_down_id and f.id=d.color_size_break_down_id and
         	c.status_active=1 and c.is_deleted=0 and    d.status_active=1 and d.is_deleted=0 and      e.status_active in(1,2,3) and e.is_deleted=0 and f.status_active in(1,2,3)
         	group by c.po_break_down_id, f.color_number_id,e.job_no_mst");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('job_no')]][$exRow[csf('color_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		}
		unset($ex_factory_data);
		// ============================ FOR PRODUCTION DATA =================================
		if($db_type==0)
		{

			$prod_sql="SELECT c.po_break_down_id, c.item_number_id,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				IFNULL(sum(CASE WHEN d.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,


				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				IFNULL(sum(CASE WHEN c.production_type ='10' and c.trans_type=5 THEN d.production_qnty ELSE 0 END),0) AS trans_in_qty,
				IFNULL(sum(CASE WHEN c.production_type ='10' and c.trans_type=6 THEN d.production_qnty ELSE 0 END),0) AS trans_out_qty,


				IFNULL(sum(CASE WHEN d.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='5' THEN d.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='11' THEN d.production_qnty ELSE 0 END),0) AS poly_qty,
				IFNULL(sum(CASE WHEN d.production_type in (1,2,4,3,5,7,8,11) and c.production_type in (1,2,4,3,5,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=1 then c.carton_qty ELSE 0 END),0) as carton_qty_no_inhouse,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=3 then c.carton_qty ELSE 0 END),0) as carton_qty_no_outbound,
				IFNULL(sum(CASE When d.production_type ='8' and c.production_type ='8' then c.carton_qty ELSE 0 END),0) as carton_total_qty

			from
				pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e
			where  c.id=d.mst_id  and c.po_break_down_id=a.po_break_down_id and a.job_no_mst=e.job_no  and a.id=d.color_size_break_down_id and c.status_active=1 and   c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and e.status_active=1 and e.is_deleted=0  $active_cond_a_d  $po_product_cond $internal_ref_cond_prod
			group by c.po_break_down_id, c.item_number_id";

			$sql_carton_qty=sql_select("select c.po_break_down_id,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=1 then c.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=3 then c.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when c.production_type ='8' then c.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst c where c.status_active=1 and c.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by c.po_break_down_id");
		}
		else
		{
			$producttion_cond =" and c.po_break_down_id in($po_id)";
			$prod_sql= "SELECT c.po_break_down_id, a.color_number_id,e.job_no,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.replace_qty ELSE 0 END),0) AS replace_qty,

				NVL(sum(CASE WHEN d.production_type ='2'  and c.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				NVL(sum(CASE WHEN c.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				NVL(sum(CASE WHEN d.production_type ='3'  and c.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,

				NVL(sum(CASE WHEN c.production_type ='10' and c.trans_type=5 THEN d.production_qnty ELSE 0 END),0) AS trans_in_qty,
				NVL(sum(CASE WHEN c.production_type ='10' and c.trans_type=6 THEN d.production_qnty ELSE 0 END),0) AS trans_out_qty,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,

				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,

				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' THEN d.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' THEN d.reject_qty ELSE 0 END),0) AS poly_rej_qnty,

				NVL(sum(CASE WHEN d.production_type in (1,3,5,7,8,11) and c.production_type in (1,3,5,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				NVL(sum(CASE WHEN d.production_type ='11' and c.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,

				NVL(sum(CASE WHEN c.production_type ='11' and d.production_type ='11'  THEN d.production_qnty ELSE 0 END),0) AS poly_qty

			from
				GBL_TEMP_ENGINE b,pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e
			where  c.po_break_down_id=b.ref_val and c.id=d.mst_id     and a.job_id=e.id  and a.id=d.color_size_break_down_id and b.entry_form=21 and b.ref_from=6 and b.user_id=$user_id  and
				c.status_active=1 and c.is_deleted=0 and d.status_active=1 and a.status_active=1  $active_cond_a_d and d.is_deleted=0  and e.status_active=1 and e.is_deleted=0
			group by c.po_break_down_id, a.color_number_id,e.job_no";

			// =============================== for carton quantity =======================================
			$po_product_cond2 = str_replace('c.po_break_down_id', 'd.po_break_down_id', $po_product_cond);
			$sql_carton_qty=sql_select("SELECT d.po_break_down_id,a.job_no,c.color_number_id,
			NVL(sum(case when d.production_type ='8' and d.production_source=1 then d.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			NVL(sum(case when d.production_type ='8' and d.production_source=3 then d.carton_qty else 0 end),0) as carton_qty_no_outbound,
			NVL(sum(case when d.production_type ='8' then d.carton_qty else 0 end),0) as carton_total_qty
			FROM wo_po_details_master a,wo_po_break_down b, wo_po_color_size_breakdown c,pro_garments_production_mst d
			WHERE a.id=b.job_id and a.id=c.job_id and b.job_id=c.job_id and b.id=c.po_break_down_id and b.id=d.po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0  $active_cond $po_product_cond2 $internal_ref_cond_prod
			GROUP BY d.po_break_down_id,a.job_no,c.color_number_id");

		}
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("job_no")]][$crtn[csf("color_number_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		}
		// print_r($carton_arr);
		// ===================== sub contract query start here ===========================
		$str_po_cond_subcon="";
		$str_po_cond_subcon2="";
		if($txt_datefrom!="" &&  $txt_dateto!="") { $str_po_cond_subcon .=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'"; $str_po_cond_subcon2.=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'";}
		if(str_replace("'", "",$cbo_company_name)!=0)
		{
			$str_po_cond_subcon.=" and b.company_id=$cbo_company_name";
			$str_po_cond_subcon2.=" and a.company_id=$cbo_company_name";
		}
		if(str_replace("'", "",$cbo_buyer_name)!=0) $str_po_cond_subcon.=" and b.party_id=$cbo_buyer_name";
		if(str_replace("'", "",$cbo_location)!=0) $str_po_cond_subcon.=" and b.location_id=$cbo_location";
		if(str_replace("'", "",$txt_style_ref)!="") $str_po_cond_subcon.=" and b.job_no_prefix_num=$txt_style_ref";
		if(str_replace("'", "",$txt_order)!="") $str_po_cond_subcon.=" and c.order_no=$txt_order";
		if($db_type==0) $select_job_year_subcon="year(b.insert_date) as job_year"; else $select_job_year_subcon="to_char(b.insert_date,'YYYY') as job_year";
		$sub_con_po_wise_qty_sql="SELECT c.id,sum(b.qnty) as order_quantity,sum(b.plan_cut) as plan_cut  from subcon_ord_mst a,  subcon_ord_dtls c,subcon_ord_breakdown b where c.status_active=1 and c.is_deleted=0 and c.id=b.order_id and c.job_no_mst=a.subcon_job and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 $str_po_cond_subcon2  group by  c.id";
		foreach(sql_select($sub_con_po_wise_qty_sql) as $key=>$vals)
		{
			$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"]=$vals[csf("order_quantity")];
			$sub_con_po_wise_qty_arr[$vals[csf("id")]]["plan"]=$vals[csf("plan_cut")];
		}

	    $subcon_sql="SELECT c.id,b.company_id,b.party_id as buyer_name,c.order_no as po_number,b.subcon_job as job_no,b.job_no_prefix_num ,$select_job_year_subcon,c.cust_style_ref as style_ref_no,e.item_id as item_number_id,sum(e.qnty) as po_quantity,c.delivery_date as country_ship_date,sum(e.plan_cut) as plan_cut,sum(case when d.production_type=1 then d.prod_qnty else 0 end ) as cutting_qnty,sum(case when d.production_type=2 then d.prod_qnty else 0 end) as sewing_out,sum(case when d.production_type=3 then d.prod_qnty else 0 end) as iron_qnty,sum(case when d.production_type=5 then d.prod_qnty else 0 end) as poly_qnty,sum(case when d.production_type=4 then d.prod_qnty else 0 end) as finishing_qnty FROM subcon_gmts_prod_dtls a,subcon_gmts_prod_col_sz d, subcon_ord_mst b, subcon_ord_dtls c ,subcon_ord_breakdown e
				WHERE a.id=d.dtls_id and a.order_id=c.id and c.job_no_mst=b.subcon_job and a.status_active=1 and a.is_deleted=0   and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and e.id=d.ord_color_size_id and e.order_id=c.id and a.order_id=e.order_id $str_po_cond_subcon
				group by c.id,b.company_id,b.party_id ,c.order_no ,b.subcon_job ,b.job_no_prefix_num ,b.insert_date,c.cust_style_ref ,e.item_id ,c.delivery_date";

	    $subcon_ex_sql="SELECT b.party_id ,sum(y.delivery_qty) as qtys FROM subcon_delivery_mst x,subcon_delivery_dtls y,subcon_ord_mst b, subcon_ord_dtls c WHERE x.id=y.mst_id and x.status_active=1   and c.job_no_mst=b.subcon_job and c.id=y.order_id $str_po_cond_subcon and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  GROUP BY b.party_id";
		foreach(sql_select($subcon_ex_sql) as $rows)
		{
			$party_arr_ex[$rows[csf("party_id")]]+=$rows[csf("qtys")];
			//$party_arr_ex_ground["ex"]+=$rows[csf("qtys")];
		}

		$subcon_ex_date="SELECT y.order_id,max(x.delivery_date) as delivery_date ,sum(y.delivery_qty) as qtys FROM subcon_delivery_mst x,subcon_delivery_dtls y,subcon_ord_mst b,  subcon_ord_dtls c WHERE x.id=y.mst_id and x.status_active=1   and c.id=y.order_id $str_po_cond_subcon and c.status_active=1 and c.is_deleted=0    and c.job_no_mst=b.subcon_job  GROUP BY y.order_id";
		foreach(sql_select($subcon_ex_date) as $rows)
		{
			$subcon_ex_date_arr[$rows[csf("order_id")]]["qtys"]=$rows[csf("qtys")];
			$subcon_ex_date_arr[$rows[csf("order_id")]]["date"]=$rows[csf("delivery_date")];
 		}

		//print_r($party_arr_ex);die;
		foreach(sql_select($subcon_sql) as $vals)
		{
			$party_arr[$vals[csf("buyer_name")]]["po_quantity"]+=$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"];
			$party_arr[$vals[csf("buyer_name")]]["cutting_qnty"]+=$vals[csf("cutting_qnty")];
			$party_arr[$vals[csf("buyer_name")]]["sewing_out"]+=$vals[csf("sewing_out")];
			$party_arr[$vals[csf("buyer_name")]]["iron_qnty"]+=$vals[csf("iron_qnty")];
			$party_arr[$vals[csf("buyer_name")]]["poly_qnty"]+=$vals[csf("poly_qnty")];
			$party_arr[$vals[csf("buyer_name")]]["finishing_qnty"]+=$vals[csf("finishing_qnty")];
			$party_ground_total["po_quantity"]+=$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"];
			$party_ground_total["cutting_qnty"]+=$vals[csf("cutting_qnty")];
			$party_ground_total["sewing_out"]+=$vals[csf("sewing_out")];
			$party_ground_total["iron_qnty"]+=$vals[csf("iron_qnty")];
			$party_ground_total["poly_qnty"]+=$vals[csf("poly_qnty")];
			$party_ground_total["finishing_qnty"]+=$vals[csf("finishing_qnty")];
			$party_arr_ex_ground["ex"]+=$party_arr_ex[$vals[csf("buyer_name")]];
		}

		$subcon_buyer_html="";
		$subcon_html="";
		// if(count(sql_select($subcon_sql))>0)
		// {
		// 	$i=1;
		// 	$subcon_html.="<tr> <th colspan='53' align='left'> Sub-Contract Production</th> </tr>";
		// 	foreach(sql_select($subcon_sql) as $key=>$orderRes)
		// 	{
		// 		if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

		// 		$subcon_html.="<tr bgcolor='$bgcolor' onclick=change_color('tr33_2nd$i','$bgcolor') id=tr33_2nd$i>";
		// 		if ($shortage<0) {
		// 		$shortage="(".ltrim($shortage,"-").")";
		// 		}
		// 		$subcon_html.='<td width="30"><p>'.$i.'</p></td>
		// 			<td width="100"><p>'. $company_library[$orderRes[csf("company_id")]].'</p></td>
		// 			<td width="100"><p>'.$company_library[$orderRes[csf("company_id")]].'</p></td>
		// 			<td width="130"><p>'.$orderRes[csf("po_number")].'</p></td>
		// 			<td width="80"><p>'.$orderRes[csf("is_confirmed")].'</p></td>
		// 			<td width="60"><p>'.$buyer_short_library[$orderRes[csf("buyer_name")]].'</p></td>

		// 			<td width="100" align="center"><p>'.$orderRes[csf("job_no")].'</p></td>
		// 			<td width="80" align="center"><p>'.$orderRes[csf("job_no_prefix_num")].'</p></td>
		// 			<td width="120"><p>'.$orderRes[csf("style_ref_no")].'</p></td>
		// 			<td width="130"><p>'.$garments_item[$orderRes[csf("item_number_id")]].'</p></td>
		// 			<td width="80" align="right"><p>'.$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"].'</p></td>
		// 			<td width="80" align="center" bgcolor="'.$color.'"><div style="word-wrap:break-word; width:50px">'.change_date_format($orderRes[csf("country_ship_date")]).'&nbsp;</div></td>



		// 			<td width="80" align="right"><p>'.change_date_format($subcon_ex_date_arr[$orderRes[csf("id")]]["date"]).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("excess_cut")],2)." %".'&nbsp;</p></td>
		// 			<td width="80" align="right"><p>'.number_format($sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["plan"],2).'&nbsp;</p></td>
		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("lay_cut")],2).'&nbsp;</p></td>
		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("cutting_qnty")],0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("cutting_bal_qnty")],0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($short_excess_cut_qnty,2).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>


		// 			<td width="80" align="right"><p>'.number_format($print_issue_inhouse,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($print_issue_subcon,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($print_rcv_inhouse,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($print_rcv_subcon,0).'</p></td>


		// 			<td width="80" align="right"><p>'.number_format($emb_issue_inhouse,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($emb_issue_subcon,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($emb_rcv_inhouse,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($emb_rcv_subcon,0).'</p></td>



		// 			<td width="80" align="right"><p>'.number_format($spwork_issue,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($spcial_rec,0).'</p></td>

		// 			<td width="80" align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($sewingin_qnty,0).'</p></td>
		// 			<td width="80" align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($orderRes[csf("sewing_out")],0).'</p></td>

		// 			<td width="80" align="right"><p>'.number_format($sewingin_subcon,0).'</p></a></td>
		// 			<td width="80" align="right"><p>'.number_format($sewingout_subcon,0).'</p></td>


		// 			<td width="80" align="right"><p>'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("sewing_out")],0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($wash_issue,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($wash_rec,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("iron_qnty")],0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>


		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("poly_qnty")],0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($finish_qnty_outbound,0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("poly_qnty")],0).'</p></td>

		// 			<td width="80" align="right"><p>'.number_format(($orderRes[csf("poly_qnty")]*100)/$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"],2)." %".'</p></td>

		// 			<td width="80" align="right"><p>'.number_format($orderRes[csf("finishing_qnty")],0).'</td>
		// 			<td width="80" align="right">'.number_format($testt,0).'</p></td>
		// 			<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
		// 			<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
		// 			<td width="80"  align="right"><p>'.number_format($orderRes[csf("finishing_qnty")],0).'</p></td>
		// 			<td width="80"  align="right"><p>'.number_format(($orderRes[csf("finishing_qnty")]*100)/$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"],2).' %</p></td>
		// 			<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
		// 			<td width="80"  align="right"><p>'.number_format($subcon_ex_date_arr[$orderRes[csf("id")]]["qtys"],0).'</p></td>
		// 			<td width="80" align="right"><p>'.number_format($shortage,0).'</p></td>
		// 			<td width="80"  align="right" width="85"><p>'.number_format($shortages,0).'</p></td>
		// 			<td align="right"><p>'.$shortages.'</p></td>
		// 		</tr>';
		// 		$i++;
		// 	}
		// }

		if(count($party_arr)>0)
		{
			$subcon_buyer_html.='<tr> <th align="left" colspan="25"> Sub-Contract Production </th> </tr>';
			$i=1;
			foreach($party_arr as $buyer_id=>$value)
			{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

				$subcon_buyer_html.='
				<tr bgcolor="'.$bgcolor.'"  onClick="change_color(\'tr22_'.$i."'".', '."'".$bgcolor."'".')" id="tr_'.$i.'"  >
					<td width="30">'.$i.'</td>

					<td width="80">'.$buyer_short_library[$buyer_id].'</td>
					<td width="80" align="right">'.number_format($value["po_quantity"]).'</td>
					<td width="80" align="right">'. number_format($value["lay_qnty"]).'</td>
					<td width="80" align="right">'. number_format($value["cutting_qnty"]).'</td>
					<td width="80" align="right">'. number_format($value["print"]).'</td>
					<td width="80" align="right">'. number_format($value["print_rec"]).'</td>
					<td width="80" align="right">'. number_format($value["emb"]).'</td>
					<td width="80" align="right">'. number_format($value["emb_rec"]).'</td>
					<td width="80" align="right">'. number_format($value["emb_rec"]).'</td>
					<td width="80" align="right">'.  number_format($value["wash"]).'</td>
					<td width="80" align="right">'.  number_format($value["wash_rec"]).'</td>
					<td width="80" align="right">'.  number_format($value["spwork"]).'</td>
					<td width="80" align="right">'.  number_format($value["spwork_rec"]).'</td>
					<td width="80" align="right">'. number_format($value["sQty"]).'</td>
					<td width="80" align="right">'. number_format($value["soQty"]).'</td>
					<td width="80" align="right">'. number_format($value["sewing_out"]).'</td>
					<td width="80" align="right">'. number_format($value["sQty"]).'</td>
					<td width="80" align="right">'.  number_format($value["sewing_out"]).'</td>
					<td width="80" align="right">'.  number_format($value["soQty"]+$value["iron_qnty"]).'</td>

					<td width="80" align="right">'. number_format($value["poly_qnty"]).'</td>
                    <td width="80" align="right">'.  number_format( ($value["poly_qnty"]*100)/$value["po_quantity"],2 ).'</td>

					<td width="80" align="right">'.  number_format($value["finishing_qnty"],2).'</td>
					<td width="80" align="right">'.  number_format( ($value["finishing_qnty"]*100)/$value["po_quantity"] ,2).'</td>

					<td width="80" align="right">'. number_format($party_arr_ex[$buyer_id],2).'</td>
					<td  align="right">'.  number_format( ($party_arr_ex[$buyer_id]*100)/$value["po_quantity"] ,2).'</td>

				</tr>';
				$i++;
			}
		}
		$sql_cutlay="SELECT a.job_no,a.entry_form,b.order_id as po_id,b.gmt_item_id as gmts,c.order_id,sum(c.size_qty ) as qty,b.color_id  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,GBL_TEMP_ENGINE d  where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id =d.ref_val and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name and d.entry_form=21 and d.ref_from=6 and d.user_id=$user_id group by a.entry_form,b.order_id,b.gmt_item_id,c.order_id,b.color_id,a.job_no";
		// echo $sql_cutlay;die;
		$sql_res=sql_select($sql_cutlay);
		$cutQntyArr=array();
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			if($entry_form!=76)
			{
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]]+=$vals[csf("qty")];

			}
			else
			{
				$cut_lay_arrs[$vals[csf("po_id")]][$vals[csf("gmts")]]+=$vals[csf("qty")];

			}
			$cutQntyArr[$vals[csf("job_no")]][$vals[csf("color_id")]]+=$vals[csf("qty")];
		}
		// print_r($cut_lay_arrs)	; die;
		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['cQty']+=$gmtsRow[csf('cutting_qnty')];//+$gmtsRow[csf('replace_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['pQty']+=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print']+=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb']+=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['washiss']+=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['special']+=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['prQty']+=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print']+=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb']+=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['washrec']+=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['special']+=$gmtsRow[csf('specialr')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['spc_qty']+=$gmtsRow[csf('issue_spc_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['issue_wash']+=$gmtsRow[csf('issue_wash_qty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_issue_inhouse']+=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_issue_subcon']+=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_rcv_inhouse']+=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['print_rcv_subcon']+=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_issue_inhouse']+=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_issue_subcon']+=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_rcv_inhouse']+=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['emb_rcv_subcon']+=$gmtsRow[csf('emb_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['sQty']+=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['soQty']+=$gmtsRow[csf('sewingout_qnty_in')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['subcon_sewingin']+=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['subcon_sewingout']+=$gmtsRow[csf('sewingout_qnty_out')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['all_sewingout']+=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['iQty']+=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['riQty']+=$gmtsRow[csf('re_iron_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['finish_qnty_inhouse']+=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['finish_qnty_outbound']+=$gmtsRow[csf('finish_qnty_outbound')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['crQty']+=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['sorQty']+=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['frQty']+=$gmtsRow[csf('finish_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyRej']+=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['rej_qnty']+=$gmtsRow[csf('rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyInQty']+=$gmtsRow[csf('poly_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyOutQty']+=$gmtsRow[csf('poly_outbound')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['polyQty']+=$gmtsRow[csf('poly_qty')];

			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['trans_in_qty']+=$gmtsRow[csf('trans_in_qty')];
			$gmts_prod_arr[$gmtsRow[csf('job_no')]][$gmtsRow[csf('color_number_id')]]['trans_out_qty']+=$gmtsRow[csf('trans_out_qty')];
		}
		// echo "<pre>";print_r($gmts_prod_arr);die;
		unset($res_gmtsData);

		/*$po_transfer_in_sql=sql_select("select to_po_id,production_quantity,color_number_id from pro_gmts_delivery_dtls where status_active=1 and is_deleted=0");
		foreach($po_transfer_in_sql as $vals)
		{
			$po_transfer_in_arr[$vals[csf("to_po_id")]][$vals[csf("color_number_id")]]+=$vals[csf("production_quantity")];
		}

		$po_transfer_out_sql=sql_select("select from_po_id,production_quantity,color_number_id from pro_gmts_delivery_dtls where status_active=1 and is_deleted=0");
		foreach($po_transfer_out_sql as $vals)
		{
			$po_transfer_out_arr[$vals[csf("from_po_id")]][$vals[csf("color_number_id")]]+=$vals[csf("production_quantity")];
		}
		//echo "<pre>";print_r($po_transfer_in_arr);echo "</pre>";
		//echo "<pre>";print_r($po_transfer_out_arr);echo "</pre>";die;
		unset($po_transfer_in_sql);
		unset($po_transfer_out_sql);*/



		$fromDate = change_date_format( str_replace("'","",trim($txt_date_from)) );
		$toDate = change_date_format( str_replace("'","",trim($txt_date_to)) );
		$buyer_array=array();
		$result=sql_select($order_sql);
		$data_arr = array();
		$check_order = array();
		foreach ($result as $key => $val)
		{
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['job_num'] = $val[csf('job_no_prefix_num')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['style_ref_no'] = $val[csf('style_ref_no')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['grouping'] = $val[csf('grouping')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['buyer_name'] = $val[csf('buyer_name')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['style_qty'] += $val[csf('order_quantity')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['plan_cut'] += $val[csf('plan_cut_qnty')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['excess_cut'] += $val[csf('excess_cut')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['shiping_status'] = $val[csf('shiping_status')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['company_name'] = $val[csf('company_name')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['item_number_id'] = $val[csf('item_number_id')];
			$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['id'] = $val[csf('id')];
			// echo $val[csf('id')];
			if($check_order[$val[csf('job_no')]][$val[csf('color_number_id')]][$val[csf('id')]] != $val[csf('id')])
			{
				$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['order_no'] .= $val[csf('po_number')].",";
				$data_arr[$val[csf('job_no')]][$val[csf('color_number_id')]]['po_no'] .= $val[csf('id')].",";
				$check_order[$val[csf('job_no')]][$val[csf('color_number_id')]][$val[csf('id')]] = $val[csf('id')];
			}
		}
		// unset($check_order);
		// print_r($check_order);
		// echo "<pre>";
		// print_r($data_arr);

		$i=0; $k=0;
		$days_in_hand="";
		foreach($data_arr as $job_no=>$job_data)
		{
			foreach ($job_data as $color_id => $orderRes)
			{
		  	 	$i++;
		   		if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

		   			$po_quantity_in_pcs=$orderRes["style_qty"];

					$ex_factory_date=$ex_factory_arr[$job_no][$color_id]['date'];
					$ex_factory_qnty=$ex_factory_arr[$job_no][$color_id]['qty'];
					$ex_factory_carton_qnty=$ex_factory_arr[$job_no][$color_id]['ex_fac_carton_qty'];

					$cutting_qnty=$gmts_prod_arr[$job_no][$color_id]['cQty'];
					$embl_recv_qnty=$gmts_prod_arr[$job_no][$color_id]['prQty'];
					$sewingin_qnty=$gmts_prod_arr[$job_no][$color_id]['sQty'];
					$sewingout_qnty=$gmts_prod_arr[$job_no][$color_id]['soQty'];
					$sewingin_subcon=$gmts_prod_arr[$job_no][$color_id]['subcon_sewingin'];
					$sewingout_subcon=$gmts_prod_arr[$job_no][$color_id]['subcon_sewingout'];
					$iron_qnty=$gmts_prod_arr[$job_no][$color_id]['iQty'];
					$re_iron_qnty=$gmts_prod_arr[$job_no][$color_id]['riQty'];
					$polyInQnty=$gmts_prod_arr[$job_no][$color_id]['polyInQty'];
					$polyOutQnty=$gmts_prod_arr[$job_no][$color_id]['polyOutQty'];
					$poly_qnty=$gmts_prod_arr[$job_no][$color_id]['polyQty'];
					$finish_qnty_inhouse=$gmts_prod_arr[$job_no][$color_id]['finish_qnty_inhouse'];
					$finish_qnty_outbound=$gmts_prod_arr[$job_no][$color_id]['finish_qnty_outbound'];

					$trans_in_qty=$gmts_prod_arr[$job_no][$color_id]['trans_in_qty'];
					$trans_out_qty=$gmts_prod_arr[$job_no][$color_id]['trans_out_qty'];

					$cartonInQnty=$carton_arr[$job_no][$color_id]['carton_qty_no_inhouse'];
					$cartonOutQnty=$carton_arr[$job_no][$color_id]['carton_qty_no_outbound'];
					$cartonTotal_qnty=$carton_arr[$job_no][$color_id]['carton_total_qty'];

					$finish_qnty_transferIn=$po_transfer_in_arr[$job_no][$color_id];
					$finish_qnty_transferOut=$po_transfer_out_arr[$job_no][$color_id];

					$print_issue_inhouse=$gmts_prod_arr[$job_no][$color_id]['print_issue_inhouse'];
					$print_issue_subcon=$gmts_prod_arr[$job_no][$color_id]['print_issue_subcon'];
					$print_rcv_inhouse=$gmts_prod_arr[$job_no][$color_id]['print_rcv_inhouse'];
					$print_rcv_subcon=$gmts_prod_arr[$job_no][$color_id]['print_rcv_subcon'];

					$emb_issue_inhouse=$gmts_prod_arr[$job_no][$color_id]['emb_issue_inhouse'];
					$emb_issue_subcon=$gmts_prod_arr[$job_no][$color_id]['emb_issue_subcon'];
					$emb_rcv_inhouse=$gmts_prod_arr[$job_no][$color_id]['emb_rcv_inhouse'];
					$emb_rcv_subcon=$gmts_prod_arr[$job_no][$color_id]['emb_rcv_subcon'];

					$print_issue=$gmts_prod_arr[$job_no][$color_id]['print'];
					$cut_lays=$cutQntyArr[$job_no][$color_id] ;
					$embl_issue=$gmts_prod_arr[$job_no][$color_id]['emb'];
					$wash_issue=$gmts_prod_arr[$job_no][$color_id]['washiss'];
					$spwork_issue=$gmts_prod_arr[$job_no][$color_id]['special'];

					$spc_qty_issue=$gmts_prod_arr[$job_no][$color_id]['spc_qty'];
					$wash_qty_issue=$gmts_prod_arr[$job_no][$color_id]['issue_wash'];

					$print_rec=$gmts_prod_arr[$job_no][$color_id]['print'];
					$emb_rec=$gmts_prod_arr[$job_no][$color_id]['emb'];
					$wash_rec=$gmts_prod_arr[$job_no][$color_id]['washrec'];
					$spcial_rec=$gmts_prod_arr[$job_no][$color_id]['special'];
					$buyer_array[$orderRes["buyer_name"]]['print']+=$print_issue;
 					$buyer_array[$orderRes["buyer_name"]]['cut_lays']+=$cut_lays;
					$buyer_array[$orderRes["buyer_name"]]['emb']+=$embl_issue;
					$buyer_array[$orderRes["buyer_name"]]['wash']+=$wash_issue;
					$buyer_array[$orderRes["buyer_name"]]['spwork']+=$spwork_issue;
					$buyer_array[$orderRes["buyer_name"]]['print_rec']+=$print_rec;
					$buyer_array[$orderRes["buyer_name"]]['emb_rec']+=$emb_rec;
					$buyer_array[$orderRes["buyer_name"]]['wash_rec']+=$wash_rec;
					$buyer_array[$orderRes["buyer_name"]]['spwork_rec']+=$spcial_rec;
					$buyer_array[$orderRes["buyer_name"]]['poQty']+=$po_quantity_in_pcs;
					$buyer_array[$orderRes["buyer_name"]]['poVal']+=$po_quantity_in_pcs*$unit_price;
					$buyer_array[$orderRes["buyer_name"]]['ex']+=$ex_factory_qnty;
					$buyer_array[$orderRes["buyer_name"]]['cQty']+=$cutting_qnty;
					$buyer_array[$orderRes["buyer_name"]]['prQty']+=$embl_recv_qnty;
					$buyer_array[$orderRes["buyer_name"]]['sQty']+=$sewingin_qnty;
					$buyer_array[$orderRes["buyer_name"]]['soQty']+=$sewingout_qnty;
					$buyer_array[$orderRes["buyer_name"]]['subcon_sewing']+=$sewingin_subcon;
					$buyer_array[$orderRes["buyer_name"]]['subcon_sewout']+=$sewingout_subcon;
					$buyer_array[$orderRes["buyer_name"]]['iQty']+=$iron_qnty;
					$buyer_array[$orderRes["buyer_name"]]['reiQty']+=$re_iron_qnty;
					$buyer_array[$orderRes["buyer_name"]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
					$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$trans_in_qty-$trans_out_qty;
					$actual_exces_cut = $gmts_prod_arr[$job_no][$color_id]['cQty'];
					$buyer_array[$orderRes["buyer_name"]]['polyQty']+=$poly_qnty;
					if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";

					$plan_cut_qnty=$orderRes["plan_cut"];
					$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
					$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);

					//$rej_value=$proRes["finish_rej_qnty")]+$proRes["sewingout_rej_qnty")];
					$rej_value=$gmts_prod_arr[$job_no][$color_id]['rej_qnty'];
					$cut_rej_value=$gmts_prod_arr[$job_no][$color_id]['crQty'];

					$tot_order_qty+=$orderRes["style_qty"];
					$tot_plan_qty+=$orderRes["plan_cut"];
					$tot_cutting_qnty+=$cutting_qnty;
					$tot_short_excess_cut+=$short_excess_cut_qnty;
					$tot_print_issue_inhouse+=$print_issue_inhouse;
					$tot_print_issue_subcon+=$print_issue_subcon;
					$tot_print_rcv_inhouse+=$print_rcv_inhouse;
					$tot_print_rcv_subcon+=$print_rcv_subcon;
					$tot_emb_issue_inhouse+=$emb_issue_inhouse;
					$tot_emb_issue_subcon+=$emb_issue_subcon;
					$tot_emb_rcv_inhouse+=$emb_rcv_inhouse;
					$tot_emb_rcb_subcon+=$emb_rcv_subcon;
					$tot_spc_qty_issue+=$spc_qty_issue;
					$tot_spcial_rec+=$spcial_rec;
					$tot_sewingin_qnty+=$sewingin_qnty;
					$tot_sewingout_qnty+=$sewingout_qnty;
					$tot_sewingin_subcon+=$sewingin_subcon;
					$tot_sewingout_subcon+=$sewingout_subcon;
					$tot_wash_qty_issue+=$wash_qty_issue;
					$tot_wash_rec+=$wash_rec;
					$tot_poly_in+=$polyInQnty;
					$tot_poly_out+=$polyOutQnty;
					$tot_poly_qnty+=$poly_qnty;
					$tot_finish_in+=$finish_qnty_inhouse;
					$tot_finish_out+=$finish_qnty_outbound;
                    $tot_finish_qnty+=$total_finish_qnty;
					$tot_ex_factory+=$ex_factory_qnty;

					//$gmts_prod_arr[$orderRes["id")]][$item_id]['crQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['sorQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['frQty']+$gmts_prod_arr[$orderRes["id")]][$item_id]['polyRej'];
					$shortage = 0; $excess = 0; $balance = 0;
					if($orderRes["shiping_status"]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
					{
						$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

						if($shortage<0)
						{
							//$shortage = "".ltrim($shortage,"-")."";
						}
					}
					else
					{
						//$shortage="(".ltrim($shortage,"-").")";
						//$shortage = "-";
					}

					if($orderRes["shiping_status"]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
					{
						$excess = $ex_factory_qnty-$po_quantity_in_pcs;
					}
					else
					{
						$excess = 0;
					}

					$balance = $ex_factory_qnty-$po_quantity_in_pcs;

					$tot_shortge+=$shortage;
					$tot_excess+=$excess;
					$tot_balance+=$balance;

					$poly_status = $poly_qnty*100/$po_quantity_in_pcs;
					$finish_status = ($total_finish_qnty*100)/$po_quantity_in_pcs;

					$tot_poly_status+=$poly_status;
					$tot_finish_status+=$finish_status;
					if($j==0)
					{
						$display_font_color="";
						$font_end="";
					}
					else
					{
						$display_font_color="&nbsp;<font style='display:none'>";
						$font_end="</font>";
					}

					$company_name=$orderRes["company_name"];
					$po_id=$job_no;
					if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);
					if($orderRes["shiping_status"]==3) $days_remian=$days_remian; else $days_remian="---";
					if(round($actual_exces_cut) > round($orderRes["excess_cut"])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
					$total_rej_value+=$rej_value;
					$template_id=$template_id_arr[$orderRes['id']];
					$cutlay=$cutQntyArr[$job_no][$color_id] ;
					$tot_cut_lay+=$cutlay;
				   	$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$i','$bgcolor') id=tr_2nd$i>";
					$html.='<td style="word-wrap: break-word;word-break: break-all;" style="word-wrap: break-word;word-break: break-all;" width="30">'.$display_font_color.$i.$font_end.'</td>

						<td style="word-wrap: break-word;word-break: break-all;" width="100">'.$display_font_color.$orderRes["style_ref_no"].$font_end.'</td>

						<td style="word-wrap: break-word;word-break: break-all;" width="100">'.$display_font_color.$buyer_short_library[$orderRes["buyer_name"]].$font_end.'</td>

						<td style="word-wrap: break-word;word-break: break-all;" width="100"><p>'.$display_font_color.$job_no.$font_end.'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="100"><p>'.$display_font_color.$orderRes["grouping"].$font_end.'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="150"><a href="##" onclick="job_progress_comment_popup('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."','".$template_id."',".$tna_process_type.')">'.$display_font_color.chop($orderRes["order_no"],",").$font_end.'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="100"><p>'.$display_font_color.$color_Arr_library[$color_id].$font_end.'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_order('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'JobColorOrderPopup'".')">'.$display_font_color.$orderRes["style_qty"].$font_end.'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.$display_font_color.$orderRes["plan_cut"].$font_end.'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'17','1','JobColorProdPopup'".')">'.$display_font_color.$cutlay.$font_end.'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'1','1','JobColorProdPopup'".')">'.$display_font_color.$cutting_qnty.$font_end.'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.$short_excess_cut_qnty.'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','1*1','JobColorProdPopup'".')">'.number_format($print_issue_inhouse,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','3*1','JobColorProdPopup'".')">'.number_format($print_issue_subcon,0).'&nbsp;</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','1*1','JobColorProdPopup'".')">'.number_format($print_rcv_inhouse,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','3*1','JobColorProdPopup'".')">'.number_format($print_rcv_subcon,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','1*2','JobColorProdPopup'".')">'.number_format($emb_issue_inhouse,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','3*2','JobColorProdPopup'".')">'.number_format($emb_issue_subcon,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','1*2','JobColorProdPopup'".')">'.number_format($emb_rcv_inhouse,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','3*2','JobColorProdPopup'".')">'.number_format($emb_rcv_subcon,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.number_format($spc_qty_issue,0).'</p></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.number_format($spcial_rec,0).'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'4','1','JobColorProdPopup'".')">'.number_format($sewingin_qnty,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'5','1','JobColorProdPopup'".')">'.number_format($sewingout_qnty,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'4','3','JobColorProdPopup'".')">'.number_format($sewingin_subcon,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'5','3','JobColorProdPopup'".')">'.number_format($sewingout_subcon,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'4','','JobColorProdPopup'".')">'.number_format(($sewingin_subcon+$sewingin_qnty),0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'5','','JobColorProdPopup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'2','3','JobColorProdPopup'".')">'.number_format($wash_qty_issue,0).'</a></p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'3','3','JobColorProdPopup'".')">'.number_format($wash_rec,0).'</a></p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'11','1','JobColorProdPopup'".')">'.number_format($polyInQnty,0).'</a></p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'11','3','JobColorProdPopup'".')">'.number_format($polyOutQnty,0).'</a></p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right">'.$poly_qnty.'</td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right">'.number_format($poly_status,2)." %".'</td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.number_format($finish_qnty_inhouse,0).'<br/>'.'Ctn: '.$cartonInQnty.'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.number_format($finish_qnty_outbound,0).'<br/>'.'Ctn: '.$cartonOutQnty.'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'8','','JobColorProdPopup'".')">'.number_format($total_finish_qnty,0).'</a></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.number_format($finish_status,2)." %".'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'$type','','JobColorProdPopup'".')">'.number_format($rej_value,0).'</a></p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p><a href="##" onclick="openmypage_job_color_prod('.$company_name.",'".$job_no."','".chop($orderRes['po_no'],',')."',".$color_id.",'10','1','JobColorProdPopup'".')">'.number_format($ex_factory_qnty,0).'</a></p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.$shortage.'</p></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.$excess.'</p></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" align="right"><p>'.$balance.'</p></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80">&nbsp;'.$shipment_status[$orderRes["shiping_status"]].'</td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80">&nbsp;<a href="##" onclick="openmypage_job_color_remark('.$orderRes['job_num'].",'".$job_no."','".chop($orderRes['po_no'],',')."','".$color_id."','job_color_wise_remarks'".')">Remarks</a></td>
					</tr>';

			}
		}
		//=================================== Delete Order Id From TEMP ENGINE ====================================
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 21 and ref_from=6");
		oci_commit($con);
		disconnect($con);
  		?>
		<div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						<? echo "Order Wise RMG Production Status"; ?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						Company Name : <? echo $company_library[str_replace("'","",$cbo_company_name)]; ?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">
						<?
							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								echo "From $fromDate To $toDate" ;
							}
						?>
					</td>
				</tr>
			</table>
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:2010px">This Report is Generated based on Published Ship Date.</div>
			<div style="float:left; width:2090px">
				<table width="2040" cellspacing="0" border="1" class="rpt_table" rules="all" id="" >
					<thead>
						 <tr>
							<th rowspan="2" width="30">Sl.</th>
							<th rowspan="2" width="80">Buyer Name</th>
							<th rowspan="2" width="80">Order Qty.(Pcs)</th>
							<th rowspan="2" width="80">Lay Qty.</th>
							<th rowspan="2" width="80"> Cutting QC Qty</th>
							<th rowspan="2" width="80">Sent to Print</th>
							<th rowspan="2" width="80">Rcv Print</th>
							<th rowspan="2" width="80">Sent to Emb</th>
							<th rowspan="2"  width="80">Rcv Emb</th>
							<th rowspan="2" width="80">Sent to Wash</th>
							<th rowspan="2" width="80">Rcv Wash</th>
							<th rowspan="2"  width="80">Sent to Sp. Works</th>
							<th rowspan="2" width="80">Rcv Sp. Works</th>
							<th width="160" colspan="2">InHouse</th>
							<th width="160" colspan="2">Sub-Contact</th>
							<th rowspan="2" width="80">Total Sewing Input Qty</th>
							<th rowspan="2" width="80">Total Sewing Output Qty</th>
							<th rowspan="2" width="80">Total Iron Qty</th>
                            <th rowspan="2" width="80">Total Poly Qty</th>
							<th rowspan="2" width="80">Poly Comp %</th>
							<th rowspan="2" width="80">Total Finish Qty</th>
							<th rowspan="2"  width="80">Fin Comp %</th>
							<th rowspan="2" width="80">Ex-Fac</th>
							<th rowspan="2" >Ex-Fac%</th>
						 </tr>
						<tr>
							<th  width="80">Sew Input.</th>
							<th  width="80">Sew OutPut </th>
							<th  width="80">Sew Input.</th>
							<th  width="80">Sew OutPut </th>
						 </tr>
					</thead>
				</table>
				<div style="max-height:425px; overflow-y:scroll; width:2060px" >
					<table cellspacing="0" border="1" class="rpt_table"  width="2040" rules="all" id="" >
					<?
						$i=1; $total_po_quantity=0;$total_po_value=0; $total_cut=0; $total_print_iss=0;$total_lay=0;
						$total_print_re=0; $total_sew_input=0; $total_sew_out=0; $total_iron=0; $total_re_iron=0; $total_finish=0;$total_ex_factory=0;
						foreach($buyer_array as $buyer_id=>$value)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="80"><? echo $buyer_short_library[$buyer_id]; ?></td>
								<td width="80" align="right"><? echo number_format($value["poQty"]);?></td>

								<td width="80" align="right"><? echo number_format($value["cut_lays"]) ; ?></td>
								<td width="80" align="right"><? echo number_format($value["cQty"]); ?></td>

								<td width="80" align="right"><? echo number_format($value["print"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["print_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["emb"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["emb_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["wash"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["wash_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["spwork"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["spwork_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["sQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["soQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["subcon_sewing"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["subcon_sewout"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["sQty"]+$value["subcon_sewing"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["soQty"]+$value["subcon_sewout"]); ?></td>

								<td width="80" align="right"><? echo number_format($value["iQty"]); ?></td>
                                <td width="80" align="right"><? echo number_format($value["polyQty"]); ?></td>
							    <? $poly_gd_status = ($value["polyQty"]/$value["poQty"])*100; ?>
								<td width="80" align="right"><? echo number_format($poly_gd_status,2); ?></td>
								<td width="80" align="right"><? echo number_format($value["fQty"]); ?></td>
								<? $finish_gd_status = ($value["fQty"]/$value["poQty"])*100; ?>
								<td width="80" align="right"><? echo number_format($finish_gd_status,2); ?></td>
								<td width="80" align="right"><? echo number_format($value["ex"]); ?></td>
								<? $ex_gd_status = ($value["ex"]/$value["poQty"])*100; ?>
								<td width="" align="right"><? echo  number_format($ex_gd_status,2); ?></td>
							</tr>
							<?
								$total_po_quantity+=$value["poQty"];
								$total_cut+=$value["cQty"];
								$total_lay+=$value["cut_lays"];
								$total_sent_print+=$value["print"];
								$total_print_re+=$value["print_rec"];
								$total_emb+=$value["emb"];
								$total_emb_re+=$value["emb_rec"];
								$total_wash+=$value["wash"];
								$total_wash_re+=$value["wash_rec"];
								$total_spwork+=$value["spwork"];
								$total_spwork_re+=$value["spwork_rec"];
								$total_sew_input+=$value["sQty"];
								$total_sew_out+=$value["soQty"];
								$total_subcon_sewing+=$value["subcon_sewing"];
								$total_subcon_sewout+=$value["subcon_sewout"];
								$total_iron+=$value["iQty"];
								$total_poly+=$value["polyQty"];
								$total_re_iron+=$value["reiQty"];
								$total_finish+=$value["fQty"];
								$total_ex_factory+=$value["ex"];
							$i++;
						}//end foreach 1st

						$chart_data_qnty="Order Qty;".$total_po_quantity."\n"."Cutting;".$total_cut."\n"."Sew In;".$total_sew_input."\n"."Sew Out ;".$total_sew_out."\n"."Iron ;".$total_iron."\n"."Finish ;".$total_finish."\n"."Ex-Fact;".$total_ex_factory."\n";
						   echo $subcon_buyer_html;
					?>
					</table>
					<table border="1" class="tbl_bottom"  width="2040" rules="all" id="" >
						<tr>
							<td width="30">&nbsp;</td>
							<td width="80" align="right">Total</td>
							<td width="80" id="tot_po_quantity"><? echo number_format($total_po_quantity+$party_ground_total["po_quantity"]); ?></td>
							<td width="80" id="tot_lay"><? echo number_format($total_lay); ?></td>
							<td width="80" id="tot_cutting"><? echo number_format($total_cut+$party_ground_total["cutting_qnty"]); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_sent_print); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_print_re); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_emb); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_emb_re); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_wash); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_wash_re); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_spwork); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_spwork_re); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_sew_input); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_sew_out); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_subcon_sewing); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_subcon_sewout+$party_ground_total["sewing_out"]); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_sew_input+$total_subcon_sewing); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_subcon_sewout+$total_sew_out+$party_ground_total["sewing_out"]); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_iron+$party_ground_total["iron_qnty"]); ?></td>
                            <td width="80" id="tot_poly"><? echo number_format($total_poly+$party_ground_total["poly_qnty"]); ?></td>

                            <? $total_poly_gd_status = ($total_poly/$total_po_quantity)*100; ?>
							<td width="80"><? echo number_format($total_poly_gd_status,2); ?></td >

							<td width="80" id="tot_finish"><? echo number_format($total_finish+$party_ground_total["finishing_qnty"]); ?></td>
							<? $total_finish_gd_status = ($total_finish/$total_po_quantity)*100; ?>
							<td width="80"><? echo number_format($total_finish_gd_status,2); ?></td >
							<td width="80"><? echo number_format($total_ex_factory+$party_arr_ex_ground["ex"]); ?></td >
							<? $total_ex_status = ($total_ex_factory/$total_po_quantity)*100; ?>
							<td width=""><? echo number_format($total_ex_status,2); ?></td>
						</tr>

					 </table>
					 <input type="hidden" id="graph_data" value="<? echo substr($chart_data_qnty,0,-1); ?>"/>
				</div>
			</div>
			<div style="float:left; width:600px">
				<table>
					<tr>
						<td height="21" width="600"><div id="chartdiv"> </div></td>
					</tr>
				</table>
			</div>
			<div style="clear:both"></div>
			<table width="3550" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1">
				<thead>
					<tr>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="30">SL</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="100">Style Name</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="100">Buyer Name</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="100">Job No</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="100">IR/IB</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="150">Order Number</th>
                        <th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="100">Color Name</th>
                        <th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Order Qty.</th>
                        <th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Plan Cut Qty</th>
                        <th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Cut Qty</th>
                        <th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Cutting QC Qty</th>
                        <th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Short/Excess Cut Qty</th>

						<th style="word-wrap: break-word;word-break: break-all;" width="160" colspan="2">Sent to Print</th>
						<th style="word-wrap: break-word;word-break: break-all;" width="160" colspan="2">Rcv Print</th>
						<th style="word-wrap: break-word;word-break: break-all;" width="160" colspan="2">Sent to Emb</th>
						<th style="word-wrap: break-word;word-break: break-all;" width="160" colspan="2">Rcv Emb</th>

						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2"  width="80">Sent to Sp. Works</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Rcv Sp. Works</th>
						<th style="word-wrap: break-word;word-break: break-all;" width="160" colspan="2">InHouse</th>
						<th style="word-wrap: break-word;word-break: break-all;" width="160" colspan="2">Out-bound Sub-Contact</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Total Sewing Input Qty</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Total Sewing Output Qty</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Sent to Wash</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Rcv Wash</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="240" colspan="3">Poly Qty</th>
                        <th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Poly Comp %</th>
						<th style="word-wrap: break-word;word-break: break-all;" width="240" colspan="3">Finish Qty</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Fin Goods Status</th>

						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Reject Qty</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Total Ex-Factory</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Shortage Qty.</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Excess Qty.</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Balance Qty.</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80">Status</th>
						<th style="word-wrap: break-word;word-break: break-all;" rowspan="2" width="80" >Remarks</th>
					 </tr>
					 <tr>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Inhouse</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">SubCon</th>

                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Inhouse</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">SubCon</th>

                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Inhouse</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">SubCon</th>

                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Inhouse</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">SubCon</th>

                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Sew Input.</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Sew OutPut </th>

                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Sew Input.</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Sew OutPut </th>

                        <th style="word-wrap: break-word;word-break: break-all;" width="80">In-house</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Out-bound </th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Total</th>

                        <th style="word-wrap: break-word;word-break: break-all;" width="80">In-house</th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Out-bound </th>
                        <th style="word-wrap: break-word;word-break: break-all;" width="80">Total</th>
					</tr>
				</thead>
			</table>
			<div style="max-height:425px; overflow-y:scroll; width:3570px" id="scroll_body">
				<table border="1" class="rpt_table" width="3550" rules="all" id="table_body">
				<?  echo $html;echo  $subcon_html; ?>
				</table>
				<table border="1" class="tbl_bottom" width="3550" rules="all" id="report_table_footer_1" >
					<tr>
						<td style="word-wrap: break-word;word-break: break-all;" width="30">&nbsp;</td>
                        <td style="word-wrap: break-word;word-break: break-all;" width="100">&nbsp;</td>
                        <td style="word-wrap: break-word;word-break: break-all;" width="100">&nbsp;</td>
						<td style="word-wrap: break-word;word-break: break-all;" width="100">&nbsp;</td>
						<td style="word-wrap: break-word;word-break: break-all;" width="100">&nbsp;</td>
						<td style="word-wrap: break-word;word-break: break-all;" width="150">&nbsp;</td>
						<td style="word-wrap: break-word;word-break: break-all;" width="100">Total</td>

                        <td style="word-wrap: break-word;word-break: break-all;" width="80"  id="td_po_qty"><? echo number_format($tot_order_qty);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_plan_cutting"><? echo number_format($tot_plan_qty);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_lay_cutting"><? echo number_format($tot_cut_lay);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_total_cut"><? echo number_format($tot_cutting_qnty);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_short_excess_cut"><? echo number_format($tot_short_excess_cut);?></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_print_issue_in"><? echo number_format($tot_print_issue_inhouse);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_print_issue_sub"><? echo number_format($print_issue_subcon);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_print_receive_in"><? echo number_format($tot_print_rcv_inhouse);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_print_receive_sub"><? echo number_format($tot_print_rcv_subcon);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_embIss_id"><? echo number_format($tot_emb_issue_inhouse);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_embIss_subcon"><? echo number_format($tot_emb_issue_subcon);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_embRec_in"><? echo number_format($tot_emb_rcv_inhouse);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_embRec_subcon"><? echo number_format($tot_emb_rcb_subcon);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_sp_issue"><? echo number_format($tot_spc_qty_issue);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_sp_receive"><? echo number_format($tot_spcial_rec);?></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_sewing_input"><? echo number_format($tot_sewingin_qnty);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_sewing_out"><? echo number_format($tot_sewingout_qnty);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_sewing_input_sub"><? echo number_format($tot_sewingin_subcon);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_sewing_out_sub"><? echo number_format($tot_sewingout_subcon);?></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_sewing_in"><? echo number_format($tot_sewingin_qnty+$tot_sewingin_subcon);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_sewing_output"><? echo number_format($tot_sewingout_qnty+$tot_sewingout_subcon);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_wash_iss"><? echo number_format($tot_wash_qty_issue);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_wash_rec"><? echo number_format($tot_wash_rec);?></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_poly_in"><? echo number_format($tot_poly_in);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_poly_out"><? echo number_format($tot_poly_out);?></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_poly"><? echo number_format($tot_poly_qnty);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_poly_comp"><? echo number_format($tot_poly_status);?></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_finish_in"><? echo number_format($tot_finish_in);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_finish_sub"><? echo number_format($tot_finish_out);?></td>

						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_finish"><? echo number_format($tot_finish_qnty);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_finish_gd_status"><? echo number_format($tot_finish_status);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_reject"><? echo number_format($total_rej_value);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="total_exfact"><? echo number_format($tot_ex_factory);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80"><span id="total_excess"><? echo number_format($tot_shortge);?></span></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80" id="td_excess"><? echo number_format($tot_excess);?></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80"><span id="td_balance"><? echo number_format($tot_balance);?></span></td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80">&nbsp;</td>
						<td style="word-wrap: break-word;word-break: break-all;" width="80">&nbsp;</td>
					</tr>
				</table>
			</div>
		 </div>
		<?
	}
	else //  order wise
	{
		// echo $type.'kausar'; die;
		$str_po_cond="";
		if($cbo_style_owner_wise_status==2)
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.style_owner=$cbo_company_name";
		}
		else
		{
			if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		}
		//if($cbo_company_name!=0) $str_po_cond.=" and a.company_name=$cbo_company_name";
		if($cbo_buyer_name!=0) $str_po_cond.=" and a.buyer_name=$cbo_buyer_name";
		if($cbo_location>0) $str_po_cond.=" and a.location_name=$cbo_location";
		if($cbo_job_year>0)
		{
			if($db_type==0)
			{
				$str_po_cond .=" and year(a.insert_date)='$cbo_job_year'";
			}
			else
			{
				$str_po_cond .=" and to_char(a.insert_date,'YYYY')='$cbo_job_year'";
			}
		}
		if($txt_style_ref_id!="")
		{
			$str_po_cond.=" and a.id in($txt_style_ref_id)";
		}
		else if($txt_style_ref!="")
		{
			$str_po_cond .=" and a.job_no_prefix_num in($txt_style_ref)";
		}

		if($txt_order_id!="")
		{
			$str_po_cond.=" and b.id in($txt_order_id)";
		}
		else if($txt_order_no!="")
		{
			$str_po_cond .=" and b.po_number in($poNumbers)";
		}

		if($shipping_status!=0 && $shipping_status!=4)
		{
			$str_po_cond .=" and b.shiping_status='$shipping_status'";
		}
		else
		{
			if($shipping_status==4)
			{
				$str_po_cond .=" and b.shiping_status in(1,2)";
			}
			else
			{
				$str_po_cond .=" and b.shiping_status in(1,2,3)";
			}
		}
		$internal_ref_cond_prod=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and c.po_break_down_id in (SELECT id from wo_po_break_down where grouping=$txt_internal_ref and status_active in(1,2,3) and is_deleted=0) ";
		$internal_ref_cond_po=(str_replace("'", "", $txt_internal_ref)=="")? "" : " and b.grouping=$txt_internal_ref ";

		if($txt_datefrom!="" &&  $txt_dateto!="")  $str_po_cond .=" and b.pub_shipment_date between '$txt_datefrom' and '$txt_dateto'";
		if($db_type==0) $select_job_year="year(a.insert_date) as job_year"; else $select_job_year="to_char(a.insert_date,'YYYY') as job_year";
		$order_sql="SELECT b.id, a.job_no_prefix_num,a.job_no, $select_job_year, b.po_number, b.po_quantity, b.unit_price, b.po_total_price, b.job_no_mst, b.pub_shipment_date as shipment_date, b.is_confirmed, b.shiping_status, b.excess_cut, b.plan_cut, a.company_name, a.style_owner, a.buyer_name, a.set_break_down, a.style_ref_no,a.client_id,a.total_set_qnty,b.pack_handover_date
		from wo_po_details_master a, wo_po_break_down b
		where b.job_id=a.id and a.status_active=1 and a.is_deleted=0 $active_cond_b and b.is_deleted=0 $str_po_cond $txt_style_ref_number_cond $internal_ref_cond_po $order_status_cond
		order by b.pub_shipment_date, b.id";

		// $order_sql="SELECT a.id as dtl_mst_id, b.id, a.job_no_prefix_num,a.job_no, $select_job_year, b.po_number, b.po_quantity, b.unit_price, b.po_total_price, b.job_no_mst, b.pub_shipment_date as shipment_date, b.is_confirmed, b.shiping_status, b.excess_cut, b.plan_cut, a.company_name, a.style_owner, a.buyer_name, a.set_break_down, a.style_ref_no,a.client_id,a.total_set_qnty,b.pack_handover_date,sum(c.fin_receive_qnty) as receive_qnty, c.item_id
		// from wo_po_details_master a, wo_po_break_down b
		// left join gmt_finishing_receive_dtls c on b.id=c.po_break_down_id
		// where b.job_id=a.id and a.status_active=1 and a.is_deleted=0 $active_cond_b and b.status_active in(1,2,3) and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $str_po_cond $txt_style_ref_number_cond $internal_ref_cond_po $order_status_cond
		// group by a.id, b.id, a.job_no_prefix_num,a.job_no, a.insert_date,b.po_number, b.po_quantity, b.unit_price, b.po_total_price, b.job_no_mst, b.pub_shipment_date, b.is_confirmed, b.shiping_status, b.excess_cut, b.plan_cut, a.company_name, a.style_owner, a.buyer_name, a.set_break_down, a.style_ref_no,a.client_id,a.total_set_qnty,b.pack_handover_date, c.item_id
		// order by b.pub_shipment_date, b.id";
		// echo $order_sql; die;

		$sql_po_result=sql_select($order_sql);
		$finishing_rcv_arr = array();
		$all_po_id=""; $all_po_id_arr=array(); $all_dtls_mst_id_arr=array();
		foreach($sql_po_result as $row)
		{
			$all_po_id.=$row[csf("id")].",";
			$all_po_id_arr[$row[csf("id")]]=$row[csf("id")];

			$all_dtls_mst_id_arr[$row[csf("dtl_mst_id")]]=$row[csf("dtl_mst_id")];
			$finishing_rcv_arr[$row[csf("id")]][$row[csf("item_id")]]['receive_qnty']=$row[csf("receive_qnty")];
		}
		// echo "<pre>"; print_r($finishing_rcv_arr); die;
	    $all_po_id=chop($all_po_id,",");
		$all_dtl_mst_id=chop($all_dtl_mst_id,",");

	    $all_po_ids=implode(",", $all_po_id_arr);
		$all_dtl_mst_ids=implode(",", $all_dtls_mst_id_arr);

		$smv_sql = "SELECT gmts_item_id, smv_pcs from wo_po_details_mas_set_details where job_id in($all_dtl_mst_ids)";
		$smv_sql_result=sql_select($smv_sql);
		$smv_arr=array();
		foreach($smv_sql_result as $row)
		{
			$smv_arr[$row[csf("gmts_item_id")]]['smv_pcs']=$row[csf("smv_pcs")];
		}
		// echo "<pre>"; print_r($smv_arr); die;

	    $all_po_ids_cond="";
 		if(count($all_po_id_arr)>0)
 		{
 			  if($db_type==2 && count($all_po_id_arr)>999)
			   {
			   		$chunk_arr=array_chunk($all_po_id_arr, 999);
			   		foreach($chunk_arr as $vals)
			   		{
			   			$po_ids=implode(",", $vals);
			   			if($all_po_ids_cond=="")
			   			{
			   				$all_po_ids_cond.=" and (c.order_id in ($po_ids)";
			   			}
			   			else
			   			{
			   				$all_po_ids_cond.=" or  c.order_id in ($po_ids)";
			   			}
			   		}
			   		$all_po_ids_cond.= " )";
			   }
			   else
			   {
			   		$all_po_ids_cond= " and c.order_id in($all_po_ids) ";
			   }

 		}


		//=================================== Delete Order Id From TEMP ENGINE ====================================
		$con = connect();
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 21 and ref_from=7");
		oci_commit($con);
		//=================================== Insert order_id into TEMP ENGINE ====================================
		fnc_tempengine("GBL_TEMP_ENGINE", $user_id, 21, 7,$all_po_id_arr, $empty_arr);
		oci_commit($con);


 		// ================================= GETTING ORDER QTY (ITEM WISE) =====================================
 		$order_qty_sql="SELECT b.id,c.item_number_id as item_id, SUM(c.order_quantity) as order_quantity
		from wo_po_details_master a, wo_po_break_down b, wo_po_color_size_breakdown c
		where b.job_id=a.id and b.id=c.po_break_down_id and a.id=c.job_id and a.status_active=1 and a.is_deleted=0 $active_cond_b and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $order_status_cond $str_po_cond $txt_style_ref_number_cond $internal_ref_cond_po group by b.id,c.item_number_id";
		$order_qty_sql_res = sql_select($order_qty_sql);
		$order_qty_array = array();
		foreach ($order_qty_sql_res as $val)
		{
			$order_qty_array[$val[csf('id')]][$val[csf('item_id')]] = $val[csf('order_quantity')];
		}
		// ================================ end order qnty ===============================================


 		$template_id_arr=return_library_array("select a.po_number_id, a.template_id from tna_process_mst a,GBL_TEMP_ENGINE b where a.po_number_id =b.ref_val and b.entry_form=21 and b.ref_from=7 and b.user_id=$user_id group by a.po_number_id, a.template_id","po_number_id","template_id");

		$po_product_cond="";
		if($db_type==0)
		{
			if($all_po_id!="") $po_product_cond =" and c.po_break_down_id in($all_po_id)";
		}
		else
		{
			if($all_po_id!="")
			{
				$all_po_id_arr=array_chunk(array_unique(explode(",",$all_po_id)),999);
				$p=1;
				if(!empty($all_po_id_arr))
				{
					foreach($all_po_id_arr as $po_id)
					{
						if($p==1) $po_product_cond =" and (c.po_break_down_id in(".implode(',',$po_id).")"; else $po_product_cond .=" or c.po_break_down_id in(".implode(',',$po_id).")";
						$p++;
					}
					$po_product_cond .=" )";
				}
			}
		}

		$ex_factory_arr=array();

		$ex_fac_level=sql_select("select ex_factory  from variable_settings_production where company_name=$cbo_company_name and variable_list=1 and status_active=1");
		// if($ex_fac_level[0][csf("ex_factory")]==1)
		// {
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , c.item_number_id, MAX(c.ex_factory_date) AS ex_factory_date, sum(c.total_carton_qnty) as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN c.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN c.ex_factory_qnty ELSE 0 END) as ex_factory_qnty
			from pro_ex_factory_mst c 	where     c.status_active=1 and c.is_deleted=0  $po_product_cond group by c.po_break_down_id, c.item_number_id");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['qty']=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		/*}
		else
		{
			$ex_factory_data=sql_select("SELECT c.po_break_down_id , c.item_number_id, MAX(c.ex_factory_date) AS ex_factory_date, c.total_carton_qnty as total_carton_qnty,
			sum(CASE WHEN c.entry_form!=85 THEN d.production_qnty ELSE 0 END)-sum(CASE WHEN c.entry_form=85 THEN d.production_qnty ELSE 0 END) as ex_factory_qnty
			from pro_ex_factory_mst c ,pro_ex_factory_dtls d,wo_po_break_down e ,wo_po_color_size_breakdown f
			where    c.id=d.mst_id and c.po_break_down_id=e.id and e.id=f.po_break_down_id and f.id=d.color_size_break_down_id and
         	c.status_active=1 and c.is_deleted=0 and    d.status_active=1 and d.is_deleted=0 and      e.status_active in(1,2,3) and e.is_deleted=0 and f.status_active in(1,2,3) $active_cond_e_f   $po_product_cond group by c.po_break_down_id, c.item_number_id,c.total_carton_qnty");

			foreach($ex_factory_data as $exRow)
			{
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['date']=$exRow[csf('ex_factory_date')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['qty']+=$exRow[csf('ex_factory_qnty')];
				$ex_factory_arr[$exRow[csf('po_break_down_id')]][$exRow[csf('item_number_id')]]['ex_fac_carton_qty']+=$exRow[csf('total_carton_qnty')];

			}
		}*/
		unset($ex_factory_data);

		if($db_type==0)
		{

			$prod_sql="SELECT c.po_break_down_id, c.item_number_id,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				IFNULL(sum(CASE WHEN d.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,


				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				IFNULL(sum(CASE WHEN d.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,


				IFNULL(sum(CASE WHEN d.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				IFNULL(sum(CASE WHEN d.production_type ='5' THEN d.reject_qty ELSE 0 END),0) AS sewingout_rej_qnty,

				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				IFNULL(sum(CASE WHEN d.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,
				IFNULL(sum(CASE WHEN d.production_type ='11' THEN d.production_qnty ELSE 0 END),0) AS poly_qty,
				IFNULL(sum(CASE WHEN d.production_type in (1,2,4,3,5,7,8,11) and c.production_type in (1,2,4,3,5,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=1 then c.carton_qty ELSE 0 END),0) as carton_qty_no_inhouse,
				IFNULL(sum(CASE WHEN c.production_type ='8' and c.production_source=3 then c.carton_qty ELSE 0 END),0) as carton_qty_no_outbound,
				IFNULL(sum(CASE When d.production_type ='8' and c.production_type ='8' then c.carton_qty ELSE 0 END),0) as carton_total_qty

			from
				pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e
			where  c.id=d.mst_id  and c.po_break_down_id=a.po_break_down_id and a.job_id=e.id  and a.id=d.color_size_break_down_id and c.status_active=1 and   c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and e.status_active=1 and e.is_deleted=0 $active_cond_a_d $po_product_cond $internal_ref_cond_prod group by c.po_break_down_id, c.item_number_id";

			$sql_carton_qty=sql_select("select c.po_break_down_id,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=1 then c.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			IFNULL(sum(case when c.production_type ='8' and c.production_source=3 then c.carton_qty else 0 end),0) as carton_qty_no_outbound,
			IFNULL(sum(case when c.production_type ='8' then c.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst c where c.status_active=1 and c.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by c.po_break_down_id");
		}
		else
		{
			$producttion_cond =" and c.po_break_down_id in($po_id)";
			$prod_sql= "SELECT c.po_break_down_id, c.item_number_id,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.production_qnty ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.replace_qty ELSE 0 END),0) AS replace_qty,

				NVL(sum(CASE WHEN d.production_type ='2'  and c.production_type ='2' THEN d.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS print,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS emb,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS wash,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS special,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS spc_qty,
				NVL(sum(CASE WHEN c.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash,

				NVL(sum(CASE WHEN d.production_type ='3'  and c.production_type ='3' THEN d.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 THEN d.production_qnty ELSE 0 END),0) AS printr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 THEN d.production_qnty ELSE 0 END),0) AS embr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS washr,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS specialr,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=4 THEN d.production_qnty ELSE 0 END),0) AS issue_spc_qty,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=3 THEN d.production_qnty ELSE 0 END),0) AS issue_wash_qty,


				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=1 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS print_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_inhouse,
				NVL(sum(CASE WHEN d.production_type ='2' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_issue_subcon,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_inhouse,
				NVL(sum(CASE WHEN d.production_type ='3' and c.embel_name=2 and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS emb_rcv_subcon,

				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='4'  and c.production_type ='4' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingin_qnty_out,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_in,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and c.production_source<>1 THEN d.production_qnty ELSE 0 END),0) AS sewingout_qnty_out,
				NVL(sum(CASE WHEN d.production_type ='5'  and c.production_type ='5'  THEN d.replace_qty ELSE 0 END),0) AS sew_replace_qty,

				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN d.production_qnty ELSE 0 END),0) AS iron_qnty,

				NVL(sum(CASE WHEN d.production_type ='15'  and c.production_type ='15' THEN d.production_qnty ELSE 0 END),0) AS hangtag_qnty,

				NVL(sum(CASE WHEN d.production_type ='7'  and c.production_type ='7' THEN c.re_production_qty ELSE 0 END),0) AS re_iron_qnty,

				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_inhouse,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS finish_qnty_outbound,
				NVL(sum(CASE WHEN d.production_type ='1'  and c.production_type ='1' THEN d.reject_qty ELSE 0 END),0) AS cutting_rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='8'  and c.production_type ='8' THEN d.reject_qty ELSE 0 END),0) AS finish_rej_qnty,
				sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and d.is_rescan=0 THEN d.reject_qty ELSE 0 END)-sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and d.is_rescan!=0 THEN d.production_qnty ELSE 0 END) AS sewingout_rej_qnty,

				sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and d.is_rescan=0 THEN d.reject_qty ELSE 0 END)-sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' and d.is_rescan!=0 THEN d.production_qnty ELSE 0 END)-sum(CASE WHEN d.production_type ='5'  and c.production_type ='5' THEN d.replace_qty ELSE 0 END) AS sewingout_rej_qnty_old,

				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' THEN d.reject_qty ELSE 0 END),0) AS poly_rej_qnty,

				NVL(sum(CASE WHEN d.production_type in (1,3,7,8,11) and c.production_type in (1,3,7,8,11) THEN d.reject_qty ELSE 0 END),0) AS rej_qnty,
				NVL(sum(CASE WHEN d.production_type ='11'  and c.production_type ='11' and c.production_source=1 THEN d.production_qnty ELSE 0 END),0) AS poly_inhouse,
				NVL(sum(CASE WHEN d.production_type ='11' and c.production_type ='11' and c.production_source=3 THEN d.production_qnty ELSE 0 END),0) AS poly_outbound,

				NVL(sum(CASE WHEN c.production_type ='11' and d.production_type ='11'  THEN d.production_qnty ELSE 0 END),0) AS poly_qty

			from
				pro_garments_production_mst c,pro_garments_production_dtls d,wo_po_color_size_breakdown a,wo_po_details_master e
			where  c.id=d.mst_id  AND a.job_id = e.id  and a.id=d.color_size_break_down_id and c.po_break_down_id=a.po_break_down_id and
				c.status_active=1 and c.is_deleted=0 and d.status_active=1 and e.status_active=1 $active_cond_a_d and d.is_deleted=0  and e.status_active=1 and e.is_deleted=0  $po_product_cond $internal_ref_cond_prod group by c.po_break_down_id, c.item_number_id";

			$sql_carton_qty=sql_select("SELECT c.po_break_down_id,
			NVL(sum(case when c.production_type ='8' and c.production_source=1 then c.carton_qty else 0 end),0) as carton_qty_no_inhouse,
			NVL(sum(case when c.production_type ='8' and c.production_source=3 then c.carton_qty else 0 end),0) as carton_qty_no_outbound,
			NVL(sum(case when c.production_type ='8' then c.carton_qty else 0 end),0) as carton_total_qty
			from pro_garments_production_mst c where c.status_active=1 and c.is_deleted=0 $po_product_cond $internal_ref_cond_prod group by c.po_break_down_id");

		}
		$carton_arr=array();
		foreach($sql_carton_qty as $crtn)
		{
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_inhouse"]=$crtn[csf("carton_qty_no_inhouse")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_qty_no_outbound"]=$crtn[csf("carton_qty_no_outbound")];
		  $carton_arr[$crtn[csf("po_break_down_id")]]["carton_total_qty"]=$crtn[csf("carton_total_qty")];
		}
		//  echo $prod_sql; die;
		// sub contract query start here
		if(str_replace("'", "",$txt_order)!="")
		{
			$str_po_cond_subcon="";
			$str_po_cond_subcon2="";
			if($txt_datefrom!="" &&  $txt_dateto!="") { $str_po_cond_subcon .=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'"; $str_po_cond_subcon2.=" and c.delivery_date between '$txt_datefrom' and '$txt_dateto'";}
			if(str_replace("'", "",$cbo_company_name)!=0)
			{
				//$str_po_cond_subcon.=" and b.company_id=$cbo_company_name";
				$str_po_cond_subcon2.=" and a.company_id=$cbo_company_name";
			}
			if(str_replace("'", "",$cbo_buyer_name)!=0) $str_po_cond_subcon.=" and b.party_id=$cbo_buyer_name";
			if(str_replace("'", "",$cbo_location)!=0) $str_po_cond_subcon.=" and b.location_id=$cbo_location";
			if(str_replace("'", "",$txt_style_ref)!="") $str_po_cond_subcon.=" and b.job_no_prefix_num=$txt_style_ref";
			if(str_replace("'", "",$txt_order)!="") $str_po_cond_subcon.=" and c.order_no=$txt_order";
			if($db_type==0) $select_job_year_subcon="year(b.insert_date) as job_year"; else $select_job_year_subcon="to_char(b.insert_date,'YYYY') as job_year";
			$sub_con_po_wise_qty_sql="SELECT c.id,sum(b.qnty) as order_quantity,sum(b.plan_cut) as plan_cut  from subcon_ord_mst a,  subcon_ord_dtls c,subcon_ord_breakdown b where c.status_active=1 and c.is_deleted=0 and c.id=b.order_id and c.job_no_mst=a.subcon_job and a.id=b.mst_id and a.status_active=1 and a.is_deleted=0 $str_po_cond_subcon2  group by  c.id";
			foreach(sql_select($sub_con_po_wise_qty_sql) as $key=>$vals)
			{
				$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"]=$vals[csf("order_quantity")];
				$sub_con_po_wise_qty_arr[$vals[csf("id")]]["plan"]=$vals[csf("plan_cut")];
			}

			$subcon_sql="SELECT c.id,b.company_id,b.party_id as buyer_name,c.order_no as po_number,b.subcon_job as job_no,b.job_no_prefix_num ,$select_job_year_subcon,c.cust_style_ref as style_ref_no,e.item_id as item_number_id,sum(e.qnty) as po_quantity,c.delivery_date as country_ship_date,sum(e.plan_cut) as plan_cut,sum(case when d.production_type=1 then d.prod_qnty else 0 end ) as cutting_qnty,sum(case when d.production_type=2 then d.prod_qnty else 0 end) as sewing_out,sum(case when d.production_type=3 then d.prod_qnty else 0 end) as iron_qnty,sum(case when d.production_type=5 then d.prod_qnty else 0 end) as poly_qnty,sum(case when d.production_type=4 then d.prod_qnty else 0 end) as finishing_qnty,c.cust_buyer
			FROM subcon_gmts_prod_dtls a,subcon_gmts_prod_col_sz d, subcon_ord_mst b, subcon_ord_dtls c ,subcon_ord_breakdown e
			WHERE a.id=d.dtls_id and a.order_id=c.id and c.job_no_mst=b.subcon_job and a.status_active=1 and a.is_deleted=0   and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and e.id=d.ord_color_size_id and e.order_id=c.id and a.order_id=e.order_id $str_po_cond_subcon
			group by c.id,b.company_id,b.party_id ,c.order_no ,b.subcon_job ,b.job_no_prefix_num ,b.insert_date,c.cust_style_ref ,e.item_id ,c.delivery_date,c.cust_buyer";
			// echo $subcon_sql;

			$subcon_ex_sql="SELECT b.party_id ,sum(y.delivery_qty) as qtys FROM subcon_delivery_mst x,subcon_delivery_dtls y,subcon_ord_mst b, subcon_ord_dtls c WHERE x.id=y.mst_id and x.status_active=1   and c.job_no_mst=b.subcon_job and c.id=y.order_id $str_po_cond_subcon and c.status_active=1 and c.is_deleted=0 and b.status_active=1 and b.is_deleted=0  GROUP BY b.party_id";
			foreach(sql_select($subcon_ex_sql) as $rows)
			{
				$party_arr_ex[$rows[csf("party_id")]]+=$rows[csf("qtys")];
				//$party_arr_ex_ground["ex"]+=$rows[csf("qtys")];
			}

			$subcon_ex_date="SELECT y.order_id,max(x.delivery_date) as delivery_date ,sum(y.delivery_qty) as qtys FROM subcon_delivery_mst x,subcon_delivery_dtls y,subcon_ord_mst b,  subcon_ord_dtls c WHERE x.id=y.mst_id and x.status_active=1   and c.id=y.order_id $str_po_cond_subcon and c.status_active=1 and c.is_deleted=0    and c.job_no_mst=b.subcon_job  GROUP BY y.order_id";
			foreach(sql_select($subcon_ex_date) as $rows)
			{
				$subcon_ex_date_arr[$rows[csf("order_id")]]["qtys"]=$rows[csf("qtys")];
				$subcon_ex_date_arr[$rows[csf("order_id")]]["date"]=$rows[csf("delivery_date")];
			}

			//print_r($party_arr_ex);die;
			foreach(sql_select($subcon_sql) as $vals)
			{
				$party_arr[$vals[csf("buyer_name")]]["po_quantity"]+=$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"];
				$party_arr[$vals[csf("buyer_name")]]["cust_buyer"]=$vals[csf("cust_buyer")];
				$party_arr[$vals[csf("buyer_name")]]["cutting_qnty"]+=$vals[csf("cutting_qnty")];
				$party_arr[$vals[csf("buyer_name")]]["sewing_out"]+=$vals[csf("sewing_out")];
				$party_arr[$vals[csf("buyer_name")]]["iron_qnty"]+=$vals[csf("iron_qnty")];
				$party_arr[$vals[csf("buyer_name")]]["poly_qnty"]+=$vals[csf("poly_qnty")];
				$party_arr[$vals[csf("buyer_name")]]["finishing_qnty"]+=$vals[csf("finishing_qnty")];
				$party_ground_total["po_quantity"]+=$sub_con_po_wise_qty_arr[$vals[csf("id")]]["po"];
				$party_ground_total["cutting_qnty"]+=$vals[csf("cutting_qnty")];
				$party_ground_total["sewing_out"]+=$vals[csf("sewing_out")];
				$party_ground_total["iron_qnty"]+=$vals[csf("iron_qnty")];
				$party_ground_total["poly_qnty"]+=$vals[csf("poly_qnty")];
				$party_ground_total["finishing_qnty"]+=$vals[csf("finishing_qnty")];
				$party_arr_ex_ground["ex"]+=$party_arr_ex[$vals[csf("buyer_name")]];
			}
		}

		$subcon_buyer_html="";
		$subcon_html="";
		if(count(sql_select($subcon_sql))>0)
		{
			$i=1;
			$subcon_html.="<tr> <th colspan='56' align='left'> Sub-Contract Production</th> </tr>";
			foreach(sql_select($subcon_sql) as $key=>$orderRes)
			{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";


				$subcon_html.="<tr bgcolor='$bgcolor' onclick=change_color('tr33_2nd$i','$bgcolor') id=tr33_2nd$i>";
				$subcon_html.='<td width="30" align="left"><p>'.$i.'</p></td>
					<td width="100" align="left"><p>'. $company_library[$orderRes[csf("company_id")]].'</p></td>
					<td width="100" align="left"><p>'.$company_library[$orderRes[csf("company_id")]].'</p></td>
					<td width="130" align="left"><p>'.$orderRes[csf("po_number")].'</p></td>
					<td width="80" align="left"><p>'.$orderRes[csf("is_confirmed")].'</p></td>
					<td width="60" align="left"><p>'.$buyer_short_library[$orderRes[csf("buyer_name")]].'</p></td>
					<td width="60" align="left"><p>'.$buyer_short_library[$orderRes[csf("cust_buyer")]].'</p></td>

					<td width="100" align="left"><p>'.$orderRes[csf("job_no")].'</p></td>
					<td width="80" align="left"><p>'.$orderRes[csf("job_no_prefix_num")].'</p></td>
					<td width="120" align="left"><p>'.$orderRes[csf("style_ref_no")].'</p></td>
					<td width="130" align="left"><p>'.$garments_item[$orderRes[csf("item_number_id")]].'</p></td>
					<td width="80" align="left"><p>'.$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"].'</p></td>
					<td width="80" align="left" bgcolor="'.$color.'"><div style="word-wrap:break-word; width:50px">'.change_date_format($orderRes[csf("country_ship_date")]).'&nbsp;</div></td>



					<td width="80" align="left"><p>'.change_date_format($subcon_ex_date_arr[$orderRes[csf("id")]]["date"]).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("excess_cut")],2)." %".'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["plan"],2).'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("lay_cut")],2).'&nbsp;</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("cutting_qnty")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("cutting_bal_qnty")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($short_excess_cut_qnty,2).'</p></td>
					<td width="80" align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>


					<td width="80" align="right"><p>'.number_format($print_issue_inhouse,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($print_issue_subcon,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($print_rcv_inhouse,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($print_rcv_subcon,0).'</p></td>


					<td width="80" align="right"><p>'.number_format($emb_issue_inhouse,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($emb_issue_subcon,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($emb_rcv_inhouse,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($emb_rcv_subcon,0).'</p></td>



					<td width="80" align="right"><p>'.number_format($spwork_issue,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($spcial_rec,0).'</p></td>

					<td width="80" align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($sewingin_qnty,0).'</p></td>
					<td width="80" align="right" title="'. $color_id_arr[$gmtsRow[csf('color_size_break_down_id')]]."==".$gmtsRow[csf('color_size_break_down_id')] .'"><p>'.number_format($orderRes[csf("sewing_out")],0).'</p></td>

					<td width="80" align="right"><p>'.number_format($sewingin_subcon,0).'</p></a></td>
					<td width="80" align="right"><p>'.number_format($sewingout_subcon,0).'</p></td>


					<td width="80" align="right"><p>'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("sewing_out")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($wash_issue,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($wash_rec,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("iron_qnty")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>


					<td width="80" align="right"><p>'.number_format($orderRes[csf("poly_qnty")],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($finish_qnty_outbound,0).'</p></td>
					<td width="80" align="right"><p>'.number_format($orderRes[csf("poly_qnty")],0).'</p></td>

					<td width="80" align="right"><p>'.number_format(($orderRes[csf("poly_qnty")]*100)/$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"],2)." %".'</p></td>

					<td width="80" align="right"><p>'.number_format($orderRes[csf("finishing_qnty")],0).'</td>
					<td width="80" align="right">'.number_format($testt,0).'</p></td>
					<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
					<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
					<td width="80"  align="right"><p>'.number_format($orderRes[csf("finishing_qnty")],0).'</p></td>
					<td width="80"  align="right"><p>'.number_format(($orderRes[csf("finishing_qnty")]*100)/$sub_con_po_wise_qty_arr[$orderRes[csf("id")]]["po"],2).' %</p></td>
					<td width="80"  align="right"><p>'.number_format($shortages,0).'</p></td>
					<td width="80"  align="right"><p>'.number_format($subcon_ex_date_arr[$orderRes[csf("id")]]["qtys"],0).'</p></td>
					<td width="80" align="right"><p>'.number_format($shortage,0).'</p></td>
					<td width="80"  align="right" width="85"><p>'.number_format($shortages,0).'</p></td>
					<td align="right"><p>'.$shortages.'</p></td>
				</tr>';
				$i++;
			}
		}

		if(count($party_arr)>0)
		{
			$subcon_buyer_html.='<tr> <th align="left" colspan="25"> Sub-Contract Production </th> </tr>';
			$i=1;
			foreach($party_arr as $buyer_id=>$value)
			{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

								$subcon_buyer_html.='
								<tr bgcolor="'.$bgcolor.'"  onClick="change_color(\'tr22_'.$i."'".', '."'".$bgcolor."'".')" id="tr_'.$i.'"  >
									<td width="30" align="left">'.$i.'</td>

									<td width="80" align="left">'.$buyer_short_library[$buyer_id].'</td>
									<td width="80" align="left">'.$buyer_short_library[$value['cust_buyer']].'</td>
									<td width="80" align="right">'.number_format($value["po_quantity"]).'</td>
									<td width="80" align="right">'. number_format($value["lay_qnty"]).'</td>
									<td width="80" align="right">'. number_format($value["cutting_qnty"]).'</td>
									<td width="80" align="right">'. number_format($value["print"]).'</td>
									<td width="80" align="right">'. number_format($value["print_rec"]).'</td>
									<td width="80" align="right">'. number_format($value["emb"]).'</td>
									<td width="80" align="right">'. number_format($value["emb_rec"]).'</td>
									<td width="80" align="right">'. number_format($value["emb_rec"]).'</td>
									<td width="80" align="right">'.  number_format($value["wash"]).'</td>
									<td width="80" align="right">'.  number_format($value["wash_rec"]).'</td>
									<td width="80" align="right">'.  number_format($value["spwork"]).'</td>
									<td width="80" align="right">'.  number_format($value["spwork_rec"]).'</td>
									<td width="80" align="right">'. number_format($value["sQty"]).'</td>
									<td width="80" align="right">'. number_format($value["soQty"]).'</td>
									<td width="80" align="right">'. number_format($value["sewing_out"]).'</td>
									<td width="80" align="right">'. number_format($value["sQty"]).'</td>
									<td width="80" align="right">'.  number_format($value["sewing_out"]).'</td>
									<td width="80" align="right">'.  number_format($value["soQty"]+$value["iron_qnty"]).'</td>

									<td width="80" align="right">'. number_format($value["poly_qnty"]).'</td>
	                                <td width="80" align="right">'.  number_format( ($value["poly_qnty"]*100)/$value["po_quantity"],2 ).'</td>

									<td width="80" align="right">'.  number_format($value["finishing_qnty"],2).'</td>
									<td width="80" align="right">'.  number_format( ($value["finishing_qnty"]*100)/$value["po_quantity"] ,2).'</td>

									<td width="80" align="right">'. number_format($party_arr_ex[$buyer_id],2).'</td>
									<td  align="right">'.  number_format( ($party_arr_ex[$buyer_id]*100)/$value["po_quantity"] ,2).'</td>


								</tr>';
								$i++;

			}

		}
		 $sql_cutlay="SELECT a.entry_form,b.order_id as po_id,b.gmt_item_id as gmts,c.order_id,sum(c.size_qty ) as qty  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,GBL_TEMP_ENGINE d where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id =d.ref_val and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.company_id=$cbo_company_name and d.entry_form=21 and d.ref_from=7 and d.user_id=$user_id  group by a.entry_form,b.order_id,b.gmt_item_id,c.order_id";
		$sql_res=sql_select($sql_cutlay);
		foreach($sql_res as $vals)
		{
			$entry_form=$vals[csf("entry_form")];
			// if($entry_form!=76)
			// {
				$cut_lay_arrs[$vals[csf("order_id")]][$vals[csf("gmts")]]+=$vals[csf("qty")];
			/*}
			else
			{
				$cut_lay_arrs[$vals[csf("po_id")]][$vals[csf("gmts")]]+=$vals[csf("qty")];
			}*/
		}


		$gmts_prod_arr=array();
		$res_gmtsData=sql_select($prod_sql);
		foreach($res_gmtsData as $gmtsRow)
		{
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['cQty']=$gmtsRow[csf('cutting_qnty')];//+$gmtsRow[csf('replace_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['rQty']=$gmtsRow[csf('replace_qty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['pQty']=$gmtsRow[csf('printing_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print']=$gmtsRow[csf('print')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb']=$gmtsRow[csf('emb')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['washiss']=$gmtsRow[csf('wash')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['special']=$gmtsRow[csf('special')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['prQty']=$gmtsRow[csf('printreceived_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print']=$gmtsRow[csf('printr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['embr']=$gmtsRow[csf('embr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['washrec']=$gmtsRow[csf('washr')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['special']=$gmtsRow[csf('specialr')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['spc_qty']=$gmtsRow[csf('issue_spc_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['issue_wash']=$gmtsRow[csf('issue_wash_qty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print_issue_inhouse']=$gmtsRow[csf('print_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print_issue_subcon']=$gmtsRow[csf('print_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print_rcv_inhouse']=$gmtsRow[csf('print_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['print_rcv_subcon']=$gmtsRow[csf('print_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb_issue_inhouse']=$gmtsRow[csf('emb_issue_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb_issue_subcon']=$gmtsRow[csf('emb_issue_subcon')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb_rcv_inhouse']=$gmtsRow[csf('emb_rcv_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['emb_rcv_subcon']=$gmtsRow[csf('emb_rcv_subcon')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['sQty']=$gmtsRow[csf('sewingin_qnty_in')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['soQty']=$gmtsRow[csf('sewingout_qnty_in')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['subcon_sewingin']=$gmtsRow[csf('sewingin_qnty_out')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['subcon_sewingout']=$gmtsRow[csf('sewingout_qnty_out')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['all_sewingout']=$gmtsRow[csf('sewingout_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['sew_replace_qty']=$gmtsRow[csf('sew_replace_qty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['iQty']=$gmtsRow[csf('iron_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['hangQty']=$gmtsRow[csf('hangtag_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['riQty']=$gmtsRow[csf('re_iron_qnty')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['finish_qnty_inhouse']=$gmtsRow[csf('finish_qnty_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['finish_qnty_outbound']=$gmtsRow[csf('finish_qnty_outbound')];

			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['crQty']=$gmtsRow[csf('cutting_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['sorQty']=$gmtsRow[csf('sewingout_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['frQty']=$gmtsRow[csf('finish_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['polyRej']=$gmtsRow[csf('poly_rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['rej_qnty']=$gmtsRow[csf('rej_qnty')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['polyInQty']=$gmtsRow[csf('poly_inhouse')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['polyOutQty']=$gmtsRow[csf('poly_outbound')];
			$gmts_prod_arr[$gmtsRow[csf('po_break_down_id')]][$gmtsRow[csf('item_number_id')]]['polyQty']=$gmtsRow[csf('poly_qty')];
		}
		//echo "<pre>";print_r($gmts_prod_arr);die;
		unset($res_gmtsData);

		/*$po_transfer_in_sql=sql_select("SELECT a.po_break_down_id,b.production_quantity,a.item_number_id from pro_gmts_delivery_dtls where status_active=1 and is_deleted=0");
		foreach($po_transfer_in_sql as $vals)
		{
			$po_transfer_in_arr[$vals[csf("to_po_id")]][$vals[csf("item_number_id")]]+=$vals[csf("production_quantity")];
		}

		$po_transfer_out_sql=sql_select("SELECT from_po_id,production_quantity,item_number_id from pro_gmts_delivery_dtls where status_active=1 and is_deleted=0");
		foreach($po_transfer_out_sql as $vals)
		{
			$po_transfer_out_arr[$vals[csf("from_po_id")]][$vals[csf("item_number_id")]]+=$vals[csf("production_quantity")];
		}*/
		$poCond = str_replace("c.order_id", "a.po_break_down_id", $all_po_ids_cond);
		$sql = "SELECT a.PO_BREAK_DOWN_ID,a.ITEM_NUMBER_ID,b.PRODUCTION_QNTY,b.TRANS_TYPE from pro_garments_production_mst a,pro_garments_production_dtls b,GBL_TEMP_ENGINE c where a.id=b.mst_id and a.po_break_down_id=c.ref_val and a.status_active=1 and b.status_active=1 and b.TRANS_TYPE in(5,6) and c.entry_form=21 and c.ref_from=7 and c.user_id=$user_id";
		// echo $sql;
		$res = sql_select($sql);
		$po_transfer_arr = array();
		foreach ($res as $val)
		{
			$po_transfer_arr[$val['PO_BREAK_DOWN_ID']][$val['ITEM_NUMBER_ID']][$val['TRANS_TYPE']] += $val['PRODUCTION_QNTY']	;
		}
		// echo "<pre>";print_r($po_transfer_arr);echo "</pre>";
		//echo "<pre>";print_r($po_transfer_out_arr);echo "</pre>";die;
		unset($po_transfer_in_sql);
		unset($po_transfer_out_sql);

		ob_start();

		$fromDate = change_date_format( str_replace("'","",trim($txt_date_from)) );
		$toDate = change_date_format( str_replace("'","",trim($txt_date_to)) );
		$buyer_array=array();
		$result=sql_select($order_sql);
		$i=0; $k=0; $date=date("Y-m-d");
		$days_in_hand="";
		// echo "<pre>";print_r($result);die;
		foreach($result as $orderRes)
		{
		   $i++;
		   if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
		   $setArr = explode("__",$orderRes[csf("set_break_down")] );
		   $countArr = count($setArr);

		   if($countArr==0) $countArr=1;
		   for($j=0;$j<$countArr;$j++)
		   {
			   $setItemArr = explode("_",$setArr[$j]);
			   $item_id=$setItemArr[0];
			   $set_qnty=$setItemArr[1];
			   if($item_id>0)
			   {
				   	$k++;
				   	// $po_quantity_in_pcs = $orderRes[csf("po_quantity")]*$set_qnty;
				   	$po_qty = $order_qty_array[$orderRes[csf("id")]][$item_id];
				   	$po_quantity_in_pcs = $po_qty;//*$set_qnty;
					$unit_price2=$orderRes[csf("unit_price")]/$orderRes[csf("total_set_qnty")];
					$unit_price=$orderRes[csf("unit_price")]/$set_qnty;
				   	$ex_factory_date=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['date'];
					$ex_factory_qnty=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['qty'];
					$ex_factory_carton_qnty=$ex_factory_arr[$orderRes[csf("id")]][$item_id]['ex_fac_carton_qty'];

					$color=""; $days_remian="";
					if($orderRes[csf("shiping_status")]==1 || $orderRes[csf("shiping_status")]==2)
					{
						$days_remian=datediff("d",$date,$orderRes[csf("shipment_date")]);
						$days_in_hand=datediff("d",$date,$orderRes[csf("shipment_date")]);
						if($orderRes[csf("shipment_date")] > $date)
						{
							$color="";
						}
						else if($orderRes[csf("shipment_date")] < $date)
						{
							$color="red";
						}
						else if($orderRes[csf("shipment_date")] >= $date && $days_remian<=5 )
						{
							$color="orange";
						}
					}
					else if($orderRes[csf("shiping_status")]==3)
					{
						$days_remian=datediff("d",$ex_factory_date,$orderRes[csf("shipment_date")]);
						if($orderRes[csf("shipment_date")] >= $ex_factory_date)
						{
							$color="green";
						}
						else if($orderRes[csf("shipment_date")] < $ex_factory_date)
						{
							$color="#2A9FFF";
						}
						$days_in_hand="";

					}//end if condition
					//if($days_in_hand<0) $days_in_hand=abs($days_in_hand)." Days Pass";
					//print_r($gmts_prod_arr[$orderRes[csf("id")]]);
					$cutting_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['cQty'];
					$cut_replace_qty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['rQty'];
					$embl_recv_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['prQty'];
					$sewingin_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sQty'];
					$sewingout_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['soQty'];
					$sewingin_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['subcon_sewingin'];
					$sewingout_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['subcon_sewingout'];
					$iron_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['iQty'];
					$hangtag_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['hangQty'];
					$re_iron_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['riQty'];
					$polyInQnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['polyInQty'];
					$polyOutQnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['polyOutQty'];
					$poly_qnty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['polyQty'];
					$finish_qnty_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['finish_qnty_inhouse'];
					$finish_qnty_outbound=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['finish_qnty_outbound'];

					$replace_qty=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sew_replace_qty'];

					$cartonInQnty=$carton_arr[$orderRes[csf("id")]]['carton_qty_no_inhouse'];
					$cartonOutQnty=$carton_arr[$orderRes[csf("id")]]['carton_qty_no_outbound'];
					$cartonTotal_qnty=$carton_arr[$orderRes[csf("id")]]['carton_total_qty'];

					$finish_qnty_transferIn=$po_transfer_arr[$orderRes[csf("id")]][$item_id][5];
					$finish_qnty_transferOut=$po_transfer_arr[$orderRes[csf("id")]][$item_id][6];

					$print_issue_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print_issue_inhouse'];
					$print_issue_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print_issue_subcon'];
					$print_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print_rcv_inhouse'];
					$print_rcv_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print_rcv_subcon'];

					$emb_issue_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb_issue_inhouse'];
					$emb_issue_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb_issue_subcon'];
					$emb_rcv_inhouse=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb_rcv_inhouse'];
					$emb_rcv_subcon=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb_rcv_subcon'];

					$print_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print'];
					$cut_lays=$cut_lay_arrs[$orderRes[csf("id")]][$item_id] ;
					$embl_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb'];
					$wash_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['washiss'];
					$spwork_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['special'];

					$spc_qty_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['spc_qty'];
					$wash_qty_issue=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['issue_wash'];

					$print_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['print'];
					$emb_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['emb'];
					$wash_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['washrec'];
					$spcial_rec=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['special'];
					$buyer_array[$orderRes[csf("buyer_name")]]['client_id']=$orderRes[csf("client_id")];
					// $buyer_array[$orderRes[csf("buyer_name")]]['id']=$orderRes[csf("id")];
					$buyer_array[$orderRes[csf("buyer_name")]]['receive_qnty']+=$orderRes[csf("receive_qnty")];
					$buyer_array[$orderRes[csf("buyer_name")]]['print']+=$print_issue;
 					$buyer_array[$orderRes[csf("buyer_name")]]['cut_lays']+=$cut_lays;
					$buyer_array[$orderRes[csf("buyer_name")]]['emb']+=$embl_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['wash']+=$wash_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['spwork']+=$spwork_issue;
					$buyer_array[$orderRes[csf("buyer_name")]]['print_rec']+=$print_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['emb_rec']+=$emb_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['wash_rec']+=$wash_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['spwork_rec']+=$spcial_rec;
					$buyer_array[$orderRes[csf("buyer_name")]]['poQty']+=$po_quantity_in_pcs;
					$buyer_array[$orderRes[csf("buyer_name")]]['poVal']+=$po_quantity_in_pcs*$unit_price;
					$buyer_array[$orderRes[csf("buyer_name")]]['ex']+=$ex_factory_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['cQty']+=$cutting_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['prQty']+=$embl_recv_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['sQty']+=$sewingin_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['soQty']+=$sewingout_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewing']+=$sewingin_subcon;
					$buyer_array[$orderRes[csf("buyer_name")]]['subcon_sewout']+=$sewingout_subcon;
					$buyer_array[$orderRes[csf("buyer_name")]]['iQty']+=$iron_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['hangQty']+=$hangtag_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['reiQty']+=$re_iron_qnty;
					$buyer_array[$orderRes[csf("buyer_name")]]['fQty']+=$finish_qnty_inhouse+$finish_qnty_outbound;
					$total_finish_qnty=$finish_qnty_inhouse+$finish_qnty_outbound+$finish_qnty_transferIn-$finish_qnty_transferOut;
					// echo $finish_qnty_inhouse."+".$finish_qnty_outbound."+".$finish_qnty_transferIn."-".$finish_qnty_transferOut."<br>";
					$actual_exces_cut = $gmts_prod_arr[$orderRes[csf("id")]][$item_id]['cQty'];
					$buyer_array[$orderRes[csf("buyer_name")]]['polyQty']+=$poly_qnty;
					if($actual_exces_cut < $po_quantity_in_pcs) $actual_exces_cut=""; else $actual_exces_cut=number_format( (($actual_exces_cut-$po_quantity_in_pcs)/$po_quantity_in_pcs)*100,2)."%";



					$plan_cut_qnty=$orderRes[csf("plan_cut")]*$set_qnty;
					$short_excess_cut_qnty=$plan_cut_qnty-$cutting_qnty;
					$short_excess_cut_percent=(($short_excess_cut_qnty/$plan_cut_qnty)*100);
					$fob_value=$po_quantity_in_pcs*$unit_price2;
					$tot_smv+=$smv_arr[$item_id]['smv_pcs'];
					$tot_po_quantity_in_pcs+=$po_quantity_in_pcs;
					$tot_fob_value+=$fob_value;
					$tot_plan_cut_qnty+=$plan_cut_qnty;
					$tot_cut_lay+=$cut_lay_arrs[$orderRes[csf("id")]][$item_id];
					$tot_cut_qnty+=$cutting_qnty;

					//$rej_value=$proRes[csf("finish_rej_qnty")]+$proRes[csf("sewingout_rej_qnty")];
					$rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['rej_qnty'];
					$cut_rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['crQty'];
					$tot_cut_reject+=$cut_rej_value;
					$tot_cut_replace_qty+=$cut_replace_qty;
					$tot_short_excess_cut_per+=$short_excess_cut_percent;
					$tot_issue_inhouse+=$print_issue_inhouse;
					$tot_issue_subcon+=$print_issue_subcon;
					$tot_print_rcv_inhouse+=$print_rcv_inhouse;
					$tot_print_rcv_subcon+=$print_rcv_subcon;
					$tot_emb_issue_inhouse+=$emb_issue_inhouse;
					$tot_emb_issue_subcon+=$emb_issue_subcon;
					$tot_emb_rcv_inhouse+=$emb_rcv_inhouse;
					$tot_emb_rcv_subcon+=$emb_rcv_subcon;
					$tot_spc_qty_issue+=$spc_qty_issue;
					$tot_special_rec+=$spcial_rec;
					$tot_sew_in_qnty+=$sewingin_qnty;
					$tot_sew_out_qnty+=$sewingout_qnty;
					$tot_sew_in_subcon+=$sewingin_subcon;
					$tot_sew_out_subcon+=$sewingout_subcon;

					$tot_finish_rcv+=$finishing_rcv_arr[$orderRes[csf("id")]][$item_id]['receive_qnty'];
					$tot_wash_issue+=$wash_qty_issue;
					$tot_wash_rec+=$wash_rec;
					$tot_iron_qnty+=$iron_qnty;
					$tot_reiron_qnty+=$re_iron_qnty;
					$tot_hangtag_qnty+=$hangtag_qnty;
					$tot_poly_in_qnty+=$polyInQnty;
					$tot_poly_out_qnty+=$polyOutQnty;
                    if($poly_status!=is_nan($poly_status))
					{
						$tot_poly_status+=$poly_status;
					}

					$tot_finish_qnty_in+=$finish_qnty_inhouse;
					$tot_finish_qnty_out+=$finish_qnty_outbound;
					$tot_finish_qnty_tarnsferIn+=$finish_qnty_transferIn;
					$tot_finish_qnty_tarnsferOut+=$finish_qnty_transferOut;


					//$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['crQty']+$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sorQty']+$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['frQty']+$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['polyRej'];
					$sewing_rej_value=$gmts_prod_arr[$orderRes[csf("id")]][$item_id]['sorQty'];

					$poly_status = $poly_qnty*100/$po_quantity_in_pcs;
					$finish_status = $total_finish_qnty*100/$po_quantity_in_pcs;

					if($finish_status!=is_nan($finish_status))
					{
						$tot_finish_status+=$finish_status;
					}


					if($j==0)
					{
						$display_font_color="";
						$font_end="";
					}
					else
					{
						$display_font_color="&nbsp;<font style='display:none'>";
						$font_end="</font>";
					}

					$company_name=$orderRes[csf("company_name")];
					$po_id=$orderRes[csf("id")];
					if(($ex_factory_date=="" || $ex_factory_date=="0000-00-00")) $ex_factory_date="&nbsp;"; else $ex_factory_date=change_date_format($ex_factory_date);
					if($orderRes[csf("shiping_status")]==3) $days_remian=$days_remian; else $days_remian="---";
					if(round($actual_exces_cut) > round($orderRes[csf("excess_cut")])) $excess_bgcolor="bgcolor='#FF0000'"; else $excess_bgcolor="";
					$total_rej_value+=$rej_value;
					$total_sew_rej_value+=$sewing_rej_value;
					$tot_replace_qty+=$replace_qty;
					$tot_ex_factory+=$ex_factory_qnty;
					$template_id=$template_id_arr[$orderRes[csf('id')]];
				   	$html.="<tr bgcolor='$bgcolor' onclick=change_color('tr_2nd$k','$bgcolor') id=tr_2nd$k>";
					$shortage = 0; $excess = 0; $balance = 0;
					if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty<$po_quantity_in_pcs)
					{
						$shortage = $ex_factory_qnty-$po_quantity_in_pcs;

						if($shortage<0)
						{
							//$shortage = "".ltrim($shortage,"-")."";
						}
					}
					else
					{
						//$shortage = "-";
					}

					if($orderRes[csf("shiping_status")]==3 && $ex_factory_qnty>$po_quantity_in_pcs)
					{
						$excess = $ex_factory_qnty-$po_quantity_in_pcs;
					}
					else
					{
						$excess = 0;
					}

					$balance = $ex_factory_qnty-$po_quantity_in_pcs;
					$tot_shortage+=$shortage;



					$html.='<td width="30" align="left">'.$display_font_color.$i.$font_end.'</td>
						<td width="100" align="left">'.$display_font_color.$company_library[$orderRes[csf("company_name")]].$font_end.'</td>
						<td width="100" align="left">'.$display_font_color.$company_library[$orderRes[csf("style_owner")]].$font_end.'</td>
						<td width="130" align="left"><p><a href="##" onclick="progress_comment_popup('.$orderRes[csf("id")].",'".$template_id."',".$tna_process_type.')">'.$display_font_color.$orderRes[csf("po_number")].$font_end.'</a></p></td>
						<td width="80" align="left"><p>'.$display_font_color.$order_status[$orderRes[csf("is_confirmed")]].$font_end.'</p></td>
						<td width="60" align="left"><p>'.$display_font_color.$buyer_short_library[$orderRes[csf("buyer_name")]].$font_end.'</p></td>
						<td width="60" align="left"><p>'.$display_font_color.$buyer_short_library[$orderRes[csf("client_id")]].$font_end.'</p></td>

						<td width="100" align="left"><p>'.$display_font_color.$orderRes[csf("job_no")].$font_end.'</p></td>
						<td width="80" align="left"><p>'.$display_font_color.$orderRes[csf("job_no_prefix_num")].$font_end.'</p></td>
						<td width="120" align="left"><p>'.$display_font_color.$orderRes[csf("style_ref_no")].$font_end.'</p></td>
						<td width="130" align="left"><p>'.$garments_item[$item_id].'</p></td>
						<td width="50" align="right"><p>'.$smv_arr[$item_id]['smv_pcs'].'</p></td>
						<td width="80" align="right"><a href="##" onclick="openmypage_order('.$po_id.",".$company_name.",".$item_id.",0,'OrderPopup'".')">'.$po_quantity_in_pcs.'</a></td>
						<td width="80" align="right"><p>'.number_format($unit_price2,2).'</p></td>
						<td width="80" align="right"><p>'.number_format($fob_value,2).'</p></td>

						<td width="80" align="center"><p>'.change_date_format($orderRes[csf("pack_handover_date")]).'</p></td>
						<td width="80" align="center"><p>'.change_date_format($orderRes[csf("shipment_date")]).'</p></td>
						<td width="80" align="center"><a href="##" onclick="openmypage('.$po_id.",".$item_id.",'exfactory','','','','0'".')">View</a></td>
						<td width="80" align="right"><p>'.number_format($orderRes[csf("excess_cut")],2)." %".'</p></td>
						<td width="80" align="right"><p>'.number_format($plan_cut_qnty,0).'</p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','17','1','product_popup'".')">'.number_format($cut_lay_arrs[$orderRes[csf("id")]][$item_id],0).'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','1','0','product_popup'".')">'.number_format($cutting_qnty,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_qcpendingpopup('.$po_id.",'".$item_id."','pending_popup'".')">'.number_format($cut_lay_arrs[$orderRes[csf("id")]][$item_id]-($cutting_qnty+$cut_rej_value-$cut_replace_qty),0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_rejectpopup('.$po_id.",'".$item_id."','reject_popup'".')">'.number_format($cut_rej_value,0).'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_cutting_replace('.$po_id.",".$item_id.",'cut_replace_qty','','','$type',''".')">'.number_format($cut_replace_qty,0).'</a></p></td>

						<td width="80" align="right" title="Plan Cut - Cut Qty"><p>'.number_format($short_excess_cut_qnty,0).'</p></td>
						<td width="80" align="right"><p>'.number_format($short_excess_cut_percent,2).'</p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','1*1','product_popup'".')">'.number_format($print_issue_inhouse,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','3*1','product_popup'".')">'.number_format($print_issue_subcon,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','1*1','product_popup'".')">'.number_format($print_rcv_inhouse,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','3*1','product_popup'".')">'.number_format($print_rcv_subcon,0).'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','1*2','product_popup'".')">'.number_format($emb_issue_inhouse,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','3*2','product_popup'".')">'.number_format($emb_issue_subcon,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','1*2','product_popup'".')">'.number_format($emb_rcv_inhouse,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','3*2','product_popup'".')">'.number_format($emb_rcv_subcon,0).'</a></p></td>

						<td width="80" align="right">'.$spc_qty_issue.'</td>
						<td width="80" align="right">'.$spcial_rec.'</td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','4','1','product_popup'".')">'.number_format($sewingin_qnty,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','5','1','product_popup'".')">'.number_format($sewingout_qnty,0).'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','4','3','product_popup'".')">'.number_format($sewingin_subcon,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','5','3','product_popup'".')">'.number_format($sewingout_subcon,0).'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','4','1','product_popup'".')">'.number_format(($sewingin_qnty+$sewingin_subcon),0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','5','1','product_popup'".')">'.number_format(($sewingout_subcon+$sewingout_qnty),0).'</a></p></td>
						<td width="80" align="right"><p>'.number_format($finishing_rcv_arr[$orderRes[csf("id")]][$item_id]['receive_qnty']).'</p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','2','0*3','product_popup'".')">'.number_format($wash_qty_issue,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','3','0*3','product_popup'".')">'.number_format($wash_rec,0).'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','".$orderRes[csf("color_number_id")]."','7','1','product_popup'".')">'.number_format($iron_qnty,0).'</a></p></td>
						<td width="80" align="right"><p>'.number_format($re_iron_qnty,0).'</p></td>
						<td width="80" align="right"><p>'.number_format($hangtag_qnty,0).'</p></td>


						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','11','1','product_popup'".')">'.number_format($polyInQnty,0).'</p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','11','3','product_popup'".')">'.number_format($polyOutQnty,0).'</p></td>

						<td width="80" align="right"><p>'.number_format($poly_qnty,0).'</p></td>
						<td width="80" align="right">'.number_format($poly_status,2)." %".'</td>

						<td width="80" align="right"><p>'.number_format($finish_qnty_inhouse,0).'<br>'.'Ctn: '.$cartonInQnty.'</p></td>
						<td width="80" align="right"><p>'.number_format($finish_qnty_outbound,0).'<br>'.'Ctn: '.$cartonOutQnty.'</p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','8','300','fin_gmt_transfer_popup'".')">'.number_format($finish_qnty_transferIn,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','8','200','fin_gmt_transfer_popup'".')">'.number_format($finish_qnty_transferOut,0).'</a></p></td>
						<td width="80" align="right"><p><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','8','1','product_popup'".')">'.number_format($total_finish_qnty,0).'</a><br>'.'Ctn: '.$cartonTotal_qnty.'</p></td>

						<td width="80" align="right">'.number_format($finish_status,2)." %".'</td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_rej('.$po_id.",".$item_id.",'reject_qty','','','$type',''".')">'.number_format($rej_value,0).'</a></p></td>

						<td width="80" align="right"><p><a href="##" onclick="openmypage_sewing_rej('.$po_id.",".$item_id.",'sewing_reject_qty','','','$type',''".')">'.number_format($sewing_rej_value,0).'</a></p></td>


						<td width="80" align="right"><p><a href="##" onclick="openmypage_sewing_replace('.$po_id.",".$item_id.",'replace_qty','','','$type',''".')">'.number_format($replace_qty,0).'</a></p></td>

						<td width="80" align="right"><a href="##" onclick="openmypage_popup('.$po_id.",'".$item_id."','','','10','1','product_popup'".')">'.number_format($ex_factory_qnty,0).' </a> <br>  Ctn: '.number_format($ex_factory_carton_qnty,0).'</td>

						<td width="80" align="right">&nbsp;'.$shortage.'</td>
						<td width="80" align="right">&nbsp;'.$excess.'</td>
						<td width="80" align="right">&nbsp;'.$balance.'</td>
						<td width="85">'.$shipment_status[$orderRes[csf("shiping_status")]].'</td>
						<td>&nbsp;<a href="##" onclick="openmypage_color_countyr_remark('.$po_id.",'".$item_id."','0','','product_all_remarks'".')">Remarks</a></td>
					</tr>';

					$tot_qc_pending+=$cut_lay_arrs[$orderRes[csf("id")]][$item_id]-($cutting_qnty+$cut_rej_value-$cut_replace_qty);
					$total_sewing_qnty+=$sewingin_qnty+$sewingin_subcon;
					$total_sewing_out_qnty+=$sewingout_subcon+$sewingout_qnty;
				}
			} //end for loop
		}// end main foreach  exfactory
		/*$buyer_wise_cut_lay_sql=sql_select("select c.buyer_name,sum(b.size_qty) as size_qty  from  ppl_cut_lay_mst a,  ppl_cut_lay_bundle b,wo_po_details_master  c,wo_po_break_down d
            where a.job_no= c.job_no and a.id=b.mst_id and a.company_id=$cbo_company_name and c.company_name=$cbo_company_name and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and
            d.status_active=1 and d.is_deleted=0 and c.job_no=d.job_no_mst and d.id=b.order_id and a.job_no=d.job_no_mst
            -- and a.job_no='FTML-17-00591'
            and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 group by c.buyer_name");
		foreach ($buyer_wise_cut_lay_sql as $key => $values)
		 {
			  $buyer_wise_cut_lay_arr[$values[csf("buyer_name")]]['cut_lay']=$values[csf("size_qty")];
		 }*/
		 //=================================== Delete Order Id From TEMP ENGINE ====================================
		execute_query("delete from gbl_temp_engine where user_id=$user_id and entry_form = 21 and ref_from=7");
		oci_commit($con);
		disconnect($con);
  		?>
		<div>
			<table width="1500" cellspacing="0" >
				<tr class="form_caption" style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:16px; font-weight:bold" >
						<? echo "Order Wise RMG Production Status"; ?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none; font-size:14px;">
						Company Name : <? echo $company_library[str_replace("'","",$cbo_company_name)]; ?>
					</td>
				</tr>
				<tr style="border:none;">
					<td colspan="20" align="center" style="border:none;font-size:12px; font-weight:bold">
						<?
							if(str_replace("'","",trim($txt_date_from))!="" && str_replace("'","",trim($txt_date_to))!="")
							{
								echo "From $fromDate To $toDate" ;
							}
						?>
					</td>
				</tr>
			</table>
			<!-- ============================================================================/
			/									Summary part								 /
			/ ============================================================================ -->
            <div style="color:#FF0000; font-size:14px; font-weight:bold; float:left; width:2350px">This Report is Generated based on Published Ship Date.</div>
			<div style="float:left; width:2330px">
				<table width="2280" cellspacing="0" border="1" class="rpt_table" rules="all" id="" >
					<thead>
						 <tr>
							<th rowspan="2" width="30">Sl.</th>
							<th rowspan="2" width="80">Buyer Name</th>
							<th rowspan="2" width="80">Buyer Client</th>
							<th rowspan="2" width="80">PO Qty.</th>
							<th rowspan="2" width="80">Cut Qty.</th>
							<th rowspan="2" width="80"> Cutting QC Qty</th>
							<th rowspan="2" width="80">Sent to Print</th>
							<th rowspan="2" width="80">Rcv Print</th>
							<th rowspan="2" width="80">Sent to Emb</th>
							<th rowspan="2"  width="80">Rcv Emb</th>
							<th rowspan="2" width="80">Sent to Wash</th>
							<th rowspan="2" width="80">Rcv Wash</th>
							<th rowspan="2"  width="80">Sent to Sp. Works</th>
							<th rowspan="2" width="80">Rcv Sp. Works</th>
							<th width="160" colspan="2">InHouse</th>
							<th width="160" colspan="2">Sub-Contact</th>
							<th rowspan="2" width="80">Total Sewing Input Qty</th>
							<th rowspan="2" width="80">Total Sewing Output Qty</th>
							<th rowspan="2" width="80">Finishing Rcv</th>
							<th rowspan="2" width="80">Total Iron Qty</th>
							<th rowspan="2" width="80">Hang Tag</th>
                            <th rowspan="2" width="80">Total Poly Qty</th>
							<th rowspan="2" width="80">Poly Comp %</th>
							<th rowspan="2" width="80">Total Finish Qty</th>
							<th rowspan="2"  width="80">Fin Comp %</th>
							<th rowspan="2" width="80">Ex-Fac</th>
							<th rowspan="2" >Ex-Fac%</th>
						 </tr>
						<tr>
							<th  width="80">Sew Input.</th>
							<th  width="80">Sew OutPut </th>
							<th  width="80">Sew Input.</th>
							<th  width="80">Sew OutPut </th>
						 </tr>
					</thead>
				</table>
				<div style="max-height:425px; overflow-y:scroll; width:2300px" >
					<table cellspacing="0" border="1" class="rpt_table"  width="2280" rules="all" id="" >
					<?
						$i=1; $total_po_quantity=0;$total_po_value=0; $total_cut=0; $total_print_iss=0;$total_lay=0;
						$total_print_re=0; $total_sew_input=0; $total_sew_out=0; $total_iron=0; $total_re_iron=0; $total_finish=0;$total_ex_factory=0;
						// echo "<pre>"; print_r($buyer_array); die;
						foreach($buyer_array as $buyer_id=>$value)
						{
							if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

							?>
							<tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
								<td width="30"><? echo $i;?></td>
								<td width="80"><? echo $buyer_short_library[$buyer_id]; ?></td>
								<td width="80"><? echo $buyer_short_library[$value["client_id"]]; ?></td>
								<td width="80" align="right"><? echo number_format($value["poQty"]);?></td>

								<td width="80" align="right"><? echo number_format($value["cut_lays"]) ; ?></td>
								<td width="80" align="right"><? echo number_format($value["cQty"]); ?></td>

								<td width="80" align="right"><? echo number_format($value["print"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["print_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["emb"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["emb_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["wash"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["wash_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["spwork"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["spwork_rec"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["sQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["soQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["subcon_sewing"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["subcon_sewout"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["sQty"]+$value["subcon_sewing"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["soQty"]+$value["subcon_sewout"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["receive_qnty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["iQty"]); ?></td>
								<td width="80" align="right"><? echo number_format($value["hangQty"]); ?></td>
                                <td width="80" align="right"><? echo number_format($value["polyQty"]); ?></td>
							    <? $poly_gd_status = ($value["polyQty"]/$value["poQty"])*100; ?>
								<td width="80" align="right"><? echo number_format($poly_gd_status,2); ?></td>
								<td width="80" align="right"><? echo number_format($value["fQty"]); ?></td>
								<? $finish_gd_status = ($value["fQty"]/$value["poQty"])*100; ?>
								<td width="80" align="right"><? echo number_format($finish_gd_status,2); ?></td>
								<td width="80" align="right"><? echo number_format($value["ex"]); ?></td>
								<? $ex_gd_status = ($value["ex"]/$value["poQty"])*100; ?>
								<td width="" align="right"><? echo  number_format($ex_gd_status,2); ?></td>
							</tr>
							<?
								$total_po_quantity+=$value["poQty"];
								$total_cut+=$value["cQty"];
								$total_lay+=$value["cut_lays"];
								$total_sent_print+=$value["print"];
								$total_print_re+=$value["print_rec"];
								$total_emb+=$value["emb"];
								$total_emb_re+=$value["emb_rec"];
								$total_wash+=$value["wash"];
								$total_wash_re+=$value["wash_rec"];
								$total_spwork+=$value["spwork"];
								$total_spwork_re+=$value["spwork_rec"];
								$total_sew_input+=$value["sQty"];
								$total_sew_out+=$value["soQty"];
								$total_subcon_sewing+=$value["subcon_sewing"];
								$total_subcon_sewout+=$value["subcon_sewout"];
								$total_iron+=$value["iQty"];
								$total_hangtag+=$value["hangQty"];
								$total_poly+=$value["polyQty"];
								$total_re_iron+=$value["reiQty"];
								$total_finish+=$value["fQty"];
								$total_ex_factory+=$value["ex"];
								$total_receive+=$value["receive_qnty"];
							$i++;
						}//end foreach 1st

						$chart_data_qnty="Order Qty;".$total_po_quantity."\n"."Cutting;".$total_cut."\n"."Sew In;".$total_sew_input."\n"."Sew Out ;".$total_sew_out."\n"."Iron ;".$total_iron."\n"."Finish ;".$total_finish."\n"."Ex-Fact;".$total_ex_factory."\n";
						   echo $subcon_buyer_html;
					?>
					</table>
					<table border="1" class="tbl_bottom"  width="2280" rules="all" id="" >
						<tr>
							<td width="30">&nbsp;</td>
							<td width="80" align="right"></td>
							<td width="80" align="right">Total</td>
							<td width="80" id="tot_po_quantity"><? echo number_format($total_po_quantity+$party_ground_total["po_quantity"]); ?></td>
							<td width="80" id="tot_lay"><? echo number_format($total_lay); ?></td>
							<td width="80" id="tot_cutting"><? echo number_format($total_cut+$party_ground_total["cutting_qnty"]); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_sent_print); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_print_re); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_emb); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_emb_re); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_wash); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_wash_re); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_spwork); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_spwork_re); ?></td>
							<td width="80" id="tot_emb_rcv"><? echo number_format($total_sew_input); ?></td>
							<td width="80" id="tot_sew_in"><? echo number_format($total_sew_out); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_subcon_sewing); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_subcon_sewout+$party_ground_total["sewing_out"]); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_sew_input+$total_subcon_sewing); ?></td>
							<td width="80" id="tot_sew_out"><? echo number_format($total_subcon_sewout+$total_sew_out+$party_ground_total["sewing_out"]); ?></td>
							<td width="80"><? echo number_format($total_receive); ?></td>
							<td width="80" id="tot_iron"><? echo number_format($total_iron+$party_ground_total["iron_qnty"]); ?></td>
							<td width="80" ><? echo number_format($total_hangtag); ?></td>
                            <td width="80" id="tot_poly"><? echo number_format($total_poly+$party_ground_total["poly_qnty"]); ?></td>

                            <? $total_poly_gd_status = ($total_poly/$total_po_quantity)*100; ?>
							<td width="80"><? echo number_format($total_poly_gd_status,2); ?></td >

							<td width="80" id="tot_finish"><? echo number_format($total_finish+$party_ground_total["finishing_qnty"]); ?></td>
							<? $total_finish_gd_status = ($total_finish/$total_po_quantity)*100; ?>
							<td width="80"><? echo number_format($total_finish_gd_status,2); ?></td >
							<td width="80"><? echo number_format($total_ex_factory+$party_arr_ex_ground["ex"]); ?></td >
							<? $total_ex_status = ($total_ex_factory/$total_po_quantity)*100; ?>
							<td width=""><? echo number_format($total_ex_status,2); ?></td>
						</tr>

					 </table>
					 <input type="hidden" id="graph_data" value="<? echo substr($chart_data_qnty,0,-1); ?>"/>
				</div>
			</div>
			<div style="float:left; width:600px">
				<table>
					<tr>
						<td height="21" width="600"><div id="chartdiv"> </div></td>
					</tr>
				</table>
			</div>
			<div style="clear:both"></div>

			<!-- ============================================================================/
			/									Details part								 /
			/ ============================================================================ -->
			<table width="5490" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1">
				<thead>
					<tr>
						<th rowspan="2" width="30">SL</th>
                        <th rowspan="2" width="100">Original Owner</th>
                        <th rowspan="2" width="100">Transferee Owner</th>
						<th rowspan="2" width="130">Order Number</th>
                        <th rowspan="2" width="80">Order Status</th>
						<th rowspan="2" width="60">Buyer Name</th>
						<th rowspan="2" width="60">Buyer Client</th>

                        <th rowspan="2" width="100">Job No</th>
                        <th rowspan="2" width="80">Job Prefix</th>
						<th rowspan="2" width="120">Style Name</th>
						<th rowspan="2" width="130">Item Name</th>
						<th rowspan="2" width="50">SMV</th>
						<th rowspan="2" width="80">Order Qty.</th>
						<th rowspan="2" width="80">Avg. Rate</th>
						<th rowspan="2" width="80" title="Order Qty Pcs * Avg. Rate">FOB Value</th>
						<th rowspan="2" width="80">PHD Date</th>
						<th rowspan="2" width="60">Ship Date</th>
						<th rowspan="2" width="80">Ex-Factory Date</th>

                        <th rowspan="2" width="80">Approved Cut %</th>
                        <th rowspan="2" width="80">Plan Cut Qty</th>
                        <th rowspan="2" width="80">Cut Qty</th>
						<th rowspan="2" width="80">Cutting QC Qty</th>
						<th rowspan="2" width="80">QC Pending</th>
						<th rowspan="2" width="80">Reject Qnty</th>
						<th rowspan="2" width="80">Replace Qnty</th>
                        <th rowspan="2" width="80">Short/Excess Cut Qty</th>
                        <th rowspan="2" width="80">Short/Excess Cut%</th>

						<th colspan="2">Sent to Print</th>
						<th colspan="2">Rcv Print</th>
						<th colspan="2">Sent to Emb</th>
						<th colspan="2">Rcv Emb</th>

						<th rowspan="2"  width="80">Sent to Sp. Works</th>
						<th rowspan="2" width="80">Rcv Sp. Works</th>
						<th width="160" colspan="2">InHouse</th>
						<th width="160" colspan="2">Out-bound Sub-Contact</th>
						<th rowspan="2" width="80">Total Sewing Input Qty</th>
						<th rowspan="2" width="80">Total Sewing Output Qty</th>
						<th rowspan="2" width="80">Finishing Rcv.</th>
						<th rowspan="2" width="80">Sent to Wash</th>
						<th rowspan="2" width="80">Rcv Wash</th>
						<th rowspan="2" width="80">Total Iron Qty</th>
						<th rowspan="2" width="80">Total Re-Iron Qty</th>
						<th rowspan="2" width="80">Hang Tag</th>
                        <th colspan="3">Poly Qty</th>
                        <th rowspan="2" width="80">Poly Comp %</th>
						<th colspan="5">Finish Qty</th>
						<th rowspan="2" width="80">Fin Comp %</th>

						<th rowspan="2" width="80">Reject Qty Others</th>
						<th rowspan="2" width="80">Sewing Reject Qty</th>
						<th rowspan="2" width="80">Replace Quantity</th>
						<th rowspan="2" width="80">Total Ex-Factory</th>
						<th rowspan="2" width="80">Shortage Qty.</th>
						<th rowspan="2" width="80">Excess Qty.</th>
						<th rowspan="2" width="80">Balance</th>
						<th rowspan="2" width="85">Status</th>
						<th rowspan="2" >Remarks</th>
					 </tr>
					 <tr>
                        <th width="80">Inhouse</th>
                        <th width="80">SubCon</th>
                        <th width="80">Inhouse</th>
                        <th width="80">SubCon</th>
                        <th width="80">Inhouse</th>
                        <th width="80">SubCon</th>
                        <th width="80">Inhouse</th>
                        <th width="80">SubCon</th>
                        <th width="80">Sew Input.</th>
                        <th width="80">Sew OutPut </th>
                        <th width="80">Sew Input.</th>
                        <th width="80">Sew OutPut </th>
                        <th width="80">In-house</th>
                        <th width="80">Out-bound </th>
                        <th width="80">Total</th>

                        <th width="80">In-house</th>
                        <th width="80">Out-bound </th>
                        <th width="80">Transfer In</th>
                        <th width="80">Transfer Out </th>
                        <th width="80">Total</th>
					</tr>
				</thead>
			</table>
			<div style="max-height:425px; overflow-y:scroll; width:5510px" id="scroll_body">
				<table border="1" class="rpt_table" width="5490" rules="all" id="table_body">
				<?  echo $html; //echo $subcon_html;?>
				</table>
				<table border="1" class="tbl_bottom" width="5410" rules="all" id="report_table_footer" >
					<tr>
						<td width="30">&nbsp;</td>
                        <td width="100">&nbsp;</td>
                        <td width="100">&nbsp;</td>
						<td width="127">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="60">&nbsp;</td>
						<td width="60">&nbsp;</td>

                        <td width="100">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="120">&nbsp;</td>
						<td width="124">Total</td>
						<td width="50"><? echo fn_number_format($tot_smv,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_po_quantity_in_pcs,2);?></td>
						<td width="76">&nbsp;</td>
						<td width="80" ><? echo fn_number_format($tot_fob_value,2);?></td>

						<td width="80">&nbsp;</td>
						<td width="80">&nbsp;</td>
						<td width="78">&nbsp;</td>
						<td width="78">&nbsp;</td>
						<td width="80" ><? echo fn_number_format($tot_plan_cut_qnty,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_cut_lay,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_cut_qnty,2);?></td>

						<td width="80" ><? echo fn_number_format($tot_qc_pending,2);?></td>
						<td width="80"><? echo fn_number_format($tot_cut_reject,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_cut_replace_qty,2);?></td>
						<td width="73">&nbsp;</td>
						<td width="80" ><? echo fn_number_format($tot_short_excess_cut_per,2);?></td>
						<td width="80"><? echo fn_number_format($tot_issue_inhouse,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_issue_subcon,2);?></td>

						<td width="80" ><? echo fn_number_format($tot_print_rcv_inhouse,2);?></td>
						<td width="80"><? echo fn_number_format($tot_print_rcv_subcon,2);?></td>
						<td width="76" ><? echo fn_number_format($tot_emb_issue_inhouse,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_emb_issue_subcon,2);?></td>

						<td width="80" ><? echo fn_number_format($tot_emb_rcv_inhouse,2);?></td>
						<td width="76" ><? echo fn_number_format($tot_emb_rcv_subcon,2);?></td>
						<td width="76" ><? echo fn_number_format($tot_spc_qty_issue,2);?></td>

						<td width="80" ><? echo fn_number_format($tot_special_rec,2);?></td>
						<td width="80"><? echo fn_number_format($tot_sew_in_qnty,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_sew_out_qnty,2);?></td>

						<td width="80" ><? echo fn_number_format($tot_sew_in_subcon,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_sew_out_subcon,2);?></td>

						<td width="77" ><? echo fn_number_format($total_sewing_qnty,2);?></td>
						<td width="78"><? echo fn_number_format($total_sewing_out_qnty,2);?></td>

						<td width="80" ><? echo fn_number_format($tot_finish_rcv,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_wash_issue,2);?></td>
						<td width="78" ><? echo fn_number_format($tot_wash_rec,2);?></td>
						<td width="80"><? echo fn_number_format($tot_iron_qnty,2);?></td>
						<td width="78" ><? echo fn_number_format($tot_reiron_qnty,2);?></td>
						<td width="80"><? echo fn_number_format($tot_hangtag_qnty,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_poly_in_qnty,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_poly_out_qnty,2);?></td>

						<td width="77">&nbsp;</td>
						<td width="80" ><? echo fn_number_format($tot_poly_status,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_finish_qnty_in,2);?></td>
						<td width="80" ><? echo fn_number_format($tot_finish_qnty_out,2);?></td>
						<td width="78" ><? echo fn_number_format($tot_finish_qnty_tarnsferIn,2);?></td>
						<td width="78" ><? echo fn_number_format($tot_finish_qnty_tarnsferOut,2);?></td>
						<td width="79">&nbsp;</td>

						<td width="80" ><? echo fn_number_format($tot_finish_status,2);?></td>
						<td width="80" ><? echo fn_number_format($total_rej_value,2);?></td>
						<td width="80" ><? echo fn_number_format($total_sew_rej_value,2);?></td>
						<td width="80"  ></td>
						<td align="right" width="80"><span ><? echo fn_number_format($tot_replace_qty,2);?></span></td>
						<td width="80" ><? echo fn_number_format($tot_ex_factory,2);?></td>
						<td align="right" width="75"><span><? echo fn_number_format($tot_shortage,2);?></span></td>
						<td width="85">&nbsp;</td>
						<td width="47">&nbsp;</td>
					</tr>
				</table>
			</div>
		 </div>
		<?
	}


	$total_data=ob_get_contents();
	$xlHtml=$total_data;


	// if($type<1){
	// 	$xlHtml=  strip_tags($xlHtml, '<table></table><thead></thead><tbody></tbody><tfoot></tfoot><tr></tr><th></th><td></td><br>');
	// }

	foreach (glob("$user_id*.xls") as $filename)
	{
		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$name=time();
	$filename=$user_id."_".$name.".xls";
	$create_new_doc = fopen($filename,'w');
	$is_created = fwrite($create_new_doc,$xlHtml);
	ob_clean();
	echo "$total_data####$filename####$type";
	exit();
}
//-------------------------------------------END Show Date Wise------------------------

if($action=="update_tna_progress_comment")
{
	//echo load_html_head_contents("TNA Info","../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);

	if($db_type==0) $blank_date="0000-00-00"; else $blank_date="";

	$tna_task_arr=return_library_array( "select task_name, task_short_name from lib_tna_task",'task_name','task_short_name');

	$tna_task_id=array(); $plan_start_array=array(); $plan_finish_array=array();
	$actual_start_array=array();
	$actual_finish_array=array();

	$notice_start_array=array();
	$notice_finish_array=array();

	$task_sql= sql_select("select a.task_number,a.task_start_date,a.task_finish_date,a.actual_start_date,a.actual_finish_date,a.notice_date_start,a.notice_date_end from tna_process_mst a, lib_tna_task b where a.task_number=b.task_name and a.template_id=$template_id and a.po_number_id=$po_id order by b.task_sequence_no asc");
	foreach ($task_sql as $row_task)
	{
		$tna_task_id[]=$row_task[csf("task_number")];

		$plan_start_array[$row_task[csf("task_number")]] =$row_task[csf("task_start_date")];
		$plan_finish_array[$row_task[csf("task_number")]]=$row_task[csf("task_finish_date")];

		$actual_start_array[$row_task[csf("task_number")]] =$row_task[csf("actual_start_date")];
		$actual_finish_array[$row_task[csf("task_number")]]=$row_task[csf("actual_finish_date")];

		$notice_start_array[$row_task[csf("task_number")]] =$row_task[csf("notice_date_start")];
		$notice_finish_array[$row_task[csf("task_number")]]=$row_task[csf("notice_date_end")];
	}



	$comments_array=array(); $responsible_array=array();
	$res_comm_sql= sql_select("select task_id, comments, responsible from tna_progress_comments where tamplate_id=$template_id and order_id=$po_id");
	foreach ($res_comm_sql as $row_res_comm)
	{
		$comments_array[$row_res_comm[csf("task_id")]] =$row_res_comm[csf("comments")];
		$responsible_array[$row_res_comm[csf("task_id")]]=$row_res_comm[csf("responsible")];
	}

	$execution_time_array=array();
	$execution_time_sql= sql_select("select tna_task_id, execution_days from tna_task_template_details where task_template_id=$template_id");
	foreach ($execution_time_sql as $row_execution_time)
	{
		$execution_time_array[$row_execution_time[csf("tna_task_id")]] =$row_execution_time[csf("execution_days")];
	}

	$lead_time=return_library_array("select task_template_id,lead_time from tna_task_template_details group by task_template_id,lead_time","task_template_id","lead_time");
	$company_library=return_library_array( "select id,company_short_name from lib_company", "id", "company_short_name"  );
    $buyer_short_library=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
	?>


	<fieldset style="width:1010px">
        <div class="form_caption" align="center"><strong>TNA Progress Comment</strong></div>
        <table style="margin-top:10px" width="1000" border="1" rules="all" class="rpt_table">
            <?
			$sql ="select b.company_name,b.buyer_name,a.po_number,b.job_no,b.style_ref_no,b.gmts_item_id,a.po_received_date,a.shipment_date from wo_po_break_down a,wo_po_details_master b where a.id=$po_id and a.job_id=b.id";
			//echo $sql;die;
			$result=sql_select($sql);
            foreach($result as $row)
            {
            ?>
            	<thead>
                    <tr bgcolor="#E9F3FF">
                        <th width="130">Company</th>
                        <td width="196" style="padding-left:5px"><? echo $company_library[$row[csf('company_name')]];  ?></td>
                        <th width="130">Buyer</th>
                        <td width="186" style="padding-left:5px"><? echo $buyer_short_library[$row[csf('buyer_name')]];  ?></td>
                        <th width="130">Order No</th>
                        <td width="186" style="padding-left:5px"><p><? echo $row[csf('po_number')]; ?></p></td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <th>Style Ref.</th>
                        <td style="padding-left:5px"><p><? echo $row[csf('style_ref_no')]; ?></p></td>
                        <th>RMG Item</th>
                        <td style="padding-left:5px"><p><? echo $garments_item[$row[csf('gmts_item_id')]]; ?></p></td>
                        <th>Order Recv. Date</th>
                        <td style="padding-left:5px"><? echo change_date_format($row[csf('po_received_date')]); ?></td>
                    </tr>
                    <tr bgcolor="#E9F3FF">
                        <th>Ship Date</th>
                        <td style="padding-left:5px"><? echo change_date_format($row[csf('shipment_date')]); ?></td>
                        <th>Lead Time</th>
                        <td style="padding-left:5px">
                            <?
								$template_id=str_replace("'","",$template_id);

								if($tna_process_type==1)
								{
									$lead_timee=$lead_time[$template_id];
								}
								else
								{
									$lead_timee=$template_id;
								}
								//echo $lead_time=return_field_value("lead_time","tna_task_template_details", "task_template_id='$template_id' and status_active=1 and is_deleted=0");
								echo $lead_timee;
							?>
                        </td>
                        <th>Job Number</th>
                        <td style="padding-left:5px">
							<? echo $row[csf('job_no')];   ?>
                        </td>
                    </tr>
                </thead>
            <?
            }
            ?>
        </table>
        <table style="margin-top:5px" cellpadding="0" width="1000" class="rpt_table" rules="all" border="1">
            <thead>
                <th width="50">Task No</th>
                <th width="150">Task Name</th>
                <th width="60">Allowed Days</th>
                <th width="80">Plan Start Date</th>
                <th width="80">Plan Finish Date</th>
                <th width="80">Actual Start Date</th>
                <th width="80">Actual Finish Date</th>
                <th width="80">Start Delay/ Early By</th>
                <th width="80">Finish Delay/ Early By</th>
                <th width="100">Responsible</th>
                <th>Comments</th>
            </thead>
        </table>



            <table cellpadding="0" width="1000" cellspacing="0" border="1" rules="all" class="rpt_table">
                <?


				$i=1;
                foreach($tna_task_id as $key)
                {
                    if($i%2==0) $trcolor="#E9F3FF"; else $trcolor="#FFFFFF";

					$bgcolor1=""; $bgcolor="";

					if ($plan_start_array[$key]!=$blank_date)
					{
						if (strtotime($notice_start_array[$key])<=strtotime(date("Y-m-d",time())) && strtotime(date("Y-m-d",time()))<=strtotime($plan_start_array[$key]))  $bgcolor="#FFFF00";
						else if (strtotime($plan_start_array[$key])<strtotime(date("Y-m-d",time())))  $bgcolor="#FF0000";
						else $bgcolor="";

					}

					if ($plan_finish_array[$key]!=$blank_date) {
						if (strtotime($notice_finish_array[$key])<=strtotime(date("Y-m-d",time())) && strtotime(date("Y-m-d",time()))<=strtotime($plan_finish_array[$key]))  $bgcolor1="#FFFF00";
						else if (strtotime($plan_finish_array[$key])<strtotime(date("Y-m-d",time())))  $bgcolor1="#FF0000"; else $bgcolor1="";
					}

					if ($actual_start_array[$key]!=$blank_date) $bgcolor="";
					if ($actual_finish_array[$key]!=$blank_date) $bgcolor1="";

					// Delay / Early............

					$bgcolor5=""; $bgcolor6="";
					$delay=""; $early="";

					if($actual_start_array[$key]!=$blank_date)
					{
						$start_diff1 = datediff( "d", $actual_start_array[$key], $plan_start_array[$key]);
						$finish_diff1 = datediff( "d", $actual_finish_array[$key], $plan_finish_array[$key]);

						$start_diff=$start_diff1-1;
						$finish_diff=$finish_diff1-1;

						if($start_diff<0)
						{
							$bgcolor5="#2A9FFF";	//Blue
							$start="(Delay)";
						}
						if($start_diff>0)
						{
							$bgcolor5="";
							$start="(Early)";

						}
						if($finish_diff<0)
						{
							$bgcolor6="#2A9FFF";
							$finish="(Delay)";
						}
						if($finish_diff>0)
						{
							$bgcolor6="";
							$finish="(Early)";
						}


					}
					else
					{
						if(date("Y-m-d")>$plan_start_array[$key])
						{
							$start_diff1 = datediff( "d", $plan_start_array[$key], date("Y-m-d"));
							$start_diff=$start_diff1-1;
							$bgcolor5="#FF0000";		//Red
							$start="(Delay)";
						}
						if(date("Y-m-d")>$plan_finish_array[$key])
						{
							$finish_diff1 = datediff( "d", $plan_finish_array[$key], date("Y-m-d"));
							$finish_diff=$finish_diff1-1;
							$bgcolor6="#FF0000";
							$finish="(Delay)";
						}
						if(date("Y-m-d")<=$plan_start_array[$key])
						{
							$start_diff = "";
							$bgcolor5="";
							$start="(Ac. Start Dt. Not Found)";
						}
						if(date("Y-m-d")<=$plan_finish_array[$key])
						{
							$finish_diff = "";
							$bgcolor6="";
							$finish="(Ac. Finish Dt. Not Found)";

						}
					}

                    ?>
                    <tr bgcolor="<? echo $trcolor; ?>" id="tr_<? echo $i; ?>" onclick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')">
                        <td align="center" width="50"><? echo $i; ?></td>
                        <td width="150"><? echo $tna_task_arr[$key]; ?></td>
                        <td align="center" width="60"><? echo datediff( "d", $plan_start_array[$key],$plan_finish_array[$key]);//$execution_time_array[$key]; ?></td>
                        <td align="center" width="80"><? echo change_date_format($plan_start_array[$key]); ?>&nbsp;</td>
                        <td align="center" width="80"><? echo change_date_format($plan_finish_array[$key]); ?>&nbsp;</td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor;  ?>">
                            <?
                                if($actual_start_array[$key]=="0000-00-00" || $actual_start_array[$key]=="") echo "&nbsp;";
                                else echo change_date_format($actual_start_array[$key]);
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor1;  ?>">
                            <?
                                 if($actual_finish_array[$key]=="0000-00-00" || $actual_finish_array[$key]=="") echo "&nbsp;";
                                 else echo change_date_format($actual_finish_array[$key]);
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor5;  ?>">
							<?
                                echo $start_diff." ".$start;
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor6;  ?>">
                            <?
                                echo $finish_diff." ".$finish;
                            ?>
                        </td>

                        <td width="100"><p><? echo $responsible_array[$key]; ?>&nbsp;</p></td>
                        <td><p><? echo $comments_array[$key]; ?>&nbsp;</p></td>
                    </tr>
              	<?
                    $i++;
                }
                ?>
            </table>
    </fieldset>
	<?
	exit();
}

if($action=='OrderPopup')
{
	echo load_html_head_contents("Order Wise Production Report", "../../../", 1, 1,$unicode,'','');

	$po_break_down_id=$_REQUEST['po_break_down_id'];
	$item_id=$_REQUEST['item_id'];
	$company_name=str_replace("'","",$_REQUEST['company_name']);
	$color_variable_setting=return_field_value("ex_factory","variable_settings_production","company_name='$company_name' and variable_list=1 and status_active=1 and is_deleted=0","ex_factory");
	$color_variable_setting = ($color_variable_setting==0) ? 3 : $color_variable_setting;
	$ex_fact_qty_arr=array();
	if($color_variable_setting==2 || $color_variable_setting==3)
	{
		$sql_exfect="SELECT c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_break_down_id) and a.item_number_id=$item_id and a.status_active=1 and a.is_deleted=0 group by  c.color_number_id, c.size_number_id";
		//echo $sql_exfect."<br>";
		$sql_result_exfact=sql_select($sql_exfect);
		foreach($sql_result_exfact as $row)
		{
			$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("size_number_id")]]=$row[csf("production_qnty")];
		}
	}

	//var_dump($color_variable_setting);die;
	//echo "select a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where a.status_active=1 and a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.")";die;
	$color_size_sql=sql_select( "SELECT a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.status_active=1 and a.is_deleted=0 and a.po_break_down_id in (".$po_break_down_id.") order by a.color_order,a.size_order");
	$color_size_data=array();
	foreach($color_size_sql as $row)
	{
		//$test_data[]=$row[csf("color_number_id")];

		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
		$color_library[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$size_library[$row[csf("size_number_id")]]=$row[csf("size_number_id")];

	}

	//var_dump($color_size_data);die;

	//echo "<pre>";print_r($color_library);
	//echo "<pre>";print_r($size_library);die;

	//$color_library=sql_select("select distinct(color_number_id) as color_number_id from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and color_mst_id!=0 and status_active=1 ");
	//$size_library=sql_select("select distinct(size_number_id) as size_number_id from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and size_mst_id!=0 and status_active=1");

	if($db_type==0)
	{
		$prod_sql= sql_select("SELECT a.po_break_down_id, c.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='11' THEN c.production_qnty ELSE 0 END),0) AS poly_qty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.po_break_down_id in (".$po_break_down_id.") and a.item_number_id=$item_id and c.status_active=1 and a.status_active=1
			group by a.po_break_down_id,c.color_size_break_down_id");
				/*IFNULL(sum(CASE WHEN c.production_type ='2' THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='3' THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty, */
	}
	else
	{
		$prod_sql=sql_select("SELECT a.po_break_down_id, c.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				NVL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty,
				NVL(sum(CASE WHEN a.production_type ='11' THEN c.production_qnty ELSE 0 END),0) AS poly_qty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.po_break_down_id in (".$po_break_down_id.") and a.item_number_id=$item_id and c.status_active=1 and a.status_active=1
			group by a.po_break_down_id,c.color_size_break_down_id");
				/*NVL(sum(CASE WHEN c.production_type ='2' THEN  c.production_qnty  ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN c.production_type ='3' THEN  c.production_qnty  ELSE 0 END),0) AS printreceived_qnty, */
	}
	$prod_color_size_data=array();
	foreach($prod_sql as $row)
	{
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["cutting_qnty"]+=$row[csf("cutting_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printing_qnty"]+=$row[csf("printing_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printreceived_qnty"]+=$row[csf("printreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["emb_qnty"]+=$row[csf("emb_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["embreceived_qnty"]+=$row[csf("embreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["wash_qnty"]+=$row[csf("wash_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["washreceived_qnty"]+=$row[csf("washreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sp_qnty"]+=$row[csf("sp_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["spreceived_qnty"]+=$row[csf("spreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingin_qnty"]+=$row[csf("sewingin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingout_qnty"]+=$row[csf("sewingout_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finishin_qnty"]+=$row[csf("finishin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["iron_qnty"]+=$row[csf("iron_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finish_qnty"]+=$row[csf("finish_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qty"]+=$row[csf("poly_qty")];
	}
	//echo "<pre>";
	//print_r($prod_color_size_data);die;


	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:700px" align="center" id="details_reports">
	  	<legend>Color And Size Wise Summary</legend>
	    <table id="tbl_id" class="rpt_table" width="" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="100">Buyer</th>
	                <th width="100">Job Number</th>
	                <th width="100">Style Name</th>
	                <th width="300">Order Number</th>
	                <th width="100">Ship Date</th>
	                <th width="100">Item Name</th>
	                <th width="100">Order Qty.</th>
	            </tr>
	        </thead>
	       	<?
	        	$buyer_short_library=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
				if($db_type==0)
				{
	 				$sql = "SELECT a.job_no_mst,group_concat(distinct(d.order_quantity)) as po_number,a.pub_shipment_date, sum(a.po_quantity) as po_quantity,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,c.set_item_ratio,c.gmts_item_id,d.item_number_id
						from wo_po_break_down a, wo_po_details_master b, wo_po_details_mas_set_details c,wo_po_color_size_breakdown d
						where a.job_id=b.id and b.id=c.job_id and a.id in ($po_break_down_id) and c.gmts_item_id=$item_id and d.item_number_id=$item_id and a.id=d.po_break_down_id and b.id=d.job_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.status_active=1 and d.is_deleted=0";
				}
				else
				{
					$sql = "SELECT a.job_no_mst, LISTAGG(a.po_number, ',') WITHIN GROUP (ORDER BY a.id) as po_number,max(a.pub_shipment_date) as pub_shipment_date, a.po_quantity as po_quantity,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,c.set_item_ratio,c.gmts_item_id,d.item_number_id
						from wo_po_break_down a, wo_po_details_master b, wo_po_details_mas_set_details c,wo_po_color_size_breakdown d
						where a.job_id=b.id and b.job_no=c.job_no and a.id in ($po_break_down_id) and c.gmts_item_id=$item_id and d.item_number_id=$item_id and a.id=d.po_break_down_id and b.id=d.job_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and d.status_active=1 and d.is_deleted=0 group by a.job_no_mst, a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,c.set_item_ratio,c.gmts_item_id,d.item_number_id, a.po_quantity";
				}
				// echo $sql;die;
				$resultRow=sql_select($sql);

				$cons_embr=return_field_value("sum(cons_dzn_gmts) as cons_dzn_gmts","wo_pre_cost_embe_cost_dtls","job_no='".$resultRow[0][csf("job_no_mst")]."' and status_active=1 and is_deleted=0","cons_dzn_gmts");

	 		?>
	        <tr>
	        	<td><? echo $buyer_short_library[$resultRow[0][csf("buyer_name")]]; ?></td>
	            <td><p><? echo $resultRow[0][csf("job_no_mst")]; ?></p></td>
	            <td><p><? echo $resultRow[0][csf("style_ref_no")]; ?></p></td>
	            <td><p><? echo implode(",",array_unique(explode(",",$resultRow[0][csf("po_number")]))); ?></p></td>
	            <td><? echo change_date_format($resultRow[0][csf("pub_shipment_date")]); ?></td>
	            <td><? echo $garments_item[$item_id]; ?></td>
	            <td><? echo $resultRow[0][csf("po_quantity")]; ?></td>
	        </tr>
	         <?
	         $prod_sewing_sql=sql_select("SELECT sum(alter_qnty) as alter_qnty, sum(reject_qnty) as reject_qnty from pro_garments_production_mst where production_type=5 and po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and is_deleted=0 and status_active=1");
			 foreach($prod_sewing_sql as $sewingRow);
			?>
	        <tr>
	        	<td colspan="2">Total Alter Sewing Qty : <b><? echo $sewingRow[csf("alter_qnty")]; ?></b></td>
	        	<td colspan="2">Total Reject Sewing Qty : <b><? echo $sewingRow[csf("reject_qnty")]; ?></b></td>
	            <td colspan="2">Pack Assortment: <b><? echo $packing[$resultRow[csf("packing")]]; ?></b></td>
	        </tr>
	    </table>
	    <?

		  $size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
		  $count = count($size_library);
		  $width= $count*70+350;

		?>
	    <table id="tblDtls_id" class="rpt_table" width="<? echo $width; ?>" border="1" rules="all" >
		 	<thead>
	        	<tr>
	            	<th width="100">Color Name</th>
	                <th width="170">Production Type</th>
	 				<?
					foreach($size_library as $sizeRes)
					{
					 	?><th width="80"><? echo $size_Arr_library[$sizeRes]; ?></th><?
					}
					?>
	     		    <th width="60">Total</th>
	           </tr>
	        </thead>
	        <?
			  //var_dump($color_library);
	       		$cut_lay_sqls="select b.color_id,c.size_id,sum(c.size_qty) as qty from  ppl_cut_lay_mst a,  ppl_cut_lay_dtls b, ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id in($po_break_down_id) and b.gmt_item_id=$item_id group by b.color_id,c.size_id";
				foreach(sql_select($cut_lay_sqls) as $k=>$vl)
				{
					$cut_lay_arr[$vl[csf("color_id")]][$vl[csf("size_id")]]=$vl[csf("qty")];
					$cut_lay_total[$vl[csf("color_id")]]+=$vl[csf("qty")];
				}
				// ==============================================
				$sql_avg = "SELECT AVG (excess_cut_perc) AS avg_excess_cut_perc,color_number_id FROM wo_po_color_size_breakdown where po_break_down_id in($po_break_down_id) and item_number_id =$item_id and status_active=1 AND is_deleted = 0 group by color_number_id";
				// echo $sql_avg;
				$avg_res = sql_select($sql_avg);
				$color_avg_arr = array();
				foreach ($avg_res as $val)
				{
					$color_avg_arr[$val['COLOR_NUMBER_ID']] = $val['AVG_EXCESS_CUT_PERC'];
				}
				// =========================================================
			  foreach($color_library as $colorRes)
			  {
				  if($color_variable_setting==2 || $color_variable_setting==3) $row_span=18; else $row_span=17;
				?>
				<tr>
					<td rowspan="<? echo $row_span; ?>"><? echo $color_Arr_library[$colorRes]; ?></td>

	 			<?
	            	  $i=0;$j=0;$sqlPart="";
					  foreach($size_library as $sizeRes)
					  {
						  $i++;$j++;
						  if($i>1) $sqlPart .=",";
						  $sqlPart .= 'SUM( CASE WHEN color_number_id='.$colorRes.' and size_number_id='.$sizeRes.' THEN order_quantity ELSE 0 END ) as '."col".$i;
						  $sqlPart .= ',SUM( CASE WHEN color_number_id='.$colorRes.' and size_number_id='.$sizeRes.' THEN plan_cut_qnty ELSE 0 END ) as '."pcut".$i;
						  $sqlPart .= ',SUM( CASE WHEN color_number_id='.$colorRes.' and size_number_id='.$sizeRes.' THEN excess_cut_perc ELSE 0 END ) as '."excess_cut".$i;
					  }
					  if($j>1)
					  {
						 $sqlPart .=',SUM( CASE WHEN color_number_id='.$colorRes.' THEN order_quantity ELSE 0 END ) as totalorderqnty';
						 $sqlPart .=',SUM( CASE WHEN color_number_id='.$colorRes.' THEN plan_cut_qnty ELSE 0 END ) as totalplancutqnty';
					  }
					$sql = sql_select("select avg(excess_cut_perc) as avg_excess_cut_perc,max(excess_cut_perc) as excess_cut_perc,". $sqlPart ." from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and status_active=1  and is_deleted=0");
					//echo $sql;die;
					foreach($sql as $resRow);
	 					$bgcolor1="#E9F3FF";
						$bgcolor2="#FFFFFF";

					?>
						</tr>
						<tr bgcolor="<? echo $bgcolor1; ?>">
							<td><b>Order Quantity</b></td>
	                        <? for($k=1;$k<=$i;$k++) {	$col = 'col'.$k; ?>
	                         	<td><? echo $resRow[csf($col)]; ?></td>
							<? } ?>
	                         <td><? echo $resRow[csf("totalorderqnty")]; ?></td>
						</tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Plan To Cut (AVG <? echo number_format($color_avg_arr[$colorRes],2); ?>)% </b></td>
	                        <? for($k=1;$k<=$i;$k++){ $col = 'pcut'.$k;$excess_cut = 'excess_cut'.$k;	?>
	                         	<td title="Excess Cut <? echo $resRow[csf($excess_cut)]; ?>%"><? echo $resRow[csf($col)]; ?></td>
							<? } ?>
	                         <td><? echo $resRow[csf("totalplancutqnty")]; ?></td>
	                    </tr>

	                    <tr bgcolor="<? echo $bgcolor1; ?>">
							<td><b>Cut and Lay</b></td>
	                        <? foreach($size_library as $size_id=>$size_val){?>
	                         	<td><? echo $cut_lay_arr[$colorRes][$size_id]; ?></td>
							<? } ?>
	                         <td><? echo $cut_lay_total[$colorRes]; ?></td>
						</tr>



	                <?
	 				$total_cutting=0;$total_sew_in=0;$total_sew_out=0;$total_fin_in=0;$total_fin_out=0;$total_iron_out=0; $total_exfact_qnty=0;
					$total_print_issue=0;$total_print_rcv=0;$total_embro_issue=0;$total_embro_rcv=0; $total_sp_issue=0;$total_sp_rcv=0; $total_wash_issue=0; $total_wash_rcv=0; $total_poly=0;
					$cutting_html='';$sewin_html='';$sewout_html=''; $poly_html=''; $finisin_html='';$finisout_html='';$iron_html=''; $exfact_html='';
					$printiss_html=''; $printrcv_html=''; $embroiss_html=''; $embrorcv_html=''; $spiss_html=''; $sprcv_html=''; $washiss_html=''; $washrcv_html='';
					$k=0;
					foreach($size_library as $sizeRes)
					{
						$k++;

						/*if($db_type==0)
						{
							$prod_sql= sql_select("SELECT
									IFNULL(sum(CASE WHEN c.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
									IFNULL(sum(CASE WHEN c.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
								from
									pro_garments_production_mst a, pro_garments_production_dtls c,wo_po_color_size_breakdown d
								where
									a.id=c.mst_id and d.po_break_down_id in (".$po_break_down_id.") and d.item_number_id='$item_id' and d.color_number_id=".$colorRes[csf("color_number_id")]." and d.size_number_id=".$sizeRes[csf("size_number_id")]." and c.color_size_break_down_id=d.id and c.status_active=1 $location $floor ");
						}
						else
						{
							$prod_sql=sql_select("SELECT
									NVL(sum(CASE WHEN c.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
									NVL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
									NVL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
									NVL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
									NVL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
									NVL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
									NVL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
									NVL(sum(CASE WHEN c.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
									NVL(sum(CASE WHEN c.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
									NVL(sum(CASE WHEN c.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
									NVL(sum(CASE WHEN c.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
									NVL(sum(CASE WHEN c.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
									NVL(sum(CASE WHEN c.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
									NVL(sum(CASE WHEN c.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
								from
									pro_garments_production_mst a, pro_garments_production_dtls c, wo_po_color_size_breakdown d
								where
									a.id=c.mst_id and d.po_break_down_id in (".$po_break_down_id.") and d.item_number_id='$item_id' and d.color_number_id=".$colorRes[csf("color_number_id")]." and d.size_number_id=".$sizeRes[csf("size_number_id")]." and c.color_size_break_down_id=d.id and c.status_active=1 $location $floor ");
						}*/
						//echo $prod_sql;$prod_sql; $prod_color_size_data[$row[csf("color_number_id")]][$row[csf("size_number_id")]]["cutting_qnty"]
						//foreach($prod_sql as $prodRow);

						$col = 'col'.$k;
	                    if($prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						$cutting_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"].'</td>';
	                    $total_cutting+=$prod_color_size_data[$colorRes][$sizeRes]["cutting_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $printiss_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"].'</td>';
	                    $total_print_issue+=$prod_color_size_data[$colorRes][$sizeRes]["printing_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $printrcv_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"].'</td>';
	                    $total_print_rcv+=$prod_color_size_data[$colorRes][$sizeRes]["printreceived_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $embroiss_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"].'</td>';
	                    $total_embro_issue+=$prod_color_size_data[$colorRes][$sizeRes]["emb_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $embrorcv_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"].'</td>';
	                    $total_embro_rcv+=$prod_color_size_data[$colorRes][$sizeRes]["embreceived_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $spiss_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"].'</td>';
	                    $total_sp_issue+=$prod_color_size_data[$colorRes][$sizeRes]["sp_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $sprcv_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"].'</td>';
	                    $total_sp_rcv+=$prod_color_size_data[$colorRes][$sizeRes]["spreceived_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $washiss_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"].'</td>';
	                    $total_wash_issue+=$prod_color_size_data[$colorRes][$sizeRes]["wash_qnty"];

						if($cons_embr>0)
						{
							if($prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"]==0)$bgCol="bgcolor='#FF0000'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"]>= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $washrcv_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"].'</td>';
	                    $total_wash_rcv+=$prod_color_size_data[$colorRes][$sizeRes]["washreceived_qnty"];

						if($prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewin_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"].'</td>';
	                    $total_sew_in+=$prod_color_size_data[$colorRes][$sizeRes]["sewingin_qnty"];

						if($prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewout_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"].'</td>';
	                    $total_sew_out+=$prod_color_size_data[$colorRes][$sizeRes]["sewingout_qnty"];

						/*if($prodRow[csf("finishin_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						else if($prodRow[csf("finishin_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prodRow[csf("finishin_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisin_html .='<td '.$bgCol.'>'.$prodRow[csf("finishin_qnty")].'</td>';
	                    $total_fin_in+=$prodRow[csf("finishin_qnty")];*/

						if($prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisout_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"].'</td>';
	                    $total_fin_out+=$prod_color_size_data[$colorRes][$sizeRes]["finish_qnty"];

						if($prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $iron_html .='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"].'</td>';
	                    $total_iron_out+=$prod_color_size_data[$colorRes][$sizeRes]["iron_qnty"];

						//if($prodRow[csf("iron_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						//else if($prodRow[csf("iron_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						//else if($prodRow[csf("iron_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							$bgCol=="bgcolor='#FFFFFF'";
							$exfact_html.='<td>'.$ex_fact_qty_arr[$colorRes][$sizeRes].'&nbsp;</td>';

							$total_exfact_qnty+=$ex_fact_qty_arr[$colorRes][$sizeRes];
						}

						if($prod_color_size_data[$colorRes][$sizeRes]["poly_qty"]==0)$bgCol="bgcolor='#FF0000'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["poly_qty"] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prod_color_size_data[$colorRes][$sizeRes]["poly_qty"] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $poly_html.='<td '.$bgCol.'>'.$prod_color_size_data[$colorRes][$sizeRes]["poly_qty"].'</td>';
	                    $total_poly+=$prod_color_size_data[$colorRes][$sizeRes]["poly_qty"];


					}// end size foreach loop

					?>
						<tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Cutting</b></td>
	                        <? echo $cutting_html; ?>
	                        <td><? echo $total_cutting; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Print Issue</b></td>
	                        <? echo $printiss_html; ?>
	                        <td><? echo $total_print_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Print Received</b></td>
	                        <? echo $printrcv_html; ?>
	                        <td><? echo $total_print_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Embro Issue</b></td>
	                        <? echo $embroiss_html; ?>
	                        <td><? echo $total_embro_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Embro Received</b></td>
	                        <? echo $embrorcv_html; ?>
	                        <td><? echo $total_embro_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Special Works</b></td>
	                        <? echo $spiss_html; ?>
	                        <td><? echo $total_sp_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Special Works</b></td>
	                        <? echo $sprcv_html; ?>
	                        <td><? echo $total_sp_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Sewing Input</b></td>
	                       <? echo $sewin_html; ?>
	                        <td><? echo $total_sew_in; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Sewing Output</b></td>
	                        <? echo $sewout_html; ?>
	                        <td><? echo $total_sew_out; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Wash</b></td>
	                        <? echo $washiss_html; ?>
	                        <td><? echo $total_wash_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Wash</b></td>
	                        <? echo $washrcv_html; ?>
	                        <td><? echo $total_wash_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Iron Output</b></td>
	                        <? echo $iron_html; ?>
	                        <td><? echo $total_iron_out; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Poly Qty.</b></td>
	                       <? echo $poly_html; ?>
	                        <td><? echo $total_poly; ?></td>
	                    </tr>
	                   <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Finishing Output</b></td>
	                       <? echo $finisout_html; ?>
	                        <td><? echo $total_fin_out; ?></td>
	                    </tr>
	                    <?
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							?>
							<tr>
								<td colspan="2" align="center"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Ex-Factory Qty.</b></td>
								 <? echo $exfact_html; ?>
								<td><? echo $total_exfact_qnty; ?>&nbsp;</td>
							</tr>
							<?
						}
						?>
				<?
				}// end color foreach loop
				?>


	 </table>
	</div>


	<?
	exit();

}// end if condition

if ($action=='OrderPopup_country')
{
	echo load_html_head_contents("Order Wise Production Report", "../../../", 1, 1,$unicode,'','');
	extract($_REQUEST);

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$company_name=str_replace("'","",$company_name);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);

	//echo $po_break_down_id."****".$company_name."****".$item_id."****".$country_id."****".$color_id;die;
	if($country_id>0) $contry_cond=" and a.country_id='$country_id'"; else $contry_cond="";
	$sql_exfect="SELECT c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id =$po_break_down_id and c.color_number_id='$color_id' $contry_cond and a.status_active=1 and a.is_deleted=0 group by  c.color_number_id, c.size_number_id";
	$sql_result_exfact=sql_select($sql_exfect);
	foreach($sql_result_exfact as $row)
	{
		$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("size_number_id")]]=$row[csf("production_qnty")];
	}

	$color_library=array(); $size_library=array(); $color_library_plan=array(); $dataQty=array();
	if($country_id>0) $contry_cond_col_size=" and country_id='$country_id'"; else $contry_cond_col_size="";
	$colorSizeData=sql_select("SELECT id, color_number_id, size_number_id,size_order, order_quantity, plan_cut_qnty, excess_cut_perc from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and color_number_id='$color_id' $contry_cond_col_size and status_active=1 and is_deleted=0 order by size_order");
 	  foreach($colorSizeData as $csRow)
	  {
		  if($csRow[csf('color_number_id')]>0)
		  {
			  $color_library[$csRow[csf('color_number_id')]]+=$csRow[csf('order_quantity')];
			  $color_library_plan[$csRow[csf('color_number_id')]]+=$csRow[csf('plan_cut_qnty')];
		  }

		  if($csRow[csf('size_number_id')]>0)
		  {
			  $size_library[$csRow[csf('size_number_id')]]=$csRow[csf('size_number_id')];
		  }

		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][1]+=$csRow[csf('order_quantity')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][2]+=$csRow[csf('plan_cut_qnty')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][3]+=$csRow[csf('excess_cut_perc')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][4]+=1;
		  $color_size_data[$csRow[csf("id")]]["color_number_id"]=$csRow[csf('color_number_id')];
		  $color_size_data[$csRow[csf("id")]]["size_number_id"]=$csRow[csf('size_number_id')];
	  }




	if($db_type==0)
	{
		$prod_sql= sql_select("SELECT a.po_break_down_id, c.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.status_active=1 and c.status_active=1 and a.po_break_down_id =".$po_break_down_id." and a.item_number_id='$item_id' $contry_cond
			group by a.po_break_down_id,c.color_size_break_down_id");
				/*IFNULL(sum(CASE WHEN c.production_type ='2' THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='3' THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty, */
	}
	else
	{
		 $pr_sql="SELECT a.po_break_down_id, c.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				NVL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.status_active=1 and c.status_active=1 and a.po_break_down_id =".$po_break_down_id." and a.item_number_id='$item_id' $contry_cond
			group by a.po_break_down_id,c.color_size_break_down_id";
			$prod_sql=sql_select($pr_sql);


	}
	//echo $prod_sql;
	$prod_color_size_data=array();
	foreach($prod_sql as $row)
	{
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["cutting_qnty"]+=$row[csf("cutting_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printing_qnty"]+=$row[csf("printing_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printreceived_qnty"]+=$row[csf("printreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["emb_qnty"]+=$row[csf("emb_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["embreceived_qnty"]+=$row[csf("embreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["wash_qnty"]+=$row[csf("wash_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["washreceived_qnty"]+=$row[csf("washreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sp_qnty"]+=$row[csf("sp_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["spreceived_qnty"]+=$row[csf("spreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingin_qnty"]+=$row[csf("sewingin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingout_qnty"]+=$row[csf("sewingout_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finishin_qnty"]+=$row[csf("finishin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["iron_qnty"]+=$row[csf("iron_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finish_qnty"]+=$row[csf("finish_qnty")];
		//$color_library[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		//$size_library[$row[csf("size_number_id")]]=$row[csf("size_number_id")];
	}
	//var_dump($color_library);die;

	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:700px" align="center" id="details_reports">
	  	<legend>Color And Size Wise Summary</legend>
	    <table id="tbl_id" class="rpt_table" width="700" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="70">Buyer</th>
	                <th width="100">Job Number</th>
	                <th width="120">Style Name</th>
	                <th width="100">Order Number</th>
	                <th width="70">Ship Date</th>
	                <th width="150">Item Name</th>
	                <th >Order Qty.</th>
	            </tr>
	        </thead>
	       	<?
				if($country_id>0) $contry_cond=" and c.country_id='$country_id'"; else $contry_cond="";
				$sql = "select a.job_no_mst, a.po_number as po_number,a.pub_shipment_date as pub_shipment_date,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,b.total_set_qnty as set_item_ratio, sum(c.order_quantity) as po_quantity
						from wo_po_break_down a, wo_po_details_master b, wo_po_color_size_breakdown c
						where a.job_id=b.id and a.id=c.po_break_down_id and a.id =$po_break_down_id and c.item_number_id=$item_id and c.color_number_id='$color_id' $contry_cond and a.status_active in(1,2,3) and a.is_deleted=0 and b.status_active=1 and c.status_active in(1,2,3) and b.is_deleted=0
						group by a.job_no_mst, a.po_number,a.pub_shipment_date,a.pub_shipment_date,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,b.total_set_qnty";
				//echo $sql;die;
				$resultRow=sql_select($sql);

				$cons_embr=return_field_value("sum(cons_dzn_gmts) as cons_dzn_gmts","wo_pre_cost_embe_cost_dtls","job_no='".$resultRow[0][csf("job_no_mst")]."' and status_active=1 and is_deleted=0","cons_dzn_gmts");

	 		?>
	        <tbody>
	        	<tr>
	                <td><p><? echo $buyer_short_library[$resultRow[0][csf("buyer_name")]]; ?></p></td>
	                <td><p><? echo $resultRow[0][csf("job_no_mst")]; ?></p></td>
	                <td><p><? echo $resultRow[0][csf("style_ref_no")]; ?></p></td>
	                <td><p><? echo implode(",",array_unique(explode(",",$resultRow[0][csf("po_number")]))); ?></p></td>
	                <td align="center"><? echo change_date_format($resultRow[0][csf("pub_shipment_date")]); ?></td>
	                <td><? echo $garments_item[$item_id]; ?></td>
	                <td align="right"><? echo $resultRow[0][csf("po_quantity")]*$resultRow[0][csf("set_item_ratio")]; ?></td>
	            </tr>
	            <?
				$prod_sewing_sql=sql_select("SELECT sum(alter_qnty) as alter_qnty, sum(reject_qnty) as reject_qnty from pro_garments_production_mst where production_type=5 and po_break_down_id=$po_break_down_id and item_number_id=$item_id and is_deleted=0 and status_active=1");
				?>
	            <tr>
	                <td colspan="2">Total Alter Sewing Qty : <b><? echo $prod_sewing_sql[0][csf("alter_qnty")]; ?></b></td>
	                <td colspan="2">Total Reject Sewing Qty : <b><? echo  $prod_sewing_sql[0][csf("reject_qnty")]; ?></b></td>
	                <td colspan="2">Pack Assortment: <b><? echo $packing[$resultRow[csf("packing")]]; ?></b></td>
	            </tr>
	        </tbody>
	    </table>
	    <?

		  $size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
		  //$color_library_sql;
		  if($country_id>0) $contry_cond=" and country_id='$country_id'"; else $contry_cond="";
		  /*$color_size_sql=sql_select("select color_number_id as color_number_id,size_number_id as size_number_id from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and color_number_id='$color_id' $contry_cond  and status_active=1 ");
		  foreach($color_size_sql as $row)
		  {
			  $color_library[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
			  $size_library[$row[csf("size_number_id")]]=$row[csf("size_number_id")];
		  }*/
		  //$size_library=sql_select("select distinct(size_number_id) as size_number_id from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and size_mst_id!=0 and status_active=1");
		  $count = count($size_library);
		  $width= $count*70+350;

		?>
	    <table id="tblDtls_id" class="rpt_table" width="<? echo $width; ?>" border="1" rules="all" >
		 	<thead>
	        	<tr>
	            	<th width="100">Color Name</th>
	                <th width="170">Production Type</th>
	 				<?
					foreach($size_library as $val)
					{
					 	?><th width="80"><? echo $size_Arr_library[$val]; ?></th><?
					}
					?>
	     		    <th width="60">Total</th>
	           </tr>
	        </thead>
	        <?
			  foreach($color_library as $colorId=>$totalorderqnty)
			  {
				  if($color_variable_setting==2 || $color_variable_setting==3) $row_span=17; else $row_span=16;
				?>
				<tr>

					<td rowspan="<? echo $row_span; ?>"><? echo $color_Arr_library[$color_id]; ?></td>

	 			<?
	            	 /* $i=0;$j=0;$sqlPart="";
					  foreach($size_library as $size_id)
					  {
						  $i++;$j++;
						  if($i>1) $sqlPart .=",";
						  $sqlPart .= 'SUM( CASE WHEN color_number_id='.$color_id.' and size_number_id='.$size_id.' THEN order_quantity ELSE 0 END ) as '."col".$i;
						  $sqlPart .= ',SUM( CASE WHEN color_number_id='.$color_id.' and size_number_id='.$size_id.' THEN plan_cut_qnty ELSE 0 END ) as '."pcut".$i;
						  $sqlPart .= ',SUM( CASE WHEN color_number_id='.$color_id.' and size_number_id='.$size_id.' THEN excess_cut_perc ELSE 0 END ) as '."excess_cut".$i;
					  }
					  if($j>1)
					  {
						 $sqlPart .=',SUM( CASE WHEN color_number_id='.$color_id.' THEN order_quantity ELSE 0 END ) as totalorderqnty';
						 $sqlPart .=',SUM( CASE WHEN color_number_id='.$color_id.' THEN plan_cut_qnty ELSE 0 END ) as totalplancutqnty';
					  }
					$sql = sql_select("select avg(excess_cut_perc) as avg_excess_cut_perc,max(excess_cut_perc) as excess_cut_perc,". $sqlPart ." from wo_po_color_size_breakdown where status_active=1 and po_break_down_id =$po_break_down_id and item_number_id=$item_id");
					//echo $sql;die;
					foreach($sql as $resRow); */

	 					$bgcolor1="#E9F3FF";
						$bgcolor2="#FFFFFF";
					?>
						</tr>

	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                        <td><b>Order Quantity</b></td>
	                        <?
	                        foreach($size_library as $sizeId=>$sizeRes)
	                        {
	                        ?>
	                            <td><? echo $dataQty[$colorId][$sizeId][1]; ?></td>
	                        <?
	                        }
	                        ?>
	                        <td><? echo $totalorderqnty; ?></td>
	                    </tr>

	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                        <td><b>Plan To Cut (AVG <? echo number_format($dataQty[$colorId][$sizeId][3]/$dataQty[$colorId][$sizeId][4],2); ?>)% </b></td>
	                        <?
	                        foreach($size_library as $sizeId=>$sizeRes)
	                        {
	                        ?>
	                            <td title="Excess Cut <? echo $dataQty[$colorId][$sizeId][3]; ?>%"><? echo $dataQty[$colorId][$sizeId][2]; ?></td>
	                        <?
	                        }
	                        ?>
	                        <td><? echo $color_library_plan[$colorId]; ?></td>
	                    </tr>
						<?
	 				$total_cutting=0;$total_sew_in=0;$total_sew_out=0;$total_fin_in=0;$total_fin_out=0;$total_iron_out=0; $total_exfact_qnty=0;
					$total_print_issue=0;$total_print_rcv=0;$total_embro_issue=0;$total_embro_rcv=0; $total_sp_issue=0;$total_sp_rcv=0; $total_wash_issue=0;$total_wash_rcv=0;
					$cutting_html='';$sewin_html='';$sewout_html='';$finisin_html='';$finisout_html='';$iron_html=''; $exfact_html='';
					$printiss_html=''; $printrcv_html=''; $embroiss_html=''; $embrorcv_html=''; $spiss_html=''; $sprcv_html=''; $washiss_html=''; $washrcv_html='';
					foreach($size_library as $sizeId=>$sizeRes)
					{
						$cutting_qnty=$prod_color_size_data[$colorId][$sizeId]['cutting_qnty'];
						$printing_qnty=$prod_color_size_data[$colorId][$sizeId]['printing_qnty'];
						$printreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['printreceived_qnty'];
						$emb_qnty=$prod_color_size_data[$colorId][$sizeId]['emb_qnty'];
						$embreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['embreceived_qnty'];
						$wash_qnty=$prod_color_size_data[$colorId][$sizeId]['wash_qnty'];
						$washreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['washreceived_qnty'];
						$sp_qnty=$prod_color_size_data[$colorId][$sizeId]['sp_qnty'];
						$spreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['spreceived_qnty'];
						$sewingin_qnty=$prod_color_size_data[$colorId][$sizeId]['sewingin_qnty'];
						$sewingout_qnty=$prod_color_size_data[$colorId][$sizeId]['sewingout_qnty'];
						$finishin_qnty=$prod_color_size_data[$colorId][$sizeId]['finishin_qnty'];
						$iron_qnty=$prod_color_size_data[$colorId][$sizeId]['iron_qnty'];
						$finish_qnty=$prod_color_size_data[$colorId][$sizeId]['finish_qnty'];

						$resRow[csf($col)]=$dataQty[$colorId][$sizeId][2];
	                    if($cutting_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($cutting_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($cutting_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						$cutting_html .='<td '.$bgCol.'>'.$cutting_qnty.'</td>';
	                    $total_cutting+=$cutting_qnty;

						if($cons_embr>0)
						{
							if($printing_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($printing_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($printing_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $printiss_html .='<td '.$bgCol.'>'.$printing_qnty.'</td>';
	                    $total_print_issue+=$printing_qnty;

						if($cons_embr>0)
						{
							if($printreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($printreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($printreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $printrcv_html .='<td '.$bgCol.'>'.$printreceived_qnty.'</td>';
	                    $total_print_rcv+=$printreceived_qnty;

						if($cons_embr>0)
						{
							if($emb_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($emb_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($emb_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $embroiss_html .='<td '.$bgCol.'>'.$emb_qnty.'</td>';
	                    $total_embro_issue+=$emb_qnty;

						if($cons_embr>0)
						{
							if($embreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($embreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($embreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $embrorcv_html .='<td '.$bgCol.'>'.$embreceived_qnty.'</td>';
	                    $total_embro_rcv+=$embreceived_qnty;

						if($cons_embr>0)
						{
							if($sp_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($sp_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($sp_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $spiss_html .='<td '.$bgCol.'>'.$sp_qnty.'</td>';
	                    $total_sp_issue+=$sp_qnty;

						if($cons_embr>0)
						{
							if($spreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($spreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($spreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $sprcv_html .='<td '.$bgCol.'>'.$spreceived_qnty.'</td>';
	                    $total_sp_rcv+=$spreceived_qnty;

						if($cons_embr>0)
						{
							if($wash_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($wash_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($wash_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $washiss_html .='<td '.$bgCol.'>'.$wash_qnty.'</td>';
	                    $total_wash_issue+=$wash_qnty;

						if($cons_embr>0)
						{
							if($washreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($washreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($washreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $washrcv_html .='<td '.$bgCol.'>'.$washreceived_qnty.'</td>';
	                    $total_wash_rcv+=$washreceived_qnty;

						if($sewingin_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($sewingin_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($sewingin_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewin_html .='<td '.$bgCol.'>'.$sewingin_qnty.'</td>';
	                    $total_sew_in+=$sewingin_qnty;

						if($sewingout_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($sewingout_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($sewingout_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewout_html .='<td '.$bgCol.'>'.$sewingout_qnty.'</td>';
	                    $total_sew_out+=$sewingout_qnty;

						/*if($prodRow[csf("finishin_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						else if($prodRow[csf("finishin_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prodRow[csf("finishin_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisin_html .='<td '.$bgCol.'>'.$prodRow[csf("finishin_qnty")].'</td>';
	                    $total_fin_in+=$prodRow[csf("finishin_qnty")];*/

						if($finish_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($finish_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($finish_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisout_html .='<td '.$bgCol.'>'.$finish_qnty.'</td>';
	                    $total_fin_out+=$finish_qnty;

						if($iron_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($iron_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($iron_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $iron_html .='<td '.$bgCol.'>'.$iron_qnty.'</td>';
	                    $total_iron_out+=$iron_qnty;

						//if($prodRow[csf("iron_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						//else if($prodRow[csf("iron_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						//else if($prodRow[csf("iron_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							$bgCol=="bgcolor='#FFFFFF'";
							$exfact_html.='<td>'.$ex_fact_qty_arr[$colorId][$sizeId].'&nbsp;</td>';

							$total_exfact_qnty+=$ex_fact_qty_arr[$colorId][$sizeId];
						}


					}// end size foreach loop

					?>
						<tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Cutting</b></td>
	                        <? echo $cutting_html; ?>
	                        <td><? echo $total_cutting; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Print Issue</b></td>
	                        <? echo $printiss_html; ?>
	                        <td><? echo $total_print_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Print Received</b></td>
	                        <? echo $printrcv_html; ?>
	                        <td><? echo $total_print_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Embro Issue</b></td>
	                        <? echo $embroiss_html; ?>
	                        <td><? echo $total_embro_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Embro Received</b></td>
	                        <? echo $embrorcv_html; ?>
	                        <td><? echo $total_embro_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Special Works</b></td>
	                        <? echo $spiss_html; ?>
	                        <td><? echo $total_sp_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Special Works</b></td>
	                        <? echo $sprcv_html; ?>
	                        <td><? echo $total_sp_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Sewing Input</b></td>
	                       <? echo $sewin_html; ?>
	                        <td><? echo $total_sew_in; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Sewing Output</b></td>
	                        <? echo $sewout_html; ?>
	                        <td><? echo $total_sew_out; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Wash</b></td>
	                        <? echo $washiss_html; ?>
	                        <td><? echo $total_wash_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Wash</b></td>
	                        <? echo $washrcv_html; ?>
	                        <td><? echo $total_wash_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Iron Output</b></td>
	                        <? echo $iron_html; ?>
	                        <td><? echo $total_iron_out; ?></td>
	                    </tr>
	                   <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Finishing Output</b></td>
	                       <? echo $finisout_html; ?>
	                        <td><? echo $total_fin_out; ?></td>
	                    </tr>
	                    <?
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							?>
							<tr>
								<td><b>Ex-Factory Qty.</b></td>
								 <? echo $exfact_html; ?>
								<td><? echo $total_exfact_qnty; ?>&nbsp;</td>
							</tr>
							<?
						}
						?>
				<?
				}// end color foreach loop
				?>


	 </table>
	</div>


	<?
	exit();

}

if($action=="finishrcv_popup")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	 $po_id=str_replace("'","",$po_id);
	 $item_id=str_replace("'","",$item_id);
	 $company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	 $size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	 $floorArr = return_library_array("select id,floor_name from lib_prod_floor","id","floor_name");
	 $color_Arr_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" );
	 $buyer_short_library=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name"  );

	 $sql_finish_rcv="SELECT b.color_id,b.size_id,b.fin_receive_qnty,b.po_break_down_id,b.item_id,b.production_date from gmt_finishing_receive_dtls b WHERE b.po_break_down_id=$po_id and b.item_id=$item_id and b.status_active=1 and b.is_deleted=0 order by size_id";

	 $sql_total_finish_rcv=sql_select($sql_finish_rcv);
	 $size_number_arr=array();
	 $finish_rcv_arr=array();
	 $sub_finish_rcv_arr=array();

	 foreach($sql_total_finish_rcv as $row)
	 {
		  $size_number_arr[$row[csf('size_id')]]=$row[csf('size_id')];
		  $finish_rcv_arr[$row[csf('color_id')]][$row[csf('size_id')]]['fin_receive_qnty']+=$row[csf('fin_receive_qnty')];
		  $finish_rcv_arr[$row[csf('color_id')]][$row[csf('size_id')]]['production_date']=$row[csf('production_date')];
		  $sub_finish_rcv_arr[$row[csf('size_id')]]+=$row[csf('fin_receive_qnty')];

	 }
	//  echo '<pre>';print_r($finish_rcv_arr);'</pre>';
	// echo '<pre>';print_r($sub_finish_rcv_arr);'</pre>';

	 $tbl_width=250+(count($size_number_arr)*60);


	 $main_sql="SELECT b.production_date,b.po_break_down_id,b.item_id,b.size_id,b.color_id,b.company_id,b.floor_id as sewing_floor,a.sys_number_prefix_num,a.fini_company_id,a.floor_id as fini_floor,b.fin_receive_qnty from gmt_finishing_receive_mst a,gmt_finishing_receive_dtls b WHERE a.id=b.mst_id and b.po_break_down_id=$po_id and b.item_id=$item_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0";

	 $main_sql_query=sql_select($main_sql);
     $main_arr=array();
	 $size_arr=array();
	 $size_subtotal_arr=array();

	 foreach($main_sql_query as $val)
	 {
		$size_arr[$val[csf('size_id')]]=$val[csf('size_id')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]][$val[csf('size_id')]]['fin_receive_qnty']+=$val[csf('fin_receive_qnty')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['sewing_floor']=$val[csf('sewing_floor')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['fini_floor']=$val[csf('fini_floor')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['sys_number_prefix_num']=$val[csf('sys_number_prefix_num')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['company_id']=$val[csf('company_id')];
		$main_arr[$val[csf('production_date')]][$val[csf('color_id')]]['fini_company_id']=$val[csf('fini_company_id')];
		$size_subtotal_arr[$val[csf('size_id')]]+=$val[csf('fin_receive_qnty')];

	 }
	//  echo '<pre>';  print_r($main_arr); echo'</pre>';

   $table_width_date=820+(count($size_arr)*60);

   $buyer_sql="SELECT a.buyer_name,a.style_ref_no,b.po_number,c.item_number_id,a.job_no_prefix_num,c.po_break_down_id from wo_po_details_master a, wo_po_break_down b,wo_po_color_size_breakdown c where a.id=b.job_id and a.id=c.job_id and b.id=c.po_break_down_id and c.po_break_down_id=$po_id and c.item_number_id=$item_id ";
   $buyer_main_sql=sql_select($buyer_sql);

	?>
        <div id="data_panel" style="width:100%">
	<script>
		function new_window()
		{
			var w = window.open("Surprise", "#");
			var d = w.document.open();
			d.write(document.getElementById('details_reports').innerHTML);
			d.close();
		}

		function fnExportToExcel()
		{
			// $(".fltrow").hide();
			let tableData = document.getElementById("details_reports").innerHTML;
			// alert(tableData);
			let data_type = 'data:application/vnd.ms-excel;base64,',
			template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table border="2px">{table}</table></body></html>',
			base64 = function (s) {
				return window.btoa(unescape(encodeURIComponent(s)))
			},
			format = function (s, c) {
				return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; })
			}

			let ctx = {
				worksheet: 'Worksheet',
				table: tableData
			}

			let dt = new Date();
			document.getElementById("dlink").href = data_type + base64(format(template, ctx));
			document.getElementById("dlink").traget = "_blank";
			document.getElementById("dlink").download = dt.getTime()+'_display_board.xls';
			document.getElementById("dlink").click();
			// $(".fltrow").show();
			// alert('ok');
		}
    </script>
    <div id="exc"></div>
     </div>


	<div style="text-align: center;" >

			<strong>Buyer: <? echo $buyer_short_library[$buyer_main_sql[0][csf('buyer_name')]]; ?></strong>
			<strong>Job No: <? echo $buyer_main_sql[0][csf('job_no_prefix_num')];  ?></strong>
			<strong>Style No:<? echo $buyer_main_sql[0][csf('style_ref_no')];?></strong>
			<strong>Garments Item:<? echo $garments_item[$buyer_main_sql[0][csf('item_number_id')]];?></strong>
			<strong>Order No:<? echo $buyer_main_sql[0][csf('po_number')];?></strong>

		</div>

     <div style="width:<?=$tbl_width+20;?>px;" align="center" id="details_reports">
	 <?=get_order_info($buyer_main_sql[0][csf('po_break_down_id')]);?>
	 <h4 align="center">GMT FINISHING RECEIVE</h4>
	 <h3>Summary</h3>
	 <table width="<?=$tbl_width;?>" cellspacing="0" border="1" class="rpt_table" rules="all">
		<thead>

		  <tr>
			<th width colspan="3"></th>
			<th width colspan="<?  echo  count($size_number_arr); ?>">Size</th>
			<th></th>
		  </tr>
			<tr>
				<th width="50">SL</th>
				<th width="50"></th>
				<th width="100">Color</th>
				<?
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th width="60"><?
					echo $size_Arr_library[$size_id];
					?></th>
					<?
				}
				?>
				<th width="50">Total</th>
			</tr>
		</thead>
			<tbody>
			 <?
				$i=1;
				foreach($finish_rcv_arr as $color_id=>$color_data)
				{

						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
						<td><? echo $i; ?></td>
						<td></td>
						<td><? echo $color_Arr_library[$color_id]; ?></td>
						<?
						$total_recive_qty=0;
                        foreach($size_number_arr as $size_id=>$size_data)
						{
					     	?>
						 	<td align="right"><? echo $color_data[$size_id]['fin_receive_qnty']; $total_recive_qty+=$color_data[$size_id]['fin_receive_qnty']; ?></td>
						 	<?
					   	}
					  	?>
						<td align="right"><? echo number_format($total_recive_qty,0);?></td>
						</tr>
                    <?
					$i++;
				}
			 	?>
			</tbody>
				<tfoot>
				<th colspan="3">Total</th>
				<?
				$grand_sub_finish_rcv_total=0;
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th align="right"><? echo  $sub_finish_rcv_arr[$size_id]; $grand_sub_finish_rcv_total+=$sub_finish_rcv_arr[$size_id]; ?></th>
					<?
				}
			  	?>
				<th align="right"><? echo number_format($grand_sub_finish_rcv_total,0)?></th>
				</tfoot>
	    </table>

      <h4 align="center">Deatils</h4>
	    <table  width="<?=$table_width_date;?>" cellspacing="0" border="1" class="rpt_table" rules="all">
			<thead>
				<tr>
					<th width colspan="8"></th>
					<th width colspan="<?  echo  count($size_arr); ?>">Size</th>
					<th></th>
				</tr>
				<tr>
					<th width="20">SL</th>
					<th width="100">Date</th>
					<th width="100">Rcv Id</th>
					<th width="100">Finishing Company</th>
					<th width="100">Finishing Floor</th>
					<th width="100">Sewing Company</th>
					<th width="100">Sewing Floor</th>
					<th width="100">Color</th>
					<?
						foreach($size_arr as $size_id=>$size_data)
						{
							?>
							<th width="60"><?
							echo $size_Arr_library[$size_id];
							?></th>
							<?
						}
					?>
					<th width="100">Total</th>
				</tr>
	  		</thead>
          <tbody>
            <?
			 $i=1;
             foreach($main_arr as $production_date=>$prod_date)
			 {
				foreach($prod_date as $color_id=>$color_data)
				{
					if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

				   ?>
				   	<tr bgcolor="<? echo $bgcolor; ?>">
					   <td><? echo $i; ?></td>
					   <td><? echo $production_date; ?></td>
					   <td align="right"><? echo $color_data['sys_number_prefix_num']; ?></td>
					   <td><? echo $company_library[$color_data['fini_company_id']]; ?></td>
					   <td><? echo $floorArr[$color_data['fini_floor']] ?></td>
					   <td><? echo $company_library[$color_data['company_id']]; ?></td>
					   <td><? echo $floorArr[$color_data['sewing_floor']]; ?></td>
					   <td><? echo $color_Arr_library[$color_id];  ?></td>
					   <?
						$total_fin_recive_qty=0;
                        foreach($size_arr as $size_id=>$size_data)
						{
					     	?>
						 	<td align="right"><? echo $color_data[$size_id]['fin_receive_qnty']; $total_fin_recive_qty+=$color_data[$size_id]['fin_receive_qnty']; ?></td>
						 	<?
					   	}
				    	?>
						 <td align="right"><? echo number_format($total_fin_recive_qty,0) ;  ?></td>

                   <?
			 	}
			  }

            	?>
		  	</tbody>
		  <tfoot>
			<th colspan="8">Total</th>
				<?
				$grand_sub_total=0;
				foreach($size_arr as $size_id=>$size_data)
				{
					?>
					<th align="right"><? echo  $size_subtotal_arr[$size_id]; $grand_sub_total+=$sub_finish_rcv_arr[$size_id]; ?></th>
					<?
				}
				?>
				<th align="right"><? echo number_format($grand_sub_total,0)?></th>
		  </tfoot>
	    </table>
	  </div>

		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><a href="##" onclick="fnExportToExcel()" target=_blank; style="text-decoration:none" id="dlink"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?

}
if($action=="pending_popup")
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);

	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	$color_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" );

    $sql= "SELECT e.color_number_id,e.size_number_id ,a.serving_company,a.production_date,b.production_qnty,a.company_id,a.cut_no,d.po_number,c.style_ref_no,c.job_no,b.reject_qty,b.replace_qty
	from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_break_down d,wo_po_color_size_breakdown e
	where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id and c.id=d.job_id and d.id=e.po_break_down_id  and a.production_type=1 and b.production_type=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and e.status_active=1 and e.is_deleted=0";

	$main_sql=sql_select($sql);
    $main_arr=array();
	$size_number_arr=array();
	$prod_arr=array();
	$replace_arr=array();
	$reject_arr=array();
	$size_wise_qty_arr=array();

	foreach($main_sql as $row)
	{

		$prod_arr[$row[csf('cut_no')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['qty']+=$row[csf('production_qnty')];
		$reject_arr[$row[csf('cut_no')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['reject_qty']+=$row[csf('reject_qty')];
		$replace_arr[$row[csf('cut_no')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['replace_qty']+=$row[csf('replace_qty')];
		$size_wise_qty_arr[$row[csf('size_number_id')]]+=$row[csf('production_qnty')];
	}
	// echo '<pre>';
	// print_r($prod_arr);
	// echo '</pre>';

	$tbl_width = 920+(count($size_number_arr)*60);

	$sql_colsiz="SELECT b.color_id  as color_number_id,c.size_id as size_number_id ,c.size_qty  as production_qnty,a.working_company_id as serving_company,a.entry_date as production_date,a.cutting_no,a.company_id,a.job_no,d.style_ref_no,e.po_number  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c,wo_po_details_master d,wo_po_break_down e where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and d.id=e.job_id and e.id=c.order_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and   c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and  e.status_active=1 and e.is_deleted=0 and b.gmt_item_id=$item_id and (c.order_id=$po_break_down_id or b.order_id=$po_break_down_id) ";

	$total_sql_colsiz=sql_select($sql_colsiz);
    $colsiz_arr=array();
	$cutting_main_arr=array();
	foreach($total_sql_colsiz as $row)
	{
		$size_number_arr[$row[csf('size_number_id')]]=$row[csf('size_number_id')];
		$colsiz_arr[$row[csf('cutting_no')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['qty']+=$row[csf('production_qnty')];
		$cutting_main_arr[$row[csf('cutting_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['company_id']=$row[csf('company_id')];
		$cutting_main_arr[$row[csf('cutting_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['serving_company']=$row[csf('serving_company')];
		$cutting_main_arr[$row[csf('cutting_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['job_no']=$row[csf('job_no')];
		$cutting_main_arr[$row[csf('cutting_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['style_ref_no']=$row[csf('style_ref_no')];
		$cutting_main_arr[$row[csf('cutting_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['po_number']=$row[csf('po_number')];

	}

	// echo '<pre>';
	// print_r($colsiz_arr);
	// echo '</pre>';
?>

      <h1>QC pending Details</h1>
       <div style="width:<?=$tbl_width+20;?>px;" align="center">
		<table width="<?=$tbl_width;?>" class="rpt_table" rules="all" border="1">
		    <thead>
				<tr>
					<th width="20" rowspan="2">SL</th>
					<th width="100" rowspan="2">Company</th>
					<th width="100" rowspan="2">Working Company</th>
					<th width="100" rowspan="2">Cutting No</th>
					<th width="100" rowspan="2">Plan Cut Date</th>
					<th width="100" rowspan="2">Job</th>
					<th width="100" rowspan="2">Style</th>
					<th width="100" rowspan="2">Po</th>
					<th width="100" rowspan="2">Color Name</th>
					<?
					foreach($size_number_arr as $size_id=>$size_data)
					{
						?>
						<th width="60"><?
						echo $size_Arr_library[$size_id];
						?></th>
					<?
					}
                    ?>
					<th width="100" rowspan="2">Total</th>
				</tr>
			</thead>
			<tbody>
				<?

                $i=1;
				foreach($cutting_main_arr as $cut_no=>$cut_val)
				{
					foreach($cut_val as $prod_date=>$prod_val)
					{
						foreach($prod_val as $color_id=>$row)
						{
							if ($i%2==0)
							$bgcolor="#E9F3FF";
							else
							$bgcolor="#FFFFFF";
						    $size_total_pending_qty=0;

						  ?>
						   <tr bgcolor="<? echo $bgcolor; ?>">
                           <td align="right"><? echo $i; ?></td>
                           <td ><? echo $company_library[$row['company_id']]; ?></td>
                           <td><? echo $company_library[$row['serving_company']];; ?></td>
                           <td ><? echo $cut_no; ?></td>
                           <td ><? echo $prod_date; ?></td>
                           <td ><? echo $row['job_no']; ?></td>
                           <td ><? echo $row['style_ref_no']; ?></td>
                           <td><? echo $row['po_number']; ?></td>
                           <td align="right"><? echo $color_library[$color_id]; ?></td>
						   <?
							foreach($size_number_arr as $size_id=>$size_data)
							{
								?>
								<td width="60" align="right"><?
								$pending_qty=$colsiz_arr[$cut_no][$color_id][$size_id]['qty']-($prod_arr[$cut_no][$color_id][$size_id]['qty']+$reject_arr[$cut_no][$color_id][$size_id]['reject_qty']-$replace_arr[$cut_no][$color_id][$size_id]['replace_qty']); echo $pending_qty; $size_total_pending_qty+=$pending_qty; $size_wise_pending_qty[$size_id]+=$pending_qty;
								?></td>
							<?
							}
                    		?>
						   <td align="right"><? echo number_format($size_total_pending_qty); $gr_size_total_qty+=$size_total_pending_qty; ?></td>
						  <?

						  $i++;
						}
					}
				}

                ?>
			</tbody>
			<tfoot>
              <th colspan="9">Total</th>
			  <?
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th width="60" align="right"><?
					echo $size_wise_pending_qty[$size_id];
					?></th>
				<?
				}
				?>
			 <th align="right"><? echo $gr_size_total_qty;?></th>

			</tfoot>


<?
}

if($action=="reject_popup")
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);

	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	$color_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" );

    $sql= "SELECT e.color_number_id,e.size_number_id ,a.serving_company,a.production_date,b.reject_qty,a.company_id,a.cut_no,d.po_number,c.style_ref_no,c.job_no
	from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_break_down d,wo_po_color_size_breakdown e
	where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id and c.id=d.job_id and d.id=e.po_break_down_id  and a.production_type=1 and b.production_type=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and e.status_active=1 and e.is_deleted=0";

	$main_sql=sql_select($sql);
    $main_arr=array();
	$size_number_arr=array();
	$reject_arr=array();
	$replace_arr=array();
	$size_wise_qty_arr=array();

	foreach($main_sql as $row)
	{
		$size_number_arr[$row[csf('size_number_id')]]=$row[csf('size_number_id')];
		$reject_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['qty']+=$row[csf('reject_qty')];
		$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['company_id']=$row[csf('company_id')];
		$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['serving_company']=$row[csf('serving_company')];
		$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['style_ref_no']=$row[csf('style_ref_no')];
		$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['job_no']=$row[csf('job_no')];
		$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['po_number']=$row[csf('po_number')];
		$size_wise_qty_arr[$row[csf('size_number_id')]]+=$row[csf('reject_qty')];
	}
	// echo '<pre>';
	// print_r($main_arr);
	// echo '</pre>';

	$tbl_width = 920+(count($size_number_arr)*60);

?>

      <h1>Reject Details</h1>
       <div style="width:<?=$tbl_width+20;?>px;" align="center">
		<table width="<?=$tbl_width;?>" class="rpt_table" rules="all" border="1">
		    <thead>
				<tr>
					<th width="20" rowspan="2">SL</th>
					<th width="100" rowspan="2">Company</th>
					<th width="100" rowspan="2">Working Company</th>
					<th width="100" rowspan="2">Cutting No</th>
					<th width="100" rowspan="2">Plan Cut Date</th>
					<th width="100" rowspan="2">Job</th>
					<th width="100" rowspan="2">Style</th>
					<th width="100" rowspan="2">Po</th>
					<th width="100" rowspan="2">Color Name</th>
					<?
					foreach($size_number_arr as $size_id=>$size_data)
					{
						?>
						<th width="60"><?
						echo $size_Arr_library[$size_id];
						?></th>
					<?
					}
                    ?>
					<th width="100" rowspan="2">Total</th>
				</tr>
			</thead>
			<tbody>
				<?

                $i=1;
				foreach($main_arr as $cut_no=>$cut_val)
				{
					foreach($cut_val as $prod_date=>$prod_val)
					{
						foreach($prod_val as $color_id=>$row)
						{
							if ($i%2==0)
							$bgcolor="#E9F3FF";
							else
							$bgcolor="#FFFFFF";
						    $size_total_qty=0;
						  ?>
						   <tr bgcolor="<? echo $bgcolor; ?>">
                           <td align="right"><? echo $i; ?></td>
                           <td align="right"><? echo $company_library[$row['company_id']]; ?></td>
                           <td align="right"><? echo $company_library[$row['serving_company']];; ?></td>
                           <td align="right"><? echo $cut_no; ?></td>
                           <td align="right"><? echo $prod_date; ?></td>
                           <td align="right"><? echo $row['job_no']; ?></td>
                           <td align="right"><? echo $row['style_ref_no']; ?></td>
                           <td align="right"><? echo $row['po_number']; ?></td>
                           <td align="right"><? echo $color_library[$color_id]; ?></td>
						   <?
							foreach($size_number_arr as $size_id=>$size_data)
							{
								?>
								<td width="60" align="right"><?
								echo $reject_arr[$cut_no][$prod_date][$color_id][$size_id]['qty'];$size_total_qty+=$reject_arr[$cut_no][$prod_date][$color_id][$size_id]['qty'];
								?></td>
							<?
							}
                    		?>
						   <td align="right"><? echo number_format($size_total_qty); $gr_size_total_qty+=$size_total_qty;?></td>
						  <?

						  $i++;
						}
					}
				}

                ?>
			</tbody>
			<tfoot>
              <th colspan="9">Total</th>
			  <?
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th width="60" align="right"><?
					echo $size_wise_qty_arr[$size_id];
					?></th>
				<?
				}
				?>
			 <th align="right"><? echo $gr_size_total_qty;?></th>

			</tfoot>


<?
}

if ($action=="product_popup")  // All Production Data popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);
	$prod_popup_lelel_arr=explode('*',$prod_popup_lelel);
	$prod_popup_lelel_type=$prod_popup_lelel_arr[0];
	$prod_popup_lelel_cat=$prod_popup_lelel_arr[1];


	if($db_type==0) $rmg_process_breakdown=return_field_value("a.rmg_process_breakdown as rmg_process_breakdown"," wo_booking_mst a, wo_booking_dtls b","a.booking_no=b.booking_no and  b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc limit 1","rmg_process_breakdown");
	else if($db_type==2) $rmg_process_breakdown=return_field_value("rmg_process_breakdown"," (select a.id, a.rmg_process_breakdown  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc)","ROWNUM = 1","rmg_process_breakdown");

	if($rmg_process_breakdown!="")
	{
		$rmg_process_breakdown_arr=explode("_",$rmg_process_breakdown);
		//var_dump($rmg_process_breakdown_arr);die;
		$cut_panel_rejection=$rmg_process_breakdown_arr[8];
		$chest_printing=$rmg_process_breakdown_arr[2];
		$neck_sleeve_printing=$rmg_process_breakdown_arr[10];
		$embroidery=$rmg_process_breakdown_arr[1];
		$sewing_input=$rmg_process_breakdown_arr[4];
		$garments_wash=$rmg_process_breakdown_arr[3];
		$gmts_finishing=$rmg_process_breakdown_arr[15];
	}

	//echo $rmg_process_breakdown;die;
	//select rmg_process_breakdown from (select a.id, a.rmg_process_breakdown  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.po_break_down_id=4444 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc)   where  ROWNUM = 1
	//echo "select rmg_process_breakdown as rmg_process_breakdown from  wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and  b.po_break_down_id=$po_break_down_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $row_num";die;



	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	$sizearr_order=return_library_array("select size_number_id,size_number_id from wo_po_color_size_breakdown where po_break_down_id=$po_break_down_id order by size_order","size_number_id","size_number_id");
	$line_Arr_library=return_library_array( "select id,line_name from lib_sewing_line where  is_deleted=0 and status_active=1", "id", "line_name" );
	$resource_alocate_line = return_library_array("select id, line_number from prod_resource_mst", "id", "line_number");


	$country_cond="";
	if($country_id>0) $country_cond=" and c.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and c.color_number_id=$color_id";

	$sql_order_size= sql_select("SELECT c.size_number_id, c.order_quantity as order_quantity, c.plan_cut_qnty as plan_cut_qnty
		from wo_po_color_size_breakdown c
		where c.status_active=1 and c.is_deleted=0 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id $country_cond $color_cond
		 order by c.size_order");
	foreach($sql_order_size as $row)
	{
		$order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('order_quantity')];
		$plan_order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('plan_cut_qnty')];
	}
	$country_cond="";
	if($country_id>0) $country_cond=" and a.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and a.color_number_id=$color_id";

	$color_size_sql=sql_select( "select a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.")  $country_cond $color_cond order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
	}
	$sql_supplier=sql_select("select id,supplier_name from lib_supplier where status_active =1 and is_deleted=0 order by supplier_name");
	$supplier_arr=array();
	foreach($sql_supplier as $row)
	{
		$supplier_arr[$row[csf('id')]]=$row[csf('supplier_name')];
	}

	//echo "<pre>";
	//print_r($color_size_data); die;

		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$prod_print_cond=''; $prod_sourceCond='';

		if($prod_popup_lelel_cat=="") $prod_print_cond=''; else $prod_print_cond="and a.embel_name='$prod_popup_lelel_cat'";
		if($prod_popup_lelel_type!=0)
		{
			if($prod_popup_lelel_type=="") $prod_sourceCond=''; else $prod_sourceCond="and a.production_source='$prod_popup_lelel_type'";
		}
 		if($prod_popup_type==10)
		{
			$serving_company_id = array();
			$sql = "SELECT serving_company   FROM pro_garments_production_mst  WHERE po_break_down_id = $po_break_down_id  group by serving_company";
			$sql_res = sql_select($sql);
			// echo $sql_res[0][csf('serving_company')];
			$sql_ex_factory_date="SELECT ex_factory_date FROM pro_ex_factory_mst WHERE po_break_down_id = $po_break_down_id group by ex_factory_date ";
			$sql_exdate=sql_select($sql_ex_factory_date);
		    // echo $sql_exdate[0][csf('ex_factory_date')];
			$sql_colsiz="SELECT b.color_size_break_down_id,
			sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
			from pro_ex_factory_mst a,  pro_ex_factory_dtls b, wo_po_break_down c ,wo_po_color_size_breakdown d
			where a.id=b.mst_id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and c.id=d.po_break_down_id and d.id=b.color_size_break_down_id and a.po_break_down_id = c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active in(1,2,3) and d.status_active in(1,2,3) and d.is_deleted=0  group by b.color_size_break_down_id";

			$ex_fac_level=sql_select("SELECT ex_factory  from variable_settings_production where company_name in(select a.company_name from  wo_po_details_master a,wo_po_break_down b where a.id=b.job_id and b.id=$po_break_down_id and b.status_active in(1,2,3)) and variable_list=1 ");
			if($ex_fac_level[0][csf("ex_factory")]==1)
			{
				$sql_colsiz="SELECT
				sum(CASE WHEN a.entry_form!=85 THEN  a.ex_factory_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN  a.ex_factory_qnty ELSE 0 END) as production_qnty
				from pro_ex_factory_mst a
				where a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0";
			}
		}
		else if($prod_popup_type==11)
		{
			 $sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as production_qnty,a.serving_company,a.sewing_line
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_color_size_breakdown e
			where a.id=b.mst_id    and e.id=b.color_size_break_down_id    and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type'  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and e.status_active=1 and e.is_deleted=0 group by e.color_number_id,e.size_number_id , b.color_size_break_down_id,a.serving_company,a.sewing_line order by a.serving_company";
		}


		else if($prod_popup_type==17)
		{
			if($color_id>0) $color_cond=" and b.color_id=$color_id";
  			$sql_colsiz="SELECT b.color_id  as color_number_id,c.size_id as size_number_id ,sum(c.size_qty ) as production_qnty,a.working_company_id as serving_company,a.entry_date as production_date  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and b.gmt_item_id=$item_id and (c.order_id=$po_break_down_id or b.order_id=$po_break_down_id) $color_cond  group by b.color_id,c.size_id,a.working_company_id,a.entry_date order by a.working_company_id";


			foreach(sql_select($sql_colsiz) as $vals)
			{
				$col_size_wise_lay[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];
				if($vals[csf("serving_company")])
				{
					$col_size_wise_lay_company[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]] =$vals[csf("serving_company")];

					$allcolor_id_arr_dtls[$vals[csf("serving_company")]][$vals[csf("production_date")]][$vals[csf("color_number_id")]]=$vals[csf("color_number_id")];
					$col_size_wise_lay_company_qnty[$vals[csf("serving_company")]][$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];

				}


			}
			// print_r($allcolor_id_arr_dtls);
			// echo $prod_popup_type;

		}

  		else if($prod_popup_type==7)
		{
			$sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as
			 production_qnty,a.serving_company,a.production_date
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type' and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by e.color_number_id,e.size_number_id ,b.color_size_break_down_id,a.serving_company,a.production_date order by a.serving_company";
		}
		else if($prod_popup_type==1)
		{
		  	$sql_colsiz="SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty,a.serving_company,a.sewing_line,a.production_date,f.cutting_qc_no,a.cut_no
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e,pro_gmts_cutting_qc_mst  f
			where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id and f.id=a.delivery_mst_id and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type' and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by b.color_size_break_down_id,a.serving_company,a.sewing_line,a.production_date,f.cutting_qc_no,a.cut_no order by a.serving_company";
		}
		// echo $sql_colsiz;
		$sql_color_size=sql_select($sql_colsiz);
		$prod_color_size_data=array();
		$prod_color_size_data_working_comp=array();
		$color_size_working_comp=array();
		$color_size_sewingLine=array();
		$cutting_no_arr=array();

		foreach($sql_color_size as $row)
		{
			if($prod_popup_type==11)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]=$row[csf("size_number_id")];
				//$color_size_data[$row[csf("color_size_break_down_id")]]["serving_company"]=$row[csf("serving_company")];
				//$col_size_wise_company_arr[$row[csf("serving_company")]] =$row[csf("serving_company")];
			}
			if($prod_popup_type==7)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]=$row[csf("size_number_id")];
			}
			$allcolor_id_arr_dtls[$row[csf("serving_company")]][$row[csf("production_date")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]]["color"]=$row[csf("color_number_id")];
			$cutting_no_arr[$row[csf("serving_company")]]["cutting_qc_no"]=$row[csf("cutting_qc_no")];
			$cutting_no_arr[$row[csf("serving_company")]]["cut_no"]=$row[csf("cut_no")];

			if($color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=="")
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=$row[csf("sewing_line")];
			}
			else
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"].=','.$row[csf("sewing_line")];
			}

			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
			$prod_color_size_data_working_comp[$row[csf("serving_company")]][$row[csf("production_date")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
		}
		//print_r($color_size_sewingLine);
		//echo $prod_popup_type;
		if($prod_popup_type==8)
        {

			$transfer_info_sql="SELECT e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id as po_id,c.color_number_id as colors ,sum( case when a.trans_type=5 and  b.trans_type=5  then b.production_qnty else 0 end) as transfer_in ,sum( case when a.trans_type=6 and  b.trans_type=6  then b.production_qnty else 0 end) as transfer_out,a.serving_company,a.sewing_line from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c,pro_gmts_delivery_mst d,wo_po_details_master e,wo_po_break_down f where a.id=b.mst_id and b.color_size_break_down_id=c.id and d.id=a.delivery_mst_id and e.id=f.job_id and e.id=c.job_id and f.id=a.po_break_down_id and   a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   and a.production_type=10 and b.production_type=10 and a.trans_type in(5,6)  and b.trans_type in(5,6) and a.po_break_down_id=$po_break_down_id and d.status_active=1
			group by e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id ,c.color_number_id,a.serving_company,a.sewing_line order by a.serving_company";
			// echo $transfer_info_sql;
			$transfer_info=sql_select($transfer_info_sql);
			foreach($transfer_info as $trans_val)
			{
				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_in']+=$trans_val[csf("transfer_in")];
				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_out']+=$trans_val[csf("transfer_out")];

				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['style']=$trans_val[csf("style_ref_no")];

				$transfer_info_arr[$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['buyer']+=$trans_val[csf("buyer_name")];
			}
		}
	    // echo "<pre>";	print_r($transfer_info_arr);
		$table_width=(200+(count($sizearr_order)*60));
		$table_width_date=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>

		<? ob_start(); ?>
        <div style="width:<? echo $table_width+200; ?>px" align="left" id="details_reports">
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
        	<?
        	$country_library=return_library_array( "select id,country_name from lib_country", "id", "country_name"  );
        	if($prod_popup_type==10 && $ex_fac_level[0][csf("ex_factory")]==1)
        	{
        		?>
        		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="230" align="left">
        			<thead>
        				<tr>
        					<th width="30">Sl</th>
        					<th width="100">Country Name</th>
        					<th width="100">Ex-factory Qty</th>
        				</tr>
        			</thead>
        			<tbody>
        				<?
        				$ex=1;
        				$tot = 0;
        				foreach ($sql_color_size as $val)
        				{
	        				?>
	        				<tr>
	        					<td><? echo $ex; ?></td>
	        					<td><? echo $country_library[$val['COUNTRY_ID']]; ?></td>
	        					<td align="right"><? echo $val['PRODUCTION_QNTY']; ?></td>
	        				</tr>
	        				<?
	        				$ex++;
	        				$tot += $val['PRODUCTION_QNTY'];
        				}
        				?>
        			</tbody>
        			<tfoot>
        				<tr>
        					<th></th>
        					<th>Total</th>
        					<th><? echo $tot; ?></th>
        				</tr>
        			</tfoot>

        		</table>
        		<?
        		exit();
        	}
        	?>
			<div><?=get_order_info($po_break_down_id);?></div>
			<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
				<thead>
					<tr>
						<?  if ($prod_popup_type==1) echo "<h1>Cutting Qc</h1>"?>
						<?  if ($prod_popup_type==4) echo "<h1>Sewing Input</h1>"?>
						<?  if ($prod_popup_type==5) echo "<h1>Sewing Output</h1>"?>
						<?  if ($prod_popup_type==7) echo "<h1>Iron Details</h1>"?>
						<?  if ($prod_popup_type==8) echo "<h1>Finish Details</h1>"?>
						<?  if ($prod_popup_type!=100 && $prod_popup_type!=1 && $prod_popup_type!=2 && $prod_popup_type!=3 && $prod_popup_type!=4 && $prod_popup_type!=5 && $prod_popup_type!=7 && $prod_popup_type!=8 && $prod_popup_type!=11 && $prod_popup_type!=17) echo "<h1>Ex-factory Details</h1>"?>
						<th width colspan="2"></th>
						<th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
						<?
						$colspan = 0;
						if($prod_popup_type==8)
						{
							if($prod_popup_lelel !=1)
							{
								$colspan=2;
							}
							else
							{
								$colspan = 3;
							}
						}
						?>
						<th colspan="<? echo $colspan; ?>"></th>
					</tr>
					<tr>

						<th width="30" >SL</th>
						<th width="100" >Color Name</th>
						<?
						foreach($sizearr_order as $size_id)
						{
							?>
							<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
							<?
						}
						if($prod_popup_type==8)
						{
							if($prod_popup_lelel ==3)
							{
								?>
								<th width="100" >Transfer In</th>
								<?
							}
							else if($prod_popup_lelel ==2)
							{
								?>
								<th width="100" >Transfer Out</th>
								<?
							}
							else
							{
								?>
								<th width="100" >Transfer In</th>
								<th width="100" >Transfer Out</th>
								<?
							}
						}
						?>

						<th width="100" >Total</th>
					</tr>
				</thead>
				<tbody>
					<? $sl=1; $sub_total_prod_poly_qntyy=array(); $sub_totals=0;
					foreach($allcolor_id_arr as $inc=>$color_id_val)
					{
						if($color_id_val)
						{

						?>
					<tr>
						<td align="center" valign="middle"><? echo $sl; ?></td>
						<td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
						<?
						$total_prod_poly_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							if($prod_popup_type==17)
							{
								$sub_total_prod_poly_qntyy[$size_id]+=$col_size_wise_lay[$color_id_val][$size_id];
								?>
						<td align="right"><? echo number_format($col_size_wise_lay[$color_id_val][$size_id],0); $total_prod_poly_qnty+=$col_size_wise_lay[$color_id_val][$size_id] ; ?></td>

						<?	}
							else
							{
								$sub_total_prod_poly_qntyy[$size_id]+=$prod_color_size_data[$color_id_val][$size_id]["qty"];
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["qty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["qty"]; ?></td>
								<?
							}
						}
						if($prod_popup_type==8)
						{
							if($prod_popup_lelel ==3)
							{
								?>
								<td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$inc]['transfer_in']; echo number_format($trans_in,0); ?></td>
								<?
							}
							else if($prod_popup_lelel ==2)
							{
								?>
								<td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$inc]['transfer_out']; echo number_format($trans_out,0); ?></td>
								<?
							}
							else
							{
								?>
								<td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$inc]['transfer_in']; echo number_format($trans_in,0); ?></td>
								<td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$inc]['transfer_out']; echo number_format($trans_out,0); ?></td>
								<?
							}
						}
						?>
						<td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,0); ?></td>
					</tr>
					<? $sub_totals+=$totals; $sl++;
						}
					}
					?>
				</tbody>
				<tfoot>
					<td align="right" colspan="2"><b>Total</b></td>
					<?
					foreach($sizearr_order as $size_id)
					{
					?>
						<td align="right"><? echo $sub_total_prod_poly_qntyy[$size_id]; ?></td>
					<?
					}
					if($prod_popup_type==8)
					{
						if($prod_popup_lelel ==3)
							{
								?>
									<td colspan="1"></td>
								<?
							}
							else if($prod_popup_lelel ==2)
							{
								?>
									<td colspan="1"></td>
								<?
							}
							else
							{
								?>
									<td colspan="2"></td>
								<?
							}
					}
					?>
					<td align="right"> <? echo $sub_totals; ?></td>
				</tfoot>
			</table>
			</div>
			<? if($prod_popup_type==8 && $prod_popup_lelel !=1){ die();}?>
			<!-- ================================ DETAILS PART =================================== -->
			<div style="width:<? echo $table_width+200; ?>px" align="center" id="details_reports">
				<?
					$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
					$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
					$prod_reso_allocation=array();
					$nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
					foreach($nameArray as $nameArrayRow)
					{
						$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
					}
				// $prod_reso_allocation = $nameArray[0][csf('auto_update')];
				?>
				<strong>Details</strong>
				<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width_date+200; ?>">
					<thead>
						<tr>
							<th width colspan="<? if($prod_popup_type==1) { echo "6";}   elseif($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){ echo "5"; }else{echo "4";} ?>"></th>
							<th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
							<th colspan="<? if($prod_popup_type==8){echo "3";} ?>"></th>
						</tr>
						<tr>
							<th width="30" >SL</th>
							<?
							if($prod_popup_type==1)
							{
							 ?>
                              <th width="100">Cutting No</th>
                              <th width="100">QC ID</th>
							 <?
							}
							?>
							<?
							if($prod_popup_type==1)
							{
							 ?>
                              <th width="100">Cutting QC Date</th>
							 <?
							}
							else
							{
							?>
							 <th width="100" >Date</th>
							<?
							}
							?>

							<th width="200" >Working Company</th>
							<?
							if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
							{
								?>
								<th width="100" >Line</th>
								<?
							}
							?>
							<th width="100" >Color Name</th> <!--$prod_popup_type-->
							<?
							foreach($sizearr_order as $size_id)
							{
								?>
								<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
								<?
							}
							if($prod_popup_type==8)
							{
								?>
								<th width="100" >Transfer In</th>
								<th width="100" >Transfer Out</th>

								<?
							}
							?>

							<th width="100" >Total</th>
						</tr>
					</thead>
					<tbody>
						<? $sl=1; $sub_total_prod_poly_qnty=array(); $sub_totals=0;
						$po_company=sql_select(" SELECT a.company_name from wo_po_details_master a,wo_po_break_down b where a.id=b.job_id and a.status_active=1 and b.status_active in(1,2,3) and b.id in($po_break_down_id)");
						/*echo "<pre>";
						print_r($allcolor_id_arr_dtls);die;*/
						//foreach($col_size_wise_company_arr as $dataRow){
						foreach($allcolor_id_arr_dtls as $company=>$company_data) {
							foreach($company_data as $production_date=>$prod_date){
						foreach($prod_date as $colors=>$val) {
							if($colors){
						?>
						<tr>
							<td align="center" valign="middle"><? echo $sl; ?></td>
							<?
							if($prod_popup_type==1)
							{
							 ?>
                              <td><p><?=$cutting_no_arr[$company]['cut_no'];?></p></td>
                              <td><p><?=$cutting_no_arr[$company]['cutting_qc_no'];?></p></td>

							 <?
							}
							?>

							<td align="center" valign="middle"><? echo $production_date; if($prod_popup_type==10){ echo $sql_exdate[0][csf('ex_factory_date')]; } ?></td>
							<td align="center" valign="middle"><? if($prod_popup_lelel_type!=3) echo $company_library[$company];  else echo $supplier_arr[$company ];
							if($prod_popup_type==10){ echo $company_library[$sql_res[0][csf('serving_company')]]; }

							?></td>
							<?
							if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
							{
								?>
								<td align="center" valign="middle"><?
								if($prod_reso_allocation[$po_company[0][csf("company_name")]]["auto_update"]==1)
								{
									$serving_company_lines=explode(",",$color_size_sewingLine[$company]["sewing_line"]);
									$sewing_line_name = "";
									$line_duplicate_arr=array();
									foreach($serving_company_lines as $lines_id)
									{
										$sewing_line =  $resource_alocate_line[$lines_id];
										$sewing_line_arr = explode(",", $sewing_line);

										foreach ($sewing_line_arr as $line_id)
										{
										//$lines= $prod_reso_arr[$line_id] ;
										//foreach(explode(",", $lines) as $key=>$value)
										//{
											if($line_duplicate_arr[$line_id]=="")
											{
												$sewing_line_name.=$lineArr[$line_id]." ,";
												$line_duplicate_arr[$line_id]=$line_id;
											}

										//}
										}

									}

									$sewing_line_name = chop($sewing_line_name, ",");
									echo $sewing_line_name;

								}
								else
								{
									$sewing_line =  $color_size_sewingLine[$company]["sewing_line"];
									foreach(explode(",", $sewing_line) as $key=>$value)
									{
										$sewing_line_name.=$lineArr[$value]." ,";
									}
										$sewing_line_name = chop($sewing_line_name, ",");
										echo $sewing_line_name;
								}
								?></td>
								<?
							}
							?>
							<td align="center" valign="middle"><? echo $color_Arr_library[$colors]; ?></td>
							<?
							$total_prod_poly_qnty=0;
							foreach($sizearr_order as $size_id)
							{

								if($prod_popup_type==17)
								{
								$sub_total_prod_poly_qnty[$size_id]+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
								?>
							<td align="right"><?
							echo number_format($col_size_wise_lay_company_qnty[$company][$colors][$size_id],0);$total_prod_poly_qnty+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
							?></td>

							<?	}
								else{
									$sub_total_prod_poly_qnty[$size_id]+=$prod_color_size_data_working_comp[$company][$production_date][$colors][$size_id]["qty"];
								?>
								<td align="right"><? echo number_format($prod_color_size_data_working_comp[$company][$production_date][$colors][$size_id]["qty"],0); $total_prod_poly_qnty+=$prod_color_size_data_working_comp[$company][$production_date][$colors][$size_id]["qty"]; ?></td>
								<?  }
							}
							if($prod_popup_type==8)
							{
							?>
							<td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$colors]['transfer_in']; echo number_format($trans_in,0); ?></td>
							<td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$colors]['transfer_out']; echo number_format($trans_out,0); ?></td>
							<?
							}
							?>
							<td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,0); ?></td>
						</tr>
						<?
						$sub_totals+=$totals; $sl++;
					}
					}
						}
						} ?>
					</tbody>
					<tfoot>
						<td align="right" colspan=" <?  if($prod_popup_type==1) { echo "6";} elseif($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){echo "5";}else{echo "4";} ?>"><b>Total</b></td>
						<?
						foreach($sizearr_order as $size_id)
						{
						?>
							<td align="right"><? echo $sub_total_prod_poly_qnty[$size_id]; ?></td>
						<?
						}
						if($prod_popup_type==8){
						?>
							<td colspan="2"></td>
						<?
						}
						?>
						<td align="right"> <? echo $sub_totals; ?></td>
					</tfoot>
				</table>
			</div>
			<!--  -->
			<div style="width:<? echo $table_width; ?>px" align="center">
				<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
					<thead>
						<tr>
						<th width="100" >Color Name</th>
						<th width="100">Production Type</th>
						<?
						foreach($sizearr_order as $size_id)
						{
							?>
							<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
							<?
						}
						?>
						<th width="100" >Total</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
							<td>Order Qty.</td>
							<?
							$total_ord_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Plan Cut Qty.</td>
							<?
							$total_plan_ord_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sewing Input Plan Qty.</td>
							<?
							$sewing_in_plan_cut=$total_sew_plan_qnty=0;

							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right">
								<?
								$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
								$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
								echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
								?>
								</td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Inhouse Sewing Input Qty.</td>
							<?
							$total_prod_sew_inhouse_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sub Con. Sewing Input Qty.</td>
							<?
							$total_production_subcon_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sewing Input Balance</td>
							<?
							$total_prod_in_balance=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right">
								<?
								$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
								echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
								?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
						</tr>
					</tbody>
				</table>
			</div>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
		//die;

	if($prod_popup_type==1 && $prod_popup_lelel_type==1) //for cutting
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id  $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
	group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>

        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4" align="center" valign="middle" ><? echo $color_Arr_library[$color_id]; ?></td>
                        <td >Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Qty.</td>
                        <?
						$total_color_size_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" ><? echo number_format($prod_color_size_data[$size_id],0); $total_color_size_qnty+=$prod_color_size_data[$size_id];  ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_color_size_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Balance.</td>
                        <?
						$total_cut_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" title="Cutting Qty-Plan Cut Qty."><? $cut_balance=($plan_order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($cut_balance,0); $total_cut_balance+=$cut_balance; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_cut_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
            <br />
    	</div>
    	<?

	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==1) //for emb print inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>

                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==2) //for emb print subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==1) //for emb print inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==2) //for emb print subcontract receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==2) //for emb ebroidery subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==2) //for emb ebroidery subcon receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] =$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==1) //for sewing input
	{
		//echo "exist"; exit();
		/* 	$country_cond="";
			if($country_id>0) $country_cond=" and a.country_id=$country_id";

			$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
			sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
			sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

			foreach($sql_color_size as $row)
			{
				$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
				$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
			}

			$table_width=(300+(count($sizearr_order)*60));

			?>
			<div id="data_panel" style="width:100%">
				<script>
					function new_window()
					{
						var w = window.open("Surprise", "#");
						var d = w.document.open();
						d.write(document.getElementById('details_reports').innerHTML);
						d.close();
					}
				</script>
				<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
			</div>
			<div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
				<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
					<thead>
						<tr>
						<th width="100" >Color Name</th>
						<th width="100">Production Type</th>
						<?
						foreach($sizearr_order as $size_id)
						{
							?>
							<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
							<?
						}
						?>
						<th width="100" >Total</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
							<td>Order Qty.</td>
							<?
							$total_ord_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Plan Cut Qty.</td>
							<?
							$total_plan_ord_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sewing Input Plan Qty.</td>
							<?
							$sewing_in_plan_cut=$total_sew_plan_qnty=0;

							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right">
								<?
								$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
								$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
								echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
								?>
								</td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Inhouse Sewing Input Qty.</td>
							<?
							$total_prod_sew_inhouse_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sub Con. Sewing Input Qty.</td>
							<?
							$total_production_subcon_qnty=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
						</tr>
						<tr>
							<td>Sewing Input Balance</td>
							<?
							$total_prod_in_balance=0;
							foreach($sizearr_order as $size_id)
							{
								?>
								<td align="right">
								<?
								$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
								echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
								?></td>
								<?
							}
							?>
							<td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
						</tr>
					</tbody>
				</table>
			</div>
			<?
		 */
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==11) //for sewing input inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==13) //for sewing input subcon
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==11) //for emb sewing output Inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==13) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==3) //for emb wash issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Plan Qty</td>
                    <?
					$total_emp_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_emp_plan_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_emp_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Qty.</td>
                    <?
					$total_prod_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_sent_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent  Balance</td>
                    <?
					$total_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==3) //for emb wash receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Plan Qty.</td>
                    <?
					$total_plan_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_wash_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Qty.</td>
                    <?
					$total_prod_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_wash_qnty+=$prod_color_size_data[$size_id]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Balance</td>
                    <?
					$taoal_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $taoal_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($taoal_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==8 && $prod_popup_lelel_type==1) //for finish
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=8 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Plan Qty.</td>
                    <?
					$total_plan_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash+$gmts_finishing;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_finish_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Qty.</td>
                    <?
					$total_prod_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_finish_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton  Balance</td>
                    <?
					$toal_finash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $toal_finash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_finash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}

	else if($prod_popup_type==11) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		if($prod_popup_lelel_type=="") $prod_source_cond='';
		else
		{
			$prod_source_cond=$prod_popup_lelel_type;
		}

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
	from pro_garments_production_mst a, pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");


		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qnty"]+=$row[csf('poly_qnty')];
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? foreach($allcolor_id_arr as $inc=>$color_id_val) { ?>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["poly_qnty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["poly_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_poly_qnty,0); ?></td>
                </tr>
                <? } ?>
            </tbody>
		</table>
    	</div>
    	<?
	}
	exit();
}

if ($action=="fin_gmt_transfer_popup")  // order wise button
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);
	$prod_popup_lelel_arr=explode('*',$prod_popup_lelel);
	$prod_popup_lelel_type=$prod_popup_lelel_arr[0];
	$prod_popup_lelel_cat=$prod_popup_lelel_arr[1];



	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$buyer_library=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name");
	$color_library=return_library_array( "select id,color_name from lib_color", "id", "color_name" );
	$country_library=return_library_array( "select id,country_name from lib_country", "id", "country_name" );


	$country_cond="";
	if($country_id>0) $country_cond=" and c.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and c.color_number_id=$color_id";

	$sql_order_size= sql_select("SELECT c.size_number_id, c.order_quantity as order_quantity, c.plan_cut_qnty as plan_cut_qnty
		from wo_po_color_size_breakdown c
		where c.status_active=1 and c.is_deleted=0 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id $country_cond $color_cond
		 order by c.size_order");
	foreach($sql_order_size as $row)
	{
		$order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('order_quantity')];
		$plan_order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('plan_cut_qnty')];
	}
	$country_cond="";
	if($country_id>0) $country_cond=" and a.country_id=$country_id";
	$color_cond="";
	if($color_id>0) $color_cond=" and a.color_number_id=$color_id";
	if($color_id>0) $color_cond2=" and c.color_number_id=$color_id";

	$color_size_sql=sql_select( "select a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.")  $country_cond $color_cond order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
	}
	$sql_supplier=sql_select("select id,supplier_name from lib_supplier where status_active =1 and is_deleted=0 order by supplier_name");
	$supplier_arr=array();
	foreach($sql_supplier as $row)
	{
		$supplier_arr[$row[csf('id')]]=$row[csf('supplier_name')];
	}



	$transfer_info_sql="SELECT e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id as po_id,c.color_number_id as colors ,sum( case when a.trans_type=5 and  b.trans_type=5  then b.production_qnty else 0 end) as transfer_in ,sum( case when a.trans_type=6 and  b.trans_type=6  then b.production_qnty else 0 end) as transfer_out,a.serving_company,a.sewing_line,a.trans_type,g.from_po_id,g.to_po_id from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c,pro_gmts_delivery_mst d,wo_po_details_master e,wo_po_break_down f,pro_gmts_delivery_dtls g where a.id=b.mst_id and b.color_size_break_down_id=c.id and d.id=a.delivery_mst_id and e.id=f.job_id and e.id=c.job_id and f.id=a.po_break_down_id and   a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.production_type=10 and b.production_type=10 and a.trans_type in(5,6)  and b.trans_type in(5,6) and a.po_break_down_id=$po_break_down_id $color_cond2 and d.status_active=1 and g.id=a.dtls_id and d.id=g.mst_id and g.status_active=1
			group by e.job_no,e.buyer_name,e.style_ref_no,f.po_number,c.country_id,d.sys_number,d.delivery_date, c.po_break_down_id ,c.color_number_id,a.serving_company,a.sewing_line,a.trans_type,g.from_po_id,g.to_po_id order by a.serving_company";
	// echo $transfer_info_sql;
	$transfer_info=sql_select($transfer_info_sql);
	$transfer_info_arr = array();
	$from_po_id_arr = array();
	$to_po_id_arr = array();
	foreach($transfer_info as $trans_val)
	{
		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_in']+=$trans_val[csf("transfer_in")];
		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['transfer_out']+=$trans_val[csf("transfer_out")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['style']=$trans_val[csf("style_ref_no")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['buyer']=$trans_val[csf("buyer_name")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['po_number'] =$trans_val[csf("po_number")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['from_po_id'] =$trans_val[csf("from_po_id")];

		$transfer_info_arr[$trans_val[csf("trans_type")]][$trans_val[csf("delivery_date")]][$trans_val[csf("sys_number")]][$trans_val[csf("job_no")]][$trans_val[csf("po_id")]][$trans_val[csf("country_id")]][$trans_val[csf("colors")]]['to_po_id'] =$trans_val[csf("to_po_id")];

		$from_po_id_arr[$trans_val[csf("from_po_id")]] = $trans_val[csf("from_po_id")];
		$to_po_id_arr[$trans_val[csf("to_po_id")]] = $trans_val[csf("to_po_id")];
	}

	$from_po_ids = implode(",", $from_po_id_arr);
	$to_po_ids = implode(",", $to_po_id_arr);

	$from_po = return_library_array( "select id,po_number from wo_po_break_down where id in($from_po_ids)", "id", "po_number");
	$from_job = return_library_array( "select id,job_no_mst from wo_po_break_down where id in($from_po_ids)", "id", "job_no_mst");
	$to_po = return_library_array( "select id,po_number from wo_po_break_down where id in($to_po_ids)", "id", "po_number");
	$to_job = return_library_array( "select id,job_no_mst from wo_po_break_down where id in($to_po_ids)", "id", "job_no_mst");

	    // echo "<pre>";	print_r($transfer_info_arr);
		$table_width=580;

		?>
     <!--    <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>
         -->
		<? ob_start(); ?>
        <div style="width:<? echo $table_width+20; ?>px" align="center" id="details_reports">
	        <?
				$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
				$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
				$prod_reso_allocation=array();
			    $nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
				foreach($nameArray as $nameArrayRow)
				{
					$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
				}
			   // $prod_reso_allocation = $nameArray[0][csf('auto_update')];
			?>
	        <strong>Transfer In</strong>
			<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width+200; ?>">
	            <thead>
	                <tr>
	                	<th rowspan="2" width="10" >SL</th>
	                  	<th rowspan="2" width="50" >Transfer Date</th>
	                    <th rowspan="2" width="70" >Transfer ID</th>
	                    <th colspan="7" width="450" >From Order</th>
	                </tr>
	                <tr>
	                    <th width="70" >Buyer</th>
	                    <th width="70" >Order No</th>
	                    <th width="60" >Job</th>
	                    <th width="70" >Style</th>
	                    <th width="70" >Country</th>
	                    <th width="70" >Color</th>
	                    <th width="40" >Transfer Qty</th>
	                </tr>
	            </thead>
	            <tbody>
	            	<?
	            	$sl=1;
	            	$tot = 0;
	            	foreach ($transfer_info_arr[5] as $dt_key => $dt_val)
	            	{
	            		foreach ($dt_val as $sys_key => $sys_data)
	            		{
	            			foreach ($sys_data as $job_key => $job_data)
	            			{
	            				foreach ($job_data as $po_key => $po_data)
	            				{
	            					foreach ($po_data as $country_key => $country_data)
	            					{
	            						foreach ($country_data as $color_key => $row)
	            						{
	            							?>
	            							<tr>
	            								<td><?= $sl; ?></td>
	            								<td><?= change_date_format($dt_key); ?></td>
	            								<td><?= $sys_key; ?></td>
	            								<td><?= $buyer_library[$row['buyer']]; ?></td>
	            								<td><?= $from_po[$row['from_po_id']]; ?></td>
	            								<td><?= $from_job[$row['from_po_id']]; ?></td>
	            								<td><?= $row['style']; ?></td>
	            								<td><?= $country_library[$country_key]; ?></td>
	            								<td><?= $color_library[$color_key]; ?></td>
	            								<td align="right"><?= $row['transfer_in']; ?></td>
	            							</tr>
	            							<?
	            							$sl++;
	            							$tot += $row['transfer_in'];
	            						}
	            					}
	            				}
	            			}
	            		}
	            	}
	            	?>
	            </tbody>
	            <tfoot>
	            	<th colspan="9">Total</th>
	            	<th><?= number_format($tot,0); ?></th>
	            </tfoot>
			</table>
    	</div>


        <div style="width:<? echo $table_width+20; ?>px;margin-top: 30px;" align="center" id="details_reports">
	        <?
				$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
				$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
				$prod_reso_allocation=array();
			    $nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
				foreach($nameArray as $nameArrayRow)
				{
					$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
				}
			   // $prod_reso_allocation = $nameArray[0][csf('auto_update')];
			?>
	        <strong>Transfer Out</strong>
			<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width+200; ?>">
	            <thead>
	                <tr>
	                	<th rowspan="2" width="10" >SL</th>
	                  	<th rowspan="2" width="50" >Transfer Date</th>
	                    <th rowspan="2" width="70" >Transfer ID</th>
	                    <th colspan="7" width="450" >To Order</th>
	                </tr>
	                <tr>
	                    <th width="70" >Buyer</th>
	                    <th width="70" >Order No</th>
	                    <th width="60" >Job</th>
	                    <th width="70" >Style</th>
	                    <th width="70" >Country</th>
	                    <th width="70" >Color</th>
	                    <th width="40" >Transfer Qty</th>
	                </tr>
	            </thead>
	            <tbody>
	            	<?
	            	$sl=1;
	            	$tot = 0;
	            	foreach ($transfer_info_arr[6] as $dt_key => $dt_val)
	            	{
	            		foreach ($dt_val as $sys_key => $sys_data)
	            		{
	            			foreach ($sys_data as $job_key => $job_data)
	            			{
	            				foreach ($job_data as $po_key => $po_data)
	            				{
	            					foreach ($po_data as $country_key => $country_data)
	            					{
	            						foreach ($country_data as $color_key => $row)
	            						{
	            							?>
	            							<tr>
	            								<td><?= $sl; ?></td>
	            								<td><?= change_date_format($dt_key); ?></td>
	            								<td><?= $sys_key; ?></td>
	            								<td><?= $buyer_library[$row['buyer']]; ?></td>
	            								<td><?= $from_po[$row['to_po_id']]; ?></td>
	            								<td><?= $from_job[$row['to_po_id']]; ?></td>
	            								<td><?= $row['style']; ?></td>
	            								<td><?= $country_library[$country_key]; ?></td>
	            								<td><?= $color_library[$color_key]; ?></td>
	            								<td align="right"><?= $row['transfer_out']; ?></td>
	            							</tr>
	            							<?
	            							$sl++;
	            							$tot += $row['transfer_out'];
	            						}
	            					}
	            				}
	            			}
	            		}
	            	}
	            	?>
	            </tbody>
	            <tfoot>
	            	<th colspan="9">Total</th>
	            	<th><?= number_format($tot,0); ?></th>
	            </tfoot>
			</table>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
	exit();
}

if ($action=="transfer_popup")  // All Production Data popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);

	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$lib_color=return_library_array( "select id,color_name from lib_color", "id", "color_name");

	$color_size_sql=sql_select( "SELECT a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.po_break_down_id in (".$po_break_down_id.") order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
	}

 		if($prod_popup_lelel==1)
		{
			$sql = "SELECT c.to_po_id, c.production_quantity, c.item_number_id ,d.color_number_id,a.job_no,a.style_ref_no,b.po_number
			FROM wo_po_details_master a, wo_po_break_down b, pro_gmts_delivery_dtls c, wo_po_color_size_breakdown d
			WHERE a.job_no=b.job_no_mst and b.id=c.to_po_id and b.id=d.po_break_down_id and c.to_po_id in( $po_break_down_id) and a.status_active=1 and b.status_active=1 and c.status_active=1
			";
		}
		else
		{
			$sql = "SELECT c.from_po_id, c.production_quantity, c.item_number_id ,d.color_number_id,a.job_no,a.style_ref_no,b.po_number
			FROM wo_po_details_master a, wo_po_break_down b, pro_gmts_delivery_dtls c, wo_po_color_size_breakdown d
			WHERE a.job_no=b.job_no_mst and b.id=c.from_po_id and b.id=d.po_break_down_id and c.from_po_id in( $po_break_down_id) and a.status_active=1 and b.status_active=1 and c.status_active=1
			";
		}
  		$sql_res = sql_select($sql);
  		$data_array = array();
  		foreach ($sql_res as $val)
  		{
  			$data_array[$val[csf('job_no')]][$val[csf('style_ref_no')]][$val[csf('po_number')]][$val[csf('color_number_id')]]['production_quantity'] += $val[csf('production_quantity')];
  			$data_array[$val[csf('job_no')]][$val[csf('style_ref_no')]][$val[csf('po_number')]][$val[csf('color_number_id')]]['po_number'] += $val[csf('po_number')];
  		}
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>

		<? ob_start(); $table_width=480;?>
        <div style="width:<? echo $table_width; ?>px" align="left" id="details_reports">
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>

                	<th width="30" >SL</th>
                    <th width="100" >Job</th>
                    <th width="100" >Style</th>
                    <th width="100" >PO NUmber</th>
                    <th width="100" >Color Name</th>
                    <th width="50" >Qnty</th>
                </tr>
            </thead>
            <tbody>
            	<?
            	$sl=1;
            	$sub_total_prod_poly_qntyy=array();
            	$sub_totals=0;
            	foreach($data_array as $job_no=>$job_no_data)
            	{
            		foreach ($job_no_data as $style => $style_data)
            		{
            			foreach ($style_data as $po_id => $po_data)
            			{
            				foreach ($po_data as $color_id => $row)
            				{
            					?>
            					<tr>
            						<td><? echo $i;;?></td>
            						<td><? echo $job_no;?></td>
            						<td><? echo $style;?></td>
            						<td><? echo $row['po_number'];?></td>
            						<td><? echo $lib_color[$color_id];?></td>
            						<td><? echo $row['production_qnty'];?></td>
            					</tr>
            					<?
            				}
            			}
            		}

                }
                ?>
            </tbody>
		</table>
    	</div>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
		die;

	if($prod_popup_type==1 && $prod_popup_lelel_type==1) //for cutting
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id  $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
	group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4" align="center" valign="middle" ><? echo $color_Arr_library[$color_id]; ?></td>
                        <td >Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Qty.</td>
                        <?
						$total_color_size_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" ><? echo number_format($prod_color_size_data[$size_id],0); $total_color_size_qnty+=$prod_color_size_data[$size_id];  ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_color_size_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Balance.</td>
                        <?
						$total_cut_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" title="Cutting Qty-Plan Cut Qty."><? $cut_balance=($plan_order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($cut_balance,0); $total_cut_balance+=$cut_balance; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_cut_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
            <br />
    	</div>
    	<?

	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==1) //for emb print inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>

                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==2) //for emb print subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==1) //for emb print inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source=1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==2) //for emb print subcontract receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source<>1 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==2) //for emb ebroidery subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond  and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==2) //for emb ebroidery subcon receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] =$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==4) //for emb sp issue
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
	where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=2 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
	group by c.size_number_id
	order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}
		$table_width=(200+count($table_width)*60);
		?>
		<div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0);?></td>
						<?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Plan Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0);
						?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Balance</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=($prod_color_size_data[$size_id]-($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						 echo number_format($print_sent_balence,0);
						?>
                         </td>
                        <?
                    }
                    ?>
                </tr>
            </tbody>
		</table>
		</div>
    	<?*/
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==4) //for emb sp receive
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
	where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=3 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
	group by c.size_number_id
	order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}*/
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==1) //for sewing input
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Plan Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_plan_qnty=0;

                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
						$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Input Qty.</td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Input Qty.</td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Balance</td>
                    <?
					$total_prod_in_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==11) //for sewing input inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==13) //for sewing input subcon
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==1) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=5 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Plan Output Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_out_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input);
						$sewing_out_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_out_plan_cut,0); $total_sew_out_plan_qnty+=$sewing_out_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_out_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Output Qty.</td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Output Qty.</td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Output Balance</td>
                    <?
					$total_out_balance_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_out_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_out_balance,0); $total_out_balance_qnty+=$total_out_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_out_balance_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==11) //for emb sewing output Inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==13) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==3) //for emb wash issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=2 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Plan Qty</td>
                    <?
					$total_emp_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_emp_plan_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_emp_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Qty.</td>
                    <?
					$total_prod_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_sent_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent  Balance</td>
                    <?
					$total_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==3) //for emb wash receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=3 and a.embel_name=3 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Plan Qty.</td>
                    <?
					$total_plan_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_wash_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Qty.</td>
                    <?
					$total_prod_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_wash_qnty+=$prod_color_size_data[$size_id]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Balance</td>
                    <?
					$taoal_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $taoal_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($taoal_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==7 && $prod_popup_lelel_type==1) //for iron
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=7 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Plan Qty</td>
                    <?
					$toal_plan_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $toal_plan_iron_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_plan_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Qty.</td>
                    <?
					$total_prod_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_iron_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Balance</td>
                    <?
					$total_iron_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_iron_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_iron_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==8 && $prod_popup_lelel_type==1) //for finish
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
	from pro_garments_production_mst a,  pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=8 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Plan Qty.</td>
                    <?
					$total_plan_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash+$gmts_finishing;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_finish_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Qty.</td>
                    <?
					$total_prod_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_finish_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton  Balance</td>
                    <?
					$toal_finash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $toal_finash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_finash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==10 && $prod_popup_lelel_type==1) //for garments Delivery
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
	from pro_ex_factory_mst a,  pro_ex_factory_dtls b
	where a.id=b.mst_id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="3" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                </tr>

                <tr>
                    <td>Garments Delivery Qty.</td>
                    <?
					$total_delivery_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id],0); $total_delivery_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Gmts Deliv. Balance</td>
                    <?
					$total_delivery_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? $delivery_balance=($order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($delivery_balance,0); $total_delivery_balance+=$delivery_balance;?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==11) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		if($prod_popup_lelel_type=="") $prod_source_cond='';
		else
		{
			$prod_source_cond=$prod_popup_lelel_type;
		}

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
	from pro_garments_production_mst a, pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
	/*echo "SELECT b.color_size_break_down_id,
		sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
	from pro_garments_production_mst a, pro_garments_production_dtls b
	where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id "; die;*/

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qnty"]+=$row[csf('poly_qnty')];
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? foreach($allcolor_id_arr as $inc=>$color_id_val) { ?>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["poly_qnty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["poly_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_poly_qnty,0); ?></td>
                </tr>
                <? } ?>
            </tbody>
		</table>
    	</div>
    	<?
	}
	exit();
}



if ($action=='exfactory')  // exfactory date popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

 	?>
    <fieldset>
    <div style="margin-left:60px">
        <table width="500" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
            <thead>
                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Ex Factory Date</th>
                        <th width="">Ex Factory Qnty</th>
               		</tr>
            </thead>
        </table>
        <div style="max-height:425px; overflow-y:scroll; width:518px;" id="scroll_body">
            <table cellspacing="0" border="1" class="rpt_table"  width="500" rules="all" id="table_body" >
            <?
             $total_quantity=0;
             $sql=sql_select("select sum(ex_factory_qnty) as ex_factory_qnty, ex_factory_date from pro_ex_factory_mst where po_break_down_id in ($po_break_down_id) and item_number_id='$item_id' and status_active=1 and is_deleted=0 group by ex_factory_date");
            // echo $sql;
			$i=1;
            foreach($sql as $resultRow)
            {
                 if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="50"><? echo $i;?></td>
                    <td width="200" align="right"><? if($resultRow[csf("ex_factory_date")]!="0000-00-00") echo change_date_format($resultRow[csf("ex_factory_date")]); ?></td>
                    <td width="" align="right"><? echo number_format($resultRow[csf("ex_factory_qnty")]); ?></td>
                 </tr>
                 <?
                    $total_quantity+=$resultRow[csf("ex_factory_qnty")];
            	 	$i++;

        }//end foreach 1st
        ?>
        </table>
        <table cellspacing="0" border="1" class="tbl_bottom"  width="500" rules="all" id="body_bottom" >
                 <tr>
                    <td width="50">&nbsp;</td>
                    <td width="200">Total</td>
                    <td width=""><? echo number_format($total_quantity); ?></td>
                  </tr>
         </table>
       </div>
     </div>
     </fieldset>
    <?

 exit();

}

if($action=='date_wise_production_report')
{
	extract($_REQUEST);
 	echo load_html_head_contents("Remarks", "../../../", 1, 1,$unicode,'','');
	?>
    <div align="center">
        <fieldset style="width:480px">
        <legend>Cutting</legend>
            <?

                 $sql= "SELECT id,production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='1' and is_deleted=0 and status_active=1";
                 //echo $sql;
                 echo  create_list_view ( "list_view_1", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');

            ?>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Print/Embr Issue</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='2' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_2", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Print/Embr Receive</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='3' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_3", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>


        <fieldset style="width:480px">
        <legend>Sewing Input</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='4' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_4", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>


        <fieldset style="width:480px">
        <legend >Sewing Output</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='5' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_5", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>


        <fieldset style="width:480px">
        <legend>Finish Input</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='6' and is_deleted=0 and status_active=1";

                 echo  create_list_view ( "list_view_6", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Finish Output</legend>
            <?

                  $sql= "SELECT production_date,production_quantity,remarks from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type='8' and is_deleted=0 and status_active=1";

                  echo  create_list_view ( "list_view_7", "Date,Production Qnty,Remarks", "100,120,280","470","220",1, $sql, "", "","", 1, '0,0,0', $arr, "production_date,production_quantity,remarks", "", '','3,1,0','0,0,production_quantity,0');
            ?>
        </fieldset>
	</div>
	<?
	exit();
}//end if

if($action=="product_all_remarks")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Remarks", "../../../", 1, 1,$unicode,'','');
	$po_break_down_id=str_replace("'","",$po_break_down_id);
	$item_id=str_replace("'","",$item_id);
	$country_id=str_replace("'","",$country_id);
	$color_id=str_replace("'","",$color_id);
	$floor_library=return_library_array( "select id,floor_name from  lib_prod_floor", "id", "floor_name"  );
	$line_library=return_library_array( "select id,line_name from lib_sewing_line", "id", "line_name"  );
	$actual_resource_library=return_library_array( "select id,line_number from prod_resource_mst", "id", "line_number"  );
	$job_sql = sql_select("SELECT a.company_name,a.style_ref_no,a.buyer_name,b.po_number from wo_po_details_master a,wo_po_break_down b where a.id=b.job_id and b.id in($po_break_down_id)");
	?>
    <div id="data_panel" style="width:100%;text-align: center;padding: 5px;">
		<script>
            function new_window()
            {
                var w = window.open("Surprise", "#");
                var d = w.document.open();
                d.write(document.getElementById('details_reports').innerHTML);
                d.close();
            }
        </script>
    	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
    	<span id="popup_report_container" align="center" style="width: 120px;"> </span>
    </div>
    <?
     ob_start();
	?>
    <div align="center" id="details_reports">
    <div style="width:480px">
	    <table width="100%">
	    	<tr>
	    		<th colspan="2" align="left" width="49%">Company : <? echo $company_library[$job_sql[0][csf('company_name')]];?></th>
	    		<th colspan="2" align="left" width="49%">Style : <? echo $job_sql[0][csf('style_ref_no')];?></th>
	    	</tr>
	    	<tr>
	    		<th colspan="2" align="left" width="49%">Buyer : <? echo $buyer_short_library[$job_sql[0][csf('buyer_name')]];?></th>
	    		<th colspan="2" align="left" width="49%">Po No. : <? echo $job_sql[0][csf('po_number')];?></th>
	    	</tr>
	    </table>
	</div>
    <fieldset style="width:480px">
        <legend>Cut and Lay</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
				<?
                if($country_id>0) $country_cond=" and a.country_id='$country_id'"; else $country_cond="";
                if($color_id>0) $color_cond=" and c.color_number_id=$color_id"; else $color_cond="";
				if($color_id>0) $lay_color_cond=" and b.color_id=$color_id"; else $lay_color_cond="";

                $sql_cutAndLay= sql_select("SELECT a.remarks, max(a.entry_date) as production_date ,sum(c.size_qty) as production_quantity from  ppl_cut_lay_mst a,  ppl_cut_lay_dtls b, ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and c.order_id in($po_break_down_id) and b.gmt_item_id=$item_id $lay_color_cond group by a.remarks order by production_date");
                $i=1;
                $tot_lay_qty = 0;
                foreach($sql_cutAndLay as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td><? echo $row[csf('remarks')];?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_lay_qty += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_lay_qty,0); ?></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>



        <fieldset style="width:480px">
        <legend>Cutting</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
				<?
                if($country_id>0) $country_cond=" and a.country_id='$country_id'"; else $country_cond="";
                if($color_id>0) $color_cond=" and c.color_number_id=$color_id"; else $color_cond="";

                $sql_cutting= sql_select("SELECT a.DELIVERY_MST_ID,a.production_date,d.remarks,sum(b.production_qnty) as production_quantity from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c,pro_gmts_cutting_qc_mst d
                where a.DELIVERY_MST_ID=d.id and a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond $color_cond and a.production_type='1' and b.production_type='1' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.DELIVERY_MST_ID,a.production_date,d.remarks order by a.production_date");

                $i=1;
                $tot_cut_qty = 0;
                foreach($sql_cutting as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_cut_qty += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_cut_qty,0); ?></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Print/Embr Issue</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_print_issue= sql_select("SELECT a.production_date,b.remarks_dtls as remarks,sum(b.production_qnty) as production_quantity
                from pro_garments_production_mst a,  pro_garments_production_dtls b left join pro_gmts_delivery_mst d on b.delivery_mst_id=d.id and d.status_active=1, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond $color_cond and a.production_type='2' and b.production_type='2' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,b.remarks_dtls  order by a.production_date");
                if(count($sql_print_issue)==0)
                {
                	$sql_print_issue= sql_select("SELECT a.production_date,b.remarks_dtls as remarks,sum(b.production_qnty) as production_quantity
                	from pro_garments_production_mst a,  pro_garments_production_dtls b left join pro_gmts_delivery_mst d on b.delivery_mst_id=d.id and d.status_active=1, wo_po_color_size_breakdown c
                	where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond $color_cond and a.production_type='2' and b.production_type='2' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,b.remarks_dtls  order by a.production_date");
                }
                $i=1;
                $tot_print_qty = 0;
                foreach($sql_print_issue as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_print_qty += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_print_qty,0); ?></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Print/Embr Receive</legend>
             <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_print_rcv=  sql_select("SELECT a.production_date,b.remarks_dtls as remarks,sum(b.production_qnty) as production_quantity
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond $color_cond and a.production_type='3' and b.production_type='3' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,b.remarks_dtls  order by a.production_date");

                $i=1;
                $tot_print_qty = 0;
                foreach($sql_print_rcv as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_print_qty += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_print_qty,0); ?></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Sewing Input</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_in= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond $color_cond and a.production_type='4' and b.production_type='4' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line  order by a.production_date , a.floor_id");
                $i=1;
                $tot_input = 0;
                foreach($sql_sewing_in as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td ><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td style="padding-left:3px;">
                        <?
                        if($row[csf("prod_reso_allo")]==1)
                        {
                            $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                            $all_sewing_line="";
                            foreach($sewing_ling_arr as $line_id)
                            {
                                $all_sewing_line.=$line_library[$line_id].",";
                            }
                            $all_sewing_line=chop($all_sewing_line," , ");
                            echo $all_sewing_line;
                        }
                        else
                        {
                            echo $line_library[$row[csf("sewing_line")]];
                        }
                        ?>
                        </td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_input += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_input,0); ?></th>
                	<th></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend >Sewing Output</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_out= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond $color_cond and a.production_type='5' and b.production_type='5' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1     group by  a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line order by a.production_date , a.floor_id");
                $i=1;
                $tot_output = 0;
                foreach($sql_sewing_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td ><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td style="padding-left:3px;">
                        <?
                        if($row[csf("prod_reso_allo")]==1)
                        {
                            $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                            $all_sewing_line="";
                            foreach($sewing_ling_arr as $line_id)
                            {
                                $all_sewing_line.=$line_library[$line_id].",";
                            }
                            $all_sewing_line=chop($all_sewing_line," , ");
                            echo $all_sewing_line;
                        }
                        else
                        {
                            echo $line_library[$row[csf("sewing_line")]];
                        }
                        ?>
                        </td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_output += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_output,0); ?></th>
                	<th></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Poly</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_out= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond $color_cond and a.production_type='11' and b.production_type='11' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by  a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line order by a.production_date , a.floor_id");
                $i=1;
                $tot_poly = 0;
                foreach($sql_sewing_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td style="padding-left:3px;">
                        <?
                        if($row[csf("prod_reso_allo")]==1)
                        {
                            $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                            $all_sewing_line="";
                            foreach($sewing_ling_arr as $line_id)
                            {
                                $all_sewing_line.=$line_library[$line_id].",";
                            }
                            $all_sewing_line=chop($all_sewing_line," , ");
                            echo $all_sewing_line;
                        }
                        else
                        {
                            echo $line_library[$row[csf("sewing_line")]];
                        }
                        ?>
                        </td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_poly += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_poly,0); ?></th>
                	<th></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Finishing & Packing</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="100">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_finish_out= sql_select("SELECT a.production_date, a.floor_id, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id $country_cond $color_cond and a.production_type='8' and b.production_type='8' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1    group by a.production_date,a.floor_id order by a.production_date , a.floor_id");
                $i=1;
                $tot_fin = 0;
                foreach($sql_finish_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],0); ?></td>
                        <td ><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_fin += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="2">Total</th>
                	<th><? echo number_format($tot_fin,0); ?></th>
                	<th></th>
                	<th></th>
                </tfoot>
            </table>
        </fieldset>

		<fieldset style="width:480px">
        <legend>Ex-Factory</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Ex-Factory Date</td>
                        <td width="100">Floor</td>
                        <td width="100">Ex-Factory Qty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_finish_out= sql_select("SELECT a.ex_factory_date, b.delivery_floor_id, sum(a.ex_factory_qnty) as ex_factory_quantity, max(a.remarks) as remarks from pro_ex_factory_mst a, pro_ex_factory_delivery_mst b
                where a.po_break_down_id=$po_break_down_id and a.item_number_id=$item_id and a.delivery_mst_id = b.id and a.is_deleted=0 and a.status_active=1 group by a.ex_factory_date,b.delivery_floor_id order by a.ex_factory_date , b.delivery_floor_id ");
                $tot_fin = 0;
                foreach($sql_finish_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("ex_factory_date")]!="" && $row[csf("ex_factory_date")]!="0000-00-00") echo change_date_format($row[csf("ex_factory_date")]); ?></td>
                        <td ><? echo $floor_library[$row[csf("delivery_floor_id")]]; ?></td>
                        <td align="right"><? echo number_format($row[csf("ex_factory_quantity")],0); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $tot_fin += $row[csf("ex_factory_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<th colspan="3">Total</th>
                	<th><? echo number_format($tot_fin,0); ?></th>
                	<th></th> 
                </tfoot>
            </table>
        </fieldset>
	<?
	$html=ob_get_contents();
	ob_flush();

	foreach (glob("$user_id*.xls") as $filename)
	{
	   @unlink($filename);
	}

	//html to xls convert
	$name=time();
	$name=$user_id."_".$name.".xls";
	$create_new_excel = fopen(''.$name, 'w');
	$is_created = fwrite($create_new_excel,$html);
	?>
    <input type="hidden" id="txt_excl_link" value="<? echo 'requires/'.$name; ?>" />
    <script>
		$(document).ready(function(e)
		{
			document.getElementById('popup_report_container').innerHTML='<a href="<? echo $name?>" style="text-decoration:none"><input type="button" value="Convert to Excel" name="excel" id="excel" style="padding:0 2px;" class="formbutton"/></a>&nbsp;&nbsp;';
		});
	</script>
	</div>
	<?
	exit();
}


if ($action=="reject_qty_backup")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	//echo $po_id;
	?>
     <div style="width:780px;" align="center">
       <table width="770" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Reject Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="80">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Cutting Reject Qty</th>
                    <th width="60">Print Reject Qty</th>
                    <th width="60">Emb. Reject Qty</th>
                    <th width="60">Wash Reject Qty</th>
                    <th width="60">Special Reject Qty</th>
                    <th width="60">Sewing Out Reject Qty</th>
                    <th width="60">Iron Reject Qty</th>
                    <th width="60">Poly Reject Qty</th>
                    <th width="60">Finish Reject Qty.</th>
                    <th>Total Reject Qty.</th>
                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			 $rej_data_arr=array(); $rej_qty_arr=array();
			/*$sql_qry="Select a.po_break_down_id, c.color_number_id, c.size_number_id,
							sum(CASE WHEN a.production_type ='1' THEN b.reject_qty ELSE 0 END) AS cutting_rej_qnty,
							sum(CASE WHEN a.production_type ='3' THEN b.reject_qty ELSE 0 END) AS emb_rej_qnty,

							sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN b.reject_qty ELSE 0 END) AS printreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN b.reject_qty ELSE 0 END) AS embreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN b.reject_qty ELSE 0 END) AS washreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN b.reject_qty ELSE 0 END) AS spreceived_qnty,

							sum(CASE WHEN a.production_type ='7' THEN b.reject_qty ELSE 0 END) AS iron_rej_qnty,
			 				sum(CASE WHEN a.production_type ='8' THEN b.reject_qty ELSE 0 END) AS finish_rej_qnty,
							sum(CASE WHEN a.production_type ='5' THEN b.reject_qty ELSE 0 END) AS sewingout_rej_qnty,
							sum(CASE WHEN a.production_type ='11' THEN b.reject_qty ELSE 0 END) AS poly_rej_qnty
							from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
							where a.id=b.mst_id and b.color_size_break_down_id=c.id and  a.po_break_down_id in ($po_id) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $sql_cond  group by a.po_break_down_id, c.color_number_id, c.size_number_id";*/

				$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty

							from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
							where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			//echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('reject_qty')];
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$cutting_rej_qty=$rej_qty_arr[$color_id][$size_id][1][0];
						$printreceived_qty=$rej_qty_arr[$color_id][$size_id][3][1];
						$embreceived_qty=$rej_qty_arr[$color_id][$size_id][3][2];
						$washreceived_qty=$rej_qty_arr[$color_id][$size_id][3][3];
						$spreceived_qty=$rej_qty_arr[$color_id][$size_id][3][4];
						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][5][0];
						$iron_rej_qty=$rej_qty_arr[$color_id][$size_id][7][0];
						$poly_rej_qty=$rej_qty_arr[$color_id][$size_id][11][0];
						$finish_rej_qty=$rej_qty_arr[$color_id][$size_id][8][0];
						$total_reject=$cutting_rej_qty+$printreceived_qty+$embreceived_qty+$washreceived_qty+$spreceived_qty+$sewingout_rej_qty+$iron_rej_qty+$poly_rej_qty+$finish_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($cutting_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($printreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($embreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($washreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($spreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($sewingout_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($iron_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($poly_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($finish_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo $total_reject; ?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_cutting_rej+=$cutting_rej_qty;
						$tot_printrec_rej+=$printreceived_qty;
						$tot_embrec_rej+=$embreceived_qty;
						$tot_washrec_rej+=$washreceived_qty;
						$tot_sphrec_rej+=$spreceived_qty;
						$tot_sewing_rej+=$sewingout_rej_qty;
						$tot_iron_rej+=$iron_rej_qty;
						$tot_poly_rej+=$poly_rej_qty;
						$tot_finish_rej+=$finish_rej_qty;
						$tot_rej+=$total_reject;
					}
				}
			}
			?>
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_cutting_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_printrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_embrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_washrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_sphrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_iron_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_poly_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_finish_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}

if ($action=="reject_qty")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	//echo $po_id;
	?>
     <div style="width:720px;" align="center">
       <table width="710" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Reject Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="80">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Cutting Reject Qty</th>
                    <th width="60">Print Reject Qty</th>
                    <th width="60">Emb. Reject Qty</th>
                    <th width="60">Wash Reject Qty</th>
                    <th width="60">Special Reject Qty</th>
                    <!-- <th width="60">Sewing Out Reject Qty</th> -->
                    <th width="60">Iron Reject Qty</th>
                    <th width="60">Poly Reject Qty</th>
                    <th width="60">Finish Reject Qty.</th>
                    <th>Total Reject Qty.</th>
                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			 $rej_data_arr=array(); $rej_qty_arr=array();
			/*$sql_qry="Select a.po_break_down_id, c.color_number_id, c.size_number_id,
							sum(CASE WHEN a.production_type ='1' THEN b.reject_qty ELSE 0 END) AS cutting_rej_qnty,
							sum(CASE WHEN a.production_type ='3' THEN b.reject_qty ELSE 0 END) AS emb_rej_qnty,

							sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN b.reject_qty ELSE 0 END) AS printreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN b.reject_qty ELSE 0 END) AS embreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN b.reject_qty ELSE 0 END) AS washreceived_qnty,
							sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN b.reject_qty ELSE 0 END) AS spreceived_qnty,

							sum(CASE WHEN a.production_type ='7' THEN b.reject_qty ELSE 0 END) AS iron_rej_qnty,
			 				sum(CASE WHEN a.production_type ='8' THEN b.reject_qty ELSE 0 END) AS finish_rej_qnty,
							sum(CASE WHEN a.production_type ='5' THEN b.reject_qty ELSE 0 END) AS sewingout_rej_qnty,
							sum(CASE WHEN a.production_type ='11' THEN b.reject_qty ELSE 0 END) AS poly_rej_qnty
							from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
							where a.id=b.mst_id and b.color_size_break_down_id=c.id and  a.po_break_down_id in ($po_id) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $sql_cond  group by a.po_break_down_id, c.color_number_id, c.size_number_id";*/

				$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty

							from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
							where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id)  and a.item_number_id='$item_id' and a.status_active in(1,2,3) and a.is_deleted=0 and b.status_active in(1,2,3) and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			 //echo $sql_qry; exit();
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];

				$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('reject_qty')];
				//$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]]+=$row[csf('reject_qty')];
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						//to match
						//$rej_value=$cutting_reject+$emb_reject+$iron_reject+$sewing_out_reject+$finish_reject+$poly_rej_qnty+$sewing_input_rej_qnty+$emb_issue_rej_qnty;

						$cutting_rej_qty=$rej_qty_arr[$color_id][$size_id][1][0];
						$printreceived_qty=$rej_qty_arr[$color_id][$size_id][3][1];
						$embreceived_qty=$rej_qty_arr[$color_id][$size_id][3][2];
						$washreceived_qty=$rej_qty_arr[$color_id][$size_id][3][3];
						$spreceived_qty=$rej_qty_arr[$color_id][$size_id][3][4];
						$iron_rej_qty=$rej_qty_arr[$color_id][$size_id][7][0];
						$poly_rej_qty=$rej_qty_arr[$color_id][$size_id][11][0];
						$finish_rej_qty=$rej_qty_arr[$color_id][$size_id][8][0];

						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][5][0];
						$sewingin_rej_qty=$rej_qty_arr[$color_id][$size_id][4][0];





						$total_reject=$cutting_rej_qty+$printreceived_qty+$embreceived_qty+$washreceived_qty+$spreceived_qty+$iron_rej_qty+$poly_rej_qty+$finish_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($cutting_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($printreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($embreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($washreceived_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($spreceived_qty,0); ?>&nbsp;</td>
                            <!--<td align="right"><? //echo number_format($sewingout_rej_qty,0);?>&nbsp;</td>-->
                            <td align="right"><? echo number_format($iron_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($poly_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo number_format($finish_rej_qty,0); ?>&nbsp;</td>
                            <td align="right"><? echo $total_reject; ?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_cutting_rej+=$cutting_rej_qty;
						$tot_printrec_rej+=$printreceived_qty;
						$tot_embrec_rej+=$embreceived_qty;
						$tot_washrec_rej+=$washreceived_qty;
						$tot_sphrec_rej+=$spreceived_qty;
						// $tot_sewing_rej+=$sewingout_rej_qty;
						$tot_iron_rej+=$iron_rej_qty;
						$tot_poly_rej+=$poly_rej_qty;
						$tot_finish_rej+=$finish_rej_qty;
						$tot_rej+=$total_reject;
					}
				}
			}
			?>
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_cutting_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_printrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_embrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_washrec_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_sphrec_rej,0); ?>&nbsp;</td>
                    <!--<td align="right"><? //echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>-->
                    <td align="right"><? echo number_format($tot_iron_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_poly_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo number_format($tot_finish_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}


if ($action=="sewing_reject_qty")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	//echo $po_id;
	?>
     <div style="width:310px;" align="center">
       <table width="340" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Sewing Reject Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="130">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Sewing Out Reject Qty</th>
                    <th>Total Reject Qty.</th>
                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>"; die;
			$sql_cond="";
			//if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			//if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			$rej_data_arr=array();
			$rej_qty_arr=array();

			$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty,b.replace_qty,b.production_qnty,b.is_rescan
			from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
			where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			// echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				/* if($row[csf('is_rescan')]==0)
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('reject_qty')];
				}
				else
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('production_qnty')];
				} */

				$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('reject_qty')];

				//$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('replace_qty')]; ISD-23-01062 dont open
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][5][0];
						$total_reject=$sewingout_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td valign="middle"><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($sewingout_rej_qty,0);?>&nbsp;</td>
                            <td align="right"><? echo number_format($total_reject,0); ?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_sewing_rej+=$sewingout_rej_qty;
						$tot_rej+=$total_reject;
					}
				}
			}
			?>
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}
if ($action=="replace_qty")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	//echo $po_id;
	?>
     <div style="width:310px;" align="center">
       <table width="340" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Sewing Replace Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="130">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Sewing Replace Qty</th>

                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			$rej_data_arr=array();
			$rej_qty_arr=array();

			$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty,b.replace_qty,b.production_qnty,b.is_rescan
			from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
			where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			// echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				/* if($row[csf('is_rescan')]==0)
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('replace_qty')];
				}
				else
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('production_qnty')];
				} */

				$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('replace_qty')];

				//$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('replace_qty')];// ISD-23-01062 dont open
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][5][0];
						$total_reject=$sewingout_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td valign="middle"><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($sewingout_rej_qty,0);?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_sewing_rej+=$sewingout_rej_qty;
					//	$tot_rej+=$total_reject;
					}
				}
			}

			?>
			<!--  -->
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
	<?
	exit();
}
if ($action=="cut_replace_qty")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');


	?>
     <div style="width:310px;" align="center">
       <table width="340" cellspacing="0" border="1" class="rpt_table" rules="all" >
             <thead>
             	<tr>
                	<th colspan="13">Cutting Replace Qty Details</th>
                </tr>
                <tr>
                    <th width="20">SL</th>
                    <th width="130">Color</th>
                    <th width="70">Size</th>
                    <th width="60">Cutting Replace Qty</th>

                 </tr>
              </thead>
              <tbody>
			 <?
			 $color_arr=return_library_array( "select id, color_name from lib_color", "id", "color_name");
			 $size_arr=return_library_array( "select id, size_name from lib_size", "id", "size_name");
			$po_id=str_replace("'","",$po_id);
			$item_id=str_replace("'","",$item_id);
			$country_id=str_replace("'","",$country_id);
			$color_id=str_replace("'","",$color_id);
			//echo $po_id."*".$item_id."*".$country_id."*".$color_id."<br>";
			$sql_cond="";
			if($country_id>0) $sql_cond =" and a.country_id=$country_id";
			if($color_id>0) $sql_cond .=" and c.color_number_id=$color_id";
			$rej_data_arr=array();
			$rej_qty_arr=array();

			$sql_qry="SELECT a.po_break_down_id, c.color_number_id, c.size_number_id, a.production_type, a.embel_name, b.reject_qty,b.replace_qty,b.production_qnty,b.is_rescan
			from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
			where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in ($po_id) and a.production_type in(1,3,5,7,8,11) and a.item_number_id='$item_id' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  $sql_cond order by c.color_order, c.size_order";
			// echo $sql_qry;
			$sql_result=sql_select($sql_qry);
			foreach($sql_result as $row)
			{
				if($row[csf('embel_name')]=="") $row[csf('embel_name')]=0;
				$rej_data_arr[$row[csf('color_number_id')]]['size'][$row[csf('size_number_id')]]=$row[csf('size_number_id')];
				if($row[csf('is_rescan')]==0)
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]+=$row[csf('replace_qty')];
				}
				else
				{
					$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('production_qnty')];
				}

				//$rej_qty_arr[$row[csf('color_number_id')]][$row[csf('size_number_id')]][$row[csf('production_type')]][$row[csf('embel_name')]]-=$row[csf('replace_qty')];// ISD-23-01062 dont open
			}
			unset($sql_result);

			$i=1;
			foreach($rej_data_arr as $color_id=>$color_data)
			{
				$rowspn=count($color_data['size']); $k=1;
				foreach($color_data as $ind=>$size_data)
				{
					foreach($size_data as $size_id)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
						$cutting_rej_qty=$printreceived_qty=$embreceived_qty=$washreceived_qty=$spreceived_qty=$sewingout_rej_qty=$iron_rej_qty=$poly_rej_qty=$finish_rej_qty=0;

						$sewingout_rej_qty=$rej_qty_arr[$color_id][$size_id][1][0];
						$total_reject=$sewingout_rej_qty;

						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
							<? if ($k==1) { ?>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $i; ?></td>
                                <td rowspan="<? echo $rowspn; ?>"><? echo $color_arr[$color_id]; ?></td>
                            <? $k++; } ?>
                            <td valign="middle"><? echo $size_arr[$size_id]; ?></td>
                            <td align="right"><? echo number_format($sewingout_rej_qty,0);?>&nbsp;</td>
						</tr>
						<?
						$i++;
						$tot_sewing_rej+=$sewingout_rej_qty;
					//	$tot_rej+=$total_reject;
					}
				}
			}

			?>
			<!--  -->
            </tbody>
            <tfoot>
                <tr bgcolor="#CCCCCC">
                    <td colspan="3" align="right">Total:</td>
                    <td align="right"><? echo number_format($tot_sewing_rej,0); ?>&nbsp;</td>
                    <td align="right"><? echo $tot_rej; ?>&nbsp;</td>
                </tr>
            </tfoot>
        </table>
		</div>
<?

	    $sql= "SELECT e.color_number_id,e.size_number_id ,a.serving_company,a.production_date,b.reject_qty,a.company_id,a.cut_no,d.po_number,c.style_ref_no,c.job_no, b.replace_qty
		from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_break_down d,wo_po_color_size_breakdown e
		where a.id=b.mst_id  and c.id=e.job_id and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id and c.id=d.job_id and d.id=e.po_break_down_id  and a.production_type=1 and b.production_type=1 and a.po_break_down_id=$po_id and a.item_number_id=$item_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and d.status_active=1 and d.is_deleted=0 and e.status_active=1 and e.is_deleted=0";

		$main_sql=sql_select($sql);
		$main_arr=array();
		$size_number_arr=array();
		$reject_arr=array();
		$size_wise_qty_arr=array();
		$size_wise_replace_qty_arr=array();
		$replace_qty_arr=array();

		foreach($main_sql as $row)
		{
			$size_number_arr[$row[csf('size_number_id')]]=$row[csf('size_number_id')];
			$reject_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['qty']+=$row[csf('reject_qty')];
			$replace_qty_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]][$row[csf('size_number_id')]]['replace_qty']+=$row[csf('replace_qty')];
			$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['company_id']=$row[csf('company_id')];
			$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['serving_company']=$row[csf('serving_company')];
			$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['style_ref_no']=$row[csf('style_ref_no')];
			$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['job_no']=$row[csf('job_no')];
			$main_arr[$row[csf('cut_no')]][$row[csf('production_date')]][$row[csf('color_number_id')]]['po_number']=$row[csf('po_number')];
			$size_wise_qty_arr[$row[csf('size_number_id')]]+=$row[csf('reject_qty')];
			$size_wise_replace_qty_arr[$row[csf('size_number_id')]]+=$row[csf('replace_qty')];
		}
		// echo '<pre>';
		// print_r($main_arr);
		// echo '</pre>';
		$tbl_width = 1020+(count($size_number_arr)*60);
?>
<br>
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $tbl_width; ?>">
        <thead>
			<tr>
				<th colspan="9"></th>
				<th colspan=<? echo count($size_number_arr)+1;?>>Reject</th>
				<th colspan=<? echo count($size_number_arr)+1;?>>Reject Replace</th>
			</tr>
			<tr>
				<th width="20">SL</th>
				<th width="100">Company</th>
				<th width="100"> Working Company</th>
				<th width="100">Cutting No</th>
				<th width="100">Plan Cut Date</th>
				<th width="100">Job</th>
				<th width="100">Style</th>
				<th width="100">Po</th>
				<th width="100">Color Name</th>
				<?
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th width="60"><?
					echo $size_arr[$size_id];
					?></th>
				<?
				}
				?>
				<th width="100">Total</th>

				<?
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th width="60"><?
					echo $size_arr[$size_id];
					?></th>
				<?
				}
				?>
				<th width="100">Total</th>
			</tr>
		</thead>
        <tbody>
		<?
			$i=1;
			foreach($main_arr as $cut_no=>$cut_val)
			{
				foreach($cut_val as $prod_date=>$prod_val)
				{
					foreach($prod_val as $color_id=>$row)
					{
						if ($i%2==0)
						$bgcolor="#E9F3FF";
						else
						$bgcolor="#FFFFFF";
						$size_total_qty=0;
						$size_replace_total_qty=0;
						?>
						<tr bgcolor="<? echo $bgcolor; ?>">
						<td align="right"><? echo $i; ?></td>
						<td align="right"><? echo $company_library[$row['company_id']]; ?></td>
						<td align="right"><? echo $company_library[$row['serving_company']];; ?></td>
						<td align="right"><? echo $cut_no; ?></td>
						<td align="right"><? echo $prod_date; ?></td>
						<td align="right"><? echo $row['job_no']; ?></td>
						<td align="right"><? echo $row['style_ref_no']; ?></td>
						<td align="right"><? echo $row['po_number']; ?></td>
						<td align="right"><? echo $color_library[$color_id]; ?></td>
						<?
						foreach($size_number_arr as $size_id=>$size_data)
						{
							?>
							<td width="60" align="right"><?
							echo $reject_arr[$cut_no][$prod_date][$color_id][$size_id]['qty'];$size_total_qty+=$reject_arr[$cut_no][$prod_date][$color_id][$size_id]['qty'];
							?></td>
						<?
						}
						?>
						<td align="right"><? echo number_format($size_total_qty); $gr_size_total_qty+=$size_total_qty;?></td>
						<?
						foreach($size_number_arr as $size_id=>$size_data)
						{
							?>
							<td width="60" align="right"><?
							echo $replace_qty_arr[$cut_no][$prod_date][$color_id][$size_id]['replace_qty'];$size_replace_total_qty+=$replace_qty_arr[$cut_no][$prod_date][$color_id][$size_id]['replace_qty'];
							?></td>
						<?
						}
						?>
						<td align="right"><? echo number_format($size_replace_total_qty); $gr_size_replace_qty+=$size_replace_total_qty;?></td>
						<?
						$i++;
					}
				}
			}

        ?>
		</tbody>
		<tfoot>
              <th colspan="9">Total</th>
			  <?
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th width="60" align="right"><?
					echo $size_wise_qty_arr[$size_id];
					?></th>
				<?
				}
				?>
			 <th align="right"><? echo $gr_size_total_qty;?></th>
			 <?
				foreach($size_number_arr as $size_id=>$size_data)
				{
					?>
					<th width="60" align="right"><?
					echo $size_wise_replace_qty_arr[$size_id];
					?></th>
				<?
				}
				?>
			 <th align="right"><? echo $gr_size_replace_qty;?></th>
	   </table>







<?
	exit();
}
//-------------------------------------------END Show Date Location Floor & Line Wise------------------------
//-------------------------------------------end-----------------------------------------------------------------------------//

if ($action==1 || $action==5)
{
 	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	if($country_id=='') $country_cond=""; else $country_cond=" and country_id='$country_id'";
 	?>
    <script>
	 var tableFilters_sewout =
		{
			//col_0: "none",col_1:"none",display_all_text: " -- All --",
			col_operation: {
				id: ["total_sew_qty"],
				col: [4],
				operation: ["sum"],
				write_method: ["innerHTML"]
			}
		}

		function openmypage(po_break_down_id,item_id,prod_type,location_id,floor_id,dateOrLocWise,country_id,prod_date,action)
		{
			var popupWidth = "width=550px,height=320px,";
			emailwindow=dhtmlmodal.open('EmailBox', 'iframe', 'order_wise_production_report_format2_controller.php?po_break_down_id='+po_break_down_id+'&item_id='+item_id+'&action='+action+'&location_id='+location_id+'&floor_id='+floor_id+'&dateOrLocWise='+dateOrLocWise+'&country_id='+country_id+'&prod_date='+prod_date+'&prod_type='+prod_type, 'Production Quantity', popupWidth+'center=1,resize=0,scrolling=0','../../');
		}
	</script>
    <fieldset>
    <div style="margin-left:50px">
        <table width="620" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
            <thead>
                 <? if($action==1){ ?>
                    <tr>
                        <th width="50">Sl.</th>
                        <th width="100">Cutting Date</th>
                        <th width="160">Cutt. Qty(In-house)</th>
                        <th width="160">Cutt. Qty(Out-bound)</th>
                        <th width="">Cutting Company</th>
                 	</tr>
				<? } else if($action==5){ ?>
                    <tr>
                        <th width="30">Sl.</th>
                        <th width="80">Output Date</th>
                        <th width="80">PO No</th>
                        <th width="80">Sewing Line</th>
                        <th width="80">Sew.Qty</th>
                        <th width="100">Source</th>
                        <th width="">Sewing Company</th>
                    </tr>
 				<? } ?>
            </thead>
        </table>
        <div style="max-height:370px; overflow-y:scroll; width:638px;" id="scroll_body">
            <table cellspacing="0" border="1" class="rpt_table" width="620" rules="all" id="table_body" >
            <?
             $total_in_quantity=0;$total_out_quantity=0;
             $i=1;
 			 $company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name"  );
 			 $supplier_library=return_library_array( "select id,supplier_name from  lib_supplier", "id", "supplier_name" );
			 $po_array=return_library_array( "select id,po_number from  wo_po_break_down where id in ($po_break_down_id)", "id", "po_number");
			 $sewing_library=return_library_array( "select id,line_name from  lib_sewing_line", "id", "line_name");
			 $prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');

			 $location="";$floor="";
			 if($dateOrLocWise==2 || $dateOrLocWise==4) // only for location floor and line wise
			 {
				 if($location_id!="") $location=" and location=$location_id";
				 if($floor_id!="") $floor=" and floor_id=$floor_id";
			 }
			 if($action==5)
			 {
				 $sql=sql_select("select po_break_down_id,production_date,prod_reso_allo,sewing_line,production_source,serving_company,
					  SUM(production_quantity) as production_quantity
					  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type=$action and status_active=1 $location $floor $country_cond group by serving_company,production_date,po_break_down_id,prod_reso_allo,sewing_line,production_source");
			 }
			 else
			 {
				 $sql=sql_select("select po_break_down_id,production_date,production_source,serving_company,
					  SUM(CASE WHEN production_source=1 THEN production_quantity ELSE 0 END) as in_house_cut_qnty,
					  SUM(CASE WHEN production_source=3 THEN production_quantity ELSE 0 END) as out_bound_cut_qnty
					  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type=$action and status_active=1 $location $floor $country_cond group by po_break_down_id,serving_company,production_date,production_source");
			 }

            foreach($sql as $resultRow)
            {
                 if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				 if($action==5)
				 {
					$sewing_line='';
					if($resultRow[csf('prod_reso_allo')]==1)
					{
						$line_number=explode(",",$prod_reso_arr[$resultRow[csf('sewing_line')]]);
						foreach($line_number as $val)
						{
							if($sewing_line=='') $sewing_line=$sewing_library[$val]; else $sewing_line.=",".$sewing_library[$val];
						}
					}
					else $sewing_line=$sewing_library[$resultRow[csf('sewing_line')]];
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="30"><? echo $i;?></td>
                    <td width="80"><a href="##" onclick="openmypage('<? echo $po_break_down_id ?>','<? echo $item_id ?>','<? echo $action ?>','<? echo $location_id ?>','<? echo $floor_id ?>','<? echo $dateOrLocWise ?>','<? echo $country_id ?>','<? echo $resultRow[csf("production_date")]; ?>','challanPopup')"><? echo change_date_format($resultRow[csf("production_date")]); ?></a></td>
                    <td width="80"><p><? echo $po_array[$resultRow[csf("po_break_down_id")]]; ?></p></td>
                    <td width="80"><? echo $sewing_line; ?></td>
                    <td width="80" align="right"><? echo number_format($resultRow[csf("production_quantity")]); ?>&nbsp;</td>
                    <td width="100"><? echo $knitting_source[$resultRow[csf("production_source")]]; ?></td>
                    <?
                    	$source= $resultRow[csf('production_source')];
					    if($source==3)
						{
							$serving_company= $supplier_library[$resultRow[csf('serving_company')]];
						}
						else
						{
							$serving_company= $company_library[$resultRow[csf('serving_company')]];
						}
					?>
                    <td width=""><p><? echo $serving_company; ?></p></td>
                 </tr>
                 <?
				 }
				 else
				 {
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="50"><? echo $i;?></td>
                    <td width="100"><a href="##" onclick="openmypage('<? echo $po_break_down_id ?>','<? echo $item_id ?>','<? echo $action ?>','<? echo $location_id ?>','<? echo $floor_id ?>','<? echo $dateOrLocWise ?>','<? echo $country_id ?>','<? echo $resultRow[csf("production_date")]; ?>','challanPopup')"><? echo change_date_format($resultRow[csf("production_date")]); ?></a></td>
                    <td width="160" align="right"><? echo number_format($resultRow[csf("in_house_cut_qnty")]); ?></td>
                    <td width="160" align="right"><? echo number_format($resultRow[csf("out_bound_cut_qnty")]); ?></td>
                    <?
                    	$source= $resultRow[csf('production_source')];
					    if($source==3)
						{
							$serving_company= $supplier_library[$resultRow[csf('serving_company')]];
						}
						else
						{
							$serving_company= $company_library[$resultRow[csf('serving_company')]];
						}
					?>
                    <td width=""><p><? echo $serving_company; ?></p></td>
                 </tr>
                 <?
				 }

				$total_sewing_quantity+=$resultRow[csf("production_quantity")];
				$total_in_quantity+=$resultRow[csf("in_house_cut_qnty")];
				$total_out_quantity+=$resultRow[csf("out_bound_cut_qnty")];
				$i++;
			}//end foreach 1st
			?>
			</table>
        <table width="500" cellspacing="0" border="1" class="tbl_bottom" rules="all" id="body_bottom" >
           <?
			if($action==5)
			{
			?>
            	<tfoot class="tbl_bottom">
                     <tr>

                        <td width="30">&nbsp;</td>
                        <td width="80">&nbsp;</td>
                        <td width="80">&nbsp;</td>
                        <td width="80">Total</td>
                        <td width="80" id="total_sew_qty"><? echo number_format($total_sewing_quantity); ?>&nbsp;</td>
                        <td width="100">&nbsp;</td>
                        <td>&nbsp;</td>
                     </tr>
                 </tfoot>
			 <?
			 }
			 else
			 {
			?>
            	<tfoot class="tbl_bottom">
                     <tr>
                        <td width="50">&nbsp;</td>
                        <td width="100">Total</td>
                        <td width="160"><? echo number_format($total_in_quantity); ?> </td>
                        <td width="160"><? echo number_format($total_out_quantity); ?></td>
                        <td width="">&nbsp;</td>
                     </tr>
                 </tfoot>
			 <?
			 }
			 ?>
			</table>
		</div>
	</div>
	</fieldset>
    <script>
	var action=<? echo $action; ?>;
	if(action==5) setFilterGrid("table_body",-1,tableFilters_sewout);
	</script>
    <?
 exit();

}


//---- sewing input-4, iron input-7, finish-8, re_iron input-9-----------popup--------//
if ($action==4 || $action==7 || $action==8 || $action==9) // popup
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	?>
	 <script>
	 var tableFilters_sewin =
	{
		//col_0: "none",col_1:"none",display_all_text: " -- All --",
		col_operation: {
			id: ["total_issue_qty"],
			col: [4],
			operation: ["sum"],
			write_method: ["innerHTML"]
		}
 	}
	</script>
    <?
	if($country_id=='') $country_cond=""; else $country_cond=" and country_id='$country_id'";

 	?>
    <fieldset>
    <div style="margin-left:60px">
        <table width="500" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
            <thead>
				<? if($action==2){ ?>

                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Print/ Emb. Issue Date</th>
                        <th width="">Print/ Emb. Issue Qnty</th>
                    </tr>

				<? } else if($action==3){ ?>

                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Print/ Emb. Receive Date</th>
                        <th width="">Print/ Emb. Receive Qnty</th>
                    </tr>

				<? } else if($action==4){ ?>

                    <tr>
                        <th width="30">Sl.</th>
                        <th width="70">Sewing Date</th>
                        <th width="80">PO No</th>
                        <th width="80">Sewing Line</th>
                        <th width="80">Sewing Qty</th>
                        <th width="">Source</th>
                    </tr>
                <? } else if($action==7){ ?>

                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Iron Output Date</th>
                        <th width="">Iron Output Qnty</th>
                    </tr>
                <? } else if($action==8){ ?>

                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Finish Date</th>
                        <th width="">Finish Qty</th>
                    </tr>
                <? } else if($action==9){ ?>
                    <tr>
                        <th width="50">Sl.</th>
                        <th width="200">Iron Output Date</th>
                        <th width="">Re-Iron Output Qty</th>
                    </tr>
               <? } ?>
            </thead>
        </table>
        <div style="max-height:425px; overflow-y:scroll; width:518px;" id="scroll_body">
            <table width="500" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_body" >
            <?
				$po_array=return_library_array( "select id,po_number from  wo_po_break_down", "id", "po_number");
				$sewing_library=return_library_array( "select id,line_name from  lib_sewing_line", "id", "line_name");
				$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
             $total_quantity=0;
             $i=1;
			 $location="";$floor="";
			 if($dateOrLocWise==2 || $dateOrLocWise==4) // only for location floor and line wise
			 {
				 if($location_id!="") $location=" and location=$location_id";
				 if($floor_id!="") $floor=" and floor_id=$floor_id";
			 }
			 if ($action==9)
			 {
				 $sql=sql_select("select production_date, sum(re_production_qty) as production_quantity
				  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and re_production_qty!=0 and item_number_id=$item_id and status_active=1 and is_deleted=0 and production_type=7 $location $floor $country_cond group by production_date");
			 }
			 else if ($action==4)
			 {
				 $sql=sql_select("select po_break_down_id,production_date,prod_reso_allo,sewing_line,production_source,sum(production_quantity) as production_quantity
				  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and status_active=1 and is_deleted=0 and production_type=$action $location $floor $country_cond group by po_break_down_id,production_date,prod_reso_allo,sewing_line,production_source");
			 }
			 else
			 {
				 $sql=sql_select("select production_date,sum(production_quantity) as production_quantity
				  from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and status_active=1 and is_deleted=0 and production_type=$action $location $floor $country_cond group by production_date");
			 }

            foreach($sql as $resultRow)
            {
                 if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				 if ($action==4)
				 {
					 $sewing_line='';
					if($resultRow[csf('prod_reso_allo')]==1)
					{
						$line_number=explode(",",$prod_reso_arr[$resultRow[csf('sewing_line')]]);
						foreach($line_number as $val)
						{
							if($sewing_line=='') $sewing_line=$sewing_library[$val]; else $sewing_line.=",".$sewing_library[$val];
						}
					}
					else $sewing_line=$sewing_library[$resultRow[csf('sewing_line')]];
             	?>
                     <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                        <td width="30"><? echo $i;?></td>
                        <td width="70" align="center"><? echo change_date_format($resultRow[csf("production_date")]); ?></td>
                        <td width="80" align="center"><p><? echo $po_array[$resultRow[csf("po_break_down_id")]]; ?></p></td>
                        <td width="80" align="center"><? echo $sewing_line; ?></td>
                        <td width="80" align="right"><? echo number_format($resultRow[csf("production_quantity")],0); ?>&nbsp;</td>
                        <td><? echo $knitting_source[$resultRow[csf("production_source")]]; ?></td>
                     </tr>
                 <?
				 }
				 else
				 {
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="50"><? echo $i;?></td>
                    <td width="200" align="right"><? echo change_date_format($resultRow[csf("production_date")]); ?></td>
                    <td width="" align="right"><? echo number_format($resultRow[csf("production_quantity")],0); ?>&nbsp;</td>
                 </tr>
                 <?
				 }
                    $total_quantity+=$resultRow[csf("production_quantity")];
            	 	$i++;

        }//end foreach 1st
        ?>
        </table>
        <table width="500" cellspacing="0" border="1" class="tbl_bottom" rules="all" id="body_bottom" >
        	<?
			if ($action==4)
			{
			?>
                 <tr>
                    <td width="30">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="80">Total</td>
                    <td width="80" id="total_issue_qty"><? echo number_format($total_quantity,0); ?>&nbsp;</td>
                    <td>&nbsp;</td>
                 </tr>
             <?
			}
			else
			{
			?>
                 <tr>
                    <td width="50">&nbsp;</td>
                    <td width="200">Total</td>
                    <td><? echo number_format($total_quantity,0); ?>&nbsp;</td>
                 </tr>
             <?
			}
			 ?>
         </table>
       </div>
     </div>
     </fieldset>
     <script>
	var action=<? echo $action; ?>;

	//if (action==4) setFilterGrid("tableFilters_sewin",-1);
	if(action==4) setFilterGrid("table_body",-1,tableFilters_sewin);

	</script>
    <?

 exit();

}



//--print/emb issue-2,print/emb receive-3,
if ($action==2 || $action==3)
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,1,1);

	if($country_id=='') $country_cond=""; else $country_cond=" and country_id='$country_id'";
	$emple_type=$location_id;
	if($emple_type==1) $hedding="Pringing";
	if($emple_type==2) $hedding="Embroidery";
	if($emple_type==3) $hedding="Wash";
	if($emple_type==4) $hedding="Special Work";
 	?>
    <div id="data_panel" align="center" style="width:100%">
         <script>
		 	function new_window()
			 {
				var w = window.open("Surprise", "#");
				var d = w.document.open();
				d.write(document.getElementById('details_reports').innerHTML);
				d.close();
			 }
          </script>
 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
 	</div>
    <div id="details_reports">
        <table width="400" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
            <thead>

                 <? if ($action==2) { ?>
                   <tr>
                        <th width="30" rowspan="2">Sl.</th>
                        <th width="80" rowspan="2">Date</th>
                        <th colspan="3"><? echo $hedding; ?> &nbsp; Issue</th>

                    </tr>
                 <? } else {?>
                 	<tr>
                        <th width="30" rowspan="2">Sl.</th>
                        <th width="80" rowspan="2">Date</th>
                        <th colspan="3"><? echo $hedding; ?> &nbsp; Receive</th>

                    </tr>
                 <? } ?>

                    <tr>

                      <th width="70">In-house</th>
                      <th width="70">Outside</th>
                      <th width="80">Embl. Company</th>


                    </tr>
            </thead>
        </table>
        <div style="max-height:425px; overflow-y:scroll; width:420px;" id="scroll_body">
            <table cellspacing="0" border="1" class="rpt_table"  width="399" rules="all" id="table_body" >
            <?
			$company_library=return_library_array( "select id,company_short_name from lib_company", "id", "company_short_name" );
 			$supplier_library=return_library_array( "select id,short_name from  lib_supplier", "id", "short_name" );

			$sql = sql_select("SELECT production_date,production_source,serving_company,
						SUM(CASE WHEN production_source =1 AND embel_name=$emple_type THEN production_quantity ELSE 0 END) AS prod11,
						SUM(CASE WHEN production_source =3 AND embel_name=$emple_type THEN production_quantity ELSE 0 END) AS prod31
 					FROM
						pro_garments_production_mst
					WHERE
						status_active=1 and is_deleted=0 and production_type=$action and po_break_down_id in ($po_break_down_id) and item_number_id=$item_id $country_cond
					GROUP BY production_date,production_source,serving_company");
			// echo $sql; die;

		   	$printing_in_qnty=0;$emb_in_qnty=0;$wash_in_qnty=0;$special_in_qnty=0;
			$printing_out_qnty=0;$emb_out_qnty=0;$wash_out_qnty=0;$special_out_qnty=0;
			$dataArray=array();$companyArray=array();
            $i=1;
			foreach($sql as $resultRow)
            {
                 if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";

				 if($resultRow[csf('production_source')]==3)
					$serving_company= $supplier_library[$resultRow[csf('serving_company')]];
				else
					$serving_company= $company_library[$resultRow[csf('serving_company')]];
				$td_count = 2;
             	?>
                 <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                    <td width="30"><? echo $i;?></td>
                    <td width="80" align="center"><? echo change_date_format($resultRow[csf("production_date")]); ?></td>

                    <td width="70" align="right"><? if($resultRow[csf('production_source')]==1){ echo $resultRow[csf("prod11")];$printing_in_qnty+=$resultRow[csf("prod11")];}else echo "0"; ?></td>
                    <td width="70" align="right"><? if($resultRow[csf('production_source')]==3){ echo $resultRow[csf("prod31")];$printing_out_qnty+=$resultRow[csf("prod31")];}else echo "0"; ?></td>
                    <td width="80"><p>&nbsp;<? if($resultRow[csf('prod11')]>0 || $resultRow[csf('prod31')]>0) echo $serving_company; ?></p></td>
                    <?
					$companyArray[$serving_company]=$serving_company;
					$dataArray[1][$serving_company]+=$resultRow[csf("prod11")]+$resultRow[csf("prod31")] ?>
                  </tr>
 				 <?
             	$i++;

        }//end foreach 1st
        ?>
        		<tfoot>
                    <tr>
                       <th align="right" colspan="2">Grand Total</th>
                       <th align="right"><? echo $printing_in_qnty; ?></th>
                       <th align="right"><? echo $printing_out_qnty; ?></th>
                       <th align="right">&nbsp;</th>

                     </tr>
               </tfoot>
        </table>
       </div>



 </div>

	<?
  	exit();

}



//cutting-1,sewing ouput-5--------------------popup-----------//
if ($action=="challanPopup")
{
 	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');

	if($country_id=='') $country_cond=""; else $country_cond=" and country_id='$country_id'";

 	?>
    <script>

		function print_window()
		{
			document.getElementById('scroll_body').style.overflow="auto";
			document.getElementById('scroll_body').style.maxHeight="none";

			var w = window.open("Surprise", "#");
			var d = w.document.open();
			d.write ('<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN""http://www.w3.org/TR/html4/strict.dtd">'+
		'<html><head><link rel="stylesheet" href="../../../css/style_common.css" type="text/css" media="print"/><title></title></head><body>'+document.getElementById('report_container').innerHTML+'</body</html>');

			d.close();
			document.getElementById('scroll_body').style.overflowY="scroll";
			document.getElementById('scroll_body').style.maxHeight="260px";
		}

	</script>
    <div style="width:530px" align="center"><input type="button" value="Print Preview" onClick="print_window()" style="width:100px"  class="formbutton"/></div>
    <fieldset style="width:530px; margin-left:5px">
        <div id="report_container">
            <table width="500" cellspacing="0" border="1" class="rpt_table" rules="all" id="table_header_1" >
                <thead>
                    <th width="50">Sl.</th>
                    <th width="150">Production Date</th>
                    <th width="160">Challan No</th>
                    <th>Quantity</th>
                </thead>
            </table>
            <div style="max-height:260px; overflow-y:scroll; width:520px;" id="scroll_body">
                <table cellspacing="0" border="1" class="rpt_table" width="500" rules="all" id="table_body" >
                <?
					 $i=1; $total_quantity=0; $location="";$floor="";
					 if($dateOrLocWise==2 || $dateOrLocWise==4) // only for location floor and line wise
					 {
						 if($location_id!="") $location=" and location=$location_id";
						 if($floor_id!="") $floor=" and floor_id=$floor_id";
					 }

					 $sql=sql_select("select production_date, challan_no, SUM(production_quantity) as production_quantity from pro_garments_production_mst where po_break_down_id in ($po_break_down_id) and item_number_id=$item_id and production_type=$prod_type and status_active=1 and production_date='$prod_date' $location $floor $country_cond group by production_date, challan_no");
					foreach($sql as $resultRow)
					{
						if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                         <tr bgcolor="<? echo $bgcolor; ?>" onclick="change_color('tr_1nd<? echo $i; ?>','<? echo $bgcolor; ?>')" id="tr_1nd<? echo $i; ?>">
                            <td width="50"><? echo $i;?></td>
                            <td width="150" align="center"><? echo change_date_format($resultRow[csf("production_date")]); ?></td>
                            <td width="160"><? echo $resultRow[csf("challan_no")]; ?>&nbsp;</td>
                            <td align="right" style="padding-right:2px"><? echo number_format($resultRow[csf("production_quantity")]); ?></td>
                         </tr>
                        <?
                        $total_sewing_quantity+=$resultRow[csf("production_quantity")];
                        $i++;
                    }
                    ?>
                   <tfoot class="tbl_bottom">
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td align="right">Total</td>
                        <td align="right" style="padding-right:2px"><? echo number_format($total_sewing_quantity); ?></td>
					</tfoot>
                </table>
            </div>
        </div>
	</fieldset>
    <?
 exit();

}

// ===================================== Job and color wise ===================================

if($action=="update_tna_progress_comment_job")
{
	//echo load_html_head_contents("TNA Info","../../../", 1, 1, $unicode,'','');
	extract($_REQUEST);
	// var_dump($_REQUEST);
	$po_no = str_replace("'", "", $po_no);
	if($db_type==0) $blank_date="0000-00-00"; else $blank_date="";

	$tna_task_arr=return_library_array( "select task_name, task_short_name from lib_tna_task",'task_name','task_short_name');

	$tna_task_id=array(); $plan_start_array=array(); $plan_finish_array=array();
	$actual_start_array=array();
	$actual_finish_array=array();

	$notice_start_array=array();
	$notice_finish_array=array();
	$task_sql= sql_select("select a.task_number,a.task_start_date,a.task_finish_date,a.actual_start_date,a.actual_finish_date,a.notice_date_start,a.notice_date_end from tna_process_mst a, lib_tna_task b where a.task_number=b.task_name and a.template_id=$template_id and a.po_number_id in($po_no) order by b.task_sequence_no asc");
	foreach ($task_sql as $row_task)
	{
		$tna_task_id[]=$row_task[csf("task_number")];

		$plan_start_array[$row_task[csf("task_number")]] =$row_task[csf("task_start_date")];
		$plan_finish_array[$row_task[csf("task_number")]]=$row_task[csf("task_finish_date")];

		$actual_start_array[$row_task[csf("task_number")]] =$row_task[csf("actual_start_date")];
		$actual_finish_array[$row_task[csf("task_number")]]=$row_task[csf("actual_finish_date")];

		$notice_start_array[$row_task[csf("task_number")]] =$row_task[csf("notice_date_start")];
		$notice_finish_array[$row_task[csf("task_number")]]=$row_task[csf("notice_date_end")];
	}



	$comments_array=array(); $responsible_array=array();
	$res_comm_sql= sql_select("select task_id, comments, responsible from tna_progress_comments where tamplate_id=$template_id and order_id in($po_no)");
	foreach ($res_comm_sql as $row_res_comm)
	{
		$comments_array[$row_res_comm[csf("task_id")]] =$row_res_comm[csf("comments")];
		$responsible_array[$row_res_comm[csf("task_id")]]=$row_res_comm[csf("responsible")];
	}

	$execution_time_array=array();
	$execution_time_sql= sql_select("select tna_task_id, execution_days from tna_task_template_details where task_template_id=$template_id");
	foreach ($execution_time_sql as $row_execution_time)
	{
		$execution_time_array[$row_execution_time[csf("tna_task_id")]] =$row_execution_time[csf("execution_days")];
	}

	$lead_time=return_library_array("select task_template_id,lead_time from tna_task_template_details group by task_template_id,lead_time","task_template_id","lead_time");
	$company_library=return_library_array( "select id,company_short_name from lib_company", "id", "company_short_name"  );
    $buyer_short_library=return_library_array( "select id,short_name from lib_buyer", "id", "short_name"  );
	?>


	<fieldset style="width:1010px">
        <div class="form_caption" align="center"><strong>TNA Progress Comment</strong></div>
        <table style="margin-top:10px" width="1000" border="1" rules="all" class="rpt_table">
            <?
			$sql ="select b.company_name,b.buyer_name,a.po_number,b.job_no,b.style_ref_no,b.gmts_item_id,a.po_received_date,a.shipment_date from wo_po_break_down a,wo_po_details_master b where b.job_no='$job_no' and a.id in($po_no) and a.job_no_mst=b.job_no";
			//echo $sql;die;
			$result=sql_select($sql);
            foreach($result as $row)
            {
            ?>
            	<thead>
                    <tr bgcolor="#E9F3FF">
                        <th width="130">Company</th>
                        <td width="196" style="padding-left:5px"><? echo $company_library[$row[csf('company_name')]];  ?></td>
                        <th width="130">Buyer</th>
                        <td width="186" style="padding-left:5px"><? echo $buyer_short_library[$row[csf('buyer_name')]];  ?></td>
                        <th width="130">Order No</th>
                        <td width="186" style="padding-left:5px"><p><? echo $row[csf('po_number')]; ?></p></td>
                    </tr>
                    <tr bgcolor="#FFFFFF">
                        <th>Style Ref.</th>
                        <td style="padding-left:5px"><p><? echo $row[csf('style_ref_no')]; ?></p></td>
                        <th>RMG Item</th>
                        <td style="padding-left:5px"><p><? echo $garments_item[$row[csf('gmts_item_id')]]; ?></p></td>
                        <th>Order Recv. Date</th>
                        <td style="padding-left:5px"><? echo change_date_format($row[csf('po_received_date')]); ?></td>
                    </tr>
                    <tr bgcolor="#E9F3FF">
                        <th>Ship Date</th>
                        <td style="padding-left:5px"><? echo change_date_format($row[csf('shipment_date')]); ?></td>
                        <th>Lead Time</th>
                        <td style="padding-left:5px">
                            <?
								$template_id=str_replace("'","",$template_id);

								if($tna_process_type==1)
								{
									$lead_timee=$lead_time[$template_id];
								}
								else
								{
									$lead_timee=$template_id;
								}
								//echo $lead_time=return_field_value("lead_time","tna_task_template_details", "task_template_id='$template_id' and status_active=1 and is_deleted=0");
								echo $lead_timee;
							?>
                        </td>
                        <th>Job Number</th>
                        <td style="padding-left:5px">
							<? echo $row[csf('job_no')];   ?>
                        </td>
                    </tr>
                </thead>
            <?
            }
            ?>
        </table>
        <table style="margin-top:5px" cellpadding="0" width="1000" class="rpt_table" rules="all" border="1">
            <thead>
                <th width="50">Task No</th>
                <th width="150">Task Name</th>
                <th width="60">Allowed Days</th>
                <th width="80">Plan Start Date</th>
                <th width="80">Plan Finish Date</th>
                <th width="80">Actual Start Date</th>
                <th width="80">Actual Finish Date</th>
                <th width="80">Start Delay/ Early By</th>
                <th width="80">Finish Delay/ Early By</th>
                <th width="100">Responsible</th>
                <th>Comments</th>
            </thead>
        </table>



            <table cellpadding="0" width="1000" cellspacing="0" border="1" rules="all" class="rpt_table">
                <?


				$i=1;
                foreach($tna_task_id as $key)
                {
                    if($i%2==0) $trcolor="#E9F3FF"; else $trcolor="#FFFFFF";

					$bgcolor1=""; $bgcolor="";

					if ($plan_start_array[$key]!=$blank_date)
					{
						if (strtotime($notice_start_array[$key])<=strtotime(date("Y-m-d",time())) && strtotime(date("Y-m-d",time()))<=strtotime($plan_start_array[$key]))  $bgcolor="#FFFF00";
						else if (strtotime($plan_start_array[$key])<strtotime(date("Y-m-d",time())))  $bgcolor="#FF0000";
						else $bgcolor="";

					}

					if ($plan_finish_array[$key]!=$blank_date) {
						if (strtotime($notice_finish_array[$key])<=strtotime(date("Y-m-d",time())) && strtotime(date("Y-m-d",time()))<=strtotime($plan_finish_array[$key]))  $bgcolor1="#FFFF00";
						else if (strtotime($plan_finish_array[$key])<strtotime(date("Y-m-d",time())))  $bgcolor1="#FF0000"; else $bgcolor1="";
					}

					if ($actual_start_array[$key]!=$blank_date) $bgcolor="";
					if ($actual_finish_array[$key]!=$blank_date) $bgcolor1="";

					// Delay / Early............

					$bgcolor5=""; $bgcolor6="";
					$delay=""; $early="";

					if($actual_start_array[$key]!=$blank_date)
					{
						$start_diff1 = datediff( "d", $actual_start_array[$key], $plan_start_array[$key]);
						$finish_diff1 = datediff( "d", $actual_finish_array[$key], $plan_finish_array[$key]);

						$start_diff=$start_diff1-1;
						$finish_diff=$finish_diff1-1;

						if($start_diff<0)
						{
							$bgcolor5="#2A9FFF";	//Blue
							$start="(Delay)";
						}
						if($start_diff>0)
						{
							$bgcolor5="";
							$start="(Early)";

						}
						if($finish_diff<0)
						{
							$bgcolor6="#2A9FFF";
							$finish="(Delay)";
						}
						if($finish_diff>0)
						{
							$bgcolor6="";
							$finish="(Early)";
						}


					}
					else
					{
						if(date("Y-m-d")>$plan_start_array[$key])
						{
							$start_diff1 = datediff( "d", $plan_start_array[$key], date("Y-m-d"));
							$start_diff=$start_diff1-1;
							$bgcolor5="#FF0000";		//Red
							$start="(Delay)";
						}
						if(date("Y-m-d")>$plan_finish_array[$key])
						{
							$finish_diff1 = datediff( "d", $plan_finish_array[$key], date("Y-m-d"));
							$finish_diff=$finish_diff1-1;
							$bgcolor6="#FF0000";
							$finish="(Delay)";
						}
						if(date("Y-m-d")<=$plan_start_array[$key])
						{
							$start_diff = "";
							$bgcolor5="";
							$start="(Ac. Start Dt. Not Found)";
						}
						if(date("Y-m-d")<=$plan_finish_array[$key])
						{
							$finish_diff = "";
							$bgcolor6="";
							$finish="(Ac. Finish Dt. Not Found)";

						}
					}

                    ?>
                    <tr bgcolor="<? echo $trcolor; ?>" id="tr_<? echo $i; ?>" onclick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')">
                        <td align="center" width="50"><? echo $i; ?></td>
                        <td width="150"><? echo $tna_task_arr[$key]; ?></td>
                        <td align="center" width="60"><? echo datediff( "d", $plan_start_array[$key],$plan_finish_array[$key]);//$execution_time_array[$key]; ?></td>
                        <td align="center" width="80"><? echo change_date_format($plan_start_array[$key]); ?>&nbsp;</td>
                        <td align="center" width="80"><? echo change_date_format($plan_finish_array[$key]); ?>&nbsp;</td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor;  ?>">
                            <?
                                if($actual_start_array[$key]=="0000-00-00" || $actual_start_array[$key]=="") echo "&nbsp;";
                                else echo change_date_format($actual_start_array[$key]);
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor1;  ?>">
                            <?
                                 if($actual_finish_array[$key]=="0000-00-00" || $actual_finish_array[$key]=="") echo "&nbsp;";
                                 else echo change_date_format($actual_finish_array[$key]);
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor5;  ?>">
							<?
                                echo $start_diff." ".$start;
                            ?>
                        </td>
                        <td align="center" width="80" bgcolor="<? echo $bgcolor6;  ?>">
                            <?
                                echo $finish_diff." ".$finish;
                            ?>
                        </td>

                        <td width="100"><p><? echo $responsible_array[$key]; ?>&nbsp;</p></td>
                        <td><p><? echo $comments_array[$key]; ?>&nbsp;</p></td>
                    </tr>
              	<?
                    $i++;
                }
                ?>
            </table>
    </fieldset>
	<?
	exit();
}

if($action=="job_color_wise_remarks")
{
	extract($_REQUEST);
 	echo load_html_head_contents("Remarks", "../../../", 1, 1,$unicode,'','');
	// $job_no=str_replace("'","",$job_no);
	$color_id=str_replace("'","",$color_id);
	$po_break_down_id = $po_no;
	$floor_library=return_library_array( "select id,floor_name from  lib_prod_floor", "id", "floor_name"  );
	$line_library=return_library_array( "select id,line_name from lib_sewing_line", "id", "line_name"  );
	$actual_resource_library=return_library_array( "select id,line_number from prod_resource_mst", "id", "line_number"  );
	$job_sql = sql_select("SELECT a.company_name,a.style_ref_no,a.buyer_name,b.po_number from wo_po_details_master a,wo_po_break_down b where a.job_no=b.job_no_mst and b.id in($po_break_down_id)");
	?>
    <div id="data_panel" style="width:100%;text-align: center;padding: 5px;">
		<script>
            function new_window()
            {
                var w = window.open("Surprise", "#");
                var d = w.document.open();
                d.write(document.getElementById('details_reports').innerHTML);
                d.close();
            }
        </script>
    	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
    	<span id="popup_report_container" align="center" style="width: 120px;"> </span>
    </div>
    <?
     ob_start();
	?>
    <div align="center" id="details_reports">
    <div style="width:480px">
	    <table width="100%">
	    	<tr>
	    		<th colspan="2" align="left" width="49%">Company : <? echo $company_library[$job_sql[0][csf('company_name')]];?></th>
	    		<th colspan="2" align="left" width="49%">Style : <? echo $job_sql[0][csf('style_ref_no')];?></th>
	    	</tr>
	    	<tr>
	    		<th colspan="2" align="left" width="49%">Buyer : <? echo $buyer_short_library[$job_sql[0][csf('buyer_name')]];?></th>
	    		<th colspan="2" align="left" width="49%">Po No. : <? echo $job_sql[0][csf('po_number')];?></th>
	    	</tr>
	    </table>
	</div>
    <fieldset style="width:480px">
        <legend>Cut and Lay</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
				<?
                if($color_id>0) $color_cond=" and c.color_number_id=$color_id"; else $color_cond="";

                $sql_cutAndLay= sql_select("SELECT max(a.entry_date) as production_date ,sum(c.size_qty) as production_quantity from  ppl_cut_lay_mst a,  ppl_cut_lay_dtls b, ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.job_no='$job_no' and b.color_id=$color_id order by production_date");
                $i=1;
                $cutTotal=0;
                foreach($sql_cutAndLay as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td>&nbsp;</td>
                    </tr>
                    <?
                     $cutTotal+=$row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($cutTotal,2); ?></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
    </fieldset>



    	<fieldset style="width:480px">
        	<legend>Cutting</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
				<?
                if($color_id>0) $color_cond=" and c.color_number_id=$color_id"; else $color_cond="";

                $sql_cutting= sql_select("SELECT a.production_date,a.remarks,sum(b.production_qnty) as production_quantity from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='1' and b.production_type='1' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,a.remarks order by a.production_date");
                $i=1;
                $cuttingTotal = 0;
                foreach($sql_cutting as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $cuttingTotal += $row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($cuttingTotal,2); ?></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        <legend>Print/Embr Issue</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_print_issue= sql_select("SELECT a.production_date,a.remarks,sum(b.production_qnty) as production_quantity
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='2' and b.production_type='2' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,a.remarks  order by a.production_date");
                $i=1;
                $embIssueTotal = 0;
                foreach($sql_print_issue as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $embIssueTotal += $row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($embIssueTotal,2); ?></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>
        <fieldset style="width:480px">
        <legend>Print/Embr Receive</legend>
             <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="120">Production Qnty</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_print_rcv=  sql_select("SELECT a.production_date,a.remarks,sum(b.production_qnty) as production_quantity
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='3' and b.production_type='3' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date,a.remarks  order by a.production_date");

                $i=1;
                $embRcvTotal = 0;
                foreach($sql_print_rcv as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $embRcvTotal += $row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($embRcvTotal,2); ?></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        	<legend>Sewing Input</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_in= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='4' and b.production_type='4' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line  order by a.production_date , a.floor_id");
                $sewing_in_array = array();
                foreach ($sql_sewing_in as $key => $row)
                {
                	if($row[csf("prod_reso_allo")]==1)
                    {
                        $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                        $all_sewing_line="";
                        foreach($sewing_ling_arr as $line_id)
                        {
                            $all_sewing_line.=$line_library[$line_id].",";
                        }
                        $all_sewing_line=chop($all_sewing_line," , ");
                        // echo $all_sewing_line;
                        $sewing_in_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['production_quantity'] += $row[csf("production_quantity")];
	                	$sewing_in_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['remarks'] = $row[csf("remarks")];
                    }
                    else
                    {
                        $all_sewing_line = $line_library[$row[csf("sewing_line")]];
                        $sewing_in_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['production_quantity'] += $row[csf("production_quantity")];
	                	$sewing_in_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['remarks'] = $row[csf("remarks")];
                    }

                }
                /*echo "<pre>";
                print_r($sewing_in_array);
                echo "</pre>";*/
                $i=1;
                $GrandTotal = 0;
                foreach($sewing_in_array as $floor_id=>$floor_data)
                {
                	$floorTotal = 0;
                	foreach ($floor_data as $date => $date_data)
                	{
                		foreach ($date_data as $line_name => $row)
                		{
		                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
		                    ?>
		                    <tr bgcolor="<? echo $bgcolor; ?>">
		                        <td align="center"><? echo $i; ?></td>
		                        <td align="center"><? if($date!="" && $date!="0000-00-00") echo change_date_format($date); ?></td>
		                        <td align="right"><? echo number_format($row["production_quantity"],2); ?></td>
		                        <td ><? echo $floor_library[$floor_id]; ?></td>
		                        <td style="padding-left:3px;"><? echo $line_name; ?> </td>
		                        <td><? echo $row["remarks"]; ?></td>
		                    </tr>
		                    <?
		                    $i++;
		                    $floorTotal += $row["production_quantity"];
		                    $GrandTotal += $row["production_quantity"];
                    	}
                	}
                	?>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($floorTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                	<?
                }
                ?>
                	<tr>
                		<td></td>
                		<td align="right">Grand Total</td>
                		<td align="right"><? echo number_format($GrandTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                </tbody>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        	<legend >Sewing Output</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_out= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='5' and b.production_type='5' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1     group by  a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line order by a.production_date , a.floor_id");
                $sewing_out_array = array();
                foreach ($sql_sewing_out as $key => $row)
                {
                	if($row[csf("prod_reso_allo")]==1)
                    {
                        $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                        $all_sewing_line="";
                        foreach($sewing_ling_arr as $line_id)
                        {
                            $all_sewing_line.=$line_library[$line_id].",";
                        }
                        $all_sewing_line=chop($all_sewing_line," , ");
                        // echo $all_sewing_line;
                        $sewing_out_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['production_quantity'] += $row[csf("production_quantity")];
	                	$sewing_out_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['remarks'] = $row[csf("remarks")];
                    }
                    else
                    {
                        $all_sewing_line = $line_library[$row[csf("sewing_line")]];
                        $sewing_out_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['production_quantity'] += $row[csf("production_quantity")];
	                	$sewing_out_array[$row[csf("floor_id")]][$row[csf("production_date")]][$all_sewing_line]['remarks'] = $row[csf("remarks")];
                    }

                }
                /*echo "<pre>";
                print_r($sewing_in_array);
                echo "</pre>";*/
                $i=1;
                $GrandTotal = 0;
                foreach($sewing_out_array as $floor_id=>$floor_data)
                {
                	$floorTotal = 0;
                	foreach ($floor_data as $date => $date_data)
                	{
                		foreach ($date_data as $line_name => $row)
                		{
		                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
		                    ?>
		                    <tr bgcolor="<? echo $bgcolor; ?>">
		                        <td align="center"><? echo $i; ?></td>
		                        <td align="center"><? if($date!="" && $date!="0000-00-00") echo change_date_format($date); ?></td>
		                        <td align="right"><? echo number_format($row["production_quantity"],2); ?></td>
		                        <td ><? echo $floor_library[$floor_id]; ?></td>
		                        <td style="padding-left:3px;"><? echo $line_name; ?> </td>
		                        <td><? echo $row["remarks"]; ?></td>
		                    </tr>
		                    <?
		                    $i++;
		                    $floorTotal += $row["production_quantity"];
		                    $GrandTotal += $row["production_quantity"];
                    	}
                	}
                	?>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($floorTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                	<?
                }
                ?>
                	<tr>
                		<td></td>
                		<td align="right">Grand Total</td>
                		<td align="right"><? echo number_format($GrandTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                </tbody>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        	<legend>Poly</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="70">Date</td>
                        <td width="80">Production Qty</td>
                        <td width="100">Floor</td>
                        <td width="70">Line No</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_sewing_out= sql_select("SELECT a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='11' and b.production_type='11' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1   group by  a.production_date, a.floor_id, a.prod_reso_allo, a.sewing_line order by a.production_date , a.floor_id");
                $i=1;
                $polyTotal = 0;
                foreach($sql_sewing_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td style="padding-left:3px;">
                        <?
                        if($row[csf("prod_reso_allo")]==1)
                        {
                            $sewing_ling_arr=array_unique(explode(",",$actual_resource_library[$row[csf("sewing_line")]]));
                            $all_sewing_line="";
                            foreach($sewing_ling_arr as $line_id)
                            {
                                $all_sewing_line.=$line_library[$line_id].",";
                            }
                            $all_sewing_line=chop($all_sewing_line," , ");
                            echo $all_sewing_line;
                        }
                        else
                        {
                            echo $line_library[$row[csf("sewing_line")]];
                        }
                        ?>
                        </td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $polyTotal += $row[csf("production_quantity")];
                    $i++;
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($polyTotal,2); ?></td>
                		<td></td>
                		<td></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>

        <fieldset style="width:480px">
        	<legend>Finishing & Packing</legend>
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="470">
                <thead>
                    <tr>
                        <td width="30">SL</td>
                        <td width="100">Date</td>
                        <td width="100">Production Qnty</td>
                        <td width="100">Floor</td>
                        <td>Remarks</td>
                    </tr>
                </thead>
                <tbody>
                <?
                $sql_finish_out= sql_select("SELECT a.production_date, a.floor_id, sum(b.production_qnty) as production_quantity, max(a.remarks) as remarks
                from pro_garments_production_mst a, pro_garments_production_dtls b, wo_po_color_size_breakdown c
                where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) $color_cond and a.production_type='8' and b.production_type='8' and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1    group by a.production_date,a.floor_id order by a.production_date , a.floor_id");
                $i=1;
                $finTotal = 0;
                foreach($sql_finish_out as $row)
                {
                    if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
                    ?>
                    <tr bgcolor="<? echo $bgcolor; ?>">
                        <td align="center"><? echo $i; ?></td>
                        <td align="center"><? if($row[csf("production_date")]!="" && $row[csf("production_date")]!="0000-00-00") echo change_date_format($row[csf("production_date")]); ?></td>
                        <td align="right"><? echo number_format($row[csf("production_quantity")],2); ?></td>
                        <td ><? echo $floor_library[$row[csf("floor_id")]]; ?></td>
                        <td><? echo $row[csf("remarks")]; ?></td>
                    </tr>
                    <?
                    $i++;
                    $finTotal += $row[csf("production_quantity")];
                }
                ?>
                </tbody>
                <tfoot>
                	<tr>
                		<td></td>
                		<td align="right">Total</td>
                		<td align="right"><? echo number_format($finTotal,2); ?></td>
                		<td></td>
                		<td></td>
                	</tr>
                </tfoot>
            </table>
        </fieldset>
    <?
	$html=ob_get_contents();
	ob_flush();

	foreach (glob("$user_id*.xls") as $filename)
	{
	   @unlink($filename);
	}

	//html to xls convert
	$name=time();
	$name=$user_id."_".$name.".xls";
	$create_new_excel = fopen(''.$name, 'w');
	$is_created = fwrite($create_new_excel,$html);
	?>
    <input type="hidden" id="txt_excl_link" value="<? echo 'requires/'.$name; ?>" />
    <script>
		$(document).ready(function(e)
		{
			document.getElementById('popup_report_container').innerHTML='<a href="<? echo $name?>" style="text-decoration:none"><input type="button" value="Convert to Excel" name="excel" id="excel" style="padding:0 2px;" class="formbutton"/></a>&nbsp;&nbsp;';
		});
	</script>
	</div>
	<?
	exit();
}

if ($action=='JobColorOrderPopup')
{
	echo load_html_head_contents("Order Wise Production Report", "../../../", 1, 1,$unicode,'','');
	extract($_REQUEST);

	$po_break_down_id=$po_no;
	$company_name=str_replace("'","",$company_name);
	$color_id=str_replace("'","",$color_id);

	//echo $po_break_down_id."****".$company_name."****".$item_id."****".$country_id."****".$color_id;die;
	$sql_exfect="SELECT c.color_number_id, c.size_number_id, sum(b.production_qnty) as production_qnty from pro_ex_factory_mst a,pro_ex_factory_dtls b, wo_po_color_size_breakdown c where a.id=b.mst_id and b.color_size_break_down_id=c.id and a.po_break_down_id in($po_break_down_id) and c.color_number_id='$color_id' and a.status_active=1 and a.is_deleted=0 group by  c.color_number_id, c.size_number_id";
	$sql_result_exfact=sql_select($sql_exfect);
	foreach($sql_result_exfact as $row)
	{
		$ex_fact_qty_arr[$row[csf("color_number_id")]][$row[csf("size_number_id")]]=$row[csf("production_qnty")];
	}

	$color_library=array();
	$size_library=array();
	$color_library_plan=array();
	$dataQty=array();
	$colorSizeData=sql_select("SELECT id, color_number_id, size_number_id, order_quantity, plan_cut_qnty, excess_cut_perc from wo_po_color_size_breakdown where po_break_down_id in ($po_break_down_id) and color_number_id='$color_id' and status_active=1 and is_deleted=0");
 	  foreach($colorSizeData as $csRow)
	  {
		  if($csRow[csf('color_number_id')]>0)
		  {
			  $color_library[$csRow[csf('color_number_id')]]+=$csRow[csf('order_quantity')];
			  $color_library_plan[$csRow[csf('color_number_id')]]+=$csRow[csf('plan_cut_qnty')];
		  }

		  if($csRow[csf('size_number_id')]>0)
		  {
			  $size_library[$csRow[csf('size_number_id')]]=$csRow[csf('size_number_id')];
		  }

		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][1]+=$csRow[csf('order_quantity')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][2]+=$csRow[csf('plan_cut_qnty')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][3]+=$csRow[csf('excess_cut_perc')];
		  $dataQty[$csRow[csf('color_number_id')]][$csRow[csf('size_number_id')]][4]+=1;
		  $color_size_data[$csRow[csf("id")]]["color_number_id"]=$csRow[csf('color_number_id')];
		  $color_size_data[$csRow[csf("id")]]["size_number_id"]=$csRow[csf('size_number_id')];
	  }




	if($db_type==0)
	{
		$prod_sql= sql_select("SELECT a.po_break_down_id, c.color_size_break_down_id,
				IFNULL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				IFNULL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.status_active=1 and c.status_active=1 and a.po_break_down_id in($po_break_down_id) group by a.po_break_down_id,c.color_size_break_down_id");
				/*IFNULL(sum(CASE WHEN c.production_type ='2' THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				IFNULL(sum(CASE WHEN c.production_type ='3' THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty, */
	}
	else
	{
		 $pr_sql="SELECT a.po_break_down_id, c.color_size_break_down_id,
				NVL(sum(CASE WHEN a.production_type ='1' THEN c.production_qnty  ELSE 0 END),0) AS cutting_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printing_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=1 THEN c.production_qnty ELSE 0 END),0) AS printreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS emb_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=2 THEN c.production_qnty ELSE 0 END),0) AS embreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS wash_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=3 THEN c.production_qnty ELSE 0 END),0) AS washreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='2' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS sp_qnty,
				NVL(sum(CASE WHEN a.production_type ='3' AND a.embel_name=4 THEN c.production_qnty ELSE 0 END),0) AS spreceived_qnty,
				NVL(sum(CASE WHEN a.production_type ='4' THEN c.production_qnty ELSE 0 END),0) AS sewingin_qnty,
				NVL(sum(CASE WHEN a.production_type ='5' THEN c.production_qnty ELSE 0 END),0) AS sewingout_qnty,
				NVL(sum(CASE WHEN a.production_type ='6' THEN c.production_qnty ELSE 0 END),0) AS finishin_qnty,
				NVL(sum(CASE WHEN a.production_type ='7' THEN c.production_qnty ELSE 0 END),0) AS iron_qnty,
				NVL(sum(CASE WHEN a.production_type ='8' THEN c.production_qnty ELSE 0 END),0) AS finish_qnty
			from
				pro_garments_production_mst a, pro_garments_production_dtls c
			where
				a.id=c.mst_id and a.status_active=1 and c.status_active=1 and a.po_break_down_id in($po_break_down_id)
			group by a.po_break_down_id,c.color_size_break_down_id";
			$prod_sql=sql_select($pr_sql);


	}
	//echo $prod_sql;
	$prod_color_size_data=array();
	foreach($prod_sql as $row)
	{
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["cutting_qnty"]+=$row[csf("cutting_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printing_qnty"]+=$row[csf("printing_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["printreceived_qnty"]+=$row[csf("printreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["emb_qnty"]+=$row[csf("emb_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["embreceived_qnty"]+=$row[csf("embreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["wash_qnty"]+=$row[csf("wash_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["washreceived_qnty"]+=$row[csf("washreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sp_qnty"]+=$row[csf("sp_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["spreceived_qnty"]+=$row[csf("spreceived_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingin_qnty"]+=$row[csf("sewingin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["sewingout_qnty"]+=$row[csf("sewingout_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finishin_qnty"]+=$row[csf("finishin_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["iron_qnty"]+=$row[csf("iron_qnty")];
		$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["finish_qnty"]+=$row[csf("finish_qnty")];
		//$color_library[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		//$size_library[$row[csf("size_number_id")]]=$row[csf("size_number_id")];
	}
	//var_dump($color_library);die;

	?>
	 <div id="data_panel" align="center" style="width:100%">
	         <script>
			 	function new_window()
				 {
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				 }
	         </script>
	 	<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
	 </div>

	<div style="width:700px" align="center" id="details_reports">
	  	<legend>Color And Size Wise Summary</legend>
	    <table id="tbl_id" class="rpt_table" width="700" border="1" rules="all" >
	    	<thead>
	        	<tr>
	            	<th width="70">Buyer</th>
	                <th width="100">Job Number</th>
	                <th width="120">Style Name</th>
	                <th width="100">Order Number</th>
	                <th width="70">Ship Date</th>
	                <th width="150">Item Name</th>
	                <th >Order Qty.</th>
	            </tr>
	        </thead>
	       	<?
				$sql = "SELECT a.job_no_mst, a.po_number as po_number,a.pub_shipment_date as pub_shipment_date,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,b.total_set_qnty as set_item_ratio,c.item_number_id, sum(c.order_quantity) as po_quantity
						from wo_po_break_down a, wo_po_details_master b, wo_po_color_size_breakdown c
						where a.job_no_mst=b.job_no and a.id=c.po_break_down_id and b.job_no='$job_no' and a.id in($po_break_down_id) and c.color_number_id='$color_id' and a.status_active in(1,2,3) and a.is_deleted=0 and b.status_active=1 and c.status_active in(1,2,3) and b.is_deleted=0
						group by a.job_no_mst, a.po_number,a.pub_shipment_date,a.pub_shipment_date,a.packing,b.set_break_down, b.company_name, b.order_uom, b.buyer_name, b.style_ref_no,b.total_set_qnty,c.item_number_id";
				//echo $sql;die;
				$resultRow=sql_select($sql);

				$cons_embr=return_field_value("sum(cons_dzn_gmts) as cons_dzn_gmts","wo_pre_cost_embe_cost_dtls","job_no='$job_no' and status_active=1 and is_deleted=0","cons_dzn_gmts");

	 		?>
	        <tbody>
	        	<?
	        	foreach ($resultRow as $key => $row)
	        	{
	        	?>
	        	<tr>
	                <td><p><? echo $buyer_short_library[$row[csf("buyer_name")]]; ?></p></td>
	                <td><p><? echo $job_no; ?></p></td>
	                <td><p><? echo $row[csf("style_ref_no")]; ?></p></td>
	                <td><p><? echo implode(",",array_unique(explode(",",$row[csf("po_number")]))); ?></p></td>
	                <td align="center"><? echo change_date_format($row[csf("pub_shipment_date")]); ?></td>
	                <td><? echo $garments_item[$row[csf('item_number_id')]]; ?></td>
	                <td align="right"><? echo $row[csf("po_quantity")]*$row[csf("set_item_ratio")]; ?></td>
	            </tr>
	            <?
	        	}
				$prod_sewing_sql=sql_select("SELECT sum(alter_qnty) as alter_qnty, sum(reject_qnty) as reject_qnty from pro_garments_production_mst where production_type=5 and po_break_down_id in($po_break_down_id) and is_deleted=0 and status_active=1");
				foreach ($prod_sewing_sql as $key => $val) {

				?>
	            <tr>
	                <td colspan="2">Total Alter Sewing Qty : <b><? echo $val[csf("alter_qnty")]; ?></b></td>
	                <td colspan="2">Total Reject Sewing Qty : <b><? echo  $val[csf("reject_qnty")]; ?></b></td>
	                <td colspan="2">Pack Assortment: <b><? //echo $packing[$resultRow[csf("packing")]]; ?></b></td>
	            </tr>
	            <?
	        	}
	            ?>
	        </tbody>
	    </table>
	    <?

		  $size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
		  //$color_library_sql;
		  if($country_id>0) $contry_cond=" and country_id='$country_id'"; else $contry_cond="";

		  $count = count($size_library);
		  $width= $count*70+350;

		?>
	    <table id="tblDtls_id" class="rpt_table" width="<? echo $width; ?>" border="1" rules="all" >
		 	<thead>
	        	<tr>
	            	<th width="100">Color Name</th>
	                <th width="170">Production Type</th>
	 				<?
					foreach($size_library as $val)
					{
					 	?><th width="80"><? echo $size_Arr_library[$val]; ?></th><?
					}
					?>
	     		    <th width="60">Total</th>
	           </tr>
	        </thead>
	        <?
			  foreach($color_library as $colorId=>$totalorderqnty)
			  {
				  if($color_variable_setting==2 || $color_variable_setting==3) $row_span=17; else $row_span=16;
				?>
				<tr>

					<td rowspan="<? echo $row_span; ?>"><? echo $color_Arr_library[$color_id]; ?></td>

	 			<?

	 					$bgcolor1="#E9F3FF";
						$bgcolor2="#FFFFFF";
					?>
						</tr>

	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                        <td><b>Order Quantity</b></td>
	                        <?
	                        foreach($size_library as $sizeId=>$sizeRes)
	                        {
	                        ?>
	                            <td><? echo $dataQty[$colorId][$sizeId][1]; ?></td>
	                        <?
	                        }
	                        ?>
	                        <td><? echo $totalorderqnty; ?></td>
	                    </tr>

	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                        <td><b>Plan To Cut (AVG <? echo number_format($dataQty[$colorId][$sizeId][3]/$dataQty[$colorId][$sizeId][4],2); ?>)% </b></td>
	                        <?
	                        foreach($size_library as $sizeId=>$sizeRes)
	                        {
	                        ?>
	                            <td title="Excess Cut <? echo $dataQty[$colorId][$sizeId][3]; ?>%"><? echo $dataQty[$colorId][$sizeId][2]; ?></td>
	                        <?
	                        }
	                        ?>
	                        <td><? echo $color_library_plan[$colorId]; ?></td>
	                    </tr>
						<?
	 				$total_cutting=0;$total_sew_in=0;$total_sew_out=0;$total_fin_in=0;$total_fin_out=0;$total_iron_out=0; $total_exfact_qnty=0;
					$total_print_issue=0;$total_print_rcv=0;$total_embro_issue=0;$total_embro_rcv=0; $total_sp_issue=0;$total_sp_rcv=0; $total_wash_issue=0;$total_wash_rcv=0;
					$cutting_html='';$sewin_html='';$sewout_html='';$finisin_html='';$finisout_html='';$iron_html=''; $exfact_html='';
					$printiss_html=''; $printrcv_html=''; $embroiss_html=''; $embrorcv_html=''; $spiss_html=''; $sprcv_html=''; $washiss_html=''; $washrcv_html='';
					foreach($size_library as $sizeId=>$sizeRes)
					{
						$cutting_qnty=$prod_color_size_data[$colorId][$sizeId]['cutting_qnty'];
						$printing_qnty=$prod_color_size_data[$colorId][$sizeId]['printing_qnty'];
						$printreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['printreceived_qnty'];
						$emb_qnty=$prod_color_size_data[$colorId][$sizeId]['emb_qnty'];
						$embreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['embreceived_qnty'];
						$wash_qnty=$prod_color_size_data[$colorId][$sizeId]['wash_qnty'];
						$washreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['washreceived_qnty'];
						$sp_qnty=$prod_color_size_data[$colorId][$sizeId]['sp_qnty'];
						$spreceived_qnty=$prod_color_size_data[$colorId][$sizeId]['spreceived_qnty'];
						$sewingin_qnty=$prod_color_size_data[$colorId][$sizeId]['sewingin_qnty'];
						$sewingout_qnty=$prod_color_size_data[$colorId][$sizeId]['sewingout_qnty'];
						$finishin_qnty=$prod_color_size_data[$colorId][$sizeId]['finishin_qnty'];
						$iron_qnty=$prod_color_size_data[$colorId][$sizeId]['iron_qnty'];
						$finish_qnty=$prod_color_size_data[$colorId][$sizeId]['finish_qnty'];

						$resRow[csf($col)]=$dataQty[$colorId][$sizeId][2];
	                    if($cutting_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($cutting_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($cutting_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						$cutting_html .='<td '.$bgCol.'>'.$cutting_qnty.'</td>';
	                    $total_cutting+=$cutting_qnty;

						if($cons_embr>0)
						{
							if($printing_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($printing_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($printing_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $printiss_html .='<td '.$bgCol.'>'.$printing_qnty.'</td>';
	                    $total_print_issue+=$printing_qnty;

						if($cons_embr>0)
						{
							if($printreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($printreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($printreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $printrcv_html .='<td '.$bgCol.'>'.$printreceived_qnty.'</td>';
	                    $total_print_rcv+=$printreceived_qnty;

						if($cons_embr>0)
						{
							if($emb_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($emb_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($emb_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $embroiss_html .='<td '.$bgCol.'>'.$emb_qnty.'</td>';
	                    $total_embro_issue+=$emb_qnty;

						if($cons_embr>0)
						{
							if($embreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($embreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($embreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $embrorcv_html .='<td '.$bgCol.'>'.$embreceived_qnty.'</td>';
	                    $total_embro_rcv+=$embreceived_qnty;

						if($cons_embr>0)
						{
							if($sp_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($sp_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($sp_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $spiss_html .='<td '.$bgCol.'>'.$sp_qnty.'</td>';
	                    $total_sp_issue+=$sp_qnty;

						if($cons_embr>0)
						{
							if($spreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($spreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($spreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $sprcv_html .='<td '.$bgCol.'>'.$spreceived_qnty.'</td>';
	                    $total_sp_rcv+=$spreceived_qnty;

						if($cons_embr>0)
						{
							if($wash_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($wash_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($wash_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';
	                    $washiss_html .='<td '.$bgCol.'>'.$wash_qnty.'</td>';
	                    $total_wash_issue+=$wash_qnty;

						if($cons_embr>0)
						{
							if($washreceived_qnty==0)$bgCol="bgcolor='#FF0000'";
							else if($washreceived_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
							else if($washreceived_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						}
						else $bgCol='';

	                    $washrcv_html .='<td '.$bgCol.'>'.$washreceived_qnty.'</td>';
	                    $total_wash_rcv+=$washreceived_qnty;

						if($sewingin_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($sewingin_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($sewingin_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewin_html .='<td '.$bgCol.'>'.$sewingin_qnty.'</td>';
	                    $total_sew_in+=$sewingin_qnty;

						if($sewingout_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($sewingout_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($sewingout_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $sewout_html .='<td '.$bgCol.'>'.$sewingout_qnty.'</td>';
	                    $total_sew_out+=$sewingout_qnty;

						/*if($prodRow[csf("finishin_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						else if($prodRow[csf("finishin_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($prodRow[csf("finishin_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisin_html .='<td '.$bgCol.'>'.$prodRow[csf("finishin_qnty")].'</td>';
	                    $total_fin_in+=$prodRow[csf("finishin_qnty")];*/

						if($finish_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($finish_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($finish_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $finisout_html .='<td '.$bgCol.'>'.$finish_qnty.'</td>';
	                    $total_fin_out+=$finish_qnty;

						if($iron_qnty==0)$bgCol="bgcolor='#FF0000'";
						else if($iron_qnty < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						else if($iron_qnty >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
	                    $iron_html .='<td '.$bgCol.'>'.$iron_qnty.'</td>';
	                    $total_iron_out+=$iron_qnty;

						//if($prodRow[csf("iron_qnty")]==0)$bgCol="bgcolor='#FF0000'";
						//else if($prodRow[csf("iron_qnty")] < $resRow[csf($col)]) $bgCol="bgcolor='#FFFF00'";
						//else if($prodRow[csf("iron_qnty")] >= $resRow[csf($col)]) $bgCol="bgcolor='#00FF00'";
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							$bgCol=="bgcolor='#FFFFFF'";
							$exfact_html.='<td>'.$ex_fact_qty_arr[$colorId][$sizeId].'&nbsp;</td>';

							$total_exfact_qnty+=$ex_fact_qty_arr[$colorId][$sizeId];
						}


					}// end size foreach loop

					?>
						<tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Cutting</b></td>
	                        <? echo $cutting_html; ?>
	                        <td><? echo $total_cutting; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Print Issue</b></td>
	                        <? echo $printiss_html; ?>
	                        <td><? echo $total_print_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Print Received</b></td>
	                        <? echo $printrcv_html; ?>
	                        <td><? echo $total_print_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Embro Issue</b></td>
	                        <? echo $embroiss_html; ?>
	                        <td><? echo $total_embro_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Embro Received</b></td>
	                        <? echo $embrorcv_html; ?>
	                        <td><? echo $total_embro_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Special Works</b></td>
	                        <? echo $spiss_html; ?>
	                        <td><? echo $total_sp_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Special Works</b></td>
	                        <? echo $sprcv_html; ?>
	                        <td><? echo $total_sp_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Sewing Input</b></td>
	                       <? echo $sewin_html; ?>
	                        <td><? echo $total_sew_in; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Sewing Output</b></td>
	                        <? echo $sewout_html; ?>
	                        <td><? echo $total_sew_out; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Issue For Wash</b></td>
	                        <? echo $washiss_html; ?>
	                        <td><? echo $total_wash_issue; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Recv. From Wash</b></td>
	                        <? echo $washrcv_html; ?>
	                        <td><? echo $total_wash_rcv; ?></td>
	                    </tr>
	                    <tr bgcolor="<? echo $bgcolor2; ?>">
	                    	<td><b>Iron Output</b></td>
	                        <? echo $iron_html; ?>
	                        <td><? echo $total_iron_out; ?></td>
	                    </tr>
	                   <tr bgcolor="<? echo $bgcolor1; ?>">
	                    	<td><b>Finishing Output</b></td>
	                       <? echo $finisout_html; ?>
	                        <td><? echo $total_fin_out; ?></td>
	                    </tr>
	                    <?
						if($color_variable_setting==2 || $color_variable_setting==3)
						{
							?>
							<tr>
								<td><b>Ex-Factory Qty.</b></td>
								 <? echo $exfact_html; ?>
								<td><? echo $total_exfact_qnty; ?>&nbsp;</td>
							</tr>
							<?
						}
						?>
				<?
				}// end color foreach loop
				?>


	 </table>
	</div>


	<?
	exit();

}


if ($action=="JobColorProdPopup")
{

	extract($_REQUEST);
 	echo load_html_head_contents("Popup Info","../../../", 1, 1, $unicode,'','');
	// echo $po_no;
	$company_name=str_replace("'","",$company_name);
	$color_id=str_replace("'","",$color_id);
	// $prod_type=str_replace("'","",$prod_type);
	$po_break_down_id = $po_no;
    $prod_popup_type=str_replace("'","",$prod_popup_type);
	$prod_popup_lelel=str_replace("'","",$prod_popup_lelel);
	$prod_popup_lelel_arr=explode('*',$prod_popup_lelel);
	$prod_popup_lelel_type=$prod_popup_lelel_arr[0];  // source (inhouse / subcon)
	$prod_popup_lelel_cat=$prod_popup_lelel_arr[1]; // embel name

	if($db_type==0) $rmg_process_breakdown=return_field_value("a.rmg_process_breakdown as rmg_process_breakdown"," wo_booking_mst a, wo_booking_dtls b","a.booking_no=b.booking_no and  b.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc limit 1","rmg_process_breakdown");
	else if($db_type==2) $rmg_process_breakdown=return_field_value("rmg_process_breakdown"," (select a.id, a.rmg_process_breakdown  from wo_booking_mst a, wo_booking_dtls b where a.booking_no=b.booking_no and b.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 order by a.id asc)","ROWNUM = 1","rmg_process_breakdown");
	// print_r($rmg_process_breakdown);
	if($rmg_process_breakdown!="")
	{
		$rmg_process_breakdown_arr=explode("_",$rmg_process_breakdown);
		//var_dump($rmg_process_breakdown_arr);die;
		$cut_panel_rejection=$rmg_process_breakdown_arr[8];
		$chest_printing=$rmg_process_breakdown_arr[2];
		$neck_sleeve_printing=$rmg_process_breakdown_arr[10];
		$embroidery=$rmg_process_breakdown_arr[1];
		$sewing_input=$rmg_process_breakdown_arr[4];
		$garments_wash=$rmg_process_breakdown_arr[3];
		$gmts_finishing=$rmg_process_breakdown_arr[15];
	}


	$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name");
	$size_Arr_library=return_library_array( "select id,size_name from lib_size", "id", "size_name" );
	$sizearr_order=return_library_array("select size_number_id,size_number_id from wo_po_color_size_breakdown where job_no_mst='$job_no' and color_number_id=$color_id order by size_order","size_number_id","size_number_id");
	$line_Arr_library=return_library_array( "select id,line_name from lib_sewing_line where  is_deleted=0 and status_active=1", "id", "line_name" );
	$resource_alocate_line = return_library_array("select id, line_number from prod_resource_mst", "id", "line_number");
	// print_r($sizearr_order);
	$sql_order_size= sql_select("SELECT c.size_number_id, c.order_quantity as order_quantity, c.plan_cut_qnty as plan_cut_qnty
		from wo_po_color_size_breakdown c
		where c.status_active=1 and c.is_deleted=0 and c.job_no_mst='$job_no' and c.color_number_id=$color_id
		 order by c.size_order");
	// print_r($sql_order_size);
	foreach($sql_order_size as $row)
	{
		$order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('order_quantity')];
		$plan_order_size_qnty[$row[csf('size_number_id')]] +=$row[csf('plan_cut_qnty')];
	}

	$color_size_sql=sql_select( "SELECT a.job_no_mst as job_no,a.id, a.color_number_id, a.size_number_id from wo_po_color_size_breakdown a where   a.color_number_id>0 and a.size_number_id>0 and a.job_no_mst='$job_no' and a.color_number_id=$color_id order by a.color_order");
	$color_size_data=array(); $allcolor_id_arr=array();
	foreach($color_size_sql as $row)
	{
		$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["color_number_id"]=$row[csf("color_number_id")];
		$color_size_data[$row[csf("id")]]["size_number_id"]=$row[csf("size_number_id")];
	}
	// print_r($color_size_data);
	$sql_supplier=sql_select("select id,supplier_name from lib_supplier where status_active =1 and is_deleted=0 order by supplier_name");
	$supplier_arr=array();
	foreach($sql_supplier as $row)
	{
		$supplier_arr[$row[csf('id')]]=$row[csf('supplier_name')];
	}

	//echo "<pre>";
	//print_r($color_size_data); die;



 		if($prod_popup_type==10)
		{
			$serving_company_id = array();
			$sql = "SELECT serving_company FROM pro_garments_production_mst  WHERE po_break_down_id in($po_break_down_id)  group by serving_company";
			$sql_res = sql_select($sql);
			// echo $sql_res[0][csf('serving_company')];
			$sql_colsiz="SELECT b.color_size_break_down_id,d.color_number_id,d.size_number_id,
			sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
			from pro_ex_factory_mst a,  pro_ex_factory_dtls b, wo_po_break_down c ,wo_po_color_size_breakdown d
			where a.id=b.mst_id and a.po_break_down_id in($po_break_down_id) and d.color_number_id=$color_id  and c.id=d.po_break_down_id and d.id=b.color_size_break_down_id and a.po_break_down_id = c.id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  and c.status_active in(1,2,3) and d.status_active in(1,2,3) and d.is_deleted=0  group by b.color_size_break_down_id,d.color_number_id,d.size_number_id";

			$ex_fac_level=sql_select("select ex_factory  from variable_settings_production where company_name in(select a.company_name from  wo_po_details_master a,wo_po_break_down b where a.job_no=b.job_no_mst and a.job_no='$job_no' and b.status_active in(1,2,3)) and variable_list=1");
			if($ex_fac_level[0][csf("ex_factory")]==1)
			{
				$sql_colsiz="SELECT
				sum(CASE WHEN entry_form!=85 THEN  ex_factory_qnty ELSE 0 END)-sum(CASE WHEN entry_form=85 THEN  ex_factory_qnty ELSE 0 END) as production_qnty
				from pro_ex_factory_mst
				where po_break_down_id in($po_break_down_id) and status_active=1 and is_deleted=0";
			}
		}
		else if($prod_popup_type==11)
		{
			$sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as production_qnty,a.serving_company,a.sewing_line
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_color_size_breakdown e
			where a.id=b.mst_id    and e.id=b.color_size_break_down_id    and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type'  and a.po_break_down_id in($po_break_down_id) and e.color_number_id=$color_id and a.production_source=$prod_popup_lelel_type and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and e.status_active=1 and e.is_deleted=0 group by e.color_number_id,e.size_number_id , b.color_size_break_down_id,a.serving_company,a.sewing_line order by a.serving_company";
		}
		else if($prod_popup_type==17)
		{
  			$sql_colsiz="SELECT b.color_id  as color_number_id,c.size_id as size_number_id ,sum(c.size_qty ) as production_qnty,a.working_company_id as serving_company  from ppl_cut_lay_mst a ,ppl_cut_lay_dtls b,ppl_cut_lay_bundle c where a.id=b.mst_id and a.id=c.mst_id and b.id=c.dtls_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and    c.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and a.job_no='$job_no' and b.color_id=$color_id and (c.order_id in($po_break_down_id) or b.order_id in($po_break_down_id))  group by b.color_id,c.size_id,a.working_company_id order by a.working_company_id";


			foreach(sql_select($sql_colsiz) as $vals)
			{
				$col_size_wise_lay[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];
				if($vals[csf("serving_company")])
				{
					$col_size_wise_lay_company[$vals[csf("color_number_id")]][$vals[csf("size_number_id")]] =$vals[csf("serving_company")];

					$allcolor_id_arr_dtls[$vals[csf("serving_company")]][$vals[csf("color_number_id")]]=$vals[csf("color_number_id")];
					$col_size_wise_lay_company_qnty[$vals[csf("serving_company")]][$vals[csf("color_number_id")]][$vals[csf("size_number_id")]]+=$vals[csf("production_qnty")];

				}


			}
		}
  		else if($prod_popup_type==7)
		{
			$sql_colsiz="SELECT e.color_number_id,e.size_number_id ,b.color_size_break_down_id, sum(b.production_qnty) as
			production_qnty,a.serving_company
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.job_no=e.job_no_mst and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id and c.job_no='$job_no'  and a.production_type='$prod_popup_type' and b.production_type='$prod_popup_type' and a.po_break_down_id in($po_break_down_id) and a.color_number_id=$color_id $prod_print_cond $prod_sourceCond $country_cond and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by e.color_number_id,e.size_number_id ,b.color_size_break_down_id,a.serving_company order by a.serving_company";
		}
  		else if($prod_popup_type==6)
		{
			$sql_colsiz="SELECT e.color_number_id,c.job_no, sum(b.reject_qty) as production_qnty,a.serving_company,a.sewing_line,b.color_size_break_down_id
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.job_no=e.job_no_mst and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type in(1,3,5,7,8,11) and b.production_type in(1,3,5,7,8,11) and a.po_break_down_id in($po_break_down_id) and e.color_number_id=$color_id and c.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by e.color_number_id,c.job_no,a.serving_company,a.sewing_line,b.color_size_break_down_id order by a.serving_company";
		}
		else
		{
			$embel_con = "";
			$source_cond = "";
			if($prod_popup_type==2 && $prod_popup_lelel_type !="" || $prod_popup_type==3 && $prod_popup_lelel_type !="" || $prod_popup_type==4 && $prod_popup_lelel_type !="" || $prod_popup_type==5 && $prod_popup_lelel_type !="")
				{ $source_cond = "and a.production_source=$prod_popup_lelel_type";}
			if($prod_popup_type==2 || $prod_popup_type==3){$embel_con=" and a.embel_name=$prod_popup_lelel_cat";}
			// $source_cond = ($prod_popup_type==1 && $prod_popup_lelel_type !="") ? "" : "and a.production_source=$prod_popup_lelel_type";
			$sql_colsiz="SELECT e.color_number_id,c.job_no, sum(b.production_qnty) as production_qnty,b.color_size_break_down_id,a.serving_company,a.sewing_line
			from pro_garments_production_mst a, pro_garments_production_dtls b ,wo_po_details_master c,wo_po_color_size_breakdown e
			where a.id=b.mst_id  and c.job_no=e.job_no_mst and e.id=b.color_size_break_down_id and a.po_break_down_id=e.po_break_down_id  and a.production_type='$prod_popup_type' $source_cond $embel_con and b.production_type='$prod_popup_type' and a.po_break_down_id in($po_break_down_id) and e.color_number_id=$color_id and c.job_no='$job_no' and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 and e.status_active=1 and e.is_deleted=0  group by b.color_size_break_down_id,e.color_number_id,c.job_no,a.serving_company,a.sewing_line order by a.serving_company";
		}
		//echo $sql_colsiz;
		$sql_color_size=sql_select($sql_colsiz);
		// print_r($sql_color_size);
		$prod_color_size_data=array();
		$prod_color_size_data_working_comp=array();
		$color_size_working_comp=array();
		$color_size_sewingLine=array();
		// print_r($sql_color_size);die();
		foreach($sql_color_size as $row)
		{
			if($prod_popup_type==11)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["size_number_id"]=$row[csf("size_number_id")];
				//$color_size_data[$row[csf("color_size_break_down_id")]]["serving_company"]=$row[csf("serving_company")];
				//$col_size_wise_company_arr[$row[csf("serving_company")]] =$row[csf("serving_company")];
			}
			if($prod_popup_type==10)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["size_number_id"]=$row[csf("size_number_id")];
			}
			if($prod_popup_type==7)
			{
				$allcolor_id_arr[$row[csf("color_number_id")]]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["color_number_id"]=$row[csf("color_number_id")];
				$color_size_data[$row[csf("job_no")]]["size_number_id"]=$row[csf("size_number_id")];
			}
			$allcolor_id_arr_dtls[$row[csf("serving_company")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]]["color"]=$row[csf("color_number_id")];
			// print_r($allcolor_id_arr_dtls);
			if($color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=="")
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"]=$row[csf("sewing_line")];
			}
			else
			{
				$color_size_sewingLine[$row[csf("serving_company")]]["sewing_line"].=','.$row[csf("sewing_line")];
			}

			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
			$prod_color_size_data_working_comp[$row[csf("serving_company")]][$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["qty"]+=$row[csf('production_qnty')];
		}
		//print_r($color_size_sewingLine);
		//echo $prod_popup_type;
		if($prod_popup_type==8)
        {

			$transfer_info_sql="SELECT c.job_no_mst as job_no, c.po_break_down_id as po_id,c.color_number_id as colors ,sum( case when a.trans_type=5 and  b.trans_type=5  then b.production_qnty else 0 end) as transfer_in ,sum( case when a.trans_type=6 and  b.trans_type=6  then b.production_qnty else 0 end) as transfer_out,a.serving_company,a.sewing_line from pro_garments_production_mst a,pro_garments_production_dtls b,wo_po_color_size_breakdown c where a.id=b.mst_id and b.color_size_break_down_id=c.id and   a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0   and a.production_type=10 and b.production_type=10 and a.trans_type in(5,6)  and b.trans_type in(5,6) and a.po_break_down_id in($po_break_down_id) and c.color_number_id=$color_id group by c.job_no_mst, c.po_break_down_id  ,c.color_number_id,a.serving_company,a.sewing_line order by a.serving_company";
			// echo $transfer_info_sql;
			$transfer_info=sql_select($transfer_info_sql);
			foreach($transfer_info as $trans_val)
			{
				$transfer_info_arr[$trans_val[csf("job_no")]][$trans_val[csf("colors")]]['transfer_in']+=$trans_val[csf("transfer_in")];
				$transfer_info_arr[$trans_val[csf("job_no")]][$trans_val[csf("colors")]]['transfer_out']+=$trans_val[csf("transfer_out")];
			}
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <div id="exc"></div>
        </div>

		<? ob_start(); ?>
        <div style="width:<? echo $table_width+200; ?>px" align="left" id="details_reports">
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
            	<tr>
                	<th width colspan="2"></th>
                    <th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
                    <th colspan="<? if($prod_popup_type==8){echo "3";} ?>"></th>
                </tr>
                <tr>

                	<th width="30" >SL</th>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    if($prod_popup_type==8)
                    {
                    	?>
                    	<th width="100" >Transfer In</th>
                    	<th width="100" >Transfer Out</th>

                    	<?
                    }
                    ?>

                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? $sl=1; $sub_total_prod_poly_qntyy=array(); $sub_totals=0;
            	foreach($allcolor_id_arr as $inc=>$color_id_val)
            	{
            		if($color_id_val)
            		{
		            	?>
		                <tr>
		                 	<td align="center" valign="middle"><? echo $sl; ?></td>
		                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
		                    <?
							$total_prod_poly_qnty=0;
		                    foreach($sizearr_order as $size_id)
		                    {
		                    	if($prod_popup_type==17)
		                    	{
									$sub_total_prod_poly_qntyy[$size_id]+=$col_size_wise_lay[$color_id_val][$size_id];
									 ?>
		                    		<td align="right"><? echo number_format($col_size_wise_lay[$color_id_val][$size_id],0); $total_prod_poly_qnty+=$col_size_wise_lay[$color_id_val][$size_id] ; ?></td>
		                    		<?
		                		}
		                    	else
		                    	{
									$sub_total_prod_poly_qntyy[$size_id]+=$prod_color_size_data[$color_id_val][$size_id]["qty"];
		                        	?>
		                        	<td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["qty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["qty"]; ?></td>
		                        	<?
		                    	}
		                    }
		                    if($prod_popup_type==8)
		                    {
			                    ?>
			                    <td align="right"><? $trans_in=$transfer_info_arr[$job_no][$inc]['transfer_in']; echo number_format($trans_in,0); ?></td>
			                    <td align="right"><? $trans_out=$transfer_info_arr[$job_no][$inc]['transfer_out']; echo number_format($trans_out,0); ?></td>
			                    <?
		                	}
		               		?>
		                    <td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,0); ?></td>
		                </tr>
		                <? $sub_totals+=$totals; $sl++;
          		    }
                }
                ?>
            </tbody>
             <tfoot>
            	<td align="right" colspan="2"><b>Total</b></td>
                <?
				foreach($sizearr_order as $size_id)
				{
				?>
					<td align="right"><? echo $sub_total_prod_poly_qntyy[$size_id]; ?></td>
				<?
				}
				if($prod_popup_type==8){
				?>
					<td colspan="2"></td>
				<?
				}
                ?>
                <td align="right"> <? echo $sub_totals; ?></td>
            </tfoot>
		</table>
    	</div>
        <div style="width:<? echo $table_width+200; ?>px" align="center" id="details_reports">
        <?
			$lineArr = return_library_array("select id,line_name from lib_sewing_line","id","line_name");
			$prod_reso_arr=return_library_array( "select id, line_number from prod_resource_mst",'id','line_number');
			$prod_reso_allocation=array();
		    $nameArray = sql_select("select id, auto_update,company_name from variable_settings_production where variable_list=23 and status_active=1 and is_deleted=0");
			foreach($nameArray as $nameArrayRow)
			{
				$prod_reso_allocation[$nameArrayRow[csf('company_name')]]["auto_update"]= $nameArrayRow[csf('auto_update')];
			}
		   // $prod_reso_allocation = $nameArray[0][csf('auto_update')];
		?>
        <strong>Details</strong>
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width+200; ?>">
            <thead>
            	<tr>
                	<th width colspan="<?  if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){ echo "4"; }else{echo "3";} ?>"></th>
                    <th width colspan="<?  echo  count($sizearr_order); ?>">Size</th>
                    <th colspan="<? if($prod_popup_type==8){echo "3";} ?>"></th>
                </tr>
                <tr>
                	<th width="30" >SL</th>
                  	<th width="200" >Working Company</th>
                    <?
                    if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
                    {
                    	?>
                    	<th width="100" >Line</th>
                    	<?
                    }
					?>
                    <th width="100" >Color Name</th> <!--$prod_popup_type-->
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    if($prod_popup_type==8)
                    {
                    	?>
                    	<th width="100" >Transfer In</th>
                    	<th width="100" >Transfer Out</th>

                    	<?
                    }
                    ?>

                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<?
            	$sl=1;
            	$sub_total_prod_poly_qnty=array();
            	$sub_totals=0;
            	$po_company=sql_select("SELECT a.company_name from wo_po_details_master a,wo_po_break_down b where a.job_no=b.job_no_mst and a.job_no='$job_no' and b.id in($po_break_down_id) and a.status_active=1 and b.status_active in(1,2,3)");
            	// echo "<pre>";
            	// print_r($allcolor_id_arr_dtls);
				//foreach($col_size_wise_company_arr as $dataRow){
				foreach($allcolor_id_arr_dtls as $company=>$company_data)
				{
				   	foreach($company_data as $colors=>$val)
				   	{
				   		if($colors)
				   		{
							?>
			                <tr>
			                	<td align="center" valign="middle"><? echo $sl; ?></td>
			                    <td align="center" valign="middle"><? if($company_library[$company]) echo $company_library[$company];  else echo $supplier_arr[$company ];
			                    if($prod_popup_type==10){ echo $company_library[$sql_res[0][csf('serving_company')]]; }

								?></td>
			                    <?
			                    if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11)
			                    {
			                    	?>
			                    	 <td align="center" valign="middle"><?
									if($prod_reso_allocation[$po_company[0][csf("company_name")]]["auto_update"]==1)
									{
										$serving_company_lines=explode(",",$color_size_sewingLine[$company]["sewing_line"]);
										$sewing_line_name = "";
										$line_duplicate_arr=array();
										foreach($serving_company_lines as $lines_id)
										{
											$sewing_line =  $resource_alocate_line[$lines_id];
											$sewing_line_arr = explode(",", $sewing_line);

											foreach ($sewing_line_arr as $line_id)
											{
												if($line_duplicate_arr[$line_id]=="")
												{
													$sewing_line_name.=$lineArr[$line_id]." ,";
													$line_duplicate_arr[$line_id]=$line_id;
												}
											}
										}
										$sewing_line_name = chop($sewing_line_name, ",");
										echo $sewing_line_name;

									}
									else
									{
										$sewing_line =  $color_size_sewingLine[$company]["sewing_line"];
										foreach(explode(",", $sewing_line) as $key=>$value)
										{
											$sewing_line_name.=$lineArr[$value]." ,";
										}
											$sewing_line_name = chop($sewing_line_name, ",");
									   		echo $sewing_line_name;
									}
									 ?></td>
			                    	<?
			                    }
								?>
			                    <td align="center" valign="middle"><? echo $color_Arr_library[$colors]; ?></td>
			                    <?
								$total_prod_poly_qnty=0;
			                    foreach($sizearr_order as $size_id)
			                    {

			                    	if($prod_popup_type==17)
			                    	{
										$sub_total_prod_poly_qnty[$size_id]+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
										?>
				                    	<td align="right"><?
										echo number_format($col_size_wise_lay_company_qnty[$company][$colors][$size_id],0);$total_prod_poly_qnty+=$col_size_wise_lay_company_qnty[$company][$colors][$size_id];
										?></td>

			                    		<?
			                    	}
			                    	else
			                    	{
										$sub_total_prod_poly_qnty[$size_id]+=$prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"];
				                        ?>
				                        <td align="right"><? echo number_format($prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"],0); $total_prod_poly_qnty+=$prod_color_size_data_working_comp[$company][$colors][$size_id]["qty"]; ?></td>
				                        <?
			                    	}
			                    }
			                    if($prod_popup_type==8)
			                    {
				                    ?>
				                    <td align="right"><? $trans_in=$transfer_info_arr[$po_break_down_id][$colors]['transfer_in']; echo number_format($trans_in,0); ?></td>
				                    <td align="right"><? $trans_out=$transfer_info_arr[$po_break_down_id][$colors]['transfer_out']; echo number_format($trans_out,0); ?></td>
				                    <?
			                	}
			               		?>
			                    <td align="right"><? $totals=$total_prod_poly_qnty+ $trans_in-$trans_out;echo number_format($totals,0); ?></td>
			                </tr>
			                <?
			                $sub_totals+=$totals; $sl++;
		               	}
					}
				}
				?>
            </tbody>
            <tfoot>
            	<td align="right" colspan=" <? if($prod_popup_type==4 || $prod_popup_type==5 || $prod_popup_type==11){echo "4";}else{echo "3";} ?>"><b>Total</b></td>
                <?
				foreach($sizearr_order as $size_id)
				{
				?>
					<td align="right"><? echo $sub_total_prod_poly_qnty[$size_id]; ?></td>
				<?
				}
				if($prod_popup_type==8){
				?>
					<td colspan="2"></td>
				<?
				}
                ?>
                <td align="right"> <? echo $sub_totals; ?></td>
            </tfoot>
		</table>
    	</div>
    	</div>
		<?

		foreach (glob("$user_id*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		$filename=$user_id."_".$name.".xls";
		//echo "$total_data####$filename####$reportType";
		$filename=$filename;

		?>
		<script>
            document.getElementById('exc').innerHTML='<input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />&nbsp;<a href="<? echo $filename;?>" style="text-decoration:none"><input type="button" value="Excel Preview" name="excel" id="excel" class="formbutton" style="width:100px"/></a>';
		</script>

		<?
		die;

	if($prod_popup_type==1 && $prod_popup_lelel_type==1) //for cutting
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0
		group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));


		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name1</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="4" align="center" valign="middle" ><? echo $color_Arr_library[$color_id]; ?></td>
                        <td >Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Qty.</td>
                        <?
						$total_color_size_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" ><? echo number_format($prod_color_size_data[$size_id],0); $total_color_size_qnty+=$prod_color_size_data[$size_id];  ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_color_size_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Cutting Balance.</td>
                        <?
						$total_cut_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right" title="Cutting Qty-Plan Cut Qty."><? $cut_balance=($plan_order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($cut_balance,0); $total_cut_balance+=$cut_balance; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_cut_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
            <br />
    	</div>
    	<?

	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==1) //for emb print inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source=1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>

                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==1 && $prod_popup_lelel_cat==2) //for emb print subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=1 and a.production_source<>1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel"  style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty+=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Qty.</td>
                        <?
						$total_print_sent_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_print_sent_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Sent Balance</td>
                        <?
						$total_print_sent_balence=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$cut_panel_rejection)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balence+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balence,0); ?></td>
                    </tr>
                </tbody>
            </table>
    	</div>
    	<?


	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==1) //for emb print inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source=1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==1  && $prod_popup_lelel_cat==2) //for emb print subcontract receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=1  and a.production_source<>1 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                        <th width="100" >Color Name</th>
                        <th width="100">Production Type</th>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                            <?
                        }
                        ?>
                        <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
						$total_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Plan Qty.</td>
                        <?
						$total_print_sent_plan_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
                            $print_sent_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_sent_plan_cut,0); $total_print_sent_plan_qnty +=$print_sent_plan_cut;
                            ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Received Qty.</td>
                        <?
						$total_prod_print_rcv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+= $prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Print Rcvd. Balance</td>
                        <?
						$total_print_sent_balance=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_print_sent_balance+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_print_sent_balance,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==2  && $prod_popup_lelel_cat==2) //for emb ebroidery subcontract issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>

                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    $total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Emb. Sent Plan Qty</td>
                    <?
					$total_plan_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing;
						$print_emb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_emb_plan_cut,0); $total_plan_sent_qnty+=$print_emb_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Received Qty.</td>
                    <?
					$total_prod_print_rcv_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_print_rcv_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_print_rcv_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Print Rcvd. Balance</td>
                    <?
					$total_print_rcv_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_print_rcv_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_print_rcv_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==1) //for emb ebroidery inhouse receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source=1  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==2 && $prod_popup_lelel_cat==2) //for emb ebroidery subcon receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=2 and a.production_source<>1  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] =$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
            <table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
                <thead>
                    <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                        <td>Order Qty.</td>
                        <?
                        $total_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Plan Cut Qty.</td>
                        <?
						$total_plan_ord_qnty=0;
						foreach($sizearr_order as $size_id)
						{
							?>
							<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
							<?
						}
						?>
						<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Plan Qty.</td>
                        <?
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
							$total_rcv_plan_qnty=0;
                            $total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
                            $print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
                            echo number_format($print_enb_plan_cut,0); $total_rcv_plan_qnty+=$print_enb_plan_cut;
                            ?>
                            </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_rcv_plan_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Qty.</td>
                        <?
						$total_pord_recv_qnty=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_pord_recv_qnty+=$prod_color_size_data[$size_id]; ?></td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_pord_recv_qnty,0); ?></td>
                    </tr>
                    <tr>
                        <td>Emb. Rcvd. Balance</td>
                        <?
						$total_emb_balect=0;
                        foreach($sizearr_order as $size_id)
                        {
                            ?>
                            <td align="right">
                            <?
                            $print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
                             echo number_format($print_sent_balence,0); $total_emb_balect+=$print_sent_balence;
                            ?>
                             </td>
                            <?
                        }
                        ?>
                        <td align="right"><? echo number_format($total_emb_balect,0); ?></td>
                    </tr>
                </tbody>
            </table>
        </div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==4) //for emb sp issue
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
		where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=2 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.size_number_id
		order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}
		$table_width=(200+count($table_width)*60);
		?>
		<div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0);?></td>
						<?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Plan Cut Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Plan Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0);
						?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Qty.</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0);?></td>
                        <?
                    }
                    ?>
                </tr>
                <tr>
                    <td>Emb. Rcvd. Balance</td>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=($prod_color_size_data[$size_id]-($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						 echo number_format($print_sent_balence,0);
						?>
                         </td>
                        <?
                    }
                    ?>
                </tr>
            </tbody>
		</table>
		</div>
    	<?*/
	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==4) //for emb sp receive
	{
		/*$sql_color_size= sql_select("SELECT c.size_number_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b,  wo_po_color_size_breakdown c
		where a.id=b.mst_id and b.color_size_break_down_id=c.id  and a.production_type=3 and a.embel_name=4 and c.po_break_down_id=$po_break_down_id and c.item_number_id=$item_id and c.country_id=$country_id and c.color_number_id=$color_id and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0
		group by c.size_number_id
		order by c.size_number_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$row[csf('size_number_id')]] =$row[csf('production_qnty')];
		}*/
	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==1) //for sewing input
	{

		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <th width="100">Production Type</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Plan Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_plan_qnty=0;

                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery);
						$sewing_in_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_in_plan_cut,0); $total_sew_plan_qnty+=$sewing_in_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Input Qty.</td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Input Qty.</td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Input Balance</td>
                    <?
					$total_prod_in_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_in_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_in_balance,0); $total_prod_in_balance+=$total_in_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_in_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==11) //for sewing input inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_inhouse_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_inhouse_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_inhouse_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==4 && $prod_popup_lelel_type==13) //for sewing input subcon
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=4 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                <th width="100" >Color Name</th>
                <?
                foreach($sizearr_order as $size_id)
                {
					?>
					<th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
					<?
                }
                ?>
                <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_production_subcon_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_production_subcon_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_production_subcon_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==1) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="6" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Plan Output Qty.</td>
                    <?
					$sewing_in_plan_cut=$total_sew_out_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=($cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input);
						$sewing_out_plan_cut=($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100));
						echo number_format($sewing_out_plan_cut,0); $total_sew_out_plan_qnty+=$sewing_out_plan_cut;
						?>
                        </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_sew_out_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Inhouse Sewing Output Qty.</td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sub Con. Sewing Output Qty.</td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Sewing Output Balance</td>
                    <?
					$total_out_balance_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_out_balance= ($plan_order_size_qnty[$size_id]-(($plan_order_size_qnty[$size_id]*$total_cut_reject)/100))-($prod_color_size_data[$size_id]["production_subcon_qnty"]+$prod_color_size_data[$size_id]["production_inhouse_qnty"]);
						echo number_format($total_out_balance,0); $total_out_balance_qnty+=$total_out_balance;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_out_balance_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==11) //for emb sewing output Inhouse
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=1 then b.production_qnty else 0 end) as production_inhouse_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_inhouse_qnty"]+=$row[csf('production_inhouse_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_in_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_inhouse_qnty"],0); $total_prod_sew_in_qnty+=$prod_color_size_data[$size_id]["production_inhouse_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_in_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==5 && $prod_popup_lelel_type==13) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(case when a.production_source=3 then b.production_qnty else 0 end) as production_subcon_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=5  and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0  group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["production_subcon_qnty"]+=$row[csf('production_subcon_qnty')];
		}

		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <?
					$total_prod_sew_out_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id]["production_subcon_qnty"],0); $total_prod_sew_out_qnty+=$prod_color_size_data[$size_id]["production_subcon_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sew_out_qnty,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?
	}
	else if($prod_popup_type==2 && $prod_popup_lelel_type==3) //for emb wash issue
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=2 and a.embel_name=3 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Plan Qty</td>
                    <?
					$total_emp_plan_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_emp_plan_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_emp_plan_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent Qty.</td>
                    <?
					$total_prod_sent_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_sent_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_sent_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Sent  Balance</td>
                    <?
					$total_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==3 && $prod_popup_lelel_type==3) //for emb wash receive
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=3 and a.embel_name=3 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
					$total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Plan Qty.</td>
                    <?
					$total_plan_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_wash_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Qty.</td>
                    <?
					$total_prod_wash_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_wash_qnty+=$prod_color_size_data[$size_id]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_wash_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Wash Rcvd. Balance</td>
                    <?
					$taoal_wash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $taoal_wash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($taoal_wash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==7 && $prod_popup_lelel_type==1) //for iron
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=7 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}
		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Plan Qty</td>
                    <?
					$toal_plan_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $toal_plan_iron_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_plan_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Qty.</td>
                    <?
					$total_prod_iron_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_iron_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_iron_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Iron Balance</td>
                    <?
					$total_iron_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $total_iron_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_iron_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?
	}
	else if($prod_popup_type==8 && $prod_popup_lelel_type==1) //for finish
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(b.production_qnty) as production_qnty
		from pro_garments_production_mst a,  pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=8 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="5" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
				</tr>
				<tr>
					<td>Plan Cut Qty.</td>
					<?
					$total_plan_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($plan_order_size_qnty[$size_id],0); $total_plan_ord_qnty+=$plan_order_size_qnty[$size_id]; ?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_plan_ord_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Plan Qty.</td>
                    <?
					$total_plan_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$total_cut_reject=$cut_panel_rejection+$chest_printing+$neck_sleeve_printing+$embroidery+$sewing_input+$garments_wash+$gmts_finishing;
						$print_enb_plan_cut=$plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100;
						echo number_format($print_enb_plan_cut,0); $total_plan_finish_qnty+=$print_enb_plan_cut;
						?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_plan_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton Qty.</td>
                    <?
					$total_prod_finish_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format( $prod_color_size_data[$size_id],0); $total_prod_finish_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_finish_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Packing/Carton  Balance</td>
                    <?
					$toal_finash_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right">
						<?
						$print_sent_balence=(($plan_order_size_qnty[$size_id]-($plan_order_size_qnty[$size_id]*$total_cut_reject)/100)-$prod_color_size_data[$size_id]);
						 echo number_format($print_sent_balence,0); $toal_finash_balance+=$print_sent_balence;
						?>
                         </td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($toal_finash_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
        </div>
    	<?

	}
	else if($prod_popup_type==10 && $prod_popup_lelel_type==1) //for garments Delivery
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id,
		sum(CASE WHEN a.entry_form!=85 THEN b.production_qnty ELSE 0 END)-sum(CASE WHEN a.entry_form=85 THEN b.production_qnty ELSE 0 END) as production_qnty
		from pro_ex_factory_mst a,  pro_ex_factory_dtls b
		where a.id=b.mst_id and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id");
		$prod_color_size_data=array();
		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]] +=$row[csf('production_qnty')];
		}

		$table_width=(300+(count($sizearr_order)*60));
		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <th width="100">Production Type</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td rowspan="3" align="center" valign="middle"><? echo $color_Arr_library[$color_id]; ?></td>
                    <td>Order Qty.</td>
                    <?
                    $total_ord_qnty=0;
					foreach($sizearr_order as $size_id)
					{
						?>
						<td align="right"><? echo number_format($order_size_qnty[$size_id],0); $total_ord_qnty+=$order_size_qnty[$size_id];?></td>
						<?
					}
					?>
					<td align="right"><? echo number_format($total_ord_qnty,0); ?></td>
                </tr>

                <tr>
                    <td>Garments Delivery Qty.</td>
                    <?
					$total_delivery_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$size_id],0); $total_delivery_qnty+=$prod_color_size_data[$size_id];?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_qnty,0); ?></td>
                </tr>
                <tr>
                    <td>Gmts Deliv. Balance</td>
                    <?
					$total_delivery_balance=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? $delivery_balance=($order_size_qnty[$size_id]-$prod_color_size_data[$size_id]); echo number_format($delivery_balance,0); $total_delivery_balance+=$delivery_balance;?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_delivery_balance,0); ?></td>
                </tr>
            </tbody>
		</table>
    	</div>
    	<?

	}
	else if($prod_popup_type==11) //for emb sewing output
	{
		$country_cond="";
		if($country_id>0) $country_cond=" and a.country_id=$country_id";
		if($prod_popup_lelel_type=="") $prod_source_cond='';
		else
		{
			$prod_source_cond=$prod_popup_lelel_type;
		}

		$sql_color_size= sql_select("SELECT b.color_size_break_down_id, sum(case when a.production_source='$prod_source_cond' then b.production_qnty else 0 end) as poly_qnty
		from pro_garments_production_mst a, pro_garments_production_dtls b
		where a.id=b.mst_id and a.production_type=11 and a.po_break_down_id in($po_break_down_id) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by b.color_size_break_down_id ");

		$prod_color_size_data=array();

		foreach($sql_color_size as $row)
		{
			$prod_color_size_data[$color_size_data[$row[csf("color_size_break_down_id")]]["color_number_id"]][$color_size_data[$row[csf("color_size_break_down_id")]]["size_number_id"]]["poly_qnty"]+=$row[csf('poly_qnty')];
		}
		//print_r($prod_color_size_data);
		$table_width=(200+(count($sizearr_order)*60));

		?>
        <div id="data_panel" style="width:100%">
			<script>
				function new_window()
				{
					var w = window.open("Surprise", "#");
					var d = w.document.open();
					d.write(document.getElementById('details_reports').innerHTML);
					d.close();
				}
            </script>
        <input type="button" value="Print" id="print" class="formbutton" style="width:100px;" onclick="new_window()" />
        </div>
        <div style="width:<? echo $table_width; ?>px" align="center" id="details_reports">
		<table cellpadding="0" cellspacing="0" border="1" class="rpt_table" rules="all" width="<? echo $table_width; ?>">
            <thead>
                <tr>
                    <th width="100" >Color Name</th>
                    <?
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <th width="60"><? echo $size_Arr_library[$size_id]; ?></th>
                        <?
                    }
                    ?>
                    <th width="100" >Total</th>
                </tr>
            </thead>
            <tbody>
            	<? foreach($allcolor_id_arr as $inc=>$color_id_val) { ?>
                <tr>
                    <td align="center" valign="middle"><? echo $color_Arr_library[$color_id_val]; ?></td>
                    <?
					$total_prod_poly_qnty=0;
                    foreach($sizearr_order as $size_id)
                    {
                        ?>
                        <td align="right"><? echo number_format($prod_color_size_data[$color_id_val][$size_id]["poly_qnty"],0); $total_prod_poly_qnty+=$prod_color_size_data[$color_id_val][$size_id]["poly_qnty"]; ?></td>
                        <?
                    }
                    ?>
                    <td align="right"><? echo number_format($total_prod_poly_qnty,0); ?></td>
                </tr>
                <? } ?>
            </tbody>
		</table>
    	</div>
    	<?
	}
	exit();
}

?>