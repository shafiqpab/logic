<?
header('Content-type:text/html; charset=utf-8');
session_start();
if( $_SESSION['logic_erp']['user_id'] == "" ) header("location:login.php");

require_once('../../../includes/common.php');
$user_name=$_SESSION['logic_erp']['user_id'];
$data=$_REQUEST['data'];
$action=$_REQUEST['action'];
$color_library=return_library_array( "select id,color_name from lib_color", "id", "color_name"  );
$buyer_arr = return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
$company_library=return_library_array( "select id,company_name from lib_company", "id", "company_name"  );
$floor_arr=return_library_array( "select id,floor_name from  lib_prod_floor",'id','floor_name');

$ltb_btb=array(1=>'BTB',2=>'LTB');

// ================================Print button ==============================

if($action=="print_button_variable_setting")
{

    $print_report_format=0;
    $print_report_format=return_field_value("format_id","lib_report_template","template_name ='".$data."' and module_id=7 and report_id=136 and is_deleted=0 and status_active=1");
	$printButton=explode(',',$print_report_format);

	 foreach($printButton as $id){
		if($id==710)$buttonHtml.='<input type="button" id="show_button" class="formbutton" style="width:80px" value="Batch Wise" onClick="fn_dyeing_report_generated(2)" />';
		if($id==108)$buttonHtml.='<input type="button" id="show_button" class="formbutton" style="width:50px" value="Show" onClick="fn_dyeing_report_generated(1)" />';
		if($id==267)$buttonHtml.='<input type="button" id="show_button" class="formbutton" style="width:50px" value="Report3" onClick="fn_dyeing_report_generated(3)" />';
		if($id==711)$buttonHtml.='<input type="button" id="show_button" class="formbutton" style="width:150px" value="Machine Wise W/C Report" onClick="fn_dyeing_report_generated(4)" />';
		if($id==712)$buttonHtml.='<input type="button" id="show_button" class="formbutton" style="width:50px" value="Show5" onClick="fn_dyeing_report_generated(5)" />';
		if($id==750)$buttonHtml.='<input type="button" id="show_button" class="formbutton" style="width:80px" value="Batch Wise 2" onClick="fn_dyeing_report_generated(6)" />';
	 }
	 echo "document.getElementById('button_data_panel').innerHTML = '".$buttonHtml."';\n";

    exit();
}
// ======================= End Print button =================================================

//--------------------------------------------------------------------------------------------------------------------

if($action=="check_color_id")
{	echo load_html_head_contents("PO Info", "../../../", 1, 1,'','','');
	extract($_REQUEST);
	?>
	<script type="text/javascript">
      function js_set_value(id)
      { //alert(id);
		  document.getElementById('selected_id').value=id;
		  parent.emailwindow.hide();
      }
    </script>
    <input type="hidden" id="selected_id" name="selected_id" />
    <?
        $sql="select id, color_name from lib_color where is_deleted=0 and status_active=1 order by id";
        $arr=array(1=>$color_library);
        echo  create_list_view("list_view", "ID,Color Name", "50,200","300","300",0, $sql, "js_set_value", "id,color_name", "", 1, "0,0", $arr , "id,color_name", "",'setFilterGrid("list_view",-1);','0') ;
	exit();
}

if ($action=="load_drop_down_knitting_com") {
	//$data = explode("**", $data);
	if ($data[0] == 1) {
		echo create_drop_down("cbo_party_id", 70, "select comp.id, comp.company_name from lib_company comp where comp.status_active=1 and comp.is_deleted=0 $company_cond order by comp.company_name", "id,company_name", 1, "-- Select --", "", "", "");
	} else if ($data[0] == 3) {
		echo create_drop_down("cbo_party_id", 70, "select a.id,a.supplier_name from lib_supplier a, lib_supplier_party_type b where a.id=b.supplier_id and a.status_active=1 group by a.id,a.supplier_name order by a.supplier_name", "id,supplier_name", 1, "-- Select --", 0, "");
	} else {
		echo create_drop_down("cbo_party_id", 70, $blank_array, "", 1, "-- Select --", 0, "");
	}
	exit();
}

if($action=="batchnumbershow")
{
	echo load_html_head_contents("PO Info", "../../../", 1, 1,'','','');
	extract($_REQUEST);
?>
	<script type="text/javascript">
        function js_set_value(id)
        {
            document.getElementById('selected_id').value=id;
            parent.emailwindow.hide();
        }
    </script>
<input type="hidden" id="selected_id" name="selected_id" />
<? if($db_type==0) $field_grpby=" GROUP BY batch_no";
else if($db_type==2) $field_grpby="GROUP BY batch_no,id,batch_no,batch_for,booking_no,color_id,batch_weight";
$batch_type = str_replace("'","",$batch_type);
if ($batch_type==0 || $batch_type==1)
{
	$sql="select id,batch_no,batch_for,booking_no,color_id,batch_weight from pro_batch_create_mst where company_id=$company_name and entry_form in(0) and is_deleted = 0   $field_grpby ";
} // and booking_no is not null
if ($batch_type==0 || $batch_type==2)
{

$sql="select id,batch_no,batch_for,booking_no,color_id,batch_weight from pro_batch_create_mst where company_id=$company_name and entry_form in(36) and is_deleted = 0  $field_grpby ";
}
$arr=array(1=>$color_library);
	echo  create_list_view("list_view", "Batch no,Color,Booking no, Batch for,Batch weight ", "100,100,100,100,170","620","350",0, $sql, "js_set_value", "id,batch_no", "", 1, "0,color_id,0,0,0", $arr , "batch_no,color_id,booking_no,batch_for,batch_weight", "employee_info_controller",'setFilterGrid("list_view",-1);','0') ;
	exit();
}
if ($action == "booking_no_popup")
{
	echo load_html_head_contents("Booking Info", "../../../", 1, 1,'','','');
	extract($_REQUEST);
	?>
	<script>

		function js_set_value(str)
		{
			var splitData = str.split("_");
			//alert (splitData[1]);
			$("#hide_booking_id").val(splitData[0]);
			$("#hide_booking_no").val(splitData[1]);
			parent.emailwindow.hide();
		}
	</script>
	</head>
	<body>
		<div align="center">
			<form name="styleRef_form" id="styleRef_form">
				<fieldset style="width:740px;">
					<table width="740" cellspacing="0" cellpadding="0" border="1" rules="all" align="center" class="rpt_table" id="tbl_list">
						<thead>
							<th>Buyer</th>
							<th width="170">Please Enter Booking No</th>
							<th>Booking Date</th>

							<th><input type="reset" name="button" class="formbutton" value="Reset" style="width:100px;" onClick="reset_form('styleRef_form','search_div','','','','');"></th>
							<input type="hidden" name="hide_booking_no" id="hide_booking_no" value="" />
							<input type="hidden" name="hide_booking_id" id="hide_booking_id" value="" />
						</thead>
						<tbody>
							<tr>
								<td align="center">
									<?
									echo create_drop_down( "cbo_buyer_name", 140, "select buy.id, buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company=$companyID $buyer_cond and buy.id in (select buyer_id from lib_buyer_party_type where party_type in (1,3,21,90)) order by buy.buyer_name","id,buyer_name",1, "-- All Buyer--",$buyer_name,"",0 );
									?>
								</td>
								<td align="center">
									<input type="text" style="width:150px" class="text_boxes" name="txt_booking_no" id="txt_booking_no" />
								</td>
								<td align="center">
									<input type="text" style="width:70px" class="datepicker" name="txt_date_from" id="txt_date_from" readonly/> To
									<input type="text" style="width:70px" class="datepicker" name="txt_date_to" id="txt_date_to" readonly/>
								</td>

								<td align="center">
									<input type="button" name="button" class="formbutton" value="Show" onClick="show_list_view ('<? echo $companyID; ?>'+'**'+document.getElementById('cbo_buyer_name').value+'**'+document.getElementById('txt_booking_no').value+'**'+document.getElementById('txt_date_from').value+'**'+document.getElementById('txt_date_to').value, 'create_booking_no_search_list_view', 'search_div', 'dyeing_production_report_controller', 'setFilterGrid(\'list_view\',-1)');" style="width:100px;" />
								</td>
							</tr>
							<tr>
								<td colspan="4" align="center" width="95%"><? echo load_month_buttons(1); ?></td>
							</tr>
						</tbody>
					</table>
					<div style="margin-top:15px" id="search_div"></div>
				</fieldset>
			</form>
		</div>
	</body>
	<script src="../../../includes/functions_bottom.js" type="text/javascript"></script>
	</html>
<?
exit();
}
if($action == "create_booking_no_search_list_view")
{
	$data=explode('**',$data);

	if ($data[0]!=0) $company="  a.company_id='$data[0]'";
	if ($data[1]!=0) $buyer=" and a.buyer_id='$data[1]'"; else $buyer="";
	if ($data[2]!=0) $booking_no=" and a.booking_no_prefix_num='$data[2]'"; else $booking_no='';
	if($db_type==0)
	{
		if ($data[3]!="" &&  $data[4]!="") $booking_date  = "and s.booking_date  between '".change_date_format($data[3], "yyyy-mm-dd", "-")."' and '".change_date_format($data[4], "yyyy-mm-dd", "-")."'"; else $booking_date ="";
	}
	if($db_type==2)
	{
		if ($data[3]!="" &&  $data[4]!="") $booking_date  = "and a.booking_date  between '".change_date_format($data[3], "yyyy-mm-dd", "-",1)."' and '".change_date_format($data[4], "yyyy-mm-dd", "-",1)."'"; else $booking_date ="";
	}

	$approved=array(0=>"No",1=>"Yes");
	$is_ready=array(0=>"No",1=>"Yes",2=>"No");
	$buyer_arr=return_library_array( "select id, short_name from lib_buyer",'id','short_name');
	$comp=return_library_array( "select id, company_short_name from lib_company",'id','company_short_name');
	$suplier=return_library_array( "select id, short_name from lib_supplier",'id','short_name');
	$arr=array (2=>$comp,3=>$buyer_arr,5=>$item_category,6=>$fabric_source,7=>$suplier,8=>$approved,9=>$is_ready);
	//pro_batch_create_mst//wo_non_ord_samp_booking_mst
 	 $sql= "(select a.id,a.booking_no_prefix_num as no_prefix_num,a.booking_no, a.booking_date, a.company_id, a.buyer_id, a.job_no, a.item_category, a.fabric_source, a.supplier_id, a.is_approved, a.ready_to_approved from wo_booking_mst a,pro_batch_create_mst b where $company $buyer $booking_no $booking_date and a.booking_no=b.booking_no and a.booking_type=1 and a.is_short=2 and a.status_active=1 and a.is_deleted=0
	union all
	 select a.id,a.booking_no_prefix_num as no_prefix_num, a.booking_no, a.booking_date, a.company_id, a.buyer_id, a.job_no,a.item_category, a.fabric_source, a.supplier_id, a.is_approved, a.ready_to_approved from wo_non_ord_samp_booking_mst a ,pro_batch_create_mst b where $company $buyer $booking_no $booking_date  and a.booking_no=b.booking_no and a.booking_type=4 and b.status_active=1 and b.is_deleted=0) order by id Desc
	";
	//echo "select a.id,a.booking_no_prefix_num as no_prefix_num,a.booking_no, a.booking_date, a.company_id, a.buyer_id, a.job_no, a.item_category, a.fabric_source, a.supplier_id, a.is_approved, a.ready_to_approved from wo_booking_mst a,wo_non_ord_samp_booking_mst b where $company $buyer $booking_no $booking_date and a.booking_no=b.booking_no and a.booking_type=1 and a.is_short=2 and a.status_active=1 and a.is_deleted=0 ";
	echo  create_list_view("list_view", "Booking No,Booking Date,Company,Buyer,Job No.,Fabric Nature,Fabric Source,Supplier,Approved,Is-Ready", "110,80,80,80,90,120,80,80,60,50","910","320",0, $sql , "js_set_value", "id,no_prefix_num", "", 1, "0,0,company_id,buyer_id,0,item_category,fabric_source,supplier_id,is_approved,ready_to_approved", $arr , "booking_no,booking_date,company_id,buyer_id,job_no,item_category,fabric_source,supplier_id,is_approved,ready_to_approved", '','setFilterGrid(\'list_view\',-1);','0,3,0,0,0,0,0,0,0,0','','');
	exit();
}

if ($action=="load_drop_down_floor")
{
	$ex_data=explode('_',$data);
	if($ex_data[1]!=0) $location_cond=" and b.location_id='$ex_data[1]'"; else $location_cond="";

	echo create_drop_down( "cbo_floor_id", 100, "select a.id, a.floor_name from lib_prod_floor a, lib_machine_name b where a.id=b.floor_id and b.category_id=2 and b.company_id='$ex_data[0]' and b.status_active=1 and b.is_deleted=0  $location_cond group by a.id, a.floor_name order by a.floor_name","id,floor_name", 1, "-- Select Floor --", 0, "","" );
  exit();
}

if($action=="machine_no_popup")
{
	echo load_html_head_contents("PO Info", "../../../", 1, 1,'','','');
	extract($_REQUEST);
	$im_data=explode('_',$data);
	//print_r ($im_data);
?>
	<script>

		var selected_id = new Array; var selected_name = new Array;

		function check_all_data()
		{
			var tbl_row_count = document.getElementById( 'tbl_list_search' ).rows.length;
			tbl_row_count = tbl_row_count - 1;

			for( var i = 1; i <= tbl_row_count; i++ )
			{
				$('#tr_'+i).trigger('click');
			}
		}

		function toggle( x, origColor ) {
			var newColor = 'yellow';
			if ( x.style ) {
				x.style.backgroundColor = ( newColor == x.style.backgroundColor )? origColor : newColor;
			}
		}

		function js_set_value( str ) {

			if (str!="") str=str.split("_");

			toggle( document.getElementById( 'tr_' + str[0] ), '#FFFFCC' );

			if( jQuery.inArray( str[1], selected_id ) == -1 ) {
				selected_id.push( str[1] );
				selected_name.push( str[2] );

			}
			else {
				for( var i = 0; i < selected_id.length; i++ ) {
					if( selected_id[i] == str[1] ) break;
				}
				selected_id.splice( i, 1 );
				selected_name.splice( i, 1 );
			}
			var id = ''; var name = '';
			for( var i = 0; i < selected_id.length; i++ ) {
				id += selected_id[i] + ',';
				name += selected_name[i] + '*';
			}

			id = id.substr( 0, id.length - 1 );
			name = name.substr( 0, name.length - 1 );

			$('#hid_machine_id').val( id );
			$('#hid_machine_name').val( name );
		}

		function hidden_field_reset()
		{
			$('#hid_machine_id').val('');
			$('#hid_machine_name').val( '' );
			selected_id = new Array();
			selected_name = new Array();
		}
    </script>
</head>
<input type="hidden" name="hid_machine_id" id="hid_machine_id" />
<input type="hidden" name="hid_machine_name" id="hid_machine_name" />
<?
	$sql = "select a.id, a.machine_no, a.brand, a.origin, a.machine_group, b.floor_name  from lib_machine_name a, lib_prod_floor b where a.floor_id=b.id and a.category_id=2 and a.company_id=$im_data[0] and a.status_active=1 and a.is_deleted=0 and a.is_locked=0 order by a.machine_no, b.floor_name ";
	//echo  $sql;

	echo create_list_view("tbl_list_search", "Machine Name,Machine Group,Floor Name", "200,110,110","450","350",0, $sql , "js_set_value", "id,machine_no", "", 1, "0,0,0", $arr , "machine_no,machine_group,floor_name", "",'setFilterGrid(\'tbl_list_search\',-1);','0,0,0','',1) ;

   exit();
}
if($action=="load_drop_down_buyer")
{
	//echo load_html_head_contents("PO Info", "../../../", 1, 1,'','','');
	//extract($_REQUEST);
	$data=explode('_',$data);
	$company=$data[0];
	$report_type=$data[1];
	//echo $report_type;
	if($report_type==1 || $report_type==3)
	{
    echo create_drop_down( "cbo_buyer_name", 100, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$company' $buyer_cond and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,3,21,90))  order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", 0, "" );
	}
	else if($report_type==2)
	{
		 echo create_drop_down( "cbo_buyer_name", 100, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$company' $buyer_cond and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (2,3))  order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", 0, "" );
	}
	else if($report_type==0)
	{
		echo create_drop_down( "cbo_buyer_name", 100, "select buy.id,buy.buyer_name from lib_buyer buy, lib_buyer_tag_company b where buy.status_active =1 and buy.is_deleted=0 and b.buyer_id=buy.id and b.tag_company='$company' $buyer_cond and buy.id in (select  buyer_id from  lib_buyer_party_type where party_type in (1,2,3,21,90))  order by buyer_name","id,buyer_name", 1, "-- Select Buyer --", 0, "" );
	}
	else
	{
	 echo create_drop_down( "cbo_buyer_name", 100, $blank_array,"", 1, "-- Select Party --", $selected, "",0,"","","","");
	}
	exit();
}//cbo_buyer_name_td


if($action=="jobnumbershow")
{
	echo load_html_head_contents("PO Info", "../../../", 1, 1,'','','');
	extract($_REQUEST);
?>
<script type="text/javascript">
  function js_set_value(id)
	  {
		document.getElementById('selected_id').value=id;
		parent.emailwindow.hide();
	  }
</script>
<input type="hidden" id="selected_id" name="selected_id" />
<?
$year_job = str_replace("'","",$year);
$batch_type = str_replace("'","",$batch_type);
if($db_type==0)
{
	$year_field_by="and YEAR(a.insert_date)";
	$year_field="SUBSTRING_INDEX(a.insert_date, '-', 1) as year";
	$field_grpby="GROUP BY a.job_no order by b.id desc";
}
else if($db_type==2)
{
$year_field_by=" and to_char(a.insert_date,'YYYY')";
$year_field="to_char(a.insert_date,'YYYY') as year";
$field_grpby=" GROUP BY a.job_no,a.id,a.buyer_name,a.style_ref_no,a.gmts_item_id,b.po_number,a.job_no_prefix_num,a.insert_date,b.id order by b.id,a.job_no_prefix_num  desc ";
}

if(trim($year)!=0) $year_cond=" $year_field_by=$year_job"; else $year_cond="";
//echo $year_job;
//$cbo_buyer_name=($cbo_buyer_name==0)?"%%" : "%$cbo_buyer_name%";
if(trim($cbo_buyer_name)==0) $buyer_name_cond=""; else $buyer_name_cond=" and a.buyer_name=$cbo_buyer_name";
if(trim($cbo_buyer_name)==0) $sub_buyer_name_cond=""; else $sub_buyer_name_cond=" and a.party_id=$cbo_buyer_name";
if ($batch_type==0 || $batch_type==1)
{
$sql="select a.id,a.buyer_name,a.style_ref_no,a.gmts_item_id,b.po_number,a.job_no_prefix_num as job_prefix,$year_field from wo_po_details_master a,wo_po_break_down b where b.job_no_mst=a.job_no and a.company_name=$company_id  $buyer_name_cond $year_cond and a.is_deleted = 0 $field_grpby";
}
else
{
$sql="select a.id,a.party_id as buyer_name,c.item_id as gmts_item_id,b.cust_style_ref as style_ref_no,b.order_no as po_number,a.job_no_prefix_num as job_prefix,$year_field from  subcon_ord_mst a, subcon_ord_dtls b, subcon_ord_breakdown c where b.job_no_mst=a.subcon_job and a.id=c.mst_id and b.id=c.order_id and a.company_id=$company_id  $sub_buyer_name_cond $year_cond and a.is_deleted = 0 group by a.id,a.party_id,b.cust_style_ref,b.order_no ,a.job_no_prefix_num,a.insert_date,c.item_id";

}
//echo $sql;
$buyer=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name"  );
?>
<table width="580" border="1" rules="all" class="rpt_table">
	<thead>
         <tr><th colspan="7"><? if($batch_type==0 || $batch_type==1)
		 { echo "Self Batch Order";} else if($batch_type==2) { echo "SubCon Batch Order";}?>  </th></tr>

        <tr>
            <th width="35">SL</th>
            <th width="100">Po Number</th>
            <th width="100">Job no</th>
            <th width="50">Year</th>
            <th width="80">Buyer</th>
            <th width="100">Style</th>
            <th>Item Name</th>
        </tr>
   </thead>
</table>
<div style="max-height:300px; overflow-y:scroll; width:600px;">
<table id="table_body2" width="580" border="1" rules="all" class="rpt_table">
 <? $rows=sql_select($sql);
$i=1;
 foreach($rows as $data)
 {  if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
  ?>
	<tr bgcolor="<? echo $bgcolor; ?>" onClick="js_set_value('<? echo $data[csf('job_prefix')]; ?>')" style="cursor:pointer;">
		<td width="35"><? echo $i; ?></td>
		<td width="100"><p><? echo $data[csf('po_number')]; ?></p></td>
		<td width="100"><p><? echo $data[csf('job_prefix')]; ?></p></td>
        <td width="50"><p><? echo $data[csf('year')]; ?></p></td>
		<td width="80"><p><? echo $buyer[$data[csf('buyer_name')]]; ?></p></td>
		<td width="100"><p><? echo $data[csf('style_ref_no')]; ?></p></td>
		<td><p><?
		$itemid=explode(",",$data[csf('gmts_item_id')]);
		foreach($itemid as $index=>$id){
			echo ($itemid[$index]==end($itemid))? $garments_item[$id] : $garments_item[$id].', ';
		}
		?></p></td>
	</tr>
    <? $i++; } ?>
</table>
</div>
<script> setFilterGrid("table_body2",-1); </script>
<?
	exit();
}//JobNumberShow

if($action=="order_number_popup")
{
	echo load_html_head_contents("PO Info", "../../../", 1, 1,'','','');
	extract($_REQUEST);
	?>
	<script type="text/javascript">
	  function js_set_value(id)
		  {
			document.getElementById('selected_id').value=id;
			parent.emailwindow.hide();
		  }
	</script>
	<input type="hidden" id="selected_id" name="selected_id" />
	<?
	$buyer = str_replace("'","",$buyer_name);
	$year = str_replace("'","",$year);
	$year_job = str_replace("'","",$year);
	if($db_type==0)
	{
		$year_field_by=" and YEAR(b.insert_date)";
		$year_field="SUBSTRING_INDEX(b.insert_date, '-', 1) as year ";
	}
	else if($db_type==2)
	{
	$year_field_by=" and to_char(b.insert_date,'YYYY')";
	$year_field="to_char(b.insert_date,'YYYY') as year";
	}
	if ($company_name==0) $company=""; else $company=" and b.company_name=$company_name";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	//echo $buyer;die;
	if ($buyer==0) $buyername=""; else $buyername=" and b.buyer_name=$buyer";//$cbo_buyer_name=($cbo_buyer_name==0)?"%%" : "%$cbo_buyer_name%";
	if(trim($buyer)==0) $sub_buyer_name_cond=""; else $sub_buyer_name_cond=" and a.party_id=$buyer";
	if ($batch_type==0 || $batch_type==1)
	{
	$sql = "select distinct a.id,b.job_no,a.po_number,b.company_name,b.buyer_name,b.job_no_prefix_num as job_prefix,$year_field from wo_po_break_down a, wo_po_details_master b where a.job_no_mst=b.job_no $company $buyername $year_cond order by a.id asc";
	}
	else
	{
	$sql="select distinct a.id,b.job_no_mst as job_no ,a.party_id as buyer_name,a.company_id as company_name ,b.order_no as po_number,a.job_no_prefix_num as job_prefix,$year_field from  subcon_ord_mst a , subcon_ord_dtls b, subcon_ord_breakdown c where b.job_no_mst=a.subcon_job and a.id=c.mst_id and b.id=c.order_id and a.company_id=$company_name  $sub_buyer_name_cond $year_cond and a.is_deleted =0 group by a.id,a.party_id,b.job_no_mst,b.order_no ,a.job_no_prefix_num,a.company_id,b.insert_date";
	}
	$buyer=return_library_array( "select id,buyer_name from lib_buyer", "id", "buyer_name"  );
	?>
	<table width="490" border="1" rules="all" class="rpt_table">
		<thead>
		 <tr><th colspan="5"><? if($batch_type==0 || $batch_type==1) echo "Self Batch Order"; else echo "SubCon Batch Order";?>  </th></tr>
			<tr>
			<th width="30">SL</th>
			<th width="80">Order Number</th>
			<th width="50">Job no</th>
			<th width="80">Buyer</th>
			<th width="40">Year</th>
			</tr>
	   </thead>
	</table>
	<div style="max-height:300px; overflow:auto;">
	<table id="table_body2" width="490" border="1" rules="all" class="rpt_table">
	 <? $rows=sql_select($sql);
		 $i=1;
	 foreach($rows as $data)
	 {
		  if($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
	  ?>
		<tr bgcolor="<? echo $bgcolor;?>" onClick="js_set_value('<? echo $data[csf('po_number')]; ?>')" style="cursor:pointer;">
			<td width="30"><? echo $i; ?></td>
			<td width="80"><p><? echo $data[csf('po_number')]; ?></p></td>
			<td width="50"><p><? echo $data[csf('job_prefix')]; ?></p></td>
			<td width="80"><p><? echo $buyer[$data[csf('buyer_name')]]; ?></p></td>
			<td width="40" align="center"><? echo $data[csf('year')]; ?></p></td>
		</tr>
		<? $i++; } ?>
	</table>
	</div>
	<script> setFilterGrid("table_body2",-1); </script>
	<?
	exit();
}

if($action=="dyeing_production_report")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if($db_type==0) $year_field_by="and YEAR(a.insert_date)";
	else if($db_type==2) $year_field_by=" and to_char(a.insert_date,'YYYY')";
	if($db_type==0) $field_concat="concat(machine_no,'-',brand) as machine_name";
	else if($db_type==2) $field_concat="machine_no || '-' || brand as machine_name";
	$company = str_replace("'","",$cbo_company_name);
	$working_company = str_replace("'","",$cbo_working_company_name);
	$buyer = str_replace("'","",$cbo_buyer_name);
	$cbo_prod_type = str_replace("'","",$cbo_prod_type);
	$cbo_party_id = str_replace("'","",$cbo_party_id);

	$date_search_type = str_replace("'","",$search_type);
	$job_number = str_replace("'","",$job_number);
	$job_number_id = str_replace("'","",$job_number_show);
	$batch_no = str_replace("'","",$batch_number_show);
	$color = str_replace("'","",$txt_color);
	$machine=str_replace("'","",$txt_machine_id);
	$floor_name=str_replace("'","",$cbo_floor_id);

	//echo $batch_no;die;
	$batch_number_hidden = str_replace("'","",$batch_number);
	$ext_num = str_replace("'","",$txt_ext_no);
	$hidden_ext = str_replace("'","",$hidden_ext_no);
	$txt_order = str_replace("'","",$order_no);
	$file_no = str_replace("'","",$file_no);
	$ref_no = str_replace("'","",$ref_no);
	$hidden_order = str_replace("'","",$hidden_order_no);
	$cbo_type = str_replace("'","",$cbo_type);
	$cbo_result_name = str_replace("'","",$cbo_result_name);
	$hide_booking_id = str_replace("'","",$txt_hide_booking_id);
	$txt_booking_no = str_replace("'","",$txt_booking_no);
	$year = str_replace("'","",$cbo_year);
	$shift = str_replace("'","",$cbo_shift_name);
	//echo $cbo_type;die;
	$txt_date_from = str_replace("'","",$txt_date_from);
	$txt_date_to = str_replace("'","",$txt_date_to);
	if ($buyer==0) $sub_buyer_cond=""; else $sub_buyer_cond="and d.party_id='".$buyer."' ";
	if ($cbo_prod_type>0 && $cbo_party_id>0) $cbo_prod_type_cond="and f.service_company in($cbo_party_id) "; else $cbo_prod_type_cond="";
	if ($cbo_prod_type>0) $cbo_prod_source_cond="and f.service_source in($cbo_prod_type) "; else $cbo_prod_source_cond="";
	//echo $cbo_prod_type;
	if ($cbo_result_name==0) $result_name_cond=""; else $result_name_cond="  and f.result='".$cbo_result_name."' ";
	if ($shift==0) $shift_name_cond=""; else $shift_name_cond="  and f.shift_name='".$shift."' ";
	if ($machine=="") $machine_cond=""; else $machine_cond =" and f.machine_id in ( $machine ) ";
	if ($floor_name==0 || $floor_name=='') $floor_id_cond=""; else $floor_id_cond=" and f.floor_id=$floor_name";

	if ($buyer==0) $buyerdata=""; else $buyerdata="  and d.buyer_name='".$buyer."' ";
	if ($buyer==0) $buyerdata2=""; else $buyerdata2="  and h.buyer_id='".$buyer."' ";
	if ($batch_no=="") $batch_num=""; else $batch_num="  and a.batch_no='".trim($batch_no)."' ";

	if ($batch_no=="") $unload_batch_cond=""; else $unload_batch_cond="  and batch_no='".trim($batch_no)."' ";
	if ($batch_no=="") $unload_batch_cond2=""; else $unload_batch_cond2="  and f.batch_no='".trim($batch_no)."' ";
	if ($working_company==0) $workingCompany_name_cond2=""; else $workingCompany_name_cond2="  and a.working_company_id='".$working_company."' ";
	if ($company==0) $companyCond=""; else $companyCond="  and a.company_id=$company";
	//echo $cbo_batch_type;
	if(trim($ext_no)!="") $ext_no_search="%".trim($ext_no)."%"; else $ext_no_search="%%";
	if(trim($txt_booking_no)!="") $ext_no_search="%".trim($txt_booking_no)."%"; else $ext_no_search="%%";

	if ($txt_booking_no!='') $booking_no_cond="  and a.booking_no LIKE '%$txt_booking_no%'"; else $booking_no_cond="";
	if ($hide_booking_id!='') $booking_id_cond="  and a.booking_no_id in($hide_booking_id) "; else $booking_id_cond="";

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if ($txt_order!='') $suborder_no="and c.order_no='$txt_order'"; else $suborder_no="";
		if ($job_number_id!='') $sub_job_cond="  and d.job_no_prefix_num='".$job_number_id."' "; else $sub_job_cond="";
	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
	{
	if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
	if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
	if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}
	if ($color=="") $color_name=""; else $color_name="  and g.color_name='$color'";
	if ($ext_num=="") $ext_no=""; else $ext_no="  and a.extention_no=$ext_num ";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	if($txt_date_from && $txt_date_to)
	{
		if($db_type==0)
		{

			$date_from=change_date_format($txt_date_from,'yyyy-mm-dd');
			$date_to=change_date_format($txt_date_to,'yyyy-mm-dd');

			$start_dd= strtotime(change_date_format($date_from,"yyyy-mm-dd","-"));
			$end_dd= strtotime(change_date_format($date_from,"yyyy-mm-dd","-"));
			$start_d=date("Y-m-d",$start_dd);
			$end_d=date("Y-m-d",$end_dd);
			$date_from2 = strtotime($start_d);
			$date_to2 = strtotime($end_d);
			$date_start = date("Y-m-d",strtotime("-5 day", $date_from2));
			$date_end = date("Y-m-d",strtotime("+5 day", $date_to2));
			$date_start= change_date_format($date_start,"yyyy-mm-dd","-",1);
			$date_end= change_date_format($date_end,"yyyy-mm-dd","-",1);

			$second_month_ldate=date("Y-m-t",strtotime($date_to));
			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			$prod_last_day=change_date_format($second_month_ldate,'yyyy-mm-dd');
			$prod_date_upto=" and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day' ";
			if($date_search_type==1)
			{
				$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
				$dates_com2=" and  f.process_end_date BETWEEN '$date_start' AND '$date_end' ";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 23:59:59' ";
				$dates_com2=" and f.insert_date between '".$date_start."' and '".$date_end." 23:59:59' ";
			}


		}
		elseif($db_type==2)
		{

			$date_from=change_date_format($txt_date_from,'','',1);
			$date_to=change_date_format($txt_date_to,'','',1);

			$start_dd= strtotime(change_date_format($date_from,"dd-mm-yyyy","-"));
			$end_dd= strtotime(change_date_format($date_from,"dd-mm-yyyy","-"));
			$start_d=date("Y-m-d",$start_dd);
			$end_d=date("Y-m-d",$end_dd);
			$date_from2 = strtotime($start_d);
			$date_to2 = strtotime($end_d);
			$date_start = date("Y-m-d",strtotime("-5 day", $date_from2));
			$date_end = date("Y-m-d",strtotime("+5 day", $date_to2));
			$date_start= change_date_format($date_start,"dd-mm-yyyy","-",1);
			$date_end= change_date_format($date_end,"dd-mm-yyyy","-",1);

			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			$second_month_ldate=date("Y-M-t",strtotime($date_to));
		    $prod_last_day=change_date_format($second_month_ldate,'','',1);
			$prod_date_upto="and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day'";
			if($date_search_type==1)
			{
				$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
				$dates_com2="and  f.process_end_date BETWEEN '$date_start' AND '$date_end'";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 11:59:59 PM' ";
				$dates_com2=" and f.insert_date between '".$date_start."' and '".$date_end." 11:59:59 PM' ";

			}

		}
	}

	$group_by=str_replace("'",'',$cbo_group_by);
	if($group_by==1)
	{
		$order_by="order by f.floor_id";
		$order_by2="order by floor_id";
	}
	else if($group_by==2)
	{
		$order_by="order by f.shift_name";
		$order_b2y="order by shift_name";
	}
	else if($group_by==3)
	{
		$order_by="order by f.machine_id";
		$order_by2="order by machine_id";
	}
	else
	{
		$order_by="order by f.process_end_date,f.machine_id";
		$order_by2="order by process_end_date,machine_id";
	}
	if($db_type==0)
	{
		if($cbo_type==1)//  For Dyeing WIP
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
				$sql="select a.id,a.company_id, a.batch_no, a.batch_date, a.batch_weight, a.color_id,a.booking_no, a.booking_no_id, a.extention_no, a.batch_against, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, group_concat( distinct c.po_number ) AS po_number, c.job_no_mst, d.job_no as job_no_prefix_num, d.buyer_name, f.process_end_date, f.end_hours, f.end_minutes, f.machine_id,f.shift_name,f.floor_id, f.remarks from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g	where a.is_deleted=0 and f.status_active=1 $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond and g.id=a.color_id and a.entry_form=0 and a.id=b.mst_id and f.batch_id=a.id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=1 and a.batch_against in(1,2,3)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and f.is_deleted=0  GROUP BY a.id,b.item_description $order_by ";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
				$sql_subcon="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat(distinct c.order_no) AS po_number,d.subcon_job,d.subcon_job as job_no_prefix_num,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks,f.shift_name,f.floor_id from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where  f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id=1 and a.batch_against in(0) and a.id not in ($sub_batch_id) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  GROUP BY a.id, a.batch_no, a.company_id, d.party_id, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.subcon_job, d.job_no_prefix_num, d.party_id, f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.result, f.remarks ";
			}
		}
		else if($cbo_type==2)//   For Order Wise Dyeing Production
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
				$sql="select f.insert_date,a.batch_no,a.id, a.batch_weight,a.booking_no, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, group_concat( distinct c.po_number) AS po_number,c.grouping,c.file_no, d.job_no as job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.remarks, f.result  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0
				group by a.batch_no, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.job_no, d.buyer_name,c.grouping,c.file_no, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.remarks, f.result,f.insert_date $order_by";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
			 $sql_subcon="select f.insert_date,a.batch_no,a.id, a.batch_weight,a.booking_no, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, group_concat(c.order_no) AS po_number, d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where  f.batch_id=a.id and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond  $workingCompany_name_cond2 $companyCond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  GROUP BY a.batch_no, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.subcon_job, d.party_id , f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.result,f.insert_date $order_by";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Batch Against- Sample
			{
				$sql_sam="(select f.insert_date,a.batch_no,a.id, a.batch_weight,a.booking_no, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, group_concat( distinct c.po_number) AS po_number, d.job_no as job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where  f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0
				group by a.batch_no, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.job_no, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.result,f.insert_date)
			union
			 (
			 select f.insert_date,a.batch_no, a.id,a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, 'null', 'null', 'null', f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result,f.insert_date)  $order_by2";
			}
		}
		else if($cbo_type==3)//  For Daily Right First Time
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
			$sql="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where  f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond  $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond 	and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and and f.batch_id=b.mst_id a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description order by a.batch_no ";
			$sql_ltb="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and  g.id=a.color_id and f.batch_id=b.mst_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and a.batch_against in(1) and f.ltb_btb_id=2 and f.result in(1,2,3,4,5) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.id,b.po_id, b.item_description order by a.batch_no";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
		  $sql_subcon="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat(distinct c.order_no) AS po_number,d.subcon_job,d.job_no as job_no_prefix_num,d.party_id,f.production_date as process_end_date,f.process_end_date as production_date,f.ltb_btb_id,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id in(2) and a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  GROUP BY a.id,a.batch_no,a.company_id, d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.job_no,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks ";

		 $sql_subcon_ltb="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat(distinct c.order_no) as po_number,d.subcon_job,d.job_no as job_no_prefix_num,d.party_id,f.ltb_btb_id,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and  a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id in(2)   and a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=2 and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond   GROUP BY a.id,a.batch_no,a.company_id, d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.job_no,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks,f.ltb_btb_id ";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
			$sql_btb_sam="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond	$booking_no_cond $booking_id_cond  $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and f.batch_id=b.mst_id and a.batch_against in(3) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description order by a.batch_no ";
			$sql_ltb_sam="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where  f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  f.batch_id=a.id and f.batch_id=b.mst_id $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and  g.id=a.color_id and a.entry_form=0 and a.id=b.mst_id and a.batch_against in(3) and f.ltb_btb_id=2 and f.result in(1,2,3,4,5) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description order by a.batch_no";
			}
		}
		else if($cbo_type==4)//  For Daily Dyeing Reprocess Summary
		{
			$sql="select a.company_id, a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.floor_id,f.shift_name,f.load_unload_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g
	where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.extention_no!=0 and a.batch_against in(2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.po_id,f.floor_id,f.shift_name, b.item_description $order_by";
		}
	}
	else if($db_type==2)// Oracle start here
	{
		if($cbo_type==1)//  For Dyeing WIP
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
			$sql="select a.id,a.company_id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type, LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.shift_name,f.floor_id,f.remarks from pro_batch_create_mst a,pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d, pro_fab_subprocess f,lib_color g	where  a.id=b.mst_id and f.batch_id=a.id and f.batch_id=b.mst_id and  b.po_id=c.id and d.job_no=c.job_no_mst and g.id=a.color_id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $machine_cond $floor_id_cond $cbo_prod_type_cond and a.entry_form=0  and f.entry_form=35 and f.load_unload_id=1 and a.batch_against in(1,2,3)   and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $batchIds_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  GROUP BY  a.id,f.shift_name,f.floor_id,a.company_id,a.batch_no,a.batch_date, a.batch_weight, a.color_id,a.booking_no, a.booking_no_id, a.extention_no, a.batch_against,b.item_description, b.po_id, b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no, d.buyer_name, f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.remarks order by a.batch_no";

			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
			$subwip_batch_id_arr=array_chunk(array_unique(explode(",",$sub_batch_id)),999);

			 $sql_subcon="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.total_trims_weight,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.order_no) AS po_number,d.subcon_job,d.subcon_job as job_no_prefix_num,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks,f.shift_name,f.floor_id from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id=1 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $booking_no_cond $booking_id_cond   $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond";
			 $p=1;
			foreach($subwip_batch_id_arr as $subrow)
			{
				if($p==1) $sql_subcon .="and (a.id not in(".implode(',',$subrow).")"; else  $sql .=" OR a.id not in(".implode(',',$subrow).")";
				$p++;
			}
			$sql_subcon .=")";
			$sql_subcon .=" GROUP BY a.id,a.batch_no,a.company_id, f.shift_name,f.floor_id,d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.total_trims_weight,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks ";
			//echo $sql_subcon ;
			}
		}
		else if($cbo_type==2)//   For Order Wise Dyeing Production
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
			 $sql="(select f.insert_date,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.grouping,c.file_no, d.job_no as job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.total_trims_weight, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type,c.grouping,c.file_no,d.job_no, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order,f.insert_date)
			 union
			 (
				select  f.insert_date, a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,b.item_description, b.po_id, b.prod_id, b.width_dia_type,null, null,null, null, h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date,
			    f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond  $workingCompany_name_cond2 and f.batch_id=a.id  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  $dates_com  $batch_num  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $booking_no_cond $booking_id_cond  $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type,
			              f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,
			              f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks,f.insert_date
						 ) $order_by2";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
				$sql_subcon="select f.insert_date,a.batch_no,a.id, a.batch_weight, a.color_id,a.booking_no, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.order_no) AS po_number, d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $booking_no_cond $booking_id_cond  $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond
				GROUP BY a.batch_no, a.id,a.batch_weight, a.color_id,a.booking_no, a.extention_no,a.total_trims_weight, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.subcon_job, d.party_id, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result,f.insert_date $order_by";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
				  $sql_sam="(select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type,c.file_no,c.grouping, LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number, d.job_no as job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, fabric_type,f.result from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $booking_no_cond $booking_id_cond  $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.job_no, d.buyer_name, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no,c.file_no,c.grouping, f.result,f.insert_date )
			 union
			 (
			 select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type,null, null,null, null, h.buyer_id as buyer_name,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond $workingCompany_name_cond2 and f.batch_id=a.id and f.batch_id=b.mst_id $dates_com  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.insert_date)  $order_by2";
			}
		}
		else if($cbo_type==3)//  For Daily Right First Time
		{

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
			$sql="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and f.batch_id=b.mst_id and a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id,a.booking_no, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no, d.buyer_name, f.production_date,f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ";
				$sql_ltb="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
				from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id  and f.batch_id=b.mst_id and a.batch_against in(1) and f.ltb_btb_id=2 and f.result in(1,2,3,4,5) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no,a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no, d.buyer_name, f.production_date,f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no";
			}

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
		  $sql_subcon="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.order_no)  AS po_number,d.subcon_job,d.subcon_job as job_no_prefix_num,d.party_id,f.production_date as process_end_date,f.process_end_date as production_date,f.ltb_btb_id,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id in(2) and a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $booking_no_cond $booking_id_cond  $cbo_prod_source_cond GROUP BY a.id,a.batch_no,a.company_id, d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.party_id,f.production_date,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks ";

		 $sql_subcon_ltb="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.order_no) as po_number,d.subcon_job,d.subcon_job as job_no_prefix_num,d.party_id,f.ltb_btb_id,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id  $companyCond $workingCompany_name_cond2 $booking_no_cond $booking_id_cond  and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id in(2) and a.batch_against in(1) and f.result in(1,2,3,4,5)  and f.ltb_btb_id=2 and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY a.id,a.batch_no,a.company_id, d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.party_id,f.production_date,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks,f.ltb_btb_id ";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // For Sample Production
			{
			 $sql_btb_sam="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond and $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(3) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no,a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst,d.buyer_name, f.production_date,f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ";
			$sql_ltb_sam="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond and $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and f.batch_id=b.mst_id and a.batch_against in(3) and f.ltb_btb_id=2 and f.result in(1,2,3,4,5) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no,a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.buyer_name, f.production_date,f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no";
			}
		}
		else if($cbo_type==4)//  For Daily Dyeing Reprocess Summary
		{
			$sql="select a.company_id, a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.floor_id,f.shift_name,f.load_unload_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g
	where f.batch_id=a.id  $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.extention_no!=0 and a.batch_against in(2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no,a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst,d.job_no, d.buyer_name, f.production_date,f.process_end_date,f.end_hours, f.end_minutes, f.machine_id,f.floor_id,f.shift_name, f.load_unload_id, f.result, f.remarks  $order_by ";
		}
	}
	//$batchdata=sql_select($sql);
		//echo $sql_subcon; die;sql_subcon_ltb
	//	echo $sql;
	if($cbo_type==3) // For RFT
	{
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			$sql_subcon_data_ltb=sql_select($sql_subcon_ltb);
			$sql_subcon_data_btb=sql_select($sql_subcon);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//$batchdata=sql_select($sql);
			$batchdata_ltb=sql_select($sql_ltb);
			$batchdata=sql_select($sql);
		}

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
		{
			//$batchdata=sql_select($sql);
			$batchdata_ltb_sam=sql_select($sql_ltb_sam);
			$batchdata_btb_sam=sql_select($sql_btb_sam);

		}
	}
	if($cbo_type==2) // Dyeing Production
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//echo $sql;
			$batchdata=sql_select($sql);
			$batch_ids='';$po_ids='';
			foreach($batchdata as $row)
			{
				if($batch_ids=='') $batch_ids=$row[csf('id')]; else $batch_ids.=",".$row[csf('id')];
				if($po_ids=='') $po_ids=$row[csf('po_id')]; else $po_ids.=",".$row[csf('po_id')];
			}
			$batch_idss=implode(",",array_unique(explode(",",$batch_ids)));
			$po_idss=implode(",",array_unique(explode(",",$po_ids)));
			if($db_type==0)
			{
				if($batch_idss!='') $batch_id_cond="and a.id in($batch_idss)"; else $batch_id_cond="";
				if($batch_idss!='') $knit_batch_id_cond="and c.mst_id in($batch_idss)"; else $knit_batch_id_cond="";
				if($batch_idss!='') $dyeing_batch_id_cond="and f.batch_id in($batch_idss)"; else $dyeing_batch_id_cond="";
				if($po_idss!='') $dyeing_po_id_cond="and b.po_breakdown_id in($po_idss)"; else $dyeing_po_id_cond="";
			}
		}
		else if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon;
			$sql_subcon_data=sql_select($sql_subcon);
			$subcon_batch_ids='';
			foreach($sql_subcon_data as $row)
			{
				if($subcon_batch_ids=='') $subcon_batch_ids=$row[csf('id')]; else $subcon_batch_ids.=",".$row[csf('id')];
			}
			$subcon_batch_idss=implode(",",array_unique(explode(",",$subcon_batch_ids)));
			if($db_type==0)
			{
				if($subcon_batch_idss!='') $sub_batch_id_cond="and a.id in($subcon_batch_idss)"; else $sub_batch_id_cond="";
				if($subcon_batch_idss!='') $dye_sub_batch_id_cond="and f.batch_id in($subcon_batch_idss)"; else $dye_sub_batch_id_cond="";
			}
		}
		else if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) //Batch Aganist - Sample
		{
			//echo $sql_sam;
			$batchdata_sam=sql_select($sql_sam);
			$sam_batch_ids='';
			foreach($batchdata_sam as $row)
			{
				if($sam_batch_ids=='') $sam_batch_ids=$row[csf('id')]; else $sam_batch_ids.=",".$row[csf('id')];
			}
			$sam_batch_idss=implode(",",array_unique(explode(",",$sam_batch_ids)));
			if($db_type==0)
			{
				if($sam_batch_idss!='') $sam_batch_id_cond="and a.id in($sam_batch_idss)"; else $sam_batch_id_cond="";
			}

		}
	//print_r($sql_subcon_data);
	}
	if($cbo_type==1)
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon.'xdf';
			$sql_subcon_data=sql_select($sql_subcon);
		}
	//print_r($sql_subcon_data);
	}
	if($cbo_type==4)
	{
		$batchdata=sql_select($sql);
		/*if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon.'xdf';
			$sql_subcon_data=sql_select($sql_subcon);
		}*/
	//print_r($sql_subcon_data);
	}

	if($date_search_type==1)
	{
		$date_type_msg="Dyeing Date";
	}
	else
	{
		$date_type_msg="Insert Date";
	}
	$yarn_lot_arr=array();
	if($db_type==0)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='' $dyeing_po_id_cond  group by a.prod_id, b.po_breakdown_id");
		/*
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b, pro_batch_create_dtls c,pro_fab_subprocess f where a.id=b.dtls_id  and c.prod_id=a.prod_id and b.po_breakdown_id=c.po_id and f.batch_id=c.mst_id and f.entry_form=35 and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='' $unload_batch_cond2 $dates_com $cbo_prod_source_cond $shift_name_cond $cbo_prod_type_cond  $knit_batch_id_cond group by a.prod_id, b.po_breakdown_id");*/
	}
	else if($db_type==2)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)  as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' group by a.prod_id, b.po_breakdown_id");
	}
	foreach($yarn_lot_data as $rows)
	{
		$yarn_lot=explode(",",$rows[csf('yarn_lot')]);
		$yarn_lot_arr[$rows['prod_id']][$rows['po_breakdown_id']]=implode(",",array_unique($yarn_lot));
	}

		//print_r($yarn_lot_arr);
	$load_hr=array();
	$load_min=array();
	$load_date=array();
	$water_flow_arr=array();$load_hour_meter_arr=array();
	if ($working_company==0) $workingCompany_name_cond1=""; else $workingCompany_name_cond1="  and service_company='".$working_company."' ";
	if ($working_company==0) $workingCompany_name_cond13=""; else $workingCompany_name_cond13="  and f.service_company='".$working_company."' ";
	if ($company==0) $companyCond1=""; else $companyCond1="  and f.company_id=$company";


	$load_time_data=sql_select("select f.batch_id,f.water_flow_meter,f.batch_no,f.load_unload_id,f.process_end_date,f.end_hours,f.hour_load_meter,f.end_minutes from pro_fab_subprocess f where f.load_unload_id=1 and f.entry_form=35 $companyCond1 and  f.status_active=1  and f.is_deleted=0 $workingCompany_name_cond13 $dyeing_batch_id_cond");
	foreach($load_time_data as $row_time)// for Loading time
	{
		$load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}

	$subcon_load_hr=array();
	$subcon_load_min=array();
	$subcon_load_date=array();$subcon_load_hour_meter_arr=array();
	$subcon_water_flow_arr=array();
	$subcon_load_time_data=sql_select("select f.batch_id,f.water_flow_meter,f.batch_no,f.load_unload_id,f.process_end_date,f.end_hours,f.hour_load_meter,f.end_minutes from pro_fab_subprocess f where f.load_unload_id=1 and f.entry_form=38 $companyCond1  and f.status_active=1  and f.is_deleted=0 $unload_batch_cond2  $cbo_prod_source_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $workingCompany_name_cond1 $dyeing_batch_id_cond");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
		$subcon_load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$subcon_load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$subcon_load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$subcon_water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$subcon_load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_unload_hr=array();
	$subcon_unload_min=array();
	$subcon_unload_date=array();
	$subcon_unload_time_data=sql_select("select f.batch_id,f.batch_no,f.load_unload_id,f.production_date,f.end_hours,f.end_minutes from pro_fab_subprocess f where f.load_unload_id=2 and f.entry_form=38 $companyCond1 $workingCompany_name_cond1 and f.status_active=1  and f.is_deleted=0 $unload_batch_cond2  $cbo_prod_source_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $dyeing_batch_id_cond");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
	$subcon_unload_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
	$subcon_unload_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
	$subcon_unload_time_data[$row_time[csf('batch_id')]]=$row_time[csf('production_date')];
	}
	//var_dump($load_hr);

	$m_capacity=array();
	$unload_min=array();
	$machine_arr=return_library_array( "select id,$field_concat from  lib_machine_name order by seq_no ",'id','machine_name');
	$machine_capacity_data=sql_select("select id,prod_capacity as m_capacity  from lib_machine_name where status_active=1  and is_deleted=0 ");
	foreach($machine_capacity_data as $capacity)// for Un-Loading time
	{
		$m_capacity[$capacity[csf('id')]]=$capacity[csf('m_capacity')];
	}

	$sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=35 $companyCond1 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0  $unload_batch_cond2  $cbo_prod_source_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $dyeing_batch_id_cond");
	$tot_row=1;$batch_id='';
	foreach($sql_batch_id as $row_batch)
	{
	if($batch_id=='') $batch_id=$row_batch[csf('batch_id')];else $batch_id.=",".$row_batch[csf('batch_id')];
	$batch_unload_check[$row_batch[csf('batch_id')]]=$row_batch[csf('batch_id')];

	}//echo $batch_id;die;
		unset($sql_batch_id);

		if($batch_id!='')
		{
			$batchIds=chop($batch_id,','); $batchIds_cond="";
			$tot_ids=count(array_unique(explode(",",$batch_id)));
			//echo $tot_ids.'d';
			if($db_type==2 && $tot_ids>999)
			{
				$batchIds_cond=" and (";
				$batchIdsArr=array_chunk(explode(",",$batchIds),999);
				foreach($batchIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					$batchIds_cond.=" a.id not in($ids) or ";
				}
				$batchIds_cond=chop($batchIds_cond,'or ');
				$batchIds_cond.=")";
			}
			else
			{
				$batchIds=implode(",",array_unique(explode(",",$batchIds)));
				$batchIds_cond=" and a.id not in($batchIds)";
			}
		}
		//echo $batchIds_cond;
	if($cbo_type==1)//  For Dyeing WIP
	{
		$sub_sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=38 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0 $unload_batch_cond2 $dates_com $cbo_prod_source_cond $shift_name_cond $cbo_prod_type_cond  $dye_sub_batch_id_cond ");
		//echo "select f.batch_id from  pro_fab_subprocess f where f.entry_form=38 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0 $unload_batch_cond2 $dates_com $cbo_prod_source_cond $shift_name_cond $cbo_prod_type_cond";die;
		$k=1;
		foreach($sub_sql_batch_id as $row_batch)
		{
			if($k!=1) $sub_batch_id.=",";
			$sub_batch_id.=$row_batch[csf('batch_id')];

			$k++;
		}
		if($batch_id=="") $batch_id=0;
		if($sub_batch_id=="") $sub_batch_id=0;
	}
 ob_start();
	?>
	
	<?
	
	if($cbo_type==1)//Dyeing WIP Start
	{
	?>
	<div>
	<fieldset style="width:1270px;">
	<div  align="center"> <strong> <? echo $company_library[$company]; ?> </strong><br><strong> Dyeing WIP </strong> </div>
    <div>
    <?
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{

	if (count($batchdata)>0)
	{
	?>
     <div align="left"> <b>Self batch </b></div>
	 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header_1">
			<thead>
				<tr>
					<th width="30">SL</th>
                     <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift</th>
                         <? } ?>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="70">Dia/ Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="100">Booking No</th>
					<th width="40">Ext. No</th>
					<th width="80">Dyeing Qty.</th>
					<th width="60">Lot No</th>
					<th width="100">Loading Date & Time</th>
					<th>Reprocess</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:360px; width:1390px; overflow-y:scroll;" id="scroll_body">
	<table class="rpt_table" id="table_body" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
	<tbody>
				<?
				$i=1;$k=1;
				$f=0;
				$btq=0;$grand_total_batch_qty=0;
				$batch_chk_arr=array();$group_by_arr=array();
				foreach($batchdata as $batch)
				{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				if($batch_unload_check[$batch[csf('id')]]=='')
				{
				if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <td colspan="3">Sub.Total: </td>
                                    <td width="80"><? echo number_format($btq,2); ?></td>
                                    <td width="60"></td>
                                    <td width="100"></td>

                                    <td width="90">&nbsp;</td>
                                </tr>
								<?
								unset($btq);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="15" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}

				$order_id=$batch[csf('po_id')];
				$color_id=$batch[csf('color_id')];
				$desc=explode(",",$batch[csf('item_description')]);
				$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
				?>
				<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">

					<td width="30"><? echo $i; ?></td>

                     <? if($group_by==3 || $group_by==0){ ?>
                       <td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>


					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? //echo $color_library[$batch[csf('color_id')]]; ?>"><p class="wrap_break"><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p class="wrap_break"><? echo $po_number; ?></p></td>


					<td  width="100" title="<? echo $batch[csf('prod_id')]; ?>"><p class="wrap_break"><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="70" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p class="wrap_break"><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="center" width="100"><p><? echo $batch[csf('booking_no')]; ?></p></td>
					<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
					<td align="right" width="80"   title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
					<td align="left" width="60" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
					<td width="100"><p><?   echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>

					<td align="center" width="90" title="<? if($batch[csf('batch_against')]==2) echo $batch_against[$batch[csf('batch_against')]]; ?>"><?  if($batch[csf('batch_against')]==2) echo $batch_against[$batch[csf('batch_against')]];?> &nbsp;</td>
				</tr>
	<?
	$i++;
	$btq+=$batch[csf('batch_qnty')];

	$grand_total_batch_qty+=$batch[csf('batch_qnty')];
				}
	} //batchdata froeach
	 ?>
	</tbody>
	</table>
	 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
			<tfoot>
            <?
            if($group_by!=0)
				{
					?>
				<tr>
					<th width="30">&nbsp;</th>
					 <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">&nbsp;</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } ?>
					<th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="70">&nbsp;</th>
					<th width="80">&nbsp;</th>

                    <th colspan="3" width="230">Total</th>
					<th width="80" align="right"><? echo number_format($btq,2); ?></th>

					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
				</tr>
                <?
				}
				?>
                <tr>
					<th width="30">&nbsp;</th>
					 <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">&nbsp;</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } ?>
					<th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="70">&nbsp;</th>
					<th width="80">&nbsp;</th>

                    <th colspan="3" width="230">GrandTotal</th>
					<th width="80" align="right"><? echo number_format($grand_total_batch_qty,2); ?></th>

					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
				</tr>
			</tfoot>
	</table>
	</div>
    <br/>
     <?
	}

	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if(count($sql_subcon_data)>0)
		{
		?>
		<div align="left"> <b>SubCon batch </b></div>
			 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="">
				<thead>
					<tr>
						<th width="30">SL</th>
						<? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift</th>
                         <? } ?>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70">Dia/ Width Type</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="100">Booking No</th>
						<th width="40">Ext. No</th>
						<th width="80">Dyeing Qty.</th>
						<th width="60">Lot No</th>
						<th width="100">Loading Date & Time</th>
						<th  width="">Reprocess</th>
					</tr>
				</thead>
			</table>
		<div style=" max-height:360px; width:1390px; overflow-y:scroll;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
		<tbody>
					<?
					$m=1;$k=1;
					$n=0;$grand_sub_btq=0;
					$sub_btq=0;
					$subbatch_chk_arr=array();$sub_group_by_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($m%2==0) $subbgcolor="#E9F3FF"; else $subbgcolor="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$sub_group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <td colspan="3">Sub.Total: </td>
                                    <td width="80"><? echo number_format($sub_btq,2); ?></td>
                                    <td width="60"></td>
                                    <td width="100"></td>

                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($sub_btq);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="15" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$sub_group_by_arr[]=$group_value;
							$k++;
						}
					}

					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					?>
					<tr bgcolor="<? echo $subbgcolor; ?>" onClick="change_color('tr_<? echo $m; ?>','<? echo $subbgcolor;?>')" id="tr_<? echo $m; ?>">

						<td width="30"><? echo $m; ?></td>
                          <? if($group_by==3 || $group_by==0){ ?>
                       <td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>

						<td  width="100" ><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? //echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td width="90" title="<? echo $po_number; ?>"><p class="wrap_break"><? echo $po_number; ?></p></td>


						<td  width="100"><p class="wrap_break"><? echo $batch[csf('item_description')]; ?></p></td>
						<td  width="70" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						<td  align="center" width="90" ><p class="wrap_break"><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="100" ><p><? echo $batch[csf('booking_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="80"   title="<? echo $batch[csf('sub_batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>
						<td align="left" width="60" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
						<td width="100"><p><?  echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>

						<td align="center"  title="<? if($batch[csf('batch_against')]==2) echo $batch_against[$batch[csf('batch_against')]]; ?>"><?  if($batch[csf('batch_against')]==2) echo $batch_against[$batch[csf('batch_against')]];?> &nbsp;</td>
					</tr>
		<?
		$m++;
		$sub_btq+=$batch[csf('sub_batch_qnty')];
		$grand_sub_btq+=$batch[csf('sub_batch_qnty')];
		} //batchdata froeach
		 ?>
		</tbody>
		</table>
		 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
				<tfoot>
                 <?
            if($group_by!=0)
				{
					?>
					<tr>
						<th width="30">&nbsp;</th>
						<? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">&nbsp;</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } ?>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="40">Total</th>
						<th width="80"><? echo number_format($sub_btq,2); ?></th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
                    <?
				}
					?>
                    <tr>
						<th width="30">&nbsp;</th>
						<? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">&nbsp;</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } ?>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>

						<th colspan="3" width="230">GrandTotal</th>
						<th width="80"><? echo number_format($grand_sub_btq,2); ?></th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</tfoot>
		</table>
		</div>
		</div>
		 <?
		}
	}
	?>
	</fieldset>
	</div>
	<?
	}
	else if($cbo_type==2) //  Dyeing Production
	{
		?>
		<div>
		<style>
    	.wrap_break
		{
			word-break:break-all;
			word-wrap:break-word;
		}
    </style>
		<fieldset style="width:1350px;">
		<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Dyeing Production </strong><br>
		<?
			//echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
			echo  ($date_from == '0000-00-00' || $date_from == '' ? '' : change_date_format($date_from)).' To ';echo  ($date_to == '0000-00-00' || $date_to == '' ? '' : change_date_format($date_to));
			?>
		 </div>
		 <?

		 if ($cbo_result_name==1 || $cbo_result_name==0)
		 {

		 ?>
		 <div>
         <table cellpadding="0"  width="300" cellspacing="0" align="left"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="3">Production Summary</th>
								</tr>
								<tr>
									<th>Details </th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?

							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
							 $sql="select f.load_unload_id,f.process_end_date,count(f.process_end_date) as row_count, SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0  $batch_id_cond $prod_date_upto $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY f.load_unload_id,f.process_end_date  ";
							$sql_datas=sql_select($sql);
							}
							$unload_qty_arr=array();$plan_cycle_time=0;
							foreach($sql_datas as $row)
							{
								$tot_row=count($row[csf('process_end_date')]);
								$unload_qty_arr[$row[csf('load_unload_id')]]['qty']+=$row[csf('batch_qnty')];
								$unload_qty_arr[$row[csf('load_unload_id')]]['count']+=$tot_row;
							}

							//print_r($unload_qty_arr);
							$total_current_mon_qty=$unload_qty_arr[2]['qty'];
							$total_count=$unload_qty_arr[2]['count'];

							 $sql_result="select f.fabric_type,f.process_end_date,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and f.status_active=1 and f.is_deleted=0  $batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $booking_no_cond $booking_id_cond$cbo_prod_type_cond $cbo_prod_source_cond GROUP BY f.fabric_type,f.process_end_date  ";//and f.fabric_type in(1,4,5,6)
							$sql_result=sql_select($sql_result);
							$fabric_batch_arr=array();
							foreach($sql_result as $row)
							{
								$fabric_batch_arr[$row[csf('fabric_type')]]['qty']+=$row[csf('batch_qnty')];
								//$tot_batch_qty+=$row[csf('batch_qnty')];
							}

							//print_r($fabric_batch_arr);

								?>
								  <tr bgcolor="#E9F3FF" style="cursor:pointer;">

									  <td>Current Month</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty,2);?></td>
									  <td align="right"><?  ?></td>
								  </tr>
                                  <tr bgcolor="#D8D8D8" style="cursor:pointer;">

									  <td>Avg. Prod. Per Day</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty/$total_count,2); ?></td>
									  <td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
								  </tr>
                                  <? $k=1;	$tot_batch_qty=0;
								 //$fabric_type_for_dyeing2=array(1=>'Cotton',2=>'Polyster',3=>'Lycra',4=>'Both Part',5=>'White',6=>'Wash');

								  //print_r($fabric_type_for_dyeingnn);
								  foreach($fabric_batch_arr as $typekey=>$val)
								  	{
										if ($k%2==0) $bgcolor="#FFFFFF"; else $bgcolor="#E9F3FF";
										if($typekey==1)
										{
											$fab_type="Cotton";
										}
										else if($typekey==2)
										{
											$fab_type="Polyster";
										}
										else if($typekey==3)
										{
											$fab_type="Lycra";
										}
										else if($typekey==4)
										{
											$fab_type="Both Part";
										}
										else if($typekey==5)
										{
											$fab_type="White";
										}
										else if($typekey==6)
										{
											$fab_type="Wash";
										}
											  ?>
                                   <tr bgcolor="<? echo $bgcolor;?>">
									 <? //print_r($fabric_type_for_dyeing);?>
									  <td><?php echo $fabric_type_for_dyeing[$typekey]; ?></td>
                                       <td align="right"><? echo number_format($val['qty'],2); ?></td>
									  <td align="right"><? echo number_format(($val['qty']/$total_current_mon_qty)*100,2); ?></td>
								  </tr>
							<? 		$tot_batch_qty+=$val['qty'];
								  	$k++;
									}

							?>
							</tbody>
							<tfoot>
								<tr>
									<th align="right">Total </th>
									<th align="right"><b><? echo number_format($tot_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format(($tot_batch_qty/$total_current_mon_qty*100),2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>

			<table cellpadding="0"  width="1210" cellspacing="0" align="left" >
				 <tr>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">Self n Trims Batch (Shade Match)</th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
								if($db_type==0)
								{
									$sum_grp="group_concat(distinct c.po_number) as po_number";
								}
								else
								{
									$sum_grp="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number";
								}

							$sql_dt="(select a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, $sum_grp,c.grouping,c.file_no, d.job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2   $batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0
						 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.total_trims_weight, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type,c.grouping,c.file_no,d.job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order)
						 union
						 (
							select a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,b.item_description, b.po_id, b.prod_id, b.width_dia_type,null, null,null, null, h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date,
				f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond  $workingCompany_name_cond2 and f.batch_id=a.id and f.batch_id=b.mst_id and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.result=1 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $batch_id_cond $dates_com  $batch_num $buyerdata2  $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $buyerdata2 $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type,
						  f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,
						  f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks
						 )  order by buyer_name";
						 $sql_d=sql_select($sql_dt);$total_batch_qty2=0;
						 $buyer_trims_self_arr=array();
						 foreach($sql_d as $row)
						 {
							  $buyer_trims_self_arr[$row[csf('buyer_name')]]['trims']+=$row[csf('total_trims_weight')];
							  $buyer_trims_self_arr[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
							  $total_batch_qty2+=$row[csf('batch_qnty')]+$row[csf('total_trims_weight')];
						 }
						 unset($sql_d);
			       }


							$k=1;$total_batch_qty=0;$tot_batch_per=0;
							foreach($buyer_trims_self_arr as $key=>$val)
							{
								if ($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
								//$trims_qty=$party_batch_arr[$key]['trims_weight'];
								 $trims_qty_sum=$val['trims'];
								?>
								  <tr bgcolor="<? echo $bgcolor; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right"><? echo number_format($val['qty']+$trims_qty_sum,2,'.',''); $total_batch_qty+=$val['qty']+$trims_qty_sum; ?></td>
									  <td align="right"><? $batch_per=(($val['qty']+$trims_qty_sum)/$total_batch_qty2)*100; echo number_format($batch_per,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$tot_batch_per+=$batch_per;
							$k++;
							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($tot_batch_per,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
                     <td width="50"> </td>
                      <td width="300">
                      <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">Sample n Trims Batch (Shade Match)</th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{

								if($db_type==0)
								{
									if($sam_batch_idss!='') //$sam_batch_id_cond="and a.id in($sam_batch_idss)"; else $sam_batch_id_cond="";
									{

							$sql_sam="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $sam_batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary $booking_no_cond $booking_id_cond $cbo_prod_type_cond $cbo_prod_source_cond group by d.buyer_name,a.total_trims_weight )
								union
			 					(
			 select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  h.booking_no=a.booking_no  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $sam_batch_id_cond $dates_com  $buyerdata2 $batch_num  $year_cond $color_name   $result_name_cond_summary $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond
			 					GROUP BY h.buyer_id,a.total_trims_weight)";
									}
								}
								else
								{
									$sql_sam="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $sam_batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond group by d.buyer_name,a.total_trims_weight )
								union
			 					(
			 select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and h.booking_no=a.booking_no  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0  $dates_com  $buyerdata2 $batch_num  $year_cond $color_name   $result_name_cond_summary $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond
			 					GROUP BY h.buyer_id,a.total_trims_weight)";
								}
							$sql_data_sam=sql_select($sql_sam);
							//echo $sql_sam;die;
							}

							$samp_party_batch_arr=array(); $tot_batch_qty_sam=0;$tot_batch_trims_qty_sam=0;
							foreach($sql_data_sam as $row)
							{
								$samp_party_batch_arr[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
								$samp_party_batch_arr[$row[csf('buyer_name')]]['trims_qty']+=$row[csf('trims_weight')];
								$samp_party_batch_arr[$row[csf('buyer_name')]]['buyer']=$row[csf('buyer_name')];
								$tot_batch_qty_sam+=$row[csf('batch_qnty')]+$row[csf('trims_weight')];
								//$tot_batch_trims_qty_sam+=$row[csf('trims_weight')];
							}
							unset($sql_data_sam);
							$k=1;$total_batch_qty_sam=0;$tot_batch_per_sam=0;
							foreach($samp_party_batch_arr as $key=>$val)
							{
								if ($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
								$smp_trims=$samp_party_batch_arr[$key]['trims_qty'];
								?>
								  <tr bgcolor="<? echo $bgcolor; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right" title="Batch Qty+Trims Qty"><? echo number_format($samp_party_batch_arr[$key]['qty']+$smp_trims,2,'.',''); $total_batch_qty_sam+=$samp_party_batch_arr[$key]['qty']+$smp_trims; ?></td>
									  <td align="right"><? $batch_per_sam=(($samp_party_batch_arr[$key]['qty']+$smp_trims)/$tot_batch_qty_sam)*100; echo number_format($batch_per_sam,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$tot_batch_per_sam+=$batch_per_sam;
							$k++;
							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty_sam,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($tot_batch_per_sam,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						  <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">SubContact Batch (Shade Match)</th>
								</tr>
								<tr>
									<th width="20">SL </th>
									<th width="140">Buyer </th>
									<th width="70">Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
                            </table>

                            <div style="width:300px; overflow-y:scroll; max-height:210px" id="scroll_body" >
                            <table class="rpt_table" width="280" cellpadding="0" cellspacing="0" border="1" rules="all">
							<tbody>
							<?

							//echo $batch_type=str_replace("'",'',$cbo_batch_type);
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
							{
						   $sql_sub="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and f.result=1  and a.batch_against in(1,2) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 $sub_batch_id_cond $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.party_id ";
						   $sql_data_sub=sql_select($sql_sub);
							}
							$sub_party_batch_arr=array();$tot_sub_batch_qty=0;
							foreach($sql_data_sub as $row)
							{
								$sub_party_batch_arr[$row[csf('party_id')]]['qty']=$row[csf('sub_batch_qnty')];
								$sub_party_batch_arr[$row[csf('party_id')]]['buyer']=$row[csf('party_id')];
								$tot_sub_batch_qty+=$row[csf('sub_batch_qnty')];
							}
							$p=1;$total_sub_batch_qty=0;$total_batch_per_sub=0;
							foreach($sub_party_batch_arr as $id=>$sval)
							{
								if ($p%2==0) $bgcolor_sub="#E9F3FF"; else $bgcolor_sub="#FFFFFF";

								?>
								  <tr bgcolor="<? echo $bgcolor_sub; ?>" style="cursor:pointer;">
									  <td  width="20" ><? echo $p; ?></td>
									  <td width="140"><? echo $buyer_arr[$id] ?></td>
									  <td  width="70" align="right"><? echo number_format($sub_party_batch_arr[$id]['qty'],2,'.',''); $total_sub_batch_qty+=$sub_party_batch_arr[$id]['qty']; ?></td>
									  <td align="right"><? $batch_per_sub=($sub_party_batch_arr[$id]['qty']/$tot_sub_batch_qty)*100; echo number_format($batch_per_sub,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$total_batch_per_sub+=$batch_per_sub;
							$p++;
							}
							?>
							</tbody>
                            <tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_sub_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($total_batch_per_sub,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
                            </table>
                            </div>

						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="5">Summary Total(Shade Match)</th>
								</tr>
								<tr>
									<th>Self Batch</th>
									<th>Sample Batch</th>
                                    <th>SubCon Batch</th>
									<th>Total</th>
								</tr>
							</thead>
							<tbody>
								 <tr bgcolor="#FFFFFF"  style="cursor:pointer;">
									  <td width="30"><? echo number_format($total_batch_qty,2); ?></td>
                                      <td width="30"><? echo number_format($total_batch_qty_sam,2); ?></td>
									  <td width="30"><? echo number_format($total_sub_batch_qty,2); ?></td>
									  <td width="30"><? $grand_total=$total_batch_qty+$total_sub_batch_qty+$total_batch_qty_sam; echo number_format($grand_total,2)?></td>
								  </tr>
								  <tr bgcolor="#E9F3FF">
								   <td><?  echo number_format(($total_batch_qty/$grand_total)*100,2).'%'; ?></td>
                                   <td><?  echo number_format(($total_batch_qty_sam/$grand_total)*100,2).'%'; ?></td>
									  <td><?  echo number_format(($total_sub_batch_qty/$grand_total)*100,2).'%'; ?></td>
									  <td><?  echo '100%'; ?></td>
								  </tr>
							</tbody>
						</table>
					 </td>
				 </tr>
			 </table>
		 </div>
		 <br />
		 <?
		}
		 if ($cbo_result_name!=1 || $cbo_result_name==0)
		 {

		 ?>
		  <div>
          	<table cellpadding="0" style="border:0"  width="300" cellspacing="0" align="left"  class="rpt_table" rules="all" border="0">

            <tr>
                <th colspan="4"></th>
            </tr>

			</table>
			 <table cellpadding="0"  width="1210" cellspacing="0" align="left" >
				 <tr>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">Self n Trims Batch (Not Shade Match) </th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0) $result_name_cond_summary_not=" and f.result!=1"; else $result_name_cond_summary_not="  and f.result='".$cbo_result_name."' ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{

							if($db_type==0)
							{
								if($subcon_batch_idss!='')
								{


								$sql_not="select d.buyer_name,a.total_trims_weight as trims_weight,  SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 $dye_sub_batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.buyer_name,a.total_trims_weight ";
								$sql_data_not=sql_select($sql_not);
								}

							}
							else
							{
								$sql_not="select d.buyer_name,a.total_trims_weight as trims_weight,  SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.buyer_name,a.total_trims_weight ";
							$sql_data_not=sql_select($sql_not);
							}


							}

							$tot_batch_qty_not=0;$total_batch_qty_not=0;
							$party_batch_arr_not=array();
							foreach($sql_data_not as $row)
							{
								$party_batch_arr_not[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
								$party_batch_arr_not[$row[csf('buyer_name')]]['trims_weight']+=$row[csf('trims_weight')];
								$party_batch_arr_not[$row[csf('buyer_name')]]['buyer']=$row[csf('buyer_name')];
								$tot_batch_qty_not+=$row[csf('batch_qnty')]+$row[csf('trims_weight')];
							}
							$k=1;$total_batch_per_not=0;
							foreach($party_batch_arr_not as $key=>$val)
							{
								if ($k%2==0) $bgcolor_not="#E9F3FF"; else $bgcolor_not="#FFFFFF";
								$trims_not=$party_batch_arr_not[$key]['trims_weight'];
								//echo $trims_not.'ad'.$party_batch_arr_not[$key]['qty'];
								?>
								  <tr bgcolor="<? echo $bgcolor_not; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right"><? echo number_format($party_batch_arr_not[$key]['qty']+$trims_not,2,'.',''); $total_batch_qty_not+=$party_batch_arr_not[$key]['qty']+$trims_not; ?></td>
                                      <td align="right"><? $batch_per_not=(($party_batch_arr_not[$key]['qty']+$trims_not)/$tot_batch_qty_not)*100; echo number_format($batch_per_not,2,'.','').'%'; ?></td>
                                      </tr>
							<?
							$total_batch_per_not+=$batch_per_not;
							$k++;

							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty_not,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($total_batch_per_not,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
                     <td width="50"></td>
					 <td width="300">
                     <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">Sample n Trims Batch(Not Shade Match)</th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0) $result_name_cond_summary_not=" and f.result!=1"; else $result_name_cond_summary_not="  and f.result='".$cbo_result_name."' ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
							if($db_type==0)
								{
									if($sam_batch_idss!='') //$sam_batch_id_cond="and a.id in($sam_batch_idss)"; else $sam_batch_id_cond="";
									{

							  $sql_sam_not="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $sam_batch_id_cond $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond group by d.buyer_name,a.total_trims_weight)
								union
			 					(
			 select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  h.booking_no=a.booking_no  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com  $batch_num $buyerdata2 $year_cond $color_name   $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $shift_name_cond $machine_cond $sam_batch_id_cond $floor_id_cond $booking_no_cond $booking_id_cond GROUP BY h.buyer_id,a.total_trims_weight)";
			 					$sql_data_not_samp=sql_select($sql_sam_not);
								}
					 		}
							else
							{
								$sql_sam_not="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond group by d.buyer_name,a.total_trims_weight)
								union
			 					(
			 select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  h.booking_no=a.booking_no  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com  $batch_num $buyerdata2 $year_cond $color_name   $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $shift_name_cond $machine_cond  $floor_id_cond $booking_no_cond $booking_id_cond GROUP BY h.buyer_id,a.total_trims_weight)";
								$sql_data_not_samp=sql_select($sql_sam_not);
							}


							}
							$total_batch_per_not_samp=0;$total_batch_qty_not_samp=0;
							$party_batch_arr_not_sam=array();
							foreach($sql_data_not_samp as $row)
							{
								$party_batch_arr_not_sam[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
								$party_batch_arr_not_sam[$row[csf('buyer_name')]]['trims_qty']+=$row[csf('trims_weight')];
								$party_batch_arr_not_sam[$row[csf('buyer_name')]]['buyer']=$row[csf('buyer_name')];
								$total_batch_qty_not_samp+=$row[csf('batch_qnty')]+$row[csf('trims_weight')];

							}
							$k=1;//$total_batch_qty_not_samp=0;
							foreach($party_batch_arr_not as $key=>$val)
							{
								if ($k%2==0) $bgcolor_not="#E9F3FF"; else $bgcolor_not="#FFFFFF";
								$trims_samp_not=$party_batch_arr_not_sam[$key]['trims_qty'];
								?>
								  <tr bgcolor="<? echo $bgcolor_not; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right" title="Batch Qty+Trims Qty"><? echo number_format($party_batch_arr_not_sam[$key]['qty']+$trims_samp_not,2,'.',''); //$total_batch_qty_not_samp+=$party_batch_arr_not_sam[$key]['qty']+$trims_samp_not; ?></td>
                                      <td align="right"><? $batch_per_not_samp=($party_batch_arr_not_sam[$key]['qty']+$trims_samp/$total_batch_qty_not_samp)*100; echo number_format($batch_per_not_samp,2,'.','').'%'; ?></td>
                                      </tr>
							<?
							$total_batch_per_not_samp+=$batch_per_not_samp+$trims_samp_not;
							$k++;

							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty_not_samp,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($total_batch_per_not_samp,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">SubContact Batch (Not Shade Match)</th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?

							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
							{
								if($db_type==0)
								{
								if($subcon_batch_idss!='')
								{
						    		$sql_sub_not="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and f.batch_id=b.mst_id and a.batch_against in(1,2) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not $dye_sub_batch_id_cond  $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.party_id ";
						   			$sql_data_sub_not=sql_select($sql_sub_not);
						   		}
						  	 }
							 else
							 {
							 	  $sql_sub_not="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.batch_id=b.mst_id and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not  $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.party_id ";
						   $sql_data_sub_not=sql_select($sql_sub_not);
							 }
							}


							$sub_party_batch_arr_not=array(); $tot_sub_batch_qty_not=0;
							foreach($sql_data_sub_not as $row)
							{
								$sub_party_batch_arr_not[$row[csf('party_id')]]['qty']=$row[csf('sub_batch_qnty')];
								$sub_party_batch_arr_not[$row[csf('party_id')]]['buyer']=$row[csf('party_id')];
								$tot_sub_batch_qty_not+=$row[csf('sub_batch_qnty')];
							}
							$p=1;$total_sub_batch_qty_not=0;$total_batch_per_sub_not=0;
							foreach($sub_party_batch_arr_not as $id=>$sval)
							{
								if ($p%2==0) $bgcolor_sub_not="#E9F3FF"; else $bgcolor_sub_not="#FFFFFF";

								?>
								  <tr bgcolor="<? echo $bgcolor_sub_not; ?>" style="cursor:pointer;">
									  <td ><? echo $p; ?></td>
									  <td><? echo $buyer_arr[$id] ?></td>
									  <td align="right"><? echo number_format($sub_party_batch_arr_not[$id]['qty'],2,'.',''); $total_sub_batch_qty_not+=$sub_party_batch_arr_not[$id]['qty']; ?></td>
									  <td align="right"><? $batch_per_sub_not=($sub_party_batch_arr_not[$id]['qty']/$tot_sub_batch_qty_not)*100; echo number_format($batch_per_sub_not,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$total_batch_per_sub_not+=$batch_per_sub_not;
							$p++;
							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_sub_batch_qty_not,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($total_batch_per_sub_not,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="5">Summary Total( Not Shade Match)</th>
								</tr>
								<tr>
									<th>Self Batch</th>
                                    <th>Sample Batch</th>
									<th>SubCon Batch</th>
									<th>Total</th>
								</tr>
							</thead>
							<tbody>
								 <tr bgcolor="#FFFFFF"  style="cursor:pointer;">
									  <td width="30"><? echo $total_batch_qty_not; ?></td>
                                      <td width="30"><? echo $total_batch_qty_not_samp; ?></td>
									  <td width="30"><? echo $total_sub_batch_qty_not; ?></td>
									  <td width="30"><?  echo $grand_total_not=$total_batch_qty_not+$total_sub_batch_qty_not+$total_batch_qty_not_samp; ?></td>
								  </tr>
								  <tr bgcolor="#E9F3FF">
								   <td><?  echo number_format(($total_batch_qty_not/$grand_total_not)*100,2).'%'; ?></td>
                                   <td><?  echo number_format(($total_batch_qty_not_samp/$grand_total_not)*100,2).'%'; ?></td>
									  <td><?  echo number_format(($total_sub_batch_qty_not/$grand_total_not)*100,2).'%'; ?></td>
									  <td><?  echo '100%'; ?></td>
								  </tr>
							</tbody>
						</table>
					 </td>
				 </tr>
			 </table>
		 </div>
		 <br/>
		 <?
		 }
		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		 {
			if (count($batchdata)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left">


			 <table class="rpt_table" width="2310" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_1">
              <caption> <b>Self batch  </b></caption>
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg;?></th>

                       <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="60">File No</th>
                        <th width="70">Ref. No</th>
                        <th width="100">Buyer</th>
                        <th width="80">Job</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70" class="wrap_break">Dia/Width Type</th>
                        <th width="80">Color Name</th>
                        <th width="90">Batch No</th>
						 <th width="100">Booking No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Wgt.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
                        <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60" class="wrap_break">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab. Type</th>
                        <th width="110">Result</th>
                        <th width="">Remark</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2330; overflow-y:scroll;;" id="scroll_body_self">
            <table class="rpt_table" id="table_body" width="2310" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$total_water_cons_load=0;$total_water_cons_unload=0;
                $batch_chk_arr=array(); $group_by_arr=array();$tot_trims_qnty=0;$trims_check_array=array();
                foreach($batchdata as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";

					if($date_search_type==1)
					{
						$date_type_cond=$batch[csf('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[csf('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}

					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="60">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="230" colspan="3"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty,2); ?></td>
                                    <td width="70"><? echo number_format($trims_btq,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="50">&nbsp;</td>
                                    <td width="60"><? echo $total_water_cons_load;?></td>

                                    <td width="70"><? //echo number_format($btq,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="110">&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($batch_qnty);unset($trims_btq);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="31" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}


					$order_id=$batch[csf('po_id')];

					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$load_hour_meter=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));

					$batch_no=$batch[csf('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}

					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($date_type_cond); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td align="center" width="60"><p><? echo $batch[csf('file_no')]; ?></p></td>
                        <td align="center" width="70"><p><? echo $batch[csf('grouping')]; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
                        <td width="80"><p class="wrap_break"><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
                        <td width="90"><p class="wrap_break"><? echo $po_number; ?></p></td>
                        <td width="100"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p class="wrap_break"><? echo $batch[csf('batch_no')]; ?></p></td>
						 <td width="100"><p><? echo $batch[csf('booking_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>

                       <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>

                        <td width="60" align="right"><p><? echo number_format($load_hour_meter,2);  ?></p></td>
                        <td width="60" align="right"><p><? echo number_format($batch[csf('hour_unload_meter')],2);  ?></p></td>
                       <td width="60" align="right" ><p><? echo number_format($batch[csf('hour_unload_meter')]-$load_hour_meter,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" title="<? echo "Water Cons Unload-Water Cons Load*1000/Batch Qnty"?>" ><? echo number_format((($water_cons_unload-$water_cons_load)*1000)/$batch[csf('batch_qnty')],2);//number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                        <td align="center" width="100"><p><?
						if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
							else if($batch[csf('fabric_type')]==7)
							{
								$fab_type="Melange";
							}
							else if($batch[csf('fabric_type')]==8)
							{
								$fab_type="Viscose";
							}
							else if($batch[csf('fabric_type')]==9)
							{
								$fab_type="CVC 1 Part";
							}
							else if($batch[csf('fabric_type')]==10)
							{
								$fab_type="Scouring";
							}

							else if($batch[csf('fabric_type')]==11)
							{
								$fab_type="AOP Wash";
							}
							else if($batch[csf('fabric_type')]==12)
							{
								$fab_type="Y/D Wash";
							}

						echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td align="center" width="110"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty+=$batch[csf('batch_qnty')];
					$trims_btq+=$tot_trim_qty;
					$total_water_cons_load+=$water_cons_load;
					$total_water_cons_unload+=$water_cons_unload;
					$tot_trims_qnty+=$tot_trim_qty;
					$grand_total_batch_qty+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <td width="30">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                     <? if($group_by==2 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } if($group_by==1 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                    <td width="60">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="90">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="230" colspan="3"><strong>Sub. Total : </strong></td>
                    <td width="70"><? echo number_format($batch_qnty,2); ?></td>

                    <td width="70"><? echo number_format($trims_btq,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="50">&nbsp;</td>
                    <td width="60"><? echo $total_water_cons_load;?></td>

                    <td width="70"><? //echo number_format($btq,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                     <td width="100">&nbsp;</td>
                    <td width="110">&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="230" colspan="3"><strong>Trims Total : </strong></th>
                    <th width="70"><? echo number_format($tot_trims_qnty,2); ?></th>
                    <th colspan="14">&nbsp; </th>

                </tr>

                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80"><? //echo $total_water_cons_load;?></th>
                    <th width="230" colspan="3"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty+$tot_trims_qnty,2); ?></th>

                    <th colspan="14"> </th>

                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			if(count($sql_subcon_data)>0)
			{
		?>
		 <div align="left">

		 <table class="rpt_table" width="1990" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_2">
            <caption> <b> Subcon batch</b> </caption>
				<thead>
					<tr>
						<th width="30">SL</th>
						<th width="80"> <? echo $date_type_msg; ?></th>
						<th width="80">M/C No</th>
						<th width="80">Floor</th>
						<th width="80">Shift Name</th>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70" class="wrap_break">Dia/Width Type</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="100">Booking No</th>
						<th width="40">Extn. No</th>
						<th width="70">Dyeing Qty.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
						<th width="60">Total Time</th>
						<th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60" class="wrap_break">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


						<th width="75">Load Date & Time</th>
						<th width="75">UnLoad Date Time</th>

                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab Type</th>
						<th>Result</th>
					</tr>
				</thead>
		</table>
		<div style=" max-height:350px; width:2010px; overflow-y:scroll;;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="1990" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
		<tbody>
					<?
					$i=1;
					$btq=0;$trims_btq_sub=0;
					$batch_chk_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($i%2==0)
					$bgcolor_sub2="#E9F3FF";
					else
					$bgcolor_sub2="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$batch_weight_sub=$batch[csf('batch_weight')];
					$water_cons_unload_sub=$batch[csf('water_flow_meter')];
					$water_cons_load_sub=$subcon_water_flow_arr[$batch[csf('id')]];
					$load_hour_meter_sub=$subcon_load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff_sub=($water_cons_unload_sub-$water_cons_load_sub)/$batch_weight_sub*1000;
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					if($date_search_type==1)
					{
						$date_type_cond=$batch[csf('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[csf('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}

					//echo $load_hr[$batch[csf('id')]].'ddddd';
					//echo $batch[csf('id')];
					?>
					<tr bgcolor="<? echo $bgcolor_sub2; ?>" id="trsub_<? echo $i; ?>" onClick="change_color('trsub_<? echo $i; ?>','<? echo $bgcolor; ?>')">
						<td width="30"><? echo $i; ?></td>
						<td width="80"><p><? echo ($date_type_cond == '0000-00-00' || $date_type_cond == '' ? '' : change_date_format($date_type_cond)); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
						<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $floor_arr[$batch[csf('floor_id')]];  ?>"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $shift_name[$batch[csf('shift_name')]];  ?>"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
						<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? echo  $batch[csf('job_no_prefix_num')]; ?>"><p class="wrap_break"><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td  width="90" title="<? echo $po_number; ?>"><p class="wrap_break"><? echo $po_number; ?></p></td>
						<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p class="wrap_break"><? echo $batch[csf('item_description')]; ?></p></td>
						<td  width="70" title="<? echo  $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p class="wrap_break"><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="100"><p><? echo $batch[csf('booking_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>

                          <td width="60" align="right"><p><? echo $load_hour_meter_sub;  ?></p></td>
                           <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')];  ?></p></td>
                          <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')]-$load_hour_meter_sub;  ?></p></td>
						<td align="left" width="50" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60"><p><? echo $water_cons_load_sub;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload_sub;  ?></p></td>

                        <td align="right" width="70" title="<? echo number_format($water_cons_diff_sub,2);  ?>"><? echo number_format($water_cons_diff_sub,2);  ?></td>


						<td width="75" title="<?  $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];  echo ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).'  & '.$sub_load_t; ?>"><p><?   $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]]; echo  ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).' <br> '.$sub_load_t;
						 ?></p></td>
						<td width="75" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; // $unloadd=change_date_format($batch[csf('process_end_date')]).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
						<td align="center" width="60">
					   <?
					$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
					$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$sub_load_t.':'.'00');
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
					//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
							?>
						 </td>
                         <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						 echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
						<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
					</tr>
		<?
		$i++;
		$btq_sub+=$batch[csf('sub_batch_qnty')];
		$trims_btq_sub+=$batch[csf('total_trims_weight')];
		} //batchdata froeach
		 ?>
			</tbody>
		</table>
		<table class="rpt_table" width="1990" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
				<thead>

                    <tr class="tbl_bottom">
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="40">Total Trims</th>
						<th width="70"><? echo number_format($trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="40">Grand Total</th>
						<th width="70"><? echo number_format($btq_sub+$trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						 <th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
		</table>
		</div>
		</div>
		<?
		}
		} // Sub Cond End

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
		{
			if (count($batchdata_sam)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left">
			 <div> <b>Sample Dyeing Production </b></div>
			 <table class="rpt_table" width="2300" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_3">
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg; ?></th>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <th width="80">M/C No</th>
                        <? }
						?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="70">File No</th>
                        <th width="80">Ref. No</th>
                        <th width="100">Buyer</th>

                        <th width="80">Job</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70" class="wrap_break">Dia/ Width Type</th>
                        <th width="80">Color Name</th>

                        <th width="90">Batch No</th>
						<th width="110">Booking No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Qty.</th>

                        <th width="60">Hour Load Meter</th>
 						<th width="60">Hour unLoad Meter</th>
                         <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60" class="wrap_break">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fabrics<br>Type</th>
                        <th width="100">Result</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2320; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body3" width="2300" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$grand_total_batch_qty_sam=0;$batch_qnty_sam=0;$total_trim_qty=0;
                $batch_chk_arr=array(); $group_by_arr=array();$trims_check_array=array();
                foreach($batchdata_sam as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";

					if($date_search_type==1)
					{
						$date_type_cond=$batch[csf('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[csf('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                     <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>

                                    <td width="70">&nbsp;</td>
                    				<td width="70">&nbsp;</td>
									<td width="80">&nbsp;</td>

                                    <td width="240" colspan="3"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                                    <td width="60"><? echo number_format($batch_qnty_sam_trims,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="70"><? //echo number_format($btq,2); ?></td>
                                    <td width="50">&nbsp;</td>
                                     <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                     <td width="70"><? //echo number_format($btq,2); ?></td>

                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td>&nbsp;r</td>
                                </tr>
								<?
								unset($batch_qnty_sam);unset($batch_qnty_sam_trims);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="29" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}
					$order_id=$batch[csf('po_id')];
					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$hour_meter_load=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$batch_no=$batch[csf('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($date_type_cond); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
                          <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <? } if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td width="70"><p><? echo $batch[csf('file_no')]; ?></p></td>
                        <td width="80"><p><? echo $batch[csf('grouping')]; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>

                        <td width="80"><p class="wrap_break"><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
                        <td width="90"><p class="wrap_break"><? echo $po_number; ?></p></td>
                        <td width="100"><p class="wrap_break"><? echo $batch[csf('item_description')]; ?></p></td>
                        <td width="70"><p class="wrap_break"><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p class="wrap_break"><? echo $batch[csf('batch_no')]; ?></p></td>
						<td width="110"><p><? echo $batch[csf('booking_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>
                        <td width="60"><p><? echo number_format($hour_meter_load,2);  ?></p></td>
                        <td width="60"><p><? echo number_format($batch[csf('hour_unload_meter')],2);  ?></p></td>

                        <td width="60"><p><? echo number_format($batch[csf('hour_unload_meter')]-$hour_meter_load,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                         <td width="60"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" ><? echo number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                          <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						  echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td width="100" align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center" title="<?  echo $batch[csf('remarks')];   ?>"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty_sam+=$batch[csf('batch_qnty')];
					$batch_qnty_sam_trims+=$tot_trim_qty;
					$total_trim_qty+=$tot_trim_qty;
					$grand_total_batch_qty_sam+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                     <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="240" colspan="3"><strong>Sub. Total : </strong></th>
                    <th width="70"><? echo number_format($batch_qnty_sam,2); ?></th>
                  	<th width="60"><? echo number_format($batch_qnty_sam_trims,2); ?></th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                     <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                     <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="240" colspan="3"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty_sam,2); ?></th>
                    <th width="60"><? echo number_format($total_trim_qty,2);?></th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                   <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
			?>


            <?
		}
		?>
		</fieldset>
		</div>
		<?
		//disconnect($con);
		//exit();
		} //Dyeing Production End

	else if($cbo_type==3) // Daily Right First Time
	{
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 )
		{
	?>
	<div>
	<fieldset style="width:1505px;">
	<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Right First Time </strong><br>
	<?
		echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
	?>
	 </div>
     <div>
     <table cellpadding="0"  width="400" cellspacing="0" align="center" >
             <tr>
                 <td width="400">
                     <table cellpadding="0"  width="400" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
                            <thead>
                        	<tr>
                            	<th colspan="4"> <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
								<p>RFT Summary </p>
								</th>
                            </tr>
                             <tr><th colspan="3">RFT </th> <th>OK %</th></tr>
                            </thead>
                            <?
							if($db_type==2) $group_concat="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number";
							if($db_type==0) $group_concat="group_concat(c.po_number) as po_number";
							$sql_btb_data=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond	$cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and a.batch_against in(1) and f.result in(1) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ");
					 	$matched_btb=count($sql_btb_data);

						$sql_ltb_data=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2   $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id  and a.id=b.mst_id and a.batch_against in(1) and f.ltb_btb_id=2 and f.result in(1) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no");
					$matched_ltb=count($sql_ltb_data);

	$sql_btb_data_not=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond	and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(1) and f.result!=1 and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ");
	 			$matched_btb_not=count($sql_btb_data_not);
				$sql_ltb_data_not=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(1) and f.ltb_btb_id=2 and f.result!=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no");
				 $matched_ltb_not=count($sql_ltb_data_not);



				 $tot_ltb=$matched_ltb+$matched_ltb_not;
				  $ltb_percent=$matched_ltb/$tot_ltb*100;
				   $tot_btb=$matched_btb+$matched_btb_not;
				    $btb_percent=$matched_btb/$tot_btb*100;
					 $tot_rp=$matched_btb+$matched_btb_not+$matched_ltb+$matched_ltb_not;
					 $tot_ok=$matched_btb+$matched_ltb;
				  $tot_rp_percent=$tot_ok/$tot_rp*100;
	?>
                            <tr bgcolor="#E9F3FF">
                            	<td rowspan="2">LTB </td>
                                <td width="100">L OK </td>
                                <td align="right"> <? echo number_format($matched_ltb); ?></td>
                                <td rowspan="2" align="right"><? echo number_format($ltb_percent,2).'%'; ?> </td>
                            </tr>
                            <tr>
                                <td width="100">L Not OK </td>
                                <td width="60" align="right"><? echo number_format($matched_ltb_not); ?></td>
                            </tr>
                             <tr bgcolor="#FFFFFF">
                            	<td rowspan="2">BTB </td>
                                <td width="100">B OK </td>
                                <td align="right"> <? echo $matched_btb; ?></td>
                                <td rowspan="2" align="right"><? echo number_format($btb_percent,2).'%'  ?></td>
                            </tr>
                            <tr>
                                <td width="100">B Not OK </td>
                                <td width="60" align="right"><? echo number_format($matched_btb_not); ?></td>
                            </tr>
                             <tfoot>
                             <tr>
                            	<th> </th>
                                <th colspan="2">R/P</th>
                                <th align="right"> <? echo number_format($tot_rp_percent,2).'%'; ?></th>
                             </tr>
                            </tfoot>
                            </table>
                     </td>
                     </tr>
                    </table>
     </div>
     <br>
     <div>
     <div align="left"> <b>Self batch </b><br>
     <Strong>Bulk To Bulk</Strong>
     </div>
	 <table class="rpt_table" width="1498" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_1">

			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>
					<th width="80">M/C No</th>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="80">Dia/Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="70">Dyeing Qty.</th>
					<th width="50">LTB/BTB</th>
					<th width="100">Unload Date & Time</th>
					<th width="60">Time Used</th>
					<th width="100">RFT</th>
					<th width="100">Remark</th>
					<th width="100">Machine Utilization</th>
					<th>Lot No</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:350px; width:1510px; overflow-y:scroll;" id="scroll_body_self">
	<table class="rpt_table" id="table_body" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
	<tbody>
					<?
					$i=1;
					$f=0;
					$btq=0;
					$batch_chk_arr=array();
			if (count($batchdata)>0)
			 {
					foreach($batchdata as $batch)
					{
					if ($i%2==0)
					$bgcolor="#E9F3FF";
					else
					$bgcolor="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					if($batch[csf('result')]==1)
					{
					$shade="Shade Matched";
					}
					else
					{
					$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor; ?>')">
					<td width="30"><? echo $i; ?></td>
					<td width="80" title="<? echo change_date_format($batch[csf('production_date')]); ?>"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch[csf('batch_qnty')]; ?>"><p><? echo $batch[csf('batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb[$batch[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb[$batch[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?  echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' <br> '.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>
					  <td align="center" width="60"><? $hr=$batch[csf('end_hours')]-$load_hr[$batch[csf('id')]]; $min=$batch[csf('end_minutes')]-$load_min[$batch[csf('id')]]; //echo  $hr.':'.$min;
					$load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]];
					$unload_t=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
					$new_date_time_unload=($unload_date.' '.$unload_t.':'.'00');
					$new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
				   //$unload_time=strtotime($unload_date,$unload_time);
					//$load_time=strtotime($load_date,$load_t);
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
				//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade;  ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch[csf('remarks')]; ?></p></td>

					<td align="center" width="100" title="<?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?>"><?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?></p> </td>
				</tr>
	<?
	$i++;
	$btq+=$batch[csf('batch_qnty')];
	} //batchdata froeach
	 ?>
			  <tr bgcolor="#CCCCCC">
				<td colspan="10" align="right"><Strong>BTB Total:</Strong> <? //echo $b_qty; ?> </td>
				<td align="right"><? echo number_format($btq,2); ?>&nbsp;</td>
				<td colspan="7">&nbsp;</td>
			 </tr>
			 <tr bgcolor="#C2DCFF">
				<td colspan="10"><strong>Lab To Bulk</strong></td><td colspan="8"> </td>
			 </tr>
		 <?
			 }
			 ?>

             <?
		 if (count($batchdata_ltb)>0)
		 {
				$d=1;
				foreach($batchdata_ltb as $batch_ltb)
				{
					if ($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					$order_id=$batch_ltb[csf('po_id')];
					$color_id=$batch_ltb[csf('color_id')];
					if($batch_ltb[csf('result')]==1)
					{
						$shade="Shade Matched";
					}
					else
					{
						$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch_ltb[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch_ltb[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>" id="trbluk_<? echo $d; ?>"  onclick="change_color('trbluk_<? echo $d; ?>','<? echo $bgcolor; ?>')">
					<td width="30"><? echo $d; ?></td>
					<td width="80" title="<? echo change_date_format($batch_ltb[csf('production_date')]); ?>"><p><? echo change_date_format($batch_ltb[csf('production_date')]);$unload_date1=$batch_ltb[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch_ltb[csf('color_id')]]; ?>"><p><? echo $color_library[$batch_ltb[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch_ltb[csf('batch_no')]; ?>"><p><? echo $batch_ltb[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch_ltb[csf('batch_qnty')]; ?>"><p><? echo $batch_ltb[csf('batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb[$batch_ltb[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb[$batch_ltb[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?   echo ($batch_ltb[csf('process_end_date')] == '0000-00-00' || $batch_ltb[csf('process_end_date')]== '' ? '' : change_date_format($batch_ltb[csf('process_end_date')])).'<br>'.$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')]; ?></p></td>
					   <td align="center" width="60" title="<? echo  $hr.':'.$min;  ?>"><? $hr=$batch_ltb[csf('end_hours')]-$load_hr[$batch_ltb[csf('id')]]; $min=$batch_ltb[csf('end_minutes')]-$load_min[$batch_ltb[csf('id')]]; //echo  $hr.':'.$min;
					$load_time=$load_hr[$batch_ltb[csf('id')]].':'.$load_min[$batch_ltb[csf('id')]];
					$unload_time=$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')];
					$new_date_time_unload1=($unload_date1.' '.$unload_time.':'.'00');
					$new_date_time_load1=($load_date[$batch_ltb[csf('id')]].' '.$load_time.':'.'00');
					$total_time1=datediff(n,$new_date_time_load1,$new_date_time_unload1);
					echo floor($total_time1/60).":".$total_time1%60;
			//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch_ltb[csf('remarks')];  ?></p></td>
					<td align="center" width="100" title="<? //echo $hr.':'.$min;   ?>"><?  $utiliz=$batch_ltb[csf('batch_qnty')]/$m_capacity[$batch_ltb[csf('machine_id')]]*100;
					echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]]; ?></p> </td>
				</tr>
						<?
				$d++;
				$total_ltb+=$batch_ltb[csf('batch_qnty')];
				}
				?>
                </table>
				<table class="rpt_table" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
			<tfoot>
				<tr>
					<th width="30">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="70"><? echo number_format($total_ltb,2); ?></th>
					<th width="50">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
	</table>
				<?
			 }
		 ?>
	</tbody>
	</table>
	</div>
    </div>
    <br>
    <?
		} //Self batch  End


		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2 )  // Suncond start
		{
	?>
     <div align="left"> <b>SubCon batch </b><br><Strong>Bulk To Bulk</Strong></div>
	 <table class="rpt_table" width="1498" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="">

			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>
					<th width="80">M/C No</th>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="80">Dia/Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="70">Dyeing Qty.</th>
					<th width="50">LTB/BTB</th>
					<th width="100">Unload Date & Time</th>
					<th width="60">Time Used</th>
					<th width="100">RFT</th>
					<th width="100">Remark</th>
					<th width="100">Machine Utilization</th>
					<th>Lot No</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:350px; width:1510px; overflow-y:scroll;" id="scroll_body">
	<table class="rpt_table" id="table_body2" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
	<tbody>
					<?
					$p=1;
					$f=0;
					$sub_btq=0;
					$batch_chk_arr=array();
					$ltb_btb_sub=array(1=>'BTB',2=>'LTB');
					foreach($sql_subcon_data_btb as $batch)
					{
					if ($p%2==0)
					$sub_bgcolor_btb="#E9F3FF";
					else
					$sub_bgcolor_btb="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					if($batch[csf('result')]==1)
					{
					$shade="Shade Matched";
					}
					else
					{
					$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $sub_bgcolor_btb; ?>" id="trsub_<? echo $p; ?>" onClick="change_color('trsub_<? echo $p; ?>','<? echo $sub_bgcolor_btb; ?>')">
					<td width="30"><? echo $p; ?></td>
					<td width="80" title="<? echo change_date_format($batch[csf('production_date')]); ?>"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch[csf('sub_batch_qnty')]; ?>"><p><? echo $batch[csf('sub_batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb_sub[$batch[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb_sub[$batch[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?  echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' <br> '.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>
					  <td align="center" width="60"><? $hr=$batch[csf('end_hours')]-$load_hr[$batch[csf('id')]]; $min=$batch[csf('end_minutes')]-$load_min[$batch[csf('id')]]; //echo  $hr.':'.$min;
					$load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];
					$unload_t=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
					$new_date_time_unload=($unload_date.' '.$unload_t.':'.'00');
					$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
				   //$unload_time=strtotime($unload_date,$unload_time);
					//$load_time=strtotime($load_date,$load_t);
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
				//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade;  ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch[csf('remarks')]; ?></p></td>

					<td align="center" width="100" title="<?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?>"><?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?></p> </td>
				</tr>
	<?
	$p++;
	$sub_btq+=$batch[csf('sub_batch_qnty')];
	} //batchdata froeach
	 ?>
			  <tr bgcolor="#CCCCCC">
				<td colspan="10" align="right"><Strong>BTB Total:</Strong> <? //echo $b_qty; ?> </td>
				<td align="right"><? echo number_format($sub_btq,2); ?>&nbsp;</td>
				<td colspan="7">&nbsp;</td>
			 </tr>
			 <tr bgcolor="#C2DCFF">
				<td colspan="10"><strong>Lab To Bulk</strong></td><td colspan="8" ></td>
			 </tr>
		 <?
		 if (count($sql_subcon_data_ltb)>0)
		 {
				$h=1;
				$sub_total_ltb=0;

				foreach($sql_subcon_data_ltb as $batch_ltb)
				{
					if ($h%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					$order_id=$batch_ltb[csf('po_id')];
					$color_id=$batch_ltb[csf('color_id')];
					if($batch_ltb[csf('result')]==1)
					{
						$shade="Shade Matched";
					}
					else
					{
						$shade="Not Shade Matched";
					}
					$desc=explode(",",$batch_ltb[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch_ltb[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $h; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $h; ?>">
					<td width="30"><? echo $h; ?></td>
					<td width="80" title="<? echo change_date_format($batch_ltb[csf('process_end_date')]); ?>"><p><? echo change_date_format($batch_ltb[csf('process_end_date')]);$unload_date1=$batch_ltb[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')]; ?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch_ltb[csf('color_id')]]; ?>"><p><? echo $color_library[$batch_ltb[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch_ltb[csf('batch_no')]; ?>"><p><? echo $batch_ltb[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch_ltb[csf('sub_batch_qnty')]; ?>"><p><? echo $batch_ltb[csf('sub_batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb_sub[$batch_ltb[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb_sub[$batch_ltb[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?   echo  change_date_format($batch_ltb[csf('process_end_date')]) .' <br>'.$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')]; ?></p></td>
					   <td align="center" width="60" title="<? echo  $hr.':'.$min;  ?>"><? $hr=$batch_ltb[csf('end_hours')]-$load_hr[$batch_ltb[csf('id')]]; $min=$batch_ltb[csf('end_minutes')]-$load_min[$batch_ltb[csf('id')]]; //echo  $hr.':'.$min;
					$load_time=$subcon_load_hr[$batch_ltb[csf('id')]].':'.$subcon_load_min[$batch_ltb[csf('id')]];
					$unload_time=$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')];
					$new_date_time_unload1=($unload_date1.' '.$unload_time.':'.'00');
					$new_date_time_load1=($subcon_load_date[$batch_ltb[csf('id')]].' '.$load_time.':'.'00');
					$total_time1=datediff(n,$new_date_time_load1,$new_date_time_unload1);
					echo floor($total_time1/60).":".$total_time1%60;
			//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch_ltb[csf('remarks')];  ?></p></td>
					<td align="center" width="100" title="<? //echo $hr.':'.$min;   ?>"><?  $utiliz=$batch_ltb[csf('batch_qnty')]/$m_capacity[$batch_ltb[csf('machine_id')]]*100;
					echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]]; ?></p> </td>
				</tr>
						<?
				$h++;
				$sub_total_ltb+=$batch_ltb[csf('sub_batch_qnty')];
				}
				?>
				<table class="rpt_table" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
			<tfoot>
				<tr>
					<th width="30">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="70"><? echo number_format($sub_total_ltb,2); ?></th>
					<th width="50">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
	</table>
				<?
			 }
		 ?>
	</tbody>
	</table>
	</div>

	</fieldset>
	</div>
	<?
		} // Sub Cond End

 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)  // Sample RFT
	{

			if (count($batchdata_btb_sam)>0)
			 {

			?>

	<div>
	<fieldset style="width:1505px;">
	<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Right First Time(Sample Production) </strong><br>
	<?
		echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
	?>
	 </div>
     <div>
     <table cellpadding="0"  width="400" cellspacing="0" align="center" >
             <tr>
                 <td width="400">
                     <table cellpadding="0"  width="400" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
                            <thead>
                        	<tr>
                            	<th colspan="4">Self Batch RFT Summary(Sample)</th>
                            </tr>
                             <tr><th colspan="3">RFT </th> <th>OK %</th></tr>
                            </thead>
                            <?
							if($db_type==2) $group_concat="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number";
							if($db_type==0) $group_concat="group_concat(c.po_number) as po_number";
							$sql_btb_data=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2   $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond	and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(3) and f.result in(1) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ");
					 	$matched_btb=count($sql_btb_data);
						$sql_ltb_data=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond  $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and f.batch_id=b.mst_id and a.batch_against in(3) and f.ltb_btb_id=2 and f.result in(1) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no");
					$matched_ltb=count($sql_ltb_data);

	$sql_btb_data_not=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name	and $cbo_prod_type_cond $cbo_prod_source_cond  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and a.batch_against in(3) and f.result!=1 and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ");
	 			$matched_btb_not=count($sql_btb_data_not);
				$sql_ltb_data_not=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(3) and f.ltb_btb_id=2 and f.result!=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no");
				 $matched_ltb_not=count($sql_ltb_data_not);

				 $tot_ltb=$matched_ltb+$matched_ltb_not;
				  $ltb_percent=$matched_ltb/$tot_ltb*100;
				   $tot_btb=$matched_btb+$matched_btb_not;
				    $btb_percent=$matched_btb/$tot_btb*100;
					 $tot_rp=$matched_btb+$matched_btb_not+$matched_ltb+$matched_ltb_not;
					 $tot_ok=$matched_btb+$matched_ltb;
				 	 $tot_rp_percent=$tot_ok/$tot_rp*100;
	?>
                            <tr bgcolor="#E9F3FF">
                            	<td rowspan="2">LTB </td>
                                <td width="100">L OK </td>
                                <td align="right"> <? echo number_format($matched_ltb); ?></td>
                                <td rowspan="2" align="right"><? echo number_format($ltb_percent,2).'%'; ?> </td>
                            </tr>
                            <tr>
                                <td width="100">L Not OK </td>
                                <td width="60" align="right"><? echo number_format($matched_ltb_not); ?></td>
                            </tr>
                             <tr bgcolor="#FFFFFF">
                            	<td rowspan="2">BTB </td>
                                <td width="100">B OK </td>
                                <td align="right"> <? echo $matched_btb; ?></td>
                                <td rowspan="2" align="right"><? echo number_format($btb_percent,2).'%'  ?></td>
                            </tr>
                            <tr>
                                <td width="100">B Not OK </td>
                                <td width="60" align="right"><? echo number_format($matched_btb_not); ?></td>
                            </tr>
                             <tfoot>
                             <tr>
                            	<th> </th>
                                <th colspan="2">R/P</th>
                                <th align="right"> <? echo number_format($tot_rp_percent,2).'%'; ?></th>
                             </tr>
                            </tfoot>
                            </table>
                     </td>
                     </tr>
                    </table>
     </div>
     <br>
     <div>
     <div align="left"> <b>Sample Dyeing Production </b><br>
     <Strong>Bulk To Bulk</Strong>
     </div>
	 <table class="rpt_table" width="1498" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_1">

			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>
					<th width="80">M/C No</th>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="80">Dia/Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="70">Dyeing Qty.</th>
					<th width="50">LTB/BTB</th>
					<th width="100">Unload Date & Time</th>
					<th width="60">Time Used</th>
					<th width="100">RFT</th>
					<th width="100">Remark</th>
					<th width="100">Machine Utilization</th>
					<th>Lot No</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:350px; width:1510px; overflow-y:scroll;" id="scroll_body">
	<table class="rpt_table" id="table_body" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
	<tbody>
					<?
					$i=1;
					$f=0;
					$btq_sam=0;
					$batch_chk_arr=array();
				foreach($batchdata_btb_sam as $batch)
					{
					if ($i%2==0)
					$bgcolor="#E9F3FF";
					else
					$bgcolor="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					if($batch[csf('result')]==1)
					{
					$shade="Shade Matched";
					}
					else
					{
					$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor; ?>')">
					<td width="30">&nbsp;</td>
					<td width="80" title="<? echo change_date_format($batch[csf('production_date')]); ?>"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p><? echo $desc[0]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch[csf('batch_qnty')]; ?>"><p><? echo $batch[csf('batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb[$batch[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb[$batch[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?  echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' <br> '.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>
					  <td align="center" width="60"><? $hr=$batch[csf('end_hours')]-$load_hr[$batch[csf('id')]]; $min=$batch[csf('end_minutes')]-$load_min[$batch[csf('id')]]; //echo  $hr.':'.$min;
					$load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]];
					$unload_t=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
					$new_date_time_unload=($unload_date.' '.$unload_t.':'.'00');
					$new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
				   //$unload_time=strtotime($unload_date,$unload_time);
					//$load_time=strtotime($load_date,$load_t);
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
				//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade;  ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch[csf('remarks')]; ?></p></td>

					<td align="center" width="100" title="<?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?>"><?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?></p> </td>
				</tr>
	<?
	$i++;
	$btq_sam+=$batch[csf('batch_qnty')];
	} //batchdata froeach
	 ?>
			  <tr bgcolor="#CCCCCC">
				<td colspan="10" align="right"><Strong>BTB Total:</Strong> <? //echo $b_qty; ?> </td>
				<td align="right"><? echo number_format($btq_sam,2); ?>&nbsp;</td>
				<td colspan="7">&nbsp;</td>
			 </tr>
			 <tr bgcolor="#C2DCFF">
				<td colspan="10"><strong>Lab To Bulk </strong></td><td colspan="8"> </td>
			 </tr>
		 <?
			 }
			 ?>
     <div align="left"> <b>Sample Dyeing Production </b><br>
     <Strong>Lab To Bulk</Strong>
     </div>
	 <table class="rpt_table" width="1498" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="">

			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>
					<th width="80">M/C No</th>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="80">Dia/Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="70">Dyeing Qty.</th>
					<th width="50">LTB/BTB</th>
					<th width="100">Unload Date & Time</th>
					<th width="60">Time Used</th>
					<th width="100">RFT</th>
					<th width="100">Remark</th>
					<th width="100">Machine Utilization</th>
					<th>Lot No</th>
				</tr>
			</thead>
	</table>
             <div style=" max-height:350px; width:1510px; overflow-y:scroll;" id="scroll_body">
             <table class="rpt_table" id="" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
             <?
		 if (count($batchdata_ltb_sam)>0)
		 {
				$d=1;$total_ltb_sam=0;
				foreach($batchdata_ltb_sam as $batch_ltb)
				{
					if ($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					$order_id=$batch_ltb[csf('po_id')];
					$color_id=$batch_ltb[csf('color_id')];
					if($batch_ltb[csf('result')]==1)
					{
						$shade="Shade Matched";
					}
					else
					{
						$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch_ltb[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch_ltb[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>" id="trbluk_<? echo $d; ?>"  onclick="change_color('trbluk_<? echo $d; ?>','<? echo $bgcolor; ?>')">
					<td width="30"><? echo $d; ?></td>
					<td width="80" title="<? echo change_date_format($batch_ltb[csf('production_date')]); ?>"><p><? echo change_date_format($batch_ltb[csf('production_date')]);$unload_date1=$batch_ltb[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $desc[0]; ?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch_ltb[csf('color_id')]]; ?>"><p><? echo $color_library[$batch_ltb[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch_ltb[csf('batch_no')]; ?>"><p><? echo $batch_ltb[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70"><p><? echo $batch_ltb[csf('batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb[$batch_ltb[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb[$batch_ltb[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?   echo ($batch_ltb[csf('process_end_date')] == '0000-00-00' || $batch_ltb[csf('process_end_date')]== '' ? '' : change_date_format($batch_ltb[csf('process_end_date')])).'<br>'.$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')]; ?></p></td>
					   <td align="center" width="60" title="<? echo  $hr.':'.$min;  ?>"><? $hr=$batch_ltb[csf('end_hours')]-$load_hr[$batch_ltb[csf('id')]]; $min=$batch_ltb[csf('end_minutes')]-$load_min[$batch_ltb[csf('id')]]; //echo  $hr.':'.$min;
					$load_time=$load_hr[$batch_ltb[csf('id')]].':'.$load_min[$batch_ltb[csf('id')]];
					$unload_time=$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')];
					$new_date_time_unload1=($unload_date1.' '.$unload_time.':'.'00');
					$new_date_time_load1=($load_date[$batch_ltb[csf('id')]].' '.$load_time.':'.'00');
					$total_time1=datediff(n,$new_date_time_load1,$new_date_time_unload1);
					echo floor($total_time1/60).":".$total_time1%60;
			//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch_ltb[csf('remarks')];  ?></p></td>
					<td align="center" width="100" title="<? //echo $hr.':'.$min;   ?>"><?  $utiliz=$batch_ltb[csf('batch_qnty')]/$m_capacity[$batch_ltb[csf('machine_id')]]*100;
					echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]]; ?></p> </td>
				</tr>
						<?
				$d++;
				$total_ltb_sam+=$batch_ltb[csf('batch_qnty')];
				}
				?>
                </table>
				<table class="rpt_table" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
			<tfoot>
				<tr>
					<th width="30">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="70"><? echo number_format($total_ltb_sam,2); ?></th>
					<th width="50">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
	</table>
    </div>
				<?
			 }
		 ?>
	</tbody>
	</table>
	</div>
    </div>
    <br>

	<? }


	}
	else if($cbo_type==4) // Dyeing Reprocess Summary
	{
		$group_by=str_replace("'",'',$cbo_group_by);
	?>
	<div>
	<fieldset style="width:1440px;">
	<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Dyeing Reprocess Summary </strong><br>
	<?
		echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
		?>
	 </div>
	 <? echo $i; ?>
	 <table class="rpt_table" width="1440" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header_1">
			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>

				   <? if($group_by==3 || $group_by==0){ ?>
                     <th width="80">M/C No</th>
                     <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">Floor</th>
                     <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="60">Shift</th>
                     <? } ?>

					<th width="100">Buyer</th>
					<th width="90">PO No</th>
					<th width="150">Fabrics Desc.</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="40">Extn. No</th>
					<th width="70">Repro. Qty.</th>
					<th width="80">Lot No</th>
					<th width="90">Load Date & Time</th>
					<th width="90">UnLoad Date Time</th>
					<th width="60">Time Used</th>
					<th>Result</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:350px; width:1440px; overflow-y:scroll;" id="scroll_body">
	<table class="rpt_table" id="table_body" width="1420" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
	<tbody>
	<?
	$sl=1;
	$i=1;$grand_total_btq=0;
	$f=0;$k=1;
	$btq=0;
	$buyer_arr = return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
	$batch_chk_arr=array();$$group_by_arr=array();
	foreach($batchdata as $batch)
	{
	if ($i%2==0)
	$bgcolor="#E9F3FF";
	else
	$bgcolor="#FFFFFF";
	$order_id=$batch[csf('po_id')];
	$color_id=$batch[csf('color_id')];
	$desc=explode(",",$batch[csf('item_description')]);
	$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
	if($group_by!=0)
	{
		if($group_by==1)
		{
			$group_value=$batch[csf('floor_id')];
			$group_name="Floor";
			$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
		}
		else if($group_by==2)
		{
			$group_value=$batch[csf('shift_name')];
			$group_name="Shift";
			$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
		}
		else if($group_by==3)
		{
			$group_value=$batch[csf('machine_id')];
			$group_name="machine";
			$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
		}
		if (!in_array($group_value,$group_by_arr) )
		{
			if($k!=1)
			{
			?>
				<tr bgcolor="#EFEFEF">
					<th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                   <? if($group_by==3 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } ?>
					 <? if($group_by==2 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } if($group_by==1 || $group_by==0){ ?>
					<th width="60">&nbsp;</th>
					 <? } ?>
                   <th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="150">&nbsp;</th>
					<th width="80">&nbsp;</th>

					<th colspan="2">Sub Total</th>
					<th width="70"><? echo number_format($btq,2); ?></th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
				<?
				unset($btq);
			}
			?>
			<tr bgcolor="#EFEFEF">
				<td colspan="15" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
			</tr>
			<?
			$group_by_arr[]=$group_value;
			$k++;
		}
	}

	?>
				<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">
					<td width="30"><? echo $i; ?></td>
					<td width="80" title="<? echo change_date_format($batch[csf('production_date')]); ?>"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>

                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="60"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>

					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="150"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
					<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
					<td align="left" width="80" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
					<td width="90" title="<?  $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo change_date_format($load_date[$batch[csf('id')]]).'  & '.$load_t; ?>"><p><?   $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$load_t;
					 ?></p></td>
					<td width="90" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
					<td align="center" width="60">
				   <?
				$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
				$new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
				$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
				echo floor($total_time/60).":".$total_time%60;
				//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?>
					 </td>
					<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
				</tr>
	<?
	$i++;
	$btq+=$batch[csf('batch_qnty')];
	$grand_total_btq+=$batch[csf('batch_qnty')];
	} //batchdata froeach
	if($group_by!=0)
				{
			?>
                 <tr bgcolor="#EFEFEF">
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                   <? if($group_by==3 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } ?>
					 <? if($group_by==2 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } if($group_by==1 || $group_by==0){ ?>
					<th width="60">&nbsp;</th>
					 <? } ?>
                   <th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="150">&nbsp;</th>
					<th width="80">&nbsp;</th>

					<th colspan="2">Sub Total</th>
					<th width="70"><? echo number_format($btq,2); ?></th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th>&nbsp;</th>
                </tr>
			<? } ?>

		</tbody>


			<tfoot>
				<tr bgcolor="#EFEFEF">
					<th width="30">&nbsp;</th>
					<th width="80">&nbsp;</th>
					 <? if($group_by==3 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } ?>
					 <? if($group_by==2 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } if($group_by==1 || $group_by==0){ ?>
					<th width="60">&nbsp;</th>
					 <? } ?>
					<th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="150">&nbsp;</th>
					<th width="80">&nbsp;</th>

                    <th colspan="2"><strong>Grand Total : </strong></th>
					<th width="70"><? echo number_format($grand_total_btq,2); ?></th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
	</table>
	</div>
	<?
		// foreach (glob("$user_name*.xls") as $filename)
		// {

		// 	if( @filemtime($filename) < (time()-$seconds_old) )
		// 	@unlink($filename);
		// }
		// //---------end------------//
		// $name=time();
		// $filename=$user_name."_".$name.".xls";
		// $create_new_doc = fopen($filename, 'w');
		// $is_created = fwrite($create_new_doc,ob_get_contents());
		// //$filename=$user_id."_".$name.".xls";
		// echo "$total_data****$filename";
		// exit();
	?>
	</fieldset>
	</div>
	<? }

	foreach (glob("$user_name*.xls") as $filename)
	{

		if( @filemtime($filename) < (time()-$seconds_old) )
		@unlink($filename);
	}
	//---------end------------//
	$name=time();
	$filename=$user_name."_".$name.".xls";
	$create_new_doc = fopen($filename, 'w');
	$is_created = fwrite($create_new_doc,ob_get_contents());
	//$filename=$user_id."_".$name.".xls";
	echo "$total_data****$filename";
	exit();
	disconnect($con);
	exit();
}//Dyeing Report end

else if($action=="dyeing_production_report5")
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if($db_type==0) $year_field_by="and YEAR(a.insert_date)";
	else if($db_type==2) $year_field_by=" and to_char(a.insert_date,'YYYY')";
	if($db_type==0) $field_concat="concat(machine_no,'-',brand) as machine_name";
	else if($db_type==2) $field_concat="machine_no || '-' || brand as machine_name";
	$company = str_replace("'","",$cbo_company_name);
	$working_company = str_replace("'","",$cbo_working_company_name);
	$buyer = str_replace("'","",$cbo_buyer_name);
	$cbo_prod_type = str_replace("'","",$cbo_prod_type);
	$cbo_party_id = str_replace("'","",$cbo_party_id);

	$date_search_type = str_replace("'","",$search_type);
	$job_number = str_replace("'","",$job_number);
	$job_number_id = str_replace("'","",$job_number_show);
	$batch_no = str_replace("'","",$batch_number_show);
	$color = str_replace("'","",$txt_color);
	$machine=str_replace("'","",$txt_machine_id);
	$floor_name=str_replace("'","",$cbo_floor_id);

	//echo $batch_no;die;
	$batch_number_hidden = str_replace("'","",$batch_number);
	$ext_num = str_replace("'","",$txt_ext_no);
	$hidden_ext = str_replace("'","",$hidden_ext_no);
	$txt_order = str_replace("'","",$order_no);
	$file_no = str_replace("'","",$file_no);
	$ref_no = str_replace("'","",$ref_no);
	$hidden_order = str_replace("'","",$hidden_order_no);
	$cbo_type = str_replace("'","",$cbo_type);
	$cbo_result_name = str_replace("'","",$cbo_result_name);
	$hide_booking_id = str_replace("'","",$txt_hide_booking_id);
	$txt_booking_no = str_replace("'","",$txt_booking_no);
	$year = str_replace("'","",$cbo_year);
	$shift = str_replace("'","",$cbo_shift_name);
	//echo $cbo_type;die;
	$txt_date_from = str_replace("'","",$txt_date_from);
	$txt_date_to = str_replace("'","",$txt_date_to);
	if ($buyer==0) $sub_buyer_cond=""; else $sub_buyer_cond="and d.party_id='".$buyer."' ";
	if ($cbo_prod_type>0 && $cbo_party_id>0) $cbo_prod_type_cond="and f.service_company in($cbo_party_id) "; else $cbo_prod_type_cond="";
	if ($cbo_prod_type>0) $cbo_prod_source_cond="and f.service_source in($cbo_prod_type) "; else $cbo_prod_source_cond="";
	//echo $cbo_prod_type;
	if ($cbo_result_name==0) $result_name_cond=""; else $result_name_cond="  and f.result='".$cbo_result_name."' ";
	if ($shift==0) $shift_name_cond=""; else $shift_name_cond="  and f.shift_name='".$shift."' ";
	if ($machine=="") $machine_cond=""; else $machine_cond =" and f.machine_id in ( $machine ) ";
	if ($floor_name==0 || $floor_name=='') $floor_id_cond=""; else $floor_id_cond=" and f.floor_id=$floor_name";

	if ($buyer==0) $buyerdata=""; else $buyerdata="  and d.buyer_name='".$buyer."' ";
	if ($buyer==0) $buyerdata2=""; else $buyerdata2="  and h.buyer_id='".$buyer."' ";
	if ($batch_no=="") $batch_num=""; else $batch_num="  and a.batch_no='".trim($batch_no)."' ";

	if ($batch_no=="") $unload_batch_cond=""; else $unload_batch_cond="  and batch_no='".trim($batch_no)."' ";
	if ($batch_no=="") $unload_batch_cond2=""; else $unload_batch_cond2="  and f.batch_no='".trim($batch_no)."' ";
	if ($working_company==0) $workingCompany_name_cond2=""; else $workingCompany_name_cond2="  and a.working_company_id='".$working_company."' ";
	if ($company==0) $companyCond=""; else $companyCond="  and a.company_id=$company";
	//echo $cbo_batch_type;
	if(trim($ext_no)!="") $ext_no_search="%".trim($ext_no)."%"; else $ext_no_search="%%";
	if(trim($txt_booking_no)!="") $ext_no_search="%".trim($txt_booking_no)."%"; else $ext_no_search="%%";

	if ($txt_booking_no!='') $booking_no_cond="  and a.booking_no LIKE '%$txt_booking_no%'"; else $booking_no_cond="";
	if ($hide_booking_id!='') $booking_id_cond="  and a.booking_no_id in($hide_booking_id) "; else $booking_id_cond="";

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if ($txt_order!='') $suborder_no="and c.order_no='$txt_order'"; else $suborder_no="";
		if ($job_number_id!='') $sub_job_cond="  and d.job_no_prefix_num='".$job_number_id."' "; else $sub_job_cond="";
	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
	{
	if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
	if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
	if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}
	if ($color=="") $color_name=""; else $color_name="  and g.color_name='$color'";
	if ($ext_num=="") $ext_no=""; else $ext_no="  and a.extention_no=$ext_num ";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	if($txt_date_from && $txt_date_to)
	{
		if($db_type==0)
		{

			$date_from=change_date_format($txt_date_from,'yyyy-mm-dd');
			$date_to=change_date_format($txt_date_to,'yyyy-mm-dd');

			$start_dd= strtotime(change_date_format($date_from,"yyyy-mm-dd","-"));
			$end_dd= strtotime(change_date_format($date_from,"yyyy-mm-dd","-"));
			$start_d=date("Y-m-d",$start_dd);
			$end_d=date("Y-m-d",$end_dd);
			$date_from2 = strtotime($start_d);
			$date_to2 = strtotime($end_d);
			$date_start = date("Y-m-d",strtotime("-5 day", $date_from2));
			$date_end = date("Y-m-d",strtotime("+5 day", $date_to2));
			$date_start= change_date_format($date_start,"yyyy-mm-dd","-",1);
			$date_end= change_date_format($date_end,"yyyy-mm-dd","-",1);

			$second_month_ldate=date("Y-m-t",strtotime($date_to));
			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			$prod_last_day=change_date_format($second_month_ldate,'yyyy-mm-dd');
			$prod_date_upto=" and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day' ";
			if($date_search_type==1)
			{
				$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
				$dates_com2=" and  f.process_end_date BETWEEN '$date_start' AND '$date_end' ";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 23:59:59' ";
				$dates_com2=" and f.insert_date between '".$date_start."' and '".$date_end." 23:59:59' ";
			}


		}
		elseif($db_type==2)
		{

			$date_from=change_date_format($txt_date_from,'','',1);
			$date_to=change_date_format($txt_date_to,'','',1);

			$start_dd= strtotime(change_date_format($date_from,"dd-mm-yyyy","-"));
			$end_dd= strtotime(change_date_format($date_from,"dd-mm-yyyy","-"));
			$start_d=date("Y-m-d",$start_dd);
			$end_d=date("Y-m-d",$end_dd);
			$date_from2 = strtotime($start_d);
			$date_to2 = strtotime($end_d);
			$date_start = date("Y-m-d",strtotime("-5 day", $date_from2));
			$date_end = date("Y-m-d",strtotime("+5 day", $date_to2));
			$date_start= change_date_format($date_start,"dd-mm-yyyy","-",1);
			$date_end= change_date_format($date_end,"dd-mm-yyyy","-",1);

			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			$second_month_ldate=date("Y-M-t",strtotime($date_to));
		    $prod_last_day=change_date_format($second_month_ldate,'','',1);
			$prod_date_upto="and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day'";
			if($date_search_type==1)
			{
				$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
				$dates_com2="and  f.process_end_date BETWEEN '$date_start' AND '$date_end'";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 11:59:59 PM' ";
				$dates_com2=" and f.insert_date between '".$date_start."' and '".$date_end." 11:59:59 PM' ";

			}

		}
	}

	$group_by=str_replace("'",'',$cbo_group_by);
	if($group_by==1)
	{
		$order_by="order by f.floor_id";
		$order_by2="order by floor_id";
	}
	else if($group_by==2)
	{
		$order_by="order by f.shift_name";
		$order_b2y="order by shift_name";
	}
	else if($group_by==3)
	{
		$order_by="order by f.machine_id";
		$order_by2="order by machine_id";
	}
	else
	{
		$order_by="order by f.process_end_date,f.machine_id";
		$order_by2="order by process_end_date,machine_id";
	}
	if($db_type==0)
	{
		if($cbo_type==1)//  For Dyeing WIP
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
				$sql="select a.id,a.company_id, a.batch_no, a.batch_date, a.batch_weight, a.color_id,a.booking_no, a.booking_no_id, a.extention_no, a.batch_against, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, group_concat( distinct c.po_number ) AS po_number, c.job_no_mst, d.job_no as job_no_prefix_num,d.style_ref_no, d.buyer_name, f.process_end_date, f.end_hours, f.end_minutes, f.machine_id,f.shift_name,f.floor_id, f.remarks from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g	where a.is_deleted=0 and f.status_active=1 $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond and g.id=a.color_id and a.entry_form=0 and a.id=b.mst_id and f.batch_id=a.id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=1 and a.batch_against in(1,2,3)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and f.is_deleted=0  GROUP BY a.id,b.item_description $order_by ";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
				$sql_subcon="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat(distinct c.order_no) AS po_number,d.subcon_job,d.subcon_job as job_no_prefix_num,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks,f.shift_name,f.floor_id from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where  f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id=1 and a.batch_against in(0) and a.id not in ($sub_batch_id) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  GROUP BY a.id, a.batch_no, a.company_id, d.party_id, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.subcon_job, d.job_no_prefix_num, d.party_id, f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.result, f.remarks ";
			}
		}
		else if($cbo_type==2)//   For Order Wise Dyeing Production
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
				$sql="select f.insert_date,a.batch_no,a.id, a.batch_weight,a.booking_no, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, group_concat( distinct c.po_number) AS po_number,c.grouping,c.file_no, d.job_no as job_no_prefix_num,d.style_ref_no,d.style_ref_no, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.remarks, f.result  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0
				group by a.batch_no, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.job_no,d.style_ref_no,d.style_ref_no, d.buyer_name,c.grouping,c.file_no, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.remarks, f.result,f.insert_date $order_by";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
			 $sql_subcon="select f.insert_date,a.batch_no,a.id, a.batch_weight,a.booking_no, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, group_concat(c.order_no) AS po_number, d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where  f.batch_id=a.id and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond  $workingCompany_name_cond2 $companyCond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  GROUP BY a.batch_no, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.subcon_job, d.party_id , f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.result,f.insert_date $order_by";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Batch Against- Sample
			{
				$sql_sam="(select f.insert_date,a.batch_no,a.id, a.batch_weight,a.booking_no, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, group_concat( distinct c.po_number) AS po_number, d.job_no as job_no_prefix_num,d.style_ref_no, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where  f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 group by a.batch_no, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.job_no,d.style_ref_no, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.result,f.insert_date)
			union
			 (
			 select f.insert_date,a.batch_no, a.id,a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, 'null', 'null', 'null', 'null', f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result,f.insert_date)  $order_by2";
			}
		}
		else if($cbo_type==3)//  For Daily Right First Time
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
			$sql="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where  f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond  $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond 	and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and and f.batch_id=b.mst_id a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description order by a.batch_no ";
			$sql_ltb="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and  g.id=a.color_id and f.batch_id=b.mst_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and a.batch_against in(1) and f.ltb_btb_id=2 and f.result in(1,2,3,4,5) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.id,b.po_id, b.item_description order by a.batch_no";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
		  $sql_subcon="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat(distinct c.order_no) AS po_number,d.subcon_job,d.job_no as job_no_prefix_num,d.party_id,f.production_date as process_end_date,f.process_end_date as production_date,f.ltb_btb_id,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id in(2) and a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  GROUP BY a.id,a.batch_no,a.company_id, d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.job_no,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks ";

		 $sql_subcon_ltb="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat(distinct c.order_no) as po_number,d.subcon_job,d.job_no as job_no_prefix_num,d.party_id,f.ltb_btb_id,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and  a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id in(2)   and a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=2 and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond   GROUP BY a.id,a.batch_no,a.company_id, d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.job_no,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks,f.ltb_btb_id ";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
			$sql_btb_sam="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond	$booking_no_cond $booking_id_cond  $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and f.batch_id=b.mst_id and a.batch_against in(3) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description order by a.batch_no ";
			$sql_ltb_sam="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where  f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  f.batch_id=a.id and f.batch_id=b.mst_id $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and  g.id=a.color_id and a.entry_form=0 and a.id=b.mst_id and a.batch_against in(3) and f.ltb_btb_id=2 and f.result in(1,2,3,4,5) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description order by a.batch_no";
			}
		}
		else if($cbo_type==4)//  For Daily Dyeing Reprocess Summary
		{
			$sql="select a.company_id, a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,group_concat( distinct c.po_number ) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.floor_id,f.shift_name,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.extention_no!=0 and a.batch_against in(2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.po_id,f.floor_id,f.shift_name, b.item_description $order_by";
		}
	}
	else if($db_type==2)// Oracle start here
	{
		if($cbo_type==1)//  For Dyeing WIP
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
			$sql="select a.id,a.company_id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type, LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.shift_name,f.floor_id,f.remarks from pro_batch_create_mst a,pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d, pro_fab_subprocess f,lib_color g	where  a.id=b.mst_id and f.batch_id=a.id and f.batch_id=b.mst_id and  b.po_id=c.id and d.job_no=c.job_no_mst and g.id=a.color_id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $machine_cond $floor_id_cond $cbo_prod_type_cond and a.entry_form=0  and f.entry_form=35 and f.load_unload_id=1 and a.batch_against in(1,2,3)   and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $batchIds_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  GROUP BY  a.id,f.shift_name,f.floor_id,a.company_id,a.batch_no,a.batch_date, a.batch_weight, a.color_id,a.booking_no, a.booking_no_id, a.extention_no, a.batch_against,b.item_description, b.po_id, b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no,d.style_ref_no, d.buyer_name, f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.remarks order by a.batch_no";

			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
			$subwip_batch_id_arr=array_chunk(array_unique(explode(",",$sub_batch_id)),999);

			 $sql_subcon="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.total_trims_weight,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.order_no) AS po_number,d.subcon_job,d.subcon_job as job_no_prefix_num,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks,f.shift_name,f.floor_id from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id=1 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $booking_no_cond $booking_id_cond   $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond";
			 $p=1;
			foreach($subwip_batch_id_arr as $subrow)
			{
				if($p==1) $sql_subcon .="and (a.id not in(".implode(',',$subrow).")"; else  $sql .=" OR a.id not in(".implode(',',$subrow).")";
				$p++;
			}
			$sql_subcon .=")";
			$sql_subcon .=" GROUP BY a.id,a.batch_no,a.company_id, f.shift_name,f.floor_id,d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.total_trims_weight,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.party_id,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks ";
			//echo $sql_subcon ;
			}
		}
		else if($cbo_type==2)//   For Order Wise Dyeing Production
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
				//sum(CASE WHEN a.extention_no=1 THEN b.batch_qnty ELSE 0 END) AS deying_qty
			
			 $sql="(select f.insert_date,a.batch_no, a.batch_weight,a.id, a.color_id,a.re_dyeing_from,a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.grouping,c.file_no, d.job_no as job_no_prefix_num,d.style_ref_no, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id,a.re_dyeing_from, a.color_id,a.total_trims_weight, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type,c.grouping,c.file_no,d.job_no,d.style_ref_no, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order,f.insert_date)
			 union
			 (
			 	select  f.insert_date, a.batch_no, a.batch_weight,a.id, a.color_id,a.re_dyeing_from,a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,b.item_description, b.po_id, b.prod_id, b.width_dia_type,null, null,null, null,null, h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond  $workingCompany_name_cond2 and f.batch_id=a.id  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  $dates_com  $batch_num  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $booking_no_cond $booking_id_cond  $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id,a.re_dyeing_from,a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type,
              f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,
              f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks,f.insert_date
			 ) $order_by2";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
				$sql_subcon="select f.insert_date,a.batch_no,a.id, a.batch_weight, a.color_id,a.booking_no, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.order_no) AS po_number, d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $booking_no_cond $booking_id_cond  $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond
				GROUP BY a.batch_no, a.id,a.batch_weight, a.color_id,a.booking_no, a.extention_no,a.total_trims_weight, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.subcon_job, d.party_id, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result,f.insert_date $order_by";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
				  $sql_sam="(select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type,c.file_no,c.grouping, LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number, d.job_no as job_no_prefix_num,d.style_ref_no, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, fabric_type,f.result from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $booking_no_cond $booking_id_cond  $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type, d.job_no,d.style_ref_no, d.buyer_name, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no,c.file_no,c.grouping, f.result,f.insert_date )
			 union
			 (
			 select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type,null, null,null, null,null, h.buyer_id as buyer_name,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond $workingCompany_name_cond2 and f.batch_id=a.id and f.batch_id=b.mst_id $dates_com  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.insert_date)  $order_by2";
			}
		}
		else if($cbo_type==3)//  For Daily Right First Time
		{

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
			$sql="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and f.batch_id=b.mst_id and a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id,a.booking_no, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no,d.style_ref_no, d.buyer_name, f.production_date,f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ";
			$sql_ltb="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result, f.remarks 	from pro_batch_create_dtls b, wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id  and f.batch_id=b.mst_id and a.batch_against in(1) and f.ltb_btb_id=2 and f.result in(1,2,3,4,5) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no,a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no,d.style_ref_no, d.buyer_name, f.production_date,f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
		  $sql_subcon="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.order_no)  AS po_number,d.subcon_job,d.subcon_job as job_no_prefix_num,d.party_id,f.production_date as process_end_date,f.process_end_date as production_date,f.ltb_btb_id,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id in(2) and a.batch_against in(1) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $booking_no_cond $booking_id_cond  $cbo_prod_source_cond GROUP BY a.id,a.batch_no,a.company_id, d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.party_id,f.production_date,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks ";

		 $sql_subcon_ltb="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,d.party_id as buyer_name, SUM(b.batch_qnty) AS sub_batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.order_no) as po_number,d.subcon_job,d.subcon_job as job_no_prefix_num,d.party_id,f.ltb_btb_id,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id  $companyCond $workingCompany_name_cond2 $booking_no_cond $booking_id_cond  and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=38 and f.load_unload_id in(2) and a.batch_against in(1) and f.result in(1,2,3,4,5)  and f.ltb_btb_id=2 and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY a.id,a.batch_no,a.company_id, d.party_id,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,b.item_description,b.po_id,b.prod_id,b.width_dia_type,d.subcon_job,d.party_id,f.production_date,f.process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.result,f.remarks,f.ltb_btb_id ";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // For Sample Production
			{
			 $sql_btb_sam="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond and $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(3) and f.result in(1,2,3,4,5) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no,a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst,d.buyer_name,d.style_ref_no, f.production_date,f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ";
			$sql_ltb_sam="select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond and $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and f.batch_id=b.mst_id and a.batch_against in(3) and f.ltb_btb_id=2 and f.result in(1,2,3,4,5) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no,a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.buyer_name,d.style_ref_no, f.production_date,f.process_end_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no";
			}
		}
		else if($cbo_type==4)//  For Daily Dyeing Reprocess Summary
		{
			$sql="select a.company_id, a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number,c.job_no_mst,d.job_no as job_no_prefix_num,d.style_ref_no,d.buyer_name,f.production_date as process_end_date,f.process_end_date as production_date,f.end_hours,f.end_minutes,f.machine_id,f.floor_id,f.shift_name,f.load_unload_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id  $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.extention_no!=0 and a.batch_against in(2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no,a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst,d.job_no, d.buyer_name,d.style_ref_no, f.production_date,f.process_end_date,f.end_hours, f.end_minutes, f.machine_id,f.floor_id,f.shift_name, f.load_unload_id, f.result, f.remarks  $order_by ";
		}
	}
	//$batchdata=sql_select($sql);
		//echo $sql_subcon; die;sql_subcon_ltb
	//	echo $sql;
	if($cbo_type==3) // For RFT
	{
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			$sql_subcon_data_ltb=sql_select($sql_subcon_ltb);
			$sql_subcon_data_btb=sql_select($sql_subcon);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//$batchdata=sql_select($sql);
			$batchdata_ltb=sql_select($sql_ltb);
			$batchdata=sql_select($sql);
		}

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
		{
			//$batchdata=sql_select($sql);
			$batchdata_ltb_sam=sql_select($sql_ltb_sam);
			$batchdata_btb_sam=sql_select($sql_btb_sam);

		}
	}
	if($cbo_type==2) // Dyeing Production
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//echo $sql;
			$batchdata=sql_select($sql);
			$batch_ids='';$po_ids='';
			foreach($batchdata as $row)
			{
				if($batch_ids=='') $batch_ids=$row[csf('id')]; else $batch_ids.=",".$row[csf('id')];
				if($po_ids=='') $po_ids=$row[csf('po_id')]; else $po_ids.=",".$row[csf('po_id')];
			}
			$batch_idss=implode(",",array_unique(explode(",",$batch_ids)));
			$po_idss=implode(",",array_unique(explode(",",$po_ids)));
			if($db_type==0)
			{
				if($batch_idss!='') $batch_id_cond="and a.id in($batch_idss)"; else $batch_id_cond="";
				if($batch_idss!='') $knit_batch_id_cond="and c.mst_id in($batch_idss)"; else $knit_batch_id_cond="";
				if($batch_idss!='') $dyeing_batch_id_cond="and f.batch_id in($batch_idss)"; else $dyeing_batch_id_cond="";
				if($po_idss!='') $dyeing_po_id_cond="and b.po_breakdown_id in($po_idss)"; else $dyeing_po_id_cond="";
			}
		}
		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon;
			$sql_subcon_data=sql_select($sql_subcon);
			$subcon_batch_ids='';
			foreach($sql_subcon_data as $row)
			{
				if($subcon_batch_ids=='') $subcon_batch_ids=$row[csf('id')]; else $subcon_batch_ids.=",".$row[csf('id')];
			}
			$subcon_batch_idss=implode(",",array_unique(explode(",",$subcon_batch_ids)));
			if($db_type==0)
			{
				if($subcon_batch_idss!='') $sub_batch_id_cond="and a.id in($subcon_batch_idss)"; else $sub_batch_id_cond="";
				if($subcon_batch_idss!='') $dye_sub_batch_id_cond="and f.batch_id in($subcon_batch_idss)"; else $dye_sub_batch_id_cond="";
			}
		}
		//echo $sql_sam;
		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) //Batch Aganist - Sample
		{
			//echo $sql_sam;
			$batchdata_sam=sql_select($sql_sam);
			$sam_batch_ids='';
			foreach($batchdata_sam as $row)
			{
				if($sam_batch_ids=='') $sam_batch_ids=$row[csf('id')]; else $sam_batch_ids.=",".$row[csf('id')];
				if($row[csf('booking_without_order')]==1)
				{
					$bookingNo.="'".$row[csf('booking_no')]."',";
				}
			}
			$sam_batch_idss=implode(",",array_unique(explode(",",$sam_batch_ids)));
			if($db_type==0)
			{
				if($sam_batch_idss!='') $sam_batch_id_cond="and a.id in($sam_batch_idss)"; else $sam_batch_id_cond="";
			}
			/*if($row[csf('booking_without_order')]==1)
			{
				$bookingNo.="'".$row[csf('booking_no')]."',";
			}*/

		}

		if($bookingNo!='')
		{
			$bookingIds=chop($bookingNo,','); $bookingIds_cond="";
			$totBooking_ids=count(array_unique(explode(",",$bookingNo)));
			//echo $tot_ids.'d';
			if($db_type==2 && $totBooking_ids>999)
			{
				$bookingIds_cond=" and (";
				$bookingIdsArr=array_chunk(explode(",",$bookingIds),999);
				foreach($bookingIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					$bookingIds_cond.=" b.booking_no in($ids) or ";
				}
				$bookingIds_cond=chop($bookingIds_cond,'or ');
				$bookingIds_cond.=")";
			}
			else
			{
				$bookingIds=implode(",",array_unique(explode(",",$bookingIds)));
				$bookingIds_cond=" and b.booking_no in($bookingIds)";
			}
			//$nonOrderBookingStyle_ref=sql_select("select b.booking_no,a.style_ref_no from  sample_development_mst a,  sample_development_yarn_dtls b where a.id=b.mst_id $bookingIds_cond group by a.style_ref_no,b.booking_no");
			$nonOrderBookingStyle_ref=sql_select("select b.booking_no,a.style_ref_no from sample_development_mst a,wo_non_ord_samp_booking_dtls b where a.id=b.style_id  $bookingIds_cond group by a.style_ref_no,b.booking_no ");

			foreach($nonOrderBookingStyle_ref as $rows)
			{
				$nonOrdBookingStyleRefArr[$rows[csf('booking_no')]]["style_ref_no"]=$rows[csf('style_ref_no')];
			}
		}
	//print_r($nonOrdBookingStyleRefArr);
	//print_r($sql_subcon_data);
	}
	if($cbo_type==1)
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon.'xdf';
			$sql_subcon_data=sql_select($sql_subcon);
		}
	//print_r($sql_subcon_data);
	}
	if($cbo_type==4)
	{
		$batchdata=sql_select($sql);
		/*if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon.'xdf';
			$sql_subcon_data=sql_select($sql_subcon);
		}*/
	//print_r($sql_subcon_data);
	}

	if($date_search_type==1)
	{
		$date_type_msg="Dyeing Date";
	}
	else
	{
		$date_type_msg="Insert Date";
	}
	$yarn_lot_arr=array();
	if($db_type==0)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='' $dyeing_po_id_cond  group by a.prod_id, b.po_breakdown_id");
		/*
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b, pro_batch_create_dtls c,pro_fab_subprocess f where a.id=b.dtls_id  and c.prod_id=a.prod_id and b.po_breakdown_id=c.po_id and f.batch_id=c.mst_id and f.entry_form=35 and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='' $unload_batch_cond2 $dates_com $cbo_prod_source_cond $shift_name_cond $cbo_prod_type_cond  $knit_batch_id_cond group by a.prod_id, b.po_breakdown_id");*/
	}
	else if($db_type==2)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)  as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' group by a.prod_id, b.po_breakdown_id");
	}
	foreach($yarn_lot_data as $rows)
	{
		$yarn_lot=explode(",",$rows[csf('yarn_lot')]);
		$yarn_lot_arr[$rows['prod_id']][$rows['po_breakdown_id']]=implode(",",array_unique($yarn_lot));
	}

		//print_r($yarn_lot_arr);
	$load_hr=array();
	$load_min=array();
	$load_date=array();
	$water_flow_arr=array();$load_hour_meter_arr=array();
	if ($working_company==0) $workingCompany_name_cond1=""; else $workingCompany_name_cond1="  and service_company='".$working_company."' ";
	if ($working_company==0) $workingCompany_name_cond13=""; else $workingCompany_name_cond13="  and f.service_company='".$working_company."' ";
	if ($company==0) $companyCond1=""; else $companyCond1="  and f.company_id=$company";


	$load_time_data=sql_select("select f.batch_id,f.water_flow_meter,f.batch_no,f.load_unload_id,f.process_end_date,f.end_hours,f.hour_load_meter,f.end_minutes from pro_fab_subprocess f where f.load_unload_id=1 and f.entry_form=35 $companyCond1 and  f.status_active=1  and f.is_deleted=0 $workingCompany_name_cond13 $dyeing_batch_id_cond");
	foreach($load_time_data as $row_time)// for Loading time
	{
		$load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}

	$subcon_load_hr=array();
	$subcon_load_min=array();
	$subcon_load_date=array();$subcon_load_hour_meter_arr=array();
	$subcon_water_flow_arr=array();
	$subcon_load_time_data=sql_select("select f.batch_id,f.water_flow_meter,f.batch_no,f.load_unload_id,f.process_end_date,f.end_hours,f.hour_load_meter,f.end_minutes from pro_fab_subprocess f where f.load_unload_id=1 and f.entry_form=38 $companyCond1  and f.status_active=1  and f.is_deleted=0 $unload_batch_cond2  $cbo_prod_source_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $workingCompany_name_cond1 $dyeing_batch_id_cond");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
		$subcon_load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$subcon_load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$subcon_load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$subcon_water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$subcon_load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_unload_hr=array();
	$subcon_unload_min=array();
	$subcon_unload_date=array();
	$subcon_unload_time_data=sql_select("select f.batch_id,f.batch_no,f.load_unload_id,f.production_date,f.end_hours,f.end_minutes from pro_fab_subprocess f where f.load_unload_id=2 and f.entry_form=38 $companyCond1 $workingCompany_name_cond1 and f.status_active=1  and f.is_deleted=0 $unload_batch_cond2  $cbo_prod_source_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $dyeing_batch_id_cond");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
	$subcon_unload_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
	$subcon_unload_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
	$subcon_unload_time_data[$row_time[csf('batch_id')]]=$row_time[csf('production_date')];
	}
	//var_dump($load_hr);

	$m_capacity=array();
	$unload_min=array();
	$machine_arr=return_library_array( "select id,$field_concat from  lib_machine_name order by seq_no ",'id','machine_name');
	$machine_capacity_data=sql_select("select id,prod_capacity as m_capacity  from lib_machine_name where status_active=1  and is_deleted=0 ");
	foreach($machine_capacity_data as $capacity)// for Un-Loading time
	{
		$m_capacity[$capacity[csf('id')]]=$capacity[csf('m_capacity')];
	}

	$sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=35 $companyCond1 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0  $unload_batch_cond2  $cbo_prod_source_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $dyeing_batch_id_cond");
	$tot_row=1;$batch_id='';
	foreach($sql_batch_id as $row_batch)
	{
	if($batch_id=='') $batch_id=$row_batch[csf('batch_id')];else $batch_id.=",".$row_batch[csf('batch_id')];
	$batch_unload_check[$row_batch[csf('batch_id')]]=$row_batch[csf('batch_id')];

	}//echo $batch_id;die;
		unset($sql_batch_id);

		if($batch_id!='')
		{
			$batchIds=chop($batch_id,','); $batchIds_cond="";
			$tot_ids=count(array_unique(explode(",",$batch_id)));
			//echo $tot_ids.'d';
			if($db_type==2 && $tot_ids>999)
			{
				$batchIds_cond=" and (";
				$batchIdsArr=array_chunk(explode(",",$batchIds),999);
				foreach($batchIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					$batchIds_cond.=" a.id not in($ids) or ";
				}
				$batchIds_cond=chop($batchIds_cond,'or ');
				$batchIds_cond.=")";
			}
			else
			{
				$batchIds=implode(",",array_unique(explode(",",$batchIds)));
				$batchIds_cond=" and a.id not in($batchIds)";
			}
		}
		//echo $batchIds_cond;
	if($cbo_type==1)//  For Dyeing WIP
	{
		$sub_sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=38 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0 $unload_batch_cond2 $dates_com $cbo_prod_source_cond $shift_name_cond $cbo_prod_type_cond  $dye_sub_batch_id_cond ");
		//echo "select f.batch_id from  pro_fab_subprocess f where f.entry_form=38 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0 $unload_batch_cond2 $dates_com $cbo_prod_source_cond $shift_name_cond $cbo_prod_type_cond";die;
		$k=1;
		foreach($sub_sql_batch_id as $row_batch)
		{
			if($k!=1) $sub_batch_id.=",";
			$sub_batch_id.=$row_batch[csf('batch_id')];

			$k++;
		}
		if($batch_id=="") $batch_id=0;
		if($sub_batch_id=="") $sub_batch_id=0;
	}
	ob_start();
	if($cbo_type==1)//Dyeing WIP Start
	{
	?>
	<div>
	<fieldset style="width:1270px;">
	<div  align="center"> <strong> <? echo $company_library[$company]; ?> </strong><br><strong> Dyeing WIP </strong> </div>
    <div>
    <?
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{

	if (count($batchdata)>0)
	{
	?>
     <div align="left"> <b>Self batch </b></div>
	 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header_1">
			<thead>
				<tr>
					<th width="30">SL</th>
				 <? if($group_by==3 || $group_by==0){ ?>
                     <th width="80">M/C No</th>
                     <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">Floor</th>
                     <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">Shift</th>
                     <? } ?>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="70">Dia/ Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="100">Booking No</th>
					<th width="40">Ext. No</th>
					<th width="80">Dyeing Qty.</th>
					<th width="60">Lot No</th>
					<th width="100">Loading Date & Time</th>
					<th>Reprocess</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:360px; width:1390px; overflow-y:scroll;" id="scroll_body">
	<table class="rpt_table" id="table_body" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
	<tbody>
				<?
				$i=1;$k=1;
				$f=0;
				$btq=0;$grand_total_batch_qty=0;
				$batch_chk_arr=array();$group_by_arr=array();
				foreach($batchdata as $batch)
				{
				if ($i%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
				if($batch_unload_check[$batch[csf('id')]]=='')
				{
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <td colspan="3">Sub.Total: </td>
                                    <td width="80"><? echo number_format($btq,2); ?></td>
                                    <td width="60"></td>
                                    <td width="100"></td>

                                    <td width="90">&nbsp;</td>
                                </tr>
								<?
								unset($btq);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="15" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}

				$order_id=$batch[csf('po_id')];
				$color_id=$batch[csf('color_id')];
				$desc=explode(",",$batch[csf('item_description')]);
				$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
				?>
				<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">
					<td width="30"><? echo $i; ?></td>
                     <? if($group_by==3 || $group_by==0){ ?>
                       <td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? //echo $color_library[$batch[csf('color_id')]]; ?>"><p class="wrap_break"><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p class="wrap_break"><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('prod_id')]; ?>"><p class="wrap_break"><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="70" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p class="wrap_break"><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="center" width="100"><p><? echo $batch[csf('booking_no')]; ?></p></td>
					<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
					<td align="right" width="80"   title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
					<td align="left" width="60" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
					<td width="100"><p><?   echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>

					<td align="center" width="90" title="<? if($batch[csf('batch_against')]==2) echo $batch_against[$batch[csf('batch_against')]]; ?>"><?  if($batch[csf('batch_against')]==2) echo $batch_against[$batch[csf('batch_against')]];?> &nbsp;</td>
				</tr>
	<?
	$i++;
	$btq+=$batch[csf('batch_qnty')];

	$grand_total_batch_qty+=$batch[csf('batch_qnty')];
				}
	} //batchdata froeach
	 ?>
	</tbody>
	</table>
	 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
			<tfoot>
            <?
            if($group_by!=0)
				{
					?>
				<tr>
					<th width="30">&nbsp;</th>
					 <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">&nbsp;</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } ?>
					<th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="70">&nbsp;</th>
					<th width="80">&nbsp;</th>

                    <th colspan="3" width="230">Total</th>
					<th width="80" align="right"><? echo number_format($btq,2); ?></th>

					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
				</tr>
                <?
				}
				?>
                <tr>
					<th width="30">&nbsp;</th>
					 <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">&nbsp;</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } ?>
					<th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="70">&nbsp;</th>
					<th width="80">&nbsp;</th>

                    <th colspan="3" width="230">GrandTotal</th>
					<th width="80" align="right"><? echo number_format($grand_total_batch_qty,2); ?></th>

					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
				</tr>
			</tfoot>
	</table>
	</div>
    <br/>
     <?
	}

	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if(count($sql_subcon_data)>0)
		{
		?>
		<div align="left"> <b>SubCon batch </b></div>
			 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="">
				<thead>
					<tr>
						<th width="30">SL</th>
						<? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift</th>
                         <? } ?>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70">Dia/ Width Type</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="100">Booking No</th>
						<th width="40">Ext. No</th>
						<th width="80">Dyeing Qty.</th>
						<th width="60">Lot No</th>
						<th width="100">Loading Date & Time</th>
						<th  width="">Reprocess</th>
					</tr>
				</thead>
			</table>
		<div style=" max-height:360px; width:1390px; overflow-y:scroll;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
		<tbody>
					<?
					$m=1;$k=1;
					$n=0;$grand_sub_btq=0;
					$sub_btq=0;
					$subbatch_chk_arr=array();$sub_group_by_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($m%2==0) $subbgcolor="#E9F3FF"; else $subbgcolor="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$sub_group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <td colspan="3">Sub.Total: </td>
                                    <td width="80"><? echo number_format($sub_btq,2); ?></td>
                                    <td width="60"></td>
                                    <td width="100"></td>

                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($sub_btq);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="15" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$sub_group_by_arr[]=$group_value;
							$k++;
						}
					}

					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					?>
					<tr bgcolor="<? echo $subbgcolor; ?>" onClick="change_color('tr_<? echo $m; ?>','<? echo $subbgcolor;?>')" id="tr_<? echo $m; ?>">

						<td width="30"><? echo $m; ?></td>
                          <? if($group_by==3 || $group_by==0){ ?>
                       <td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>

						<td  width="100" ><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? //echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td width="90" title="<? echo $po_number; ?>"><p class="wrap_break"><? echo $po_number; ?></p></td>


						<td  width="100"><p class="wrap_break"><? echo $batch[csf('item_description')]; ?></p></td>
						<td  width="70" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						<td  align="center" width="90" ><p class="wrap_break"><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="100" ><p><? echo $batch[csf('booking_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="80"   title="<? echo $batch[csf('sub_batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>
						<td align="left" width="60" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
						<td width="100"><p><?  echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>

						<td align="center"  title="<? if($batch[csf('batch_against')]==2) echo $batch_against[$batch[csf('batch_against')]]; ?>"><?  if($batch[csf('batch_against')]==2) echo $batch_against[$batch[csf('batch_against')]];?> &nbsp;</td>
					</tr>
		<?
		$m++;
		$sub_btq+=$batch[csf('sub_batch_qnty')];
		$grand_sub_btq+=$batch[csf('sub_batch_qnty')];
		} //batchdata froeach
		 ?>
		</tbody>
		</table>
		 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
				<tfoot>
                 <?
            if($group_by!=0)
				{
					?>
					<tr>
						<th width="30">&nbsp;</th>
						<? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">&nbsp;</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } ?>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="40">Total</th>
						<th width="80"><? echo number_format($sub_btq,2); ?></th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
                    <?
				}
					?>
                    <tr>
						<th width="30">&nbsp;</th>
						<? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">&nbsp;</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">&nbsp;</th>
                         <? } ?>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>

						<th colspan="3" width="230">GrandTotal</th>
						<th width="80"><? echo number_format($grand_sub_btq,2); ?></th>
						<th width="60">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</tfoot>
		</table>
		</div>
		</div>
		 <?
		}
	}
	?>
	</fieldset>
	</div>
	<?
	}
	else if($cbo_type==2) //  Dyeing Production
	{
		?>
		<div>
		<style>
    	.wrap_break
		{
			word-break:break-all;
			word-wrap:break-word;
		}
    </style>
		<fieldset style="width:1350px;">
		<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Dyeing Production </strong><br>
		<?
			//echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
			echo  ($date_from == '0000-00-00' || $date_from == '' ? '' : change_date_format($date_from)).' To ';echo  ($date_to == '0000-00-00' || $date_to == '' ? '' : change_date_format($date_to));
			?>
		 </div>
		 <?

		 if ($cbo_result_name==1 || $cbo_result_name==0)
		 {

		 ?>
		 <div>
         <table cellpadding="0"  width="300" cellspacing="0" align="left"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="3">Production Summary</th>
								</tr>
								<tr>
									<th>Details </th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?

							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
							 $sql="select f.load_unload_id,f.process_end_date,count(f.process_end_date) as row_count, SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0  $batch_id_cond $prod_date_upto $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY f.load_unload_id,f.process_end_date  ";
							$sql_datas=sql_select($sql);
							}
							$unload_qty_arr=array();$plan_cycle_time=0;
							foreach($sql_datas as $row)
							{
								$tot_row=count($row[csf('process_end_date')]);
								$unload_qty_arr[$row[csf('load_unload_id')]]['qty']+=$row[csf('batch_qnty')];
								$unload_qty_arr[$row[csf('load_unload_id')]]['count']+=$tot_row;
							}

							//print_r($unload_qty_arr);
							$total_current_mon_qty=$unload_qty_arr[2]['qty'];
							$total_count=$unload_qty_arr[2]['count'];

							 $sql_result="select f.fabric_type,f.process_end_date,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and f.status_active=1 and f.is_deleted=0  $batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $booking_no_cond $booking_id_cond$cbo_prod_type_cond $cbo_prod_source_cond GROUP BY f.fabric_type,f.process_end_date  ";//and f.fabric_type in(1,4,5,6)
							$sql_result=sql_select($sql_result);
							$fabric_batch_arr=array();
							foreach($sql_result as $row)
							{
								$fabric_batch_arr[$row[csf('fabric_type')]]['qty']+=$row[csf('batch_qnty')];
								//$tot_batch_qty+=$row[csf('batch_qnty')];
							}

							//print_r($fabric_batch_arr);

								?>
								  <tr bgcolor="#E9F3FF" style="cursor:pointer;">

									  <td>Current Month</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty,2);?></td>
									  <td align="right"><?  ?></td>
								  </tr>
                                  <tr bgcolor="#D8D8D8" style="cursor:pointer;">

									  <td>Avg. Prod. Per Day</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty/$total_count,2); ?></td>
									  <td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
								  </tr>
                                  <? $k=1;	$tot_batch_qty=0;
								 //$fabric_type_for_dyeing2=array(1=>'Cotton',2=>'Polyster',3=>'Lycra',4=>'Both Part',5=>'White',6=>'Wash');

								  //print_r($fabric_type_for_dyeingnn);
								  foreach($fabric_batch_arr as $typekey=>$val)
								  	{
										if ($k%2==0) $bgcolor="#FFFFFF"; else $bgcolor="#E9F3FF";
										if($typekey==1)
										{
											$fab_type="Cotton";
										}
										else if($typekey==2)
										{
											$fab_type="Polyster";
										}
										else if($typekey==3)
										{
											$fab_type="Lycra";
										}
										else if($typekey==4)
										{
											$fab_type="Both Part";
										}
										else if($typekey==5)
										{
											$fab_type="White";
										}
										else if($typekey==6)
										{
											$fab_type="Wash";
										}
											  ?>
                                   <tr bgcolor="<? echo $bgcolor;?>">
									 <? //print_r($fabric_type_for_dyeing);?>
									  <td><?php echo $fabric_type_for_dyeing[$typekey]; ?></td>
                                       <td align="right"><? echo number_format($val['qty'],2); ?></td>
									  <td align="right"><? echo number_format(($val['qty']/$total_current_mon_qty)*100,2); ?></td>
								  </tr>
							<? 		$tot_batch_qty+=$val['qty'];
								  	$k++;
									}

							?>
							</tbody>
							<tfoot>
								<tr>
									<th align="right">Total </th>
									<th align="right"><b><? echo number_format($tot_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format(($tot_batch_qty/$total_current_mon_qty*100),2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>

			<table cellpadding="0"  width="1210" cellspacing="0" align="left" >
				 <tr>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">Self n Trims Batch (Shade Match)</th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
								if($db_type==0)
								{
									$sum_grp="group_concat(distinct c.po_number) as po_number";
								}
								else
								{
									$sum_grp="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number";
								}

							$sql_dt="(select a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.po_id, b.prod_id, b.width_dia_type, $sum_grp,c.grouping,c.file_no, d.job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2   $batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0
						 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.total_trims_weight, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type,c.grouping,c.file_no,d.job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order)
						 union
						 (
							select a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,b.item_description, b.po_id, b.prod_id, b.width_dia_type,null, null,null, null, h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date,
				f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond  $workingCompany_name_cond2 and f.batch_id=a.id and f.batch_id=b.mst_id and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.result=1 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $batch_id_cond $dates_com  $batch_num $buyerdata2  $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $buyerdata2 $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.po_id, b.prod_id, b.width_dia_type,
						  f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,
						  f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks
						 )  order by buyer_name";
						 $sql_d=sql_select($sql_dt);$total_batch_qty2=0;
						 $buyer_trims_self_arr=array();
						 foreach($sql_d as $row)
						 {
							  $buyer_trims_self_arr[$row[csf('buyer_name')]]['trims']+=$row[csf('total_trims_weight')];
							  $buyer_trims_self_arr[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
							  $total_batch_qty2+=$row[csf('batch_qnty')]+$row[csf('total_trims_weight')];
						 }
						 unset($sql_d);
			       }


							$k=1;$total_batch_qty=0;$tot_batch_per=0;
							foreach($buyer_trims_self_arr as $key=>$val)
							{
								if ($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
								//$trims_qty=$party_batch_arr[$key]['trims_weight'];
								 $trims_qty_sum=$val['trims'];
								?>
								  <tr bgcolor="<? echo $bgcolor; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right"><? echo number_format($val['qty']+$trims_qty_sum,2,'.',''); $total_batch_qty+=$val['qty']+$trims_qty_sum; ?></td>
									  <td align="right"><? $batch_per=(($val['qty']+$trims_qty_sum)/$total_batch_qty2)*100; echo number_format($batch_per,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$tot_batch_per+=$batch_per;
							$k++;
							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($tot_batch_per,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
                     <td width="50"> </td>
                      <td width="300">
                      <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">Sample n Trims Batch (Shade Match)</th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{

								if($db_type==0)
								{
									if($sam_batch_idss!='') //$sam_batch_id_cond="and a.id in($sam_batch_idss)"; else $sam_batch_id_cond="";
									{

							$sql_sam="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $sam_batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary $booking_no_cond $booking_id_cond $cbo_prod_type_cond $cbo_prod_source_cond group by d.buyer_name,a.total_trims_weight )
								union
			 					(
			 select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  h.booking_no=a.booking_no  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $sam_batch_id_cond $dates_com  $buyerdata2 $batch_num  $year_cond $color_name   $result_name_cond_summary $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond
			 					GROUP BY h.buyer_id,a.total_trims_weight)";
									}
								}
								else
								{
									$sql_sam="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $sam_batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond group by d.buyer_name,a.total_trims_weight )
								union
			 					(
			 select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and h.booking_no=a.booking_no  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0  $dates_com  $buyerdata2 $batch_num  $year_cond $color_name   $result_name_cond_summary $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond
			 					GROUP BY h.buyer_id,a.total_trims_weight)";
								}
							$sql_data_sam=sql_select($sql_sam);
							//echo $sql_sam;die;
							}

							$samp_party_batch_arr=array(); $tot_batch_qty_sam=0;$tot_batch_trims_qty_sam=0;
							foreach($sql_data_sam as $row)
							{
								$samp_party_batch_arr[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
								$samp_party_batch_arr[$row[csf('buyer_name')]]['trims_qty']+=$row[csf('trims_weight')];
								$samp_party_batch_arr[$row[csf('buyer_name')]]['buyer']=$row[csf('buyer_name')];
								$tot_batch_qty_sam+=$row[csf('batch_qnty')]+$row[csf('trims_weight')];
								//$tot_batch_trims_qty_sam+=$row[csf('trims_weight')];
							}
							unset($sql_data_sam);
							$k=1;$total_batch_qty_sam=0;$tot_batch_per_sam=0;
							foreach($samp_party_batch_arr as $key=>$val)
							{
								if ($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
								$smp_trims=$samp_party_batch_arr[$key]['trims_qty'];
								?>
								  <tr bgcolor="<? echo $bgcolor; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right" title="Batch Qty+Trims Qty"><? echo number_format($samp_party_batch_arr[$key]['qty']+$smp_trims,2,'.',''); $total_batch_qty_sam+=$samp_party_batch_arr[$key]['qty']+$smp_trims; ?></td>
									  <td align="right"><? $batch_per_sam=(($samp_party_batch_arr[$key]['qty']+$smp_trims)/$tot_batch_qty_sam)*100; echo number_format($batch_per_sam,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$tot_batch_per_sam+=$batch_per_sam;
							$k++;
							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty_sam,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($tot_batch_per_sam,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						  <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">SubContact Batch (Shade Match)</th>
								</tr>
								<tr>
									<th width="20">SL </th>
									<th width="140">Buyer </th>
									<th width="70">Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
                            </table>

                            <div style="width:300px; overflow-y:scroll; max-height:210px" id="scroll_body" >
                            <table class="rpt_table" width="280" cellpadding="0" cellspacing="0" border="1" rules="all">
							<tbody>
							<?

							//echo $batch_type=str_replace("'",'',$cbo_batch_type);
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
							{
						   $sql_sub="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and f.result=1  and a.batch_against in(1,2) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 $sub_batch_id_cond $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.party_id ";
						   $sql_data_sub=sql_select($sql_sub);
							}
							$sub_party_batch_arr=array();$tot_sub_batch_qty=0;
							foreach($sql_data_sub as $row)
							{
								$sub_party_batch_arr[$row[csf('party_id')]]['qty']=$row[csf('sub_batch_qnty')];
								$sub_party_batch_arr[$row[csf('party_id')]]['buyer']=$row[csf('party_id')];
								$tot_sub_batch_qty+=$row[csf('sub_batch_qnty')];
							}
							$p=1;$total_sub_batch_qty=0;$total_batch_per_sub=0;
							foreach($sub_party_batch_arr as $id=>$sval)
							{
								if ($p%2==0) $bgcolor_sub="#E9F3FF"; else $bgcolor_sub="#FFFFFF";

								?>
								  <tr bgcolor="<? echo $bgcolor_sub; ?>" style="cursor:pointer;">
									  <td  width="20" ><? echo $p; ?></td>
									  <td width="140"><? echo $buyer_arr[$id] ?></td>
									  <td  width="70" align="right"><? echo number_format($sub_party_batch_arr[$id]['qty'],2,'.',''); $total_sub_batch_qty+=$sub_party_batch_arr[$id]['qty']; ?></td>
									  <td align="right"><? $batch_per_sub=($sub_party_batch_arr[$id]['qty']/$tot_sub_batch_qty)*100; echo number_format($batch_per_sub,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$total_batch_per_sub+=$batch_per_sub;
							$p++;
							}
							?>
							</tbody>
                            <tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_sub_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($total_batch_per_sub,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
                            </table>
                            </div>

						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="5">Summary Total(Shade Match)</th>
								</tr>
								<tr>
									<th>Self Batch</th>
									<th>Sample Batch</th>
                                    <th>SubCon Batch</th>
									<th>Total</th>
								</tr>
							</thead>
							<tbody>
								 <tr bgcolor="#FFFFFF"  style="cursor:pointer;">
									  <td width="30"><? echo number_format($total_batch_qty,2); ?></td>
                                      <td width="30"><? echo number_format($total_batch_qty_sam,2); ?></td>
									  <td width="30"><? echo number_format($total_sub_batch_qty,2); ?></td>
									  <td width="30"><? $grand_total=$total_batch_qty+$total_sub_batch_qty+$total_batch_qty_sam; echo number_format($grand_total,2);?></td>
								  </tr>
								  <tr bgcolor="#E9F3FF">
								   <td><?  echo number_format(($total_batch_qty/$grand_total)*100,2).'%'; ?></td>
                                   <td><?  echo number_format(($total_batch_qty_sam/$grand_total)*100,2).'%'; ?></td>
									  <td><?  echo number_format(($total_sub_batch_qty/$grand_total)*100,2).'%'; ?></td>
									  <td><?  echo '100%'; ?></td>
								  </tr>
							</tbody>
						</table>
					 </td>
				 </tr>
			 </table>
		 </div>
		 <br />
		 <?
		}
		 if ($cbo_result_name!=1 || $cbo_result_name==0)
		 {

		 ?>
		  <div>
          	<table cellpadding="0" style="border:0"  width="300" cellspacing="0" align="left"  class="rpt_table" rules="all" border="0">

            <tr>
                <th colspan="4"></th>
            </tr>

			</table>
			 <table cellpadding="0"  width="1210" cellspacing="0" align="left" >
				 <tr>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">Self n Trims Batch (Not Shade Match) </th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0) $result_name_cond_summary_not=" and f.result!=1"; else $result_name_cond_summary_not="  and f.result='".$cbo_result_name."' ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{

							if($db_type==0)
							{
								if($subcon_batch_idss!='')
								{


								$sql_not="select d.buyer_name,a.total_trims_weight as trims_weight,  SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 $dye_sub_batch_id_cond $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.buyer_name,a.total_trims_weight ";
								$sql_data_not=sql_select($sql_not);
								}

							}
							else
							{
								$sql_not="select d.buyer_name,a.total_trims_weight as trims_weight,  SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.buyer_name,a.total_trims_weight ";
							$sql_data_not=sql_select($sql_not);
							}


							}

							$tot_batch_qty_not=0;$total_batch_qty_not=0;
							$party_batch_arr_not=array();
							foreach($sql_data_not as $row)
							{
								$party_batch_arr_not[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
								$party_batch_arr_not[$row[csf('buyer_name')]]['trims_weight']+=$row[csf('trims_weight')];
								$party_batch_arr_not[$row[csf('buyer_name')]]['buyer']=$row[csf('buyer_name')];
								$tot_batch_qty_not+=$row[csf('batch_qnty')]+$row[csf('trims_weight')];
							}
							$k=1;$total_batch_per_not=0;
							foreach($party_batch_arr_not as $key=>$val)
							{
								if ($k%2==0) $bgcolor_not="#E9F3FF"; else $bgcolor_not="#FFFFFF";
								$trims_not=$party_batch_arr_not[$key]['trims_weight'];
								//echo $trims_not.'ad'.$party_batch_arr_not[$key]['qty'];
								?>
								  <tr bgcolor="<? echo $bgcolor_not; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right"><? echo number_format($party_batch_arr_not[$key]['qty']+$trims_not,2,'.',''); $total_batch_qty_not+=$party_batch_arr_not[$key]['qty']+$trims_not; ?></td>
                                      <td align="right"><? $batch_per_not=(($party_batch_arr_not[$key]['qty']+$trims_not)/$tot_batch_qty_not)*100; echo number_format($batch_per_not,2,'.','').'%'; ?></td>
                                      </tr>
							<?
							$total_batch_per_not+=$batch_per_not;
							$k++;

							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty_not,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($total_batch_per_not,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
                     <td width="50"></td>
					 <td width="300">
                     <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">Sample n Trims Batch(Not Shade Match)</th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0) $result_name_cond_summary_not=" and f.result!=1"; else $result_name_cond_summary_not="  and f.result='".$cbo_result_name."' ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
							if($db_type==0)
								{
									if($sam_batch_idss!='') //$sam_batch_id_cond="and a.id in($sam_batch_idss)"; else $sam_batch_id_cond="";
									{

							  $sql_sam_not="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $sam_batch_id_cond $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond group by d.buyer_name,a.total_trims_weight)
								union
			 					(
			 select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  h.booking_no=a.booking_no  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com  $batch_num $buyerdata2 $year_cond $color_name   $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $shift_name_cond $machine_cond $sam_batch_id_cond $floor_id_cond $booking_no_cond $booking_id_cond GROUP BY h.buyer_id,a.total_trims_weight)";
			 					$sql_data_not_samp=sql_select($sql_sam_not);
								}
					 		}
							else
							{
								$sql_sam_not="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond group by d.buyer_name,a.total_trims_weight)
								union
			 					(
			 select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  h.booking_no=a.booking_no  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com  $batch_num $buyerdata2 $year_cond $color_name   $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond $shift_name_cond $machine_cond  $floor_id_cond $booking_no_cond $booking_id_cond GROUP BY h.buyer_id,a.total_trims_weight)";
								$sql_data_not_samp=sql_select($sql_sam_not);
							}


							}
							$total_batch_per_not_samp=0;$total_batch_qty_not_samp=0;
							$party_batch_arr_not_sam=array();
							foreach($sql_data_not_samp as $row)
							{
								$party_batch_arr_not_sam[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
								$party_batch_arr_not_sam[$row[csf('buyer_name')]]['trims_qty']+=$row[csf('trims_weight')];
								$party_batch_arr_not_sam[$row[csf('buyer_name')]]['buyer']=$row[csf('buyer_name')];
								$total_batch_qty_not_samp+=$row[csf('batch_qnty')]+$row[csf('trims_weight')];

							}
							$k=1;//$total_batch_qty_not_samp=0;
							foreach($party_batch_arr_not as $key=>$val)
							{
								if ($k%2==0) $bgcolor_not="#E9F3FF"; else $bgcolor_not="#FFFFFF";
								$trims_samp_not=$party_batch_arr_not_sam[$key]['trims_qty'];
								?>
								  <tr bgcolor="<? echo $bgcolor_not; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right" title="Batch Qty+Trims Qty"><? echo number_format($party_batch_arr_not_sam[$key]['qty']+$trims_samp_not,2,'.',''); //$total_batch_qty_not_samp+=$party_batch_arr_not_sam[$key]['qty']+$trims_samp_not; ?></td>
                                      <td align="right"><? $batch_per_not_samp=($party_batch_arr_not_sam[$key]['qty']+$trims_samp/$total_batch_qty_not_samp)*100; echo number_format($batch_per_not_samp,2,'.','').'%'; ?></td>
                                      </tr>
							<?
							$total_batch_per_not_samp+=$batch_per_not_samp+$trims_samp_not;
							$k++;

							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty_not_samp,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($total_batch_per_not_samp,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="4">SubContact Batch (Not Shade Match)</th>
								</tr>
								<tr>
									<th>SL </th>
									<th>Buyer </th>
									<th>Batch Total</th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?

							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
							{
								if($db_type==0)
								{
								if($subcon_batch_idss!='')
								{
						    		$sql_sub_not="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and f.batch_id=b.mst_id and a.batch_against in(1,2) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not $dye_sub_batch_id_cond  $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.party_id ";
						   			$sql_data_sub_not=sql_select($sql_sub_not);
						   		}
						  	 }
							 else
							 {
							 	  $sql_sub_not="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.batch_id=b.mst_id and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.status_active=1 and f.is_deleted=0 $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not  $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond $booking_id_cond GROUP BY d.party_id ";
						   $sql_data_sub_not=sql_select($sql_sub_not);
							 }
							}


							$sub_party_batch_arr_not=array(); $tot_sub_batch_qty_not=0;
							foreach($sql_data_sub_not as $row)
							{
								$sub_party_batch_arr_not[$row[csf('party_id')]]['qty']=$row[csf('sub_batch_qnty')];
								$sub_party_batch_arr_not[$row[csf('party_id')]]['buyer']=$row[csf('party_id')];
								$tot_sub_batch_qty_not+=$row[csf('sub_batch_qnty')];
							}
							$p=1;$total_sub_batch_qty_not=0;$total_batch_per_sub_not=0;
							foreach($sub_party_batch_arr_not as $id=>$sval)
							{
								if ($p%2==0) $bgcolor_sub_not="#E9F3FF"; else $bgcolor_sub_not="#FFFFFF";

								?>
								  <tr bgcolor="<? echo $bgcolor_sub_not; ?>" style="cursor:pointer;">
									  <td ><? echo $p; ?></td>
									  <td><? echo $buyer_arr[$id] ?></td>
									  <td align="right"><? echo number_format($sub_party_batch_arr_not[$id]['qty'],2,'.',''); $total_sub_batch_qty_not+=$sub_party_batch_arr_not[$id]['qty']; ?></td>
									  <td align="right"><? $batch_per_sub_not=($sub_party_batch_arr_not[$id]['qty']/$tot_sub_batch_qty_not)*100; echo number_format($batch_per_sub_not,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$total_batch_per_sub_not+=$batch_per_sub_not;
							$p++;
							}
							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_sub_batch_qty_not,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($total_batch_per_sub_not,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="5">Summary Total( Not Shade Match)</th>
								</tr>
								<tr>
									<th>Self Batch</th>
                                    <th>Sample Batch</th>
									<th>SubCon Batch</th>
									<th>Total</th>
								</tr>
							</thead>
							<tbody>
								 <tr bgcolor="#FFFFFF"  style="cursor:pointer;">
									  <td width="30"><? echo $total_batch_qty_not; ?></td>
                                      <td width="30"><? echo $total_batch_qty_not_samp; ?></td>
									  <td width="30"><? echo $total_sub_batch_qty_not; ?></td>
									  <td width="30"><?  echo $grand_total_not=$total_batch_qty_not+$total_sub_batch_qty_not+$total_batch_qty_not_samp; ?></td>
								  </tr>
								  <tr bgcolor="#E9F3FF">
								   <td><?  echo number_format(($total_batch_qty_not/$grand_total_not)*100,2).'%'; ?></td>
                                   <td><?  echo number_format(($total_batch_qty_not_samp/$grand_total_not)*100,2).'%'; ?></td>
									  <td><?  echo number_format(($total_sub_batch_qty_not/$grand_total_not)*100,2).'%'; ?></td>
									  <td><?  echo '100%'; ?></td>
								  </tr>
							</tbody>
						</table>
					 </td>
				 </tr>
			 </table>
		 </div>
		 <br/>
		 <?
		 }
		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		 {
			$batch_dtls_arr3=array();
			if (count($batchdata)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 
			$re_dyeing_from="";
			foreach($batchdata as $row)
			{

				if($row[csf('result')]==1)
				$batch_dtls_arr2[$row[csf('batch_no')]][$row[csf('result')]]['re_dyeing_from'].=$row[csf('re_dyeing_from')].',';
				if($row[csf('extention_no')]=="" || $row[csf('extention_no')]==0)
				{
				$batch_dtls_arr3[$row[csf('batch_no')]]['result']=$row[csf('result')];
				}
				if($row[csf('extention_no')]>0)
				{
				$batch_dtls_arr33[$row[csf('batch_no')]]['result']=$row[csf('result')];
				}
				
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['batch_qnty']+=$row[csf('batch_qnty')];
				
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['id']=$row[csf('id')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['batch_no']=$row[csf('batch_no')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['extention_no']=$row[csf('extention_no')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['insert_date']=$row[csf('insert_date')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['production_date']=$row[csf('production_date')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['floor_id']=$row[csf('floor_id')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['po_number']=$row[csf('po_number')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['po_id']=$row[csf('po_id')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['machine_id']=$row[csf('machine_id')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['shift_name']=$row[csf('shift_name')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['batch_weight']=$row[csf('batch_weight')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['water_flow_meter']=$row[csf('water_flow_meter')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['item_description']=$row[csf('item_description')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['total_trims_weight']=$row[csf('total_trims_weight')];
				
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['file_no']=$row[csf('file_no')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['grouping']=$row[csf('grouping')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['buyer_name']=$row[csf('buyer_name')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['job_no_prefix_num']=$row[csf('job_no_prefix_num')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['width_dia_type']=$row[csf('width_dia_type')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['color_id']=$row[csf('color_id')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['booking_no']=$row[csf('booking_no')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['hour_unload_meter']=$row[csf('hour_unload_meter')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['hour_unload_meter']=$row[csf('hour_unload_meter')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['process_end_date']=$row[csf('process_end_date')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['end_hours']=$row[csf('end_hours')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['end_minutes']=$row[csf('end_minutes')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['remarks']=$row[csf('remarks')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['result']=$row[csf('result')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['re_dyeing_from']=$row[csf('re_dyeing_from')];
				$batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['style_ref_no']=$row[csf('style_ref_no')];
				$re_dyeing_from.=$row[csf('re_dyeing_from')].',';
				
				
				
				
			}
			//print_r($batch_dtls_arr2);
			 ?>
			 <div align="left">


			 <table class="rpt_table" width="2550" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_1">
              <caption> <b>Self batch</b></caption>
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg;?></th>

                       <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="60">File No</th>
                        <th width="70">Ref. No</th>
                        <th width="100">Buyer</th>
                        <th width="80">Job</th>
                        <th width="100">Style Ref</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70" class="wrap_break">Dia/Width Type</th>
                        <th width="80">Color Name</th>
                        <th width="90">Batch No</th>
						 <th width="100">Booking No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Redyeing/Re-process qty</th>
                        <th width="70">Incomplete/ Running</th>
                        
                        <th width="70">Trims Wgt.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
                        <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60" class="wrap_break">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab. Type</th>
                        <th width="110">Result</th>
                        <th width="">Remark</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2570px; overflow-y:scroll;;" id="scroll_body_self">
            <table class="rpt_table" id="table_body" width="2550" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
				$re_dyeing_from_id=rtrim($re_dyeing_from,',');
				$batch_id_arr=array_unique(explode(",",$re_dyeing_from_id));
				$re_dyeing_from_id=implode(",",array_unique(explode(",",$re_dyeing_from_id)));
				$batch_ids=count($batch_id_arr);
				if($db_type==2 && $batch_ids>1000)
				{
					$batch_cond_for_ext=" and (";
					$batIdsArr=array_chunk($batch_id_arr,999);
					foreach($batIdsArr as $ids)
					{
						$ids=implode(",",$ids);
						$batch_cond_for_ext.=" a.batch_id in($ids) or";
					}
					$batch_cond_for_ext=chop($batch_cond_for_ext,'or ');
					$batch_cond_for_ext.=")";
				}
				else
				{
					$batch_cond_for_ext=" and a.batch_id in(".implode(",",$batch_id_arr).")";
				}
	
				$dyeing_sql="SELECT a.id as mst_id,a.service_company,a.floor_id,a.service_source,a.insert_date,a.remarks,a.batch_id, a.result,a.batch_no,a.process_id,a.entry_form,a.start_hours,a.start_minutes,a.production_date as end_date,a.load_unload_id, a.batch_ext_no,a.process_start_date,a.process_end_date,a.end_minutes,a.end_hours from pro_fab_subprocess a where a.status_active=1  and a.load_unload_id=2 $batch_cond_for_ext  order by a.id asc";
				$dyeing_data = sql_select($dyeing_sql);
			
				foreach($dyeing_data as $row )
				{
					$re_dying_batch_arr[$row[csf('batch_no')]]=$row[csf('result')];
				}
				unset($dyeing_data);
				
				
                $i=1; $btq=0; $k=1;$z=1;$total_water_cons_load=0;$total_water_cons_unload=0;$grand_total_redying_batch_qty=$grand_total_incomplete_qty=0;
                $batch_chk_arr=array(); $group_by_arr=array();$tot_trims_qnty=0;$trims_check_array=array();
				
				
                foreach($batch_dtls_arr as $batch_id=>$data_batch)
				{
					 foreach($data_batch as $prod_id=>$batch)
					{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";

					//echo $batch[('re_dyeing_from')].'f';
					$bext=$batch[('extention_no')]-1;
					if(($bext*1)<=0) $bext='';
					//echo $bext.'DD';
					if($date_search_type==1)
					{
						$date_type_cond=$batch[('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}

					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[('machine_id')]];
						}
						
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="60">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="230" colspan="3"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($tot_batch_qnty,2); ?></td>
                                    <td width="70"><? echo number_format($tot_redying_batch_qty,2); ?></td>
                                    <td width="70"><? echo number_format($incomplete_batch_qty,2); ?></td>
                                    <td width="70"><? echo number_format($trims_btq,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="50">&nbsp;</td>
                                    <td width="60"><? echo $total_water_cons_load;?></td>

                                    <td width="70"><? //echo number_format($btq,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="110">&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($tot_batch_qnty);unset($tot_redying_batch_qty);unset($incomplete_batch_qty);unset($trims_btq);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="31" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}


					$order_id=$batch[('po_id')];

					$batch_weight=$batch[('batch_weight')];
					$water_cons_unload=$batch[('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[('id')]];
					$load_hour_meter=$load_hour_meter_arr[$batch[('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[('po_number')])));

					$batch_no=$batch[('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;

						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					
					
					$batch_result=$batch_dtls_arr3[$batch[('batch_no')]]['result'];
					$re_batch_result=$batch_dtls_arr33[$batch[('batch_no')]]['result'];
					$re_dying_batch_result_first=$re_dying_batch_arr[$batch[('batch_no')]];
					$batch_qty=$redying_batch_qty=0;
					if($batch_result==1)
					{
						if($batch[('extention_no')]=="" || $batch[('extention_no')]==0)
						{
							$batch_qty=$batch[('batch_qnty')];
						}
						else $redying_batch_qty=$batch[('batch_qnty')];
					}
					else if($batch_result==2)
					{
						if($batch[('extention_no')]==1)
						{
							$batch_qty=$batch[('batch_qnty')];
						}
						else $redying_batch_qty=$batch[('batch_qnty')];
					}
					else {
						if($batch[('extention_no')]>0)
						{
							//echo $re_batch_result.'ff';
							//if($re_batch_result==1 && $batch[('extention_no')]==1 && $bext!="")
							if(($re_dying_batch_result_first==2) && $batch[('extention_no')]==1)
							{
								//if($bext)
								$batch_qty=$batch[('batch_qnty')];
							}
							else
							{
								//if($re_batch_result==1 || $re_batch_result==2)
								if(($batch[('result')]==2 || $batch[('result')]==1))
								{
										$redying_batch_qty=$batch[('batch_qnty')];
								}
							}
						}
					}
					
					
					
					if($batch[('result')]==4)//InComplete
					{
						$incomplete_batch_qty=$batch[('batch_qnty')];
					} else $incomplete_batch_qty=0;
					
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($date_type_cond); $unload_date=$batch[('process_end_date')]; ?></p></td>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td align="center" width="60"><p><? echo $batch[('file_no')]; ?></p></td>
                        <td align="center" width="70"><p><? echo $batch[('grouping')]; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[('buyer_name')]]; ?></p></td>
                        <td width="80"><p class="wrap_break"><? echo $batch[('job_no_prefix_num')]; ?></p></td>
                        <td width="100"><p class="wrap_break"><? echo $batch[('style_ref_no')]; ?></p></td>
                        <td width="90"><p class="wrap_break"><? echo $po_number; ?></p></td>
                        <td width="100"><div style="width:100px; word-wrap:break-word;"><? echo $batch[('item_description')]; ?></div></td>
                        <td width="70"><p><? echo $fabric_typee[$batch[('width_dia_type')]]; ?></p></td>
                        <td width="80"><p><? echo $color_library[$batch[('color_id')]]; ?></p></td>
                        <td width="90"><p class="wrap_break"><? echo $batch[('batch_no')]; ?></p></td>
						 <td width="100"><p><? echo $batch[('booking_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[('extention_no')]; ?></p></td>
                        <td align="right" width="70" title="<? echo $batch[('re_dyeing_from')].'='.$min_batch;?>"><? echo number_format($batch_qty,2);  ?></td>
                        <td align="right" width="70"><? echo number_format($redying_batch_qty,2);  ?></td>
                        <td align="right" width="70"><? echo number_format($incomplete_batch_qty,2);  ?></td>

                       <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>

                        <td width="60" align="right"><p><? echo number_format($load_hour_meter,2);  ?></p></td>
                        <td width="60" align="right"><p><? echo number_format($batch[('hour_unload_meter')],2);  ?></p></td>
                       <td width="60" align="right" ><p><? echo number_format($batch[('hour_unload_meter')]-$load_hour_meter,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[('prod_id')]][$batch[('po_id')]];  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" title="<? echo "Water Cons Unload-Water Cons Load*1000/Batch Qnty"?>" ><? echo number_format((($water_cons_unload-$water_cons_load)*1000)/$batch[('batch_qnty')],2);//number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[('id')]].':'.$load_min[$batch[('id')]]; echo  ($load_date[$batch[('id')]] == '0000-00-00' || $load_date[$batch[('id')]] == '' ? '' : change_date_format($load_date[$batch[('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[('end_minutes')])-($load_min[$batch[('id')]]);
						echo  ($batch[('process_end_date')] == '0000-00-00' || $batch[('process_end_date')] == '' ? '' : change_date_format($batch[('process_end_date')])).'<br>'.$unload_time=$batch[('end_hours')].':'.$batch[('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                        <td align="center" width="100"><p><?
						if($batch[('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
							else $fab_type="";
						echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td align="center" width="110"><p><? echo $dyeing_result[$batch[('result')]]; ?></p> </td>
                         <td align="center"><p><? echo $batch[('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$tot_batch_qnty+=$batch_qty;
					$tot_redying_batch_qty+=$redying_batch_qty;
					$tot_incomplete_batch_qty+=$incomplete_batch_qty;
					$trims_btq+=$tot_trim_qty;
					$total_water_cons_load+=$water_cons_load;
					$total_water_cons_unload+=$water_cons_unload;
					$tot_trims_qnty+=$tot_trim_qty;
					$grand_total_batch_qty+=$batch_qty;
					$grand_total_redying_batch_qty+=$redying_batch_qty;
					$grand_total_incomplete_qty+=$incomplete_batch_qty;
					} 
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <td width="30">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                     <? if($group_by==2 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } if($group_by==1 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                    <td width="60">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="90">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="230" colspan="3"><strong>Sub. Total : </strong></td>
                    <td width="70"><? echo number_format($tot_batch_qnty,2); ?></td>
                    <td width="70"><? echo number_format($tot_redying_batch_qty,2); ?></td>
                    <td width="70"><? echo number_format($tot_incomplete_batch_qty,2); ?></td>

                    <td width="70"><? echo number_format($trims_btq,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="50">&nbsp;</td>
                    <td width="60"><? echo $total_water_cons_load;?></td>

                    <td width="70"><? //echo number_format($btq,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                     <td width="100">&nbsp;</td>
                    <td width="110">&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="230" colspan="3"><strong>Trims Total : </strong></th>
                    <th width="70"><? echo number_format($tot_trims_qnty,2); ?></th>
                    <th width="70"><? //echo number_format($tot_trims_qnty,2); ?></th>
                    <th width="70"><? //echo number_format($tot_trims_qnty,2); ?></th>
                    <th colspan="14">&nbsp; </th>

                </tr>

                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80"><? //echo $total_water_cons_load;?></th>
                    <th width="230" colspan="3"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty+$tot_trims_qnty,2); ?></th>
                    <th width="70"><? echo number_format($grand_total_redying_batch_qty,2); ?></th>
                    <th width="70"><? echo number_format($grand_total_incomplete_qty,2); ?></th>

                    <th colspan="14"> </th>

                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			if(count($sql_subcon_data)>0)
			{
		?>
		 <div align="left">

		 <table class="rpt_table" width="2130" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_2">
            <caption> <b> Subcon batch</b> </caption>
				<thead>
					<tr>
						<th width="30">SL</th>
						<th width="80"> <? echo $date_type_msg; ?></th>
						<th width="80">M/C No</th>
						<th width="80">Floor</th>
						<th width="80">Shift Name</th>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70" class="wrap_break">Dia/Width Type</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="100">Booking No</th>
						<th width="40">Extn. No</th>
						<th width="70">Dyeing Qty.</th>
                        <th width="70">Redyeing/Re-process qty</th>
                        <th width="70">Incomplete/ Running</th>
                        
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
						<th width="60">Total Time</th>
						<th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60" class="wrap_break">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


						<th width="75">Load Date & Time</th>
						<th width="75">UnLoad Date Time</th>

                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab Type</th>
						<th>Result</th>
					</tr>
				</thead>
		</table>
		<div style=" max-height:350px; width:2150px; overflow-y:scroll;;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="2130" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
		<tbody>
					<?
					$i=1;
					$btq=0;$trims_btq_sub=0;$btq_redying_sub=0;$btq_incomplete_sub=0;
					$batch_chk_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($i%2==0)
					$bgcolor_sub2="#E9F3FF";
					else
					$bgcolor_sub2="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$batch_weight_sub=$batch[csf('batch_weight')];
					$water_cons_unload_sub=$batch[csf('water_flow_meter')];
					$water_cons_load_sub=$subcon_water_flow_arr[$batch[csf('id')]];
					$load_hour_meter_sub=$subcon_load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff_sub=($water_cons_unload_sub-$water_cons_load_sub)/$batch_weight_sub*1000;
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					if($date_search_type==1)
					{
						$date_type_cond=$batch[csf('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[csf('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}
					
					if($batch[csf('result')]==1)
					{
						$sub_batch_qty=$batch[csf('sub_batch_qnty')];
					} else $sub_batch_qty=0;
					 if($batch[csf('result')]==2)//Redyeing
					{
						$sub_redying_batch_qty=$batch[csf('sub_batch_qnty')];
					} else $sub_redying_batch_qty=0;
					if($batch[csf('result')]==4)//InComplete
					{
						$sub_incomplete_batch_qty=$batch[csf('sub_batch_qnty')];
					} else $sub_incomplete_batch_qty=0;
					
					//echo $load_hr[$batch[csf('id')]].'ddddd';
					//echo $batch[csf('id')];
					?>
					<tr bgcolor="<? echo $bgcolor_sub2; ?>" id="trsub_<? echo $i; ?>" onClick="change_color('trsub_<? echo $i; ?>','<? echo $bgcolor; ?>')">
						<td width="30"><? echo $i; ?></td>
						<td width="80"><p><? echo ($date_type_cond == '0000-00-00' || $date_type_cond == '' ? '' : change_date_format($date_type_cond)); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
						<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $floor_arr[$batch[csf('floor_id')]];  ?>"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $shift_name[$batch[csf('shift_name')]];  ?>"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
						<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? echo  $batch[csf('job_no_prefix_num')]; ?>"><p class="wrap_break"><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td  width="90" title="<? echo $po_number; ?>"><p class="wrap_break"><? echo $po_number; ?></p></td>
						<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p class="wrap_break"><? echo $batch[csf('item_description')]; ?></p></td>
						<td  width="70" title="<? echo  $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p class="wrap_break"><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="100"><p><? echo $batch[csf('booking_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="70" title="<? echo $sub_batch_qty;  ?>"><? echo number_format($sub_batch_qty,2);  ?></td>
                        <td align="right" width="70" title=""><? echo number_format($sub_redying_batch_qty,2);  ?></td>
                        <td align="right" width="70" title=""><? echo number_format($sub_incomplete_batch_qty,2);  ?></td>

                         <td width="60" align="right"><p><? echo $load_hour_meter_sub;  ?></p></td>
                         <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')];  ?></p></td>
                         <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')]-$load_hour_meter_sub;  ?></p></td>
						<td align="left" width="50" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60"><p><? echo $water_cons_load_sub;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload_sub;  ?></p></td>

                        <td align="right" width="70" title="<? echo number_format($water_cons_diff_sub,2);  ?>"><? echo number_format($water_cons_diff_sub,2);  ?></td>


						<td width="75" title="<?  $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];  echo ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).'  & '.$sub_load_t; ?>"><p><?   $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]]; echo  ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).' <br> '.$sub_load_t;
						 ?></p></td>
						<td width="75" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; // $unloadd=change_date_format($batch[csf('process_end_date')]).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
						<td align="center" width="60">
					   <?
					$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
					$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$sub_load_t.':'.'00');
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
					//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
							?>
						 </td>
                         <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						 echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
						<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
					</tr>
		<?
		$i++;
		$btq_sub+=$sub_batch_qty;
		$btq_redying_sub+=$sub_redying_batch_qty;
		$btq_incomplete_sub+=$sub_incomplete_batch_qty;
		$trims_btq_sub+=$batch[csf('total_trims_weight')];
		} //batchdata froeach
		 ?>
			</tbody>
		</table>
		<table class="rpt_table" width="2130" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
				<thead>

                    <tr class="tbl_bottom">
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="40">Total Trims</th>
						<th width="70"><? echo number_format($trims_btq_sub,2); ?></th>
                        <th width="70"><? //echo number_format($trims_btq_sub,2); ?></th>
                        <th width="70"><? //echo number_format($trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>

						<th>&nbsp;</th>
					</tr>
                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="40">Grand Total</th>
						<th width="70"><? echo number_format($btq_sub+$trims_btq_sub,2); ?></th>
                        <th width="70"><? echo number_format($btq_redying_sub,2); ?></th>
                        <th width="70"><? echo number_format($btq_incomplete_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
		</table>
		</div>
		</div>
		<?
		}
		} // Sub Cond End

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
		{
			//print_r($batchdata_sam);
			//echo count($batchdata_sam)."DDDDDDDDDDD";
			if (count($batchdata_sam)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left">
			 <div> <b>Sample Dyeing Production </b></div>
			 <table class="rpt_table" width="2550" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_3">
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg; ?></th>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <th width="80">M/C No</th>
                        <? }
						?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="70">File No</th>
                        <th width="80">Ref. No</th>
                        <th width="100">Buyer</th>

                        <th width="80">Job</th>
                        <th width="100">Style Ref</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70" class="wrap_break">Dia/ Width Type</th>
                        <th width="80">Color Name</th>

                        <th width="90">Batch No</th>
						<th width="110">Booking No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Redyeing/Re-process qty</th>
                        <th width="70">Incomplete/ Running</th>
                        <th width="70">Trims Qty.</th>

                        <th width="60">Hour Load Meter</th>
 						<th width="60">Hour unLoad Meter</th>
                         <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60" class="wrap_break">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fabrics<br>Type</th>
                        <th width="100">Result</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2570; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body3" width="2550" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$grand_total_batch_qty_sam=0;$batch_qnty_sam=0;$total_trim_qty=$grand_total_incomplete_qty_sam=$grand_total_redying_qty_sam=0;
                $batch_chk_arr=array(); $group_by_arr=array();$trims_check_array=array();
			foreach($batchdata_sam as $row)
			{
				
				if($row[csf('result')]==1)
				$batch_dtls_arr2[$row[csf('batch_no')]][$row[csf('result')]]['re_dyeing_from'].=$row[csf('re_dyeing_from')].',';
				if($row[csf('extention_no')]=="" || $row[csf('extention_no')]==0)
				{
				$batch_dtls_arr3[$row[csf('batch_no')]]['result']=$row[csf('result')];
				}
				if($row[csf('extention_no')]>0)
				{
				$batch_dtls_arr33[$row[csf('batch_no')]]['result']=$row[csf('result')];
				}
				
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['batch_qnty']=$row[csf('batch_qnty')];
				
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['id']=$row[csf('id')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['batch_no']=$row[csf('batch_no')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['extention_no']=$row[csf('extention_no')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['insert_date']=$row[csf('insert_date')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['production_date']=$row[csf('production_date')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['floor_id']=$row[csf('floor_id')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['po_number']=$row[csf('po_number')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['po_id']=$row[csf('po_id')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['machine_id']=$row[csf('machine_id')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['shift_name']=$row[csf('shift_name')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['batch_weight']=$row[csf('batch_weight')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['water_flow_meter']=$row[csf('water_flow_meter')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['item_description']=$row[csf('item_description')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['total_trims_weight']=$row[csf('total_trims_weight')];
				
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['file_no']=$row[csf('file_no')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['grouping']=$row[csf('grouping')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['buyer_name']=$row[csf('buyer_name')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['job_no_prefix_num']=$row[csf('job_no_prefix_num')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['width_dia_type']=$row[csf('width_dia_type')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['color_id']=$row[csf('color_id')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['booking_no']=$row[csf('booking_no')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['hour_unload_meter']=$row[csf('hour_unload_meter')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['hour_unload_meter']=$row[csf('hour_unload_meter')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['process_end_date']=$row[csf('process_end_date')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['end_hours']=$row[csf('end_hours')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['end_minutes']=$row[csf('end_minutes')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['remarks']=$row[csf('remarks')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['result']=$row[csf('result')];
				$samp_batch_dtls_arr[$row[csf('id')]][$row[csf('prod_id')]]['re_dyeing_from']=$row[csf('re_dyeing_from')];
				
			}
			// print_r($samp_batch_dtls_arr);
                foreach($samp_batch_dtls_arr as $batch_id=>$data_batch)
				{
					foreach($data_batch as $prod_id=>$batch)
					{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";

					if($date_search_type==1)
					{
						$date_type_cond=$batch[('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                     <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td width="80">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="90">&nbsp;</td>

                                    <td width="100">&nbsp;</td>
                    				<td width="70">&nbsp;</td>
									<td width="80">&nbsp;</td>

                                    <td width="240" colspan="3"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                                    <td width="70"><? echo number_format($batch_redying_qnty_sam,2); ?></td>
                                    <td width="70"><? echo number_format($batch_incompelete_qnty_sam,2); ?></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam_trims,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60"><? //echo number_format($btq,2); ?></td>
                                    <td width="50">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="70"><? //echo number_format($btq,2); ?></td>
                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($batch_qnty_sam);unset($batch_incompelete_qnty_sam);unset($batch_incompelete_qnty_sam);unset($batch_qnty_sam_trims);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="33" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}
					$bext=$batch[('extention_no')]-1;
					if(($bext*1)<=0) $bext='';
					$order_id=$batch[('po_id')];
					$batch_weight=$batch[('batch_weight')];
					$water_cons_unload=$batch[('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[('id')]];
					$hour_meter_load=$load_hour_meter_arr[$batch[('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[('po_number')])));
					$batch_no=$batch[('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					/*if($batch[('result')]==1)
					{
						$samp_batch_qty=$batch[('batch_qnty')];
					}  else $samp_batch_qty=0;
					if($batch[('result')]==2)//Redyeing
					{
						$samp_redying_batch_qty=$batch[('batch_qnty')];
					} else $samp_redying_batch_qty=0;*/
					//echo $batch_result.'DDD';
					$batch_result=$batch_dtls_arr3[$batch[('batch_no')]]['result'];
					$samp_re_batch_result=$batch_dtls_arr33[$batch[('batch_no')]]['result'];
					
					$samp_batch_qty=$samp_redying_batch_qty=0;
					if($batch_result==1)
					{
						if($batch[('extention_no')]=="" || $batch[('extention_no')]==0)
						{
							$samp_batch_qty=$batch[('batch_qnty')];
							//echo $batch_qty.'xSS';
						}
						else $samp_redying_batch_qty=$batch[('batch_qnty')];
					}
					else if($batch_result==2)
					{
						if($batch[('extention_no')]==1)
						{
							$samp_batch_qty=$batch[('batch_qnty')];
						}
						else $samp_redying_batch_qty=$batch[('batch_qnty')];
					}
					else
					{
						if($batch[('extention_no')]>0)
							{
								//echo $re_batch_result.'ff';
								if($samp_re_batch_result==1 && $batch[('extention_no')]==1 && $bext!="")
								{
									$samp_batch_qty=$batch[('batch_qnty')];
								}
								else
								{
									if($samp_re_batch_result==1 || $samp_re_batch_result==2)
									{
											$samp_redying_batch_qty=$batch[('batch_qnty')];
									}
								}
							}
					}
					
					
					if($batch[('result')]==4)//InComplete
					{
						$samp_incomplete_batch_qty=$batch[('batch_qnty')];
					} else $samp_incomplete_batch_qty=0;
					
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($date_type_cond); $unload_date=$batch[('process_end_date')]; ?></p></td>
                          <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[('machine_id')]]; ?></p></td>
                        <? } if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td width="70"><p><? echo $batch[('file_no')]; ?></p></td>
                        <td width="80"><p><? echo $batch[('grouping')]; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[('buyer_name')]]; ?></p></td>

                        <td width="80"><p class="wrap_break"><? echo $batch[('job_no_prefix_num')]; ?></p></td>
                        <td width="100"><p class="wrap_break"><? echo $nonOrdBookingStyleRefArr[$batch[('booking_no')]]["style_ref_no"]; ?></p></td>
                        <td width="90"><p class="wrap_break"><? echo $po_number; ?></p></td>
                        <td width="100"><p class="wrap_break"><? echo $batch[('item_description')]; ?></p></td>
                        <td width="70"><p class="wrap_break"><? echo $fabric_typee[$batch[('width_dia_type')]]; ?></p></td>
                        <td width="80"><p><? echo $color_library[$batch[('color_id')]]; ?></p></td>
                        <td width="90"><p class="wrap_break"><? echo $batch[('batch_no')]; ?></p></td>
						<td width="110"><p><? echo $batch[('booking_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($samp_batch_qty,2);  ?></td>
                        <td align="right" width="70"><? echo number_format($samp_redying_batch_qty,2);  ?></td>
                        <td align="right" width="70"><? echo number_format($samp_incomplete_batch_qty,2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>
                        <td width="60"><p><? echo number_format($hour_meter_load,2);  ?></p></td>
                        <td width="60"><p><? echo number_format($batch[('hour_unload_meter')],2);  ?></p></td>

                        <td width="60"><p><? echo number_format($batch[('hour_unload_meter')]-$hour_meter_load,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[('prod_id')]][$batch[('po_id')]];  ?></p></td>
                         <td width="60"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" ><? echo number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[('id')]].':'.$load_min[$batch[('id')]]; echo  ($load_date[$batch[('id')]] == '0000-00-00' || $load_date[$batch[('id')]] == '' ? '' : change_date_format($load_date[$batch[('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[('end_minutes')])-($load_min[$batch[('id')]]);
						echo  ($batch[('process_end_date')] == '0000-00-00' || $batch[('process_end_date')] == '' ? '' : change_date_format($batch[('process_end_date')])).'<br>'.$unload_time=$batch[('end_hours')].':'.$batch[('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                          <td align="center" width="100"><p><?
						 if($batch[('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
							else $fab_type="";
						  echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td width="100" align="center"><p><? echo $dyeing_result[$batch[('result')]]; ?></p> </td>
                         <td align="center" title="<?  echo $batch[('remarks')];   ?>"><p><? echo $batch[('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty_sam+=$samp_batch_qty;
					$batch_redying_qnty_sam+=$samp_redying_batch_qty;
					$batch_incompelete_qnty_sam+=$samp_incomplete_batch_qty;
					$batch_qnty_sam_trims+=$tot_trim_qty;
					$total_trim_qty+=$tot_trim_qty;
					$grand_total_batch_qty_sam+=$samp_batch_qty;
					$grand_total_redying_qty_sam+=$samp_redying_batch_qty;
					$grand_total_incomplete_qty_sam+=$samp_incomplete_batch_qty;
					} //batchdata froeach
				}
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                     <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="240" colspan="3"><strong>Sub. Total : </strong></th>
                    <th width="70"><? echo number_format($batch_qnty_sam,2); ?></th>
                    <th width="70"><? echo number_format($batch_redying_qnty_sam,2); ?></th>
                    <th width="70"><? echo number_format($batch_incompelete_qnty_sam,2); ?></th>
                  	<th width="70"><? echo number_format($batch_qnty_sam_trims,2); ?></th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                     <th width="60"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                     <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="240" colspan="3"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty_sam,2); ?></th>
                    <th width="70"><? echo number_format($grand_total_redying_qty_sam,2); ?></th>
                    <th width="70"><? echo number_format($grand_total_incomplete_qty_sam,2); ?></th>
                    <th width="60"><? echo number_format($total_trim_qty,2);?></th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                   <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
			?>


            <?
		}
		?>
		</fieldset>
		</div>
		<? 
		//disconnect($con);
		//exit();
		} //Dyeing Production End

	else if($cbo_type==3) // Daily Right First Time
	{
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 )
		{
	?>
	<div>
	<fieldset style="width:1505px;">
	<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Right First Time </strong><br>
	<?
		echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
	?>
	 </div>
     <div>
     <table cellpadding="0"  width="400" cellspacing="0" align="center" >
             <tr>
                 <td width="400">
                     <table cellpadding="0"  width="400" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
                            <thead>
                        	<tr>
                            	<th colspan="4"> <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
                           	    <p>&nbsp;</p>
								<p>RFT Summary </p>
								</th>
                            </tr>
                             <tr><th colspan="3">RFT </th> <th>OK %</th></tr>
                            </thead>
                            <?
							if($db_type==2) $group_concat="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number";
							if($db_type==0) $group_concat="group_concat(c.po_number) as po_number";
							$sql_btb_data=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond	$cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and a.batch_against in(1) and f.result in(1) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ");
					 	$matched_btb=count($sql_btb_data);

						$sql_ltb_data=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2   $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id  and a.id=b.mst_id and a.batch_against in(1) and f.ltb_btb_id=2 and f.result in(1) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no");
					$matched_ltb=count($sql_ltb_data);

	$sql_btb_data_not=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond	and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(1) and f.result!=1 and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ");
	 			$matched_btb_not=count($sql_btb_data_not);
				$sql_ltb_data_not=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(1) and f.ltb_btb_id=2 and f.result!=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no");
				 $matched_ltb_not=count($sql_ltb_data_not);



				 $tot_ltb=$matched_ltb+$matched_ltb_not;
				  $ltb_percent=$matched_ltb/$tot_ltb*100;
				   $tot_btb=$matched_btb+$matched_btb_not;
				    $btb_percent=$matched_btb/$tot_btb*100;
					 $tot_rp=$matched_btb+$matched_btb_not+$matched_ltb+$matched_ltb_not;
					 $tot_ok=$matched_btb+$matched_ltb;
				  $tot_rp_percent=$tot_ok/$tot_rp*100;
	?>
                            <tr bgcolor="#E9F3FF">
                            	<td rowspan="2">LTB </td>
                                <td width="100">L OK </td>
                                <td align="right"> <? echo number_format($matched_ltb); ?></td>
                                <td rowspan="2" align="right"><? echo number_format($ltb_percent,2).'%'; ?> </td>
                            </tr>
                            <tr>
                                <td width="100">L Not OK </td>
                                <td width="60" align="right"><? echo number_format($matched_ltb_not); ?></td>
                            </tr>
                             <tr bgcolor="#FFFFFF">
                            	<td rowspan="2">BTB </td>
                                <td width="100">B OK </td>
                                <td align="right"> <? echo $matched_btb; ?></td>
                                <td rowspan="2" align="right"><? echo number_format($btb_percent,2).'%'  ?></td>
                            </tr>
                            <tr>
                                <td width="100">B Not OK </td>
                                <td width="60" align="right"><? echo number_format($matched_btb_not); ?></td>
                            </tr>
                             <tfoot>
                             <tr>
                            	<th> </th>
                                <th colspan="2">R/P</th>
                                <th align="right"> <? echo number_format($tot_rp_percent,2).'%'; ?></th>
                             </tr>
                            </tfoot>
                            </table>
                     </td>
                     </tr>
                    </table>
     </div>
     <br>
     <div>
     <div align="left"> <b>Self batch </b><br>
     <Strong>Bulk To Bulk</Strong>
     </div>
	 <table class="rpt_table" width="1498" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_1">

			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>
					<th width="80">M/C No</th>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="80">Dia/Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="70">Dyeing Qty.</th>
					<th width="50">LTB/BTB</th>
					<th width="100">Unload Date & Time</th>
					<th width="60">Time Used</th>
					<th width="100">RFT</th>
					<th width="100">Remark</th>
					<th width="100">Machine Utilization</th>
					<th>Lot No</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:350px; width:1510px; overflow-y:scroll;" id="scroll_body_self">
	<table class="rpt_table" id="table_body" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
	<tbody>
					<?
					$i=1;
					$f=0;
					$btq=0;
					$batch_chk_arr=array();
			if (count($batchdata)>0)
			 {
					foreach($batchdata as $batch)
					{
					if ($i%2==0)
					$bgcolor="#E9F3FF";
					else
					$bgcolor="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					if($batch[csf('result')]==1)
					{
					$shade="Shade Matched";
					}
					else
					{
					$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor; ?>')">
					<td width="30"><? echo $i; ?></td>
					<td width="80" title="<? echo change_date_format($batch[csf('production_date')]); ?>"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch[csf('batch_qnty')]; ?>"><p><? echo $batch[csf('batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb[$batch[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb[$batch[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?  echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' <br> '.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>
					  <td align="center" width="60"><? $hr=$batch[csf('end_hours')]-$load_hr[$batch[csf('id')]]; $min=$batch[csf('end_minutes')]-$load_min[$batch[csf('id')]]; //echo  $hr.':'.$min;
					$load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]];
					$unload_t=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
					$new_date_time_unload=($unload_date.' '.$unload_t.':'.'00');
					$new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
				   //$unload_time=strtotime($unload_date,$unload_time);
					//$load_time=strtotime($load_date,$load_t);
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
				//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade;  ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch[csf('remarks')]; ?></p></td>

					<td align="center" width="100" title="<?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?>"><?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?></p> </td>
				</tr>
	<?
	$i++;
	$btq+=$batch[csf('batch_qnty')];
	} //batchdata froeach
	 ?>
			  <tr bgcolor="#CCCCCC">
				<td colspan="10" align="right"><Strong>BTB Total:</Strong> <? //echo $b_qty; ?> </td>
				<td align="right"><? echo number_format($btq,2); ?>&nbsp;</td>
				<td colspan="7">&nbsp;</td>
			 </tr>
			 <tr bgcolor="#C2DCFF">
				<td colspan="10"><strong>Lab To Bulk</strong></td><td colspan="8"> </td>
			 </tr>
		 <?
			 }
			 ?>

             <?
		 if (count($batchdata_ltb)>0)
		 {
				$d=1;
				foreach($batchdata_ltb as $batch_ltb)
				{
					if ($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					$order_id=$batch_ltb[csf('po_id')];
					$color_id=$batch_ltb[csf('color_id')];
					if($batch_ltb[csf('result')]==1)
					{
						$shade="Shade Matched";
					}
					else
					{
						$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch_ltb[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch_ltb[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>" id="trbluk_<? echo $d; ?>"  onclick="change_color('trbluk_<? echo $d; ?>','<? echo $bgcolor; ?>')">
					<td width="30"><? echo $d; ?></td>
					<td width="80" title="<? echo change_date_format($batch_ltb[csf('production_date')]); ?>"><p><? echo change_date_format($batch_ltb[csf('production_date')]);$unload_date1=$batch_ltb[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch_ltb[csf('color_id')]]; ?>"><p><? echo $color_library[$batch_ltb[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch_ltb[csf('batch_no')]; ?>"><p><? echo $batch_ltb[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch_ltb[csf('batch_qnty')]; ?>"><p><? echo $batch_ltb[csf('batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb[$batch_ltb[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb[$batch_ltb[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?   echo ($batch_ltb[csf('process_end_date')] == '0000-00-00' || $batch_ltb[csf('process_end_date')]== '' ? '' : change_date_format($batch_ltb[csf('process_end_date')])).'<br>'.$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')]; ?></p></td>
					   <td align="center" width="60" title="<? echo  $hr.':'.$min;  ?>"><? $hr=$batch_ltb[csf('end_hours')]-$load_hr[$batch_ltb[csf('id')]]; $min=$batch_ltb[csf('end_minutes')]-$load_min[$batch_ltb[csf('id')]]; //echo  $hr.':'.$min;
					$load_time=$load_hr[$batch_ltb[csf('id')]].':'.$load_min[$batch_ltb[csf('id')]];
					$unload_time=$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')];
					$new_date_time_unload1=($unload_date1.' '.$unload_time.':'.'00');
					$new_date_time_load1=($load_date[$batch_ltb[csf('id')]].' '.$load_time.':'.'00');
					$total_time1=datediff(n,$new_date_time_load1,$new_date_time_unload1);
					echo floor($total_time1/60).":".$total_time1%60;
			//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch_ltb[csf('remarks')];  ?></p></td>
					<td align="center" width="100" title="<? //echo $hr.':'.$min;   ?>"><?  $utiliz=$batch_ltb[csf('batch_qnty')]/$m_capacity[$batch_ltb[csf('machine_id')]]*100;
					echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]]; ?></p> </td>
				</tr>
						<?
				$d++;
				$total_ltb+=$batch_ltb[csf('batch_qnty')];
				}
				?>
                </table>
				<table class="rpt_table" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
			<tfoot>
				<tr>
					<th width="30">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="70"><? echo number_format($total_ltb,2); ?></th>
					<th width="50">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
	</table>
				<?
			 }
		 ?>
	</tbody>
	</table>
	</div>
    </div>
    <br>
    <?
		} //Self batch  End


		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2 )  // Suncond start
		{
	?>
     <div align="left"> <b>SubCon batch </b><br><Strong>Bulk To Bulk</Strong></div>
	 <table class="rpt_table" width="1498" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="">

			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>
					<th width="80">M/C No</th>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="80">Dia/Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="70">Dyeing Qty.</th>
					<th width="50">LTB/BTB</th>
					<th width="100">Unload Date & Time</th>
					<th width="60">Time Used</th>
					<th width="100">RFT</th>
					<th width="100">Remark</th>
					<th width="100">Machine Utilization</th>
					<th>Lot No</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:350px; width:1510px; overflow-y:scroll;" id="scroll_body">
	<table class="rpt_table" id="table_body2" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
	<tbody>
					<?
					$p=1;
					$f=0;
					$sub_btq=0;
					$batch_chk_arr=array();
					$ltb_btb_sub=array(1=>'BTB',2=>'LTB');
					foreach($sql_subcon_data_btb as $batch)
					{
					if ($p%2==0)
					$sub_bgcolor_btb="#E9F3FF";
					else
					$sub_bgcolor_btb="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					if($batch[csf('result')]==1)
					{
					$shade="Shade Matched";
					}
					else
					{
					$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $sub_bgcolor_btb; ?>" id="trsub_<? echo $p; ?>" onClick="change_color('trsub_<? echo $p; ?>','<? echo $sub_bgcolor_btb; ?>')">
					<td width="30"><? echo $p; ?></td>
					<td width="80" title="<? echo change_date_format($batch[csf('production_date')]); ?>"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch[csf('sub_batch_qnty')]; ?>"><p><? echo $batch[csf('sub_batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb_sub[$batch[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb_sub[$batch[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?  echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' <br> '.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>
					  <td align="center" width="60"><? $hr=$batch[csf('end_hours')]-$load_hr[$batch[csf('id')]]; $min=$batch[csf('end_minutes')]-$load_min[$batch[csf('id')]]; //echo  $hr.':'.$min;
					$load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];
					$unload_t=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
					$new_date_time_unload=($unload_date.' '.$unload_t.':'.'00');
					$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
				   //$unload_time=strtotime($unload_date,$unload_time);
					//$load_time=strtotime($load_date,$load_t);
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
				//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade;  ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch[csf('remarks')]; ?></p></td>

					<td align="center" width="100" title="<?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?>"><?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?></p> </td>
				</tr>
	<?
	$p++;
	$sub_btq+=$batch[csf('sub_batch_qnty')];
	} //batchdata froeach
	 ?>
			  <tr bgcolor="#CCCCCC">
				<td colspan="10" align="right"><Strong>BTB Total:</Strong> <? //echo $b_qty; ?> </td>
				<td align="right"><? echo number_format($sub_btq,2); ?>&nbsp;</td>
				<td colspan="7">&nbsp;</td>
			 </tr>
			 <tr bgcolor="#C2DCFF">
				<td colspan="10"><strong>Lab To Bulk</strong></td><td colspan="8" ></td>
			 </tr>
		 <?
		 if (count($sql_subcon_data_ltb)>0)
		 {
				$h=1;
				$sub_total_ltb=0;

				foreach($sql_subcon_data_ltb as $batch_ltb)
				{
					if ($h%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					$order_id=$batch_ltb[csf('po_id')];
					$color_id=$batch_ltb[csf('color_id')];
					if($batch_ltb[csf('result')]==1)
					{
						$shade="Shade Matched";
					}
					else
					{
						$shade="Not Shade Matched";
					}
					$desc=explode(",",$batch_ltb[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch_ltb[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $h; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $h; ?>">
					<td width="30"><? echo $h; ?></td>
					<td width="80" title="<? echo change_date_format($batch_ltb[csf('process_end_date')]); ?>"><p><? echo change_date_format($batch_ltb[csf('process_end_date')]);$unload_date1=$batch_ltb[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')]; ?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch_ltb[csf('color_id')]]; ?>"><p><? echo $color_library[$batch_ltb[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch_ltb[csf('batch_no')]; ?>"><p><? echo $batch_ltb[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch_ltb[csf('sub_batch_qnty')]; ?>"><p><? echo $batch_ltb[csf('sub_batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb_sub[$batch_ltb[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb_sub[$batch_ltb[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?   echo  change_date_format($batch_ltb[csf('process_end_date')]) .' <br>'.$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')]; ?></p></td>
					   <td align="center" width="60" title="<? echo  $hr.':'.$min;  ?>"><? $hr=$batch_ltb[csf('end_hours')]-$load_hr[$batch_ltb[csf('id')]]; $min=$batch_ltb[csf('end_minutes')]-$load_min[$batch_ltb[csf('id')]]; //echo  $hr.':'.$min;
					$load_time=$subcon_load_hr[$batch_ltb[csf('id')]].':'.$subcon_load_min[$batch_ltb[csf('id')]];
					$unload_time=$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')];
					$new_date_time_unload1=($unload_date1.' '.$unload_time.':'.'00');
					$new_date_time_load1=($subcon_load_date[$batch_ltb[csf('id')]].' '.$load_time.':'.'00');
					$total_time1=datediff(n,$new_date_time_load1,$new_date_time_unload1);
					echo floor($total_time1/60).":".$total_time1%60;
			//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch_ltb[csf('remarks')];  ?></p></td>
					<td align="center" width="100" title="<? //echo $hr.':'.$min;   ?>"><?  $utiliz=$batch_ltb[csf('batch_qnty')]/$m_capacity[$batch_ltb[csf('machine_id')]]*100;
					echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]]; ?></p> </td>
				</tr>
						<?
				$h++;
				$sub_total_ltb+=$batch_ltb[csf('sub_batch_qnty')];
				}
				?>
				<table class="rpt_table" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
			<tfoot>
				<tr>
					<th width="30">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="70"><? echo number_format($sub_total_ltb,2); ?></th>
					<th width="50">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
	</table>
				<?
			 }
		 ?>
	</tbody>
	</table>
	</div>

	</fieldset>
	</div>
	<?
		} // Sub Cond End

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)  // Sample RFT
	{

			if (count($batchdata_btb_sam)>0)
			 {

			?>

	<div>
	<fieldset style="width:1505px;">
	<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Right First Time(Sample Production) </strong><br>
	<?
		echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
	?>
	 </div>
     <div>
     <table cellpadding="0"  width="400" cellspacing="0" align="center" >
             <tr>
                 <td width="400">
                     <table cellpadding="0"  width="400" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
                            <thead>
                        	<tr>
                            	<th colspan="4">Self Batch RFT Summary(Sample)</th>
                            </tr>
                             <tr><th colspan="3">RFT </th> <th>OK %</th></tr>
                            </thead>
                            <?
							if($db_type==2) $group_concat="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY c.po_number) AS po_number";
							if($db_type==0) $group_concat="group_concat(c.po_number) as po_number";
							$sql_btb_data=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id $companyCond $workingCompany_name_cond2   $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond	and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(3) and f.result in(1) and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ");
					 	$matched_btb=count($sql_btb_data);
						$sql_ltb_data=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond  $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and f.batch_id=b.mst_id and a.batch_against in(3) and f.ltb_btb_id=2 and f.result in(1) and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no");
					$matched_ltb=count($sql_ltb_data);

	$sql_btb_data_not=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g	where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name	and $cbo_prod_type_cond $cbo_prod_source_cond  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id  and a.id=b.mst_id and a.batch_against in(3) and f.result!=1 and f.ltb_btb_id=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no ");
	 			$matched_btb_not=count($sql_btb_data_not);
				$sql_ltb_data_not=sql_select("select a.company_id,a.id,a.batch_no,a.batch_date,a.batch_weight,a.color_id,a.booking_no_id,a.extention_no,a.batch_against,SUM(b.batch_qnty) AS batch_qnty,b.item_description,b.po_id,b.prod_id,b.width_dia_type,$group_concat,c.job_no_mst,d.job_no_prefix_num,d.buyer_name,f.production_date as process_end_date,f.end_hours,f.end_minutes,f.machine_id,f.load_unload_id,f.ltb_btb_id,f.result,f.remarks
	from pro_batch_create_dtls b,wo_po_break_down c,wo_po_details_master d,pro_batch_create_mst a,pro_fab_subprocess f,lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $cbo_prod_type_cond $cbo_prod_source_cond and  g.id=a.color_id and a.entry_form=0 and f.batch_id=a.id and f.batch_id=b.mst_id and a.id=b.mst_id and a.batch_against in(3) and f.ltb_btb_id=2 and f.result!=1 and f.entry_form=35 and f.load_unload_id in(2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 GROUP BY b.id,b.po_id, b.item_description,a.company_id, a.id, a.batch_no, a.batch_date, a.batch_weight, a.color_id, a.booking_no_id, a.extention_no, a.batch_against,b.prod_id, b.width_dia_type,c.job_no_mst, d.job_no_prefix_num, d.buyer_name, f.production_date, f.end_hours, f.end_minutes, f.machine_id, f.load_unload_id, f.ltb_btb_id, f.result, f.remarks order by a.batch_no");
				 $matched_ltb_not=count($sql_ltb_data_not);

				 $tot_ltb=$matched_ltb+$matched_ltb_not;
				  $ltb_percent=$matched_ltb/$tot_ltb*100;
				   $tot_btb=$matched_btb+$matched_btb_not;
				    $btb_percent=$matched_btb/$tot_btb*100;
					 $tot_rp=$matched_btb+$matched_btb_not+$matched_ltb+$matched_ltb_not;
					 $tot_ok=$matched_btb+$matched_ltb;
				 	 $tot_rp_percent=$tot_ok/$tot_rp*100;
	?>
                            <tr bgcolor="#E9F3FF">
                            	<td rowspan="2">LTB </td>
                                <td width="100">L OK </td>
                                <td align="right"> <? echo number_format($matched_ltb); ?></td>
                                <td rowspan="2" align="right"><? echo number_format($ltb_percent,2).'%'; ?> </td>
                            </tr>
                            <tr>
                                <td width="100">L Not OK </td>
                                <td width="60" align="right"><? echo number_format($matched_ltb_not); ?></td>
                            </tr>
                             <tr bgcolor="#FFFFFF">
                            	<td rowspan="2">BTB </td>
                                <td width="100">B OK </td>
                                <td align="right"> <? echo $matched_btb; ?></td>
                                <td rowspan="2" align="right"><? echo number_format($btb_percent,2).'%'  ?></td>
                            </tr>
                            <tr>
                                <td width="100">B Not OK </td>
                                <td width="60" align="right"><? echo number_format($matched_btb_not); ?></td>
                            </tr>
                             <tfoot>
                             <tr>
                            	<th> </th>
                                <th colspan="2">R/P</th>
                                <th align="right"> <? echo number_format($tot_rp_percent,2).'%'; ?></th>
                             </tr>
                            </tfoot>
                            </table>
                     </td>
                     </tr>
                    </table>
     </div>
     <br>
     <div>
     <div align="left"> <b>Sample Dyeing Production </b><br>
     <Strong>Bulk To Bulk</Strong>
     </div>
	 <table class="rpt_table" width="1498" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_1">

			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>
					<th width="80">M/C No</th>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="80">Dia/Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="70">Dyeing Qty.</th>
					<th width="50">LTB/BTB</th>
					<th width="100">Unload Date & Time</th>
					<th width="60">Time Used</th>
					<th width="100">RFT</th>
					<th width="100">Remark</th>
					<th width="100">Machine Utilization</th>
					<th>Lot No</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:350px; width:1510px; overflow-y:scroll;" id="scroll_body">
	<table class="rpt_table" id="table_body" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
	<tbody>
					<?
					$i=1;
					$f=0;
					$btq_sam=0;
					$batch_chk_arr=array();
				foreach($batchdata_btb_sam as $batch)
					{
					if ($i%2==0)
					$bgcolor="#E9F3FF";
					else
					$bgcolor="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					if($batch[csf('result')]==1)
					{
					$shade="Shade Matched";
					}
					else
					{
					$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor; ?>')">
					<td width="30">&nbsp;</td>
					<td width="80" title="<? echo change_date_format($batch[csf('production_date')]); ?>"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $batch[csf('item_description')];?>"><p><? echo $desc[0]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70" title="<? echo $batch[csf('batch_qnty')]; ?>"><p><? echo $batch[csf('batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb[$batch[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb[$batch[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?  echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' <br> '.$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?></p></td>
					  <td align="center" width="60"><? $hr=$batch[csf('end_hours')]-$load_hr[$batch[csf('id')]]; $min=$batch[csf('end_minutes')]-$load_min[$batch[csf('id')]]; //echo  $hr.':'.$min;
					$load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]];
					$unload_t=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
					$new_date_time_unload=($unload_date.' '.$unload_t.':'.'00');
					$new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
				   //$unload_time=strtotime($unload_date,$unload_time);
					//$load_time=strtotime($load_date,$load_t);
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
				//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade;  ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch[csf('remarks')]; ?></p></td>

					<td align="center" width="100" title="<?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?>"><?  $utiliz=$batch[csf('batch_qnty')]/$m_capacity[$batch[csf('machine_id')]]*100; echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?></p> </td>
				</tr>
	<?
	$i++;
	$btq_sam+=$batch[csf('batch_qnty')];
	} //batchdata froeach
	 ?>
			  <tr bgcolor="#CCCCCC">
				<td colspan="10" align="right"><Strong>BTB Total:</Strong> <? //echo $b_qty; ?> </td>
				<td align="right"><? echo number_format($btq_sam,2); ?>&nbsp;</td>
				<td colspan="7">&nbsp;</td>
			 </tr>
			 <tr bgcolor="#C2DCFF">
				<td colspan="10"><strong>Lab To Bulk </strong></td><td colspan="8"> </td>
			 </tr>
		 <?
			 }
			 ?>
     <div align="left"> <b>Sample Dyeing Production </b><br>
     <Strong>Lab To Bulk</Strong>
     </div>
	 <table class="rpt_table" width="1498" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="">

			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>
					<th width="80">M/C No</th>
					<th width="100">Buyer</th>
					<th width="80">Job</th>
					<th width="90">PO No</th>
					<th width="100">Fabrics Desc</th>
					<th width="80">Dia/Width Type</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="70">Dyeing Qty.</th>
					<th width="50">LTB/BTB</th>
					<th width="100">Unload Date & Time</th>
					<th width="60">Time Used</th>
					<th width="100">RFT</th>
					<th width="100">Remark</th>
					<th width="100">Machine Utilization</th>
					<th>Lot No</th>
				</tr>
			</thead>
	</table>
             <div style=" max-height:350px; width:1510px; overflow-y:scroll;" id="scroll_body">
             <table class="rpt_table" id="" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
             <?
		 if (count($batchdata_ltb_sam)>0)
		 {
				$d=1;$total_ltb_sam=0;
				foreach($batchdata_ltb_sam as $batch_ltb)
				{
					if ($d%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
					$order_id=$batch_ltb[csf('po_id')];
					$color_id=$batch_ltb[csf('color_id')];
					if($batch_ltb[csf('result')]==1)
					{
						$shade="Shade Matched";
					}
					else
					{
						$shade="Shade Not Matched";
					}
					$desc=explode(",",$batch_ltb[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch_ltb[csf('po_number')])));
					?>
				<tr bgcolor="<? echo $bgcolor; ?>" id="trbluk_<? echo $d; ?>"  onclick="change_color('trbluk_<? echo $d; ?>','<? echo $bgcolor; ?>')">
					<td width="30"><? echo $d; ?></td>
					<td width="80" title="<? echo change_date_format($batch_ltb[csf('production_date')]); ?>"><p><? echo change_date_format($batch_ltb[csf('production_date')]);$unload_date1=$batch_ltb[csf('process_end_date')]; ?></p></td>
					<td  align="center" width="80" title="<? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch_ltb[csf('machine_id')]]; ?></p></td>
					<td  width="100" title="<? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch_ltb[csf('buyer_name')]]; ?></p></td>
					<td  width="80" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
					<td width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="100" title="<? echo $desc[0]; ?>"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch_ltb[csf('color_id')]]; ?>"><p><? echo $color_library[$batch_ltb[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch_ltb[csf('batch_no')]; ?>"><p><? echo $batch_ltb[csf('batch_no')]; ?></p></td>
					<td  align="right" width="70"><p><? echo $batch_ltb[csf('batch_qnty')]; ?></p></td>
					<td align="center" width="50" title="<? echo $ltb_btb[$batch_ltb[csf('ltb_btb_id')]]; ?>"><? echo $ltb_btb[$batch_ltb[csf('ltb_btb_id')]]; ?></td>
					<td width="100" align="center" title="<? //echo $load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; ?>"><p><?   echo ($batch_ltb[csf('process_end_date')] == '0000-00-00' || $batch_ltb[csf('process_end_date')]== '' ? '' : change_date_format($batch_ltb[csf('process_end_date')])).'<br>'.$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')]; ?></p></td>
					   <td align="center" width="60" title="<? echo  $hr.':'.$min;  ?>"><? $hr=$batch_ltb[csf('end_hours')]-$load_hr[$batch_ltb[csf('id')]]; $min=$batch_ltb[csf('end_minutes')]-$load_min[$batch_ltb[csf('id')]]; //echo  $hr.':'.$min;
					$load_time=$load_hr[$batch_ltb[csf('id')]].':'.$load_min[$batch_ltb[csf('id')]];
					$unload_time=$batch_ltb[csf('end_hours')].':'.$batch_ltb[csf('end_minutes')];
					$new_date_time_unload1=($unload_date1.' '.$unload_time.':'.'00');
					$new_date_time_load1=($load_date[$batch_ltb[csf('id')]].' '.$load_time.':'.'00');
					$total_time1=datediff(n,$new_date_time_load1,$new_date_time_unload1);
					echo floor($total_time1/60).":".$total_time1%60;
			//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?></td>
					<td width="100" title="<? echo $shade ?>"><p><?  echo $shade; ?></p></td>
					<td width="100" title="<? ?>"><p><? echo  $batch_ltb[csf('remarks')];  ?></p></td>
					<td align="center" width="100" title="<? //echo $hr.':'.$min;   ?>"><?  $utiliz=$batch_ltb[csf('batch_qnty')]/$m_capacity[$batch_ltb[csf('machine_id')]]*100;
					echo number_format($utiliz,2).'%'; ?> </td>
					<td align="left" title="<? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]];   ?>"><p><? echo  $yarn_lot_arr[$batch_ltb[csf('prod_id')]][$batch_ltb[csf('po_id')]]; ?></p> </td>
				</tr>
						<?
				$d++;
				$total_ltb_sam+=$batch_ltb[csf('batch_qnty')];
				}
				?>
                </table>
				<table class="rpt_table" width="1490" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
			<tfoot>
				<tr>
					<th width="30">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="70"><? echo number_format($total_ltb_sam,2); ?></th>
					<th width="50">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th width="100">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
	</table>
    </div>
				<?
			 }
		 ?>
	</tbody>
	</table>
	</div>
    </div>
    <br>

	<? }


	}
	else if($cbo_type==4) // Dyeing Reprocess Summary
	{
		$group_by=str_replace("'",'',$cbo_group_by);
	?>
	<div>
	<fieldset style="width:1440px;">
	<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Dyeing Reprocess Summary </strong><br>
	<?
		echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
		?>
	 </div>
	 <? echo $i; ?>
	 <table class="rpt_table" width="1440" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header_1">
			<thead>
				<tr>
					<th width="30">SL</th>
					<th width="80">Prod. Date</th>

				   <? if($group_by==3 || $group_by==0){ ?>
                     <th width="80">M/C No</th>
                     <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">Floor</th>
                     <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="60">Shift</th>
                     <? } ?>

					<th width="100">Buyer</th>
					<th width="90">PO No</th>
					<th width="150">Fabrics Desc.</th>
					<th width="80">Color Name</th>
					<th width="90">Batch No</th>
					<th width="40">Extn. No</th>
					<th width="70">Repro. Qty.</th>
					<th width="80">Lot No</th>
					<th width="90">Load Date & Time</th>
					<th width="90">UnLoad Date Time</th>
					<th width="60">Time Used</th>
					<th>Result</th>
				</tr>
			</thead>
	</table>
	<div style=" max-height:350px; width:1440px; overflow-y:scroll;" id="scroll_body">
	<table class="rpt_table" id="table_body" width="1420" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
	<tbody>
	<?
	$sl=1;
	$i=1;$grand_total_btq=0;
	$f=0;$k=1;
	$btq=0;
	$buyer_arr = return_library_array( "select id, buyer_name from lib_buyer",'id','buyer_name');
	$batch_chk_arr=array();$$group_by_arr=array();
	foreach($batchdata as $batch)
	{
	if ($i%2==0)
	$bgcolor="#E9F3FF";
	else
	$bgcolor="#FFFFFF";
	$order_id=$batch[csf('po_id')];
	$color_id=$batch[csf('color_id')];
	$desc=explode(",",$batch[csf('item_description')]);
	$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
	if($group_by!=0)
	{
		if($group_by==1)
		{
			$group_value=$batch[csf('floor_id')];
			$group_name="Floor";
			$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
		}
		else if($group_by==2)
		{
			$group_value=$batch[csf('shift_name')];
			$group_name="Shift";
			$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
		}
		else if($group_by==3)
		{
			$group_value=$batch[csf('machine_id')];
			$group_name="machine";
			$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
		}
		if (!in_array($group_value,$group_by_arr) )
		{
			if($k!=1)
			{
			?>
				<tr bgcolor="#EFEFEF">
					<th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                   <? if($group_by==3 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } ?>
					 <? if($group_by==2 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } if($group_by==1 || $group_by==0){ ?>
					<th width="60">&nbsp;</th>
					 <? } ?>
                   <th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="150">&nbsp;</th>
					<th width="80">&nbsp;</th>

					<th colspan="2">Sub Total</th>
					<th width="70"><? echo number_format($btq,2); ?></th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
				<?
				unset($btq);
			}
			?>
			<tr bgcolor="#EFEFEF">
				<td colspan="15" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
			</tr>
			<?
			$group_by_arr[]=$group_value;
			$k++;
		}
	}

	?>
				<tr bgcolor="<? echo $bgcolor; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor;?>')" id="tr_<? echo $i; ?>">
					<td width="30"><? echo $i; ?></td>
					<td width="80" title="<? echo change_date_format($batch[csf('production_date')]); ?>"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>

                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="60"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>

					<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
					<td  width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
					<td  width="150"><p><? echo $batch[csf('item_description')]; ?></p></td>
					<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
					<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
					<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
					<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
					<td align="left" width="80" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
					<td width="90" title="<?  $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo change_date_format($load_date[$batch[csf('id')]]).'  & '.$load_t; ?>"><p><?   $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$load_t;
					 ?></p></td>
					<td width="90" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
					<td align="center" width="60">
				   <?
				$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
				$new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
				$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
				echo floor($total_time/60).":".$total_time%60;
				//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
						?>
					 </td>
					<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
				</tr>
	<?
	$i++;
	$btq+=$batch[csf('batch_qnty')];
	$grand_total_btq+=$batch[csf('batch_qnty')];
	} //batchdata froeach
	if($group_by!=0)
				{
			?>
                 <tr bgcolor="#EFEFEF">
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                   <? if($group_by==3 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } ?>
					 <? if($group_by==2 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } if($group_by==1 || $group_by==0){ ?>
					<th width="60">&nbsp;</th>
					 <? } ?>
                   <th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="150">&nbsp;</th>
					<th width="80">&nbsp;</th>

					<th colspan="2">Sub Total</th>
					<th width="70"><? echo number_format($btq,2); ?></th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th>&nbsp;</th>
                </tr>
			<? } ?>

		</tbody>


			<tfoot>
				<tr bgcolor="#EFEFEF">
					<th width="30">&nbsp;</th>
					<th width="80">&nbsp;</th>
					 <? if($group_by==3 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } ?>
					 <? if($group_by==2 || $group_by==0){ ?>
					<th width="80">&nbsp;</th>
					 <? } if($group_by==1 || $group_by==0){ ?>
					<th width="60">&nbsp;</th>
					 <? } ?>
					<th width="100">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="150">&nbsp;</th>
					<th width="80">&nbsp;</th>

                    <th colspan="2"><strong>Grand Total : </strong></th>
					<th width="70"><? echo number_format($grand_total_btq,2); ?></th>
					<th width="80">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="90">&nbsp;</th>
					<th width="60">&nbsp;</th>
					<th>&nbsp;</th>
				</tr>
			</tfoot>
	</table>
	</div>
	<?
		foreach (glob("$user_name*.xls") as $filename)
		{

			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_name."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		//$filename=$user_id."_".$name.".xls";
		echo "$total_data****$filename";
		exit();
	?>
	</fieldset>
	</div>
	<? }
	
	disconnect($con);
	exit();
}//Dyeing Report end



else if($action=="dyeing_production_report2") //batchWise
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if($db_type==0) $year_field_by="and YEAR(a.insert_date)";
	else if($db_type==2) $year_field_by=" and to_char(a.insert_date,'YYYY')";
	if($db_type==0) $field_concat="concat(machine_no,'-',brand) as machine_name";
	else if($db_type==2) $field_concat="machine_no || '-' || brand as machine_name";
	// machine_no || '-' || brand as machine_name
	$company = str_replace("'","",$cbo_company_name);
	$working_company = str_replace("'","",$cbo_working_company_name);
	$buyer = str_replace("'","",$cbo_buyer_name);
	$cbo_prod_type = str_replace("'","",$cbo_prod_type);
	$cbo_party_id = str_replace("'","",$cbo_party_id);

	$date_search_type = str_replace("'","",$search_type);
	$job_number = str_replace("'","",$job_number);
	$job_number_id = str_replace("'","",$job_number_show);
	$batch_no = str_replace("'","",$batch_number_show);
	$color = str_replace("'","",$txt_color);
	$machine=str_replace("'","",$txt_machine_id);
	$floor_name=str_replace("'","",$cbo_floor_id);
	$hide_booking_id = str_replace("'","",$txt_hide_booking_id);
	$txt_booking_no = str_replace("'","",$txt_booking_no);

	if ($txt_booking_no!='') $booking_no_cond="  and a.booking_no LIKE '%$txt_booking_no%'"; else $booking_no_cond="";
	if ($hide_booking_id!='') $booking_no_cond.="  and a.booking_no_id in($hide_booking_id) "; else $booking_no_cond.="";


	//echo $company;die;
	$batch_number_hidden = str_replace("'","",$batch_number);
	$ext_num = str_replace("'","",$txt_ext_no);
	$hidden_ext = str_replace("'","",$hidden_ext_no);
	$txt_order = str_replace("'","",$order_no);
	$file_no = str_replace("'","",$file_no);
	$ref_no = str_replace("'","",$ref_no);
	$hidden_order = str_replace("'","",$hidden_order_no);
	$cbo_type = str_replace("'","",$cbo_type);
	$cbo_result_name = str_replace("'","",$cbo_result_name);
	$year = str_replace("'","",$cbo_year);
	$shift = str_replace("'","",$cbo_shift_name);
	//echo $cbo_type;die;
	$txt_date_from = str_replace("'","",$txt_date_from);
	$txt_date_to = str_replace("'","",$txt_date_to);

	if ($cbo_prod_type>0 && $cbo_party_id>0) $cbo_prod_type_cond="and f.service_company in($cbo_party_id) "; else $cbo_prod_type_cond="";
	if ($cbo_prod_type>0) $cbo_prod_source_cond="and f.service_source in($cbo_prod_type) "; else $cbo_prod_source_cond="";

	if ($buyer==0) $sub_buyer_cond=""; else $sub_buyer_cond="  and d.party_id='".$buyer."' ";
	if ($cbo_result_name==0) $result_name_cond=""; else $result_name_cond="  and f.result='".$cbo_result_name."' ";
	if ($shift==0) $shift_name_cond=""; else $shift_name_cond="  and f.shift_name='".$shift."' ";
	if ($machine=="") $machine_cond=""; else $machine_cond =" and f.machine_id in ( $machine ) ";
	if ($floor_name==0 || $floor_name=='') $floor_id_cond=""; else $floor_id_cond=" and f.floor_id=$floor_name";

	if ($buyer==0) $buyerdata=""; else $buyerdata="  and d.buyer_name='".$buyer."' ";
	if ($buyer==0) $buyerdata2=""; else $buyerdata2="  and h.buyer_id='".$buyer."' ";
	if ($batch_no=="") $batch_num=""; else $batch_num="  and a.batch_no='".trim($batch_no)."' ";

	if ($batch_no=="") $unload_batch_cond=""; else $unload_batch_cond="  and batch_no='".trim($batch_no)."' ";
	if ($batch_no=="") $unload_batch_cond2=""; else $unload_batch_cond2="  and f.batch_no='".trim($batch_no)."' ";
	if ($working_company==0) $workingCompany_name_cond2=""; else $workingCompany_name_cond2="  and a.working_company_id='".$working_company."' ";
	if ($company==0) $companyCond=""; else $companyCond="  and a.company_id=$company";


	//$buyerdata=($buyer)?' and d.buyer_name='.$buyer : '';
	//$batch_num=($batch_no)?" and a.batch_no='".$batch_no."'" : '';

	//echo $cbo_batch_type;
	if(trim($ext_no)!="") $ext_no_search="%".trim($ext_no)."%"; else $ext_no_search="%%";
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if ($txt_order!='') $suborder_no="and c.order_no='$txt_order'"; else $suborder_no="";
		if ($job_number_id!='') $sub_job_cond="  and d.job_no_prefix_num='".$job_number_id."' "; else $sub_job_cond="";
	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
	{
	if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
	if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
	if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}
	if ($color=="") $color_name=""; else $color_name="  and g.color_name='$color'";
	//echo $order_no;die;
	if ($ext_num=="") $ext_no=""; else $ext_no="  and a.extention_no=$ext_num ";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	//echo date("Y-n-j", strtotime("first day of previous month"));
	//echo date("Y-n-j", strtotime("last day of previous month"));
	if($txt_date_from && $txt_date_to)
	{
		if($db_type==0)
		{

			$date_from=change_date_format($txt_date_from,'yyyy-mm-dd');
			$date_to=change_date_format($txt_date_to,'yyyy-mm-dd');
			$second_month_ldate=date("Y-m-t",strtotime($date_to));
			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-m',strtotime($date_to));
			$prod_last_day=change_date_format($second_month_ldate,'yyyy-mm-dd');
			//$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			$prod_date_upto=" and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day' ";
			if($date_search_type==1)
			{
				$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 23:59:59' ";
			}

		}
		elseif($db_type==2)
		{

			$date_from=change_date_format($txt_date_from,'','',1);
			$date_to=change_date_format($txt_date_to,'','',1);
			$dateFrom= explode("-",$date_from);
			//echo $dateto[1];
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$prod_date_to=change_date_format($today_date,'','',1);
			$second_month_ldate=date("Y-M-t",strtotime($date_to));
			//$last_day= date("t", strtotime($date_to));
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-M',strtotime($date_to));
		    $prod_last_day=change_date_format($second_month_ldate,'','',1);
			//$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			$prod_date_upto="and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day'";
			if($date_search_type==1)
			{
				$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 11:59:59 PM' ";
			}
		}
	}
			if($date_search_type==1)
			{
				$date_type_msg="Dyeing Date";
			}
			else
			{
				$date_type_msg="Insert Date";
			}

	$yarn_lot_arr=array();
	if($db_type==0)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!=''  group by a.prod_id, b.po_breakdown_id");
	}
	else if($db_type==2)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)  as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' group by a.prod_id, b.po_breakdown_id");
	}
	foreach($yarn_lot_data as $rows)
	{
		$yarn_lot=explode(",",$rows[csf('yarn_lot')]);
		$yarn_lot_arr[$rows['prod_id']][$rows['po_breakdown_id']]=implode(",",array_unique($yarn_lot));
	}
		//print_r($yarn_lot_arr);
	$load_hr=array();
	$load_min=array();
	$load_date=array();
	$water_flow_arr=array();$load_hour_meter_arr=array();
	if ($working_company==0) $workingCompany_name_cond1=""; else $workingCompany_name_cond1="  and service_company='".$working_company."' ";
  	if ($company==0) $companyCond1=""; else $companyCond1="  and company_id=$company";
	$load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=35 $companyCond1 $unload_batch_cond $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($load_time_data as $row_time)// for Loading time
	{
		$load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_load_hr=array();
	$subcon_load_min=array();
	$subcon_load_date=array();$subcon_load_hour_meter_arr=array();
	$subcon_water_flow_arr=array();
	$subcon_load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=38 $companyCond1 $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
		$subcon_load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$subcon_load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$subcon_load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$subcon_water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$subcon_load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_unload_hr=array();
	$subcon_unload_min=array();
	$subcon_unload_date=array();
	$subcon_unload_time_data=sql_select("select batch_id,batch_no,load_unload_id,production_date,end_hours,end_minutes from pro_fab_subprocess where load_unload_id=2 and entry_form=38 $companyCond1 $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
	$subcon_unload_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
	$subcon_unload_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
	$subcon_unload_time_data[$row_time[csf('batch_id')]]=$row_time[csf('production_date')];
	}
	//var_dump($load_hr);

	$m_capacity=array();
	$unload_min=array();
	$machine_arr=return_library_array( "select id,$field_concat from  lib_machine_name order by seq_no ",'id','machine_name');
	$machine_capacity_data=sql_select("select id,prod_capacity as m_capacity  from lib_machine_name where status_active=1  and is_deleted=0 ");
	foreach($machine_capacity_data as $capacity)// for Un-Loading time
	{
		$m_capacity[$capacity[csf('id')]]=$capacity[csf('m_capacity')];
	}

	$sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=35 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0  $unload_batch_cond2 $dates_com ");
	$tot_row=1;
	foreach($sql_batch_id as $row_batch)
	{
		if($tot_row!=1) $batch_id.=",";
		$batch_id.=$row_batch[csf('batch_id')];

		$tot_row++;
	}//echo $batch_id;die;
		unset($sql_batch_id);
		$batchIds=chop($batch_id,','); $batchIds_cond="";
		if($db_type==2 && count($tot_row)>990)
		{
			$batchIds_cond=" and (";
			$batchIdsArr=array_chunk(explode(",",$batchIds),990);
			foreach($batchIdsArr as $ids)
			{
				$ids=implode(",",$ids);
				$batchIds_cond.=" a.id not in($ids) or ";
			}
			$batchIds_cond=chop($batchIds_cond,'or ');
			$batchIds_cond.=")";
		}
		else
		{
			$batchIds_cond=" and a.id not in($batchIds)";
		}
		//echo $batchIds_cond;
	$sub_sql_batch_id=sql_select("select batch_id from  pro_fab_subprocess where entry_form=38 and load_unload_id=2 and status_active=1 and is_deleted=0");
	$k=1;
	foreach($sub_sql_batch_id as $row_batch)
	{
		if($k!=1) $sub_batch_id.=",";
		$sub_batch_id.=$row_batch[csf('batch_id')];

		$k++;
	}
	if($batch_id=="") $batch_id=0;
	if($sub_batch_id=="") $sub_batch_id=0;
	$group_by=str_replace("'",'',$cbo_group_by);
	if($group_by==1)
	{
		$order_by="order by f.floor_id";
		$order_by2="order by floor_id";
	}
	else if($group_by==2)
	{
		$order_by="order by f.shift_name";
		$order_b2y="order by shift_name";
	}
	else if($group_by==3)
	{
		$order_by="order by f.machine_id";
		$order_by2="order by machine_id";
	}
	else
	{
		$order_by="order by f.process_end_date,f.machine_id";
		$order_by2="order by process_end_date,machine_id";
	}
	if($cbo_type==2) //Dyeing Report.....
	{
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{ //c.grouping,c.file_no,
			if($db_type==2) $grp_con="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no";
			else if($db_type==0) $grp_con="group_concat(distinct c.po_number) AS po_number,group_concat(distinct b.po_id) AS po_id,group_concat(distinct c.grouping) AS grouping,group_concat(distinct c.file_no) AS file_no";
			if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description";
			else if($db_type==0) $group_con2="group_concat(b.width_dia_type) AS width_dia_type,group_concat(b.item_description) AS item_description";

		$sql="(select f.insert_date,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty,$group_con2, $grp_con,d.job_no as job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where f.batch_id=a.id $companyCond  $dates_com $workingCompany_name_cond2 $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $booking_no_cond  $cbo_prod_source_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.total_trims_weight, a.extention_no,d.buyer_name,d.job_no, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order,f.insert_date)
			 union
			 (
			 	select f.insert_date, a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,$group_con2, null as po_number, null as po_id,null as grouping, null as file_no,null, h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date,
    f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond and f.batch_id=a.id  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0  $dates_com $workingCompany_name_cond2 $batch_num  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no,
 f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks,f.insert_date
			 ) $order_by2";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2) //Subcontact
			{
				if($db_type==2) $grp_con="LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY b.item_description) AS item_description,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type";
			 else if($db_type==0) $grp_con="group_concat(c.order_no) AS po_number,group_concat(b.item_description) AS item_description,group_concat(b.po_id) AS po_id,group_concat(b.width_dia_type) AS width_dia_type";

				$sql_subcon="select f.insert_date,a.batch_no,a.id, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty,$grp_con,d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0  $dates_com $workingCompany_name_cond2 $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $booking_no_cond $cbo_prod_source_cond
				GROUP BY a.batch_no, a.id,a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, d.subcon_job, d.party_id, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result,f.insert_date $order_by";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
				  if($db_type==2) $grp_con="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping";
			 else if($db_type==0) $grp_con="group_concat(distinct b.width_dia_type) AS width_dia_type,group_concat(distinct c.po_number) AS po_number,group_concat(b.item_description) AS item_description,group_concat(b.po_id) AS po_id,group_concat(c.file_no) AS file_no,group_concat(c.grouping) AS grouping";

			 if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,null as po_number, LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description,null as po_id,null as file_no,null as  grouping,null as job_no_prefix_num ";
			else if($db_type==0) $group_con2="group_concat(b.width_dia_type) AS width_dia_type,null as po_number,group_concat(b.item_description) AS item_description,null as po_id,null as file_no,null as grouping,null as job_no_prefix_num";


				 $sql_sam="(select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,$grp_con,d.job_no as job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, fabric_type,f.result from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  $dates_com $jobdata $workingCompany_name_cond2  $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond  $cbo_prod_source_cond $booking_no_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no, d.job_no, d.buyer_name, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no,f.result,f.insert_date )
			 union
			 (
			 select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, $group_con2, h.buyer_id as buyer_name,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond and f.batch_id=a.id $dates_com $workingCompany_name_cond2  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.insert_date)  $order_by2";
			}
	}
	if($cbo_type==2) // Batch Wise --Dyeing Production
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//echo $sql;
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon;
			$sql_subcon_data=sql_select($sql_subcon);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) //Batch Aganist - Sample
		{
			//echo $sql_sam;
			$batchdata_sam=sql_select($sql_sam);
		}
	//print_r($sql_subcon_data);
	}
	ob_start();
    if($cbo_type==2) //  Batch Wise -- Dyeing Production
	{
		?>
		<div>
		<fieldset style="width:1350px;">
		<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Batch Wise Dyeing Production </strong><br>
		<?
			//echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
			echo  ($date_from == '0000-00-00' || $date_from == '' ? '' : change_date_format($date_from)).' To ';echo  ($date_to == '0000-00-00' || $date_to == '' ? '' : change_date_format($date_to));
			?>
		 </div>
		 <?
		 if ($cbo_result_name==1 || $cbo_result_name==0)
		 {
		 ?>
		 <div style="margin-left:-1300px">
         <table cellpadding="0"  width="300" cellspacing="0"   class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="3">Production Summary</th>
								</tr>
								<tr>
									<th>Details </th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
							 $sql="select f.load_unload_id,f.process_end_date,count(f.process_end_date) as row_count, SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $prod_date_upto $jobdata $batch_num $buyerdata $order_no $year_cond $workingCompany_name_cond2 $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond GROUP BY f.load_unload_id,f.process_end_date  ";
							$sql_datas=sql_select($sql);
							}
							$unload_qty_arr=array();$plan_cycle_time=0;
							foreach($sql_datas as $row)
							{
								$tot_row=count($row[csf('process_end_date')]);
								$unload_qty_arr[$row[csf('load_unload_id')]]['qty']+=$row[csf('batch_qnty')];
								$unload_qty_arr[$row[csf('load_unload_id')]]['count']+=$tot_row;
							}
							//print_r($unload_qty_arr);
							$total_current_mon_qty=$unload_qty_arr[2]['qty'];
							$total_count=$unload_qty_arr[2]['count'];

							 $sql_result="select f.fabric_type,f.process_end_date,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  and f.fabric_type in(1,4,5,6) $dates_com $workingCompany_name_cond2 $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $booking_no_cond  $cbo_prod_source_cond GROUP BY f.fabric_type,f.process_end_date  ";
							$sql_result=sql_select($sql_result);
							$fabric_batch_arr=array();
							foreach($sql_result as $row)
							{
								$fabric_batch_arr[$row[csf('fabric_type')]]['qty']+=$row[csf('batch_qnty')];
								//$tot_batch_qty+=$row[csf('batch_qnty')];
							}
							//print_r($fabric_batch_arr);

								?>
								  <tr bgcolor="#E9F3FF" style="cursor:pointer;">

									  <td>Current Month</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty,2);?></td>
									  <td align="right"><?  ?></td>
								  </tr>
                                  <tr bgcolor="#D8D8D8" style="cursor:pointer;">

									  <td>Avg. Prod. Per Day</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty/$total_count,2); ?></td>
									  <td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
								  </tr>
                                  <? $k=1;	$tot_batch_qty=0;
								 //$fabric_type_for_dyeing2=array(1=>'Cotton',2=>'Polyster',3=>'Lycra',4=>'Both Part',5=>'White',6=>'Wash');

								  //print_r($fabric_type_for_dyeingnn);
								  foreach($fabric_batch_arr as $typekey=>$val)
								  	{
										if ($k%2==0) $bgcolor="#FFFFFF"; else $bgcolor="#E9F3FF";
										if($typekey==1)
										{
											$fab_type="Cotton";
										}
										else if($typekey==2)
										{
											$fab_type="Polyster";
										}
										else if($typekey==3)
										{
											$fab_type="Lycra";
										}
										else if($typekey==4)
										{
											$fab_type="Both Part";
										}
										else if($typekey==5)
										{
											$fab_type="White";
										}
										else if($typekey==6)
										{
											$fab_type="Wash";
										}
											  ?>
                                   <tr bgcolor="<? echo $bgcolor;?>">
									 <? //print_r($fabric_type_for_dyeing);?>
									  <td><?php echo $fab_type; //$fabric_type_for_dyeing[$typekey];   ?></td>
                                       <td align="right"><? echo number_format($val['qty'],2); ?></td>
									  <td align="right"><? echo number_format(($val['qty']/$total_current_mon_qty)*100,2); ?></td>
								  </tr>
							<? 		$tot_batch_qty+=$val['qty'];
								  	$k++;
									}

							?>
							</tbody>
							<tfoot>
								<tr>
									<th align="right">Total </th>
									<th align="right"><b><? echo number_format($tot_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format(($tot_batch_qty/$total_current_mon_qty*100),2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>


		 </div>
		 <br />
		 <?
		}

		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		 {
			if (count($batchdata)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left">

			<b>Self batch  </b>
			 <table class="rpt_table" width="2270" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_header_1">

                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg;?></th>

                       <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="60">File No</th>
                        <th width="70">Ref. No</th>
                        <th width="100">Buyer</th>
                        <th width="80">Job</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/Width Type</th>
                        <th width="80">Color Name</th>
                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Fabric Wgt.</th>
                        <th width="70">Trims Wgt.</th>
                        <th width="70">Batch Wgt.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
                        <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab. Type</th>
                        <th width="100">Result</th>
                        <th width="">Remark</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2290; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body" width="2270" cellpadding="0" cellspacing="0" border="1" rules="all">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$total_water_cons_load=0;$total_water_cons_unload=0;$tot_batch_wgt=0;
                $batch_chk_arr=array(); $group_by_arr=array();$tot_trims_qnty=0;$trims_check_array=array();
                foreach($batchdata as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($date_search_type==1)
					{
						$date_type_cond=$batch[csf('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[csf('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}

					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="60">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($fab_weight,2); ?></td>
                                    <td width="70"><? echo number_format($tot_trim_qty2,2); ?></td>
                                    <td width="70"><? echo number_format($fab_weight+$tot_trim_qty2,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="50">&nbsp;</td>
                                    <td width="60"><? //echo $total_water_cons_load;?></td>

                                    <td width="70"><? //echo number_format($btq,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($fab_weight);
								unset($tot_trim_qty2);
								unset($tot_batch_wgt);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="31" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}


					$order_id=$batch[csf('po_id')];

					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$load_hour_meter=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					//$desc=explode(",",$batch[csf('item_description')]);
					$desc=implode(",",array_unique(explode(",",$batch[csf('item_description')])));
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
					$grouping=implode(",",array_unique(explode(",",$batch[csf('grouping')])));
					$width_dia_type=array_unique(explode(",",$batch[csf('width_dia_type')]));
					$dia_width_arr='';$dia_width_ids='';
					foreach($width_dia_type as $dtype)
					{
						if($dia_width_arr=='') $dia_width_arr=$fabric_typee[$dtype];else $dia_width_arr.=','.$fabric_typee[$dtype];
						if($dia_width_ids=='') $dia_width_ids=$dtype;else $dia_width_ids.=','.$dtype;
					}
					// $fabric_typee

					$batch_id=$batch[csf('id')];
				if (!in_array($batch_id,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_id;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}

					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($date_type_cond); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td align="center" width="60"><div style="width:60px; word-wrap:break-word;"><? echo $file_no; ?></div></td>
                        <td align="center" width="70"><div style="width:70px; word-wrap:break-word;"><? echo $grouping; ?></div></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
                        <td width="80"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
                        <td width="90"><div style="width:90px; word-wrap:break-word;"><? echo $po_number; ?></div></td>
                        <td width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $dia_width_ids; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a></div></td>
                        <td width="70"><p><? echo $dia_width_arr; ?></p></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_weight')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>

                       <td align="right" width="70"><?

					   echo number_format($batch[csf('batch_weight')]+$tot_trim_qty,2);  ?></td>

                        <td width="60" align="right"><p><? echo number_format($load_hour_meter,2);  ?></p></td>
                        <td width="60" align="right"><p><? echo number_format($batch[csf('hour_unload_meter')],2);  ?></p></td>
                       <td width="60" align="right" ><p><? echo number_format($batch[csf('hour_unload_meter')]-$load_hour_meter,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" title="<? echo "Water Cons Unload-Water Cons Load*1000/Batch Qnty"?>" ><? echo number_format((($water_cons_unload-$water_cons_load)*1000)/$batch[csf('batch_qnty')],2);//number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                        <td align="center" width="100"><p><?
						if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td align="center" width="100"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty+=$batch[csf('batch_qnty')];
					$fab_weight+=$batch[csf('batch_weight')];
					$tot_trim_qty2+=$tot_trim_qty;
					$total_water_cons_load+=$water_cons_load;
					$total_water_cons_unload+=$water_cons_unload;
					$tot_trims_qnty+=$tot_trim_qty;
					$tot_batch_wgt+=$batch[csf('batch_weight')]+$tot_trim_qty;
					$grand_total_batch_qty+=$batch[csf('batch_weight')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <td width="30">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                     <? if($group_by==2 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } if($group_by==1 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                    <td width="60">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="90">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                     <td width="70"><? echo number_format($fab_weight,2); ?></td>
                    <td width="70"><? echo number_format($tot_trim_qty2,2); ?></td>

                    <td width="70"><? echo number_format($fab_weight+$tot_trim_qty2,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="50">&nbsp;</td>
                    <td width="60"><? //echo $total_water_cons_load;?></td>

                    <td width="70"><? //echo number_format($btq,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                     <td width="100">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>&nbsp;</strong></th>
                    <th width="70"><? //echo number_format($tot_trims_qnty,2); ?></th>
                    <th width="70"><? //echo number_format($tot_trims_qnty,2); ?></th>
                    <th colspan="14">&nbsp; </th>

                </tr>

                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80"><? //echo $total_water_cons_load;?></th>
                    <th width="130" colspan="2"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($fab_weight,2);?></th>
                    <th width="70"><? echo number_format($tot_trims_qnty,2);//number_format($grand_total_batch_qty,2); ?></th>

                     <th width="70"><? echo number_format($grand_total_batch_qty,2); ?></th>

                    <th colspan="13" align="left"> </th>

                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			if(count($sql_subcon_data)>0)
			{
		?>
		 <div align="left">
		  <div align="left"><b> Subcon batch</b> </div>
		 <table class="rpt_table" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_2">
				<thead>
					<tr>
						<th width="30">SL</th>
						<th width="80"><? echo $date_type_msg;?></th>
						<th width="80">M/C No</th>
						<th width="80">Floor</th>
						<th width="80">Shift Name</th>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70">Dia/Width Type</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="40">Extn. No</th>
						<th width="70">Dyeing Qty.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
						<th width="60">Total Time</th>
						<th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


						<th width="75">Load Date & Time</th>
						<th width="75">UnLoad Date Time</th>

                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab Type</th>
						<th>Result</th>
					</tr>
				</thead>
		</table>
		<div style=" max-height:350px; width:1910px; overflow-y:scroll;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
		<tbody>
					<?
					$i=1;
					$btq=0;$trims_btq_sub=0;
					$batch_chk_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($i%2==0)
					$bgcolor_sub2="#E9F3FF";
					else
					$bgcolor_sub2="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$batch_weight_sub=$batch[csf('batch_weight')];
					$water_cons_unload_sub=$batch[csf('water_flow_meter')];
					$water_cons_load_sub=$subcon_water_flow_arr[$batch[csf('id')]];
					$load_hour_meter_sub=$subcon_load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff_sub=($water_cons_unload_sub-$water_cons_load_sub)/$batch_weight_sub*1000;
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$width_dia_type=array_unique(explode(",",$batch[csf('width_dia_type')]));
					$dia_width_arr='';
					foreach($width_dia_type as $dtype)
					{
						if($dia_width_arr=='') $dia_width_arr=$fabric_typee[$dtype];else $dia_width_arr.=','.$fabric_typee[$dtype];
					}
					//echo $load_hr[$batch[csf('id')]].'ddddd';
					//echo $batch[csf('id')];
					?>
					<tr bgcolor="<? echo $bgcolor_sub2; ?>" id="trsub_<? echo $i; ?>" onClick="change_color('trsub_<? echo $i; ?>','<? echo $bgcolor; ?>')">
						<td width="30"><? echo $i; ?></td>
						<td width="80"><p><? echo ($batch[csf('production_date')] == '0000-00-00' || $batch[csf('production_date')] == '' ? '' : change_date_format($batch[csf('production_date')])); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
						<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $floor_arr[$batch[csf('floor_id')]];  ?>"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $shift_name[$batch[csf('shift_name')]];  ?>"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
						<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? echo  $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td  width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
						<td  width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $batch[csf('width_dia_type')]; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a><? //echo $batch[csf('item_description')]; ?></div></td>
						<td  width="70" title="<? echo  $dia_width_arr; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>

                          <td width="60" align="right"><p><? echo $load_hour_meter_sub;  ?></p></td>
                           <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')];  ?></p></td>
                          <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')]-$load_hour_meter_sub;  ?></p></td>
						<td align="left" width="50" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60"><p><? echo $water_cons_load_sub;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload_sub;  ?></p></td>

                        <td align="right" width="70" title="<? echo number_format($water_cons_diff_sub,2);  ?>"><? echo number_format($water_cons_diff_sub,2);  ?></td>


						<td width="75" title="<?  $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];  echo ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).'  & '.$sub_load_t; ?>"><p><?   $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]]; echo  ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).' <br> '.$sub_load_t;
						 ?></p></td>
						<td width="75" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; // $unloadd=change_date_format($batch[csf('process_end_date')]).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
						<td align="center" width="60">
					   <?
					$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
					$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$sub_load_t.':'.'00');
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
					//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
							?>
						 </td>
                         <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						 echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
						<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
					</tr>
		<?
		$i++;
		$btq_sub+=$batch[csf('sub_batch_qnty')];
		$trims_btq_sub+=$batch[csf('total_trims_weight')];
		} //batchdata froeach
		 ?>
			</tbody>
		</table>
		<table class="rpt_table" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
				<thead>

                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="40">Total Trims</th>
						<th width="70"><? echo number_format($trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="40">Grand Total</th>
						<th width="70"><? echo number_format($btq_sub+$trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						 <th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
		</table>
		</div>
		</div>
		<?
		}
		} // Sub Cond End

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
		{
			if (count($batchdata_sam)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <style type="text/css">
				table tr th, table tr td{word-wrap: break-word;word-break: break-all;}
			</style>
			 <div style="width: 2290px;" align="left">
			 <div> <b>Sample Dyeing Production </b></div>
			 <table class="rpt_table" width="2270" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_3">
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg;?></th>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <th width="80">M/C No</th>
                        <? }
						?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="70">File No</th>
                        <th width="80">Ref. No</th>
                        <th width="100">Buyer</th>

                        <th width="80">Job</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/ Width Type</th>
                        <th width="80">Color Name</th>

                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Qty.</th>

                        <th width="60">Hour Load Meter</th>
 						<th width="60">Hour unLoad Meter</th>
                         <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fabrics<br>Type</th>
                        <th width="100">Result</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2290; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body3" width="2270" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$grand_total_batch_qty_sam=0;$batch_qnty_sam=0;$total_trim_qty=0;
                $batch_chk_arr=array(); $group_by_arr=array();$trims_check_array=array();
                foreach($batchdata_sam as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                     <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                    				<td width="80">&nbsp;</td>
                                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60"><? //echo number_format($btq,2); ?></td>
                                    <td width="50">&nbsp;</td>
                                     <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                     <td width="70"><? //echo number_format($btq,2); ?></td>

                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td>&nbsp;r</td>
                                </tr>
								<?
								unset($batch_qnty_sam);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="28" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}
					$order_id=$batch[csf('po_id')];
					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$hour_meter_load=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$batch_id=$batch[csf('id')];
				if (!in_array($batch_id,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_id;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
                          <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <? } if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td width="70"><p><? echo $batch[csf('file_no')]; ?></p></td>
                        <td width="80"><p><? echo $batch[csf('grouping')]; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>

                        <td width="80"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
                        <td width="90"><p><? echo $po_number; ?></p></td>
                        <td width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $batch[csf('width_dia_type')]; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a><? //echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><div style="width:70px; word-wrap:break-word;"><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></div></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>
                        <td width="60"><p><? echo number_format($hour_meter_load,2);  ?></p></td>
                        <td width="60"><p><? echo number_format($batch[csf('hour_unload_meter')],2);  ?></p></td>

                        <td width="60"><p><? echo number_format($batch[csf('hour_unload_meter')]-$hour_meter_load,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                         <td width="60"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" ><? echo number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                          <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						  echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td width="100" align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center" title="<?  echo $batch[csf('remarks')];   ?>"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty_sam+=$batch[csf('batch_qnty')];
					$total_trim_qty+=$tot_trim_qty;
					$grand_total_batch_qty_sam+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                     <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>Sub. Total : </strong></th>
                    <th width="70"><? echo number_format($batch_qnty_sam,2); ?></th>
                  	<th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                     <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                     <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty_sam,2); ?></th>
                    <th width="60"><? echo number_format($total_trim_qty,2);?></th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                   <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
			?>


            <?
		}
		?>
		</fieldset>
		</div>
		<?
		} //Dyeing Production End

	/*foreach (glob("$user_id*.xls") as $filename)
		{

			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		//$filename=$user_id."_".$name.".xls";
		echo "$total_data****$filename";*/
		exit();
}

else if($action=="new_action") //new button
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if($db_type==0) $year_field_by="and YEAR(a.insert_date)";
	else if($db_type==2) $year_field_by=" and to_char(a.insert_date,'YYYY')";
	if($db_type==0) $field_concat="concat(machine_no,'-',brand) as machine_name";
	else if($db_type==2) $field_concat="machine_no || '-' || brand as machine_name";
	// machine_no || '-' || brand as machine_name
	$company = str_replace("'","",$cbo_company_name);
	$working_company = str_replace("'","",$cbo_working_company_name);
	$buyer = str_replace("'","",$cbo_buyer_name);
	$cbo_prod_type = str_replace("'","",$cbo_prod_type);
	$cbo_party_id = str_replace("'","",$cbo_party_id);

	$date_search_type = str_replace("'","",$search_type);
	$job_number = str_replace("'","",$job_number);
	$job_number_id = str_replace("'","",$job_number_show);
	$batch_no = str_replace("'","",$batch_number_show);
	$color = str_replace("'","",$txt_color);
	$machine=str_replace("'","",$txt_machine_id);
	$floor_name=str_replace("'","",$cbo_floor_id);
	$hide_booking_id = str_replace("'","",$txt_hide_booking_id);
	$txt_booking_no = str_replace("'","",$txt_booking_no);

	if ($txt_booking_no!='') $booking_no_cond="  and a.booking_no LIKE '%$txt_booking_no%'"; else $booking_no_cond="";
	if ($hide_booking_id!='') $booking_no_cond.="  and a.booking_no_id in($hide_booking_id) "; else $booking_no_cond.="";


	echo "gggggg".$company;die;
	$batch_number_hidden = str_replace("'","",$batch_number);
	$ext_num = str_replace("'","",$txt_ext_no);
	$hidden_ext = str_replace("'","",$hidden_ext_no);
	$txt_order = str_replace("'","",$order_no);
	$file_no = str_replace("'","",$file_no);
	$ref_no = str_replace("'","",$ref_no);
	$hidden_order = str_replace("'","",$hidden_order_no);
	$cbo_type = str_replace("'","",$cbo_type);
	$cbo_result_name = str_replace("'","",$cbo_result_name);
	$year = str_replace("'","",$cbo_year);
	$shift = str_replace("'","",$cbo_shift_name);
	//echo $cbo_type;die;
	$txt_date_from = str_replace("'","",$txt_date_from);
	$txt_date_to = str_replace("'","",$txt_date_to);

	if ($cbo_prod_type>0 && $cbo_party_id>0) $cbo_prod_type_cond="and f.service_company in($cbo_party_id) "; else $cbo_prod_type_cond="";
	if ($cbo_prod_type>0) $cbo_prod_source_cond="and f.service_source in($cbo_prod_type) "; else $cbo_prod_source_cond="";

	if ($buyer==0) $sub_buyer_cond=""; else $sub_buyer_cond="  and d.party_id='".$buyer."' ";
	if ($cbo_result_name==0) $result_name_cond=""; else $result_name_cond="  and f.result='".$cbo_result_name."' ";
	if ($shift==0) $shift_name_cond=""; else $shift_name_cond="  and f.shift_name='".$shift."' ";
	if ($machine=="") $machine_cond=""; else $machine_cond =" and f.machine_id in ( $machine ) ";
	if ($floor_name==0 || $floor_name=='') $floor_id_cond=""; else $floor_id_cond=" and f.floor_id=$floor_name";

	if ($buyer==0) $buyerdata=""; else $buyerdata="  and d.buyer_name='".$buyer."' ";
	if ($buyer==0) $buyerdata2=""; else $buyerdata2="  and h.buyer_id='".$buyer."' ";
	if ($batch_no=="") $batch_num=""; else $batch_num="  and a.batch_no='".trim($batch_no)."' ";

	if ($batch_no=="") $unload_batch_cond=""; else $unload_batch_cond="  and batch_no='".trim($batch_no)."' ";
	if ($batch_no=="") $unload_batch_cond2=""; else $unload_batch_cond2="  and f.batch_no='".trim($batch_no)."' ";
	if ($working_company==0) $workingCompany_name_cond2=""; else $workingCompany_name_cond2="  and a.working_company_id='".$working_company."' ";
	if ($company==0) $companyCond=""; else $companyCond="  and a.company_id=$company";


	//$buyerdata=($buyer)?' and d.buyer_name='.$buyer : '';
	//$batch_num=($batch_no)?" and a.batch_no='".$batch_no."'" : '';

	//echo $cbo_batch_type;
	if(trim($ext_no)!="") $ext_no_search="%".trim($ext_no)."%"; else $ext_no_search="%%";
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if ($txt_order!='') $suborder_no="and c.order_no='$txt_order'"; else $suborder_no="";
		if ($job_number_id!='') $sub_job_cond="  and d.job_no_prefix_num='".$job_number_id."' "; else $sub_job_cond="";
	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
	{
	if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
	if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
	if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}
	if ($color=="") $color_name=""; else $color_name="  and g.color_name='$color'";
	//echo $order_no;die;
	if ($ext_num=="") $ext_no=""; else $ext_no="  and a.extention_no=$ext_num ";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	//echo date("Y-n-j", strtotime("first day of previous month"));
	//echo date("Y-n-j", strtotime("last day of previous month"));
	if($txt_date_from && $txt_date_to)
	{
		if($db_type==0)
		{

			$date_from=change_date_format($txt_date_from,'yyyy-mm-dd');
			$date_to=change_date_format($txt_date_to,'yyyy-mm-dd');
			$second_month_ldate=date("Y-m-t",strtotime($date_to));
			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-m',strtotime($date_to));
			$prod_last_day=change_date_format($second_month_ldate,'yyyy-mm-dd');
			//$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			$prod_date_upto=" and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day' ";
			if($date_search_type==1)
			{
				$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 23:59:59' ";
			}

		}
		elseif($db_type==2)
		{

			$date_from=change_date_format($txt_date_from,'','',1);
			$date_to=change_date_format($txt_date_to,'','',1);
			$dateFrom= explode("-",$date_from);
			//echo $dateto[1];
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$prod_date_to=change_date_format($today_date,'','',1);
			$second_month_ldate=date("Y-M-t",strtotime($date_to));
			//$last_day= date("t", strtotime($date_to));
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-M',strtotime($date_to));
		    $prod_last_day=change_date_format($second_month_ldate,'','',1);
			//$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			$prod_date_upto="and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day'";
			if($date_search_type==1)
			{
				$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 11:59:59 PM' ";
			}
		}
	}
			if($date_search_type==1)
			{
				$date_type_msg="Dyeing Date";
			}
			else
			{
				$date_type_msg="Insert Date";
			}

	$yarn_lot_arr=array();
	if($db_type==0)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!=''  group by a.prod_id, b.po_breakdown_id");
	}
	else if($db_type==2)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)  as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' group by a.prod_id, b.po_breakdown_id");
	}
	foreach($yarn_lot_data as $rows)
	{
		$yarn_lot=explode(",",$rows[csf('yarn_lot')]);
		$yarn_lot_arr[$rows['prod_id']][$rows['po_breakdown_id']]=implode(",",array_unique($yarn_lot));
	}
		//print_r($yarn_lot_arr);
	$load_hr=array();
	$load_min=array();
	$load_date=array();
	$water_flow_arr=array();$load_hour_meter_arr=array();
	if ($working_company==0) $workingCompany_name_cond1=""; else $workingCompany_name_cond1="  and service_company='".$working_company."' ";
  	if ($company==0) $companyCond1=""; else $companyCond1="  and company_id=$company";
	$load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=35 $companyCond1 $unload_batch_cond $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($load_time_data as $row_time)// for Loading time
	{
		$load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_load_hr=array();
	$subcon_load_min=array();
	$subcon_load_date=array();$subcon_load_hour_meter_arr=array();
	$subcon_water_flow_arr=array();
	$subcon_load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=38 $companyCond1 $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
		$subcon_load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$subcon_load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$subcon_load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$subcon_water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$subcon_load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_unload_hr=array();
	$subcon_unload_min=array();
	$subcon_unload_date=array();
	$subcon_unload_time_data=sql_select("select batch_id,batch_no,load_unload_id,production_date,end_hours,end_minutes from pro_fab_subprocess where load_unload_id=2 and entry_form=38 $companyCond1 $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
	$subcon_unload_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
	$subcon_unload_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
	$subcon_unload_time_data[$row_time[csf('batch_id')]]=$row_time[csf('production_date')];
	}
	//var_dump($load_hr);

	$m_capacity=array();
	$unload_min=array();
	$machine_arr=return_library_array( "select id,$field_concat from  lib_machine_name order by seq_no ",'id','machine_name');
	$machine_capacity_data=sql_select("select id,prod_capacity as m_capacity  from lib_machine_name where status_active=1  and is_deleted=0 ");
	foreach($machine_capacity_data as $capacity)// for Un-Loading time
	{
		$m_capacity[$capacity[csf('id')]]=$capacity[csf('m_capacity')];
	}

	$sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=35 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0  $unload_batch_cond2 $dates_com ");
	$tot_row=1;
	foreach($sql_batch_id as $row_batch)
	{
		if($tot_row!=1) $batch_id.=",";
		$batch_id.=$row_batch[csf('batch_id')];

		$tot_row++;
	}//echo $batch_id;die;
		unset($sql_batch_id);
		$batchIds=chop($batch_id,','); $batchIds_cond="";
		if($db_type==2 && count($tot_row)>990)
		{
			$batchIds_cond=" and (";
			$batchIdsArr=array_chunk(explode(",",$batchIds),990);
			foreach($batchIdsArr as $ids)
			{
				$ids=implode(",",$ids);
				$batchIds_cond.=" a.id not in($ids) or ";
			}
			$batchIds_cond=chop($batchIds_cond,'or ');
			$batchIds_cond.=")";
		}
		else
		{
			$batchIds_cond=" and a.id not in($batchIds)";
		}
		//echo $batchIds_cond;
	$sub_sql_batch_id=sql_select("select batch_id from  pro_fab_subprocess where entry_form=38 and load_unload_id=2 and status_active=1 and is_deleted=0");
	$k=1;
	foreach($sub_sql_batch_id as $row_batch)
	{
		if($k!=1) $sub_batch_id.=",";
		$sub_batch_id.=$row_batch[csf('batch_id')];

		$k++;
	}
	if($batch_id=="") $batch_id=0;
	if($sub_batch_id=="") $sub_batch_id=0;
	$group_by=str_replace("'",'',$cbo_group_by);
	if($group_by==1)
	{
		$order_by="order by f.floor_id";
		$order_by2="order by floor_id";
	}
	else if($group_by==2)
	{
		$order_by="order by f.shift_name";
		$order_b2y="order by shift_name";
	}
	else if($group_by==3)
	{
		$order_by="order by f.machine_id";
		$order_by2="order by machine_id";
	}
	else
	{
		$order_by="order by f.process_end_date,f.machine_id";
		$order_by2="order by process_end_date,machine_id";
	}
	if($cbo_type==2) //Dyeing Report.....
	{
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{ //c.grouping,c.file_no,
			if($db_type==2) $grp_con="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no";
			else if($db_type==0) $grp_con="group_concat(distinct c.po_number) AS po_number,group_concat(distinct b.po_id) AS po_id,group_concat(distinct c.grouping) AS grouping,group_concat(distinct c.file_no) AS file_no";
			if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description";
			else if($db_type==0) $group_con2="group_concat(b.width_dia_type) AS width_dia_type,group_concat(b.item_description) AS item_description";

		$sql="(select f.insert_date,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty,$group_con2, $grp_con,d.job_no as job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where f.batch_id=a.id $companyCond  $dates_com $workingCompany_name_cond2 $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $booking_no_cond  $cbo_prod_source_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.total_trims_weight, a.extention_no,d.buyer_name,d.job_no, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order,f.insert_date)
			 union
			 (
			 	select f.insert_date, a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,$group_con2, null as po_number, null as po_id,null as grouping, null as file_no,null, h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date,
    f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond and f.batch_id=a.id  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0  $dates_com $workingCompany_name_cond2 $batch_num  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no,
 f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks,f.insert_date
			 ) $order_by2";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2) //Subcontact
			{
				if($db_type==2) $grp_con="LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY b.item_description) AS item_description,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type";
			 else if($db_type==0) $grp_con="group_concat(c.order_no) AS po_number,group_concat(b.item_description) AS item_description,group_concat(b.po_id) AS po_id,group_concat(b.width_dia_type) AS width_dia_type";

				$sql_subcon="select f.insert_date,a.batch_no,a.id, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty,$grp_con,d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0  $dates_com $workingCompany_name_cond2 $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $booking_no_cond $cbo_prod_source_cond
				GROUP BY a.batch_no, a.id,a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, d.subcon_job, d.party_id, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result,f.insert_date $order_by";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
				  if($db_type==2) $grp_con="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping";
			 else if($db_type==0) $grp_con="group_concat(distinct b.width_dia_type) AS width_dia_type,group_concat(distinct c.po_number) AS po_number,group_concat(b.item_description) AS item_description,group_concat(b.po_id) AS po_id,group_concat(c.file_no) AS file_no,group_concat(c.grouping) AS grouping";

			 if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,null as po_number, LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description,null as po_id,null as file_no,null as  grouping,null as job_no_prefix_num ";
			else if($db_type==0) $group_con2="group_concat(b.width_dia_type) AS width_dia_type,null as po_number,group_concat(b.item_description) AS item_description,null as po_id,null as file_no,null as grouping,null as job_no_prefix_num";


				 $sql_sam="(select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,$grp_con,d.job_no as job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, fabric_type,f.result from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  $dates_com $jobdata $workingCompany_name_cond2  $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond  $cbo_prod_source_cond $booking_no_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no, d.job_no, d.buyer_name, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no,f.result,f.insert_date )
			 union
			 (
			 select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, $group_con2, h.buyer_id as buyer_name,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond and f.batch_id=a.id $dates_com $workingCompany_name_cond2  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.insert_date)  $order_by2";
			}
	}
	if($cbo_type==2) // Batch Wise --Dyeing Production
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//echo $sql;
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon;
			$sql_subcon_data=sql_select($sql_subcon);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) //Batch Aganist - Sample
		{
			//echo $sql_sam;
			$batchdata_sam=sql_select($sql_sam);
		}
	//print_r($sql_subcon_data);
	}
	ob_start();
    if($cbo_type==2) //  Batch Wise -- Dyeing Production
	{
		?>
		<div>
		<fieldset style="width:1350px;">
		<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Batch Wise Dyeing Production </strong><br>
		<?
			//echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
			echo  ($date_from == '0000-00-00' || $date_from == '' ? '' : change_date_format($date_from)).' To ';echo  ($date_to == '0000-00-00' || $date_to == '' ? '' : change_date_format($date_to));
			?>
		 </div>
		 <?
		 if ($cbo_result_name==1 || $cbo_result_name==0)
		 {
		 ?>
		 <div style="margin-left:-1300px">
         <table cellpadding="0"  width="300" cellspacing="0"   class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="3">Production Summary</th>
								</tr>
								<tr>
									<th>Details </th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
							 $sql="select f.load_unload_id,f.process_end_date,count(f.process_end_date) as row_count, SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $prod_date_upto $jobdata $batch_num $buyerdata $order_no $year_cond $workingCompany_name_cond2 $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond GROUP BY f.load_unload_id,f.process_end_date  ";
							$sql_datas=sql_select($sql);
							}
							$unload_qty_arr=array();$plan_cycle_time=0;
							foreach($sql_datas as $row)
							{
								$tot_row=count($row[csf('process_end_date')]);
								$unload_qty_arr[$row[csf('load_unload_id')]]['qty']+=$row[csf('batch_qnty')];
								$unload_qty_arr[$row[csf('load_unload_id')]]['count']+=$tot_row;
							}
							//print_r($unload_qty_arr);
							$total_current_mon_qty=$unload_qty_arr[2]['qty'];
							$total_count=$unload_qty_arr[2]['count'];

							 $sql_result="select f.fabric_type,f.process_end_date,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  and f.fabric_type in(1,4,5,6) $dates_com $workingCompany_name_cond2 $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $booking_no_cond  $cbo_prod_source_cond GROUP BY f.fabric_type,f.process_end_date  ";
							$sql_result=sql_select($sql_result);
							$fabric_batch_arr=array();
							foreach($sql_result as $row)
							{
								$fabric_batch_arr[$row[csf('fabric_type')]]['qty']+=$row[csf('batch_qnty')];
								//$tot_batch_qty+=$row[csf('batch_qnty')];
							}
							//print_r($fabric_batch_arr);

								?>
								  <tr bgcolor="#E9F3FF" style="cursor:pointer;">

									  <td>Current Month</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty,2);?></td>
									  <td align="right"><?  ?></td>
								  </tr>
                                  <tr bgcolor="#D8D8D8" style="cursor:pointer;">

									  <td>Avg. Prod. Per Day</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty/$total_count,2); ?></td>
									  <td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
								  </tr>
                                  <? $k=1;	$tot_batch_qty=0;
								 //$fabric_type_for_dyeing2=array(1=>'Cotton',2=>'Polyster',3=>'Lycra',4=>'Both Part',5=>'White',6=>'Wash');

								  //print_r($fabric_type_for_dyeingnn);
								  foreach($fabric_batch_arr as $typekey=>$val)
								  	{
										if ($k%2==0) $bgcolor="#FFFFFF"; else $bgcolor="#E9F3FF";
										if($typekey==1)
										{
											$fab_type="Cotton";
										}
										else if($typekey==2)
										{
											$fab_type="Polyster";
										}
										else if($typekey==3)
										{
											$fab_type="Lycra";
										}
										else if($typekey==4)
										{
											$fab_type="Both Part";
										}
										else if($typekey==5)
										{
											$fab_type="White";
										}
										else if($typekey==6)
										{
											$fab_type="Wash";
										}
											  ?>
                                   <tr bgcolor="<? echo $bgcolor;?>">
									 <? //print_r($fabric_type_for_dyeing);?>
									  <td><?php echo $fab_type; //$fabric_type_for_dyeing[$typekey];   ?></td>
                                       <td align="right"><? echo number_format($val['qty'],2); ?></td>
									  <td align="right"><? echo number_format(($val['qty']/$total_current_mon_qty)*100,2); ?></td>
								  </tr>
							<? 		$tot_batch_qty+=$val['qty'];
								  	$k++;
									}

							?>
							</tbody>
							<tfoot>
								<tr>
									<th align="right">Total </th>
									<th align="right"><b><? echo number_format($tot_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format(($tot_batch_qty/$total_current_mon_qty*100),2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>


		 </div>
		 <br />
		 <?
		}

		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		 {
			if (count($batchdata)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left">

			<b>Self batch  </b>
			 <table class="rpt_table" width="2270" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_header_1">

                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg;?></th>

                       <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="60">File No</th>
                        <th width="70">Ref. No</th>
                        <th width="100">Buyer</th>
                        <th width="80">Job</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/Width Type</th>
                        <th width="80">Color Name</th>
                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Fabric Wgt.</th>
                        <th width="70">Trims Wgt.</th>
                        <th width="70">Batch Wgt.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
                        <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab. Type</th>
                        <th width="100">Result</th>
                        <th width="">Remark</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2290; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body" width="2270" cellpadding="0" cellspacing="0" border="1" rules="all">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$total_water_cons_load=0;$total_water_cons_unload=0;$tot_batch_wgt=0;
                $batch_chk_arr=array(); $group_by_arr=array();$tot_trims_qnty=0;$trims_check_array=array();
                foreach($batchdata as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($date_search_type==1)
					{
						$date_type_cond=$batch[csf('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[csf('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}

					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="60">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($fab_weight,2); ?></td>
                                    <td width="70"><? echo number_format($tot_trim_qty2,2); ?></td>
                                    <td width="70"><? echo number_format($fab_weight+$tot_trim_qty2,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="50">&nbsp;</td>
                                    <td width="60"><? //echo $total_water_cons_load;?></td>

                                    <td width="70"><? //echo number_format($btq,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($fab_weight);
								unset($tot_trim_qty2);
								unset($tot_batch_wgt);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="31" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}


					$order_id=$batch[csf('po_id')];

					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$load_hour_meter=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					//$desc=explode(",",$batch[csf('item_description')]);
					$desc=implode(",",array_unique(explode(",",$batch[csf('item_description')])));
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
					$grouping=implode(",",array_unique(explode(",",$batch[csf('grouping')])));
					$width_dia_type=array_unique(explode(",",$batch[csf('width_dia_type')]));
					$dia_width_arr='';$dia_width_ids='';
					foreach($width_dia_type as $dtype)
					{
						if($dia_width_arr=='') $dia_width_arr=$fabric_typee[$dtype];else $dia_width_arr.=','.$fabric_typee[$dtype];
						if($dia_width_ids=='') $dia_width_ids=$dtype;else $dia_width_ids.=','.$dtype;
					}
					// $fabric_typee

					$batch_id=$batch[csf('id')];
				if (!in_array($batch_id,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_id;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}

					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($date_type_cond); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td align="center" width="60"><div style="width:60px; word-wrap:break-word;"><? echo $file_no; ?></div></td>
                        <td align="center" width="70"><div style="width:70px; word-wrap:break-word;"><? echo $grouping; ?></div></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
                        <td width="80"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
                        <td width="90"><div style="width:90px; word-wrap:break-word;"><? echo $po_number; ?></div></td>
                        <td width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $dia_width_ids; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a></div></td>
                        <td width="70"><p><? echo $dia_width_arr; ?></p></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_weight')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>

                       <td align="right" width="70"><?

					   echo number_format($batch[csf('batch_weight')]+$tot_trim_qty,2);  ?></td>

                        <td width="60" align="right"><p><? echo number_format($load_hour_meter,2);  ?></p></td>
                        <td width="60" align="right"><p><? echo number_format($batch[csf('hour_unload_meter')],2);  ?></p></td>
                       <td width="60" align="right" ><p><? echo number_format($batch[csf('hour_unload_meter')]-$load_hour_meter,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" title="<? echo "Water Cons Unload-Water Cons Load*1000/Batch Qnty"?>" ><? echo number_format((($water_cons_unload-$water_cons_load)*1000)/$batch[csf('batch_qnty')],2);//number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                        <td align="center" width="100"><p><?
						if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td align="center" width="100"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty+=$batch[csf('batch_qnty')];
					$fab_weight+=$batch[csf('batch_weight')];
					$tot_trim_qty2+=$tot_trim_qty;
					$total_water_cons_load+=$water_cons_load;
					$total_water_cons_unload+=$water_cons_unload;
					$tot_trims_qnty+=$tot_trim_qty;
					$tot_batch_wgt+=$batch[csf('batch_weight')]+$tot_trim_qty;
					$grand_total_batch_qty+=$batch[csf('batch_weight')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <td width="30">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                     <? if($group_by==2 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } if($group_by==1 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                    <td width="60">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="90">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                     <td width="70"><? echo number_format($fab_weight,2); ?></td>
                    <td width="70"><? echo number_format($tot_trim_qty2,2); ?></td>

                    <td width="70"><? echo number_format($fab_weight+$tot_trim_qty2,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="50">&nbsp;</td>
                    <td width="60"><? //echo $total_water_cons_load;?></td>

                    <td width="70"><? //echo number_format($btq,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                     <td width="100">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>&nbsp;</strong></th>
                    <th width="70"><? //echo number_format($tot_trims_qnty,2); ?></th>
                    <th width="70"><? //echo number_format($tot_trims_qnty,2); ?></th>
                    <th colspan="14">&nbsp; </th>

                </tr>

                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80"><? //echo $total_water_cons_load;?></th>
                    <th width="130" colspan="2"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($fab_weight,2);?></th>
                    <th width="70"><? echo number_format($tot_trims_qnty,2);//number_format($grand_total_batch_qty,2); ?></th>

                     <th width="70"><? echo number_format($grand_total_batch_qty,2); ?></th>

                    <th colspan="13" align="left"> </th>

                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			if(count($sql_subcon_data)>0)
			{
		?>
		 <div align="left">
		  <div align="left"><b> Subcon batch</b> </div>
		 <table class="rpt_table" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_2">
				<thead>
					<tr>
						<th width="30">SL</th>
						<th width="80"><? echo $date_type_msg;?></th>
						<th width="80">M/C No</th>
						<th width="80">Floor</th>
						<th width="80">Shift Name</th>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70">Dia/Width Type</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="40">Extn. No</th>
						<th width="70">Dyeing Qty.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
						<th width="60">Total Time</th>
						<th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


						<th width="75">Load Date & Time</th>
						<th width="75">UnLoad Date Time</th>

                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab Type</th>
						<th>Result</th>
					</tr>
				</thead>
		</table>
		<div style=" max-height:350px; width:1910px; overflow-y:scroll;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
		<tbody>
					<?
					$i=1;
					$btq=0;$trims_btq_sub=0;
					$batch_chk_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($i%2==0)
					$bgcolor_sub2="#E9F3FF";
					else
					$bgcolor_sub2="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$batch_weight_sub=$batch[csf('batch_weight')];
					$water_cons_unload_sub=$batch[csf('water_flow_meter')];
					$water_cons_load_sub=$subcon_water_flow_arr[$batch[csf('id')]];
					$load_hour_meter_sub=$subcon_load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff_sub=($water_cons_unload_sub-$water_cons_load_sub)/$batch_weight_sub*1000;
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$width_dia_type=array_unique(explode(",",$batch[csf('width_dia_type')]));
					$dia_width_arr='';
					foreach($width_dia_type as $dtype)
					{
						if($dia_width_arr=='') $dia_width_arr=$fabric_typee[$dtype];else $dia_width_arr.=','.$fabric_typee[$dtype];
					}
					//echo $load_hr[$batch[csf('id')]].'ddddd';
					//echo $batch[csf('id')];
					?>
					<tr bgcolor="<? echo $bgcolor_sub2; ?>" id="trsub_<? echo $i; ?>" onClick="change_color('trsub_<? echo $i; ?>','<? echo $bgcolor; ?>')">
						<td width="30"><? echo $i; ?></td>
						<td width="80"><p><? echo ($batch[csf('production_date')] == '0000-00-00' || $batch[csf('production_date')] == '' ? '' : change_date_format($batch[csf('production_date')])); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
						<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $floor_arr[$batch[csf('floor_id')]];  ?>"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $shift_name[$batch[csf('shift_name')]];  ?>"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
						<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? echo  $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td  width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
						<td  width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $batch[csf('width_dia_type')]; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a><? //echo $batch[csf('item_description')]; ?></div></td>
						<td  width="70" title="<? echo  $dia_width_arr; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>

                          <td width="60" align="right"><p><? echo $load_hour_meter_sub;  ?></p></td>
                           <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')];  ?></p></td>
                          <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')]-$load_hour_meter_sub;  ?></p></td>
						<td align="left" width="50" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60"><p><? echo $water_cons_load_sub;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload_sub;  ?></p></td>

                        <td align="right" width="70" title="<? echo number_format($water_cons_diff_sub,2);  ?>"><? echo number_format($water_cons_diff_sub,2);  ?></td>


						<td width="75" title="<?  $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];  echo ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).'  & '.$sub_load_t; ?>"><p><?   $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]]; echo  ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).' <br> '.$sub_load_t;
						 ?></p></td>
						<td width="75" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; // $unloadd=change_date_format($batch[csf('process_end_date')]).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
						<td align="center" width="60">
					   <?
					$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
					$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$sub_load_t.':'.'00');
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
					//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
							?>
						 </td>
                         <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						 echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
						<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
					</tr>
		<?
		$i++;
		$btq_sub+=$batch[csf('sub_batch_qnty')];
		$trims_btq_sub+=$batch[csf('total_trims_weight')];
		} //batchdata froeach
		 ?>
			</tbody>
		</table>
		<table class="rpt_table" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
				<thead>

                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="40">Total Trims</th>
						<th width="70"><? echo number_format($trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="40">Grand Total</th>
						<th width="70"><? echo number_format($btq_sub+$trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						 <th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
		</table>
		</div>
		</div>
		<?
		}
		} // Sub Cond End

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
		{
			if (count($batchdata_sam)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <style type="text/css">
				table tr th, table tr td{word-wrap: break-word;word-break: break-all;}
			</style>
			 <div style="width: 2290px;" align="left">
			 <div> <b>Sample Dyeing Production </b></div>
			 <table class="rpt_table" width="2270" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_3">
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg;?></th>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <th width="80">M/C No</th>
                        <? }
						?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="70">File No</th>
                        <th width="80">Ref. No</th>
                        <th width="100">Buyer</th>

                        <th width="80">Job</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/ Width Type</th>
                        <th width="80">Color Name</th>

                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Qty.</th>

                        <th width="60">Hour Load Meter</th>
 						<th width="60">Hour unLoad Meter</th>
                         <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fabrics<br>Type</th>
                        <th width="100">Result</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2290; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body3" width="2270" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$grand_total_batch_qty_sam=0;$batch_qnty_sam=0;$total_trim_qty=0;
                $batch_chk_arr=array(); $group_by_arr=array();$trims_check_array=array();
                foreach($batchdata_sam as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                     <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                    				<td width="80">&nbsp;</td>
                                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60"><? //echo number_format($btq,2); ?></td>
                                    <td width="50">&nbsp;</td>
                                     <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                     <td width="70"><? //echo number_format($btq,2); ?></td>

                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td>&nbsp;r</td>
                                </tr>
								<?
								unset($batch_qnty_sam);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="28" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}
					$order_id=$batch[csf('po_id')];
					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$hour_meter_load=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$batch_id=$batch[csf('id')];
				if (!in_array($batch_id,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_id;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
                          <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <? } if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td width="70"><p><? echo $batch[csf('file_no')]; ?></p></td>
                        <td width="80"><p><? echo $batch[csf('grouping')]; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>

                        <td width="80"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
                        <td width="90"><p><? echo $po_number; ?></p></td>
                        <td width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $batch[csf('width_dia_type')]; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a><? //echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><div style="width:70px; word-wrap:break-word;"><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></div></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>
                        <td width="60"><p><? echo number_format($hour_meter_load,2);  ?></p></td>
                        <td width="60"><p><? echo number_format($batch[csf('hour_unload_meter')],2);  ?></p></td>

                        <td width="60"><p><? echo number_format($batch[csf('hour_unload_meter')]-$hour_meter_load,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                         <td width="60"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" ><? echo number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                          <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						  echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td width="100" align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center" title="<?  echo $batch[csf('remarks')];   ?>"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty_sam+=$batch[csf('batch_qnty')];
					$total_trim_qty+=$tot_trim_qty;
					$grand_total_batch_qty_sam+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                     <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>Sub. Total : </strong></th>
                    <th width="70"><? echo number_format($batch_qnty_sam,2); ?></th>
                  	<th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                     <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                     <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty_sam,2); ?></th>
                    <th width="60"><? echo number_format($total_trim_qty,2);?></th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                   <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
			?>


            <?
		}
		?>
		</fieldset>
		</div>
		<?
		} //Dyeing Production End

	/*foreach (glob("$user_id*.xls") as $filename)
		{

			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		//$filename=$user_id."_".$name.".xls";
		echo "$total_data****$filename";*/
		exit();
}

else if($action=="dyeing_production_report6") //batchWise 2
{
	// $process = array( &$_POST );
	// extract(check_magic_quote_gpc( $process ));
	extract($_REQUEST);
	if($db_type==0) $year_field_by="and YEAR(a.insert_date)";
	else if($db_type==2) $year_field_by=" and to_char(a.insert_date,'YYYY')";
	if($db_type==0) $field_concat="concat(machine_no,'-',brand) as machine_name";
	else if($db_type==2) $field_concat="machine_no || '-' || brand as machine_name";
	// machine_no || '-' || brand as machine_name
	$company = str_replace("'","",$cbo_company_name);
	
	$working_company = str_replace("'","",$cbo_working_company_name);
	
	$buyer = str_replace("'","",$cbo_buyer_name);
	$cbo_prod_type = str_replace("'","",$cbo_prod_type);
	$cbo_party_id = str_replace("'","",$cbo_party_id);

	$date_search_type = str_replace("'","",$search_type);
	$job_number = str_replace("'","",$job_number);
	$job_number_id = str_replace("'","",$job_number_show);
	$batch_no = str_replace("'","",$batch_number_show);
	$color = str_replace("'","",$txt_color);
	$machine=str_replace("'","",$txt_machine_id);
	$floor_name=str_replace("'","",$cbo_floor_id);
	$hide_booking_id = str_replace("'","",$txt_hide_booking_id);
	$txt_booking_no = str_replace("'","",$txt_booking_no);

	if ($txt_booking_no!='') $booking_no_cond="  and a.booking_no LIKE '%$txt_booking_no%'"; else $booking_no_cond="";
	if ($hide_booking_id!='') $booking_no_cond.="  and a.booking_no_id in($hide_booking_id) "; else $booking_no_cond.="";


	//echo $company;die;
	$batch_number_hidden = str_replace("'","",$batch_number);
	$ext_num = str_replace("'","",$txt_ext_no);
	$hidden_ext = str_replace("'","",$hidden_ext_no);
	$txt_order = str_replace("'","",$order_no);
	$file_no = str_replace("'","",$file_no);
	$ref_no = str_replace("'","",$ref_no);
	$hidden_order = str_replace("'","",$hidden_order_no);
	$cbo_type = str_replace("'","",$cbo_type);
	$cbo_result_name = str_replace("'","",$cbo_result_name);
	$year = str_replace("'","",$cbo_year);
	$shift = str_replace("'","",$cbo_shift_name);
	//echo $cbo_type;die;
	$txt_date_from = str_replace("'","",$txt_date_from);
	$txt_date_to = str_replace("'","",$txt_date_to);

	if ($cbo_prod_type>0 && $cbo_party_id>0) $cbo_prod_type_cond="and f.service_company in($cbo_party_id) "; else $cbo_prod_type_cond="";
	if ($cbo_prod_type>0) $cbo_prod_source_cond="and f.service_source in($cbo_prod_type) "; else $cbo_prod_source_cond="";

	if ($buyer==0) $sub_buyer_cond=""; else $sub_buyer_cond="  and d.party_id='".$buyer."' ";
	if ($cbo_result_name==0) $result_name_cond=""; else $result_name_cond="  and f.result='".$cbo_result_name."' ";
	if ($shift==0) $shift_name_cond=""; else $shift_name_cond="  and f.shift_name='".$shift."' ";
	if ($machine=="") $machine_cond=""; else $machine_cond =" and f.machine_id in ( $machine ) ";
	if ($floor_name==0 || $floor_name=='') $floor_id_cond=""; else $floor_id_cond=" and f.floor_id=$floor_name";

	if ($buyer==0) $buyerdata=""; else $buyerdata="  and d.buyer_name='".$buyer."' ";
	if ($buyer==0) $buyerdata2=""; else $buyerdata2="  and h.buyer_id='".$buyer."' ";
	if ($batch_no=="") $batch_num=""; else $batch_num="  and a.batch_no='".trim($batch_no)."' ";

	if ($batch_no=="") $unload_batch_cond=""; else $unload_batch_cond="  and batch_no='".trim($batch_no)."' ";
	if ($batch_no=="") $unload_batch_cond2=""; else $unload_batch_cond2="  and f.batch_no='".trim($batch_no)."' ";
	if ($working_company==0) $workingCompany_name_cond2=""; else $workingCompany_name_cond2="  and a.working_company_id='".$working_company."' ";
	if ($company==0) $companyCond=""; else $companyCond="  and a.company_id=$company";


	//$buyerdata=($buyer)?' and d.buyer_name='.$buyer : '';
	//$batch_num=($batch_no)?" and a.batch_no='".$batch_no."'" : '';

	//echo $cbo_batch_type;
	if(trim($ext_no)!="") $ext_no_search="%".trim($ext_no)."%"; else $ext_no_search="%%";
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if ($txt_order!='') $suborder_no="and c.order_no='$txt_order'"; else $suborder_no="";
		if ($job_number_id!='') $sub_job_cond="  and d.job_no_prefix_num='".$job_number_id."' "; else $sub_job_cond="";
	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
	{
	if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
	if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
	if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}
	if ($color=="") $color_name=""; else $color_name="  and g.color_name='$color'";
	//echo $order_no;die;
	if ($ext_num=="") $ext_no=""; else $ext_no="  and a.extention_no=$ext_num ";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	//echo date("Y-n-j", strtotime("first day of previous month"));
	//echo date("Y-n-j", strtotime("last day of previous month"));
	if($txt_date_from && $txt_date_to)
	{
		if($db_type==0)
		{

			$date_from=change_date_format($txt_date_from,'yyyy-mm-dd');
			$date_to=change_date_format($txt_date_to,'yyyy-mm-dd');
			$second_month_ldate=date("Y-m-t",strtotime($date_to));
			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-m',strtotime($date_to));
			$prod_last_day=change_date_format($second_month_ldate,'yyyy-mm-dd');
			//$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			$prod_date_upto=" and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day' ";
			if($date_search_type==1)
			{
				$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 23:59:59' ";
			}

		}
		elseif($db_type==2)
		{

			$date_from=change_date_format($txt_date_from,'','',1);
			$date_to=change_date_format($txt_date_to,'','',1);
			$dateFrom= explode("-",$date_from);
			//echo $dateto[1];
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$prod_date_to=change_date_format($today_date,'','',1);
			$second_month_ldate=date("Y-M-t",strtotime($date_to));
			//$last_day= date("t", strtotime($date_to));
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-M',strtotime($date_to));
		    $prod_last_day=change_date_format($second_month_ldate,'','',1);
			//$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			$prod_date_upto="and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day'";
			if($date_search_type==1)
			{
				$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 11:59:59 PM' ";
			}
		}
	}
			if($date_search_type==1)
			{
				$date_type_msg="Dyeing Date";
			}
			else
			{
				$date_type_msg="Insert Date";
			}

	$yarn_lot_arr=array();
	if($db_type==0)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!=''  group by a.prod_id, b.po_breakdown_id");
	}
	else if($db_type==2)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)  as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' group by a.prod_id, b.po_breakdown_id");
	}
	foreach($yarn_lot_data as $rows)
	{
		$yarn_lot=explode(",",$rows[csf('yarn_lot')]);
		$yarn_lot_arr[$rows['prod_id']][$rows['po_breakdown_id']]=implode(",",array_unique($yarn_lot));
	}
		//print_r($yarn_lot_arr);
	$load_hr=array();
	$load_min=array();
	$load_date=array();
	$water_flow_arr=array();$load_hour_meter_arr=array();
	if ($working_company==0) $workingCompany_name_cond1=""; else $workingCompany_name_cond1="  and service_company='".$working_company."' ";
  	if ($company==0) $companyCond1=""; else $companyCond1="  and company_id=$company";
	$load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=35 $companyCond1 $unload_batch_cond $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($load_time_data as $row_time)// for Loading time
	{
		$load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_load_hr=array();
	$subcon_load_min=array();
	$subcon_load_date=array();$subcon_load_hour_meter_arr=array();
	$subcon_water_flow_arr=array();
	$subcon_load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=38 $companyCond1 $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
		$subcon_load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$subcon_load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$subcon_load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$subcon_water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$subcon_load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_unload_hr=array();
	$subcon_unload_min=array();
	$subcon_unload_date=array();
	$subcon_unload_time_data=sql_select("select batch_id,batch_no,load_unload_id,production_date,end_hours,end_minutes from pro_fab_subprocess where load_unload_id=2 and entry_form=38 $companyCond1 $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
	$subcon_unload_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
	$subcon_unload_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
	$subcon_unload_time_data[$row_time[csf('batch_id')]]=$row_time[csf('production_date')];
	}
	//var_dump($load_hr);

	$m_capacity=array();
	$unload_min=array();
	$machine_arr=return_library_array( "select id,$field_concat from  lib_machine_name order by seq_no ",'id','machine_name');
	$machine_capacity_data=sql_select("select id,prod_capacity as m_capacity  from lib_machine_name where status_active=1  and is_deleted=0 ");
	foreach($machine_capacity_data as $capacity)// for Un-Loading time
	{
		$m_capacity[$capacity[csf('id')]]=$capacity[csf('m_capacity')];
	}

	$sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=35 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0  $unload_batch_cond2 $dates_com ");
	$tot_row=1;
	foreach($sql_batch_id as $row_batch)
	{
		if($tot_row!=1) $batch_id.=",";
		$batch_id.=$row_batch[csf('batch_id')];

		$tot_row++;
	}//echo $batch_id;die;
		unset($sql_batch_id);
		$batchIds=chop($batch_id,','); $batchIds_cond="";
		if($db_type==2 && count($tot_row)>990)
		{
			$batchIds_cond=" and (";
			$batchIdsArr=array_chunk(explode(",",$batchIds),990);
			foreach($batchIdsArr as $ids)
			{
				$ids=implode(",",$ids);
				$batchIds_cond.=" a.id not in($ids) or ";
			}
			$batchIds_cond=chop($batchIds_cond,'or ');
			$batchIds_cond.=")";
		}
		else
		{
			$batchIds_cond=" and a.id not in($batchIds)";
		}
		//echo $batchIds_cond;
	$sub_sql_batch_id=sql_select("select batch_id from  pro_fab_subprocess where entry_form=38 and load_unload_id=2 and status_active=1 and is_deleted=0");
	$k=1;
	foreach($sub_sql_batch_id as $row_batch)
	{
		if($k!=1) $sub_batch_id.=",";
		$sub_batch_id.=$row_batch[csf('batch_id')];

		$k++;
	}
	if($batch_id=="") $batch_id=0;
	if($sub_batch_id=="") $sub_batch_id=0;
	$group_by=str_replace("'",'',$cbo_group_by);
	if($group_by==1)
	{
		$order_by="order by f.floor_id";
		$order_by2="order by floor_id";
	}
	else if($group_by==2)
	{
		$order_by="order by f.shift_name";
		$order_b2y="order by shift_name";
	}
	else if($group_by==3)
	{
		$order_by="order by f.machine_id";
		$order_by2="order by machine_id";
	}
	else
	{
		$order_by="order by f.process_end_date,f.machine_id";
		$order_by2="order by process_end_date,machine_id";
	}
	if($cbo_type==2) //Dyeing Report.....
	{
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{ //c.grouping,c.file_no,
			if($db_type==2) $grp_con="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no";
			else if($db_type==0) $grp_con="group_concat(distinct c.po_number) AS po_number,group_concat(distinct b.po_id) AS po_id,group_concat(distinct c.grouping) AS grouping,group_concat(distinct c.file_no) AS file_no";
			if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description";
			else if($db_type==0) $group_con2="group_concat(b.width_dia_type) AS width_dia_type,group_concat(b.item_description) AS item_description";

		$sql="(select f.insert_date,a.batch_no, a.batch_weight,a.id, a.color_id,a.color_range_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty,$group_con2, $grp_con,d.job_no as job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where f.batch_id=a.id $companyCond  $dates_com $workingCompany_name_cond2 $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $booking_no_cond  $cbo_prod_source_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.color_range_id,a.total_trims_weight, a.extention_no,d.buyer_name,d.job_no, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order,f.insert_date)
			 union
			 (
			 	select f.insert_date, a.batch_no, a.batch_weight,a.id, a.color_id,a.color_range_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,$group_con2, null as po_number, null as po_id,null as grouping, null as file_no,null, h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date,
    f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond and f.batch_id=a.id  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0  $dates_com $workingCompany_name_cond2 $batch_num  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id,a.color_range_id, a.extention_no,
 f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks,f.insert_date
			 ) $order_by2";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2) //Subcontact
			{
				if($db_type==2) $grp_con="LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY b.item_description) AS item_description,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type";
			 else if($db_type==0) $grp_con="group_concat(c.order_no) AS po_number,group_concat(b.item_description) AS item_description,group_concat(b.po_id) AS po_id,group_concat(b.width_dia_type) AS width_dia_type";

				$sql_subcon="select f.insert_date,a.batch_no,a.id, a.batch_weight, a.color_id,a.color_range_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty,$grp_con,d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0  $dates_com $workingCompany_name_cond2 $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $booking_no_cond $cbo_prod_source_cond
				GROUP BY a.batch_no, a.id,a.batch_weight, a.color_id,a.color_range_id, a.extention_no,a.total_trims_weight, d.subcon_job, d.party_id, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result,f.insert_date $order_by";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
				  if($db_type==2) $grp_con="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping";
			 else if($db_type==0) $grp_con="group_concat(distinct b.width_dia_type) AS width_dia_type,group_concat(distinct c.po_number) AS po_number,group_concat(b.item_description) AS item_description,group_concat(b.po_id) AS po_id,group_concat(c.file_no) AS file_no,group_concat(c.grouping) AS grouping";

			 if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,null as po_number, LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description,null as po_id,null as file_no,null as  grouping,null as job_no_prefix_num ";
			else if($db_type==0) $group_con2="group_concat(b.width_dia_type) AS width_dia_type,null as po_number,group_concat(b.item_description) AS item_description,null as po_id,null as file_no,null as grouping,null as job_no_prefix_num";


				 $sql_sam="(select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id,a.color_range_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,$grp_con,d.job_no as job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, fabric_type,f.result from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  $dates_com $jobdata $workingCompany_name_cond2  $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond  $cbo_prod_source_cond $booking_no_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.color_range_id, a.extention_no, d.job_no, d.buyer_name, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no,f.result,f.insert_date )
			 union
			 (
			 select f.insert_date,a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id,a.color_range_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, $group_con2, h.buyer_id as buyer_name,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond and f.batch_id=a.id $dates_com $workingCompany_name_cond2  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id,a.color_range_id, a.extention_no, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.insert_date)  $order_by2";
			}

			

	}
	//echo $sql;
	if($cbo_type==2) // Batch Wise --Dyeing Production
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//echo $sql;
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon;
			$sql_subcon_data=sql_select($sql_subcon);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) //Batch Aganist - Sample
		{
			//echo $sql_sam;
			$batchdata_sam=sql_select($sql_sam);
		}
	//print_r($sql_subcon_data);
	}
	foreach($batchdata as $row)
	{

		$batch_id_arr[$row[csf('id')]] = $row[csf('id')];

	}
	foreach($sql_subcon_data as $row)
	{

		$batch_id_arr[$row[csf('id')]] = $row[csf('id')];

	}
	foreach($batchdata_sam as $row)
	{

		$batch_id_arr[$row[csf('id')]] = $row[csf('id')];

	}
	//echo " SELECT a.id, b.color_range,b.batch_qty from pro_batch_create_mst a, pro_recipe_entry_mst b where a.id = b.batch_id and a.status_active=1 ".where_con_using_array($batch_id_arr,0,'a.id')." ";
	$sql_color=sql_select(" SELECT a.id, b.color_range,b.batch_qty from pro_batch_create_mst a, pro_recipe_entry_mst b where a.id = b.batch_id and a.status_active=1 and a.is_deleted=0 and b.entry_form=59 and b.status_active=1 and b.is_deleted=0 ".where_con_using_array($batch_id_arr,0,'a.id')." ");
	
	$color_range_arr1 = array();
	//$color_range_arr = array();
	foreach($sql_color as $row)
	{
		$color_range_arr1[$row[csf('id')]] = $row[csf('color_range')];
		//$color_range_arr[$row[csf("color_range")]]['batch_qty']+=$row[csf("batch_qty")];
		
	}
	
	unset($sql_color);

	

	//var_dump($color_range_arr);

	ob_start();
    if($cbo_type==2) //  Batch Wise -- Dyeing Production
	{
		?>
		<div>
		<fieldset style="width:1350px;">
		<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Batch Wise Dyeing Production </strong><br>
		<?
			//echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
			echo  ($date_from == '0000-00-00' || $date_from == '' ? '' : change_date_format($date_from)).' To ';echo  ($date_to == '0000-00-00' || $date_to == '' ? '' : change_date_format($date_to));
			?>
		 </div>
		 <div style="padding-bottom:100px;">
		
		 <?
		 if ($cbo_result_name==1 || $cbo_result_name==0)
		 {
		 ?>
		 
		 
		 <!-- <div style="margin-left:-1300px"> -->
		 <div style="float: left; margin-left: 300px;">
		 <table width="370" border="1" cellpadding="0" cellspacing="0" rules="all" class="rpt_table">
         <!-- <table cellpadding="0"  width="300" cellspacing="0"   class="rpt_table" rules="all" border="1"> -->
							<thead>
								<tr>
									<th colspan="3">Production Summary</th>
								</tr>
								<tr>
									<th>Details </th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
							 $sql="select f.load_unload_id,f.process_end_date,count(f.process_end_date) as row_count, SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond  and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  $prod_date_upto $jobdata $batch_num $buyerdata $order_no $year_cond $workingCompany_name_cond2 $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond $booking_no_cond GROUP BY f.load_unload_id,f.process_end_date  ";
							$sql_datas=sql_select($sql);
							}
							$unload_qty_arr=array();$plan_cycle_time=0;
							foreach($sql_datas as $row)
							{
								$tot_row=count($row[csf('process_end_date')]);
								$unload_qty_arr[$row[csf('load_unload_id')]]['qty']+=$row[csf('batch_qnty')];
								$unload_qty_arr[$row[csf('load_unload_id')]]['count']+=$tot_row;
							}
							//print_r($unload_qty_arr);
							$total_current_mon_qty=$unload_qty_arr[2]['qty'];
							$total_count=$unload_qty_arr[2]['count'];

							 $sql_result="select f.fabric_type,f.process_end_date,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0  and f.fabric_type in(1,4,5,6) $dates_com $workingCompany_name_cond2 $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $booking_no_cond  $cbo_prod_source_cond GROUP BY f.fabric_type,f.process_end_date  ";
							$sql_result=sql_select($sql_result);
							$fabric_batch_arr=array();
							foreach($sql_result as $row)
							{
								$fabric_batch_arr[$row[csf('fabric_type')]]['qty']+=$row[csf('batch_qnty')];
								//$tot_batch_qty+=$row[csf('batch_qnty')];
							}
							//print_r($fabric_batch_arr);

								?>
								  <tr bgcolor="#E9F3FF" style="cursor:pointer;">

									  <td>Current Month</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty,2);?></td>
									  <td align="right"><?  ?></td>
								  </tr>
                                  <tr bgcolor="#D8D8D8" style="cursor:pointer;">

									  <td>Avg. Prod. Per Day</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty/$total_count,2); ?></td>
									  <td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
								  </tr>
                                  <? $k=1;	$tot_batch_qty=0;
								 //$fabric_type_for_dyeing2=array(1=>'Cotton',2=>'Polyster',3=>'Lycra',4=>'Both Part',5=>'White',6=>'Wash');

								  //print_r($fabric_type_for_dyeingnn);
								  foreach($fabric_batch_arr as $typekey=>$val)
								  	{
										if ($k%2==0) $bgcolor="#FFFFFF"; else $bgcolor="#E9F3FF";
										if($typekey==1)
										{
											$fab_type="Cotton";
										}
										else if($typekey==2)
										{
											$fab_type="Polyster";
										}
										else if($typekey==3)
										{
											$fab_type="Lycra";
										}
										else if($typekey==4)
										{
											$fab_type="Both Part";
										}
										else if($typekey==5)
										{
											$fab_type="White";
										}
										else if($typekey==6)
										{
											$fab_type="Wash";
										}
											  ?>
                                   <tr bgcolor="<? echo $bgcolor;?>">
									 <? //print_r($fabric_type_for_dyeing);?>
									  <td><?php echo $fab_type; //$fabric_type_for_dyeing[$typekey];   ?></td>
                                       <td align="right"><? echo number_format($val['qty'],2); ?></td>
									  <td align="right"><? echo number_format(($val['qty']/$total_current_mon_qty)*100,2); ?></td>
								  </tr>
							<? 		$tot_batch_qty+=$val['qty'];
								  	$k++;
									}

							?>
							</tbody>
							<tfoot>
								<tr>
									<th align="right">Total </th>
									<th align="right"><b><? echo number_format($tot_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format(($tot_batch_qty/$total_current_mon_qty*100),2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>


		 </div>
		
		 <?
		}

		
		 ?>
		 <!-- <div style="margin-left:-628px; margin-top:-133px"> -->
		 <div style="float: left; margin-left: 20px;">
		 <table width="370" border="1" cellpadding="0" cellspacing="0" rules="all" class="rpt_table">
         <!-- <table cellpadding="0"  width="300" cellspacing="0"   class="rpt_table" rules="all" border="1"> -->
							<thead>
								<tr>
									<th colspan="3">Color Range Wise Production Summary</th>
								</tr>
								<tr>
									<th>Details </th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							// $color_range_arr=array();
							// foreach($color_range_arr1 as $row)
							// {
							// 	$color_range_arr[$row[csf("id")]]['batch_qnty']+=$row[csf("batch_qnty")];
								
							// }

							// foreach($sql_subcon_data as $row)
							// {
							// 	$color_range_arr[$row[csf("color_range_id")]]['batch_qnty']+=$row[csf("sub_batch_qnty")];
								
							// }

							// foreach($batchdata_sam as $row)
							// {
							// 	$color_range_arr[$row[csf("color_range_id")]]['batch_qnty']+=$row[csf("batch_qnty")];
								
							// }

							$color_range_arr=array();
							$color_range_id;
							
							foreach($batchdata as $row)
							{
								$color_range_id = $color_range_arr1[$row[csf('id')]]; 
								$color_range_arr[$color_range_id]['batch_qnty']+=$row[csf("batch_qnty")];
							}

							foreach($sql_subcon_data as $row)
							{								
								$color_range_id = $color_range_arr[$row[csf('id')]]; 
								$color_range_arr[$color_range_id]['batch_qnty']+=$row[csf("batch_qnty")];						
							}

							foreach($batchdata_sam as $row)
							{								
								$color_range_id = $color_range_arr[$row[csf('id')]]; 
								$color_range_arr[$color_range_id]['batch_qnty']+=$row[csf("batch_qnty")];						
							}
							
								$total_color_batch_qty = 0;
								$total_color_batch_qty_percentage =0;

								foreach ($color_range_arr as $color_id => $color_data) {
									
									foreach ($color_data as $batch_id => $batch_data) {

										$total_color_batch_qty_percentage+=$batch_data;
									
									}
								}
								$j=1;
								foreach ($color_range_arr as $color_id => $color_data) {

									foreach ($color_data as $batch_id => $batch_data) {

										if ($j%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
										
										$total_color_batch_qty+=$batch_data;
                            		?>
									 <tr bgcolor="<? echo $bgcolor;  ?>" >
										
										<td width="150">
										<? echo $color_range[$color_id] ; ?>
										</td>
										<td width="100" align="right" ><? echo number_format($batch_data,2,'.',','); ?></td>
										<td align="right" >
										<?
											 
										$colorrangedata = ($batch_data/$total_color_batch_qty_percentage)*100;
										echo number_format($colorrangedata,2);
									
										 ?>
										
										</td>
									</tr>
									<?
									$j++;
									$colorrangetotpercen +=$colorrangedata;
									
									}
									
								
								}
							
							
							?>
							
							</tbody>
							<tfoot>
								<tr>
									<th align="right">Total </th>
									<th align="right"><b><? echo number_format($total_color_batch_qty,2,'.',''); ?></b> </th>
									<th align="right"><? echo number_format($colorrangetotpercen,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>


		 </div>
	

		 <!-- <div style="margin-left:30px; margin-top:-133px">
         <table cellpadding="0"  width="300" cellspacing="0"   class="rpt_table" rules="all" border="1"> -->
		 <div style="float: left; margin-left: 20px;">
            <table width="370" border="1" cellpadding="0" cellspacing="0" rules="all" class="rpt_table">
							<thead>
								<tr>
									<th colspan="3">Buyer Wise Production Summary</th>
								</tr>
								<tr>
									<th>Details </th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							$buyer_wise_arr=array();
							foreach($batchdata as $row)
							{
								$buyer_wise_arr[$row[csf("buyer_name")]]['batch_qnty']+=$row[csf("batch_qnty")];
								
							}

							foreach($sql_subcon_data as $row)
							{
								$buyer_wise_arr[$row[csf("buyer_name")]]['batch_qnty']+=$row[csf("sub_batch_qnty")];
								
							}

							foreach($batchdata_sam as $row)
							{
								$buyer_wise_arr[$row[csf("buyer_name")]]['batch_qnty']+=$row[csf("batch_qnty")];
								
							}
							
								$total_buyer_batch_qty = 0;
								$total_buyer_batch_qty_percentage =0;

								foreach ($buyer_wise_arr as $buyer_id => $buyer_data) {
									
									foreach ($buyer_data as $batch_id => $batch_data) {

										$total_buyer_batch_qty_percentage+=$batch_data;
									
									}
								}
								$j=1;
								foreach ($buyer_wise_arr as $buyer_id => $buyer_data) {

									foreach ($buyer_data as $batch_id => $batch_data) {
										if ($j%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
										$total_buyer_batch_qty+=$batch_data;
										
                            		?>
									 <tr bgcolor="<? echo $bgcolor;  ?>" >
										
										<td width="150"><? echo $buyer_arr[$buyer_id]; ?></td>
										<td width="100" align="right" ><? echo number_format($batch_data,2,'.',','); ?></td>
										<td align="right" >
										<?
											 
											$buyerdata = ($batch_data/$total_buyer_batch_qty_percentage)*100;
										echo number_format($buyerdata,2);
									
										 ?>
										
										</td>
									</tr>
									<?
									$j++;
									$buyertotalpercen +=$buyerdata;
									
									}
									
								
								}
							
							
							?>
							
							</tbody>
							<tfoot>
								<tr>
									<th align="right">Total </th>
									<th align="right"><b><? echo number_format($total_buyer_batch_qty,2,'.',''); ?></b> </th>
									<th align="right"><? echo number_format($buyertotalpercen,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>


		 </div>
		 <br />
		</div>
		
		 <?
		

		

		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		 {
			if (count($batchdata)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			
			<div align="left" style="margin-top:145px; padding-top:20px">
			<br /> <br /> <br /> <br /> <br />
			<b>Self batch  </b>
			 <table class="rpt_table" width="2350" cellpadding="0" cellspacing="0" border="1" rules="all" id="table_header_1">
			
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg;?></th>

                       <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="60">File No</th>
                        <th width="70">Ref. No</th>
                        <th width="100">Buyer</th>
                        <th width="80">Job</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/Width Type</th>
						<th width="80">Color Range</th>
                        <th width="80">Color Name</th>
                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Fabric Wgt.</th>
                        <th width="70">Trims Wgt.</th>
                        <th width="70">Batch Wgt.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
                        <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab. Type</th>
                        <th width="100">Result</th>
                        <th width="">Remark</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2370; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body" width="2350" cellpadding="0" cellspacing="0" border="1" rules="all">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$total_water_cons_load=0;$total_water_cons_unload=0;$tot_batch_wgt=0;
                $batch_chk_arr=array(); $group_by_arr=array();$tot_trims_qnty=0;$trims_check_array=array();
                foreach($batchdata as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($date_search_type==1)
					{
						$date_type_cond=$batch[csf('production_date')];//Dyeing Date
					}
					else
					{
						$date_typecond=explode(" ",$batch[csf('insert_date')]);//Insert Date
						$date_type_cond=$date_typecond[0];
					}

					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>

                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="60">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                   
                                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($fab_weight,2); ?></td>
                                    <td width="70"><? echo number_format($tot_trim_qty2,2); ?></td>
                                    <td width="70"><? echo number_format($fab_weight+$tot_trim_qty2,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="50">&nbsp;</td>
                                    <td width="60"><? //echo $total_water_cons_load;?></td>

                                    <td width="70"><? //echo number_format($btq,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($fab_weight);
								unset($tot_trim_qty2);
								unset($tot_batch_wgt);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="31" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}


					$order_id=$batch[csf('po_id')];

					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$load_hour_meter=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					//$desc=explode(",",$batch[csf('item_description')]);
					$desc=implode(",",array_unique(explode(",",$batch[csf('item_description')])));
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
					$grouping=implode(",",array_unique(explode(",",$batch[csf('grouping')])));
					$width_dia_type=array_unique(explode(",",$batch[csf('width_dia_type')]));
					$dia_width_arr='';$dia_width_ids='';
					foreach($width_dia_type as $dtype)
					{
						if($dia_width_arr=='') $dia_width_arr=$fabric_typee[$dtype];else $dia_width_arr.=','.$fabric_typee[$dtype];
						if($dia_width_ids=='') $dia_width_ids=$dtype;else $dia_width_ids.=','.$dtype;
					}
					// $fabric_typee

					$batch_id=$batch[csf('id')];
				if (!in_array($batch_id,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_id;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}

					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($date_type_cond); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td align="center" width="60"><div style="width:60px; word-wrap:break-word;"><? echo $file_no; ?></div></td>
                        <td align="center" width="70"><div style="width:70px; word-wrap:break-word;"><? echo $grouping; ?></div></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
                        <td width="80"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
                        <td width="90"><div style="width:90px; word-wrap:break-word;"><? echo $po_number; ?></div></td>
                        <td width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $dia_width_ids; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a></div></td>
                        <td width="70"><p><? echo $dia_width_arr; ?></p></td>
						<td width="80" ><p><? echo $color_range[$color_range_arr1[$batch[csf('id')]]]; ?></p></td>
						<!-- <td width="80" ><p><? //echo $color_range[$batch[csf('color_range_id')]]; ?></p></td> -->
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_weight')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>

                       <td align="right" width="70"><?

					   echo number_format($batch[csf('batch_weight')]+$tot_trim_qty,2);  ?></td>

                        <td width="60" align="right"><p><? echo number_format($load_hour_meter,2);  ?></p></td>
                        <td width="60" align="right"><p><? echo number_format($batch[csf('hour_unload_meter')],2);  ?></p></td>
                       <td width="60" align="right" ><p><? echo number_format($batch[csf('hour_unload_meter')]-$load_hour_meter,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60" align="right"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" title="<? echo "Water Cons Unload-Water Cons Load*1000/Batch Qnty"?>" ><? echo number_format((($water_cons_unload-$water_cons_load)*1000)/$batch[csf('batch_qnty')],2);//number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                        <td align="center" width="100"><p><?
						if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td align="center" width="100"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty+=$batch[csf('batch_qnty')];
					$fab_weight+=$batch[csf('batch_weight')];
					$tot_trim_qty2+=$tot_trim_qty;
					$total_water_cons_load+=$water_cons_load;
					$total_water_cons_unload+=$water_cons_unload;
					$tot_trims_qnty+=$tot_trim_qty;
					$tot_batch_wgt+=$batch[csf('batch_weight')]+$tot_trim_qty;
					$grand_total_batch_qty+=$batch[csf('batch_weight')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <td width="30">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                     <? if($group_by==2 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } if($group_by==1 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>
                    <td width="60">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="90">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                     <td width="70"><? echo number_format($fab_weight,2); ?></td>
                    <td width="70"><? echo number_format($tot_trim_qty2,2); ?></td>

                    <td width="70"><? echo number_format($fab_weight+$tot_trim_qty2,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                    <td width="50">&nbsp;</td>
                    <td width="60"><? //echo $total_water_cons_load;?></td>

                    <td width="70"><? //echo number_format($btq,2); ?></td>
                    <td width="60">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                     <td width="100">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>&nbsp;</strong></th>
                    <th width="70"><? //echo number_format($tot_trims_qnty,2); ?></th>
                    <th width="70"><? //echo number_format($tot_trims_qnty,2); ?></th>
                    <th colspan="14">&nbsp; </th>

                </tr>

                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <? if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80"><? //echo $total_water_cons_load;?></th>
                    <th width="80"><? //echo $total_water_cons_load;?></th>
                    <th width="130" colspan="2"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($fab_weight,2);?></th>
                    <th width="70"><? echo number_format($tot_trims_qnty,2);//number_format($grand_total_batch_qty,2); ?></th>

                     <th width="70"><? echo number_format($grand_total_batch_qty,2); ?></th>

                    <th colspan="14" align="left"> </th>

                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			if(count($sql_subcon_data)>0)
			{
		?>
		 <div align="left">
		  <div align="left"><b> Subcon batch</b> </div>
		 <table class="rpt_table" width="1970" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_2">
				<thead>
					<tr>
						<th width="30">SL</th>
						<th width="80"><? echo $date_type_msg;?></th>
						<th width="80">M/C No</th>
						<th width="80">Floor</th>
						<th width="80">Shift Name</th>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70">Dia/Width Type</th>
						<th width="80">Color Range</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="40">Extn. No</th>
						<th width="70">Dyeing Qty.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
						<th width="60">Total Time</th>
						<th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


						<th width="75">Load Date & Time</th>
						<th width="75">UnLoad Date Time</th>

                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab Type</th>
						<th>Result</th>
					</tr>
				</thead>
		</table>
		<div style=" max-height:350px; width:1990px; overflow-y:scroll;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="1970" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
		<tbody>
					<?
					$i=1;
					$btq=0;$trims_btq_sub=0;
					$batch_chk_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($i%2==0)
					$bgcolor_sub2="#E9F3FF";
					else
					$bgcolor_sub2="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$batch_weight_sub=$batch[csf('batch_weight')];
					$water_cons_unload_sub=$batch[csf('water_flow_meter')];
					$water_cons_load_sub=$subcon_water_flow_arr[$batch[csf('id')]];
					$load_hour_meter_sub=$subcon_load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff_sub=($water_cons_unload_sub-$water_cons_load_sub)/$batch_weight_sub*1000;
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$width_dia_type=array_unique(explode(",",$batch[csf('width_dia_type')]));
					$dia_width_arr='';
					foreach($width_dia_type as $dtype)
					{
						if($dia_width_arr=='') $dia_width_arr=$fabric_typee[$dtype];else $dia_width_arr.=','.$fabric_typee[$dtype];
					}
					//echo $load_hr[$batch[csf('id')]].'ddddd';
					//echo $batch[csf('id')];
					?>
					<tr bgcolor="<? echo $bgcolor_sub2; ?>" id="trsub_<? echo $i; ?>" onClick="change_color('trsub_<? echo $i; ?>','<? echo $bgcolor; ?>')">
						<td width="30"><? echo $i; ?></td>
						<td width="80"><p><? echo ($batch[csf('production_date')] == '0000-00-00' || $batch[csf('production_date')] == '' ? '' : change_date_format($batch[csf('production_date')])); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
						<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $floor_arr[$batch[csf('floor_id')]];  ?>"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $shift_name[$batch[csf('shift_name')]];  ?>"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
						<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? echo  $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td  width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
						<td  width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $batch[csf('width_dia_type')]; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a><? //echo $batch[csf('item_description')]; ?></div></td>
						<td  width="70" title="<? echo  $dia_width_arr; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td width="80" ><p><? echo $color_range[$color_range_arr1[$batch[csf('id')]]]; ?></p></td>
						<!-- <td width="80" ><p><? //echo $color_range[$batch[csf('color_range_id')]]; ?></p></td> -->
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						
						<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>

                          <td width="60" align="right"><p><? echo $load_hour_meter_sub;  ?></p></td>
                           <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')];  ?></p></td>
                          <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')]-$load_hour_meter_sub;  ?></p></td>
						<td align="left" width="50" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60"><p><? echo $water_cons_load_sub;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload_sub;  ?></p></td>

                        <td align="right" width="70" title="<? echo number_format($water_cons_diff_sub,2);  ?>"><? echo number_format($water_cons_diff_sub,2);  ?></td>


						<td width="75" title="<?  $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];  echo ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).'  & '.$sub_load_t; ?>"><p><?   $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]]; echo  ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).' <br> '.$sub_load_t;
						 ?></p></td>
						<td width="75" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; // $unloadd=change_date_format($batch[csf('process_end_date')]).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
						<td align="center" width="60">
					   <?
					$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
					$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$sub_load_t.':'.'00');
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
					//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
							?>
						 </td>
                         <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						 echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
						<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
					</tr>
		<?
		$i++;
		$btq_sub+=$batch[csf('sub_batch_qnty')];
		$trims_btq_sub+=$batch[csf('total_trims_weight')];
		} //batchdata froeach
		 ?>
			</tbody>
		</table>
		<table class="rpt_table" width="1970" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
				<thead>

                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="40">Total Trims</th>
						<th width="70"><? echo number_format($trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="40">Grand Total</th>
						<th width="70"><? echo number_format($btq_sub+$trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						 <th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
		</table>
		</div>
		</div>
		<?
		}
		} // Sub Cond End

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
		{
			if (count($batchdata_sam)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <style type="text/css">
				table tr th, table tr td{word-wrap: break-word;word-break: break-all;}
			</style>
			 <div style="width: 2370px;" align="left">
			 <div> <b>Sample Dyeing Production </b></div>
			 <table class="rpt_table" width="2350" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_3">
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="80"><? echo $date_type_msg;?></th>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <th width="80">M/C No</th>
                        <? }
						?>
                        <? if($group_by==2 || $group_by==0){ ?>
                        <th width="80">Floor</th>
                         <? } if($group_by==1 || $group_by==0){ ?>
                        <th width="80">Shift Name</th>
                         <? } ?>
                        <th width="70">File No</th>
                        <th width="80">Ref. No</th>
                        <th width="100">Buyer</th>

                        <th width="80">Job</th>
                        <th width="90">PO No</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/ Width Type</th>
						
                        <th width="80">Color Range</th>
                        <th width="80">Color Name</th>

                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Qty.</th>

                        <th width="60">Hour Load Meter</th>
 						<th width="60">Hour unLoad Meter</th>
                         <th width="60">Total Time</th>
                        <th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fabrics<br>Type</th>
                        <th width="100">Result</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:2370; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body3" width="2350" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$grand_total_batch_qty_sam=0;$batch_qnty_sam=0;$total_trim_qty=0;
                $batch_chk_arr=array(); $group_by_arr=array();$trims_check_array=array();
                foreach($batchdata_sam as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                     <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td width="80">&nbsp;</td>
                                    <td width="90">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                    				<td width="80">&nbsp;</td>
                    				<td width="80">&nbsp;</td>
                                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="60"><? //echo number_format($btq,2); ?></td>
                                    <td width="50">&nbsp;</td>
                                     <td width="60">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                     <td width="70"><? //echo number_format($btq,2); ?></td>

                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td>&nbsp;r</td>
                                </tr>
								<?
								unset($batch_qnty_sam);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="28" align="left" ><b><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}
					$order_id=$batch[csf('po_id')];
					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$hour_meter_load=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$batch_id=$batch[csf('id')];
				if (!in_array($batch_id,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_id;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td width="80"><p><? echo change_date_format($batch[csf('production_date')]); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
                          <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <? } if($group_by==2 || $group_by==0){ ?>
                        <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
                        <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } ?>
                        <td width="70"><p><? echo $batch[csf('file_no')]; ?></p></td>
                        <td width="80"><p><? echo $batch[csf('grouping')]; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>

                        <td width="80"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
                        <td width="90"><p><? echo $po_number; ?></p></td>
                        <td width="100" align="center"><div style="width:100px; word-wrap:break-word;"><a href="##"   onclick="fabric_dtls_poup('<? echo $batch[csf('id')]; ?>','<? echo $batch[csf('width_dia_type')]; ?>','<? echo $order_id; ?>','batch_fabric_dtls_popup')"><p><? echo  'View'; ?></p></a><? //echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><div style="width:70px; word-wrap:break-word;"><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></div></td>
						<td width="80" ><p><? echo $color_range[$color_range_arr1[$batch[csf('id')]]]; ?></p></td>
						<!-- <td width="80"><p><? //echo $color_range[$batch[csf('color_range_id')]]; ?></p></td> -->
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>
                        <td width="60"><p><? echo number_format($hour_meter_load,2);  ?></p></td>
                        <td width="60"><p><? echo number_format($batch[csf('hour_unload_meter')],2);  ?></p></td>

                        <td width="60"><p><? echo number_format($batch[csf('hour_unload_meter')]-$hour_meter_load,2);  ?></p></td>
                        <td width="50"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                         <td width="60"><p><? echo $water_cons_load;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload;  ?></p></td>
                          <td align="right" width="70" ><? echo number_format($water_cons_diff,2);  ?></td>


                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                          <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						  echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td width="100" align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center" title="<?  echo $batch[csf('remarks')];   ?>"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty_sam+=$batch[csf('batch_qnty')];
					$total_trim_qty+=$tot_trim_qty;
					$grand_total_batch_qty_sam+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                     <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>Sub. Total : </strong></th>
                    <th width="70"><? echo number_format($batch_qnty_sam,2); ?></th>
                  	<th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                     <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                     <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==1 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="80">&nbsp;</th>
                    <th width="90">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty_sam,2); ?></th>
                    <th width="60"><? echo number_format($total_trim_qty,2);?></th>
                    <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>
                    <th width="50">&nbsp;</th>
                   <th width="60">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="70"><? //echo number_format($btq,2); ?></th>

                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
			?>


            <?
		}
		?>
		</fieldset>
		</div>
		<?
		} //Dyeing Production End

	/*foreach (glob("$user_id*.xls") as $filename)
		{

			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_id."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		//$filename=$user_id."_".$name.".xls";
		echo "$total_data****$filename";*/
		exit();
}



else if($action=="generate_report") //report3
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));

	if($db_type==0) $year_field_by="and YEAR(a.insert_date)";
	else if($db_type==2) $year_field_by=" and to_char(a.insert_date,'YYYY')";
	if($db_type==0) $field_concat="concat(machine_no,'-',brand) as machine_name";
	else if($db_type==2) $field_concat="machine_no || '-' || brand as machine_name";
	// machine_no || '-' || brand as machine_name
	$cbo_prod_type = str_replace("'","",$cbo_prod_type);
	$cbo_party_id = str_replace("'","",$cbo_party_id);

	$company = str_replace("'","",$cbo_company_name);
	$working_company = str_replace("'","",$cbo_working_company_name);

	$buyer = str_replace("'","",$cbo_buyer_name);
	$date_search_type = str_replace("'","",$search_type);
	$job_number = str_replace("'","",$job_number);
	$job_number_id = str_replace("'","",$job_number_show);
	$batch_no = str_replace("'","",$batch_number_show);
	$color = str_replace("'","",$txt_color);
	$machine=str_replace("'","",$txt_machine_id);
	$floor_name=str_replace("'","",$cbo_floor_id);
	$hide_booking_id = str_replace("'","",$txt_hide_booking_id);
	$txt_booking_no = str_replace("'","",$txt_booking_no);
	//echo $company;die;
	$batch_number_hidden = str_replace("'","",$batch_number);
	$ext_num = str_replace("'","",$txt_ext_no);
	$hidden_ext = str_replace("'","",$hidden_ext_no);
	$txt_order = str_replace("'","",$order_no);
	$file_no = str_replace("'","",$file_no);
	$ref_no = str_replace("'","",$ref_no);
	$hidden_order = str_replace("'","",$hidden_order_no);
	$cbo_type = str_replace("'","",$cbo_type);
	$cbo_result_name = str_replace("'","",$cbo_result_name);
	$year = str_replace("'","",$cbo_year);
	$shift = str_replace("'","",$cbo_shift_name);
	//echo $cbo_type;die;
	$txt_date_from = str_replace("'","",$txt_date_from);
	$txt_date_to = str_replace("'","",$txt_date_to);
	if ($txt_booking_no!='') $booking_no_cond="  and a.booking_no LIKE '%$txt_booking_no%'"; else $booking_no_cond="";
	if ($hide_booking_id!='') $booking_no_cond.="  and a.booking_no_id in($hide_booking_id) "; else $booking_no_cond.="";

	if ($cbo_prod_type>0 && $cbo_party_id>0) $cbo_prod_type_cond="and f.service_company in($cbo_party_id) "; else $cbo_prod_type_cond="";
	if ($cbo_prod_type>0) $cbo_prod_source_cond="and f.service_source in($cbo_prod_type) "; else $cbo_prod_source_cond="";

	if ($buyer==0) $sub_buyer_cond=""; else $sub_buyer_cond="  and d.party_id='".$buyer."' ";
	if ($cbo_result_name==0) $result_name_cond=""; else $result_name_cond="  and f.result='".$cbo_result_name."' ";
	if ($shift==0) $shift_name_cond=""; else $shift_name_cond="  and f.shift_name='".$shift."' ";
	if ($machine=="") $machine_cond=""; else $machine_cond =" and f.machine_id in ( $machine ) ";
	if ($floor_name==0 || $floor_name=='') $floor_id_cond=""; else $floor_id_cond=" and f.floor_id=$floor_name";

	if ($buyer==0) $buyerdata=""; else $buyerdata="  and d.buyer_name='".$buyer."' ";
	if ($buyer==0) $buyerdata2=""; else $buyerdata2="  and h.buyer_id='".$buyer."' ";
	if ($batch_no=="") $batch_num=""; else $batch_num="  and a.batch_no='".trim($batch_no)."' ";

	if ($batch_no=="") $unload_batch_cond=""; else $unload_batch_cond="  and batch_no='".trim($batch_no)."' ";
	if ($batch_no=="") $unload_batch_cond2=""; else $unload_batch_cond2="  and f.batch_no='".trim($batch_no)."' ";
	if ($working_company==0) 
	{ 
		$workingCompany_name_cond2=""; $workingCompany_name_condSub=""; 
	}
	else { 
	 	$workingCompany_name_cond2="  and a.working_company_id=".$working_company." ";
	 	$workingCompany_name_condSub="  and a.company_id=".$working_company." ";
	}
	if ($company==0) 
	{ 
	$companyCond=""; $companyCondSub=""; 
	}
	else 
	{
		$companyCond="  and a.company_id=$company";
		$companyCondSub="  and a.company_id=$company";
	}

	//$buyerdata=($buyer)?' and d.buyer_name='.$buyer : '';
	//$batch_num=($batch_no)?" and a.batch_no='".$batch_no."'" : '';

	//echo $cbo_batch_type;
	if(trim($ext_no)!="") $ext_no_search="%".trim($ext_no)."%"; else $ext_no_search="%%";
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}
	if ($ref_no!='') $non_ref_cond="  and h.grouping='$ref_no'"; else $non_ref_cond="";
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if ($txt_order!='') $suborder_no="and c.order_no='$txt_order'"; else $suborder_no="";
		if ($job_number_id!='') $sub_job_cond="  and d.job_no_prefix_num='".$job_number_id."' "; else $sub_job_cond="";
	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}

	// echo $ref_cond;die;
	if ($ext_num=="") $ext_no=""; else $ext_no="  and a.extention_no=$ext_num ";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	//echo date("Y-n-j", strtotime("first day of previous month"));
	//echo date("Y-n-j", strtotime("last day of previous month"));
	if($txt_date_from && $txt_date_to)
	{
		if($db_type==0)
		{

			$date_from=change_date_format($txt_date_from,'yyyy-mm-dd');
			$date_to=change_date_format($txt_date_to,'yyyy-mm-dd');
			$second_month_ldate=date("Y-m-t",strtotime($date_to));
			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-m',strtotime($date_to));
			$prod_last_day=change_date_format($second_month_ldate,'yyyy-mm-dd');
			//$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			$prod_date_upto=" and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day' ";
			if($date_search_type==1)
			{
				$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 23:59:59' ";
			}
		}
		elseif($db_type==2)
		{

			$date_from=change_date_format($txt_date_from,'','',1);
			$date_to=change_date_format($txt_date_to,'','',1);
			$dateFrom= explode("-",$date_from);
			//echo $dateto[1];
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$prod_date_to=change_date_format($today_date,'','',1);
			$second_month_ldate=date("Y-M-t",strtotime($date_to));
			//$last_day= date("t", strtotime($date_to));
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-M',strtotime($date_to));
		    $prod_last_day=change_date_format($second_month_ldate,'','',1);
			//$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			$prod_date_upto="and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day'";
			if($date_search_type==1)
			{
				$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 11:59:59 PM' ";
			}
		}
	}
	if($date_search_type==1)
	{
		$date_type_msg="Dyeing Date";
	}
	else
	{
		$date_type_msg="Insert Date";
	}

	//print_r($yarn_lot_arr);
	$load_hr=array();
	$load_min=array();
	$load_date=array();
	$water_flow_arr=array();$load_hour_meter_arr=array();
	if ($working_company==0) $workingCompany_name_cond1=""; else $workingCompany_name_cond1="  and service_company='".$working_company."' ";
	if ($company==0) $companyCond1=""; else $companyCond1="  and company_id=$company ";
	$load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=35 $companyCond1 $workingCompany_name_cond1 $unload_batch_cond and status_active=1  and is_deleted=0 ");
	foreach($load_time_data as $row_time)// for Loading time
	{
		$load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_load_hr=array();
	$subcon_load_min=array();
	$subcon_load_date=array();$subcon_load_hour_meter_arr=array();
	$subcon_water_flow_arr=array();
	$subcon_load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=38 $companyCond1 $workingCompany_name_cond1  and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
		$subcon_load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$subcon_load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$subcon_load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$subcon_water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$subcon_load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_unload_hr=array();
	$subcon_unload_min=array();
	$subcon_unload_date=array();
	$subcon_unload_time_data=sql_select("select f.batch_id,f.batch_no,f.load_unload_id,f.production_date,f.end_hours,f.end_minutes from pro_fab_subprocess f  where f.load_unload_id=2 and f.entry_form=38 $companyCond1 $workingCompany_name_cond1 and f.status_active=1  and f.is_deleted=0 $cbo_prod_type_cond $result_name_cond $shift_name_cond machine_cond $floor_id_cond");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
	$subcon_unload_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
	$subcon_unload_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
	$subcon_unload_time_data[$row_time[csf('batch_id')]]=$row_time[csf('production_date')];
	}
	//var_dump($load_hr);

	$m_capacity=array();
	$unload_min=array();
	$machine_arr=return_library_array( "select id,$field_concat from  lib_machine_name order by seq_no ",'id','machine_name');
	$machine_capacity_data=sql_select("select id,prod_capacity as m_capacity  from lib_machine_name where status_active=1  and is_deleted=0 ");

	$color_id = return_field_value("distinct(a.id) as id", "lib_color a ", "a.color_name='$color'", "id");
	//echo $color_id;
	if($color_id!='') $color=$color_id;else $color="";

	if ($color=="") $color_name=""; else $color_name="  and a.color_id=$color";

	foreach($machine_capacity_data as $capacity)// for Un-Loading time
	{
		$m_capacity[$capacity[csf('id')]]=$capacity[csf('m_capacity')];
	}

	$sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=35 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0  $unload_batch_cond2 $dates_com $cbo_prod_type_cond $result_name_cond $shift_name_cond machine_cond $floor_id_cond ");
	$tot_row=1;
	foreach($sql_batch_id as $row_batch)
	{
		if($tot_row!=1) $batch_id.=",";
		$batch_id.=$row_batch[csf('batch_id')];

		$tot_row++;
	}//echo $batch_id;die;
	unset($sql_batch_id);
	$batchIds=chop($batch_id,','); $batchIds_cond="";
	if($db_type==2 && count($tot_row)>990)
	{
		$batchIds_cond=" and (";
		$batchIdsArr=array_chunk(explode(",",$batchIds),990);
		foreach($batchIdsArr as $ids)
		{
			$ids=implode(",",$ids);
			$batchIds_cond.=" a.id not in($ids) or ";
		}
		$batchIds_cond=chop($batchIds_cond,'or ');
		$batchIds_cond.=")";
	}
	else
	{
		$batchIds_cond=" and a.id not in($batchIds)";
	}
	//echo $batchIds_cond;
	$sub_sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=38 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0 $cbo_prod_type_cond $result_name_cond $shift_name_cond machine_cond $floor_id_cond");
	$k=1;
	foreach($sub_sql_batch_id as $row_batch)
	{
		if($k!=1) $sub_batch_id.=",";
		$sub_batch_id.=$row_batch[csf('batch_id')];

		$k++;
	}
	if($batch_id=="") $batch_id=0;
	if($sub_batch_id=="") $sub_batch_id=0;
	$group_by=str_replace("'",'',$cbo_group_by);
	if($group_by==1)
	{
		$order_by="order by f.floor_id";
		$order_by2="order by floor_id";
	}
	else if($group_by==2)
	{
		$order_by="order by f.shift_name";
		$order_b2y="order by shift_name";
	}
	else if($group_by==3)
	{
		$order_by="order by f.seq_no,f.process_end_date";
		$order_by2="order by seq_no,process_end_date";
	}
	else
	{
		$order_by="order by f.process_end_date,f.machine_id";
		$order_by2="order by process_end_date,end_hours,machine_id";
	}

	if($db_type==2)
	{
	 	$grp_con="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no";
	  	$grp_sub_con="LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id";
	}
	else if($db_type==0)
	{
		$grp_con="group_concat(distinct c.po_number) AS po_number,group_concat(distinct b.po_id) AS po_id,group_concat(distinct c.grouping) AS grouping,group_concat(distinct c.file_no) AS file_no";
		$grp_sub_con="group_concat(distinct c.order_no) AS po_number,group_concat(distinct b.po_id) AS po_id";
	}

	// ======================================Start
	if($ref_no!="") // for trims internal ref
	{
		$job_sql_for_trims="SELECT a.job_no_prefix_num from wo_po_details_master a, wo_po_break_down b 
		where a.job_no=b.job_no_mst and a.status_active=1 and a.is_deleted=0  and b.status_active=1 and b.is_deleted=0 and b.grouping='$ref_no' group by a.job_no_prefix_num";
		$job_result_for_trims = sql_select($job_sql_for_trims);
		
		$job_nums='';
		foreach($job_result_for_trims as $row)
		{
			if($job_nums=='') $job_nums=$row[csf('job_no_prefix_num')]; else $job_nums.=",".$row[csf('job_no_prefix_num')];
		}
		$job_nos=implode(",",(array_unique(explode(",",$job_nums))));
		$jobNos=chop($job_nos,','); $job_cond_for_trims="";
		$all_job_nos=count(array_unique(explode(",",$jobNos)));
		if($db_type==2 && $all_job_nos>999)
		{
			$job_cond_for_trims=" and (";
			$jobNosArr=array_chunk(explode(",",$jobNos),999);
			foreach($jobNosArr as $num)
			{
				$num=implode(",",$num);
				$job_cond_for_trims.="d.job_no_prefix_num in($num) or";
			}
			$job_cond_for_trims=chop($job_cond_for_trims,'or ');
			$job_cond_for_trims.=")";
		}
		else
		{
			$job_cond_for_trims=" and d.job_no_prefix_num in($jobNos)";
		}
	}
	// echo $job_cond_for_trims;die;
	// =====================================End

	//if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description";
	//else if($db_type==0) $group_con2=",group_concat(b.width_dia_type) AS width_dia_type,group_concat(b.item_description) AS item_description";
	if($cbo_type==2)//   For Order Wise Dyeing Production dtls sql
	{
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			$sql="(select a.working_company_id,a.company_id,a.batch_no, a.batch_weight,a.id, a.color_id, a.color_range_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.prod_id, b.width_dia_type, $grp_con, d.job_no as job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order,g.seq_no,a.entry_form  
			from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_machine_name g, pro_batch_create_mst a where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_source_cond  $booking_no_cond $cbo_prod_type_cond and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0
			GROUP BY a.working_company_id,a.company_id,a.batch_no, a.batch_weight,a.id, a.color_id, a.color_range_id,a.total_trims_weight, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,d.job_no, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id,g.seq_no, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order,a.entry_form )
			union
			(
			select a.working_company_id,a.company_id,a.batch_no, a.batch_weight,a.id, a.color_id, a.color_range_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,b.item_description, b.prod_id, b.width_dia_type,null as po_number ,null as po_id,null as grouping, null as file_no, null as job_no_prefix_num,h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id,f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order,g.seq_no,a.entry_form  
			from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g,wo_non_ord_samp_booking_mst h 
			where h.booking_no=a.booking_no $companyCond  $booking_no_cond $workingCompany_name_cond2 and f.batch_id=a.id and f.batch_id=b.mst_id  and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0 $dates_com  $batch_num  $color_name   $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $non_ref_cond 
			GROUP BY a.working_company_id,a.company_id,a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.color_range_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,g.seq_no,
			f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,
			f.end_minutes, f.machine_id,g.seq_no, f.load_unload_id,f.fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks,a.entry_form 
			) 
			union 
			(select a.working_company_id,a.company_id,a.batch_no, a.batch_weight,a.id, a.color_id, a.color_range_id, a.extention_no,a.total_trims_weight,SUM(b.trims_wgt_qnty) AS batch_qnty, b.item_description, null as prod_id, null as width_dia_type, null as po_number ,null as po_id,null as grouping, null as file_no, d.job_no as job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date, f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order,g.seq_no ,a.entry_form 
			from pro_batch_create_mst a,pro_batch_trims_dtls b, wo_po_details_master d, pro_fab_subprocess f, lib_machine_name g 
			where a.id=b.mst_id and f.batch_id=a.id and f.batch_id=b.mst_id and a.entry_form=136 and g.id=f.machine_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2,3) and d.job_no=a.job_no and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_source_cond $booking_no_cond $cbo_prod_type_cond $job_cond_for_trims
			GROUP BY a.working_company_id,a.company_id,a.batch_no,a.id, a.color_id, a.color_range_id, a.extention_no, b.item_description,a.total_trims_weight, a.batch_weight, d.job_no, d.buyer_name,f.remarks, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order,g.seq_no ,a.entry_form) $order_by2";
			// echo $sql;
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2 )
		{
			//echo $group_by.'DD';
			if ($ref_no=='')
			{
			 $sql_subcon="select a.batch_no,a.id, a.company_id,a.batch_weight, a.color_id, a.color_range_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty, b.item_description, b.prod_id, b.width_dia_type,$grp_sub_con, d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,f.remarks,g.seq_no from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where  a.batch_against in(1,2) $companyCond  $booking_no_cond and f.batch_id=a.id and f.batch_id=b.mst_id and a.entry_form=36 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2   and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $cbo_prod_type_cond $cbo_prod_source_cond $companyCondSub $workingCompany_name_condSub
			GROUP BY a.batch_no, a.id,a.batch_weight,a.company_id, a.color_id, a.color_range_id, a.extention_no,a.total_trims_weight, b.item_description,b.prod_id, b.width_dia_type, d.subcon_job, d.party_id, f.shift_name, f.production_date,g.seq_no,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result,f.remarks $order_by";
			}

			//echo $sql_subcon;
		}

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
		{
			//total_trims=5
			  $sql_sam="(select a.booking_without_order,a.booking_no,a.batch_no,a.company_id,a.working_company_id, a.batch_weight,a.id, a.color_id, a.color_range_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.prod_id, b.width_dia_type,$grp_con, d.job_no as job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, fabric_type,f.result,f.remarks,g.seq_no from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where a.batch_against in(3)  $companyCond $booking_no_cond $workingCompany_name_cond2 and f.batch_id=a.id $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.batch_id=b.mst_id and  b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0
		 GROUP BY a.batch_no, a.batch_weight,a.id,a.company_id,a.working_company_id, a.color_id, a.color_range_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type, d.job_no, d.buyer_name, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no,c.file_no,c.grouping, f.result,f.remarks,g.seq_no )
		 union
		 (
		 select a.booking_without_order,a.booking_no,a.batch_no,a.company_id,a.working_company_id, a.batch_weight,a.id, a.color_id, a.color_range_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description,b.prod_id, b.width_dia_type,null as po_number, null as po_id,null as grouping, null as file_no,null as job_no_prefix_num, h.buyer_id as buyer_name,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,f.remarks,g.seq_no from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond $workingCompany_name_cond2 and f.batch_id=a.id $dates_com   $batch_num  $buyerdata2 $color_name $non_ref_cond $result_name_cond $shift_name_cond $machine_cond $booking_no_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0
		 GROUP BY a.batch_no,a.company_id,a.working_company_id, a.batch_weight,a.id,h.buyer_id, a.color_id, a.color_range_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks,g.seq_no)  $order_by2";
		}
	}
	//echo $sql;
	//$batchdata=sql_select($sql);
	//echo $sql_subcon; die;sql_subcon_ltb

	if($cbo_type==2) // Dyeing Production
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//echo $sql;
			$batchdata=sql_select($sql);
			$batch_ids='';$all_po_id='';
			foreach($batchdata as $row)
			{
				if($batch_ids=='') $batch_ids=$row[csf('id')]; else $batch_ids.=",".$row[csf('id')];
				if($all_po_id=='') $all_po_id=$row[csf('po_id')]; else $all_po_id.=",".$row[csf('po_id')];
			}
			$po_idsid=implode(",",(array_unique(explode(",",$all_po_id))));
			$batch_idss=implode(",",(array_unique(explode(",",$batch_ids))));

			$poIds=chop($po_idsid,','); $po_cond_for_in="";
			$po_ids=count(array_unique(explode(",",$po_idsid)));
			if($db_type==2 && $po_ids>999)
			{
				$po_cond_for_in=" and (";
				$poIdsArr=array_chunk(explode(",",$poIds),999);
				foreach($poIdsArr as $ids)
				{
				$ids=implode(",",$ids);
				$po_cond_for_in.="b.po_breakdown_id in($ids) or";
				}
				$po_cond_for_in=chop($po_cond_for_in,'or ');
				$po_cond_for_in.=")";
			}
			else
			{
				$po_cond_for_in=" and b.po_breakdown_id in($poIds)";
			}

			$batchIds=chop($batch_idss,','); $batch_cond_for_in="";
			$batch_ids=count(array_unique(explode(",",$batchIds)));
			if($db_type==2 && $batch_ids>999)
			{
				$batch_cond_for_in=" and (";
				$batchIdsArr=array_chunk(explode(",",$batchIds),999);
				foreach($batchIdsArr as $ids)
				{
					$ids=implode(",",$ids);
					$batch_cond_for_in.="a.id in($ids) or";
				}
				$batch_cond_for_in=chop($batch_cond_for_in,'or ');
				$batch_cond_for_in.=")";
			}
			else
			{
				$batch_cond_for_in=" and a.id in($batchIds)";
			}
			$trims_job_sql="SELECT a.job_no, b.grouping as int_ref, b.file_no, a.entry_form from pro_batch_create_mst a, wo_po_break_down b where a.job_no=b.job_no_mst $batch_cond_for_in and a.entry_form=136 and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 group by a.job_no, b.grouping, b.file_no, a.entry_form";
			// echo $trims_job_sql;die;
			$trims_job_data=sql_select($trims_job_sql);
			$trims_job_arr=array();
			foreach ($trims_job_data as $key => $value) 
			{
				$trims_job_arr[$value[csf('job_no')]]['int_ref']=$value[csf('int_ref')];
				$trims_job_arr[$value[csf('job_no')]]['file_no']=$value[csf('file_no')];
			}
			// echo $batch_cond_for_in;
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon;
			$sql_subcon_data=sql_select($sql_subcon);
			$batchdata_subcn=sql_select($sql_sam);
			$subcn_batch_ids='';
			foreach($sql_subcon_data as $row)
			{
				if($subcn_batch_ids=='') $subcn_batch_ids=$row[csf('id')]; else $subcn_batch_ids.=",".$row[csf('id')];
				//if($sam_all_po_id=='') $sam_all_po_id=$row[csf('po_id')]; else $sam_all_po_id.=",".$row[csf('po_id')];
			}
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) //Batch Aganist - Sample
		{
			//echo $sql_sam;die;
			$batchdata_sam=sql_select($sql_sam);
			$sam_batch_ids='';$sam_all_po_id='';
			foreach($batchdata_sam as $row)
			{
				if($sam_batch_ids=='') $sam_batch_ids=$row[csf('id')]; else $sam_batch_ids.=",".$row[csf('id')];
				//if($sam_all_po_id=='') $sam_all_po_id=$row[csf('po_id')]; else $sam_all_po_id.=",".$row[csf('po_id')];
			}
			//echo $sam_batch_ids.'ff';
			if(count($batchdata_sam)>0)
			{
			$sam_batchIds=chop($sam_batch_ids,','); $sam_batch_cond_for_in="";
			$sam_batch_ids=count(array_unique(explode(",",$sam_batchIds)));
				if($db_type==2 && $sam_batch_ids>999)
				{
					$sam_batch_cond_for_in=" and (";
					$sam_batchIdsArr=array_chunk(explode(",",$sam_batchIds),999);
					foreach($sam_batchIdsArr as $ids)
					{
					$ids=implode(",",$ids);
					$sam_batch_cond_for_in.="a.id in($ids) or";
					}
					$sam_batch_cond_for_in=chop($sam_batch_cond_for_in,'or ');
					$sam_batch_cond_for_in.=")";
				}
				else
				{
					$sam_batch_cond_for_in=" and a.id in($sam_batchIds)";
				}
			}
		}
		//print_r($sql_subcon_data);
		$yarn_lot_arr=array();
		if($db_type==0)
		{
			$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, a.yarn_lot as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!=''  $po_cond_for_in  group by a.prod_id, b.po_breakdown_id");
		}
		else if($db_type==2)
		{
			//LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)
			$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id,  a.yarn_lot as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' $po_cond_for_in group by a.prod_id, b.po_breakdown_id,a.yarn_lot");
			//echo "10**select b.po_breakdown_id, a.prod_id, LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)  as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' $po_cond_for_in group by a.prod_id, b.po_breakdown_id";die;
		}
		foreach($yarn_lot_data as $rows)
		{
			//$yarn_lot=explode(",",$rows[csf('yarn_lot')]);
			$yarn_lot_arr[$rows['prod_id']][$rows['po_breakdown_id']].=$rows[csf('yarn_lot')].',';
		}
	}
	ob_start();
	?>
	<div>
	<?
	if($cbo_type==2) //  Dyeing Production Show Data Start
	{
		?>		
		<fieldset style="width:1350px;">
		<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Dyeing Production </strong><br>
			<?
			echo  ($date_from == '0000-00-00' || $date_from == '' ? '' : change_date_format($date_from)).' To ';echo  ($date_to == '0000-00-00' || $date_to == '' ? '' : change_date_format($date_to));
			?>
		</div>
		<?
		// =========All Summary Part Start=========
		if ($cbo_result_name==1 || $cbo_result_name==0)
		{
		 	?>
		 	<div>

			<table cellpadding="0"  width="820" cellspacing="0" align="left" style="margin-left:20px;">
				<tr>
					<!-- Production Summary(Shade Match) Start-->
					<td>
                 		<table cellpadding="0"  width="500" cellspacing="0" align="left"  class="rpt_table" rules="all" border="1">
							<thead>
								<?
									$shift_count=count($shift_name);
									$colspan=4+$shift_count;
								?>
								<tr>
									<th colspan="<? echo $colspan; ?>">Production Summary(Shade Match)</th>
								</tr>
								<tr>
									<th width="140">Details </th>
									<?
										foreach ($shift_name as $key => $value) {
											?>
											<th><? echo $value .' Shift'; ?></th>
											<?
										}
									 ?>
									 <th>Without Shift</th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							//echo $prod_date_upto;
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
								$summary_sql="(select a.working_company_id,a.company_id,a.batch_no,a.batch_against, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight,
								SUM(b.batch_qnty) AS batch_qnty,
								sum(CASE WHEN a.batch_against in(1,3)  THEN b.batch_qnty ELSE 0 END) AS curr_batch_qnty,
								sum(CASE WHEN a.batch_against in(2) THEN b.batch_qnty ELSE 0 END) AS re_curr_batch_qnty,
								b.item_description, b.prod_id, b.width_dia_type, d.job_no as job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order,g.seq_no 
								from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_machine_name g, pro_batch_create_mst a 
								where f.batch_id=a.id and f.batch_id=b.mst_id $companyCond $workingCompany_name_cond2   $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_source_cond  $booking_no_cond $cbo_prod_type_cond and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2,3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0 $prod_date_upto
								GROUP BY a.working_company_id,a.company_id,a.batch_no,a.batch_against, a.batch_weight,a.id, a.color_id,a.total_trims_weight, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,d.job_no, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id,g.seq_no, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order)
								UNION
								(select a.working_company_id,a.company_id,a.batch_no,a.batch_against, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, sum(CASE WHEN a.batch_against in(3)  THEN b.batch_qnty ELSE 0 END) AS curr_batch_qnty, sum(CASE WHEN a.batch_against in(2)  THEN b.batch_qnty ELSE 0 END) AS re_curr_batch_qnty, b.item_description, b.prod_id, b.width_dia_type,null as job_no_prefix_num,h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id,f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order,g.seq_no 
								from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g,wo_non_ord_samp_booking_mst h 
								where h.booking_no=a.booking_no $companyCond  $booking_no_cond $workingCompany_name_cond2 and f.batch_id=a.id and f.batch_id=b.mst_id  and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(2,3) and f.result=1 and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0 $dates_com $non_ref_cond $batch_num  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond $prod_date_upto 
								GROUP BY a.working_company_id,a.company_id,a.batch_no,a.batch_against, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,g.seq_no, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id,g.seq_no, f.load_unload_id,f.fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks) 
								UNION
								(select a.working_company_id,a.company_id,a.batch_no,a.batch_against, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.trims_wgt_qnty) AS batch_qnty, sum(CASE WHEN a.batch_against in(1,3) THEN b.trims_wgt_qnty ELSE 0 END) AS curr_batch_qnty, sum(CASE WHEN a.batch_against in(2) THEN b.trims_wgt_qnty ELSE 0 END) AS re_curr_batch_qnty, b.item_description, null as prod_id, null as width_dia_type, d.job_no as job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order,g.seq_no 
								from pro_batch_create_mst a,pro_batch_trims_dtls b, wo_po_details_master d, pro_fab_subprocess f, lib_machine_name g 
								where f.batch_id=a.id and g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and a.entry_form=136 and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2) and d.job_no=a.job_no and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 $companyCond $workingCompany_name_cond2   $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_source_cond  $booking_no_cond $cbo_prod_type_cond $prod_date_upto
								GROUP BY a.working_company_id,a.company_id,a.batch_no,a.batch_against, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, b.item_description, d.job_no , d.buyer_name,f.remarks, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order,g.seq_no)";
								// echo $summary_sql;
							}
							if (count($batchdata)>0 || count($batchdata_sam)>0) //$batchdata_sam
							{
								 $sql_datas_summary=sql_select($summary_sql);
							}
							
							$unload_qty_arr=array();$plan_cycle_time=0;$reprocess_qty_arr=array();$tot_reprocess_qty=0;$summary_trims_check_array=array();
							$zz=1;
							foreach($sql_datas_summary as $row)
							{
								$batch_againstId=$row[csf('batch_against')];
								$batch_noId=$row[csf('id')];
								if(!in_array($batch_noId,$summary_trims_check_array))
								{ 
									$zz++;
									$summary_trims_check_array[]=$batch_noId;
									$tot_trim_qty=$row[csf('total_trims_weight')];
								}
								else
								{
									$tot_trim_qty=0;
								}
								
								if($batch_againstId==1 || $batch_againstId==3)
								{
									//$tot_row=count($row[csf('process_end_date')]);
									$unload_qty_arr[$row[csf('load_unload_id')]]['qty']+=$row[csf('curr_batch_qnty')]+$tot_trim_qty;
									//$reprocess_qty_arr[2]['bqty']+=$row[csf('batch_qnty')];
									// $tot_reprocess_qty+=$row[csf('re_batch_qnty')];
									$unload_qty_arr[$row[csf('load_unload_id')]]['count']+=$tot_row;
									$unload_qty_arr[$row[csf('load_unload_id')]]['process_end_date'].=$row[csf('process_end_date')].',';
									
									$main_process_end_date_arr[$row[csf('process_end_date')]]=$row[csf('process_end_date')];
								}
								if($batch_againstId==2) //Re dyeing
								{
									//echo $row[csf('re_curr_batch_qnty')]."=";
									$tot_reprocess_qty+=$row[csf('re_curr_batch_qnty')]+$tot_trim_qty;
								}
							}
							unset($sql_datas_summary);

							//print_r($unload_qty_arr);
							$total_current_mon_qty1=$unload_qty_arr[2]['qty'];
							$total_count1=$unload_qty_arr[2]['count'];
							//$total_reprocess_qty1=$tot_reprocess_qty;

							if (count($sql_subcon_data)>0) //$batchdata_sam //subcontact sql
							{
								$sql_subcontact_summary=sql_select("select a.batch_no,a.id, a.batch_against,a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, 
								SUM(b.batch_qnty) AS production_qty_subcontact,
								sum(CASE WHEN a.batch_against in(1)  THEN b.batch_qnty ELSE 0 END) AS curr_batch_qnty,
								sum(CASE WHEN a.batch_against in(2)  THEN b.batch_qnty ELSE 0 END) AS re_curr_batch_qnty,
								b.item_description, b.prod_id, b.width_dia_type, d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,f.remarks,g.seq_no from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where  a.batch_against in(1,2) and f.result=1  and f.batch_id=a.id and f.batch_id=b.mst_id and a.entry_form=36 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2   and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  $workingCompany_name_condSub $companyCondSub  $booking_no_cond $prod_date_upto $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $cbo_prod_type_cond $cbo_prod_source_cond
								GROUP BY a.batch_no, a.id,a.batch_weight,a.batch_against, a.color_id, a.extention_no,a.total_trims_weight, b.item_description,b.prod_id, b.width_dia_type, d.subcon_job, d.party_id, f.shift_name, f.production_date,g.seq_no,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result,f.remarks $order_by");
							}
							$summary_trims_wgt_check_array=array();$d=1;
							foreach($sql_subcontact_summary as $row)
							{
								$batch_noSubcon=$row[csf('id')];
								if (!in_array($batch_noSubcon,$summary_trims_wgt_check_array))
								{ $d++;

									 $summary_trims_wgt_check_array[]=$batch_noSubcon;
									 $tot_trim_qty=$row[csf('total_trims_weight')];
								}
								else
								{
									 $tot_trim_qty=0;
								}
								$batch_againstId=$row[csf('batch_against')];
								if($batch_againstId==1)
								{
									$sub_unload_qty_arr[$row[csf('load_unload_id')]]['qty']+=$row[csf('curr_batch_qnty')]+$tot_trim_qty;
									$main_process_end_date_arr[$row[csf('process_end_date')]]=$row[csf('process_end_date')];
								}
								if($batch_againstId==2) //Re dyeing
								{
									//echo $row[csf('re_curr_batch_qnty')]."=";
									$sub_tot_reprocess_qty+=$row[csf('re_curr_batch_qnty')]+$tot_trim_qty;
								}
							}
							unset($sql_subcontact_summary);
							//echo $sub_unload_qty_arr[2]['qty'].'=';;
							$tot_avg_days=count($main_process_end_date_arr);
							$total_current_mon_qty=$unload_qty_arr[2]['qty']+$sub_unload_qty_arr[2]['qty'];//$unload_qty_arr2[2]['qty']+$total_current_mon_qty1;
							$total_count=$tot_avg_days;//$total_count1+$unload_qty_arr2[2]['count'];
							$total_reprocess_qty=$tot_reprocess_qty+$sub_tot_reprocess_qty;
							if (count($batchdata_sam)>0) //$batchdata_samp_booking
							{
								$sql_result_sample="select a.id,f.fabric_type,f.process_end_date,
								SUM(b.batch_qnty) AS batch_qnty,sum(a.batch_weight) as batch_weight,sum(distinct a.total_trims_weight) as total_trims_weight from pro_batch_create_dtls b, wo_non_ord_samp_booking_mst h, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.fabric_type>0  and a.batch_against in(3)  and h.booking_no=a.booking_no and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0   and  f.status_active=1 and f.is_deleted=0  $dates_com  $batch_num $buyerdata2  $color_name $shift_name_cond $booking_no_cond $machine_cond $floor_id_cond $non_ref_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY  a.id,f.fabric_type,f.process_end_date  ";
								$sql_result_sam=sql_select($sql_result_sample);
							}
							$fabric_batch_arr=array();$tot_batch_qty_type=array();//$trims_wgt_check_array=array();
							$kk=1;
							foreach($sql_result_sam as $row)
							{
								$batch_noSam=$row[csf('id')];
								if (!in_array($batch_noSam,$trims_wgt_check_array))
								{ $kk++;

									 $trims_wgt_check_array[]=$batch_noSam;
									 $tot_trim_qty=$row[csf('total_trims_weight')];
								}
								else
								{
									 $tot_trim_qty=0;
								}
								//echo $tot_trim_qty.'f';

								$tot_trim_qty=$row[csf('total_trims_weight')];
								$fabric_batch_arr[$row[csf('fabric_type')]]['qty']+=$row[csf('batch_qnty')]+$tot_trim_qty;
								$fabric_batch_arr[$row[csf('fabric_type')]]['weight']+=$row[csf('batch_weight')];
								$tot_batch_qty_type[1]+=$row[csf('batch_qnty')]+$tot_trim_qty;
							}
							unset($sql_result_sam);
							if (count($batchdata)>0) //$batchdata_order
							{
								$sql_result="(select a.id,f.fabric_type,f.process_end_date,
								SUM(b.batch_qnty) AS batch_qnty,sum(a.batch_weight) as batch_weight,sum(distinct a.total_trims_weight) as total_trims_weight,f.shift_name 
								from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g 
								where f.batch_id=a.id $companyCond $workingCompany_name_cond2  and a.entry_form=0 and  g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and f.fabric_type>0 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0    and  f.status_active=1 and f.is_deleted=0 $dates_com $jobdata $batch_num $buyerdata $order_no $ref_cond $year_cond $booking_no_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond 
								GROUP BY a.id, f.fabric_type,f.process_end_date,f.shift_name)
								union
								(select a.id,f.fabric_type,f.process_end_date, SUM(b.trims_wgt_qnty) AS batch_qnty,sum(a.batch_weight) as batch_weight,sum(distinct a.total_trims_weight) as total_trims_weight ,f.shift_name 
								from pro_batch_trims_dtls b, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g 
								where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=136 and g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,3) and d.job_no=a.job_no and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.status_active=1 and f.is_deleted=0 and f.fabric_type>0 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $booking_no_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond 
								GROUP BY a.id, f.fabric_type,f.process_end_date,f.shift_name)";
								// echo $sql_result;
								$sql_result=sql_select($sql_result);$trims_wgt_check_array2=array();
							}
							$mm=1;
							foreach($sql_result as $row)
							{
								$tot_trim_qty=$row[csf('total_trims_weight')];
								$batch_noSam=$row[csf('id')];
								if (!in_array($batch_noSam,$trims_wgt_check_array2))
								{ $mm++;

									$trims_wgt_check_array2[]=$batch_noSam;
									$tot_trim_qty=$row[csf('total_trims_weight')];
								}
								else
								{
									 $tot_trim_qty=0;
								}
										
								$fabric_batch_arr[$row[csf('fabric_type')]]['qty']+=$row[csf('batch_qnty')]+$tot_trim_qty;
								$fabric_batch_arr[$row[csf('fabric_type')]]['weight']+=$row[csf('batch_weight')];
								$fabric_batch_arr[$row[csf('fabric_type')]]['shfit_name']+=$row[csf('shfit_name')];
								$tot_batch_qty_type[1]+=$row[csf('batch_qnty')]+$tot_trim_qty;

								$fabric_batch_arr_shift[$row[csf('fabric_type')]][$row[csf('shift_name')]]['qty']+=$row[csf('batch_qnty')]+$tot_trim_qty;
							}
							unset($sql_result);
							//print_r($fabric_batch_arr);
							?>
						  	<tr bgcolor="#E9F3FF" style="cursor:pointer;">						  	  
							  	<td colspan="<? echo 2+$shift_count; ?>">Current Month</td>
                               	<td align="right" title="SubCon=<? echo $sub_unload_qty_arr[2]['qty'];?>"><? echo number_format($total_current_mon_qty,2);?></td>
							  	<td align="right"><?  ?></td>
						  	</tr>
                          	<tr bgcolor="#D8D8D8" style="cursor:pointer;">
							  	<td colspan="<? echo 2+$shift_count; ?>">Avg. Prod. Per Day</td>
                               	<td align="right" title="<? echo 'Total Day: '.$total_count;?>"><? echo number_format($total_current_mon_qty/$total_count,2); ?></td>
							  	<td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
						  	</tr>
                           	<tr bgcolor="#D8D8D8" style="cursor:pointer; ">
							  	<td colspan="<? echo 2+$shift_count; ?>">ReProcess Current Month</td>
                               	<td align="right" title="SubCon=<? echo $sub_tot_reprocess_qty;?>"><?   echo number_format($total_reprocess_qty,2);//round( 1040.56789, 4, PHP_ROUND_HALF_EVEN) ?></td>
							  	<td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
						  	</tr>
                           	<tr bgcolor="#99CCCC" style="cursor:pointer; ">
							  	<td colspan="<? echo 2+$shift_count; ?>"></td>
                               	<td align="right"> &nbsp; <?   //echo number_format($total_reprocess_qty,2);//round( 1040.56789, 4, PHP_ROUND_HALF_EVEN) ?></td>
							  	<td align="right">&nbsp;<? //echo $total_current_mon_qty/$total_count; ?></td>
						  	</tr>
                            <? $k=1;	$tot_batch_qty=0;
							//$fabric_type_for_dyeing2=array(1=>'Cotton',2=>'Polyster',3=>'Lycra',4=>'Both Part',5=>'White',6=>'Wash');

						  	//print_r($fabric_type_for_dyeingnn);
						  	foreach($fabric_batch_arr as $typekey=>$val)
						  	{
								if ($k%2==0) $bgcolor="#FFFFFF"; else $bgcolor="#E9F3FF";
								/*if($typekey==1)
								{
									$fab_type="Cotton";
								}
								else if($typekey==2)
								{
									$fab_type="Polyster";
								}
								else if($typekey==3)
								{
									$fab_type="Lycra";
								}
								else if($typekey==4)
								{
									$fab_type="Both Part";
								}
								else if($typekey==5)
								{
									$fab_type="White";
								}
								else if($typekey==6)
								{
									$fab_type="Wash";
								}*/
								$total_reporcess=$tot_batch_qty_type[1];
								?>
                               	<tr bgcolor="<? echo $bgcolor;?>">
								 	<? //print_r($fabric_type_for_dyeing);?>
								  	<td><?php echo $fabric_type_for_dyeing[$typekey]; ?></td>
								  	<?
									foreach ($shift_name as $key => $value) 
									{
										?>
											
										<td><? echo number_format($fabric_batch_arr_shift[$typekey][$key]['qty'],2); ?></td>
										<?
									}
								 	?>
								 	<td><? echo number_format($fabric_batch_arr_shift[$typekey][0]['qty'],2); ?></td>
                                   	<td align="right" title="<? echo $val['weight']?>"><? echo number_format($val['qty'],2); ?></td>
								  	<td align="right"><? echo number_format(($val['qty']/$total_reporcess)*100,2); ?></td>
							  	</tr>
								<? 		
								$tot_batch_qty+=$val['qty'];
							  	$k++;
							}

							?>
							</tbody>
							<tfoot>
								<tr>
									<th colspan="<? echo 2+$shift_count; ?>" align="right">Total </th>
									<th align="right"><b><? echo number_format($tot_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format(($tot_batch_qty/$total_reporcess*100),2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
                    </td>
                    <!-- Production Summary(Shade Match) End-->

                    <!-- Re Process Summary(Shade Match) Start-->
					<!-- kaiyum self n trims batch (shade match) START-->
                     	<?
						if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
						if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
						{
							$fabric_type_arr_chk=array(11,12);
						
							$sql_dt="(select a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.prod_id, b.width_dia_type, $grp_con, d.job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_machine_name g, pro_batch_create_mst a where f.batch_id=a.id and f.batch_id=b.mst_id and g.id=f.machine_id $companyCond $booking_no_cond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_source_cond $cbo_prod_type_cond and a.entry_form=0  and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.result=1 and  f.status_active=1 and f.is_deleted=0
							GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.total_trims_weight, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,d.job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order)
							union
							(
							select a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,b.item_description, b.prod_id, b.width_dia_type,null as po_number ,null as po_id,null as grouping, null as file_no, null as job_no_prefix_num,h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date,
							f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond $workingCompany_name_cond2 $booking_no_cond and f.batch_id=a.id  and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.result=1 and  f.status_active=1 and f.is_deleted=0  $dates_com $non_ref_cond  $batch_num $non_ref_cond  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,
							f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,
							f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks
							) $order_by2";
							//echo  $sql_dt;
						 	$sql_d=sql_select($sql_dt);$total_batch_qty2=0;$trims_total_batch_qty=0;$sum_trims_check_array=array();
						 	$buyer_trims_self_arr=array();$z=1;
						 	foreach($sql_d as $row)
						 	{
							  	$buyer_trims_self_arr[$row[csf('buyer_name')]]['trims']+=$row[csf('total_trims_weight')];
							  	$buyer_trims_self_arr[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
							  	$total_batch_qty2+=$row[csf('batch_qnty')];
							  	$batch_no=$row[csf('id')];
								if (!in_array($batch_no,$sum_trims_check_array))
								{ $z++;


									$sum_trims_check_array[]=$batch_no;
									$sumtot_trim_qty=$row[csf('total_trims_weight')];
								}
								else
								{
									$sumtot_trim_qty=0;
								}
							   	$trims_total_batch_qty+=$sumtot_trim_qty;
						 	}
							unset($sql_d);

							if($sam_batch_ids!='') // non_ord_samp_booking
							{
						   		$sql_result_re_without="select  f.fabric_type,h.buyer_id as buyer_name,SUM(b.batch_qnty) AS batch_qnty,a.total_trims_weight from pro_batch_create_dtls b, wo_non_ord_samp_booking_mst h, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where  f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=0 and  g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(2)  and h.booking_no=a.booking_no and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0 $dates_com  $batch_num $buyerdata2  $color_name $shift_name_cond $machine_cond $floor_id_cond  $non_ref_cond $result_name_cond_summary $cbo_prod_type_cond $booking_no_cond $cbo_prod_source_cond GROUP BY h.buyer_id ,a.total_trims_weight, f.fabric_type ";
								$sql_re_without=sql_select($sql_result_re_without);$total_batch_qty_re_without=0;
								$total_batch_qty3=0;
								$buyer_re_process_arr=array();
								foreach($sql_re_without as $row)
								{

									if(!in_array($row[csf('fabric_type')],$fabric_type_arr_chk))
									{
										$buyer_re_process_arr[$row[csf('buyer_name')]]['re_qty']+=$row[csf('batch_qnty')];
									 	$buyer_re_process_arr[$row[csf('buyer_name')]]['trims']+=$row[csf('total_trims_weight')];
									 	$total_batch_qty_re_without+=$row[csf('batch_qnty')]+$row[csf('total_trims_weight')];
									}
									else
									{
									  	// $buyer_re_process_arr[$row[csf('buyer_name')]]['re_qty']+=$row[csf('batch_qnty')];
									  	//$buyer_re_process_arr[$row[csf('buyer_name')]]['trims']+=$row[csf('total_trims_weight')];
									  	//$total_batch_qty_re_without+=$row[csf('batch_qnty')]+$row[csf('total_trims_weight')];
									  }

								}
								unset($sql_re_without);
							}
							$sql_result_re="(select a.batch_against,f.fabric_type,d.buyer_name,SUM(b.batch_qnty) AS batch_qnty,a.total_trims_weight 
							from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g 
							where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(2) and f.result in(1)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $ref_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond 
							GROUP BY d.buyer_name ,a.total_trims_weight,f.fabric_type,a.batch_against)
							union
							(select a.batch_against,f.fabric_type,d.buyer_name,SUM(b.trims_wgt_qnty) AS batch_qnty,a.total_trims_weight 
							from pro_batch_create_mst a,pro_batch_trims_dtls b, wo_po_details_master d, pro_fab_subprocess f, lib_color g  
							where f.batch_id=a.id and a.id=b.mst_id and f.batch_id=b.mst_id  and g.id=a.color_id and d.job_no=a.job_no and a.entry_form=136 and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.result=1 and f.status_active=1 and f.is_deleted=0  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $ref_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond 
							GROUP BY a.batch_against,f.fabric_type,d.buyer_name,a.total_trims_weight)";
							//echo $sql_result_re;
							$sql_re=sql_select($sql_result_re);$total_batch_qty_re=0;
								// $buyer_re_process_arr=array();
							foreach($sql_re as $row)
							{
								if(!in_array($row[csf('fabric_type')],$fabric_type_arr_chk))
								{								  
									//echo $row[csf('fabric_type')].'DD';
									if($row[csf('batch_against')]==2)
									{
										$total_batch_qty3+=0;
										$buyer_re_process_arr[$row[csf('buyer_name')]]['re_qty']+=$row[csf('batch_qnty')];
										$buyer_re_process_arr[$row[csf('buyer_name')]]['trims']+=$row[csf('total_trims_weight')];
										$total_batch_qty_re+=$row[csf('batch_qnty')]+$row[csf('total_trims_weight')];
									 }
								}
								else
								{
								    $total_batch_qty3+=$row[csf('batch_qnty')];
									//echo "B ";
									//$buyer_re_process_arr[$row[csf('buyer_name')]]['re_qty']+=$row[csf('batch_qnty')];
									//$buyer_re_process_arr[$row[csf('buyer_name')]]['trims']+=$row[csf('total_trims_weight')];
									// $total_batch_qty_re+=$row[csf('batch_qnty')]+$row[csf('total_trims_weight')];
								}
							}
						  	unset($sql_re);
						  	//echo  $sql_result_re;die;

							if($ref_no=="") // for subcon
							{
						  		$sql_subIn="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where f.batch_id=a.id $companyCond  and  a.entry_form=36 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=38 and f.batch_id=b.mst_id and f.load_unload_id=2 and f.result=1  and a.batch_against in(2) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0 $ref_cond $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $booking_no_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY d.party_id ";
						  		// echo $sql_subIn;
						   		$sql_data_subIn=sql_select($sql_subIn);
							}
						   	$subconIn_qnty_arr = array();
						   	foreach ($sql_data_subIn as $val) 
						   	{
						   		$subconIn_qnty_arr[$val[csf('party_id')]] = $val[csf('sub_batch_qnty')];
						   		$total_batch_qty_re_sub_in+=$val[csf('sub_batch_qnty')];
						   	}
						   	// print_r($subconIn_qnty_arr);
						}

						$k=1;$total_batch_qty=0;$tot_batch_per=0;
						foreach($buyer_trims_self_arr as $key=>$val)
						{
							//$trims_qty=$party_batch_arr[$key]['trims_weight'];
							$trims_qty_sum=$val['trims'];
							$k;
							$buyer_arr[$key];
							number_format($val['qty']+$trims_qty_sum,2,'.',''); //$total_batch_qty+=$val['qty']+$trims_qty_sum;
							$batch_per=(($val['qty']+$trims_qty_sum)/$total_batch_qty2)*100;  number_format($batch_per,2,'.','').'%';
							$tot_batch_per+=$batch_per;
							$k++;
						}
						?>
					 <!-- kaiyum subcontact batch (shade match)-->
                    <td valign="top">
                     	<table style="width:515px;border:1px solid #000;margin-left:40px;" align="center"  class="rpt_table" rules="all" >
                           	<thead>
								<tr>
									<th colspan="8">Re Process Summary(Shade Match)</th>
								</tr>
                             	<tr>
									<th width="15">SL</th>
									<th width="100">Buyer</th>
									<th width="80">Self Batch</th>
									<th width="80">%</th>
									<th width="80">Subcon(In) Batch</th>
									<th width="80">%</th>
									<th rowspan="2" width="80">Total</th>
                             	</tr>
                           	</thead>
                           	<tbody>
                            <?
                            $k=1;$total_batch_qty_reproc=0;$tot_batch_per_re=0;$grandTotalRe = 0;
							foreach($buyer_re_process_arr as $key=>$val)
							{
								if ($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
								//$trims_qty=$party_batch_arr[$key]['trims_weight'];
								$trims_qty_sum=$val['trims']; //total_batch_qty_re
								$total_batch_qty_reprocess=$total_batch_qty_re_without+$total_batch_qty_re;
								?>
                             	<tr bgcolor="<? echo $bgcolor; ?>" style="cursor:pointer;">
                               		<td><? echo $k; ?></td>
                               		<td><? echo $buyer_arr[$key] ?></td>
                               		<td align="right"><? echo number_format($val['re_qty']+$trims_qty_sum,2,'.',''); $total_batch_qty_reproc+=$val['re_qty']+$trims_qty_sum; ?></td>
                               		<td align="right"><? $batch_per=(($val['re_qty']+$trims_qty_sum)/$total_batch_qty_reprocess)*100; echo number_format($batch_per,2,'.','').'%'; ?></td>
                               		<td align="right"><? echo number_format($subconIn_qnty_arr[$key],0); ?></td>
                               		<td align="right"><? $batch_per_sub_in=($subconIn_qnty_arr[$key]/$total_batch_qty_re_sub_in)*100; echo number_format($batch_per_sub_in,2,'.','').'%'; ?></td>
                               		<td align="right"><? echo $subconIn_qnty_arr[$key]+$val['re_qty']+$trims_qty_sum;?></td>
                             	</tr>
                             	<?
								$tot_batch_per_re+=$batch_per;
								$tot_batch_per_re_sub_in+=$batch_per_sub_in;
								$total_batch_qty_reproc_sub_in+=$subconIn_qnty_arr[$key];
								$grandTotalRe += $subconIn_qnty_arr[$key]+$val['re_qty']+$trims_qty_sum;
								$k++;
							}
							?>
                           	</tbody>
                           <tfoot>
                             <tr>
                               <th colspan="2" align="right">Total </th>
                               <th align="left"><b><? echo number_format($total_batch_qty_reproc,2,'.','');?></b></th>
                               <th align="right"><? echo number_format($tot_batch_per_re,2,'.','').'%'; ?></th>
                               <th><? echo number_format($total_batch_qty_reproc_sub_in,0,'.','');?></th>
                               <th><? echo number_format($tot_batch_per_re_sub_in,2,'.','').'%'; ?></th>
                               <th><? echo $grandTotalRe;?></th>
                             </tr>
                           </tfoot>
                     	</table>
                    </td>
                    <!-- Re Process Summary(Shade Match) End-->

                    <!-- Summary Total(Shade Match) Start-->
				 	<?
				 	// for SubCon
				 	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
					{
						if($subcn_batch_ids!='')
						{
							$sql_sub="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where f.batch_id=a.id $companyCond  and  a.entry_form=36 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=38 and f.batch_id=b.mst_id and f.load_unload_id=2 and f.result=1  and a.batch_against in(1) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $booking_no_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY d.party_id ";
						   	$sql_data_sub=sql_select($sql_sub);
						}
					}
					$sub_party_batch_arr=array();$tot_sub_batch_qty=0;
					foreach($sql_data_sub as $row)
					{
						$sub_party_batch_arr[$row[csf('party_id')]]['qty']=$row[csf('sub_batch_qnty')];
						$sub_party_batch_arr[$row[csf('party_id')]]['buyer']=$row[csf('party_id')];
						$tot_sub_batch_qty+=$row[csf('sub_batch_qnty')];
					}
					$p=1;$total_sub_batch_qty=0;$total_batch_per_sub=0;
					foreach($sub_party_batch_arr as $id=>$sval)
					{
						$p;
						$buyer_arr[$id];
						number_format($sub_party_batch_arr[$id]['qty'],2,'.',''); $total_sub_batch_qty+=$sub_party_batch_arr[$id]['qty'];
						$batch_per_sub=($sub_party_batch_arr[$id]['qty']/$tot_sub_batch_qty)*100; number_format($batch_per_sub,2,'.','').'%';
						$total_batch_per_sub+=$batch_per_sub;
						$p++;
					}

					// for sample
					if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";

					if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
					{
						if($sam_batch_ids!='')
						{
							$sql_sam="(select d.buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and   a.entry_form=0 and  g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0 $sam_batch_cond_for_in $dates_com $jobdata $batch_num $buyerdata $order_no $file_cond $ref_cond $year_cond $color_name $booking_no_cond $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary $cbo_prod_type_cond $cbo_prod_source_cond group by d.buyer_name,a.total_trims_weight )
							union
							(
							select h.buyer_id as buyer_name,a.total_trims_weight as trims_weight,SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g,wo_non_ord_samp_booking_mst h where f.batch_id=a.id $companyCond $workingCompany_name_cond2  and h.booking_no=a.booking_no  and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0 $sam_batch_cond_for_in $dates_com  $batch_num  $year_cond $color_name   $result_name_cond_summary $shift_name_cond $machine_cond $floor_id_cond $booking_no_cond $cbo_prod_type_cond $buyerdata2 $cbo_prod_source_cond
							GROUP BY h.buyer_id,a.total_trims_weight)";
							$sql_data_sam=sql_select($sql_sam);
						}
					}

					$samp_party_batch_arr=array(); $tot_batch_qty_sam=0;$tot_batch_trims_qty_sam=0;$tot_batch_qty_sam_summary=0;
					foreach($sql_data_sam as $row)
					{
						$samp_party_batch_arr[$row[csf('buyer_name')]]['qty']+=$row[csf('batch_qnty')];
						$samp_party_batch_arr[$row[csf('buyer_name')]]['trims_qty']+=$row[csf('trims_weight')];
						$samp_party_batch_arr[$row[csf('buyer_name')]]['buyer']=$row[csf('buyer_name')];
						$tot_batch_qty_sam+=$row[csf('batch_qnty')]+$row[csf('trims_weight')];
						$tot_batch_qty_sam_summary+=$row[csf('trims_weight')];
						//$tot_batch_trims_qty_sam+=$row[csf('trims_weight')];
					}

					$k=1;$total_batch_qty_sam=0;$tot_batch_per_sam=0;
					foreach($samp_party_batch_arr as $key=>$val)
					{
						$smp_trims=$samp_party_batch_arr[$key]['trims_qty'];


						$k;
						$buyer_arr[$key];
						number_format($samp_party_batch_arr[$key]['qty']+$smp_trims,2,'.',''); $total_batch_qty_sam+=$samp_party_batch_arr[$key]['qty']+$smp_trims;
						$batch_per_sam=(($samp_party_batch_arr[$key]['qty']+$smp_trims)/$tot_batch_qty_sam)*100; number_format($batch_per_sam,2,'.','').'%';

						$tot_batch_per_sam+=$batch_per_sam;
						$k++;
					}
					?>
                    <?
			 		// for trims weight
					if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
					if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
					{

				 		//unset($sql_d);
						// echo $sql_data_sam."TTT";die;
						if($batch_idss!='')
						{
					  		$sql_result_re="select d.buyer_name,SUM(b.batch_qnty) AS batch_qnty,a.total_trims_weight from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and  a.entry_form=0 and  g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(2) and f.result in(1)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0 $batch_cond_for_in $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $booking_no_cond $floor_id_cond  $result_name_cond_summary $cbo_prod_type_cond  $cbo_prod_source_cond GROUP BY d.buyer_name ,a.total_trims_weight ";
							$sql_re=sql_select($sql_result_re);$total_batch_qty_re=0;

						 	$buyer_re_process_arr=array();
						 	foreach($sql_re as $row)
						 	{
							  $buyer_re_process_arr[$row[csf('buyer_name')]]['re_qty']+=$row[csf('batch_qnty')];
							  $buyer_re_process_arr[$row[csf('buyer_name')]]['trims']+=$row[csf('total_trims_weight')];
							  $total_batch_qty_re+=$row[csf('batch_qnty')]+$row[csf('total_trims_weight')];
						 	}
						 	unset($sql_re);
						}
					}
					
					if($company==0) $companyCondSmry=""; else $companyCondSmry=" and a.company_id=$company";
					if($working_company==0) $workingCompanyCondSmry=""; else $workingCompanyCondSmry=" and a.service_company=$working_company";
					$date_con_smry="";
					if($txt_date_from!="" && $txt_date_to!="") $date_con_smry=" and a.production_date between '$txt_date_from' and '$txt_date_to'";

					// $sql_qty="Select a.buyer_id,a.booking_no, sum(case when a.knitting_source=1 and b.machine_no_id>0 $floor_id  then c.quantity end ) as qtyinhouse, sum(case when a.knitting_source=3 then c.quantity end ) as qtyoutbound from inv_receive_master a, pro_grey_prod_entry_dtls b, order_wise_pro_details c,wo_po_break_down e, wo_po_details_master f where a.item_category=13 and a.id=b.mst_id and b.id=c.dtls_id and c.po_breakdown_id=e.id and e.job_no_mst=f.job_no and c.entry_form=2 and c.trans_type=1 and a.receive_basis!=4 $companyCondSmry $workingCompanyCondSmry  $date_con_smry and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and c.status_active=1 and c.is_deleted=0 $buyer_cond $job_cond $order_cond $job_year_cond group by a.buyer_id,a.booking_no ";
					//echo $sql_qty;
					if (count($batchdata)>0  || count($batchdata_sam)>0) //$batchdata_order_and_sample
					{
						$sql_qty = " (select a.working_company_id,a.company_id,a.id,a.batch_no,a.total_trims_weight,
						sum(case when f.service_source=1 then  a.batch_weight end) as batch_weight,
						SUM(case when f.service_source=1 and a.batch_against!=3 and b.is_sales!=1 then b.batch_qnty end) AS production_qty_inhouse,
						SUM(case when f.service_source=3 then b.batch_qnty end) AS production_qty_outbound,
						SUM(case WHEN a.batch_against=3 and a.booking_without_order=1 and b.is_sales!=1  then b.batch_qnty end) AS prod_qty_sample_without_order,
						SUM(case WHEN a.batch_against=3 and a.booking_without_order=0 and b.is_sales!=1  then b.batch_qnty end) AS prod_qty_sample_with_order,
						SUM(case WHEN b.is_sales=1 then b.batch_qnty end) AS fabric_sales_order_qty
						from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_fab_subprocess f, lib_machine_name g, pro_batch_create_mst a
						where f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $booking_no_cond  $cbo_prod_source_cond $cbo_prod_type_cond and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.batch_id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  and f.result=1
						group by a.working_company_id,a.company_id,a.id,a.batch_no,a.total_trims_weight)
						union 
						( select a.working_company_id,a.company_id,a.id,a.batch_no,a.total_trims_weight,
						sum(case when f.service_source=1 then  a.batch_weight end) as batch_weight,
						SUM(case when f.service_source=1 and a.batch_against!=3 and b.is_sales!=1  then b.batch_qnty end) AS production_qty_inhouse,
						SUM(case when f.service_source=3 then b.batch_qnty end) AS production_qty_outbound,
						SUM(case WHEN a.batch_against=3 and a.booking_without_order=1 and b.is_sales!=1 then b.batch_qnty end) AS prod_qty_sample_without_order,
						SUM(case WHEN a.batch_against=3 and a.booking_without_order=0 and b.is_sales!=1 then b.batch_qnty end) AS prod_qty_sample_with_order,
						SUM(case WHEN b.is_sales=1 then b.batch_qnty end) AS fabric_sales_order_qty
						from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g,wo_non_ord_samp_booking_mst h
						where  h.booking_no=a.booking_no $companyCond $booking_no_cond $workingCompany_name_cond2 and f.batch_id=a.id and f.batch_id=b.mst_id and a.entry_form=0 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and  f.status_active=1 and f.is_deleted=0 $dates_com  $batch_num  $color_name $non_ref_cond $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond and f.result=1
						group by a.id,a.working_company_id,a.company_id,a.batch_no,a.total_trims_weight ) 
						union
						(select a.working_company_id,a.company_id,a.id,a.batch_no, SUM(b.trims_wgt_qnty) AS total_trims_weight, 0 as batch_weight, 0 AS production_qty_inhouse, 0 AS production_qty_outbound, 0 AS prod_qty_sample_without_order, 0 AS prod_qty_sample_with_order, 0 AS fabric_sales_order_qty
						from pro_batch_create_mst a,pro_batch_trims_dtls b, wo_po_details_master d, pro_fab_subprocess f, lib_machine_name g 
						where f.batch_id=a.id and a.id=b.mst_id and f.batch_id=b.mst_id and g.id=f.machine_id and d.job_no=a.job_no and a.entry_form=136 and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and f.result=1 and f.status_active=1 and f.is_deleted=0 $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $booking_no_cond  $cbo_prod_source_cond $cbo_prod_type_cond 
						GROUP BY a.working_company_id,a.company_id,a.id,a.batch_no) ";

						// echo $sql_qty;
						$sql_result=sql_select( $sql_qty);
					}

					$production_qty_inhouse=0;
					$production_qty_outbound=0;
					$prod_qty_sample_without_order=0;
					$prod_qty_sample_with_order=0;
					$fabric_sales_order_qty=0;$total_trims_weight_qty=0;
					$batchIDs="";$j=1;$self_trims_wgt_check_array=array();
					foreach($sql_result as $row)
					{
						$production_qty_inhouse+=$row[csf('production_qty_inhouse')];
						$production_qty_outbound+=$row[csf('production_qty_outbound')];
						$prod_qty_sample_without_order+=$row[csf('prod_qty_sample_without_order')];
						$prod_qty_sample_with_order+=$row[csf('prod_qty_sample_with_order')];
						$fabric_sales_order_qty+=$row[csf('fabric_sales_order_qty')];
						$batch_noSelf=$row[csf('id')];
						if (!in_array($batch_noSelf,$self_trims_wgt_check_array))
						{ 
							$j++;

							$self_trims_wgt_check_array[]=$batch_noSelf;
							$tot_trim_qty=$row[csf('total_trims_weight')];
						}
						else
						{
							$tot_trim_qty=0;
						}
						
						$total_trims_weight_qty+=$tot_trim_qty;
					}
					if($subcn_batch_ids!='') // for subcon
					{
						/*$sql_subcontact_qty = sql_select("select a.id,a.company_id,a.batch_id,a.batch_no,sum(b.production_qty) as production_qty_subcontact
						from pro_fab_subprocess a,pro_fab_subprocess_dtls b,pro_batch_create_mst c,pro_batch_create_dtls d  where a.id=b.mst_id and a.batch_id=c.id and c.id=d.mst_id $companyCondSmry $workingCompanyCondSmry $date_con_smry and a.entry_form=36 and a.is_deleted=0 and a.status_active=1 and b.is_deleted=0 and b.status_active=1 and c.is_deleted=0 and c.status_active=1 and a.load_unload_id in(2) and a.result=1 group by a.id,a.batch_id,a.batch_no,a.company_id order by a.id");*/
						if (count($sql_subcon_data)>0) // for subcon
						{
							$sql_subcontact_qty=sql_select("select a.batch_no,a.id, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS production_qty_subcontact, b.item_description, b.prod_id, b.width_dia_type,$grp_sub_con, d.subcon_job as job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,f.remarks,g.seq_no 
							from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_machine_name g where  a.batch_against in(1,2) and f.result=1 $workingCompany_name_condSub $companyCondSub  $booking_no_cond and f.batch_id=a.id and f.batch_id=b.mst_id and a.entry_form=36 and g.id=f.machine_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2   and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY a.batch_no, a.id,a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description,b.prod_id, b.width_dia_type, d.subcon_job, d.party_id, f.shift_name, f.production_date,g.seq_no,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result,f.remarks $order_by");
						}
				

						$production_qty_subcontact=0;$sub_trims_wgt_check_array=array();$jj=1;
						foreach($sql_subcontact_qty as $row) // for subcon
						{
							$production_qty_subcontact+=$row[csf('production_qty_subcontact')];
							$batch_noSub=$row[csf('id')];
							if (!in_array($batch_noSub,$sub_trims_wgt_check_array))
							{ $jj++;

								 $sub_trims_wgt_check_array[]=$batch_noSub;
								 $tot_trim_qty=$row[csf('total_trims_weight')];
							}
							else
							{
								 $tot_trim_qty=0;
							}
							
							$total_trims_weight_qty+=$tot_trim_qty;
						}
						//echo $sql_qty;
					}
									
					?>
					<td valign="top">
						<table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1" style="margin-left:40px;">
							<thead>
								<tr>
									<th colspan="6">Summary Total(Shade Match)</th>
								</tr>
								<tr>
									<th>Self Batch</th>
									<th>Sample Batch</th>
                                    <th>Trims Weight</th>
                                    <th>SubCon Batch</th>
									<th>Total</th>
								</tr>
							</thead>
							<tbody>
								<tr bgcolor="#FFFFFF"  style="cursor:pointer;">
									<td width="30" align="right"><?
									$tot_self_batch_summary=$production_qty_inhouse+$production_qty_outbound; 
									echo number_format($tot_self_batch_summary,2);//number_format($total_batch_qty2+$total_batch_qty3,2); ?></td>
                                    <td width="30" align="right"><? 
									$tot_sample_summary=$prod_qty_sample_with_order+$prod_qty_sample_without_order; 
									echo number_format($tot_sample_summary,2);//number_format($total_batch_qty_sam,2); ?></td>

                                    <!-- trims weight -->
                                    <td width="30" align="right"><?
									$totaltrimswt=$total_trims_weight_qty;//($trims_total_batch_qty+$tot_batch_qty_sam_summary);
									echo number_format($totaltrimswt,2);
									?></td>

									<td width="30" align="right"><? echo number_format($production_qty_subcontact,2); ?></td>
									<td width="30" align="right" title="SalesQty=<? echo $fabric_sales_order_qty;?>"><?  echo number_format($grand_total=$tot_self_batch_summary+$tot_sample_summary+$production_qty_subcontact+$totaltrimswt+$fabric_sales_order_qty,2); ?></td>
							  	</tr>
								<tr bgcolor="#E9F3FF">
  								   	<td  align="right"><?  echo number_format((($tot_self_batch_summary)/$grand_total)*100,2).'%'; ?></td>
                                     <td  align="right"><?  echo number_format(($tot_sample_summary/$grand_total)*100,2).'%'; ?></td>

                                      <!-- trims weight -->
                                     <td  align="right"><?  echo number_format(($totaltrimswt/$grand_total)*100,2).'%'; ?></td>

									  <td  align="right"><?  echo number_format(($production_qty_subcontact/$grand_total)*100,2).'%'; ?></td>
									  <td  align="right"><?  echo '100%'; ?></td>
								</tr>
							</tbody>
						</table>
				   	</td>
				   	<!-- Summary Total(Shade Match) End-->

                    <!-- START Total Dyeing Production Summary -->
                    <td valign="top">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1" style="margin-left:40px;">
							<thead>
								<tr>
									<th colspan="6">Total Dyeing Production Summary(Shade Match)</th>
								</tr>
								<tr>
									<th>SL</th>
									<th>Production Type</th>
                                    <th>Total Production</th>
                                    <th>% of Total</th>
								</tr>
							</thead>
                            <tbody>
									<?
								
									$k=1;$total_summary_prod_qty=0;
									$total_production_sammary=array(1=>'Inhouse (Self Order)',2=>'Outbound-Subcon',3=>'Sample With Order',4=>'Sample Without Order',5=>'Inbound Subcontract',6=>'Fabric Sales Order',7=>'Trims Wgt');
									$total_prod_sammaryQty=$production_qty_inhouse+$production_qty_outbound+$prod_qty_sample_with_order+$prod_qty_sample_without_order+$production_qty_subcontact+$fabric_sales_order_qty+$total_trims_weight_qty;

									$grnd_tot_production_qty=0;
									$grnd_total_prod_per=0;
									//	echo "DDD";die;
									foreach($total_production_sammary as $type_id=>$val)
									{
										if ($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
									   if($type_id==1) //Inhouse
									   {
									   	$tot_production_qty=$production_qty_inhouse;
									   }
									   else  if($type_id==2) //OutBound
									   {
									   	$tot_production_qty=$production_qty_outbound;
									   }
									   else  if($type_id==3) //With Order
									   {
									   	$tot_production_qty=$prod_qty_sample_with_order;
									   }
									   else  if($type_id==4) //Without Order
									   {
									   	$tot_production_qty=$prod_qty_sample_without_order;
									   }
									   else  if($type_id==5) //SubCon Order
									   {
									   	$tot_production_qty=$production_qty_subcontact;
									   }
									   else  if($type_id==6) //Sales Order
									   {
									   	$tot_production_qty=$fabric_sales_order_qty;
									   }
									   else  if($type_id==7) //Trims Wgt
									   {
									   	$tot_production_qty=$total_trims_weight_qty;
									   }
									   $total_prod_per=number_format($tot_production_qty/$total_prod_sammaryQty,6,'.','');
									   ?>
									   <tr bgcolor="<? echo $bgcolor; ?>">
									   	<td width="40"><? echo $k; ?></td>
									   	<td width="120"><? echo $val; ?></td>
									   	<td width="120"  align="right"><? echo number_format($tot_production_qty,2,'.',''); ?></td>
									   	<td width="100" align="right"><? echo  number_format(($total_prod_per*100),4,'.',''); ?>&nbsp;</td>
									   </tr>
									   <?
									   $total_summary_prod_qty+=$tot_production_qty;
										//unset($subcon_buyer_samary[$rows[csf('buyer_id')]]);

									$grnd_tot_production_qty+=$tot_production_qty;
									$grnd_total_prod_per+=$total_prod_per;
									$k++;
									}
									 //echo "TTT";die;
									?>
                                    <tr bgcolor="#CCCCCC" style="font-weight:bold;">
                                    	<td colspan="2" width="40" align="right">Total</td>
									   	<td width="120"  align="right"><? echo number_format($grnd_tot_production_qty,2,'.',''); ?></td>
									   	<td width="100" align="right"><? echo  number_format(($grnd_total_prod_per*100),4,'.',''); ?>&nbsp;</td>
									</tr>
						</tbody>
						</table>
				    </td>
                   	<!-- END Total Dyeing Production Summary -->
			 	 </tr>
			</table>
		 	</div>
			<br />
		 	<?
		} 
		// =========All Summary Part End============

		// ===========Self batch Start==============
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			if (count($batchdata)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

				?>
				<div align="left" style="float:left; clear:both;">

				<table class="rpt_table" width="1930" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header_1">
	              	<caption> <b>Self batch  </b></caption>
	              	<!--working hereeeeeeeeeeeee self batch -->
	                <thead>
	                    <tr>
	                        <th width="30">SL</th>
	                        <th width="150">Company</th>
	                        <th width="150">Working Company</th>

	                       <? if($group_by==3 || $group_by==0){ ?>
	                    	 <th width="80">M/C No</th>
	                   		 <? } ?>
	                          <? if($group_by==2 || $group_by==0){ ?>
	                    	 <th width="80">Shift</th>
	                   		 <? } ?>
	                          <? if($group_by==1 || $group_by==0){ ?>
	                    	 <th width="80">Floor</th>
	                   		 <? } ?>

	                        <th width="60">File No</th>
	                        <th width="70">Ref. No</th>
	                        <th width="100">Buyer</th>

	                        <th width="100">Fabrics Desc</th>
	                        <th width="70">Dia/Width Type</th>
	                        <th width="80">Color Name</th>
	                        <th width="80">Color Range</th>
	                        <th width="90">Batch No</th>
	                        <th width="40">Extn. No</th>
	                        <th width="70">Dyeing Qty.</th>
	                        <th width="70">Trims Wgt.</th>

	                        <th width="75">Load Date & Time</th>
	                        <th width="75">UnLoad Date Time</th>
	                        <th width="60">Time Used</th>
	                        <th width="100">Dyeing Fab. Type</th>
	                        <th width="100">Result</th>
	                        <th width="">Remark</th>
	                    </tr>
	                </thead>
				</table>
				<div style=" max-height:350px; width:1930px; overflow-y:scroll; float:left; clear:both;" id="scroll_body">
	            <table class="rpt_table" id="table_body" width="1910" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
	                <tbody>
	                <?
					$tot_sum_trims_qnty=0;
	                $i=1; $btq=0; $k=1;$z=1;$total_water_cons_load=0;$total_water_cons_unload=0;
	                $batch_chk_arr=array(); $group_by_arr=array();$tot_trims_qnty=0;$grand_total_batch_qty=0;$trims_check_array=array();
	                foreach($batchdata as $batch)
					{
						if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
						if($group_by!=0)
						{
							if($group_by==1)
							{
								$group_value=$batch[csf('floor_id')];
								$group_name="Floor";
								$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
							}
							else if($group_by==2)
							{
								$group_value=$batch[csf('shift_name')];
								$group_name="Shift";
								$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
							}
							else if($group_by==3)
							{
								$group_value=$batch[csf('machine_id')];
								$group_name="machine";
								$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
							}
							if (!in_array($group_value,$group_by_arr) )
							{
								if($k!=1)
								{
									?>
	                                <tr class="tbl_bottom">
	                                    <td width="30">&nbsp;</td>
	                                     <td width="150"><p><? //echo $company_library[$batch[csf('company_id')]]; ?></p></td>
	                        			 <td width="150"><p><? //echo $company_library[$batch[csf('working_company_id')]]; ?></p></td>
	                         
	                                    <? if($group_by==3 || $group_by==0){ ?>
	                                    <td width="80">&nbsp;</td>
	                                     <? } ?>
	                                      <? if($group_by==2 || $group_by==0){ ?>
	                                    <td width="80">&nbsp;</td>
	                                     <? } ?>
	                                      <? if($group_by==1 || $group_by==0){ ?>
	                                    <td width="80">&nbsp;</td>
	                                     <? } 
										 // if($group_by>0) $colspan=7;else $colspan=9;
										 ?>
	                                    <td width="60">&nbsp;</td>
	                                    <td width="70">&nbsp;</td>
	                                    <td width="100">&nbsp;</td>
	                                    <td width="100">&nbsp;</td>
	                                    <td width="70">&nbsp;</td>
	                                    <td width="80">&nbsp;</td>
	                                    <td width="80">&nbsp;</td>
	                                    <td  width="130" colspan="2" style="text-align:right;"><strong>Sub. Total : </strong></td>
	                                    <td width="70" align="right"><? echo number_format($batch_qnty,2); ?></td>
	                                    <td width="70" align="right"><? echo number_format($batch_qnty_trims,2); ?></td>
										
	                                    <td  colspan="6">&nbsp;</td>
	                                </tr>
									<?
									unset($batch_qnty);unset($batch_qnty_trims);
								}
								?>
								<tr bgcolor="#EFEFEF">
									<td colspan="20"><b style="margin-left:0px"><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
								</tr>
								<?
								$group_by_arr[]=$group_value;
								$k++;
							}
						}

						$order_id=$batch[csf('po_id')];
						$entry_form=$batch[csf('entry_form')];
						$batch_weight=$batch[csf('batch_weight')];
						$water_cons_unload=$batch[csf('water_flow_meter')];
						$water_cons_load=$water_flow_arr[$batch[csf('id')]];
						$load_hour_meter=$load_hour_meter_arr[$batch[csf('id')]];
						//echo $water_cons_load.'=='.$water_cons_unload;
						$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

						$desc=explode(",",$batch[csf('item_description')]);
						$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
						$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
						$ref_no=implode(",",array_unique(explode(",",$batch[csf('grouping')])));

						$batch_no=$batch[csf('id')];
						if (!in_array($batch_no,$trims_check_array))
						{ 
							$z++;
							$trims_check_array[]=$batch_no;
							$tot_trim_qty=$batch[csf('total_trims_weight')];
						}
						else
						{
							$tot_trim_qty=0;
						}
						if($entry_form==136)
						{
							$tot_trim_qty=$tot_trim_qty+$batch[csf('batch_qnty')];
							$ref_no=$trims_job_arr[$batch[csf('job_no_prefix_num')]]['int_ref'];
							$file_no=$trims_job_arr[$batch[csf('job_no_prefix_num')]]['file_no'];
						}
						else $tot_trim_qty=$tot_trim_qty;

						?>
						<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
	                        <td width="30"><? echo $i; ?></td>

	                        <td width="150"><p><? echo $company_library[$batch[csf('company_id')]]; ?></p></td>
	                        <td width="150"><p><? echo $company_library[$batch[csf('working_company_id')]]; ?></p></td>
	                        <? if($group_by==3 || $group_by==0){ ?>
	                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
	                        <?
							}
							if($group_by==2 || $group_by==0){ ?>
								<td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
	                        <? } if($group_by==1 || $group_by==0){ ?>
							<td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
	                        <? } ?>
	                        <td align="center" width="60" title="<? echo $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $file_no; ?></p></td>
	                        <td align="center" width="70"><p><? echo $ref_no; ?></p></td>
	                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>

	                        <td width="100"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
	                        <td width="70"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
	                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
	                        <td width="80"><p><? echo $color_range[$batch[csf('color_range_id')]]; ?></p></td>
	                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
	                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
	                        <td align="right" width="70"><? 
							if($entry_form!=136) 
							{
								$batch_qty=$batch[csf('batch_qnty')];
							}
							else {
								$batch_qty=0;
							}
							echo number_format($batch_qty,2); ?></td>
	                       	<td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>
	                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
							//echo $batch[csf('id')];
	                        ?></p></td>
	                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
							echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
							$unloaded_date=change_date_format($batch[csf('process_end_date')]);
							//$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
	                        <td align="center" width="60">
								<?
	                            $new_date_time_unload=($unloaded_date.' '.$unload_time.':'.'00');
	                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
	                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
								//echo $new_date_time_unload.'=='.$new_date_time_load;
	                            echo floor($total_time/60).":".$total_time%60;
	                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
	                            ?>
	                        </td>
	                        <td align="center" width="100"><p><?

							if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{

								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
							echo $fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?> </p> </td>
	                        <td align="center" width="100"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
	                        <td align="center"><p><? echo $batch[csf('remarks')]; ?></p> </td>
						</tr>
						<?
						if($batch[csf('result')]==1){
							$tot_sum_trims_qnty+=$tot_trim_qty;
						}
						else {
							$tot_trims_qnty+=0;
						}
						$i++;
						$batch_qnty+=$batch[csf('batch_qnty')];
						$batch_qnty_trims+=$tot_trim_qty;
						$total_water_cons_load+=$water_cons_load;
						$total_water_cons_unload+=$water_cons_unload;
						$tot_trims_qnty+=$tot_trim_qty;
						$trims_summary+=$tot_trim_qty;
						$grand_total_batch_qty+=$batch_qty;
					} //batchdata froeach
					if($group_by!=0)
					{
						?>
		                <tr class="tbl_bottom">
		                    <td width="30">&nbsp;</td>
		                    <td width="150">&nbsp;</td>
		                    <td width="150">&nbsp;</td>
		                    <? if($group_by==3 || $group_by==0){ ?>
		                    <td width="80">&nbsp;</td>
		                     <? } ?>
		                      <? if($group_by==2 || $group_by==0){ ?>
		                    <td width="80">&nbsp;</td>
		                     <? } ?>
		                      <? if($group_by==1 || $group_by==0){ ?>
		                    <td width="80">&nbsp;</td>
		                     <? }
							  if($group_by>0) $colspan=7;else $colspan=9;
							  ?>
		                    <td width="60">&nbsp;</td>
		                    <td width="70">&nbsp;</td>
		                    <td width="100">&nbsp;</td>
		                    <td width="100">&nbsp;</td>
		                    <td width="70">&nbsp;</td>
		                    <td width="80">&nbsp;</td>
		                    <td width="80">&nbsp;</td>
		                    <td width="130" colspan="2"  style="text-align:right;"><strong>Sub. Total : </strong></td>
		                    <td width="70" align="right"><? echo number_format($batch_qnty,2); ?></td>
		                    <td width="70" align="right"><? echo number_format($batch_qnty_trims,2); ?></td>
							
		                    <td  colspan="8">&nbsp;</td>
		                </tr>
						<? 
					} ?>
				</tbody>
	            <tfoot>
	                <tr>
	                    <th width="30">&nbsp;</th>
	                  	<th width="150">&nbsp;</th>
	                    <th width="150">&nbsp;</th>
	                    <? if($group_by==3 || $group_by==0){ ?>
	                    <th width="80">&nbsp;</th>
	                    <? } ?>
	                     <? if($group_by==2 || $group_by==0){ ?>
	                    <th width="80">&nbsp;</th>
	                    <? } ?>
	                     <? if($group_by==1 || $group_by==0){ ?>
	                    <th width="80">&nbsp;</th>
	                    <? } 
						// if($group_by>0) $colspan=7;else $colspan=9;
						?>
	                     <th width="60">&nbsp;</th>
	                    <th width="70">&nbsp;</th>
	                    <th width="100">&nbsp;</th>

	                    <th width="100">&nbsp;</th>
	                    <th width="70">&nbsp;</th>
	                    <th width="80">&nbsp;</th>
	                    <th width="80">&nbsp;</th>
	                   
	                    <th width="130" colspan="2" style="text-align:right;"><strong>Trims Total : </strong></th>
	                    <th width="70" align="right"><? //echo number_format($tot_trims_qnty,2); ?></th>
	                     <th width="70" align="right"><? echo number_format($tot_trims_qnty,2); ?></th>
	                    <th colspan="6">&nbsp;  </th>
	                </tr>
	                <tr>
	                    <th width="30">&nbsp;</th>
	                    <th width="150">&nbsp;</th>
	                    <th width="150">&nbsp;</th>
	                    <? if($group_by==3 || $group_by==0){ ?>
	                    <th width="80">&nbsp;</th>
	                    <? } ?>
	                    <? if($group_by==2 || $group_by==0){ ?>
	                    <th width="80">&nbsp;</th>
	                    <? } ?>
	                    <? if($group_by==1 || $group_by==0){ ?>
	                    <th width="80">&nbsp;</th>
	                    <? } ?>
	                    <th width="60">&nbsp;</th>
	                    <th width="70">&nbsp;</th>
	                    <th width="100">&nbsp;</th>
	                    <th width="70">&nbsp;</th>
	                    <th width="70">&nbsp;</th>
	                    <th width="80">&nbsp;</th>
	                    <th width="80">&nbsp;</th>
	                   

	                    <th width="130"  colspan="2" style="text-align:right;"><strong>Grand Total : </strong></th>
	                    <th width="70" colspan="2" align="right"><? echo number_format($grand_total_batch_qty+$tot_trims_qnty,2); ?></th>
	                    <th colspan="7">&nbsp;  </th>
	                </tr>
	            </tfoot>
		        </table>
					</div>
					</div>
					<br/>
				<? 
			}
		}
		// ============Self batch End===============

		// ============Sub Cond batch Start=========
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			if(count($sql_subcon_data)>0)
			{
			?>
			 <div align="left" style="float:left; clear:both;">
			  <div> <b> Subcon batch</b> </div>
			 <table class="rpt_table" width="2170" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header_2">
					<thead>
						<tr>
							<th width="30">SL</th>
	                        <th width="100">Comapny</th>
	                        <th width="100">Working Comapny</th>
							<th width="80"><? echo $date_type_msg;?></th>
							<th width="80">M/C No</th>
							<th width="80">Floor</th>
							<th width="80">Shift Name</th>
							<th width="100">Buyer</th>
							<th width="80">Job</th>
							<th width="90">PO No</th>
							<th width="100">Fabrics Desc</th>
							<th width="70">Dia/Width Type</th>
							<th width="80">Color Name</th>
							<th width="80">Color Range</th>
							<th width="90">Batch No</th>
							<th width="40">Extn. No</th>
							<th width="70">Dyeing Qty.</th>
	                        <th width="60">Hour Load Meter</th>
	                        <th width="60">Hour unLoad Meter</th>
							<th width="60">Total Time</th>
							<th width="50">Lot No</th>
	                        <th width="60">Water Loading Flow</th>
	                        <th width="60">Water UnLoading Flow</th>
	                        <th width="70">Water Cons.</th>
							<th width="75">Load Date & Time</th>
							<th width="75">UnLoad Date Time</th>
	                        <th width="60">Time Used</th>
	                        <th width="100">Dyeing Fab Type</th>
							<th>Result</th>
						</tr>
					</thead>
			</table>
			<div style=" max-height:350px; width:2190px; overflow-y:scroll;;" id="scroll_body">
			<table class="rpt_table" id="table_body2" width="2170" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
			<tbody>
						<?
						$i=1;
						$btq=0;$trims_btq_sub=0;
						$batch_chk_arr=array();
						foreach($sql_subcon_data as $batch)
						{
						if ($i%2==0)
						$bgcolor_sub2="#E9F3FF";
						else
						$bgcolor_sub2="#FFFFFF";
						$order_id=$batch[csf('po_id')];
						$color_id=$batch[csf('color_id')];
						$batch_weight_sub=$batch[csf('batch_weight')];
						$water_cons_unload_sub=$batch[csf('water_flow_meter')];
						$water_cons_load_sub=$subcon_water_flow_arr[$batch[csf('id')]];
						$load_hour_meter_sub=$subcon_load_hour_meter_arr[$batch[csf('id')]];
						//echo $water_cons_load.'=='.$water_cons_unload;
						$water_cons_diff_sub=($water_cons_unload_sub-$water_cons_load_sub)/$batch_weight_sub*1000;
						$desc=explode(",",$batch[csf('item_description')]);
						$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));

						//echo $load_hr[$batch[csf('id')]].'ddddd';
						//echo $batch[csf('id')];
						?>
						<tr bgcolor="<? echo $bgcolor_sub2; ?>" id="trsub_<? echo $i; ?>" onClick="change_color('trsub_<? echo $i; ?>','<? echo $bgcolor; ?>')">
							<td width="30"><? echo $i; ?></td>
	                        <td  align="center" width="100" title=""><p><? echo $company_library[$batch[csf('company_id')]]; ?></p></td>
	                        <td  align="center" width="100" title=""><p><? echo $company_library[$batch[csf('company_id')]]; ?></p></td>
							<td width="80"><p><? echo ($batch[csf('production_date')] == '0000-00-00' || $batch[csf('production_date')] == '' ? '' : change_date_format($batch[csf('production_date')])); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
							<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
							<td  align="center" width="80" title="<? echo $floor_arr[$batch[csf('floor_id')]];  ?>"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
							<td  align="center" width="80" title="<? echo $shift_name[$batch[csf('shift_name')]];  ?>"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
							<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
							<td  width="80" title="<? echo  $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
							<td  width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
							<td  width="100" title="<? echo $batch[csf('item_description')];?>"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
							<td  width="70" title="<? echo  $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
							<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
							<td  width="80"><p><? echo $color_range[$batch[csf('color_range_id')]]; ?></p></td>
							<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
							<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
							<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>

	                          <td width="60" align="right"><p><? echo $load_hour_meter_sub;  ?></p></td>
	                           <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')];  ?></p></td>
	                          <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')]-$load_hour_meter_sub;  ?></p></td>
							<td align="left" width="50" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
	                        <td width="60"><p><? echo $water_cons_load_sub;  ?></p></td>
	                        <td width="60"><p><? echo $water_cons_unload_sub;  ?></p></td>

	                        <td align="right" width="70" title="<? echo number_format($water_cons_diff_sub,2);  ?>"><? echo number_format($water_cons_diff_sub,2);  ?></td>


							<td width="75" title="<?  $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];  echo ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).'  & '.$sub_load_t; ?>"><p><?   $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]]; echo  ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).' <br> '.$sub_load_t;
							 ?></p></td>
							<td width="75" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; // $unloadd=change_date_format($batch[csf('process_end_date')]).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
							<td align="center" width="60">
						   <?
						$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
						$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$sub_load_t.':'.'00');
						$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
						echo floor($total_time/60).":".$total_time%60;
						//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
								?>
							 </td>
	                         <td align="center" width="100"><p><?
							 if($batch[csf('fabric_type')]==1)
								{
									$fab_type="Cotton";
								}
								else if($batch[csf('fabric_type')]==2)
								{
									$fab_type="Polyster";
								}
								else if($batch[csf('fabric_type')]==3)
								{
									$fab_type="Lycra";
								}
								else if($batch[csf('fabric_type')]==4)
								{
									$fab_type="Both Part";
								}
								else if($batch[csf('fabric_type')]==5)
								{
									$fab_type="White";
								}
								else if($batch[csf('fabric_type')]==6)
								{
									$fab_type="Wash";
								}
							 echo  $fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
							<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
						</tr>
			<?
			$i++;
			$btq_sub+=$batch[csf('sub_batch_qnty')];
			$trims_btq_sub+=$batch[csf('total_trims_weight')];
			} //batchdata froeach
			 ?>
				</tbody>
	            <tfoot>
	             <tr>

							<th  colspan="16" style="text-align:right;">Total Trims</th>
							<th width="70"><? echo number_format($trims_btq_sub,2); ?></th>
	                        <th width="60">&nbsp;</th>
	                        <th width="60">&nbsp;</th>
							<th width="60">&nbsp;</th>
							<th width="50">&nbsp;</th>
	                        <th width="60">&nbsp;</th>
	                        <th width="60">&nbsp;</th>
	                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

							<th width="75">&nbsp;</th>
							<th width="75">&nbsp;</th>
							<th width="60">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
							<th>&nbsp;</th>
						</tr>
	                     <tr>
							<th  colspan="16" style="text-align:right;">Grand Total</th>
							<th width="70"><? echo number_format($btq_sub+$trims_btq_sub,2); ?></th>
	                        <th width="60">&nbsp;</th>
	                        <th width="60">&nbsp;</th>
							<th width="60">&nbsp;</th>
							<th width="50">&nbsp;</th>
	                        <th width="60">&nbsp;</th>
	                        <th width="60">&nbsp;</th>
	                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>
							<th width="75">&nbsp;</th>
							<th width="75">&nbsp;</th>
							<th width="60">&nbsp;</th>
	                        <th width="100">&nbsp;</th>
							<th>&nbsp;</th>
						</tr>
	            </tfoot>
			</table>
			
			</div>
			</div>
			<?
			}
		}
		// ============Sub Cond batch End===========

		// ======Sample Production batch Start======
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
		{
			if (count($batchdata_sam)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left" style="float:left; clear:both;">
			 <div> <b>Sample Dyeing Production </b></div>
			 <table class="rpt_table" width="1810" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header_3">
                <thead>
                    <tr>
                        <th width="30">SL</th>
                         <th width="100">Comapny</th>
                        <th width="100">Working Comapny</th>
                        <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                          <? if($group_by==2 || $group_by==0){ ?>
                    	 <th width="80">Shift</th>
                   		 <? } ?>
                          <? if($group_by==1 || $group_by==0){ ?>
                    	 <th width="80">Floor</th>
                   		 <? } ?>
                        <th width="70">File No</th>
                        <th width="80">Ref. No</th>
                        <th width="100">Buyer</th>


                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/ Width Type</th>
                        <th width="80">Color Name</th>
                        <th width="80">Color Range</th>

                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Qty.</th>

                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fabrics<br>Type</th>
                        <th width="100">Result</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
			</table>

			<div style=" max-height:650px; width:1830px; overflow-y:scroll; float:left; clear:both;" id="scroll_body">
            <table class="rpt_table" id="table_body3" width="1810" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
                <tbody>
                <?
				$total_sum_trims_qnty=0;
                $i=1; $btq=0; $k=1;$z=1;$grand_total_batch_qty_sam=0;$batch_qnty_sam=0;$total_trim_qty=0;
                $batch_chk_arr=array(); $group_by_arr=array();$trims_check_array=array();
                foreach($batchdata_sam as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>
                                     <td width="100">&nbsp;</td>
                   					 <td width="100">&nbsp;</td>

                                     <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 ?>
                                     
                                     <? if($group_by==2 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 ?>
                                     
                                     <? if($group_by==1 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 ?>

                                    <td width="130" colspan="9" style="text-align:right;"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                                    <td width="60" colspan="7">&nbsp;</td>


                                </tr>
								<?
								unset($batch_qnty_sam);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="20" align="left" ><b style="margin-left:0px"><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}
					$order_id=$batch[csf('po_id')];
					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$hour_meter_load=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
					$ref_no=implode(",",array_unique(explode(",",$batch[csf('grouping')])));
					$batch_no=$batch[csf('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                         <td  align="center" width="100" title=""><p><? echo $company_library[$batch[csf('company_id')]]; ?></p></td>
                        <td  align="center" width="100" title=""><p><? echo $company_library[$batch[csf('working_company_id')]]; ?></p></td>

                          <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <? } 
						 if($group_by==2 || $group_by==0){ ?>
							 <td width="80"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
                        <? } if($group_by==1 || $group_by==0){ ?>
							 <td width="80"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
                        <? } ?>
                        <td width="70"><p><? echo $file_no; ?></p></td>
                        <td width="80"><p><? echo $ref_no; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>


                        <td width="100"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><div style="width:70px; word-wrap:break-word;"><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></div></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="80"><p><? echo $color_range[$batch[csf('color_range_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>



                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						$unloaded_date=change_date_format($batch[csf('process_end_date')]);
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unloaded_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                          <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						  echo $fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td width="100" align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center" title="<?  echo $batch[csf('remarks')];   ?>"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					if($batch[csf('result')]==1){
						$total_sum_trims_qnty+=$tot_trim_qty;
						 }
						  else {
						 $tot_trims_qnty+=0;
						  }
					$i++;
					$batch_qnty_sam+=$batch[csf('batch_qnty')];
					$total_trim_qty+=$tot_trim_qty;
					$grand_total_batch_qty_sam+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <td width="30">&nbsp;</td>
                     <td width="100">&nbsp;</td>
                     <td width="100">&nbsp;</td>

                    <? if($group_by==3 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                    <? } 
					 if($group_by==2 || $group_by==0){ ?>
							<td width="80">&nbsp;</td>
                        <? } if($group_by==1 || $group_by==0){ ?>
							 <td width="80">&nbsp;</td>
                        <? } ?>

                    <td width="130" colspan="9" style="text-align:right;"><strong>Sub. Total : </strong></td>
                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                  	<td width="60" colspan="7">&nbsp;</td>

                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>
					 <td width="100">&nbsp;</td>
                     <td width="100">&nbsp;</td>
                     <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>
						<th width="80">&nbsp;</th>
                    <? } 
					if($group_by==1 || $group_by==0){ ?>
						<th width="80">&nbsp;</th>
                    <? } ?>
					
                    <th width="130" colspan="9" style="text-align:right;"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty_sam,2); ?></th>
                    <th width="60"><? echo number_format($total_trim_qty,2);?></th>
                    <th width="75" colspan="7">&nbsp;</th>
                </tr>
            </tfoot>
        	</table>
			</div>
			</div>
			<br/>
			<? 
			}
		}
		// ======Sample Production batch End========
		?>
		</fieldset>
		</div>
		<?
		foreach (glob("$user_name*.xls") as $filename)
		{
			if( @filemtime($filename) < (time()-$seconds_old) )
			@unlink($filename);
		}
		//---------end------------//
		$name=time();
		$filename=$user_name."_".$name.".xls";
		$create_new_doc = fopen($filename, 'w');
		$is_created = fwrite($create_new_doc,ob_get_contents());
		//$filename=$user_id."_".$name.".xls";
		echo "$total_data****$filename****$operation"; 

		
		//=====================================End==============================================
	} //Dyeing Production End
		
	?>
	
	<?
	exit();
}


//Dyeing Report Reprocess end
else if($action=="generate_report_machine")
{
	//$process = array( &$_POST );
	//extract(check_magic_quote_gpc( $process ));
	extract($_REQUEST);
	if($db_type==0) $year_field_by="and YEAR(a.insert_date)";
	else if($db_type==2) $year_field_by=" and to_char(a.insert_date,'YYYY')";
	if($db_type==0) $field_concat="concat(machine_no,'-',brand) as machine_name";
	else if($db_type==2) $field_concat="machine_no || '-' || brand as machine_name";
	//echo "fdd";die;
	// machine_no || '-' || brand as machine_name
	$company = str_replace("'","",$cbo_company_name);
	$working_company = str_replace("'","",$cbo_working_company_name);
	$cbo_prod_type = str_replace("'","",$cbo_prod_type);
	$cbo_party_id = str_replace("'","",$cbo_party_id);

	//echo $company;die;
	$buyer = str_replace("'","",$cbo_buyer_name);
	$date_search_type = str_replace("'","",$search_type);
	$job_number = str_replace("'","",$job_number);
	$job_number_id = str_replace("'","",$job_number_show);
	$batch_no = str_replace("'","",$batch_number_show);
	$color = str_replace("'","",$txt_color);
	$machine=str_replace("'","",$txt_machine_id);
	$floor_name=str_replace("'","",$cbo_floor_id);

	//echo $company;die;
	$batch_number_hidden = str_replace("'","",$batch_number);
	$ext_num = str_replace("'","",$txt_ext_no);
	$hidden_ext = str_replace("'","",$hidden_ext_no);
	$txt_order = str_replace("'","",$order_no);
	$file_no = str_replace("'","",$file_no);
	$ref_no = str_replace("'","",$ref_no);
	$hidden_order = str_replace("'","",$hidden_order_no);
	$cbo_type = str_replace("'","",$cbo_type);
	// echo  $cbo_type.'fdf';die;
	$cbo_result_name = str_replace("'","",$cbo_result_name);
	$year = str_replace("'","",$cbo_year);
	$shift = str_replace("'","",$cbo_shift_name);
	//echo $cbo_type;die;
	$txt_date_from = str_replace("'","",$txt_date_from);
	$txt_date_to = str_replace("'","",$txt_date_to);
	//$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	//if ($job_number==0) $sub_job_cond=""; else $sub_job_cond="  and d.job_no_prefix_num='".$job_number."' ";

	if ($cbo_prod_type>0 && $cbo_party_id>0) $cbo_prod_type_cond="and f.service_company in($cbo_party_id) "; else $cbo_prod_type_cond="";
	if ($cbo_prod_type>0) $cbo_prod_source_cond="and f.service_source in($cbo_prod_type) "; else $cbo_prod_source_cond="";

	if ($buyer==0) $sub_buyer_cond=""; else $sub_buyer_cond="  and d.party_id='".$buyer."' ";
	if ($cbo_result_name==0) $result_name_cond=""; else $result_name_cond="  and f.result='".$cbo_result_name."' ";
	if ($shift==0) $shift_name_cond=""; else $shift_name_cond="  and f.shift_name='".$shift."' ";
	if ($machine=="") $machine_cond=""; else $machine_cond =" and f.machine_id in ( $machine ) ";
	if ($floor_name==0 || $floor_name=='') $floor_id_cond=""; else $floor_id_cond=" and f.floor_id=$floor_name";

	if ($buyer==0) $buyerdata=""; else $buyerdata="  and d.buyer_name='".$buyer."' ";
	if ($buyer==0) $buyerdata2=""; else $buyerdata2="  and h.buyer_id='".$buyer."' ";
	if ($batch_no=="") $batch_num=""; else $batch_num="  and a.batch_no='".trim($batch_no)."' ";

	if ($batch_no=="") $unload_batch_cond=""; else $unload_batch_cond="  and batch_no='".trim($batch_no)."' ";
	if ($batch_no=="") $unload_batch_cond2=""; else $unload_batch_cond2="  and f.batch_no='".trim($batch_no)."' ";

  	if ($working_company==0) $workingCompany_name_cond2=""; else $workingCompany_name_cond2="  and a.working_company_id='".$working_company."' ";
  	if ($company==0) $companyCond=""; else $companyCond="  and a.company_id=$company";


	//echo $cbo_batch_type;
	if(trim($ext_no)!="") $ext_no_search="%".trim($ext_no)."%"; else $ext_no_search="%%";
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if ($txt_order!='') $suborder_no="and c.order_no='$txt_order'"; else $suborder_no="";
		if ($job_number_id!='') $sub_job_cond="  and d.job_no_prefix_num='".$job_number_id."' "; else $sub_job_cond="";
	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
	{
	if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
	if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
	if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}
	if ($color=="") $color_name=""; else $color_name="  and g.color_name='$color'";
	//echo $order_no;die;
	if ($ext_num=="") $ext_no=""; else $ext_no="  and a.extention_no=$ext_num ";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	//echo date("Y-n-j", strtotime("first day of previous month"));
	//echo date("Y-n-j", strtotime("last day of previous month"));

	if($txt_date_from && $txt_date_to)
	{
		if($db_type==0)
		{

			$date_from=change_date_format($txt_date_from,'yyyy-mm-dd');
			$date_to=change_date_format($txt_date_to,'yyyy-mm-dd');
			$second_month_ldate=date("Y-m-t",strtotime($date_to));
			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-m',strtotime($date_to));
			$prod_last_day=change_date_format($second_month_ldate,'yyyy-mm-dd');
			//$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			$prod_date_upto=" and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day' ";
			if($date_search_type==1)
			{
				$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 23:59:59' ";
			}
		}
		elseif($db_type==2)
		{

			$date_from=change_date_format($txt_date_from,'','',1);
			$date_to=change_date_format($txt_date_to,'','',1);
			$dateFrom= explode("-",$date_from);
			//echo $dateto[1];
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$prod_date_to=change_date_format($today_date,'','',1);
			$second_month_ldate=date("Y-M-t",strtotime($date_to));
			//$last_day= date("t", strtotime($date_to));
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-M',strtotime($date_to));
		    $prod_last_day=change_date_format($second_month_ldate,'','',1);
			//$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			$prod_date_upto="and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day'";
			if($date_search_type==1)
			{
				$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			}
			else
			{
				$dates_com=" and f.insert_date between '".$date_from."' and '".$date_to." 11:59:59 PM' ";
			}
		}
	}

		if($date_search_type==1)
			{
				$date_type_msg="Dyeing Date";
			}
			else
			{
				$date_type_msg="Insert Date";
			}
	$yarn_lot_arr=array();
	if($db_type==0)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!=''  group by a.prod_id, b.po_breakdown_id");
	}
	else if($db_type==2)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)  as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' group by a.prod_id, b.po_breakdown_id");
	}
	foreach($yarn_lot_data as $rows)
	{
		$yarn_lot=explode(",",$rows[csf('yarn_lot')]);
		$yarn_lot_arr[$rows['prod_id']][$rows['po_breakdown_id']]=implode(",",array_unique($yarn_lot));
	}
		//print_r($yarn_lot_arr);\

	$load_hr=array();
	$load_min=array();
	$load_date=array();
	$water_flow_arr=array();$load_hour_meter_arr=array();
	if ($working_company==0) $workingCompany_name_cond1=""; else $workingCompany_name_cond1="  and service_company='".$working_company."' ";
	if ($company==0) $companyCond1=""; else $companyCond1="  and company_id=$company";
	$load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=35 $companyCond1 $workingCompany_name_cond1 $unload_batch_cond and status_active=1  and is_deleted=0 ");
	foreach($load_time_data as $row_time)// for Loading time
	{
		$load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_load_hr=array();
	$subcon_load_min=array();
	$subcon_load_date=array();$subcon_load_hour_meter_arr=array();
	$subcon_water_flow_arr=array();
	$subcon_load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=38 $companyCond1 $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
		$subcon_load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$subcon_load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$subcon_load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$subcon_water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$subcon_load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}

	$subcon_unload_hr=array();
	$subcon_unload_min=array();
	$subcon_unload_date=array();
	$subcon_unload_time_data=sql_select("select batch_id,batch_no,load_unload_id,production_date,end_hours,end_minutes from pro_fab_subprocess where load_unload_id=2 and entry_form=38 $companyCond1 $workingCompany_name_cond1 and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
	$subcon_unload_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
	$subcon_unload_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
	$subcon_unload_time_data[$row_time[csf('batch_id')]]=$row_time[csf('production_date')];
	}
	//var_dump($load_hr);

	$m_capacity=array();
	$unload_min=array();
	$machine_arr=return_library_array( "select id,$field_concat from  lib_machine_name order by seq_no ",'id','machine_name');
	$machine_capacity_data=sql_select("select id,prod_capacity as m_capacity  from lib_machine_name where status_active=1  and is_deleted=0 ");
	foreach($machine_capacity_data as $capacity)// for Un-Loading time
	{
		$m_capacity[$capacity[csf('id')]]=$capacity[csf('m_capacity')];
	}

	$sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=35 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0  $unload_batch_cond2 $dates_com ");
	$tot_row=1;
	foreach($sql_batch_id as $row_batch)
	{
		if($tot_row!=1) $batch_id.=",";
		$batch_id.=$row_batch[csf('batch_id')];

		$tot_row++;
	}//echo $batch_id;die;
		unset($sql_batch_id);
		$batchIds=chop($batch_id,','); $batchIds_cond="";
		if($db_type==2 && count($tot_row)>990)
		{
			$batchIds_cond=" and (";
			$batchIdsArr=array_chunk(explode(",",$batchIds),990);
			foreach($batchIdsArr as $ids)
			{
				$ids=implode(",",$ids);
				$batchIds_cond.=" a.id not in($ids) or ";
			}
			$batchIds_cond=chop($batchIds_cond,'or ');
			$batchIds_cond.=")";
		}
		else
		{
			$batchIds_cond=" and a.id not in($batchIds)";
		}

	$sub_sql_batch_id=sql_select("select batch_id from  pro_fab_subprocess where entry_form=38 and load_unload_id=2 and status_active=1 and is_deleted=0");
	$k=1;
	foreach($sub_sql_batch_id as $row_batch)
	{
		if($k!=1) $sub_batch_id.=",";
		$sub_batch_id.=$row_batch[csf('batch_id')];

		$k++;
	}
	//echo 'sdsddd';die;
	if($batch_id=="") $batch_id=0;
	if($sub_batch_id=="") $sub_batch_id=0;
	$group_by=str_replace("'",'',$cbo_group_by);
	if($group_by==1)
	{
		$order_by="order by f.floor_id";
		$order_by2="order by floor_id";
	}
	else if($group_by==2)
	{
		$order_by="order by f.shift_name";
		$order_b2y="order by shift_name";
	}
	else if($group_by==3)
	{
		$order_by="order by f.machine_id";
		$order_by2="order by machine_id";
	}
	else
	{
		$order_by="order by f.process_end_date,f.machine_id";
		$order_by2="order by process_end_date,machine_id";
	}

		if($db_type==2)
		{
		 $grp_con="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no";
		  $grp_sub_con="LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id";
		}
		else if($db_type==0)
		{
			 $grp_con="group_concat(distinct c.po_number) AS po_number,group_concat(distinct b.po_id) AS po_id,group_concat(distinct c.grouping) AS grouping,group_concat(distinct c.file_no) AS file_no";
			  $grp_sub_con="group_concat(distinct c.order_no) AS po_number,group_concat(distinct b.po_id) AS po_id";
		}
			//if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description";
			//else if($db_type==0) $group_con2=",group_concat(b.width_dia_type) AS width_dia_type,group_concat(b.item_description) AS item_description";
			//echo $cbo_type;die;
			// union
			 /*(
			 	select a.batch_no, a.batch_weight,a.id, a.color_id, a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,null as po_id ,null as po_id,null as job_no_prefix_num, null as job_no_prefix_num,h.buyer_id as buyer_name, f.production_date as process_end_date,f.process_end_date as production_date,f.water_flow_meter,f.machine_id, f.load_unload_id, from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no and a.company_id=$company and f.batch_id=a.id  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  $dates_com  $batch_num  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,
              f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,
              f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks
			 ) $order_by2*/


			//print_r($machine_wise_arr);


		if($cbo_type==2)//   For Order Wise Dyeing Production
		{

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{

			  $sql="(select a.batch_no, a.batch_weight,a.id, a.color_id, a.total_trims_weight,(b.batch_qnty) AS batch_qnty,b.po_id,d.job_no_prefix_num as job_no,d.buyer_name,  f.production_date as process_end_date,f.process_end_date as production_date,f.water_flow_meter,f.machine_id, f.load_unload_id from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where  f.batch_id=a.id $companyCond $workingCompany_name_cond2  $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0 )
				";
				$result=sql_select($sql);
				foreach($result as $row)
				{
					$machine_wise_arr[$row[csf('machine_id')]]['prod_date']=$row[csf('production_date')];
					$machine_wise_arr[$row[csf('machine_id')]]['batch_no'].=$row[csf('batch_no')].',';
					$machine_wise_arr[$row[csf('machine_id')]]['color_id'].=$row[csf('color_id')].',';
					$machine_wise_arr[$row[csf('machine_id')]]['job_no'].=$row[csf('job_no')].',';
					$machine_wise_arr[$row[csf('machine_id')]]['po_id'].=$row[csf('po_id')].',';
					$machine_wise_arr[$row[csf('machine_id')]]['buyer_name'].=$row[csf('buyer_name')].',';
					$machine_wise_arr[$row[csf('machine_id')]]['job_no']+=$row[csf('total_trims_weight')];
					$machine_wise_arr[$row[csf('machine_id')]]['batch_qnty']+=$row[csf('batch_qnty')];
					$machine_wise_arr[$row[csf('machine_id')]]['water']+=$row[csf('water_flow_meter')];
					$machine_wise_arr[$row[csf('machine_id')]]['water']+=$row[csf('water_flow_meter')];
				}
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
				 $sql_subcon="select a.batch_no,a.id, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty, b.item_description, b.prod_id, b.width_dia_type,$grp_sub_con, d.job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2  and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $cbo_prod_type_cond $cbo_prod_source_cond
				GROUP BY a.batch_no, a.id,a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description,b.prod_id, b.width_dia_type, d.job_no_prefix_num, d.party_id, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result $order_by";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
				//total_trims=5
				  $sql_sam="(select a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.prod_id, b.width_dia_type,$grp_con, d.job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, fabric_type,f.result from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond $cbo_prod_type_cond $cbo_prod_source_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type, d.job_no_prefix_num, d.buyer_name, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no,c.file_no,c.grouping, f.result )
			 union
			 (
			 select a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description,b.prod_id, b.width_dia_type,null as po_number, null as po_id,null as grouping, null as file_no,null as job_no_prefix_num, h.buyer_id as buyer_name,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no $companyCond $workingCompany_name_cond2 and f.batch_id=a.id $dates_com  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $cbo_prod_type_cond $cbo_prod_source_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result)  $order_by2";
			}
		}

		//$batchdata=sql_select($sql);
		//echo $sql_subcon; die;sql_subcon_ltb
		// echo 'dddf';die;

	if($cbo_type==2) // Dyeing Production
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//echo $sql;
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon;
			$sql_subcon_data=sql_select($sql_subcon);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) //Batch Aganist - Sample
		{
			//echo $sql_sam;
			$batchdata_sam=sql_select($sql_sam);
		}
	//print_r($sql_subcon_data);
	}
	ob_start();
	if($cbo_type==2) //  Dyeing Production
	{
		?>
		<fieldset style="width:1350px;">
		<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Dyeing Production </strong><br>
		<?
			//echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
			echo  ($date_from == '0000-00-00' || $date_from == '' ? '' : change_date_format($date_from)).' To ';echo  ($date_to == '0000-00-00' || $date_to == '' ? '' : change_date_format($date_to));
			?>
		 </div>
		 <?

		 if ($cbo_result_name!=1 || $cbo_result_name==0)
		 {
		 ?>
						 <!-- kaiyum Self n Trims Batch (Not Shade Match) -->
						 <!-- kaiyum Sample n Trims Batch(Not Shade Match) -->
						 <!-- kaiyum SubContact Batch (Not Shade Match) -->
						 <!-- kaiyum Summary Total START( Not Shade Match) -->
                         <?
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
							{
						   $sql_sub_not="select d.party_id, SUM(b.batch_qnty) AS sub_batch_qnty,a.total_trims_weight from pro_batch_create_dtls b,  subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where f.batch_id=a.id $companyCond $workingCompany_name_cond2 and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0 and  f.status_active=1 and f.is_deleted=0  $dates_com $sub_job_cond $batch_num $sub_buyer_cond $suborder_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond $result_name_cond_summary_not $cbo_prod_type_cond $cbo_prod_source_cond GROUP BY d.party_id ";
						   $sql_data_sub_not=sql_select($sql_sub_not);
							}
							$sub_party_batch_arr_not=array(); $tot_sub_batch_qty_not=0;
							foreach($sql_data_sub_not as $row)
							{
								$sub_party_batch_arr_not[$row[csf('party_id')]]['qty']=$row[csf('sub_batch_qnty')];
								$sub_party_batch_arr_not[$row[csf('party_id')]]['buyer']=$row[csf('party_id')];
								$tot_sub_batch_qty_not+=$row[csf('sub_batch_qnty')];
								$trims_summary+=$row[csf('total_trims_weight')];
							}
							$p=1;$total_sub_batch_qty_not=0;$total_batch_per_sub_not=0;
							foreach($sub_party_batch_arr_not as $id=>$sval)
							{
									 $p;
									$buyer_arr[$id];
									   number_format($sub_party_batch_arr_not[$id]['qty'],2,'.',''); $total_sub_batch_qty_not+=$sub_party_batch_arr_not[$id]['qty'];
									  $batch_per_sub_not=($sub_party_batch_arr_not[$id]['qty']/$tot_sub_batch_qty_not)*100; number_format($batch_per_sub_not,2,'.','').'%';
							$total_batch_per_sub_not+=$batch_per_sub_not;
							$p++;
							}
							?>

		 <?
		 }
		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		 {
			if (count($machine_wise_arr)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left" style="float:left; clear:both;">

			 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header">
              <caption> <b>Self batch  </b></caption>
              <!--working hereeeeeeeeeeeee self batch -->
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th width="40">Date</th>
                       <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>
                        <th width="100">Buyer</th>
                        <th width="100">Job</th>
                        <th width="70">PO No</th>
                        <th width="80">Color</th>
                        <th width="90">Batch No</th>
                        <th width="40">Fabric Wtg</th>
                        <th width="70">Trims Wtg.</th>
                        <th width="70">Batch Wtg.</th>
                        <th width="70">Water Loading Flow</th>
                        <th width="70">Water Unloading Flow</th>
                        <th width="70">Water Consumption</th>
                   </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:1390px; overflow-y:scroll; float:left; clear:both;" id="scroll_body">
            <table class="rpt_table" id="table_body" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
                <tbody>
                <?
				$tot_sum_trims_qnty=0;
                $i=1; $btq=0; $k=1;$z=1;$total_water_cons_load=0;$total_water_cons_unload=0;
                $batch_chk_arr=array(); $group_by_arr=array();$tot_trims_qnty=0;$trims_check_array=array();
                foreach($machine_wise_arr as $machine_id=>$val)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$val['floor_id'];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$val['floor_id']];
						}
						else if($group_by==2)
						{
							//$group_value=$val['shift_name'];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$val[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>


                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>


                                    <td width="130" colspan="8" style="text-align:right;"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty,2); ?></td>
                                    <td width="70"><? //echo number_format($btq,2); ?></td>


                                    <td width="75" colspan="6">&nbsp;</td>

                                </tr>
								<?
								unset($batch_qnty);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="30"><b style="margin-left:0px"><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}


					$order_id=$val['po_id'];

					$batch_weight=$val['batch_weight'];
					$water_cons_unload=$batch['water_flow_meter'];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$load_hour_meter=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
					$ref_no=implode(",",array_unique(explode(",",$batch[csf('grouping')])));

					$batch_no=$batch[csf('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}

					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>
                        <td align="center" width="60"><p><? echo $val[prod_date]; ?></p></td>

                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$machine_id]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>

                        <? } if($group_by==1 || $group_by==0){ ?>

                        <? } ?>

                        <td align="center" width="70"><p><? echo $ref_no; ?></p></td>
                        <td width="100"><p><? echo $val[buyer_name]; ?></p></td>

                        <td width="100"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>

                       	<td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>




                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						$unloaded_date=change_date_format($batch[csf('process_end_date')]);
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unloaded_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                        <td align="center" width="100"><p><?
						if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{

								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td align="center" width="100"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					if($batch[csf('result')]==1){
						$tot_sum_trims_qnty+=$tot_trim_qty;
						 }
						  else {
						 $tot_trims_qnty+=0;
						  }
					$i++;
					$batch_qnty+=$batch[csf('batch_qnty')];
					$total_water_cons_load+=$water_cons_load;
					$total_water_cons_unload+=$water_cons_unload;
					$tot_trims_qnty+=$tot_trim_qty;
					$trims_summary+=$tot_trim_qty;
					$grand_total_batch_qty+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <td width="30">&nbsp;</td>

                    <? if($group_by==3 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>


                    <td width="130" colspan="8" style="text-align:right;"><strong>Sub. Total : </strong></td>
                    <td width="70"><? echo number_format($batch_qnty,2); ?></td>

                    <td width="70"><? //echo number_format($btq,2); ?></td>



                    <td width="75" colspan="6">&nbsp;</td>


                </tr>
			<? } ?>
			</tbody>

                <tr>
                    <th width="30">&nbsp;</th>

                    <? if($group_by==3 || $group_by==0){ ?>

                    <th width="80">&nbsp;</th>

                    <? } ?>

                    <th width="130" colspan="8" style="text-align:right;"><strong>Trims Total : </strong></th>
                    <th width="70"><? echo number_format($tot_trims_qnty,2); ?></th>

                    <th colspan="7">&nbsp;  </th>

                </tr>

                <tr>
                    <th width="30">&nbsp;</th>

                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>


                    <th width="130" colspan="8" style="text-align:right;"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty+$tot_trims_qnty,2); ?></th>

                    <th colspan="7">&nbsp;  </th>

                </tr>

        </table>
			</div>
			</div>
			<br/>
		<? }
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			if(count($sql_subcon_data)>0)
			{
		?>
		 <div align="left" style="float:left; clear:both;">
		  <div> <b> Subcon batch</b> </div>
		 <table class="rpt_table" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header2">
				<thead>
					<tr>
						<th width="30">SL</th>
						<th width="80"><? echo $date_type_msg;?></th>
						<th width="80">M/C No</th>
						<th width="80">Floor</th>
						<th width="80">Shift Name</th>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70">Dia/Width Type</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="40">Extn. No</th>
						<th width="70">Dyeing Qty.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
						<th width="60">Total Time</th>
						<th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>


						<th width="75">Load Date & Time</th>
						<th width="75">UnLoad Date Time</th>

                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab Type</th>
						<th>Result</th>
					</tr>
				</thead>
		</table>
		<div style=" max-height:350px; width:1910px; overflow-y:scroll;;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
		<tbody>
					<?
					$i=1;
					$btq=0;$trims_btq_sub=0;
					$batch_chk_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($i%2==0)
					$bgcolor_sub2="#E9F3FF";
					else
					$bgcolor_sub2="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$batch_weight_sub=$batch[csf('batch_weight')];
					$water_cons_unload_sub=$batch[csf('water_flow_meter')];
					$water_cons_load_sub=$subcon_water_flow_arr[$batch[csf('id')]];
					$load_hour_meter_sub=$subcon_load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff_sub=($water_cons_unload_sub-$water_cons_load_sub)/$batch_weight_sub*1000;
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));

					//echo $load_hr[$batch[csf('id')]].'ddddd';
					//echo $batch[csf('id')];
					?>
					<tr bgcolor="<? echo $bgcolor_sub2; ?>" id="trsub_<? echo $i; ?>" onClick="change_color('trsub_<? echo $i; ?>','<? echo $bgcolor; ?>')">
						<td width="30"><? echo $i; ?></td>
						<td width="80"><p><? echo ($batch[csf('production_date')] == '0000-00-00' || $batch[csf('production_date')] == '' ? '' : change_date_format($batch[csf('production_date')])); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
						<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $floor_arr[$batch[csf('floor_id')]];  ?>"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $shift_name[$batch[csf('shift_name')]];  ?>"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
						<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? echo  $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td  width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
						<td  width="100" title="<? echo $batch[csf('item_description')];?>"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
						<td  width="70" title="<? echo  $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>

                          <td width="60" align="right"><p><? echo $load_hour_meter_sub;  ?></p></td>
                           <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')];  ?></p></td>
                          <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')]-$load_hour_meter_sub;  ?></p></td>
						<td align="left" width="50" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60"><p><? echo $water_cons_load_sub;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload_sub;  ?></p></td>

                        <td align="right" width="70" title="<? echo number_format($water_cons_diff_sub,2);  ?>"><? echo number_format($water_cons_diff_sub,2);  ?></td>


						<td width="75" title="<?  $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];  echo ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).'  & '.$sub_load_t; ?>"><p><?   $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]]; echo  ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).' <br> '.$sub_load_t;
						 ?></p></td>
						<td width="75" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; // $unloadd=change_date_format($batch[csf('process_end_date')]).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
						<td align="center" width="60">
					   <?
					$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
					$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$sub_load_t.':'.'00');
					$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
					echo floor($total_time/60).":".$total_time%60;
					//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
							?>
						 </td>
                         <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						 echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
						<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
					</tr>
		<?
		$i++;
		$btq_sub+=$batch[csf('sub_batch_qnty')];
		$trims_btq_sub+=$batch[csf('total_trims_weight')];
		} //batchdata froeach
		 ?>
			</tbody>
		</table>
		<table class="rpt_table" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
				<thead>

                    <tr>

						<th width="40" colspan="2" style="text-align:right;">Total Trims</th>
						<th width="70"><? echo number_format($trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
                    <tr>

						<th width="40" colspan="2" style="text-align:right;">Grand Total</th>
						<th width="70"><? echo number_format($btq_sub+$trims_btq_sub,2); ?></th>
                        <th width="60" colspan="12">&nbsp;</th>

					</tr>
				</thead>
		</table>
		</div>
		</div>
		<?
		}
		} // Sub Cond End

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
		{
			if (count($batchdata_sam)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);


			 ?>
			 <div align="left" style="float:left; clear:both;">
			 <div> <b>Sample Dyeing Production </b></div>
			 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left" id="table_header3">
                <thead>
                    <tr>
                        <th width="30">SL</th>
                        <th>Date</th>
                         <? if($group_by==3 || $group_by==0){ ?>
                        <th width="80">Date</th>
                        <? }?>
                        <th>M/C No

                        </th>
                        <th width="70">File No</th>
                        <th width="80">Ref. No</th>
                        <th width="100">Buyer</th>
                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/ Width Type</th>
                        <th width="80">Color Name</th>

                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Qty.</th>

                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fabrics<br>Type</th>
                        <th width="100">Result</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
			</table>

			<div style=" max-height:650px; width:1390px; overflow-y:scroll; float:left; clear:both;" id="scroll_body">
            <table class="rpt_table" id="table_body3" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="left">
                <tbody>
                <?
				$total_sum_trims_qnty=0;
                $i=1; $btq=0; $k=1;$z=1;$grand_total_batch_qty_sam=0;$batch_qnty_sam=0;$total_trim_qty=0;
                $batch_chk_arr=array(); $group_by_arr=array();$trims_check_array=array();
                foreach($batchdata_sam as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>

                                     <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 ?>

                                    <td width="130" colspan="8" style="text-align:right;"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                                    <td width="60" colspan="7">&nbsp;</td>


                                </tr>
								<?
								unset($batch_qnty_sam);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="28" align="left" ><b style="margin-left:0px"><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}
					$order_id=$batch[csf('po_id')];
					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$hour_meter_load=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
					$ref_no=implode(",",array_unique(explode(",",$batch[csf('grouping')])));
					$batch_no=$batch[csf('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>

                          <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <? } if($group_by==2 || $group_by==0){ ?>

                        <? } ?>
                        <td width="70"><p><? echo $file_no; ?></p></td>
                        <td width="80"><p><? echo $ref_no; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>


                        <td width="100"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><div style="width:70px; word-wrap:break-word;"><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></div></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>



                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						$unloaded_date=change_date_format($batch[csf('process_end_date')]);
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unloaded_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                          <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						  echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td width="100" align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center" title="<?  echo $batch[csf('remarks')];   ?>"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					if($batch[csf('result')]==1){
						$total_sum_trims_qnty+=$tot_trim_qty;
						 }
						  else {
						 $tot_trims_qnty+=0;
						  }
					$i++;
					$batch_qnty_sam+=$batch[csf('batch_qnty')];
					$total_trim_qty+=$tot_trim_qty;
					$grand_total_batch_qty_sam+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <th width="30">&nbsp;</th>

                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>

                    <? } ?>

                    <th width="130" colspan="8" style="text-align:right;"><strong>Sub. Total : </strong></th>
                    <th width="70"><? echo number_format($batch_qnty_sam,2); ?></th>
                  	<th width="60" colspan="7">&nbsp;</th>

                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>

                     <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>

                    <? } ?>

                    <th width="130" colspan="8" style="text-align:right;"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty_sam,2); ?></th>
                    <th width="60"><? echo number_format($total_trim_qty,2);?></th>


                    <th width="75" colspan="6">&nbsp;</th>
                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
			?>


            <?
		}
		?>
		</fieldset>

		<?
		//==================================================================================end====================
		} //Dyeing Production End


	exit();
}

if($action=='batch_fabric_dtls_popup')
{
	$process = array( &$_POST );
	extract(check_magic_quote_gpc( $process ));
	if($db_type==0) $year_field_by="and YEAR(a.insert_date)";
	else if($db_type==2) $year_field_by=" and to_char(a.insert_date,'YYYY')";
	if($db_type==0) $field_concat="concat(machine_no,'-',brand) as machine_name";
	else if($db_type==2) $field_concat="machine_no || '-' || brand as machine_name";
	// machine_no || '-' || brand as machine_name
	$company = str_replace("'","",$cbo_company_name);
	$buyer = str_replace("'","",$cbo_buyer_name);
	$job_number = str_replace("'","",$job_number);
	$job_number_id = str_replace("'","",$job_number_show);
	$batch_no = str_replace("'","",$batch_number_show);
	$color = str_replace("'","",$txt_color);
	$machine=str_replace("'","",$txt_machine_id);
	$floor_name=str_replace("'","",$cbo_floor_id);

	//echo $batch_no;die;
	$batch_number_hidden = str_replace("'","",$batch_number);
	$ext_num = str_replace("'","",$txt_ext_no);
	$hidden_ext = str_replace("'","",$hidden_ext_no);
	$txt_order = str_replace("'","",$order_no);
	$file_no = str_replace("'","",$file_no);
	$ref_no = str_replace("'","",$ref_no);
	$hidden_order = str_replace("'","",$hidden_order_no);
	$cbo_type = str_replace("'","",$cbo_type);
	$cbo_result_name = str_replace("'","",$cbo_result_name);
	$year = str_replace("'","",$cbo_year);
	$shift = str_replace("'","",$cbo_shift_name);
	//echo $cbo_type;die;
	$txt_date_from = str_replace("'","",$txt_date_from);
	$txt_date_to = str_replace("'","",$txt_date_to);
	//$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	//if ($job_number==0) $sub_job_cond=""; else $sub_job_cond="  and d.job_no_prefix_num='".$job_number."' ";
	if ($buyer==0) $sub_buyer_cond=""; else $sub_buyer_cond="  and d.party_id='".$buyer."' ";
	if ($cbo_result_name==0) $result_name_cond=""; else $result_name_cond="  and f.result='".$cbo_result_name."' ";
	if ($shift==0) $shift_name_cond=""; else $shift_name_cond="  and f.shift_name='".$shift."' ";
	if ($machine=="") $machine_cond=""; else $machine_cond =" and f.machine_id in ( $machine ) ";
	if ($floor_name==0 || $floor_name=='') $floor_id_cond=""; else $floor_id_cond=" and f.floor_id=$floor_name";

	if ($buyer==0) $buyerdata=""; else $buyerdata="  and d.buyer_name='".$buyer."' ";
	if ($buyer==0) $buyerdata2=""; else $buyerdata2="  and h.buyer_id='".$buyer."' ";
	if ($batch_no=="") $batch_num=""; else $batch_num="  and a.batch_no='".trim($batch_no)."' ";

	if ($batch_no=="") $unload_batch_cond=""; else $unload_batch_cond="  and batch_no='".trim($batch_no)."' ";
	if ($batch_no=="") $unload_batch_cond2=""; else $unload_batch_cond2="  and f.batch_no='".trim($batch_no)."' ";

	//$buyerdata=($buyer)?' and d.buyer_name='.$buyer : '';
	//$batch_num=($batch_no)?" and a.batch_no='".$batch_no."'" : '';

	//echo $cbo_batch_type;
	if(trim($ext_no)!="") $ext_no_search="%".trim($ext_no)."%"; else $ext_no_search="%%";
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
	{
		if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
		if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
		if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}

	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
	{
		if ($txt_order!='') $suborder_no="and c.order_no='$txt_order'"; else $suborder_no="";
		if ($job_number_id!='') $sub_job_cond="  and d.job_no_prefix_num='".$job_number_id."' "; else $sub_job_cond="";
	}
	if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3)
	{
	if ($txt_order!='') $order_no="  and c.po_number='$txt_order'"; else $order_no="";
	if ($file_no!='') $file_cond="  and c.file_no=$file_no"; else $file_cond="";
	if ($ref_no!='') $ref_cond="  and c.grouping='$ref_no'"; else $ref_cond="";
		$jobdata=($job_number_id )? " and d.job_no_prefix_num='".$job_number_id ."'" : '';
	}
	if ($color=="") $color_name=""; else $color_name="  and g.color_name='$color'";
	//echo $order_no;die;
	if ($ext_num=="") $ext_no=""; else $ext_no="  and a.extention_no=$ext_num ";
	if(trim($year)!=0) $year_cond=" $year_field_by=$year"; else $year_cond="";
	//echo date("Y-n-j", strtotime("first day of previous month"));
	//echo date("Y-n-j", strtotime("last day of previous month"));
	if($txt_date_from && $txt_date_to)
	{
		if($db_type==0)
		{

			$date_from=change_date_format($txt_date_from,'yyyy-mm-dd');
			$date_to=change_date_format($txt_date_to,'yyyy-mm-dd');
			$second_month_ldate=date("Y-m-t",strtotime($date_to));
			$dateFrom= explode("-",$date_from);
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-m',strtotime($date_to));
			$prod_last_day=change_date_format($second_month_ldate,'yyyy-mm-dd');
			$dates_com=" and  f.process_end_date BETWEEN '$date_from' AND '$date_to' ";
			$prod_date_upto=" and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day' ";
		}
		elseif($db_type==2)
		{

			$date_from=change_date_format($txt_date_from,'','',1);
			$date_to=change_date_format($txt_date_to,'','',1);
			$dateFrom= explode("-",$date_from);
			//echo $dateto[1];
			$fromdate="01".'-'.$dateFrom[1].'-'.$dateFrom[2];
			//$prod_date_to=change_date_format($today_date,'','',1);
			$second_month_ldate=date("Y-M-t",strtotime($date_to));
			//$last_day= date("t", strtotime($date_to));
			//$last_day= date('d',strtotime($date_to));
			//$last_date=date('Y-M',strtotime($date_to));
		    $prod_last_day=change_date_format($second_month_ldate,'','',1);
			$dates_com="and  f.process_end_date BETWEEN '$date_from' AND '$date_to'";
			$prod_date_upto="and  f.process_end_date BETWEEN '$fromdate' AND '$prod_last_day'";
		}
	}
	$yarn_lot_arr=array();
	if($db_type==0)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, group_concat(distinct(a.yarn_lot)) as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!=''  group by a.prod_id, b.po_breakdown_id");
	}
	else if($db_type==2)
	{
		$yarn_lot_data=sql_select("select b.po_breakdown_id, a.prod_id, LISTAGG(CAST(a.yarn_lot AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.yarn_lot)  as yarn_lot from pro_grey_prod_entry_dtls a, order_wise_pro_details b where a.id=b.dtls_id and b.entry_form in(2,22) and a.status_active=1 and a.is_deleted=0 and b.status_active=1 and b.is_deleted=0 and a.yarn_lot!='0' group by a.prod_id, b.po_breakdown_id");
	}
	foreach($yarn_lot_data as $rows)
	{
		$yarn_lot=explode(",",$rows[csf('yarn_lot')]);
		$yarn_lot_arr[$rows['prod_id']][$rows['po_breakdown_id']]=implode(",",array_unique($yarn_lot));
	}
		//print_r($yarn_lot_arr);
	$load_hr=array();
	$load_min=array();
	$load_date=array();
	$water_flow_arr=array();$load_hour_meter_arr=array();
	$load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=35 and company_id=$company $unload_batch_cond and status_active=1  and is_deleted=0 ");
	foreach($load_time_data as $row_time)// for Loading time
	{
		$load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_load_hr=array();
	$subcon_load_min=array();
	$subcon_load_date=array();$subcon_load_hour_meter_arr=array();
	$subcon_water_flow_arr=array();
	$subcon_load_time_data=sql_select("select batch_id,water_flow_meter,batch_no,load_unload_id,process_end_date,end_hours,hour_load_meter,end_minutes from pro_fab_subprocess where load_unload_id=1 and entry_form=38 and company_id=$company  and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
		$subcon_load_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
		$subcon_load_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
		$subcon_load_date[$row_time[csf('batch_id')]]=$row_time[csf('process_end_date')];
		$subcon_water_flow_arr[$row_time[csf('batch_id')]]=$row_time[csf('water_flow_meter')];
		$subcon_load_hour_meter_arr[$row_time[csf('batch_id')]]=$row_time[csf('hour_load_meter')];
	}
	$subcon_unload_hr=array();
	$subcon_unload_min=array();
	$subcon_unload_date=array();
	$subcon_unload_time_data=sql_select("select batch_id,batch_no,load_unload_id,production_date,end_hours,end_minutes from pro_fab_subprocess where load_unload_id=2 and entry_form=38 and company_id=$company and status_active=1  and is_deleted=0 ");
	foreach($subcon_load_time_data as $row_time)// for Loading time
	{
	$subcon_unload_hr[$row_time[csf('batch_id')]]=$row_time[csf('end_hours')];
	$subcon_unload_min[$row_time[csf('batch_id')]]=$row_time[csf('end_minutes')];
	$subcon_unload_time_data[$row_time[csf('batch_id')]]=$row_time[csf('production_date')];
	}
	//var_dump($load_hr);

	$m_capacity=array();
	$unload_min=array();
	$machine_arr=return_library_array( "select id,$field_concat from  lib_machine_name order by seq_no ",'id','machine_name');
	$machine_capacity_data=sql_select("select id,prod_capacity as m_capacity  from lib_machine_name where status_active=1  and is_deleted=0 ");
	foreach($machine_capacity_data as $capacity)// for Un-Loading time
	{
		$m_capacity[$capacity[csf('id')]]=$capacity[csf('m_capacity')];
	}

	$sql_batch_id=sql_select("select f.batch_id from  pro_fab_subprocess f where f.entry_form=35 and f.load_unload_id=2 and f.status_active=1 and f.is_deleted=0  $unload_batch_cond2 $dates_com ");
	$tot_row=1;
	foreach($sql_batch_id as $row_batch)
	{
		if($tot_row!=1) $batch_id.=",";
		$batch_id.=$row_batch[csf('batch_id')];

		$tot_row++;
	}//echo $batch_id;die;
		unset($sql_batch_id);
		$batchIds=chop($batch_id,','); $batchIds_cond="";
		if($db_type==2 && count($tot_row)>990)
		{
			$batchIds_cond=" and (";
			$batchIdsArr=array_chunk(explode(",",$batchIds),990);
			foreach($batchIdsArr as $ids)
			{
				$ids=implode(",",$ids);
				$batchIds_cond.=" a.id not in($ids) or ";
			}
			$batchIds_cond=chop($batchIds_cond,'or ');
			$batchIds_cond.=")";
		}
		else
		{
			$batchIds_cond=" and a.id not in($batchIds)";
		}
		//echo $batchIds_cond;
	$sub_sql_batch_id=sql_select("select batch_id from  pro_fab_subprocess where entry_form=38 and load_unload_id=2 and status_active=1 and is_deleted=0");
	$k=1;
	foreach($sub_sql_batch_id as $row_batch)
	{
		if($k!=1) $sub_batch_id.=",";
		$sub_batch_id.=$row_batch[csf('batch_id')];

		$k++;
	}
	if($batch_id=="") $batch_id=0;
	if($sub_batch_id=="") $sub_batch_id=0;
	$group_by=str_replace("'",'',$cbo_group_by);
	if($group_by==1)
	{
		$order_by="order by f.floor_id";
		$order_by2="order by floor_id";
	}
	else if($group_by==2)
	{
		$order_by="order by f.shift_name";
		$order_b2y="order by shift_name";
	}
	else if($group_by==3)
	{
		$order_by="order by f.machine_id";
		$order_by2="order by machine_id";
	}
	else
	{
		$order_by="order by f.process_end_date,f.machine_id";
		$order_by2="order by process_end_date,machine_id";
	}

		if($db_type==2)
		{
		 $grp_con="LISTAGG(CAST(c.po_number AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id,LISTAGG(CAST(c.grouping AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS grouping,LISTAGG(CAST(c.file_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS file_no";
		  $grp_sub_con="LISTAGG(CAST(c.order_no AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_number,LISTAGG(CAST(b.po_id AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS po_id";
		}
		else if($db_type==0)
		{
			 $grp_con="group_concat(distinct c.po_number) AS po_number,group_concat(distinct b.po_id) AS po_id,group_concat(distinct c.grouping) AS grouping,group_concat(distinct c.file_no) AS file_no";
			  $grp_sub_con="group_concat(distinct c.order_no) AS po_number,group_concat(distinct b.po_id) AS po_id";
		}
			//if($db_type==2) $group_con2="LISTAGG(CAST(b.width_dia_type AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS width_dia_type,LISTAGG(CAST(b.item_description AS VARCHAR2(4000)),',') WITHIN GROUP ( ORDER BY a.id) AS item_description";
			//else if($db_type==0) $group_con2=",group_concat(b.width_dia_type) AS width_dia_type,group_concat(b.item_description) AS item_description";

		if($cbo_type==2)//   For Order Wise Dyeing Production
		{
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
			{
			$sql="(select a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight,SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.prod_id, b.width_dia_type, $grp_con, d.job_no_prefix_num, d.buyer_name,f.remarks, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type, f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d,  pro_fab_subprocess f, lib_color g, pro_batch_create_mst a where a.company_id=$company and f.batch_id=a.id $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id,a.total_trims_weight, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,d.job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.remarks,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,f.fabric_type,f.result,a.booking_no,a.booking_without_order)
			 union
			 (
			 	select a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty,b.item_description, b.prod_id, b.width_dia_type,null as po_number ,null as po_id,null as grouping, null as file_no, null as job_no_prefix_num,h.buyer_id as buyer_name,f.remarks,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date,
    f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result,a.booking_no,a.booking_without_order from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no and a.company_id=$company and f.batch_id=a.id  and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(1,2) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  $dates_com  $batch_num  $color_name  $buyerdata2 $result_name_cond $shift_name_cond $machine_cond $floor_id_cond GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type,
              f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter,
              f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result,f.remarks
			 ) $order_by2";
			}
			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
			{
				 $sql_subcon="select a.batch_no,a.id, a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS sub_batch_qnty, b.item_description, b.prod_id, b.width_dia_type,$grp_sub_con, d.job_no_prefix_num, d.party_id as buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type, f.result from pro_batch_create_dtls b, subcon_ord_dtls c, subcon_ord_mst d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where a.company_id=$company and f.batch_id=a.id and a.entry_form=36 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=38 and f.load_unload_id=2 and a.batch_against in(1,2)  and b.po_id=c.id and d.subcon_job=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  $dates_com $sub_job_cond $batch_num  $sub_buyer_cond $suborder_no  $result_name_cond $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond
				GROUP BY a.batch_no, a.id,a.batch_weight, a.color_id, a.extention_no,a.total_trims_weight, b.item_description,b.prod_id, b.width_dia_type, d.job_no_prefix_num, d.party_id, f.shift_name, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,f.result $order_by";
			}

			if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
			{
				  $sql_sam="(select a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description, b.prod_id, b.width_dia_type,$grp_con, d.job_no_prefix_num, d.buyer_name, f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id,f.hour_unload_meter, f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, fabric_type,f.result from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where a.company_id=$company and f.batch_id=a.id $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond $file_cond $ref_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type, d.job_no_prefix_num, d.buyer_name, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no,c.file_no,c.grouping, f.result )
			 union
			 (
			 select a.booking_without_order,a.booking_no,a.batch_no, a.batch_weight,a.id, a.color_id, a.extention_no,a.total_trims_weight, SUM(b.batch_qnty) AS batch_qnty, b.item_description,b.prod_id, b.width_dia_type,null as po_number, null as po_id,null as grouping, null as file_no,null as job_no_prefix_num, h.buyer_id as buyer_name,f.shift_name, f.production_date as process_end_date,f.process_end_date as production_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id, f.fabric_type,f.result from pro_batch_create_dtls b, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g,wo_non_ord_samp_booking_mst h where h.booking_no=a.booking_no and a.company_id=$company and f.batch_id=a.id $dates_com  $batch_num  $buyerdata2 $color_name  $result_name_cond $shift_name_cond $machine_cond $floor_id_cond and a.entry_form=0 and g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and a.batch_against in(3) and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0
			 GROUP BY a.batch_no, a.batch_weight,a.id,h.buyer_id, a.color_id, a.extention_no, b.item_description, b.prod_id, b.width_dia_type, f.shift_name,a.total_trims_weight, f.production_date,f.process_end_date, f.end_hours, f.floor_id, f.hour_unload_meter,f.water_flow_meter, f.end_minutes, f.machine_id, f.load_unload_id,fabric_type,a.booking_without_order,a.booking_no, f.result)  $order_by2";
			}
		}

		//$batchdata=sql_select($sql);
		//echo $sql_subcon; die;sql_subcon_ltb

	if($cbo_type==2) // Dyeing Production
	{

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		{
			//echo $sql;
			$batchdata=sql_select($sql);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			//echo $sql_subcon;
			$sql_subcon_data=sql_select($sql_subcon);
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) //Batch Aganist - Sample
		{
			//echo $sql_sam;
			$batchdata_sam=sql_select($sql_sam);
		}
	//print_r($sql_subcon_data);
	}



	ob_start();
	if($cbo_type==2) //  Dyeing Production
	{
		?>
		<div>
		<fieldset style="width:1350px;">
		<div align="center"><strong> <? echo $company_library[$company]; ?> </strong><br> <strong> Daily Dyeing Production </strong><br>
		<?
			//echo  change_date_format($date_from).' '.To.' '.change_date_format($date_to);
			echo  ($date_from == '0000-00-00' || $date_from == '' ? '' : change_date_format($date_from)).' To ';echo  ($date_to == '0000-00-00' || $date_to == '' ? '' : change_date_format($date_to));
			?>
		 </div>
		 <?
		 if ($cbo_result_name==1 || $cbo_result_name==0)
		 {
		 ?>
		 <div>
         <table cellpadding="0"  width="300" cellspacing="0" align="left"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="3">Production Summary</th>
								</tr>
								<tr>
									<th>Details </th>
									<th>Prod. Qty. </th>
									<th>%</th>
								</tr>
							</thead>
							<tbody>
							<?
							if ($cbo_result_name==0 || $cbo_result_name==1) $result_name_cond_summary=" and f.result=1"; else $result_name_cond_summary=" ";
							if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1 || str_replace("'",'',$cbo_batch_type)==3)
							{
							 $sql="select f.load_unload_id,f.process_end_date,count(f.process_end_date) as row_count,
							 sum(CASE WHEN a.batch_against in(1,2) THEN b.batch_qnty ELSE 0 END) AS batch_qnty,
							 sum(CASE WHEN a.batch_against in(2) THEN b.batch_qnty ELSE 0 END) AS re_batch_qnty

							  from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where a.company_id=$company and f.batch_id=a.id and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2 and f.result=1 and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  $prod_date_upto $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary GROUP BY f.load_unload_id,f.process_end_date  ";
							$sql_datas=sql_select($sql);
							}
							$unload_qty_arr=array();$plan_cycle_time=0;$reprocess_qty_arr=array();$tot_reprocess_qty=0;
							foreach($sql_datas as $row)
							{
								$tot_row=count($row[csf('process_end_date')]);
								$unload_qty_arr[$row[csf('load_unload_id')]]['qty']+=$row[csf('batch_qnty')];
								//$reprocess_qty_arr[2]['bqty']+=$row[csf('batch_qnty')];
								 $tot_reprocess_qty+=$row[csf('re_batch_qnty')];
								$unload_qty_arr[$row[csf('load_unload_id')]]['count']+=$tot_row;
							}
							//print_r($unload_qty_arr);
							$total_current_mon_qty=$unload_qty_arr[2]['qty'];
							$total_count=$unload_qty_arr[2]['count'];
							$total_reprocess_qty=$tot_reprocess_qty;

							 $sql_result="select f.fabric_type,f.process_end_date,
							 SUM(b.batch_qnty) AS batch_qnty from pro_batch_create_dtls b, wo_po_break_down c, wo_po_details_master d, pro_batch_create_mst a, pro_fab_subprocess f, lib_color g where a.company_id=$company and f.batch_id=a.id and a.entry_form=0 and  g.id=a.color_id and a.id=b.mst_id and f.entry_form=35 and f.load_unload_id=2  and a.batch_against in(1,2)  and b.po_id=c.id and d.job_no=c.job_no_mst and b.status_active=1 and b.is_deleted=0 and a.status_active=1 and a.is_deleted=0  and f.fabric_type in(1,4,5,6) $dates_com $jobdata $batch_num $buyerdata $order_no $year_cond $color_name $shift_name_cond $machine_cond $floor_id_cond  $result_name_cond_summary GROUP BY f.fabric_type,f.process_end_date  ";
							$sql_result=sql_select($sql_result);
							$fabric_batch_arr=array();
							foreach($sql_result as $row)
							{
								$fabric_batch_arr[$row[csf('fabric_type')]]['qty']+=$row[csf('batch_qnty')];
								//$tot_batch_qty+=$row[csf('batch_qnty')];
							}
							//print_r($fabric_batch_arr);

								?>
								  <tr bgcolor="#E9F3FF" style="cursor:pointer;">

									  <td>Current Month</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty,2);?></td>
									  <td align="right"><?  ?></td>
								  </tr>
                                  <tr bgcolor="#D8D8D8" style="cursor:pointer;">

									  <td>Avg. Prod. Per Day</td>
                                       <td align="right"><? echo number_format($total_current_mon_qty/$total_count,2); ?></td>
									  <td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
								  </tr>
                                   <tr bgcolor="#D8D8D8" style="cursor:pointer;">

									  <td>ReProcess Current Month</td>
                                       <td align="right"><? echo number_format($total_reprocess_qty,2); ?></td>
									  <td align="right"><? //echo $total_current_mon_qty/$total_count; ?></td>
								  </tr>
                                  <? $k=1;	$tot_batch_qty=0;
								 //$fabric_type_for_dyeing2=array(1=>'Cotton',2=>'Polyster',3=>'Lycra',4=>'Both Part',5=>'White',6=>'Wash');

								  //print_r($fabric_type_for_dyeingnn);
								  foreach($fabric_batch_arr as $typekey=>$val)
								  	{
										if ($k%2==0) $bgcolor="#FFFFFF"; else $bgcolor="#E9F3FF";
										if($typekey==1)
										{
											$fab_type="Cotton";
										}
										else if($typekey==2)
										{
											$fab_type="Polyster";
										}
										else if($typekey==3)
										{
											$fab_type="Lycra";
										}
										else if($typekey==4)
										{
											$fab_type="Both Part";
										}
										else if($typekey==5)
										{
											$fab_type="White";
										}
										else if($typekey==6)
										{
											$fab_type="Wash";
										}
											  ?>
                                   <tr bgcolor="<? echo $bgcolor;?>">
									 <? //print_r($fabric_type_for_dyeing);?>
									  <td><?php echo $fab_type; //$fabric_type_for_dyeing[$typekey];   ?></td>
                                       <td align="right"><? echo number_format($val['qty'],2); ?></td>
									  <td align="right"><? echo number_format(($val['qty']/$total_current_mon_qty)*100,2); ?></td>
								  </tr>
							<? 		$tot_batch_qty+=$val['qty'];
								  	$k++;
									}

							?>
							</tbody>
							<tfoot>
								<tr>
									<th align="right">Total </th>
									<th align="right"><b><? echo number_format($tot_batch_qty,2,'.','');?></b> </th>
									<th align="right"><? echo number_format(($tot_batch_qty/$total_current_mon_qty*100),2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>

			<table cellpadding="0"  width="1210" cellspacing="0" align="left" >
				 <tr>

						 <!-- kaiyum self n trims batch (shade match)-->

						 <!-- kaiyum subcontact batch (shade match)-->
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="5">Re Process Summary</th>
								</tr>
								<tr>

                                    <th>SL</th>
                                    <th>Buyer</th>
									<th>Batch Total</th>
                                    <th>%</th>

								</tr>
							</thead>
							<tbody>
                            <?
                            	$k=1;$total_batch_qty_reproc=0;$tot_batch_per_re=0;
							foreach($buyer_re_process_arr as $key=>$val)
							{

								 if ($k%2==0) $bgcolor="#E9F3FF"; else $bgcolor="#FFFFFF";
								//$trims_qty=$party_batch_arr[$key]['trims_weight'];
								 $trims_qty_sum=$val['trims']; //total_batch_qty_re
								?>
								  <tr bgcolor="<? echo $bgcolor; ?>" style="cursor:pointer;">
									  <td><? echo $k; ?></td>
									  <td><? echo $buyer_arr[$key] ?></td>
									  <td align="right"><? echo number_format($val['re_qty']+$trims_qty_sum,2,'.',''); $total_batch_qty_reproc+=$val['re_qty']+$trims_qty_sum; ?></td>
									  <td align="right"><? $batch_per=(($val['re_qty']+$trims_qty_sum)/$total_batch_qty_re)*100; echo number_format($batch_per,2,'.','').'%'; ?></td>
								  </tr>
							<?
							$tot_batch_per_re+=$batch_per;
							$k++;

							}
								  ?>
							</tbody>
                            <tfoot>
								<tr>
									<th colspan="2" align="right">Total </th>
									<th align="left"><b><? echo number_format($total_batch_qty_reproc,2,'.','');?></b> </th>
									<th align="right"><? echo number_format($tot_batch_per_re,2,'.','').'%'; ?></th>
								</tr>
							</tfoot>
						</table>
					 </td>

					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead>
								<tr>
									<th colspan="5">Summary Total(Shade Match)</th>
								</tr>
								<tr>
									<th>Self Batch</th>
									<th>Sample Batch</th>
                                    <th>SubCon Batch</th>
									<th>Total</th>
								</tr>
							</thead>
							<tbody>
								 <tr bgcolor="#FFFFFF"  style="cursor:pointer;">
									  <td width="30"><? echo number_format($total_batch_qty,2); ?></td>
                                      <td width="30"><? echo number_format($total_batch_qty_sam,2); ?></td>
									  <td width="30"><? echo number_format($total_sub_batch_qty,2); ?></td>
									  <td width="30"><? $grand_total=$total_batch_qty+$total_sub_batch_qty+$total_batch_qty_sam;echo number_format($grand_total,2); ?></td>
								  </tr>
								  <tr bgcolor="#E9F3FF">
								   <td><?  echo number_format(($total_batch_qty/$grand_total)*100,2).'%'; ?></td>
                                   <td><?  echo number_format(($total_batch_qty_sam/$grand_total)*100,2).'%'; ?></td>
									  <td><?  echo number_format(($total_sub_batch_qty/$grand_total)*100,2).'%'; ?></td>
									  <td><?  echo '100%'; ?></td>
								  </tr>
							</tbody>
						</table>
					 </td>

				 </tr>
			 </table>
		 </div>
		 <br />
		 <?
		}
		 if ($cbo_result_name!=1 || $cbo_result_name==0)
		 {
		 ?>
		  <div>
          	<table cellpadding="0" style="border:0"  width="300" cellspacing="0" align="left"  class="rpt_table" rules="all" border="0">

            <tr>
                <th colspan="4"></th>
            </tr>

			</table>
			 <table cellpadding="0"  width="1210" cellspacing="0" align="left" >
				 <tr>
					 <td width="300">
						 <!-- kaiyum Self n Trims Batch (Not Shade Match) -->
					 </td>
                     <td width="50"></td>
					 <td width="300">
                     <td width="300">
						 <!-- kaiyum Sample n Trims Batch(Not Shade Match) -->
					 </td>
					 <td width="50"></td>
					 <td width="300">
						 <!-- kaiyum SubContact Batch (Not Shade Match) -->
					 </td>
                     <td width="50"></td>
					 <td width="300">
						 <table cellpadding="0"  width="300" cellspacing="0" align="center"  class="rpt_table" rules="all" border="1">
							<thead style="display:none">
								<tr>
									<th colspan="5"></th>
								</tr>
								<tr>
									<th></th>
                                    <th></th>
									<th></th>
									<th></th>
								</tr>
							</thead>
							<tbody style="display:none">
								 <tr bgcolor="#FFFFFF"  style="cursor:pointer;">
									  <td width="30"><? //echo $total_batch_qty_not; ?></td>
                                      <td width="30"><? //echo $total_batch_qty_not_samp; ?></td>
									  <td width="30"><? //echo $total_sub_batch_qty_not; ?></td>
									  <td width="30"><?  //echo $grand_total_not=$total_batch_qty_not+$total_sub_batch_qty_not+$total_batch_qty_not_samp; ?></td>
								  </tr>
								  <tr bgcolor="#E9F3FF">
								   <td><?  //echo number_format(($total_batch_qty_not/$grand_total_not)*100,2).'%'; ?></td>
                                   <td><?  //echo number_format(($total_batch_qty_not_samp/$grand_total_not)*100,2).'%'; ?></td>
									  <td><?  //echo number_format(($total_sub_batch_qty_not/$grand_total_not)*100,2).'%'; ?></td>
									  <td><? // echo '100%'; ?></td>
								  </tr>
							</tbody>
						</table>
					 </td>
					 <td width="50"></td>
					 <td width="300">
						<!-- kaiyum Summary Total( Not Shade Match) -->
					 </td>
				 </tr>
			 </table>
		 </div>
		 <br/>
		 <?
		 }
		 if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==1)
		 {
			if (count($batchdata)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left">


			 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_1">
              <caption> <b>Self batch  </b></caption>
              <!--working hereeeeeeeeeeeee self batch -->
                <thead>
                    <tr>
                        <th width="30">SL</th>


                       <? if($group_by==3 || $group_by==0){ ?>
                    	 <th width="80">M/C No</th>
                   		 <? } ?>

                        <th width="60">File No</th>
                        <th width="70">Ref. No</th>
                        <th width="100">Buyer</th>

                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/Width Type</th>
                        <th width="80">Color Name</th>
                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Wgt.</th>



                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab. Type</th>
                        <th width="100">Result</th>
                        <th width="">Remark</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:1390px; overflow-y:scroll;" id="scroll_body">
            <table class="rpt_table" id="table_body" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$total_water_cons_load=0;$total_water_cons_unload=0;
                $batch_chk_arr=array(); $group_by_arr=array();$tot_trims_qnty=0;$trims_check_array=array();
                foreach($batchdata as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)
						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>


                                    <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <? } ?>

                                    <td width="60">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="130" colspan="8"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty,2); ?></td>
                                    <td width="70"><? //echo number_format($btq,2); ?></td>


                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>
								<?
								unset($batch_qnty);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="30"  ><b style="margin-left:900px"><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}


					$order_id=$batch[csf('po_id')];

					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$load_hour_meter=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
					$ref_no=implode(",",array_unique(explode(",",$batch[csf('grouping')])));

					$batch_no=$batch[csf('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}

					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="tr_<? echo $i; ?>" onClick="change_color('tr_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>

                         <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <?
						 }
						 if($group_by==2 || $group_by==0){ ?>

                        <? } if($group_by==1 || $group_by==0){ ?>

                        <? } ?>
                        <td align="center" width="60"><p><? echo $file_no; ?></p></td>
                        <td align="center" width="70"><p><? echo $ref_no; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>

                        <td width="100"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>

                       <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>




                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                        <td align="center" width="100"><p><?
						if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td align="center" width="100"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty+=$batch[csf('batch_qnty')];
					$total_water_cons_load+=$water_cons_load;
					$total_water_cons_unload+=$water_cons_unload;
					$tot_trims_qnty+=$tot_trim_qty;
					$grand_total_batch_qty+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <td width="30">&nbsp;</td>

                    <? if($group_by==3 || $group_by==0){ ?>
                    <td width="80">&nbsp;</td>
                     <? } ?>

                    <td width="60">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td width="70">&nbsp;</td>
                    <td width="80">&nbsp;</td>
                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                    <td width="70"><? echo number_format($batch_qnty,2); ?></td>
                    <td width="70"><? //echo number_format($btq,2); ?></td>
                    <td width="75">&nbsp;</td>
                    <td width="75">&nbsp;</td>
                    <td width="60">&nbsp;</td>
                     <td width="100">&nbsp;</td>
                    <td width="100">&nbsp;</td>
                    <td>&nbsp;</td>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>

                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>

                    <? } ?>
                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>

                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="8"><strong>Trims Total : </strong></th>
                    <th width="70"><? echo number_format($tot_trims_qnty,2); ?></th>
                    <th colspan="10">&nbsp; </th>

                </tr>
                <tr>
                    <th width="30">&nbsp;</th>
                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } ?>

                    <th width="60">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80"><? //echo $total_water_cons_load;?></th>
                    <th width="130" colspan="8"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty+$tot_trims_qnty,2); ?></th>
                    <th colspan="10"> </th>
                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
		}
		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==2)
		{
			if(count($sql_subcon_data)>0)
			{
		?>
		 <div align="left">
		  <div> <b> Subcon batch</b> </div>
		 <table class="rpt_table" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_2">
				<thead>
					<tr>
						<th width="30">SL</th>
						<th width="80">Prod. Date</th>
						<th width="80">M/C No</th>
						<th width="80">Floor</th>
						<th width="80">Shift Name</th>
						<th width="100">Buyer</th>
						<th width="80">Job</th>
						<th width="90">PO No</th>
						<th width="100">Fabrics Desc</th>
						<th width="70">Dia/Width Type</th>
						<th width="80">Color Name</th>
						<th width="90">Batch No</th>
						<th width="40">Extn. No</th>
						<th width="70">Dyeing Qty.</th>
                        <th width="60">Hour Load Meter</th>
                        <th width="60">Hour unLoad Meter</th>
						<th width="60">Total Time</th>
						<th width="50">Lot No</th>
                        <th width="60">Water Loading Flow</th>
                        <th width="60">Water UnLoading Flow</th>
                        <th width="70">Water Cons.</th>
						<th width="75">Load Date & Time</th>
						<th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fab Type</th>
						<th>Result</th>
					</tr>
				</thead>
		</table>
		<div style=" max-height:350px; width:1910px; overflow-y:scroll;;" id="scroll_body">
		<table class="rpt_table" id="table_body2" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
		<tbody>
					<?
					$i=1;
					$btq=0;$trims_btq_sub=0;
					$batch_chk_arr=array();
					foreach($sql_subcon_data as $batch)
					{
					if ($i%2==0)
					$bgcolor_sub2="#E9F3FF";
					else
					$bgcolor_sub2="#FFFFFF";
					$order_id=$batch[csf('po_id')];
					$color_id=$batch[csf('color_id')];
					$batch_weight_sub=$batch[csf('batch_weight')];
					$water_cons_unload_sub=$batch[csf('water_flow_meter')];
					$water_cons_load_sub=$subcon_water_flow_arr[$batch[csf('id')]];
					$load_hour_meter_sub=$subcon_load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff_sub=($water_cons_unload_sub-$water_cons_load_sub)/$batch_weight_sub*1000;
					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));

					//echo $load_hr[$batch[csf('id')]].'ddddd';
					//echo $batch[csf('id')];
					?>
					<tr bgcolor="<? echo $bgcolor_sub2; ?>" id="trsub_<? echo $i; ?>" onClick="change_color('trsub_<? echo $i; ?>','<? echo $bgcolor; ?>')">
						<td width="30"><? echo $i; ?></td>
						<td width="80"><p><? echo ($batch[csf('production_date')] == '0000-00-00' || $batch[csf('production_date')] == '' ? '' : change_date_format($batch[csf('production_date')])); $unload_date=$batch[csf('process_end_date')]; ?></p></td>
						<td  align="center" width="80" title="<? echo $machine_arr[$batch[csf('machine_id')]]; ?>"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $floor_arr[$batch[csf('floor_id')]];  ?>"><p><? echo $floor_arr[$batch[csf('floor_id')]]; ?></p></td>
						<td  align="center" width="80" title="<? echo $shift_name[$batch[csf('shift_name')]];  ?>"><p><? echo $shift_name[$batch[csf('shift_name')]]; ?></p></td>
						<td  width="100" title="<? echo $buyer_arr[$batch[csf('buyer_name')]]; ?>"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>
						<td  width="80" title="<? echo  $batch[csf('job_no_prefix_num')]; ?>"><p><? echo $batch[csf('job_no_prefix_num')]; ?></p></td>
						<td  width="90" title="<? echo $po_number; ?>"><p><? echo $po_number; ?></p></td>
						<td  width="100" title="<? echo $batch[csf('item_description')];?>"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
						<td  width="70" title="<? echo  $fabric_typee[$batch[csf('width_dia_type')]]; ?>"><p><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></p></td>
						<td  width="80" title="<? echo $color_library[$batch[csf('color_id')]]; ?>"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
						<td  align="center" width="90" title="<? echo $batch[csf('batch_no')]; ?>"><p><? echo $batch[csf('batch_no')]; ?></p></td>
						<td  align="center" width="40" title="<? echo $batch[csf('extention_no')]; ?>"><p><? echo $batch[csf('extention_no')]; ?></p></td>
						<td align="right" width="70" title="<? echo $batch[csf('batch_qnty')];  ?>"><? echo number_format($batch[csf('sub_batch_qnty')],2);  ?></td>

                          <td width="60" align="right"><p><? echo $load_hour_meter_sub;  ?></p></td>
                           <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')];  ?></p></td>
                          <td width="60" align="right"><p><? echo $batch[csf('hour_unload_meter')]-$load_hour_meter_sub;  ?></p></td>
						<td align="left" width="50" title="<? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]]; ?>"><p><? echo $yarn_lot_arr[$batch[csf('prod_id')]][$batch[csf('po_id')]];  ?></p></td>
                        <td width="60"><p><? echo $water_cons_load_sub;  ?></p></td>
                        <td width="60"><p><? echo $water_cons_unload_sub;  ?></p></td>

                        <td align="right" width="70" title="<? echo number_format($water_cons_diff_sub,2);  ?>"><? echo number_format($water_cons_diff_sub,2);  ?></td>


						<td width="75" title="<?  $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]];  echo ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).'  & '.$sub_load_t; ?>"><p><?   $sub_load_t=$subcon_load_hr[$batch[csf('id')]].':'.$subcon_load_min[$batch[csf('id')]]; echo  ($subcon_load_date[$batch[csf('id')]] == '0000-00-00' || $subcon_load_date[$batch[csf('id')]]== '' ? '' : change_date_format($subcon_load_date[$batch[csf('id')]])).' <br> '.$sub_load_t;
						 ?></p></td>
						<td width="75" title="<? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo  $unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; ?>"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]); echo ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')]== '' ? '' : change_date_format($batch[csf('process_end_date')])).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')]; // $unloadd=change_date_format($batch[csf('process_end_date')]).' &amp;'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
						<td align="center" width="60">
					   <?
						$new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
						$new_date_time_load=($subcon_load_date[$batch[csf('id')]].' '.$sub_load_t.':'.'00');
						$total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
						echo floor($total_time/60).":".$total_time%60;
						//echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
							?>
						 </td>
                         <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						 echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
						<td align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
					</tr>
		<?
			$i++;
			$btq_sub+=$batch[csf('sub_batch_qnty')];
			$trims_btq_sub+=$batch[csf('total_trims_weight')];
		} //batchdata froeach
		 ?>
			</tbody>
		</table>
		<table class="rpt_table" width="1890" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
				<thead>

                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="40">Total Trims</th>
						<th width="70"><? echo number_format($trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						<th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
                    <tr>
						<th width="30">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="100">&nbsp;</th>
						<th width="70">&nbsp;</th>
						<th width="80">&nbsp;</th>
						<th width="90">&nbsp;</th>
						<th width="40">Grand Total</th>
						<th width="70"><? echo number_format($btq_sub+$trims_btq_sub,2); ?></th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
						 <th width="60">&nbsp;</th>
						<th width="50">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="60">&nbsp;</th>
                        <th width="70"><? //echo number_format($btq_sub,2); ?></th>

						<th width="75">&nbsp;</th>
						<th width="75">&nbsp;</th>
						<th width="60">&nbsp;</th>
                        <th width="100">&nbsp;</th>
						<th>&nbsp;</th>
					</tr>
				</thead>
		</table>
		</div>
		</div>
		<?
		}
		} // Sub Cond End

		if(str_replace("'",'',$cbo_batch_type)==0 || str_replace("'",'',$cbo_batch_type)==3) // Sample Production
		{
			if (count($batchdata_sam)>0)
			{
				$group_by=str_replace("'",'',$cbo_group_by);

			 ?>
			 <div align="left">
			 <div> <b>Sample Dyeing Production </b></div>
			 <table class="rpt_table" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center" id="table_header_3">
                <thead>
                    <tr>
                        <th width="30">SL</th>

                         <? if($group_by==3 || $group_by==0){ ?>
                        <th width="80">M/C No</th>
                        <? }
						?>
                        <th width="70">File No</th>
                        <th width="80">Ref. No</th>
                        <th width="100">Buyer</th>


                        <th width="100">Fabrics Desc</th>
                        <th width="70">Dia/ Width Type</th>
                        <th width="80">Color Name</th>

                        <th width="90">Batch No</th>
                        <th width="40">Extn. No</th>
                        <th width="70">Dyeing Qty.</th>
                        <th width="70">Trims Qty.</th>

                        <th width="75">Load Date & Time</th>
                        <th width="75">UnLoad Date Time</th>
                        <th width="60">Time Used</th>
                        <th width="100">Dyeing Fabrics<br>Type</th>
                        <th width="100">Result</th>
                        <th>Remarks</th>
                    </tr>
                </thead>
			</table>
			<div style=" max-height:350px; width:1390px; overflow-y:scroll;;" id="scroll_body">
            <table class="rpt_table" id="table_body3" width="1370" cellpadding="0" cellspacing="0" border="1" rules="all" align="center">
                <tbody>
                <?
                $i=1; $btq=0; $k=1;$z=1;$grand_total_batch_qty_sam=0;$batch_qnty_sam=0;$total_trim_qty=0;
                $batch_chk_arr=array(); $group_by_arr=array();$trims_check_array=array();
                foreach($batchdata_sam as $batch)
				{
					if ($i%2==0)  $bgcolor_dyeing="#E9F3FF"; else $bgcolor_dyeing="#FFFFFF";
					if($group_by!=0)
					{
						if($group_by==1)
						{
							$group_value=$batch[csf('floor_id')];
							$group_name="Floor";
							$group_dtls_value=$floor_arr[$batch[csf('floor_id')]];
						}
						else if($group_by==2)


						{
							$group_value=$batch[csf('shift_name')];
							$group_name="Shift";
							$group_dtls_value=$shift_name[$batch[csf('shift_name')]];
						}
						else if($group_by==3)
						{
							$group_value=$batch[csf('machine_id')];
							$group_name="machine";
							$group_dtls_value=$machine_arr[$batch[csf('machine_id')]];
						}
						if (!in_array($group_value,$group_by_arr) )
						{
							if($k!=1)
							{
							?>
                                <tr class="tbl_bottom">
                                    <td width="30">&nbsp;</td>

                                     <? if($group_by==3 || $group_by==0){ ?>
                                    <td width="80">&nbsp;</td>
                                     <?
									 }
									 ?>
                                    <td width="70">&nbsp;</td>
                                    <td width="80">&nbsp;</td>
                                    <td width="100">&nbsp;</td>


                                    <td width="100">&nbsp;</td>
                                    <td width="70">&nbsp;</td>
                    				<td width="80">&nbsp;</td>
                                    <td width="130" colspan="2"><strong>Sub. Total : </strong></td>
                                    <td width="70"><? echo number_format($batch_qnty_sam,2); ?></td>
                                    <td width="60">&nbsp;</td>


                                    <td width="75">&nbsp;</td>
                                    <td width="75">&nbsp;</td>
                                    <td width="60">&nbsp;</td>
                                    <td width="100">&nbsp;</td>
                                    <td width="100">&nbsp;</td>

                                    <td>&nbsp;r</td>
                                </tr>
								<?
								unset($batch_qnty_sam);
							}
							?>
							<tr bgcolor="#EFEFEF">
								<td colspan="28" align="left" ><b style="margin-left:900px"><? echo $group_name; ?> : <? echo $group_dtls_value; ?></b></td>
							</tr>
							<?
							$group_by_arr[]=$group_value;
							$k++;
						}
					}
					$order_id=$batch[csf('po_id')];
					$batch_weight=$batch[csf('batch_weight')];
					$water_cons_unload=$batch[csf('water_flow_meter')];
					$water_cons_load=$water_flow_arr[$batch[csf('id')]];
					$hour_meter_load=$load_hour_meter_arr[$batch[csf('id')]];
					//echo $water_cons_load.'=='.$water_cons_unload;
					$water_cons_diff=($water_cons_unload-$water_cons_load)/$batch_weight*1000;

					$desc=explode(",",$batch[csf('item_description')]);
					$po_number=implode(",",array_unique(explode(",",$batch[csf('po_number')])));
					$file_no=implode(",",array_unique(explode(",",$batch[csf('file_no')])));
					$ref_no=implode(",",array_unique(explode(",",$batch[csf('grouping')])));
					$batch_no=$batch[csf('id')];
				if (!in_array($batch_no,$trims_check_array))
					{ $z++;


						 $trims_check_array[]=$batch_no;
						  $tot_trim_qty=$batch[csf('total_trims_weight')];
					}
					else
					{
						 $tot_trim_qty=0;
					}
					?>
					<tr bgcolor="<? echo $bgcolor_dyeing; ?>"  id="trsam_<? echo $i; ?>" onClick="change_color('trsam_<? echo $i; ?>','<? echo $bgcolor_dyeing; ?>')">
                        <td width="30"><? echo $i; ?></td>

                          <? if($group_by==3 || $group_by==0){ ?>
                        <td align="center" width="80"><p><? echo $machine_arr[$batch[csf('machine_id')]]; ?></p></td>
                        <? } if($group_by==2 || $group_by==0){ ?>

                        <? } ?>
                        <td width="70"><p><? echo $file_no; ?></p></td>
                        <td width="80"><p><? echo $ref_no; ?></p></td>
                        <td width="100"><p><? echo $buyer_arr[$batch[csf('buyer_name')]]; ?></p></td>


                        <td width="100"><div style="width:100px; word-wrap:break-word;"><? echo $batch[csf('item_description')]; ?></div></td>
                        <td width="70"><div style="width:70px; word-wrap:break-word;"><? echo $fabric_typee[$batch[csf('width_dia_type')]]; ?></div></td>
                        <td width="80"><p><? echo $color_library[$batch[csf('color_id')]]; ?></p></td>
                        <td width="90"><p><? echo $batch[csf('batch_no')]; ?></p></td>
                        <td width="40"><p><? echo $batch[csf('extention_no')]; ?></p></td>
                        <td align="right" width="70"><? echo number_format($batch[csf('batch_qnty')],2);  ?></td>
                        <td align="right" width="70"><? echo number_format($tot_trim_qty,2);  ?></td>



                        <td width="75"><p><? $load_t=$load_hr[$batch[csf('id')]].':'.$load_min[$batch[csf('id')]]; echo  ($load_date[$batch[csf('id')]] == '0000-00-00' || $load_date[$batch[csf('id')]] == '' ? '' : change_date_format($load_date[$batch[csf('id')]])).' <br> '.$load_t;
						//echo $batch[csf('id')];
                        ?></p></td>
                        <td width="75"><p><? $hr=strtotime($unload_date,$load_t); $min=($batch[csf('end_minutes')])-($load_min[$batch[csf('id')]]);
						echo  ($batch[csf('process_end_date')] == '0000-00-00' || $batch[csf('process_end_date')] == '' ? '' : change_date_format($batch[csf('process_end_date')])).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];
						 //$unloadd=change_date_format($batch[csf('process_end_date')]).'<br>'.$unload_time=$batch[csf('end_hours')].':'.$batch[csf('end_minutes')];?></p></td>
                        <td align="center" width="60">
							<?
                            $new_date_time_unload=($unload_date.' '.$unload_time.':'.'00');
                            $new_date_time_load=($load_date[$batch[csf('id')]].' '.$load_t.':'.'00');
                            $total_time=datediff(n,$new_date_time_load,$new_date_time_unload);
							//echo $new_date_time_unload.'=='.$new_date_time_load;
                            echo floor($total_time/60).":".$total_time%60;
                            //echo ($total_time/60 - $total_time%3600/60)/60 .':'.$total_time%3600/60;
                            ?>
                        </td>
                          <td align="center" width="100"><p><?
						 if($batch[csf('fabric_type')]==1)
							{
								$fab_type="Cotton";
							}
							else if($batch[csf('fabric_type')]==2)
							{
								$fab_type="Polyster";
							}
							else if($batch[csf('fabric_type')]==3)
							{
								$fab_type="Lycra";
							}
							else if($batch[csf('fabric_type')]==4)
							{
								$fab_type="Both Part";
							}
							else if($batch[csf('fabric_type')]==5)
							{
								$fab_type="White";
							}
							else if($batch[csf('fabric_type')]==6)
							{
								$fab_type="Wash";
							}
						  echo $fab_type;//$fabric_type_for_dyeing[$batch[csf('fabric_type')]]; ?></p> </td>
                        <td width="100" align="center"><p><? echo $dyeing_result[$batch[csf('result')]]; ?></p> </td>
                         <td align="center" title="<?  echo $batch[csf('remarks')];   ?>"><p><? echo $batch[csf('remarks')]; ?></p> </td>
					</tr>
					<?
					$i++;
					$batch_qnty_sam+=$batch[csf('batch_qnty')];
					$total_trim_qty+=$tot_trim_qty;
					$grand_total_batch_qty_sam+=$batch[csf('batch_qnty')];
				} //batchdata froeach
				if($group_by!=0)
				{
			?>
                 <tr class="tbl_bottom">
                    <th width="30">&nbsp;</th>

                    <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>

                    <? } ?>
                     <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>


                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>Sub. Total : </strong></th>
                    <th width="70"><? echo number_format($batch_qnty_sam,2); ?></th>
                  	<th width="60">&nbsp;</th>


                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
			<? } ?>
			</tbody>
            <tfoot>
                <tr>
                    <th width="30">&nbsp;</th>

                     <? if($group_by==3 || $group_by==0){ ?>
                    <th width="80">&nbsp;</th>
                    <? } if($group_by==2 || $group_by==0){ ?>

                    <? } ?>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="100">&nbsp;</th>


                    <th width="100">&nbsp;</th>
                    <th width="70">&nbsp;</th>
                    <th width="80">&nbsp;</th>
                    <th width="130" colspan="2"><strong>Grand Total : </strong></th>
                    <th width="70"><? echo number_format($grand_total_batch_qty_sam,2); ?></th>
                    <th width="60"><? echo number_format($total_trim_qty,2);?></th>


                    <th width="75">&nbsp;</th>
                    <th width="75">&nbsp;</th>
                    <th width="60">&nbsp;</th>
                    <th width="100">&nbsp;</th>
                     <th width="100">&nbsp;</th>
                    <th>&nbsp;</th>
                </tr>
            </tfoot>
        </table>
			</div>
			</div>
			<br/>
		<? }
			?>
            <?
		}
		?>
		</fieldset>
		</div>
		<?
		} //Dyeing Production End

	exit();
}
?>